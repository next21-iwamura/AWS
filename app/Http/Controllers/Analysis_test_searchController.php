<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Request as PostRequest;
use Illuminate\Support\Facades\DB;

use DateTime;


/************************************************************************************************ */
    // 売上サマリ 
/************************************************************************************************ */
    // 「groupBy」にロジックで作成した名称を指定した際のエラー対応
    // 【進捗率の取得】
    // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
    // 現在・通販・店舗・卸・合計粗利率（JSグラフ用）
    // 現在・通販・粗利率
    // 現在・店舗・粗利率
    // 現在・卸・粗利率
    // 現在・粗利・縦軸合計
    // 現在・金額構成比
    // 現在・点数構成比

    // 過去・通販・店舗・卸・合計粗利率（JSグラフ用）
    // 過去・通販・粗利率
    // 過去・店舗・粗利率
    // 過去・卸・粗利率
    // 過去・粗利・縦軸合計
    // 過去・金額構成比
    // 過去・点数構成比



//class Analysis_searchController extends Controller
class Analysis_test_searchController extends Controller
{
        /************************************************************************************************************************************************************************************************************* */
            // 定数管理用メソッド
        /************************************************************************************************************************************************************************************************************* */
                public function define(){

                    $define = array();

                    // 本番 or テスト用フォルダの切り替え変数
                        $change = "_test";
                        $change2 = "test_";
                        //$change = "";
                        //$change2 = "";
                    
                        $bladename = "parts.analysis" .$change . "_search";
                        $file_pass = "../storage/app/public/csv/op/analysis" .$change . "_search/";
                        $file_pass2 = "public/csv/op/analysis" .$change . "_search/";
                        $file_name = "uriage_data" . $change . ".csv";
                        $table_name = "analysises";
                        
                        array_push($define,$bladename);
                        array_push($define,$file_pass);
                        array_push($define,$file_pass2);
                        array_push($define,$file_name);
                        array_push($define,$table_name);

                        return $define;

                }



        /************************************************************************************************************************************************************************************************************* */
            // 売り上げ分析ページの表示
        /************************************************************************************************************************************************************************************************************* */
                public function Analysis_search_view(Request $request){


                    // FORMから指定した情報を取得
                        $form_info_get = $this->form_info_get($request);
                            $i=0;
                            foreach($form_info_get as $var){
                                if($i == 0){$start_year = $var;}
                                if($i == 1){$start_month = $var;}
                                if($i == 2){$start_day = $var;}
                                if($i == 3){$end_year = $var;}
                                if($i == 4){$end_month = $var;}
                                if($i == 5){$end_day = $var;}
                                if($i == 6){$this_year = $var;}
                                if($i == 7){$last_year = $var;}
                                if($i == 8){$two_years_ago = $var;}
                                if($i == 9){$output = $var;}
                                if($i == 10){$out1 = $var;}
                                if($i == 11){$out2 = $var;}
                                if($i == 12){$out3 = $var;}
                                if($i == 13){$out4 = $var;}
                                if($i == 14){$out5 = $var;}
                                if($i == 15){$search = $var;}
                                if($i == 16){$three_years_ago = $var;}
                                if($i == 17){$out5_view = $var;}
                                if($i == 18){$next_year = $var;}
                                if($i == 19){$first_day = $var;}
                                if($i == 20){$last_day = $var;}
                                if($i == 21){$out6 = $var;}
                                if($i == 22){$out7 = $var;}

                                $i++;
                            }


                    // デフォルトの期間は月初から月末までを指定
                        /*if($start_year == ""){$start_year = date("Y");}
                        if($start_month == ""){$start_month = date("m");}
                        if($start_day == ""){$start_day = 1;}
                        if($end_year == ""){$end_year = date("Y");}
                        if($end_month == ""){$end_month = date("m");}
                        if($end_day == ""){$end_day = date("t");}*/


                        // 1月1日～3月31日の場合のスタート年は去年
                            $nowdate = strtotime(date('Y-m-d H:i:s'));
                            if(strtotime(date("Y").'-01-01 00:00:00') <= $nowdate && $nowdate < strtotime(date("Y").'-04-01 00:00:00')) {
                                // デフォルトの期間は月初から月末までを指定
                                    if($start_year == ""){$start_year = date("Y") - 1;}
                                    if($start_month == ""){$start_month = 04;}
                                    if($start_day == ""){$start_day = 01;}
                                    if($end_year == ""){$end_year = date("Y");}
                                    if($end_month == ""){$end_month = 03;}
                                    if($end_day == ""){$end_day = 31;}

                        // それ以外の場合のスタート年は今年
                            } else {
                                // デフォルトの期間は月初から月末までを指定
                                    if($start_year == ""){$start_year = date("Y");}
                                    if($start_month == ""){$start_month = 04;}
                                    if($start_day == ""){$start_day = 01;}
                                    if($end_year == ""){$end_year = $start_year + 1;}
                                    if($end_month == ""){$end_month = 03;}
                                    if($end_day == ""){$end_day = 31;}
                            }         




                        $output = "";
                        $out1 = "";
                        $out2 = "";
                        $out3 = "";
                        $out4 = "";
                        $out5 = "";
                        $out6 = "";
                        $out7 = "";

                   
                    /************************************************************************************************************************************************************************************************************* */
                        // 定数管理用（メソッドの呼び出し）start
                    /************************************************************************************************************************************************************************************************************* */
                            $define = $this->define();
                            $def_i = 0;
                            // 各変数にパスやファイル名を代入
                                foreach($define as $def){
                                    if($def_i == 0){ $bladename = $def; }
                                    if($def_i == 1){ $file_pass = $def; }
                                    if($def_i == 2){ $file_pass2 = $def; }
                                    if($def_i == 3){ $file_name = $def; }
                                    if($def_i == 4){ $table_name = $def; }
                                    $def_i++;
                                }
                    /************************************************************************************************************************************************************************************************************* */
                        // 定数管理用（メソッドの呼び出し）end
                    /************************************************************************************************************************************************************************************************************* */

                    /************************************************************************************************************************************************************************************************************* */
                        // DB内登録済期間を取得 start
                    /************************************************************************************************************************************************************************************************************* */

                                // DB検索（月ごとのブランドのみ取得し配列化用）スタート
                                        $db_term = DB::table($table_name) 
                                // 月毎にグループ化して値を分けるための処理
                                            ->select([
                                                $table_name . '.uriage',
                                            ])
                                            ->orderBy('uriage', 'asc')
                                            ->get();

                                // クエリビルダスタート
                                        $i = 0;
                                        $first_day = "";
                                        $last_day = "";
                                        foreach ($db_term as $db_term2) {
                                            $uriage = $db_term2->uriage;
                                            list($year, $month, $day) = explode('-', $uriage);
                                            if(checkdate($month, $day, $year) && strpos($year,'0022') === false && strpos($year,'0023') === false){
                                                $i++;
                                                if($i == 1){
                                                    $first_day = $uriage; 
                                                }
                                                $last_day = $uriage;
                                            }
                                        }

                    /************************************************************************************************************************************************************************************************************* */
                        // DB内登録済期間を取得 end
                    /************************************************************************************************************************************************************************************************************* */


                    return view($bladename,['first_day' => $first_day,'last_day' => $last_day,'next_year' => $next_year,'this_year' => $this_year,'last_year' => $last_year,'two_years_ago' => $two_years_ago,'start_year' => $start_year,'start_month' => $start_month,'start_day' => $start_day,'end_year' => $end_year,'end_month' => $end_month,'end_day' => $end_day,'output' => $output,'out1' => $out1,'out2' => $out2,'out3' => $out3,'out4' => $out4,'out5' => $out5,'out6' => $out6,'out7' => $out7,'three_years_ago' => $three_years_ago,'out5_view' => $out5_view]);
                }


        /************************************************************************************************************************************************************************************************************* */
            // 押下されたボタン毎に処理（メソッド）を切り分け
        /************************************************************************************************************************************************************************************************************* */
                public function btn_select(Request $request){

                    /************************************************************************************************************************************************************************************************************* */
                        // 定数管理用（メソッドの呼び出し）start
                    /************************************************************************************************************************************************************************************************************* */
                            $define = $this->define();
                            $def_i = 0;
                            // 各変数にパスやファイル名を代入
                                foreach($define as $def){
                                    if($def_i == 0){ $bladename = $def; }
                                    if($def_i == 1){ $file_pass = $def; }
                                    if($def_i == 2){ $file_pass2 = $def; }
                                    if($def_i == 3){ $file_name = $def; }
                                    if($def_i == 4){ $table_name = $def; }

                                    $def_i++;
                                }
                    /************************************************************************************************************************************************************************************************************* */
                        // 定数管理用（メソッドの呼び出し）end
                    /************************************************************************************************************************************************************************************************************* */
                    

                    //if (PostRequest::get('search') || PostRequest::get('search2') || PostRequest::get('search3') || PostRequest::get('search4') || PostRequest::get('search5') || PostRequest::get('output')) {
                    if (PostRequest::get('search') || PostRequest::get('search2') || PostRequest::get('search3') || PostRequest::get('search4') || PostRequest::get('search5') || PostRequest::get('search6') || PostRequest::get('output')) {
                        // アップロード用メソッドの実行
                            // FORMから指定した情報を取得
                                $form_info_get = $this->form_info_get($request);
                                $i=0;
                                foreach($form_info_get as $var){
                                    if($i == 0){$start_year = $var;}
                                    if($i == 1){$start_month = $var;}
                                    if($i == 2){$start_day = $var;}
                                    if($i == 3){$end_year = $var;}
                                    if($i == 4){$end_month = $var;}
                                    if($i == 5){$end_day = $var;}
                                    if($i == 6){$this_year = $var;}
                                    if($i == 7){$last_year = $var;}
                                    if($i == 8){$two_years_ago = $var;}
                                    if($i == 9){$output = $var;}
                                    if($i == 10){$out1 = $var;}
                                    if($i == 11){$out2 = $var;}
                                    if($i == 12){$out3 = $var;}
                                    if($i == 13){$out4 = $var;}
                                    if($i == 14){$out5 = $var;}
                                    if($i == 15){$search = $var;}
                                    if($i == 16){$three_years_ago = $var;}
                                    if($i == 17){$out5_view = $var;}
                                    if($i == 18){$next_year = $var;}
                                    if($i == 19){$first_day = $var;}
                                    if($i == 20){$last_day = $var;}
                                    if($i == 21){$out6 = $var;}
                                    if($i == 22){$out7 = $var;}
                                        $i++;
                                }

                        // デフォルトの期間は月初から月末までを指定
                            /*if($start_year == ""){$start_year = date("Y");}
                            if($start_month == ""){$start_month = date("m");}
                            if($start_day == ""){$start_day = 1;}
                            if($end_year == ""){$end_year = date("Y");}
                            if($end_month == ""){$end_month = date("m");}
                            if($end_day == ""){$end_day = date("t");}*/

                        // 1月1日～3月31日の場合のスタート年は去年
                            $nowdate = strtotime(date('Y-m-d H:i:s'));
                            if(strtotime(date("Y").'-01-01 00:00:00') <= $nowdate && $nowdate < strtotime(date("Y").'-04-01 00:00:00')) {
                                // デフォルトの期間は月初から月末までを指定
                                    if($start_year == ""){$start_year = date("Y") - 1;}
                                    if($start_month == ""){$start_month = 04;}
                                    if($start_day == ""){$start_day = 01;}
                                    if($end_year == ""){$end_year = date("Y");}
                                    if($end_month == ""){$end_month = 03;}
                                    if($end_day == ""){$end_day = 31;}

                        // それ以外の場合のスタート年は今年
                            } else {
                                // デフォルトの期間は月初から月末までを指定
                                    if($start_year == ""){$start_year = date("Y");}
                                    if($start_month == ""){$start_month = 04;}
                                    if($start_day == ""){$start_day = 01;}
                                    if($end_year == ""){$end_year = $start_year + 1;}
                                    if($end_month == ""){$end_month = 03;}
                                    if($end_day == ""){$end_day = 31;}
                            }         
                        

                            $search = "";
                            //if (PostRequest::has('search') || PostRequest::has('search2') || PostRequest::has('search3') || PostRequest::has('search4') || PostRequest::has('search5')) {
                            if (PostRequest::has('search') || PostRequest::has('search2') || PostRequest::has('search3') || PostRequest::has('search4') || PostRequest::has('search5') || PostRequest::has('search6')) {
                                $search = "ON";
                            }


                        // FORM情報より指定されたDB情報の取得
                            $restock_comment = "";
                            // [売上]サマリ用 
                                if (PostRequest::has('search')){
                                    //return $this->db_info_get($start_year,$start_month,$start_day,$end_year,$end_month,$end_day,$this_year,$last_year,$two_years_ago,$select_stuff,$page_limit,$status,$keyword,$restock_flag,$restock_comment);
                                    return $this->db_info_get($start_year,$start_month,$start_day,$end_year,$end_month,$end_day,$this_year,$last_year,$two_years_ago,$output,$out1,$out2,$out3,$out4,$out5,$search,$three_years_ago,/*$out5_view,*/$next_year,$first_day,$last_day,$out6,$out7);
                            
                            // [売上]通販区分用 
                                } else if (PostRequest::has('search2')){
                                    return $this->db_info_get2($start_year,$start_month,$start_day,$end_year,$end_month,$end_day,$this_year,$last_year,$two_years_ago,$output,$out1,$out2,$out3,$out4,$out5,$search,$three_years_ago,/*$out5_view,*/$next_year,$first_day,$last_day,$out6,$out7);
                            // [売上]扱い部門用 
                                } else if (PostRequest::has('search3')){
                                    return $this->db_info_get3($start_year,$start_month,$start_day,$end_year,$end_month,$end_day,$this_year,$last_year,$two_years_ago,$output,$out1,$out2,$out3,$out4,$out5,$search,$three_years_ago,/*$out5_view,*/$next_year,$first_day,$last_day,$out6,$out7);
                            // ブランド用 
                                } else if (PostRequest::has('search5')){
                                        // 選択したブランドの情報を取得（JS表示用）
                                        if (PostRequest::has('brandselect')) {
                                            $brandselect = PostRequest::input('brandselect');
                                        } else {
                                            $brandselect = "";
                                        }
                                        if (PostRequest::has('brandselect_b')) {
                                            $brandselect_b= PostRequest::input('brandselect_b');
                                        } else {
                                            $brandselect_b = "";
                                        }
                                        if (PostRequest::has('brandselect_jw')) {
                                            $brandselect_jw = PostRequest::input('brandselect_jw');
                                        } else {
                                            $brandselect_jw = "";
                                        }
                            // 「売上」or「点数」表示切り替え用フラグ
                                        if (PostRequest::has('out5_view')) {
                                            $out5_view = PostRequest::input('out5_view');
                                        } else {
                                            $out5_view = "";
                                        }
                                    return $this->db_info_get5($start_year,$start_month,$start_day,$end_year,$end_month,$end_day,$this_year,$last_year,$two_years_ago,$output,$out1,$out2,$out3,$out4,$out5,$search,$three_years_ago,$brandselect,$brandselect_b,$brandselect_jw,$out5_view,$next_year,$first_day,$last_day,$out5,$out6,$out7);
                            
                            // [売上]免税区分用 
                                } else if (PostRequest::has('search6')){
                                    return $this->db_info_get6($start_year,$start_month,$start_day,$end_year,$end_month,$end_day,$this_year,$last_year,$two_years_ago,$output,$out1,$out2,$out3,$out4,$out5,$search,$three_years_ago,/*$out5_view,*/$next_year,$first_day,$last_day,$out6,$out7);
                            
                            // 検索前の表示用 
                                } else {
                                    // フォームのデフォルト値を付与
                                        $out1_a = "ON";
                                        $out1_b = "ON";
                                        $out1_c = "OFF";
                                        $out1_d = "OFF";
                                        $out2_a = "ON";
                                        $out2_b = "ON";
                                        $out2_c = "ON";
                                        $out2_d = "OFF";
                                        $out2_e = "OFF";
                                        $out3_a = "ON";
                                        $out3_b = "ON";
                                        $out3_c = "ON";
                                        $out3_d = "ON";
                                        $out3_e = "ON";
                                        $out3_f = "ON";
                                        $out4_a = "ON";
                                        $out4_b = "ON";
                                        $out5_a = "ON";
                                        $out5_b = "ON";
                                        $out5_c = "ON";
                                        $out6 = "ON";
                                        $out7 = "ON";
                            return view($bladename,['first_day' => $first_day,'last_day' => $last_day,'next_year' => $next_year,'this_year' => $this_year,'last_year' => $last_year,'two_years_ago' => $two_years_ago,'start_year' => $start_year,'start_month' => $start_month,'start_day' => $start_day,'end_year' => $end_year,'end_month' => $end_month,'end_day' => $end_day,'output' => $output,'out1' => $out1,'out2' => $out2,'out3' => $out3,'out4' => $out4,'out5' => $out5,'three_years_ago' => $three_years_ago,'out1_a' => $out1_a,'out1_b' => $out1_b,'out1_c' => $out1_c,'out1_d' => $out1_d,'out2_a' => $out2_a,'out2_b' => $out2_b,'out2_c' => $out2_c,'out2_d' => $out2_d,'out2_e' => $out2_e,'out3_a' => $out3_a,'out3_b' => $out3_b,'out3_c' => $out3_c,'out3_d' => $out3_d,'out3_e' => $out3_e,'out3_f' => $out3_f,'out4_a' => $out4_a,'out4_b' => $out4_b,'out5_a' => $out5_a,'out5_b' => $out5_b,'out5_c' => $out5_c,'out5_view' => $out5_view,'out6' => $out6,'out7 => $out7']);
                                }
                    } else if (PostRequest::get('db_insert')) {
                        // CSVデータをデータベースへ登録用メソッドの実行
                            return $this->db_insert($request);
                    } 
                }





/************************************************************************************************************************************************************************************************************* */
    // フォーム情報取得用
/************************************************************************************************************************************************************************************************************* */


    public function form_info_get(Request $request){

        // 変数初期化
            $start_year = "";
            $start_month = "";
            $start_day = "";
            $end_year = "";
            $end_month = "";
            $end_day = "";
            $select_stuff = "";
            $output = "";
            $out1 = "";
            $search = "";
            $three_years_ago = "";
            $out2 = "";
            $out3 = "";
            $out4 = "";
            $out5 = "";
            $out5_view = "";
            $out6 = "";
            $out7 = "";

            $form_info_get = array();


                    /************************************************************************************************************************************************************************************************************* */
                        // 定数管理用（メソッドの呼び出し）start
                    /************************************************************************************************************************************************************************************************************* */
                            $define = $this->define();
                            $def_i = 0;
                            // 各変数にパスやファイル名を代入
                                foreach($define as $def){
                                    if($def_i == 4){ $table_name = $def; }
                                    $def_i++;
                                }
                    /************************************************************************************************************************************************************************************************************* */
                        // 定数管理用（メソッドの呼び出し）end
                    /************************************************************************************************************************************************************************************************************* */
            

                    /************************************************************************************************************************************************************************************************************* */
                        // DB内登録済期間を取得 start
                    /************************************************************************************************************************************************************************************************************* */

                                // DB検索（月ごとのブランドのみ取得し配列化用）スタート
                                $db_term = DB::table($table_name) 
                                // 月毎にグループ化して値を分けるための処理
                                            ->select([
                                                $table_name . '.uriage',
                                            ])
                                            ->orderBy('uriage', 'asc')
                                            ->get();

                                // クエリビルダスタート
                                        $i = 0;
                                        $first_day = "";
                                        $last_day = "";
                                        foreach ($db_term as $db_term2) {
                                            $uriage = $db_term2->uriage;
                                            list($year, $month, $day) = explode('-', $uriage);
                                            if(checkdate($month, $day, $year) && strpos($year,'0022') === false && strpos($year,'0023') === false){
                                                $i++;
                                                if($i == 1){
                                                    $first_day = $uriage; 
                                                }
                                                $last_day = $uriage;
                                            }
                                        }


                    /************************************************************************************************************************************************************************************************************* */
                        // DB内登録済期間を取得 end
                    /************************************************************************************************************************************************************************************************************* */


            if (PostRequest::has('start_year')) {
                $start_year = PostRequest::input('start_year');
            }
            if (PostRequest::has('start_month')) {
                $start_month = PostRequest::input('start_month');
            }
            if (PostRequest::has('start_day')) {
                $start_day = PostRequest::input('start_day');
            }
            if (PostRequest::has('end_year')) {
                $end_year = PostRequest::input('end_year');
            }
            if (PostRequest::has('end_month')) {
                $end_month = PostRequest::input('end_month');
            }
            if (PostRequest::has('end_day')) {
                $end_day = PostRequest::input('end_day');
            }
            if (PostRequest::has('output')) {
                $output = PostRequest::input('output');
            }
            if (PostRequest::has('out1')) {
                $out1 = PostRequest::input('out1');
            }
            if (PostRequest::has('out2')) {
                $out2 = PostRequest::input('out2');
            }
            if (PostRequest::has('out3')) {
                $out3 = PostRequest::input('out3');
            }
            if (PostRequest::has('out4')) {
                $out4 = PostRequest::input('out4');
            }
            if (PostRequest::has('out5')) {
                $out5 = PostRequest::input('out5');
            }
            if (PostRequest::has('out5_view')) {
                $out5_view = PostRequest::input('out5_view');
            }
            if (PostRequest::has('out6')) {
                $out6 = PostRequest::input('out6');
            }
            if (PostRequest::has('out7')) {
                $out7 = PostRequest::input('out7');
            }

            // 現在から遡って4年の西暦年を取得（フォーム表示用）
                $next_year = date("Y", strtotime('+1 year'));
                $this_year = date('Y');
                $last_year = date("Y", strtotime('-1 year'));
                $two_years_ago = date("Y", strtotime('-2 year'));
                $three_years_ago = date("Y", strtotime('-3 year'));

            $form_info_get = [
                'start_year'=> $start_year,
                'start_month'=> $start_month,
                'start_day'=> $start_day,
                'end_year'=> $end_year,
                'end_month'=> $end_month,
                'end_day'=> $end_day,
                'this_year'=> $this_year,
                'last_year'=> $last_year,
                'two_years_ago'=> $two_years_ago,
                'output'=> $output,
                'out1'=> $out1,
                'out2'=> $out2,
                'out3'=> $out3,
                'out4'=> $out4,
                'out5'=> $out5,
                'search'=> $search,
                'three_years_ago' => $three_years_ago,
                'out5_view'=> $out5_view,
                'next_year'=> $next_year,
                'first_day' => $first_day,
                'last_day' => $last_day,
                'out6' => $out6,
                'out7' => $out7,
                ];

            return $form_info_get;

    }
                



/************************************************************************************************************************************************************************************************************* */
    // DB情報取得（ブランド用）
/************************************************************************************************************************************************************************************************************* */


    public function db_info_get5($a,$b,$c,$d,$e,$f,$g,$h,$j,$k,$l,$m,$n,$o,$p,$q,$r,$s,$t,$u,$v,$w,$x,$y,$z,$a2){

        $start_year = $a;
        $start_month = $b;
        $start_day = $c;
        $end_year = $d;
        $end_month = $e;
        $end_day = $f;
        $this_year = $g;
        $last_year = $h;
        $two_years_ago = $j;
        $output = $k;
        $out1 = $l;
        $out2 = $m;
        $out3 = $n;
        $out4 = $o;
        $out5 = $p;
        $search = $q;
        $three_years_ago = $r;
        $brandselect = $s;
        $brandselect_b = $t;
        $brandselect_jw = $u;
        $out5_view = $v;
        $next_year = $w;
        $first_day = $x;
        $last_day = $y;
        $out5 = $p;
        $out6 = $z;
        $out7 = $a2;
        
            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            // DB登録ロジックを実施
            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                

                    /************************************************************************************************************************************************************************************************************* */
                        // 定数管理用（メソッドの呼び出し）start
                    /************************************************************************************************************************************************************************************************************* */
                            $define = $this->define();
                            $def_i = 0;
                            // 各変数にパスやファイル名を代入
                                foreach($define as $def){
                                    if($def_i == 0){ $bladename = $def; }
                                    if($def_i == 1){ $file_pass = $def; }
                                    if($def_i == 2){ $file_pass2 = $def; }
                                    if($def_i == 3){ $file_name = $def; }
                                    if($def_i == 4){ $table_name = $def; }

                                    $def_i++;
                                }
                    /************************************************************************************************************************************************************************************************************* */
                        // 定数管理用（メソッドの呼び出し）end
                    /************************************************************************************************************************************************************************************************************* */
                
                    /************************************************************************************************************************************************************************************************************* */
                        // フォームボタン押下時情報の受け取り start
                    /************************************************************************************************************************************************************************************************************* */

                            // 検索期間を変数に代入
                                $between_start = $start_year . "/" . $start_month . "/" . $start_day ." 00-00:00";
                                $between_end = $end_year . "/" . $end_month . "/" . $end_day ." 23-59:59";
                                $between_start_view = $start_year . "/" . $start_month . "/" . $start_day;
                                $between_end_view = $end_year . "/" . $end_month . "/" . $end_day;


                                $diff_start1 = new DateTime($between_start_view);
                                $diff_end1 = new DateTime($between_end_view);

                                $interval1 = $diff_end1 -> diff($diff_start1);

                                $diff_year1= $interval1 -> y;
                                $diff_month1 = $interval1 -> m;
                                $diff_month1 = $diff_year1 * 12 + $diff_month1;

                            // 「フォーム表示ボタン」フラグ
                                if (PostRequest::has('form_view')) {
                                    $form_view = PostRequest::input('form_view');
                                } else {$form_view = "OFF";}
                            

                            // 「売却区分」フラグ
                                $out1_a = "OFF";
                                $out1_b = "OFF";
                                $out1_c = "OFF";
                                $out1_d = "OFF";
                                if($out1 <> "" && in_array('2',$out1)){ $out1_a = "ON";}
                                if($out1 <> "" && in_array('3',$out1)){ $out1_b = "ON";}
                                if($out1 <> "" && in_array('4',$out1)){ $out1_c = "ON";}
                                if($out1 <> "" && in_array('5',$out1)){ $out1_d = "ON";}

                            // 新中アンフラグ
                                $out2_a = "OFF";
                                $out2_b = "OFF";
                                $out2_c = "OFF";
                                $out2_d = "OFF";
                                $out2_e = "OFF";
                                if($out2 <> "" && in_array('1',$out2)){ $out2_a = "ON";}
                                if($out2 <> "" && in_array('2',$out2)){ $out2_b = "ON";}
                                if($out2 <> "" && in_array('3',$out2)){ $out2_c = "ON";}
                                if($out2 <> "" && in_array('4',$out2)){ $out2_d = "ON";}
                                if($out2 <> "" && in_array('5',$out2)){ $out2_e = "ON";}

                            // 通販サイトフラグ
                                $out3_a = "OFF";
                                $out3_b = "OFF";
                                $out3_c = "OFF";
                                $out3_d = "OFF";
                                $out3_e = "OFF";
                                $out3_f = "OFF";
                                if($out3 <> "" && in_array('1',$out3)){ $out3_a = "ON";}
                                if($out3 <> "" && in_array('2',$out3)){ $out3_b = "ON";}
                                if($out3 <> "" && in_array('3',$out3)){ $out3_c = "ON";}
                                if($out3 <> "" && in_array('4',$out3)){ $out3_d = "ON";}
                                if($out3 <> "" && in_array('5',$out3)){ $out3_e = "ON";}
                                if($out3 <> "" && in_array('6',$out3)){ $out3_f = "ON";}

                            // 免税フラグ
                                $out4_a = "OFF";
                                $out4_b = "OFF";
                                if($out4 <> "" && in_array('1',$out4)){ $out4_a = "ON";}
                                if($out4 <> "" && in_array('2',$out4)){ $out4_b = "ON";}

                            // ブランドフラグ
                                $out5_a = "OFF";
                                $out5_b = "OFF";
                                $out5_c = "OFF";
                                if($out5 <> "" && in_array('2',$out5)){ $out5_a = "ON";}
                                if($out5 <> "" && in_array('3',$out5)){ $out5_b = "ON";}
                                if($out5 <> "" && in_array('4',$out5)){ $out5_c = "ON";}
                            


                    /************************************************************************************************************************************************************************************************************* */
                        // フォームボタン押下時情報の受け取り end
                    /************************************************************************************************************************************************************************************************************* */


                    /************************************************************************************************************************************************************************************************************* */
                        // 検索期間の月数だけ遡った過去の期間を取得 start
                    /************************************************************************************************************************************************************************************************************* */


                            // 開始と終了期間の差分（～カ月）を取得                        
                                $start = $start_year . "-" . $start_month . "-" . $start_day;
                                $end = $end_year . "-" . $end_month . "-" . $end_day;
                                $diff_start = new DateTime($start);
                                $diff_end = new DateTime($end);


                                $interval = $diff_end -> diff($diff_start);

                                $diff_year = $interval -> y;
                                $diff_month = $interval -> m;

                                $diff_month = $diff_year * 12 + $diff_month;

                                //if($start_day <> 1){$diff_month = $diff_month + 1;}
                                //echo "<p style='color:red;'>" . $start . "(" . $diff_month . ")</p>";

                                //echo $diff_month . "カ月<br>";
                            // 差分の月だけ遡った過去の期間を取得
                                // 検索開始日                
                                    $start_now = date($start_year. "-" . $start_month. "-" . $start_day);
                                // 過去開始日
                                    //$start_past = date("Y-m-d", strtotime($start_now . " -" . $diff_month . " month"));
                                    $past_between_start = date("Y-m-d", strtotime($start_now . " -" . ($diff_month + 1) . " month"));
                                    $past_between_start_view = date("Y-m", strtotime($start_now . " -" . ($diff_month +1) . " month"));
                                // 検索終了日
                                    $end_now = date($end_year. "-" . $end_month. "-" . $end_day);
                                // 過去終了日
                                    //$end_past = date("Y-m-d", strtotime($end_now . " -" . $diff_month . " month"));
                                    $past_between_end = date("Y-m-d", strtotime($start_now . " -1 day"));
                                    $past_between_end_view = date("Y-m", strtotime($start_now . " -1 month"));


                                // 過去期間の月初日を配列へ代入（該当月のデータ登録が無い場合、JS代入値が空になってグラフがズレてしまう事を回避するため0代入ロジックに使う）
                                    // 配列版
                                        $manth_now_array = array();
                                        $manth_past_array = array();
                                    // カンマ区切りの文字列版
                                        $temp5_web_manthly_data = "";
                                        $temp5_web_manthly_data2 = "";
                                        $temp5_web_manthly_data3 = "";

                                        $now_temp5_jack_manthly_data_uriage = "";
                                        $now_temp5_jack_manthly_data_honsuu = "";
                                        $now_temp5_betty_manthly_data_uriage = "";
                                        $now_temp5_betty_manthly_data_honsuu = "";
                                        $now_temp5_jewelry_manthly_data_uriage = "";
                                        $now_temp5_jewelry_manthly_data_honsuu = "";
                                        $past_temp5_jack_manthly_data_uriage = "";
                                        $past_temp5_jack_manthly_data_honsuu = "";
                                        $past_temp5_betty_manthly_data_uriage = "";
                                        $past_temp5_betty_manthly_data_honsuu = "";
                                        $past_temp5_jewelry_manthly_data_uriage = "";
                                        $past_temp5_jewelry_manthly_data_honsuu = "";

                                // 開始日が2日以降の場合は過去の取得月期間を現在より一か月多くする（開始日を2日以降にすると過去の最後月の変数が足りないエラー　→　例：同年5月2日～7月17日の二か月半の場合、現在は5月6月7月で変数は三つだが、過去は2月3月4月5月の四つ必要なためずれる事が原因　→　チャートも過去のみ最後の月に値が入るので、開始は1日の方が分かりやすい）
                                    if($start_day <> 1){$over_month = $diff_month + 1;}else {$over_month = $diff_month;}
                                    //for($past_ii = 0;  $past_ii <= $diff_month; $past_ii++){
                                    for($past_ii = 0;  $past_ii <= $over_month; $past_ii++){

                                        if($past_ii == 0){
                                            // 現在用
                                                $manth_now = date("Y-m", strtotime($start_now));
                                            // 過去用
                                                $past_manth = $past_between_start;
                                                $past_manth2 = mb_substr($past_between_start,0,-3);

                                        } else {
                                            // 現在用
                                                $manth_now = date("Y-m", strtotime($manth_now . " 1 month"));
                                            // 過去用
                                                $past_manth = date("Y-m-d", strtotime($past_manth . " 1 month"));
                                                $past_manth2 = date("Y-m", strtotime($past_manth2 . " 1 month"));

                                        }
                                        // 現在用
                                            array_push($manth_now_array,$manth_now);
                                            $now_temp5_jack_manthly_data_uriage .= $manth_now . ",";
                                            $now_temp5_jack_manthly_data_honsuu .= $manth_now . ",";
                                            $now_temp5_betty_manthly_data_uriage .= $manth_now . ",";
                                            $now_temp5_betty_manthly_data_honsuu .= $manth_now . ",";
                                            $now_temp5_jewelry_manthly_data_uriage .= $manth_now . ",";
                                            $now_temp5_jewelry_manthly_data_honsuu .= $manth_now . ",";
                                            // 過去用
                                            array_push($manth_past_array,$past_manth2);
                                            $past_temp5_jack_manthly_data_uriage .= $past_manth2 . ",";
                                            $past_temp5_jack_manthly_data_honsuu .= $past_manth2 . ",";
                                            $past_temp5_betty_manthly_data_uriage .= $past_manth2 . ",";
                                            $past_temp5_betty_manthly_data_honsuu .= $past_manth2 . ",";
                                            $past_temp5_jewelry_manthly_data_uriage .= $past_manth2 . ",";
                                            $past_temp5_jewelry_manthly_data_honsuu .= $past_manth2 . ",";
                                                
                                            $temp5_web_manthly_data .= $manth_now . ",";
                                            $temp5_web_manthly_data2 .= $manth_now . ",";
                                            $temp5_web_manthly_data3 .= $manth_now . ",";


                                    }
                                    $now_temp5_jack_manthly_data_uriage = trim($now_temp5_jack_manthly_data_uriage ,",");
                                    $now_temp5_jack_manthly_data_honsuu = trim($now_temp5_jack_manthly_data_honsuu ,",");
                                    $now_temp5_betty_manthly_data_uriage = trim($now_temp5_betty_manthly_data_uriage ,",");
                                    $now_temp5_betty_manthly_data_honsuu = trim($now_temp5_betty_manthly_data_honsuu ,",");
                                    $now_temp5_jewelry_manthly_data_uriage = trim($now_temp5_jewelry_manthly_data_uriage ,",");
                                    $now_temp5_jewelry_manthly_data_honsuu = trim($now_temp5_jewelry_manthly_data_honsuu ,",");
                                    $past_temp5_jack_manthly_data_uriage = trim($past_temp5_jack_manthly_data_uriage ,",");
                                    $past_temp5_jack_manthly_data_honsuu = trim($past_temp5_jack_manthly_data_honsuu ,",");
                                    $past_temp5_betty_manthly_data_uriage = trim($past_temp5_betty_manthly_data_uriage ,",");
                                    $past_temp5_betty_manthly_data_honsuu = trim($past_temp5_betty_manthly_data_honsuu ,",");
                                    $past_temp5_jewelry_manthly_data_uriage = trim($past_temp5_jewelry_manthly_data_uriage ,",");
                                    $past_temp5_jewelry_manthly_data_honsuu = trim($past_temp5_jewelry_manthly_data_honsuu ,",");


                                    $temp5_web_manthly_data = trim($temp5_web_manthly_data ,",");
                                    $temp5_web_manthly_data2 = trim($temp5_web_manthly_data2 ,",");
                                    $temp5_web_manthly_data3 = trim($temp5_web_manthly_data3 ,",");


                    /************************************************************************************************************************************************************************************************************* */
                        // 検索期間の月数だけ遡った過去の期間を取得 end
                    /************************************************************************************************************************************************************************************************************* */


/************************************************************************************************************************************************************************************************************* */
    // Betty用
/************************************************************************************************************************************************************************************************************* */
                                    if(isset($out5)){


/********************************************************************************************* */
//過去用 START
/********************************************************************************************* */


                                    /************************************************************************************************************************************************************************************************************* */
                                        // 月ごとのブランドのみ取得し配列化
                                    /************************************************************************************************************************************************************************************************************* */
                                            
                                            // 現在全期間全ブランド一覧
                                                $all_past_brand_array = array();

                                            // DB検索（月ごとのブランドのみ取得し配列化用）スタート
                                                $past_temp5_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        $table_name . '.uriage',
                                                        $table_name . '.brandname',
                                                        $table_name . '.brand',
                                                        $table_name . '.baikyakukubun',
                                                        $table_name . '.shouhinkubunbunruimei',
                                                        $table_name . '.tsuuhankubun',
                                                        $table_name . '.menzei',
                                                    ])
                                                // 条件（期間の指定）
                                                    ->whereBetween($table_name . '.uriage', [$past_between_start, $past_between_end])

                                                    //->Where('shouhinkubunbunruimei', '時計中古')

                                                    ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                                        // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
															if($out1_d == "ON"){
	                                                            if($out1_a == "OFF" && $out1_b == "OFF" && $out1_c == "OFF"){
	                                                                $query->Where('baikyakukubun', '<>', 1);
	                                                                $query->Where('baikyakukubun', '<>', 2);
	                                                                $query->Where('baikyakukubun', '<>', 3);
	                                                            } else if($out1_a == "ON" && $out1_b == "OFF" && $out1_c == "OFF"){
	                                                                $query->Where('baikyakukubun', '<>', 2);
	                                                                $query->Where('baikyakukubun', '<>', 3);
	                                                            } else if($out1_a == "OFF" && $out1_b == "ON" && $out1_c == "OFF"){
	                                                                $query->Where('baikyakukubun', '<>', 1);
	                                                                $query->Where('baikyakukubun', '<>', 3);
	                                                            } else if($out1_a == "OFF" && $out1_b == "OFF" && $out1_c == "ON"){
	                                                                $query->Where('baikyakukubun', '<>', 1);
	                                                                $query->Where('baikyakukubun', '<>', 2);
	                                                            } else if($out1_a == "OFF" && $out1_b == "ON" && $out1_c == "ON"){
	                                                                $query->Where('baikyakukubun', '<>', 1);
	                                                            } else if($out1_a == "ON" && $out1_b == "OFF" && $out1_c == "ON"){
	                                                                $query->Where('baikyakukubun', '<>', 2);
	                                                            } else if($out1_a == "ON" && $out1_b == "ON" && $out1_c == "OFF"){
	                                                                $query->Where('baikyakukubun', '<>', 3);
	                                                            }
															} else {
		                                                        // 条件（売上部門が店舗）
		                                                            if($out1_a == "ON"){
		                                                                $query->orWhere('baikyakukubun',1);
		                                                            }
		                                                        // 条件（売上部門が通販）
		                                                            if($out1_b == "ON"){
		                                                                $query->orWhere('baikyakukubun',2);
		                                                            }
		                                                        // 条件（売上部門が卸）
		                                                            if($out1_c == "ON"){
		                                                                $query->orWhere('baikyakukubun',3);
		                                                            }
															}
                                                    
                                                    })

                                                    ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
															// 条件（商品区分分類名が新品）
																if($out2_a == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%新品%");
																}
															// 条件（商品区分分類名が中古）
																if($out2_b == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%中古%");
																}
															// 条件（商品区分分類名がアンティーク）
																if($out2_c == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
																}
															// 条件（商品区分分類名がその他）
																if($out2_d == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%その他%");
																}
															// 条件（商品区分分類名が修理）
																if($out2_e == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%修理%");
																}
                                                    
                                                    })

                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                            $query->orWhere('tsuuhankubun','');

															// 条件（通販区分が自社）
																if($out3_a == "ON"){
																	$query->orWhere('tsuuhankubun',1);
																}
															// 条件（通販区分が楽天）
																if($out3_b == "ON"){
																	$query->orWhere('tsuuhankubun',2);
																}
															// 条件（通販区分がヤフー）
																if($out3_c == "ON"){
																	$query->orWhere('tsuuhankubun',3);
																}
															// 条件（通販区分が電話・雑誌）
																if($out3_d == "ON"){
																	$query->orWhere('tsuuhankubun',5);
																}
															// 条件（通販区分がYオークション）
																if($out3_e == "ON"){
																	$query->orWhere('tsuuhankubun',4);
																}
															// 条件（通販区分が修理品返送）
																if($out3_f == "ON"){
																	$query->orWhere('tsuuhankubun',9);
																}
                                                    
                                                    })

                                                    ->where(function ($query) use ($out4_a,$out4_b) {
															// 条件（免税区分が0:対象外）
																if($out4_a == "ON"){
																	$query->orwhere("menzei","like","%対象外%");
																}
															// 条件（免税区分が1:免税）
																if($out4_b == "ON"){
																	$query->orwhere("menzei","like","%免税%");
																}
                                                    })




                                                // ソート順指定
                                                    ->orderBy('uriage', 'asc')
                                                    ->get();
                                            // 月毎の全ブランド名を格納するための変数を作成
                                                foreach($manth_past_array as $month){

                                                    // 月毎の全ブランド名格納用
                                                        ${"past_brand_array_" . $month} = array();
                                                        ${"past_brand2_array_" . $month} = array();
                                                }

                                            // クエリビルダスタート
                                                $i = 0;
                                                foreach ($past_temp5_buys as $past_temp5_buy) {

                                                    // 各月名
                                                        $month = $past_temp5_buy->uriage;
                                                        $month = mb_substr($month,0,-3);
                                                    // 個別ブランド番号
                                                        $temp5_brand_no[$i]= $past_temp5_buy->brand;
                                                    // 個別ブランド名
                                                        $temp5_brand[$i]= $past_temp5_buy->brandname;

                                                       
                                                            // 過去全期間全ブランド一覧用配列にブランドをセット
                                                                if(in_array($temp5_brand[$i] . "[" . $temp5_brand_no[$i] . "]",$all_past_brand_array, true)){
                                                                } else {
                                                                    if($temp5_brand[$i] != "" && $temp5_brand[$i] != "不明"){
                                                                        array_push($all_past_brand_array,$temp5_brand[$i] . "[" . $temp5_brand_no[$i] . "]");
                                                                    }
                                                                }
                                                            
                                                            // 各月の全ブランド配列に含まれていない場合のみ個別ブランド名を配列にセット
                                                                if(in_array($temp5_brand[$i] . "[" . $temp5_brand_no[$i] . "]",${"past_brand_array_" . $month}, true)){
                                                                } else {
                                                                    // 月毎の全ブランドを配列へ代入
                                                                        if($temp5_brand[$i] != "" && $temp5_brand[$i] != "不明"){
                                                                            array_push(${"past_brand_array_" . $month},$temp5_brand[$i] . "[" . $temp5_brand_no[$i] . "]");
                                                                            array_push(${"past_brand2_array_" . $month},$temp5_brand[$i] . "[" . $temp5_brand_no[$i] . "]");
                                                                        }
                                                                    // 月毎のブランド毎の売上を代入するための変数名作成（変数名を変える事で全ブランド毎の変数を作成）
                                                                        ${"past_brand_jack_" . $month . "-" . $temp5_brand_no[$i]} = 0;
                                                                        ${"past_brand_betty_" . $month . "-" . $temp5_brand_no[$i]} = 0;
                                                                        ${"past_brand_jewelry_" . $month . "-" . $temp5_brand_no[$i]} = 0;
                                                                        ${"past_brand_jack_sum_" . $temp5_brand_no[$i]} = 0;
                                                                        ${"past_brand_betty_sum_" . $temp5_brand_no[$i]} = 0;
                                                                        ${"past_brand_jewelry_sum_" . $temp5_brand_no[$i]} = 0;
                                                                        
                                                                    // 月毎のブランド毎の売上用HTMLの変数名作成（変数名を変える事で全ブランド毎の変数を作成）
                                                                        ${"past_brand_jack_sorce_" . $temp5_brand_no[$i]} = "";
                                                                        ${"past_brand_betty_sorce_" . $temp5_brand_no[$i]} = "";
                                                                        ${"past_brand_jewelry_sorce_" . $temp5_brand_no[$i]} = "";
                                                                        ${"past_brand_jack_js_" . $temp5_brand_no[$i]} = "";
                                                                        ${"past_brand_betty_js_" . $temp5_brand_no[$i]} = "";
                                                                        ${"past_brand_jewelry_js_" . $temp5_brand_no[$i]} = "";
                                                                
                                                                    // 月毎のブランド毎の売上点数を代入するための変数名作成（変数名を変える事で全ブランド毎の変数を作成）
                                                                        ${"past_brand2_jack_" . $month . "-" . $temp5_brand_no[$i]} = 0;
                                                                        ${"past_brand2_betty_" . $month . "-" . $temp5_brand_no[$i]} = 0;
                                                                        ${"past_brand2_jewelry_" . $month . "-" . $temp5_brand_no[$i]} = 0;
                                                                        ${"past_brand2_jack_sum_" . $temp5_brand_no[$i]} = 0;
                                                                        ${"past_brand2_betty_sum_" . $temp5_brand_no[$i]} = 0;
                                                                        ${"past_brand2_jewelry_sum_" . $temp5_brand_no[$i]} = 0;
                                                                        
                                                                    // 月毎のブランド毎の売上点数用HTMLの変数名作成（変数名を変える事で全ブランド毎の変数を作成）
                                                                        ${"past_brand2_jack_sorce_" . $temp5_brand_no[$i]} = "";
                                                                        ${"past_brand2_betty_sorce_" . $temp5_brand_no[$i]} = "";
                                                                        ${"past_brand2_jewelry_sorce_" . $temp5_brand_no[$i]} = "";
                                                                        ${"past_brand2_jack_js_" . $temp5_brand_no[$i]} = "";
                                                                        ${"past_brand2_betty_js_" . $temp5_brand_no[$i]} = "";
                                                                        ${"past_brand2_jewelry_js_" . $temp5_brand_no[$i]} = "";
                                                                
                                                                }
                                                    

                                                    $i++;
                                                }

                                    /************************************************************************************************************************************************************************************************************* */
                                        // 月ごとにブランドや部門別のデータを作成
                                    /************************************************************************************************************************************************************************************************************* */

                                        // DB検索（月ごとのブランドのみ取得し配列化用）スタート
                                                $past_temp5_buys2 = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        $table_name . '.bumonmei',
                                                        $table_name . '.brand',
                                                        $table_name . '.brandname',
                                                        $table_name . '.uriagekingaku',
                                                        $table_name . '.uriage',
                                                        $table_name . '.uriagesuu',
                                                        $table_name . '.baikyakukubun',
                                                        $table_name . '.shouhinkubunbunruimei',
                                                        $table_name . '.tsuuhankubun',
                                                        $table_name . '.menzei',
                                                    ])
                                                // 条件（期間の指定）
                                                    ->whereBetween($table_name . '.uriage', [$past_between_start, $past_between_end])

                                                    //->Where('shouhinkubunbunruimei', '時計中古')

                                                    ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                                        // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
															if($out1_d == "ON"){
	                                                            if($out1_a == "OFF" && $out1_b == "OFF" && $out1_c == "OFF"){
	                                                                $query->Where('baikyakukubun', '<>', 1);
	                                                                $query->Where('baikyakukubun', '<>', 2);
	                                                                $query->Where('baikyakukubun', '<>', 3);
	                                                            } else if($out1_a == "ON" && $out1_b == "OFF" && $out1_c == "OFF"){
	                                                                $query->Where('baikyakukubun', '<>', 2);
	                                                                $query->Where('baikyakukubun', '<>', 3);
	                                                            } else if($out1_a == "OFF" && $out1_b == "ON" && $out1_c == "OFF"){
	                                                                $query->Where('baikyakukubun', '<>', 1);
	                                                                $query->Where('baikyakukubun', '<>', 3);
	                                                            } else if($out1_a == "OFF" && $out1_b == "OFF" && $out1_c == "ON"){
	                                                                $query->Where('baikyakukubun', '<>', 1);
	                                                                $query->Where('baikyakukubun', '<>', 2);
	                                                            } else if($out1_a == "OFF" && $out1_b == "ON" && $out1_c == "ON"){
	                                                                $query->Where('baikyakukubun', '<>', 1);
	                                                            } else if($out1_a == "ON" && $out1_b == "OFF" && $out1_c == "ON"){
	                                                                $query->Where('baikyakukubun', '<>', 2);
	                                                            } else if($out1_a == "ON" && $out1_b == "ON" && $out1_c == "OFF"){
	                                                                $query->Where('baikyakukubun', '<>', 3);
	                                                            }
															} else {
		                                                        // 条件（売上部門が店舗）
		                                                            if($out1_a == "ON"){
		                                                                $query->orWhere('baikyakukubun',1);
		                                                            }
		                                                        // 条件（売上部門が通販）
		                                                            if($out1_b == "ON"){
		                                                                $query->orWhere('baikyakukubun',2);
		                                                            }
		                                                        // 条件（売上部門が卸）
		                                                            if($out1_c == "ON"){
		                                                                $query->orWhere('baikyakukubun',3);
		                                                            }
															}
                                                    
                                                    })


                                                    ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
															// 条件（商品区分分類名が新品）
																if($out2_a == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%新品%");
																}
															// 条件（商品区分分類名が中古）
																if($out2_b == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%中古%");
																}
															// 条件（商品区分分類名がアンティーク）
																if($out2_c == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
																}
															// 条件（商品区分分類名がその他）
																if($out2_d == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%その他%");
																}
															// 条件（商品区分分類名が修理）
																if($out2_e == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%修理%");
																}
                                                    
                                                    })

                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');

															// 条件（通販区分が自社）
																if($out3_a == "ON"){
																	$query->orWhere('tsuuhankubun',1);
																}
															// 条件（通販区分が楽天）
																if($out3_b == "ON"){
																	$query->orWhere('tsuuhankubun',2);
																}
															// 条件（通販区分がヤフー）
																if($out3_c == "ON"){
																	$query->orWhere('tsuuhankubun',3);
																}
															// 条件（通販区分が電話・雑誌）
																if($out3_d == "ON"){
																	$query->orWhere('tsuuhankubun',5);
																}
															// 条件（通販区分がYオークション）
																if($out3_e == "ON"){
																	$query->orWhere('tsuuhankubun',4);
																}
															// 条件（通販区分が修理品返送）
																if($out3_f == "ON"){
																	$query->orWhere('tsuuhankubun',9);
																}

                                                    })
                                                    ->where(function ($query) use ($out4_a,$out4_b) {
															// 条件（免税区分が0:対象外）
																if($out4_a == "ON"){
																	$query->orwhere("menzei","like","%対象外%");
																}
															// 条件（免税区分が1:免税）
																if($out4_b == "ON"){
																	$query->orwhere("menzei","like","%免税%");
																}
                                                    })


                                                // ソート順指定
                                                    ->orderBy('uriage', 'asc')
                                                    ->get();

                                            // クエリビルダスタート2
                                                $i = 0;
                                                foreach ($past_temp5_buys2 as $past_temp5_buy2) {
                                                    // 各月名
                                                        $past_month = $past_temp5_buy2->uriage;
                                                        $past_month = mb_substr($past_month,0,-3);
                                                        $past_brand[$i]= $past_temp5_buy2->brand;
                                                        $past_brandname[$i]= $past_temp5_buy2->brandname;
                                                        $past_bumon[$i]= $past_temp5_buy2->bumonmei;
                                                        $past_uriage[$i]= $past_temp5_buy2->uriagekingaku;
                                                        $past_uriage2[$i]= $past_temp5_buy2->uriagesuu;

                                                            // 現在の月毎ブランド一覧配列を展開
                                                                foreach(${"past_brand_array_" . $past_month} as $past_brand2){
                                                                    $past_brand2 = mb_substr( $past_brand2 , 0 , mb_strpos($past_brand2, "[") );

                                                                    // 月毎のブランド一覧と個別のブランド名が一致した場合
                                                                        if($past_brand2 == $past_brandname[$i]){
                                                                            // 各部門毎の売上変数に売上金額を加算していく
                                                                                if($past_bumon[$i] == "Jackroad"){
                                                                                    ${"past_brand_jack_" . $past_month . "-" . $past_brand[$i]} = (int)${"past_brand_jack_" . $past_month . "-" . $past_brand[$i]} + (int)$past_uriage[$i];
                                                                                    ${"past_brand2_jack_" . $past_month . "-" . $past_brand[$i]} = (int)${"past_brand2_jack_" . $past_month . "-" . $past_brand[$i]} + (int)$past_uriage2[$i];
                                                                                } else if($past_bumon[$i] == "BettyRoad"){
                                                                                    ${"past_brand_betty_" . $past_month . "-" . $past_brand[$i]} = (int)${"past_brand_betty_" . $past_month . "-" . $past_brand[$i]} + (int)$past_uriage[$i];
                                                                                    ${"past_brand2_betty_" . $past_month . "-" . $past_brand[$i]} = (int)${"past_brand2_betty_" . $past_month . "-" . $past_brand[$i]} + (int)$past_uriage2[$i];
                                                                                } else if($past_bumon[$i] == "Jewelry"){
                                                                                    ${"past_brand_jewelry_" . $past_month . "-" . $past_brand[$i]} = (int)${"past_brand_jewelry_" . $past_month . "-" . $past_brand[$i]} + (int)$past_uriage[$i];
                                                                                    ${"past_brand2_jewelry_" . $past_month . "-" . $past_brand[$i]} = (int)${"past_brand2_jewelry_" . $past_month . "-" . $past_brand[$i]} + (int)$past_uriage2[$i];
                                                                                }
        
                                                                        }
                                                                }
    

                                                    $i++;
 
                                         }
//echo $yoy;
//print_r(${"now_brand_array_" . $month});
//print_r($all_now_brand_array);
                                        // 表示HTMLの作成（過去用）
                                            $i = 0;
                                            $all_past_brand_jack_sorce = "";
                                            $all_past_brand2_jack_sorce = "";
                                            $all_past_brand_betty_sorce = "";
                                            $all_past_brand2_betty_sorce = "";
                                            $all_past_brand_jewelry_sorce = "";
                                            $all_past_brand2_jewelry_sorce = "";
                                            $past_temp5_title = "";
                                            $past_brand_sort = array();
                                            $past_brand2_sort = array();
                                            $past_brand_sort_b = array();
                                            $past_brand2_sort_b = array();
                                            $past_brand_sort_jw = array();
                                            $past_brand2_sort_jw = array();
                                            $past_array_end = end($manth_past_array);
                                        // 各月のタイトル表示用HTMLを作成
                                            $past_js_month = "";
                                            foreach($manth_past_array as $past_month){
                                                // JSグラフ用
                                                    $past_js_month .= "'" . $past_month . "(" . date("Y-m", strtotime($past_month. " -" . ($diff_month + 1) . " month")) . ")'" . ",";
                                                // 現在タイトル表示用
                                                    $past_temp5_title .= "<div class='title2 ta_c'>" . $past_month . "</div>";
                                                // 現在月毎ブランド一覧配列を展開
                                                    foreach(${"past_brand_array_" . $past_month} as $past_brand){
                                                        $past_brand_name = mb_substr( $past_brand , 0 , mb_strpos($past_brand, "[") );
                                                        $past_brand_code = mb_strstr($past_brand, '[');
                                                        $past_brand_code = str_replace("[",'',$past_brand_code);
                                                        $past_brand_code = str_replace("]",'',$past_brand_code);

                                                        // 全体ブランドには含まれるが現在ブランドに含まれないブランドの項目を作成
                                                            
                                                            // 売上用
                                                                ${"past_brand_jack_sorce_" . $past_brand_code} .= "<div class='title3 ta_r'>" . number_format((int)${"past_brand_jack_" . $past_month . "-" . $past_brand_code}) . "</div>";
                                                                ${"past_brand_jack_sum_" . $past_brand_code} = (int)${"past_brand_jack_sum_" . $past_brand_code} + (int)${"past_brand_jack_" . $past_month . "-" . $past_brand_code};
                                                                ${"past_brand_jack_js_" . $past_brand_code} .= ${"past_brand_jack_" . $past_month . "-" . $past_brand_code} . ", ";
                                                                ${"past_brand_betty_sorce_" . $past_brand_code} .= "<div class='title3 ta_r'>" . number_format((int)${"past_brand_betty_" . $past_month . "-" . $past_brand_code}) . "</div>";
                                                                ${"past_brand_betty_sum_" . $past_brand_code} = (int)${"past_brand_betty_sum_" . $past_brand_code} + (int)${"past_brand_betty_" . $past_month . "-" . $past_brand_code};
                                                                ${"past_brand_betty_js_" . $past_brand_code} .= ${"past_brand_betty_" . $past_month . "-" . $past_brand_code} . ", ";
                                                                ${"past_brand_jewelry_sorce_" . $past_brand_code} .= "<div class='title3 ta_r'>" . number_format((int)${"past_brand_jewelry_" . $past_month . "-" . $past_brand_code}) . "</div>";
                                                                ${"past_brand_jewelry_sum_" . $past_brand_code} = (int)${"past_brand_jewelry_sum_" . $past_brand_code} + (int)${"past_brand_jewelry_" . $past_month . "-" . $past_brand_code};
                                                                ${"past_brand_jewelry_js_" . $past_brand_code} .= ${"past_brand_jewelry_" . $past_month . "-" . $past_brand_code} . ", ";
                                                            
                                                            // 点数用
                                                                ${"past_brand2_jack_sorce_" . $past_brand_code} .= "<div class='title3 ta_r'>" . number_format((int)${"past_brand2_jack_" . $past_month . "-" . $past_brand_code}) . "</div>";
                                                                ${"past_brand2_jack_sum_" . $past_brand_code} = (int)${"past_brand2_jack_sum_" . $past_brand_code} + (int)${"past_brand2_jack_" . $past_month . "-" . $past_brand_code};
                                                                ${"past_brand2_jack_js_" . $past_brand_code} .= ${"past_brand2_jack_" . $past_month . "-" . $past_brand_code} . ", ";
                                                                ${"past_brand2_betty_sorce_" . $past_brand_code} .= "<div class='title3 ta_r'>" . number_format((int)${"past_brand2_betty_" . $past_month . "-" . $past_brand_code}) . "</div>";
                                                                ${"past_brand2_betty_sum_" . $past_brand_code} = (int)${"past_brand2_betty_sum_" . $past_brand_code} + (int)${"past_brand2_betty_" . $past_month . "-" . $past_brand_code};
                                                                ${"past_brand2_betty_js_" . $past_brand_code} .= ${"past_brand2_betty_" . $past_month . "-" . $past_brand_code} . ", ";
                                                                ${"past_brand2_jewelry_sorce_" . $past_brand_code} .= "<div class='title3 ta_r'>" . number_format((int)${"past_brand2_jewelry_" . $past_month . "-" . $past_brand_code}) . "</div>";
                                                                ${"past_brand2_jewelry_sum_" . $past_brand_code} = (int)${"past_brand2_jewelry_sum_" . $past_brand_code} + (int)${"past_brand2_jewelry_" . $past_month . "-" . $past_brand_code};
                                                                ${"past_brand2_jewelry_js_" . $past_brand_code} .= ${"past_brand2_jewelry_" . $past_month . "-" . $past_brand_code} . ", ";
                                                        // 月毎配列が最後の場合のみの処理（配列へブランド毎の売上合計値を代入するため）   
                                                            if ( $past_month === $past_array_end ) {
                                                                //ブランドナンバーと期間中の売上合計値を配列へ代入
                                                                    // ブランドコードを配列に渡したいが、Keyに数字を入れるとインデックスの要素への代入処理になり順番指定として扱われるので、一旦文字列で代入し、取り出す際に仮で追記した文字列を削除して使用する
                                                                        $past_brand_code2 = "";
                                                                        $past_brand_code2 = $past_brand_code . "_p";
                                                                        $past_brand2_sort[$past_brand_code2] = ${"past_brand2_jack_sum_" . $past_brand_code};
                                                                        $past_brand_sort[$past_brand_code2] = ${"past_brand_jack_sum_" . $past_brand_code};
                                                                        $past_brand2_sort_b[$past_brand_code2] = ${"past_brand2_betty_sum_" . $past_brand_code};
                                                                        $past_brand_sort_b[$past_brand_code2] = ${"past_brand_betty_sum_" . $past_brand_code};
                                                                        $past_brand2_sort_jw[$past_brand_code2] = ${"past_brand2_jewelry_sum_" . $past_brand_code};
                                                                        $past_brand_sort_jw[$past_brand_code2] = ${"past_brand_jewelry_sum_" . $past_brand_code};
                                                                }
                                                    }



                                                // 全体ブランド一覧に存在しないブランドの場合は値が0のソースを追記
                                                    foreach($all_past_brand_array as $past_all_brand){
                                                        $past_brand_code = mb_strstr($past_all_brand, '[');
                                                        $past_brand_code = str_replace("[",'',$past_brand_code);
                                                        $past_brand_code = str_replace("]",'',$past_brand_code);

                                                        if(in_array($past_all_brand,${"past_brand_array_" . $past_month}, true)){
                                                        } else {
                                                            ${"past_brand_jack_sorce_" . $past_brand_code} .= "<div class='title3 ta_r'>0</div>";
                                                            ${"past_brand_jack_js_" . $past_brand_code} .= "0, ";
                                                            ${"past_brand2_jack_sorce_" . $past_brand_code} .= "<div class='title3 ta_r'>0</div>";
                                                            ${"past_brand2_jack_js_" . $past_brand_code} .= "0, ";
                                                            ${"past_brand_betty_sorce_" . $past_brand_code} .= "<div class='title3 ta_r'>0</div>";
                                                            ${"past_brand_betty_js_" . $past_brand_code} .= "0, ";
                                                            ${"past_brand2_betty_sorce_" . $past_brand_code} .= "<div class='title3 ta_r'>0</div>";
                                                            ${"past_brand2_betty_js_" . $past_brand_code} .= "0, ";
                                                            ${"past_brand_jewelry_sorce_" . $past_brand_code} .= "<div class='title3 ta_r'>0</div>";
                                                            ${"past_brand_jewelry_js_" . $past_brand_code} .= "0, ";
                                                            ${"past_brand2_jewelry_sorce_" . $past_brand_code} .= "<div class='title3 ta_r'>0</div>";
                                                            ${"past_brand2_jewelry_js_" . $past_brand_code} .= "0, ";
                                                            // 月毎配列が最後の場合のみの処理        
                                                                if ( $past_month === $past_array_end ) {
                                                                    //ブランドナンバーと期間中の売上合計値を配列へ代入
                                                                        // ブランドコードを配列に渡したいが、Keyに数字を入れるとインデックスの要素への代入処理になり順番指定として扱われるので、一旦文字列で代入し、取り出す際に仮で追記した文字列を削除して使用する
                                                                            $past_brand_code2 = "";
                                                                            $past_brand_code2 = $past_brand_code . "_p";
                                                                            $past_brand2_sort[$past_brand_code2] = ${"past_brand2_jack_sum_" . $past_brand_code};
                                                                            $past_brand_sort[$past_brand_code2] = ${"past_brand_jack_sum_" . $past_brand_code};
                                                                            $past_brand2_sort_b[$past_brand_code2] = ${"past_brand2_betty_sum_" . $past_brand_code};
                                                                            $past_brand_sort_b[$past_brand_code2] = ${"past_brand_betty_sum_" . $past_brand_code};
                                                                            $past_brand2_sort_jw[$past_brand_code2] = ${"past_brand2_jewelry_sum_" . $past_brand_code};
                                                                            $past_brand_sort_jw[$past_brand_code2] = ${"past_brand_jewelry_sum_" . $past_brand_code};
                                                                                        
                                                                }


                                                        }

                                                    }

                                            $i++;
                                            }


                                            // Jack用ブランドを売上降順（売上を代入している値基準）でソートし、各ブランドの行HTMLに追記（売上用）
                                                arsort( $past_brand_sort );
                                                foreach($past_brand_sort as $past_brand_code => $total_value){
                                                    // ブランドコード（数字での順番指定を回避するために適当に追記した文字列を削除して使用）
                                                        $past_brand_code = str_replace('_p', '', $past_brand_code);

                                                        $past_brand_name = "";
                                                        $check_brand_value = "";
                                                        foreach($all_past_brand_array as $all_brand){
                                                            $all_past_brand_name = mb_substr( $all_brand , 0 , mb_strpos($all_brand, "[") );
                                                            $all_brand_no = mb_strstr($all_brand, '[');
                                                            $all_brand_no = str_replace("[",'',$all_brand_no);
                                                            $all_brand_no = str_replace("]",'',$all_brand_no);
                                                            if($all_brand_no == $past_brand_code){$past_brand_name = $all_past_brand_name ;}

                                                        }
                                                        $check_brand_value = $past_brand_code . "[" . $past_brand_name  . "]";
                                                        // 過去ジャック・売上表示の各ブランド毎の行を作成
                                                            ${"past_brand_jack_sorce_" . $past_brand_code} = "<div class='wid100 ul1b_past'><div class='title1 ta_c'>" . $past_brand_name . "</div>" . ${"past_brand_jack_sorce_" . $past_brand_code}  . "<div class='title4 ta_r'>" . number_format((int)${"past_brand_jack_sum_" . $past_brand_code}) . "</div></div>";
                                                        
                                                        // 合計値が0でないブランドのみソースを追記
                                                            if(${"past_brand_jack_sum_" . $past_brand_code} <> 0){
                                                                $all_past_brand_jack_sorce .= ${"past_brand_jack_sorce_" . $past_brand_code};
                                                            }

                                                }


                                            // Jack用ブランドを売上降順（売上を代入している値基準）でソートし、各ブランドの行HTMLに追記（点数用）
                                                arsort( $past_brand2_sort );
                                                foreach($past_brand2_sort as $past_brand_code => $total_value){
                                                    // ブランドコード（数字での順番指定を回避するために適当に追記した文字列を削除して使用）
                                                        $past_brand_code = str_replace('_p', '', $past_brand_code);

                                                        $past_brand_name = "";
                                                        $check_brand_value = "";
                                                        foreach($all_past_brand_array as $all_brand){
                                                            $all_past_brand_name = mb_substr( $all_brand , 0 , mb_strpos($all_brand, "[") );
                                                            $all_brand_no = mb_strstr($all_brand, '[');
                                                            $all_brand_no = str_replace("[",'',$all_brand_no);
                                                            $all_brand_no = str_replace("]",'',$all_brand_no);
                                                            if($all_brand_no == $past_brand_code){$past_brand_name = $all_past_brand_name ;}

                                                        }
                                                        $check_brand_value = $past_brand_code . "[" . $past_brand_name  . "]";
                                                        // 過去ジャック・点数表示の各ブランド毎の行を作成
                                                            ${"past_brand2_jack_sorce_" . $past_brand_code} = "<div class='wid100 ul1b_past'><div class='title1 ta_c'>" . $past_brand_name . "</div>" . ${"past_brand2_jack_sorce_" . $past_brand_code}  . "<div class='title4 ta_r'>" . number_format((int)${"past_brand2_jack_sum_" . $past_brand_code}) . "</div></div>";
                                                        
                                                        // 合計値が0でないブランドのみソースを追記
                                                            if(${"past_brand2_jack_sum_" . $past_brand_code} <> 0){
                                                                $all_past_brand2_jack_sorce .= ${"past_brand2_jack_sorce_" . $past_brand_code};
                                                            }
                                                }

                                            // Betty用ブランドを売上降順（売上を代入している値基準）でソートし、各ブランドの行HTMLに追記（売上用）
                                                arsort( $past_brand_sort_b );
                                                foreach($past_brand_sort_b as $past_brand_code => $total_value){
                                                    // ブランドコード（数字での順番指定を回避するために適当に追記した文字列を削除して使用）
                                                        $past_brand_code = str_replace('_p', '', $past_brand_code);

                                                        $past_brand_name = "";
                                                        $check_brand_value = "";
                                                        foreach($all_past_brand_array as $all_brand){
                                                            $all_past_brand_name = mb_substr( $all_brand , 0 , mb_strpos($all_brand, "[") );
                                                            $all_brand_no = mb_strstr($all_brand, '[');
                                                            $all_brand_no = str_replace("[",'',$all_brand_no);
                                                            $all_brand_no = str_replace("]",'',$all_brand_no);
                                                            if($all_brand_no == $past_brand_code){$past_brand_name = $all_past_brand_name ;}

                                                        }
                                                        $check_brand_value = $past_brand_code . "[" . $past_brand_name  . "]";
                                                        // 過去ベティー・売上表示の各ブランド毎の行を作成
                                                            ${"past_brand_betty_sorce_" . $past_brand_code} = "<div class='wid100 ul1b_past'><div class='title1 ta_c'>" . $past_brand_name . "</div>" . ${"past_brand_betty_sorce_" . $past_brand_code}  . "<div class='title4 ta_r'>" . number_format((int)${"past_brand_betty_sum_" . $past_brand_code}) . "</div></div>";
                                                        
                                                        // 合計値が0でないブランドのみソースを追記
                                                            if(${"past_brand_betty_sum_" . $past_brand_code} <> 0){
                                                                $all_past_brand_betty_sorce .= ${"past_brand_betty_sorce_" . $past_brand_code};
                                                            }

                                                }


                                            // Betty用ブランドを売上降順（売上を代入している値基準）でソートし、各ブランドの行HTMLに追記（点数用）
                                                arsort( $past_brand2_sort_b );
                                                foreach($past_brand2_sort_b as $past_brand_code => $total_value){
                                                    // ブランドコード（数字での順番指定を回避するために適当に追記した文字列を削除して使用）
                                                        $past_brand_code = str_replace('_p', '', $past_brand_code);

                                                        $past_brand_name = "";
                                                        $check_brand_value = "";
                                                        foreach($all_past_brand_array as $all_brand){
                                                            $all_past_brand_name = mb_substr( $all_brand , 0 , mb_strpos($all_brand, "[") );
                                                            $all_brand_no = mb_strstr($all_brand, '[');
                                                            $all_brand_no = str_replace("[",'',$all_brand_no);
                                                            $all_brand_no = str_replace("]",'',$all_brand_no);
                                                            if($all_brand_no == $past_brand_code){$past_brand_name = $all_past_brand_name ;}

                                                        }
                                                        $check_brand_value = $past_brand_code . "[" . $past_brand_name  . "]";
                                                        // 過去ベティー・点数表示の各ブランド毎の行を作成
                                                            ${"past_brand2_betty_sorce_" . $past_brand_code} = "<div class='wid100 ul1b_past'><div class='title1 ta_c'>" . $past_brand_name . "</div>" . ${"past_brand2_betty_sorce_" . $past_brand_code}  . "<div class='title4 ta_r'>" . number_format((int)${"past_brand2_betty_sum_" . $past_brand_code}) . "</div></div>";
                                                        
                                                        // 合計値が0でないブランドのみソースを追記
                                                            if(${"past_brand2_betty_sum_" . $past_brand_code} <> 0){
                                                                $all_past_brand2_betty_sorce .= ${"past_brand2_betty_sorce_" . $past_brand_code};
                                                            }
                                                }


                                            // Jewelry用ブランドを売上降順（売上を代入している値基準）でソートし、各ブランドの行HTMLに追記（売上用）
                                                arsort( $past_brand_sort_jw );
                                                foreach($past_brand_sort_jw as $past_brand_code => $total_value){
                                                    // ブランドコード（数字での順番指定を回避するために適当に追記した文字列を削除して使用）
                                                        $past_brand_code = str_replace('_p', '', $past_brand_code);

                                                        $past_brand_name = "";
                                                        $check_brand_value = "";
                                                        foreach($all_past_brand_array as $all_brand){
                                                            $all_past_brand_name = mb_substr( $all_brand , 0 , mb_strpos($all_brand, "[") );
                                                            $all_brand_no = mb_strstr($all_brand, '[');
                                                            $all_brand_no = str_replace("[",'',$all_brand_no);
                                                            $all_brand_no = str_replace("]",'',$all_brand_no);
                                                            if($all_brand_no == $past_brand_code){$past_brand_name = $all_past_brand_name ;}

                                                        }
                                                        $check_brand_value = $past_brand_code . "[" . $past_brand_name  . "]";
                                                        // 過去ジュエリー・売上表示の各ブランド毎の行を作成
                                                            ${"past_brand_jewelry_sorce_" . $past_brand_code} = "<div class='wid100 ul1b_past'><div class='title1 ta_c'>" . $past_brand_name . "</div>" . ${"past_brand_jewelry_sorce_" . $past_brand_code}  . "<div class='title4 ta_r'>" . number_format((int)${"past_brand_jewelry_sum_" . $past_brand_code}) . "</div></div>";
                                                        
                                                        // 合計値が0でないブランドのみソースを追記
                                                            if(${"past_brand_jewelry_sum_" . $past_brand_code} <> 0){
                                                                $all_past_brand_jewelry_sorce .= ${"past_brand_jewelry_sorce_" . $past_brand_code};
                                                            }

                                                }


                                            // Jewelry用ブランドを売上降順（売上を代入している値基準）でソートし、各ブランドの行HTMLに追記（点数用）
                                                arsort( $past_brand2_sort_jw );
                                                foreach($past_brand2_sort_jw as $past_brand_code => $total_value){
                                                    // ブランドコード（数字での順番指定を回避するために適当に追記した文字列を削除して使用）
                                                        $past_brand_code = str_replace('_p', '', $past_brand_code);

                                                        $past_brand_name = "";
                                                        $check_brand_value = "";
                                                        foreach($all_past_brand_array as $all_brand){
                                                            $all_past_brand_name = mb_substr( $all_brand , 0 , mb_strpos($all_brand, "[") );
                                                            $all_brand_no = mb_strstr($all_brand, '[');
                                                            $all_brand_no = str_replace("[",'',$all_brand_no);
                                                            $all_brand_no = str_replace("]",'',$all_brand_no);
                                                            if($all_brand_no == $past_brand_code){$past_brand_name = $all_past_brand_name ;}

                                                        }
                                                        $check_brand_value = $past_brand_code . "[" . $past_brand_name  . "]";
                                                        // 過去ジュエリー・点数表示の各ブランド毎の行を作成
                                                            ${"past_brand2_jewelry_sorce_" . $past_brand_code} = "<div class='wid100 ul1b_past'><div class='title1 ta_c'>" . $past_brand_name . "</div>" . ${"past_brand2_jewelry_sorce_" . $past_brand_code}  . "<div class='title4 ta_r'>" . number_format((int)${"past_brand2_jewelry_sum_" . $past_brand_code}) . "</div></div>";
                                                        
                                                        // 合計値が0でないブランドのみソースを追記
                                                            if(${"past_brand2_jewelry_sum_" . $past_brand_code} <> 0){
                                                                $all_past_brand2_jewelry_sorce .= ${"past_brand2_jewelry_sorce_" . $past_brand_code};
                                                            }
                                                }



                                            $past_temp5_title = "<div class='box1'><div class='wid100 ul2'><div class='title5 ta_c'>" . $past_between_start_view . "～<br>" . $past_between_end_view . "</div>" . $past_temp5_title . "<div class='title6 ta_c'>累計</div></div>";

                                            $all_past_brand_jack_sorce = "<p class='title_b'>過去・Jackブランド別売上</p>" . $past_temp5_title . "<div class='brand_list'>" . $all_past_brand_jack_sorce . "</div></div>";
                                            $all_past_brand2_jack_sorce = "<p class='title_b'>過去・Jackブランド別点数</p>" . $past_temp5_title . "<div class='brand_list'>" . $all_past_brand2_jack_sorce . "</div></div>";
                                            $all_past_brand_betty_sorce = "<p class='title_b'>過去・Bettyブランド別売上</p>" . $past_temp5_title . "<div class='brand_list_b'>" . $all_past_brand_betty_sorce . "</div></div>";
                                            $all_past_brand2_betty_sorce = "<p class='title_b'>過去・Bettyブランド別点数</p>" . $past_temp5_title . "<div class='brand_list_b'>" . $all_past_brand2_betty_sorce . "</div></div>";
                                            $all_past_brand_jewelry_sorce = "<p class='title_b'>過去・Jewelryブランド別売上</p>" . $past_temp5_title . "<div class='brand_list_jw'>" . $all_past_brand_jewelry_sorce . "</div></div>";
                                            $all_past_brand2_jewelry_sorce = "<p class='title_b'>過去・Jewelryブランド別点数</p>" . $past_temp5_title . "<div class='brand_list_jw'>" . $all_past_brand2_jewelry_sorce . "</div></div>";
                                        }

                        // 列の横幅を列数によって可変させる
                        //$line_width = 100 / ($diff_month + 3);
                        $line_width = 100 / ($diff_month + 2);
                        if($brandselect <> ""){
                            $i = 0;
                            foreach($brandselect as $view_brand){
                                
                                $view_brand_code[$i] = mb_substr( $view_brand , 0 , mb_strpos($view_brand, "[") );
                                $view_brand_name[$i] = mb_strstr($view_brand, '[');
                                $view_brand_name[$i] = str_replace("[",'',$view_brand_name[$i]);
                                $view_brand_name[$i] = str_replace("]",'',$view_brand_name[$i]);

                                // 過去用・ブランド名は現在と同じ変数を使用
                                $past_view_brand_name[$i] = mb_strstr($view_brand, '[');
                                $past_view_brand_name[$i] = str_replace("[",'',$past_view_brand_name[$i]);
                                $past_view_brand_name[$i] = str_replace("]",'',$past_view_brand_name[$i]);


                            $i++;
                            }
                        }
                        if($brandselect_b <> ""){
                            $i = 0;
                            foreach($brandselect_b as $view_brand){
                                
                                $view_brand_code_b[$i] = mb_substr( $view_brand , 0 , mb_strpos($view_brand, "[") );
                                $view_brand_name_b[$i] = mb_strstr($view_brand, '[');
                                $view_brand_name_b[$i] = str_replace("[",'',$view_brand_name_b[$i]);
                                $view_brand_name_b[$i] = str_replace("]",'',$view_brand_name_b[$i]);

                                // 過去用・ブランド名は現在と同じ変数を使用
                                $past_view_brand_name_b[$i] = mb_strstr($view_brand, '[');
                                $past_view_brand_name_b[$i] = str_replace("[",'',$past_view_brand_name_b[$i]);
                                $past_view_brand_name_b[$i] = str_replace("]",'',$past_view_brand_name_b[$i]);


                            $i++;
                            }
                        }
                        if($brandselect_jw <> ""){
                            $i = 0;
                            foreach($brandselect_jw as $view_brand){
                                
                                $view_brand_code_jw[$i] = mb_substr( $view_brand , 0 , mb_strpos($view_brand, "[") );
                                $view_brand_name_jw[$i] = mb_strstr($view_brand, '[');
                                $view_brand_name_jw[$i] = str_replace("[",'',$view_brand_name_jw[$i]);
                                $view_brand_name_jw[$i] = str_replace("]",'',$view_brand_name_jw[$i]);

                                // 過去用・ブランド名は現在と同じ変数を使用
                                $past_view_brand_name_jw[$i] = mb_strstr($view_brand, '[');
                                $past_view_brand_name_jw[$i] = str_replace("[",'',$past_view_brand_name_jw[$i]);
                                $past_view_brand_name_jw[$i] = str_replace("]",'',$past_view_brand_name_jw[$i]);


                            $i++;
                            }
                        }


/********************************************************************************************* */
//過去用 END
/********************************************************************************************* */






/********************************************************************************************* */
//現在用 START
/********************************************************************************************* */


                                   /************************************************************************************************************************************************************************************************************* */
                                        // 月ごとのブランドのみ取得し配列化
                                    /************************************************************************************************************************************************************************************************************* */
                                            
                                            // 現在全期間全ブランド一覧
                                                $all_now_brand_array = array();

                                            // DB検索（月ごとのブランドのみ取得し配列化用）スタート
                                                $temp5_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        $table_name . '.uriage',
                                                        $table_name . '.brandname',
                                                        $table_name . '.brand',
                                                        $table_name . '.baikyakukubun',
                                                        $table_name . '.shouhinkubunbunruimei',
                                                        $table_name . '.tsuuhankubun',
                                                        $table_name . '.menzei',
                                                    ])
                                                // 条件（期間の指定）
                                                    ->whereBetween($table_name . '.uriage', [$between_start, $between_end])

                                                    //->Where('shouhinkubunbunruimei', '時計中古')


                                                    ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                                        // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
															if($out1_d == "ON"){
	                                                            if($out1_a == "OFF" && $out1_b == "OFF" && $out1_c == "OFF"){
	                                                                $query->Where('baikyakukubun', '<>', 1);
	                                                                $query->Where('baikyakukubun', '<>', 2);
	                                                                $query->Where('baikyakukubun', '<>', 3);
	                                                            } else if($out1_a == "ON" && $out1_b == "OFF" && $out1_c == "OFF"){
	                                                                $query->Where('baikyakukubun', '<>', 2);
	                                                                $query->Where('baikyakukubun', '<>', 3);
	                                                            } else if($out1_a == "OFF" && $out1_b == "ON" && $out1_c == "OFF"){
	                                                                $query->Where('baikyakukubun', '<>', 1);
	                                                                $query->Where('baikyakukubun', '<>', 3);
	                                                            } else if($out1_a == "OFF" && $out1_b == "OFF" && $out1_c == "ON"){
	                                                                $query->Where('baikyakukubun', '<>', 1);
	                                                                $query->Where('baikyakukubun', '<>', 2);
	                                                            } else if($out1_a == "OFF" && $out1_b == "ON" && $out1_c == "ON"){
	                                                                $query->Where('baikyakukubun', '<>', 1);
	                                                            } else if($out1_a == "ON" && $out1_b == "OFF" && $out1_c == "ON"){
	                                                                $query->Where('baikyakukubun', '<>', 2);
	                                                            } else if($out1_a == "ON" && $out1_b == "ON" && $out1_c == "OFF"){
	                                                                $query->Where('baikyakukubun', '<>', 3);
	                                                            }
															} else {
		                                                        // 条件（売上部門が店舗）
		                                                            if($out1_a == "ON"){
		                                                                $query->orWhere('baikyakukubun',1);
		                                                            }
		                                                        // 条件（売上部門が通販）
		                                                            if($out1_b == "ON"){
		                                                                $query->orWhere('baikyakukubun',2);
		                                                            }
		                                                        // 条件（売上部門が卸）
		                                                            if($out1_c == "ON"){
		                                                                $query->orWhere('baikyakukubun',3);
		                                                            }
															}
                                                    
                                                    })


                                                    ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
															// 条件（商品区分分類名が新品）
																if($out2_a == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%新品%");
																}
															// 条件（商品区分分類名が中古）
																if($out2_b == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%中古%");
																}
															// 条件（商品区分分類名がアンティーク）
																if($out2_c == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
																}
															// 条件（商品区分分類名がその他）
																if($out2_d == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%その他%");
																}
															// 条件（商品区分分類名が修理）
																if($out2_e == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%修理%");
																}
                                                    
                                                    })

                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');

															// 条件（通販区分が自社）
																if($out3_a == "ON"){
																	$query->orWhere('tsuuhankubun',1);
																}
															// 条件（通販区分が楽天）
																if($out3_b == "ON"){
																	$query->orWhere('tsuuhankubun',2);
																}
															// 条件（通販区分がヤフー）
																if($out3_c == "ON"){
																	$query->orWhere('tsuuhankubun',3);
																}
															// 条件（通販区分が電話・雑誌）
																if($out3_d == "ON"){
																	$query->orWhere('tsuuhankubun',5);
																}
															// 条件（通販区分がYオークション）
																if($out3_e == "ON"){
																	$query->orWhere('tsuuhankubun',4);
																}
															// 条件（通販区分が修理品返送）
																if($out3_f == "ON"){
																	$query->orWhere('tsuuhankubun',9);
																}
                                                    })

                                                    ->where(function ($query) use ($out4_a,$out4_b) {
															// 条件（免税区分が0:対象外）
																if($out4_a == "ON"){
																	$query->orwhere("menzei","like","%対象外%");
																}
															// 条件（免税区分が1:免税）
																if($out4_b == "ON"){
																	$query->orwhere("menzei","like","%免税%");
																}
                                                    })


                                                // ソート順指定
                                                    ->orderBy('uriage', 'asc')
                                                    ->get();
                                            // 月毎の全ブランド名を格納するための変数を作成
                                                foreach($manth_now_array as $month){
                                                    // 月毎の全ブランド名格納用
                                                        ${"now_brand_array_" . $month} = array();
                                                       // ${"now_brand2_array_" . $month} = array();
                                                }

                                            // クエリビルダスタート
                                                $i = 0;
                                                foreach ($temp5_buys as $temp5_buy) {

                                                    // 各月名
                                                        $month = $temp5_buy->uriage;
                                                        $month = mb_substr($month,0,-3);
                                                    // 個別ブランド番号
                                                        $temp5_brand_no[$i]= $temp5_buy->brand;
                                                    // 個別ブランド名
                                                        $temp5_brand[$i]= $temp5_buy->brandname;
                                                        

                                                            // 現在全期間全ブランド一覧用配列にブランドをセット
                                                                if(in_array($temp5_brand[$i] . "[" . $temp5_brand_no[$i] . "]",$all_now_brand_array, true)){
                                                                } else {
                                                                    if($temp5_brand[$i] != "" && $temp5_brand[$i] != "不明"){
                                                                        array_push($all_now_brand_array,$temp5_brand[$i] . "[" . $temp5_brand_no[$i] . "]");
                                                                    }
                                                                }
                                                            
                                                            // 各月の全ブランド配列に含まれていない場合のみ個別ブランド名を配列にセット
                                                                if(in_array($temp5_brand[$i] . "[" . $temp5_brand_no[$i] . "]",${"now_brand_array_" . $month}, true)){
                                                                } else {
                                                                    // 月毎の全ブランドを配列へ代入
                                                                        if($temp5_brand[$i] != "" && $temp5_brand[$i] != "不明"){
                                                                            array_push(${"now_brand_array_" . $month},$temp5_brand[$i] . "[" . $temp5_brand_no[$i] . "]");
                                                                        }
                                                                    // 月毎のブランド毎の売上を代入するための変数名作成（変数名を変える事で全ブランド毎の変数を作成）
                                                                        ${"now_brand_jack_" . $month . "-" . $temp5_brand_no[$i]} = 0;
                                                                        ${"now_brand_betty_" . $month . "-" . $temp5_brand_no[$i]} = 0;
                                                                        ${"now_brand_jewelry_" . $month . "-" . $temp5_brand_no[$i]} = 0;
                                                                        ${"now_brand_jack_sum_" . $temp5_brand_no[$i]} = 0;
                                                                        ${"now_brand_betty_sum_" . $temp5_brand_no[$i]} = 0;
                                                                        ${"now_brand_jewelry_sum_" . $temp5_brand_no[$i]} = 0;
                                                                    // 月毎のブランド毎の売上用HTMLの変数名作成（変数名を変える事で全ブランド毎の変数を作成）
                                                                        ${"now_brand_jack_sorce_" . $temp5_brand_no[$i]} = "";
                                                                        ${"now_brand_betty_sorce_" . $temp5_brand_no[$i]} = "";
                                                                        ${"now_brand_jewelry_sorce_" . $temp5_brand_no[$i]} = "";
                                                                        ${"now_brand_jack_js_" . $temp5_brand_no[$i]} = "";
                                                                        ${"now_brand_betty_js_" . $temp5_brand_no[$i]} = "";
                                                                        ${"now_brand_jewelry_js_" . $temp5_brand_no[$i]} = "";
                                                                        
                                                                    // 月毎のブランド毎の売上点数を代入するための変数名作成（変数名を変える事で全ブランド毎の変数を作成）
                                                                        ${"now_brand2_jack_" . $month . "-" . $temp5_brand_no[$i]} = 0;
                                                                        ${"now_brand2_betty_" . $month . "-" . $temp5_brand_no[$i]} = 0;
                                                                        ${"now_brand2_jewelry_" . $month . "-" . $temp5_brand_no[$i]} = 0;
                                                                        ${"now_brand2_jack_sum_" . $temp5_brand_no[$i]} = 0;
                                                                        ${"now_brand2_betty_sum_" . $temp5_brand_no[$i]} = 0;
                                                                        ${"now_brand2_jewelry_sum_" . $temp5_brand_no[$i]} = 0;
                                                                    // 月毎のブランド毎の売上点数用HTMLの変数名作成（変数名を変える事で全ブランド毎の変数を作成）
                                                                        ${"now_brand2_jack_sorce_" . $temp5_brand_no[$i]} = "";
                                                                        ${"now_brand2_betty_sorce_" . $temp5_brand_no[$i]} = "";
                                                                        ${"now_brand2_jewelry_sorce_" . $temp5_brand_no[$i]} = "";
                                                                        ${"now_brand2_jack_js_" . $temp5_brand_no[$i]} = "";
                                                                        ${"now_brand2_betty_js_" . $temp5_brand_no[$i]} = "";
                                                                        ${"now_brand2_jewelry_js_" . $temp5_brand_no[$i]} = "";
                                                                        
                                                                }
                                                                


                                                    $i++;
                                                }


                                    /************************************************************************************************************************************************************************************************************* */
                                        // 月ごとにブランドや部門別のデータを作成
                                    /************************************************************************************************************************************************************************************************************* */
                                                

                                        // DB検索（月ごとのブランドのみ取得し配列化用）スタート
                                                $temp5_buys2 = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        $table_name . '.bumonmei',
                                                        $table_name . '.brand',
                                                        $table_name . '.brandname',
                                                        $table_name . '.uriagekingaku',
                                                        $table_name . '.uriage',
                                                        $table_name . '.uriagesuu',
                                                        $table_name . '.baikyakukubun',
                                                        $table_name . '.shouhinkubunbunruimei',
                                                        $table_name . '.tsuuhankubun',
                                                        $table_name . '.menzei',
                                                    ])
                                                // 条件（期間の指定）
                                                    ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                    //->Where('shouhinkubunbunruimei', '時計中古')


                                                    ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                                        // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
															if($out1_d == "ON"){
	                                                            if($out1_a == "OFF" && $out1_b == "OFF" && $out1_c == "OFF"){
	                                                                $query->Where('baikyakukubun', '<>', 1);
	                                                                $query->Where('baikyakukubun', '<>', 2);
	                                                                $query->Where('baikyakukubun', '<>', 3);
	                                                            } else if($out1_a == "ON" && $out1_b == "OFF" && $out1_c == "OFF"){
	                                                                $query->Where('baikyakukubun', '<>', 2);
	                                                                $query->Where('baikyakukubun', '<>', 3);
	                                                            } else if($out1_a == "OFF" && $out1_b == "ON" && $out1_c == "OFF"){
	                                                                $query->Where('baikyakukubun', '<>', 1);
	                                                                $query->Where('baikyakukubun', '<>', 3);
	                                                            } else if($out1_a == "OFF" && $out1_b == "OFF" && $out1_c == "ON"){
	                                                                $query->Where('baikyakukubun', '<>', 1);
	                                                                $query->Where('baikyakukubun', '<>', 2);
	                                                            } else if($out1_a == "OFF" && $out1_b == "ON" && $out1_c == "ON"){
	                                                                $query->Where('baikyakukubun', '<>', 1);
	                                                            } else if($out1_a == "ON" && $out1_b == "OFF" && $out1_c == "ON"){
	                                                                $query->Where('baikyakukubun', '<>', 2);
	                                                            } else if($out1_a == "ON" && $out1_b == "ON" && $out1_c == "OFF"){
	                                                                $query->Where('baikyakukubun', '<>', 3);
	                                                            }
															} else {
		                                                        // 条件（売上部門が店舗）
		                                                            if($out1_a == "ON"){
		                                                                $query->orWhere('baikyakukubun',1);
		                                                            }
		                                                        // 条件（売上部門が通販）
		                                                            if($out1_b == "ON"){
		                                                                $query->orWhere('baikyakukubun',2);
		                                                            }
		                                                        // 条件（売上部門が卸）
		                                                            if($out1_c == "ON"){
		                                                                $query->orWhere('baikyakukubun',3);
		                                                            }
															}
                                                    
                                                    })

                                                    ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
															// 条件（商品区分分類名が新品）
																if($out2_a == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%新品%");
																}
															// 条件（商品区分分類名が中古）
																if($out2_b == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%中古%");
																}
															// 条件（商品区分分類名がアンティーク）
																if($out2_c == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
																}
															// 条件（商品区分分類名がその他）
																if($out2_d == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%その他%");
																}
															// 条件（商品区分分類名が修理）
																if($out2_e == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%修理%");
																}
                                                    
                                                    })

                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');

															// 条件（通販区分が自社）
																if($out3_a == "ON"){
																	$query->orWhere('tsuuhankubun',1);
																}
															// 条件（通販区分が楽天）
																if($out3_b == "ON"){
																	$query->orWhere('tsuuhankubun',2);
																}
															// 条件（通販区分がヤフー）
																if($out3_c == "ON"){
																	$query->orWhere('tsuuhankubun',3);
																}
															// 条件（通販区分が電話・雑誌）
																if($out3_d == "ON"){
																	$query->orWhere('tsuuhankubun',5);
																}
															// 条件（通販区分がYオークション）
																if($out3_e == "ON"){
																	$query->orWhere('tsuuhankubun',4);
																}
															// 条件（通販区分が修理品返送）
																if($out3_f == "ON"){
																	$query->orWhere('tsuuhankubun',9);
																}
                                                    
                                                    })

                                                    ->where(function ($query) use ($out4_a,$out4_b) {
															// 条件（免税区分が0:対象外）
																if($out4_a == "ON"){
																	$query->orwhere("menzei","like","%対象外%");
																}
															// 条件（免税区分が1:免税）
																if($out4_b == "ON"){
																	$query->orwhere("menzei","like","%免税%");
																}
                                                    })
                                                    

                                                // ソート順指定
                                                    ->orderBy('uriage', 'asc')
                                                    ->get();

                                            // クエリビルダスタート
                                                $i = 0;
                                                foreach ($temp5_buys2 as $temp5_buy2) {
                                                    // 各月名
                                                        $month = $temp5_buy2->uriage;
                                                        $month = mb_substr($month,0,-3);
                                                        $brand[$i]= $temp5_buy2->brand;
                                                        $brandname[$i]= $temp5_buy2->brandname;
                                                        $bumon[$i]= $temp5_buy2->bumonmei;
                                                        $uriage[$i]= $temp5_buy2->uriagekingaku;
                                                        $uriage2[$i]= $temp5_buy2->uriagesuu;
                                                        //echo $uriage[$i] . "(" . $uriage2[$i] . ")(" . $brandname[$i] . ")<br>";

                                                            // 現在の月毎ブランド一覧配列を展開
                                                                foreach(${"now_brand_array_" . $month} as $brand2){
                                                                    $brand2 = mb_substr( $brand2 , 0 , mb_strpos($brand2, "[") );
                                                                    // 月毎のブランド一覧と個別のブランド名が一致した場合
                                                                        if($brand2 == $brandname[$i]){
                                                                            // 各部門毎の売上変数に売上金額を加算していく
                                                                                if($bumon[$i] == "Jackroad"){
                                                                                    ${"now_brand_jack_" . $month . "-" . $brand[$i]} = (int)${"now_brand_jack_" . $month . "-" . $brand[$i]} + (int)$uriage[$i];
                                                                                    ${"now_brand2_jack_" . $month . "-" . $brand[$i]} = (int)${"now_brand2_jack_" . $month . "-" . $brand[$i]} + (int)$uriage2[$i];
                                                                                } else if($bumon[$i] == "BettyRoad"){
                                                                                    ${"now_brand_betty_" . $month . "-" . $brand[$i]} = (int)${"now_brand_betty_" . $month . "-" . $brand[$i]} + (int)$uriage[$i];
                                                                                    ${"now_brand2_betty_" . $month . "-" . $brand[$i]} = (int)${"now_brand2_betty_" . $month . "-" . $brand[$i]} + (int)$uriage2[$i];
                                                                                } else if($bumon[$i] == "Jewelry"){
                                                                                    ${"now_brand_jewelry_" . $month . "-" . $brand[$i]} = (int)${"now_brand_jewelry_" . $month . "-" . $brand[$i]} + (int)$uriage[$i];
                                                                                    ${"now_brand2_jewelry_" . $month . "-" . $brand[$i]} = (int)${"now_brand2_jewelry_" . $month . "-" . $brand[$i]} + (int)$uriage2[$i];
                                                                                }
            
                                                                        }

                                                                }


                                                    $i++;
 
                                         }


                                        // 表示HTMLの作成（現在用）
                                            $i = 0;
                                            $all_now_brand_jack_sorce = "";
                                            $all_now_brand2_jack_sorce = "";
                                            $all_now_brand_betty_sorce = "";
                                            $all_now_brand2_betty_sorce = "";
                                            $all_now_brand_jewelry_sorce = "";
                                            $all_now_brand2_jewelry_sorce = "";
                                            $now_temp5_title = "";
                                            $brand_sort = array();
                                            $brand2_sort = array();
                                            $brand_sort_b = array();
                                            $brand2_sort_b = array();
                                            $brand_sort_jw = array();
                                            $brand2_sort_jw = array();
                                            $array_end = end($manth_now_array);

                                        // 各月のタイトル表示用HTMLを作成
                                            $js_month = "";
                                            foreach($manth_now_array as $month){
                                                // JSグラフ用
                                                    $js_month .= "'" . $month . "(" . date("Y-m", strtotime($month. " -" . ($diff_month + 1) . " month")) . ")'" . ",";
                                                
                                                // 現在タイトル表示用
                                                    $now_temp5_title .= "<div class='title2 ta_c'>" . $month . "</div>";
                                                // 現在月毎ブランド一覧配列を展開
                                                    foreach(${"now_brand_array_" . $month} as $brand){

                                                        $brand_name = mb_substr( $brand , 0 , mb_strpos($brand, "[") );
                                                        $brand_code = mb_strstr($brand, '[');
                                                        $brand_code = str_replace("[",'',$brand_code);
                                                        $brand_code = str_replace("]",'',$brand_code);

                                                        // 全体ブランドには含まれるが現在ブランドに含まれないブランドの項目を作成
                                                            // 売上用
                                                                ${"now_brand_jack_sorce_" . $brand_code} .= "<div class='title3 ta_r'>" . number_format((int)${"now_brand_jack_" . $month . "-" . $brand_code}) . "</div>";
                                                                ${"now_brand_jack_sum_" . $brand_code} = (int)${"now_brand_jack_sum_" . $brand_code} + (int)${"now_brand_jack_" . $month . "-" . $brand_code};
                                                                ${"now_brand_jack_js_" . $brand_code} .= ${"now_brand_jack_" . $month . "-" . $brand_code} . ", ";
                                                                ${"now_brand_betty_sorce_" . $brand_code} .= "<div class='title3 ta_r'>" . number_format((int)${"now_brand_betty_" . $month . "-" . $brand_code}) . "</div>";
                                                                ${"now_brand_betty_sum_" . $brand_code} = (int)${"now_brand_betty_sum_" . $brand_code} + (int)${"now_brand_betty_" . $month . "-" . $brand_code};
                                                                ${"now_brand_betty_js_" . $brand_code} .= ${"now_brand_betty_" . $month . "-" . $brand_code} . ", ";
                                                                ${"now_brand_jewelry_sorce_" . $brand_code} .= "<div class='title3 ta_r'>" . number_format((int)${"now_brand_jewelry_" . $month . "-" . $brand_code}) . "</div>";
                                                                ${"now_brand_jewelry_sum_" . $brand_code} = (int)${"now_brand_jewelry_sum_" . $brand_code} + (int)${"now_brand_jewelry_" . $month . "-" . $brand_code};
                                                                ${"now_brand_jewelry_js_" . $brand_code} .= ${"now_brand_jewelry_" . $month . "-" . $brand_code} . ", ";
                                                            // 点数用
                                                                ${"now_brand2_jack_sorce_" . $brand_code} .= "<div class='title3 ta_r'>" . number_format((int)${"now_brand2_jack_" . $month . "-" . $brand_code}) . "</div>";
                                                                ${"now_brand2_jack_sum_" . $brand_code} = (int)${"now_brand2_jack_sum_" . $brand_code} + (int)${"now_brand2_jack_" . $month . "-" . $brand_code};
                                                                ${"now_brand2_jack_js_" . $brand_code} .= ${"now_brand2_jack_" . $month . "-" . $brand_code} . ", ";
                                                                ${"now_brand2_betty_sorce_" . $brand_code} .= "<div class='title3 ta_r'>" . number_format((int)${"now_brand2_betty_" . $month . "-" . $brand_code}) . "</div>";
                                                                ${"now_brand2_betty_sum_" . $brand_code} = (int)${"now_brand2_betty_sum_" . $brand_code} + (int)${"now_brand2_betty_" . $month . "-" . $brand_code};
                                                                ${"now_brand2_betty_js_" . $brand_code} .= ${"now_brand2_betty_" . $month . "-" . $brand_code} . ", ";
                                                                ${"now_brand2_jewelry_sorce_" . $brand_code} .= "<div class='title3 ta_r'>" . number_format((int)${"now_brand2_jewelry_" . $month . "-" . $brand_code}) . "</div>";
                                                                ${"now_brand2_jewelry_sum_" . $brand_code} = (int)${"now_brand2_jewelry_sum_" . $brand_code} + (int)${"now_brand2_jewelry_" . $month . "-" . $brand_code};
                                                                ${"now_brand2_jewelry_js_" . $brand_code} .= ${"now_brand2_jewelry_" . $month . "-" . $brand_code} . ", ";


                                                        // 月毎配列が最後の場合のみの処理（配列へブランド毎の売上合計値を代入するため）       
                                                            if ( $month === $array_end ) {
                                                                //ブランドナンバーと期間中の売上合計値を配列へ代入
                                                                    // ブランドコードを配列に渡したいが、Keyに数字を入れるとインデックスの要素への代入処理になり順番指定として扱われるので、一旦文字列で代入し、取り出す際に仮で追記した文字列を削除して使用する
                                                                        $brand_code2 = "";
                                                                        $brand_code2 = $brand_code . "_p";
                                                                        $brand2_sort[$brand_code2] = ${"now_brand2_jack_sum_" . $brand_code};
                                                                        $brand_sort[$brand_code2] = ${"now_brand_jack_sum_" . $brand_code};
                                                                        $brand2_sort_b[$brand_code2] = ${"now_brand2_betty_sum_" . $brand_code};
                                                                        $brand_sort_b[$brand_code2] = ${"now_brand_betty_sum_" . $brand_code};
                                                                        $brand2_sort_jw[$brand_code2] = ${"now_brand2_jewelry_sum_" . $brand_code};
                                                                        $brand_sort_jw[$brand_code2] = ${"now_brand_jewelry_sum_" . $brand_code};
                                                                        
                                                            }
                                                    
                                                    }

                                                // 全体ブランド一覧に存在しないブランドの場合は値が0のソースを追記
                                                    foreach($all_now_brand_array as $all_brand){
                                                        $brand_code = mb_strstr($all_brand, '[');
                                                        $brand_code = str_replace("[",'',$brand_code);
                                                        $brand_code = str_replace("]",'',$brand_code);

                                                        if(in_array($all_brand,${"now_brand_array_" . $month}, true)){
                                                        } else {
                                                            ${"now_brand_jack_sorce_" . $brand_code} .= "<div class='title3 ta_r'>0</div>";
                                                            ${"now_brand_jack_js_" . $brand_code} .= "0, ";
                                                            ${"now_brand2_jack_sorce_" . $brand_code} .= "<div class='title3 ta_r'>0</div>";
                                                            ${"now_brand2_jack_js_" . $brand_code} .= "0, ";
                                                            ${"now_brand_betty_sorce_" . $brand_code} .= "<div class='title3 ta_r'>0</div>";
                                                            ${"now_brand_betty_js_" . $brand_code} .= "0, ";
                                                            ${"now_brand2_betty_sorce_" . $brand_code} .= "<div class='title3 ta_r'>0</div>";
                                                            ${"now_brand2_betty_js_" . $brand_code} .= "0, ";
                                                            ${"now_brand_jewelry_sorce_" . $brand_code} .= "<div class='title3 ta_r'>0</div>";
                                                            ${"now_brand_jewelry_js_" . $brand_code} .= "0, ";
                                                            ${"now_brand2_jewelry_sorce_" . $brand_code} .= "<div class='title3 ta_r'>0</div>";
                                                            ${"now_brand2_jewelry_js_" . $brand_code} .= "0, ";
                                                            

                                                            // 月毎配列が最後の場合のみの処理        
                                                                if ( $month === $array_end ) {
                                                                    //ブランドナンバーと期間中の売上合計値を配列へ代入
                                                                        // ブランドコードを配列に渡したいが、Keyに数字を入れるとインデックスの要素への代入処理になり順番指定として扱われるので、一旦文字列で代入し、取り出す際に仮で追記した文字列を削除して使用する
                                                                            $brand_code2 = "";
                                                                            $brand_code2 = $brand_code . "_p";
                                                                            $brand2_sort[$brand_code2] = ${"now_brand2_jack_sum_" . $brand_code};
                                                                            $brand_sort[$brand_code2] = ${"now_brand_jack_sum_" . $brand_code};
                                                                            $brand2_sort_b[$brand_code2] = ${"now_brand2_betty_sum_" . $brand_code};
                                                                            $brand_sort_b[$brand_code2] = ${"now_brand_betty_sum_" . $brand_code};
                                                                            $brand2_sort_jw[$brand_code2] = ${"now_brand2_jewelry_sum_" . $brand_code};
                                                                            $brand_sort_jw[$brand_code2] = ${"now_brand_jewelry_sum_" . $brand_code};

                                                                }


                                                        }

                                                    }

                                            $i++;
                                            }


                                            // Jack用ブランドを売上降順（売上を代入している値基準）でソートし、各ブランドの行HTMLに追記（売上用）
                                                //if(is_array($brand_sort)){arsort( $brand_sort );}
                                                arsort( $brand_sort );
                                                foreach($brand_sort as $brand_code => $total_value){
                                                    // ブランドコード（数字での順番指定を回避するために適当に追記した文字列を削除して使用）
                                                        $brand_code = str_replace('_p', '', $brand_code);
                                                        
                                                        $brand_name = "";
                                                        $check_brand_value = "";
                                                        foreach($all_now_brand_array as $all_brand){
                                                            $all_brand_name = mb_substr( $all_brand , 0 , mb_strpos($all_brand, "[") );
                                                            $all_brand_no = mb_strstr($all_brand, '[');
                                                            $all_brand_no = str_replace("[",'',$all_brand_no);
                                                            $all_brand_no = str_replace("]",'',$all_brand_no);
                                                            if($all_brand_no == $brand_code){$brand_name = $all_brand_name ;}

                                                        }
                                                        $check_brand_value = $brand_code . "[" . $brand_name  . "]";
                                                        if($brandselect <> "" && in_array($check_brand_value,$brandselect)){$checked_now_j_uriage = "checked";} else {$checked_now_j_uriage = "";}

                                                        // 前期比の作成
                                                            if(isset(${"past_brand_jack_sum_" . $brand_code}) && ${"past_brand_jack_sum_" . $brand_code} <> 0 && ${"past_brand_jack_sum_" . $brand_code} <> "" && ${"now_brand_jack_sum_" . $brand_code} <> 0 && ${"now_brand_jack_sum_" . $brand_code} <> ""){ $yoy = floor(${"now_brand_jack_sum_" . $brand_code} / ${"past_brand_jack_sum_" . $brand_code} * 100); if($yoy >= 100){$yoy = "<span class='fc_red'>" . $yoy . "%</span>";} else {$yoy = "<span class='fc_blue'>" . $yoy . "%</span>";}}else {$yoy = "";}
                                                        // 現在ジャック・売上表示の各ブランド毎の行を作成
                                                            ${"now_brand_jack_sorce_" . $brand_code} = "<div class='wid100 ul1b'><div class='title1 ta_c'><input type='checkbox' name='brandselect[]' value='" . $check_brand_value . "' " . $checked_now_j_uriage . "> " . $brand_name . "</div>" . ${"now_brand_jack_sorce_" . $brand_code}  . "<div class='title4 ta_r'>" . number_format((int)${"now_brand_jack_sum_" . $brand_code}) . "</div><div class='title4 ta_c'>" . $yoy . "</div></div>";
                                                        
                                                        // 合計値が0でないブランドのみソースを追記
                                                            if(${"now_brand_jack_sum_" . $brand_code} <> 0){
                                                                $all_now_brand_jack_sorce .= ${"now_brand_jack_sorce_" . $brand_code};
                                                            }
                                                }
                                                

                                            // Jack用ブランドを売上降順（売上を代入している値基準）でソートし、各ブランドの行HTMLに追記（点数用）
                                                arsort( $brand2_sort );
                                                foreach($brand2_sort as $brand_code => $total_value){
                                                    // ブランドコード（数字での順番指定を回避するために適当に追記した文字列を削除して使用）
                                                        $brand_code = str_replace('_p', '', $brand_code);
                                                        
                                                        $brand_name = "";
                                                        $check_brand_value = "";
                                                        foreach($all_now_brand_array as $all_brand){
                                                            $all_brand_name = mb_substr( $all_brand , 0 , mb_strpos($all_brand, "[") );
                                                            $all_brand_no = mb_strstr($all_brand, '[');
                                                            $all_brand_no = str_replace("[",'',$all_brand_no);
                                                            $all_brand_no = str_replace("]",'',$all_brand_no);
                                                            if($all_brand_no == $brand_code){$brand_name = $all_brand_name ;}

                                                        }
                                                        $check_brand_value = $brand_code . "[" . $brand_name  . "]";
                                                        if($brandselect <> "" && in_array($check_brand_value,$brandselect)){$checked_now_j_uriage = "checked";} else {$checked_now_j_uriage = "";}
                                                        // 前期比の作成
                                                            if(isset(${"past_brand2_jack_sum_" . $brand_code}) && ${"past_brand2_jack_sum_" . $brand_code} <> 0 && ${"past_brand2_jack_sum_" . $brand_code} <> "" && ${"now_brand2_jack_sum_" . $brand_code} <> 0 && ${"now_brand2_jack_sum_" . $brand_code} <> ""){ $yoy2 = floor(${"now_brand2_jack_sum_" . $brand_code} / ${"past_brand2_jack_sum_" . $brand_code} * 100); if($yoy2 >= 100){$yoy2 = "<span class='fc_red'>" . $yoy2 . "%</span>";} else {$yoy2 = "<span class='fc_blue'>" . $yoy2 . "%</span>";}}else {$yoy2 = "";}
                                                        // 現在ジャック・点数表示の各ブランド毎の行を作成
                                                            ${"now_brand2_jack_sorce_" . $brand_code} = "<div class='wid100 ul1b'><div class='title1 ta_c'><input type='checkbox' name='brandselect[]' value='" . $check_brand_value . "' " . $checked_now_j_uriage . "> " . $brand_name . "</div>" . ${"now_brand2_jack_sorce_" . $brand_code}  . "<div class='title4 ta_r'>" . number_format((int)${"now_brand2_jack_sum_" . $brand_code}) . "</div><div class='title4 ta_c'>" . $yoy2 . "</div></div>";
                                                        
                                                        // 合計値が0でないブランドのみソースを追記
                                                            if(${"now_brand2_jack_sum_" . $brand_code} <> 0){
                                                                $all_now_brand2_jack_sorce .= ${"now_brand2_jack_sorce_" . $brand_code};
                                                            }
                                                }



                                            // Betty用ブランドを売上降順（売上を代入している値基準）でソートし、各ブランドの行HTMLに追記（売上用）
                                                arsort( $brand_sort_b );
                                                foreach($brand_sort_b as $brand_code => $total_value){
                                                    // ブランドコード（数字での順番指定を回避するために適当に追記した文字列を削除して使用）
                                                        $brand_code = str_replace('_p', '', $brand_code);
                                                        
                                                        $brand_name = "";
                                                        $check_brand_value = "";
                                                        foreach($all_now_brand_array as $all_brand){
                                                            $all_brand_name = mb_substr( $all_brand , 0 , mb_strpos($all_brand, "[") );
                                                            $all_brand_no = mb_strstr($all_brand, '[');
                                                            $all_brand_no = str_replace("[",'',$all_brand_no);
                                                            $all_brand_no = str_replace("]",'',$all_brand_no);
                                                            if($all_brand_no == $brand_code){$brand_name = $all_brand_name ;}

                                                        }
                                                        $check_brand_value = $brand_code . "[" . $brand_name  . "]";
                                                        if($brandselect_b <> "" && in_array($check_brand_value,$brandselect_b)){$checked_now_b_uriage = "checked";} else {$checked_now_b_uriage = "";}
                                                        
                                                        // 前期比の作成
                                                            if(isset(${"past_brand_betty_sum_" . $brand_code}) && ${"past_brand_betty_sum_" . $brand_code} <> 0 && ${"past_brand_betty_sum_" . $brand_code} <> "" && ${"now_brand_betty_sum_" . $brand_code} <> 0 && ${"now_brand_betty_sum_" . $brand_code} <> ""){ $yoy_b = floor(${"now_brand_betty_sum_" . $brand_code} / ${"past_brand_betty_sum_" . $brand_code} * 100); if($yoy_b >= 100){$yoy_b = "<span class='fc_red'>" . $yoy_b . "%</span>";} else {$yoy_b = "<span class='fc_blue'>" . $yoy_b . "%</span>";}}else {$yoy_b = "";}
                                                        // 現在ベティー・売上表示の各ブランド毎の行を作成
                                                            ${"now_brand_betty_sorce_" . $brand_code} = "<div class='wid100 ul1b'><div class='title1 ta_c'><input type='checkbox' name='brandselect_b[]' value='" . $check_brand_value . "' " . $checked_now_b_uriage . "> " . $brand_name . "</div>" . ${"now_brand_betty_sorce_" . $brand_code}  . "<div class='title4 ta_r'>" . number_format((int)${"now_brand_betty_sum_" . $brand_code}) . "</div><div class='title4 ta_c'>" . $yoy_b . "</div></div>";
                                                        
                                                        // 合計値が0でないブランドのみソースを追記
                                                            if(${"now_brand_betty_sum_" . $brand_code} <> 0){
                                                                $all_now_brand_betty_sorce .= ${"now_brand_betty_sorce_" . $brand_code};
                                                            }
                                                }

                                            // Betty用ブランドを売上降順（売上を代入している値基準）でソートし、各ブランドの行HTMLに追記（点数用）
                                                arsort( $brand2_sort_b );
                                                foreach($brand2_sort_b as $brand_code => $total_value){
                                                    // ブランドコード（数字での順番指定を回避するために適当に追記した文字列を削除して使用）
                                                        $brand_code = str_replace('_p', '', $brand_code);
                                                        
                                                        $brand_name = "";
                                                        $check_brand_value = "";
                                                        foreach($all_now_brand_array as $all_brand){
                                                            $all_brand_name = mb_substr( $all_brand , 0 , mb_strpos($all_brand, "[") );
                                                            $all_brand_no = mb_strstr($all_brand, '[');
                                                            $all_brand_no = str_replace("[",'',$all_brand_no);
                                                            $all_brand_no = str_replace("]",'',$all_brand_no);
                                                            if($all_brand_no == $brand_code){$brand_name = $all_brand_name ;}

                                                        }
                                                        $check_brand_value = $brand_code . "[" . $brand_name  . "]";
                                                        if($brandselect_b <> "" && in_array($check_brand_value,$brandselect_b)){$checked_now_b_uriage = "checked";} else {$checked_now_b_uriage = "";}
                                                        
                                                        // 前期比の作成
                                                            if(isset(${"past_brand2_betty_sum_" . $brand_code}) && ${"past_brand2_betty_sum_" . $brand_code} <> 0 && ${"past_brand2_betty_sum_" . $brand_code} <> "" && ${"now_brand2_betty_sum_" . $brand_code} <> 0 && ${"now_brand2_betty_sum_" . $brand_code} <> ""){ $yoy_b2 = floor(${"now_brand2_betty_sum_" . $brand_code} / ${"past_brand2_betty_sum_" . $brand_code} * 100); if($yoy_b2 >= 100){$yoy_b2 = "<span class='fc_red'>" . $yoy_b2 . "%</span>";} else {$yoy_b2 = "<span class='fc_blue'>" . $yoy_b2 . "%</span>";}}else {$yoy_b2 = "";}
                                                        // 現在ベティー・点数表示の各ブランド毎の行を作成
                                                            ${"now_brand2_betty_sorce_" . $brand_code} = "<div class='wid100 ul1b'><div class='title1 ta_c'><input type='checkbox' name='brandselect_b[]' value='" . $check_brand_value . "' " . $checked_now_b_uriage . "> " . $brand_name . "</div>" . ${"now_brand2_betty_sorce_" . $brand_code}  . "<div class='title4 ta_r'>" . number_format((int)${"now_brand2_betty_sum_" . $brand_code}) . "</div><div class='title4 ta_c'>" . $yoy_b2 . "</div></div>";
                                                        
                                                        // 合計値が0でないブランドのみソースを追記
                                                            if(${"now_brand2_betty_sum_" . $brand_code} <> 0){
                                                                $all_now_brand2_betty_sorce .= ${"now_brand2_betty_sorce_" . $brand_code};
                                                            }
                                                }



                                            // Jewelry用ブランドを売上降順（売上を代入している値基準）でソートし、各ブランドの行HTMLに追記（売上用）
                                                arsort( $brand_sort_jw );
                                                foreach($brand_sort_jw as $brand_code => $total_value){
                                                    // ブランドコード（数字での順番指定を回避するために適当に追記した文字列を削除して使用）
                                                        $brand_code = str_replace('_p', '', $brand_code);
                                                        
                                                        $brand_name = "";
                                                        $check_brand_value = "";
                                                        foreach($all_now_brand_array as $all_brand){
                                                            $all_brand_name = mb_substr( $all_brand , 0 , mb_strpos($all_brand, "[") );
                                                            $all_brand_no = mb_strstr($all_brand, '[');
                                                            $all_brand_no = str_replace("[",'',$all_brand_no);
                                                            $all_brand_no = str_replace("]",'',$all_brand_no);
                                                            if($all_brand_no == $brand_code){$brand_name = $all_brand_name ;}

                                                        }
                                                        $check_brand_value = $brand_code . "[" . $brand_name  . "]";
                                                        if($brandselect_jw <> "" && in_array($check_brand_value,$brandselect_jw)){$checked_now_jw_uriage = "checked";} else {$checked_now_jw_uriage = "";}
                                                        
                                                        // 前期比の作成
                                                            if(isset(${"past_brand_jewelry_sum_" . $brand_code}) && ${"past_brand_jewelry_sum_" . $brand_code} <> 0 && ${"past_brand_jewelry_sum_" . $brand_code} <> "" && ${"now_brand_jewelry_sum_" . $brand_code} <> 0 && ${"now_brand_jewelry_sum_" . $brand_code} <> ""){ $yoy_jw = floor(${"now_brand_jewelry_sum_" . $brand_code} / ${"past_brand_jewelry_sum_" . $brand_code} * 100); if($yoy_jw >= 100){$yoy_jw = "<span class='fc_red'>" . $yoy_jw . "%</span>";} else {$yoy_jw = "<span class='fc_blue'>" . $yoy_jw . "%</span>";}}else {$yoy_jw = "";}
                                                        // 現在ジュエリー・売上表示の各ブランド毎の行を作成
                                                            ${"now_brand_jewelry_sorce_" . $brand_code} = "<div class='wid100 ul1b'><div class='title1 ta_c'><input type='checkbox' name='brandselect_jw[]' value='" . $check_brand_value . "' " . $checked_now_jw_uriage . "> " . $brand_name . "</div>" . ${"now_brand_jewelry_sorce_" . $brand_code}  . "<div class='title4 ta_r'>" . number_format((int)${"now_brand_jewelry_sum_" . $brand_code}) . "</div><div class='title4 ta_c'>" . $yoy_jw . "</div></div>";
                                                        
                                                        // 合計値が0でないブランドのみソースを追記
                                                            if(${"now_brand_jewelry_sum_" . $brand_code} <> 0){
                                                                $all_now_brand_jewelry_sorce .= ${"now_brand_jewelry_sorce_" . $brand_code};
                                                            }
                                                }

                                            // Jewelry用ブランドを売上降順（売上を代入している値基準）でソートし、各ブランドの行HTMLに追記（点数用）
                                                arsort( $brand2_sort_jw );
                                                foreach($brand2_sort_jw as $brand_code => $total_value){
                                                    // ブランドコード（数字での順番指定を回避するために適当に追記した文字列を削除して使用）
                                                        $brand_code = str_replace('_p', '', $brand_code);
                                                        
                                                        $brand_name = "";
                                                        $check_brand_value = "";
                                                        foreach($all_now_brand_array as $all_brand){
                                                            $all_brand_name = mb_substr( $all_brand , 0 , mb_strpos($all_brand, "[") );
                                                            $all_brand_no = mb_strstr($all_brand, '[');
                                                            $all_brand_no = str_replace("[",'',$all_brand_no);
                                                            $all_brand_no = str_replace("]",'',$all_brand_no);
                                                            if($all_brand_no == $brand_code){$brand_name = $all_brand_name ;}

                                                        }
                                                        $check_brand_value = $brand_code . "[" . $brand_name  . "]";
                                                        if($brandselect_jw <> "" && in_array($check_brand_value,$brandselect_jw)){$checked_now_jw_uriage = "checked";} else {$checked_now_jw_uriage = "";}
                                                        
                                                        // 前期比の作成
                                                            if(isset(${"past_brand2_jewelry_sum_" . $brand_code}) && ${"past_brand2_jewelry_sum_" . $brand_code} <> 0 && ${"past_brand2_jewelry_sum_" . $brand_code} <> "" && ${"now_brand2_jewelry_sum_" . $brand_code} <> 0 && ${"now_brand2_jewelry_sum_" . $brand_code} <> ""){ $yoy_jw2 = floor(${"now_brand2_jewelry_sum_" . $brand_code} / ${"past_brand2_jewelry_sum_" . $brand_code} * 100); if($yoy_jw2 >= 100){$yoy_jw2 = "<span class='fc_red'>" . $yoy_jw2 . "%</span>";} else {$yoy_jw2 = "<span class='fc_blue'>" . $yoy_jw2 . "%</span>";}}else {$yoy_jw2 = "";}
                                                        // 現在ジュエリー・点数表示の各ブランド毎の行を作成
                                                            ${"now_brand2_jewelry_sorce_" . $brand_code} = "<div class='wid100 ul1b'><div class='title1 ta_c'><input type='checkbox' name='brandselect_jw[]' value='" . $check_brand_value . "' " . $checked_now_jw_uriage . "> " . $brand_name . "</div>" . ${"now_brand2_jewelry_sorce_" . $brand_code}  . "<div class='title4 ta_r'>" . number_format((int)${"now_brand2_jewelry_sum_" . $brand_code}) . "</div><div class='title4 ta_c'>" . $yoy_jw2 . "</div></div>";
                                                        
                                                        // 合計値が0でないブランドのみソースを追記
                                                            if(${"now_brand2_jewelry_sum_" . $brand_code} <> 0){
                                                                $all_now_brand2_jewelry_sorce .= ${"now_brand2_jewelry_sorce_" . $brand_code};
                                                            }
                                                }


                                            $now_temp5_title = "<div class='box1'><div class='wid100 ul2'><div class='title5 ta_c'>" . $between_start_view . "～<br>" . $between_end_view . "</div>" . $now_temp5_title . "<div class='title6 ta_c'>累計</div><div class='title6 ta_c'>過去比</div></div>";


                                            $all_now_brand_jack_sorce = "<p class='title_a'>現在・Jackブランド別売上</p>" . $now_temp5_title . "<div class='brand_list'>" . $all_now_brand_jack_sorce . "</div></div>";
                                            $all_now_brand2_jack_sorce = "<p class='title_a'>現在・Jackブランド別売上点数</p>" . $now_temp5_title . "<div class='brand_list'>" . $all_now_brand2_jack_sorce . "</div></div>";

                                            $all_now_brand_betty_sorce = "<p class='title_a'>現在・Bettyブランド別売上</p>" . $now_temp5_title . "<div class='brand_list_b'>" . $all_now_brand_betty_sorce . "</div></div>";
                                            $all_now_brand2_betty_sorce = "<p class='title_a'>現在・Bettyブランド別売上点数</p>" . $now_temp5_title . "<div class='brand_list_b'>" . $all_now_brand2_betty_sorce . "</div></div>";
                                            
                                            $all_now_brand_jewelry_sorce = "<p class='title_a'>現在・Jewelryブランド別売上</p>" . $now_temp5_title . "<div class='brand_list_jw'>" . $all_now_brand_jewelry_sorce . "</div></div>";
                                            $all_now_brand2_jewelry_sorce = "<p class='title_a'>現在・Jewelryブランド別売上点数</p>" . $now_temp5_title . "<div class='brand_list_jw'>" . $all_now_brand2_jewelry_sorce . "</div></div>";




/********************************************************************************************* */
//現在用 END
/********************************************************************************************* */



// 選択したブランドの情報を変数化
    if(isset($view_brand_name[0])){$js_brandname_now_j_uriage1 = $view_brand_name[0];} else {$js_brandname_now_j_uriage1 = "";}
    if(isset($view_brand_code[0]) && isset(${"now_brand_jack_js_" . $view_brand_code[0]}) && isset(${"now_brand2_jack_js_" . $view_brand_code[0]})){$js_brandcode_now_j_uriage1 = ${"now_brand_jack_js_" . $view_brand_code[0]};$js_brandcode_now_j_honsuu1 = ${"now_brand2_jack_js_" . $view_brand_code[0]};} else {$js_brandcode_now_j_uriage1 = "";$js_brandcode_now_j_honsuu1 = "";}
    if(isset($view_brand_name[1])){$js_brandname_now_j_uriage2 = $view_brand_name[1];} else {$js_brandname_now_j_uriage2 = "";}
    if(isset($view_brand_code[1]) && isset(${"now_brand_jack_js_" . $view_brand_code[1]}) && isset(${"now_brand2_jack_js_" . $view_brand_code[1]})){$js_brandcode_now_j_uriage2 = ${"now_brand_jack_js_" . $view_brand_code[1]};$js_brandcode_now_j_honsuu2 = ${"now_brand2_jack_js_" . $view_brand_code[1]};} else {$js_brandcode_now_j_uriage2 = "";$js_brandcode_now_j_honsuu2 = "";}
    if(isset($view_brand_name[2])){$js_brandname_now_j_uriage3 = $view_brand_name[2];} else {$js_brandname_now_j_uriage3 = "";}
    if(isset($view_brand_code[2]) && isset(${"now_brand_jack_js_" . $view_brand_code[2]}) && isset(${"now_brand2_jack_js_" . $view_brand_code[2]})){$js_brandcode_now_j_uriage3 = ${"now_brand_jack_js_" . $view_brand_code[2]};$js_brandcode_now_j_honsuu3 = ${"now_brand2_jack_js_" . $view_brand_code[2]};} else {$js_brandcode_now_j_uriage3 = "";$js_brandcode_now_j_honsuu3 = "";}
    if(isset($view_brand_name[3])){$js_brandname_now_j_uriage4 = $view_brand_name[3];} else {$js_brandname_now_j_uriage4 = "";}
    if(isset($view_brand_code[3]) && isset(${"now_brand_jack_js_" . $view_brand_code[3]}) && isset(${"now_brand2_jack_js_" . $view_brand_code[3]})){$js_brandcode_now_j_uriage4 = ${"now_brand_jack_js_" . $view_brand_code[3]};$js_brandcode_now_j_honsuu4 = ${"now_brand2_jack_js_" . $view_brand_code[3]};} else {$js_brandcode_now_j_uriage4 = "";$js_brandcode_now_j_honsuu4 = "";}
    if(isset($view_brand_name[4])){$js_brandname_now_j_uriage5 = $view_brand_name[4];} else {$js_brandname_now_j_uriage5 = "";}
    if(isset($view_brand_code[4]) && isset(${"now_brand_jack_js_" . $view_brand_code[4]}) && isset(${"now_brand2_jack_js_" . $view_brand_code[4]})){$js_brandcode_now_j_uriage5 = ${"now_brand_jack_js_" . $view_brand_code[4]};$js_brandcode_now_j_honsuu5 = ${"now_brand2_jack_js_" . $view_brand_code[4]};} else {$js_brandcode_now_j_uriage5 = "";$js_brandcode_now_j_honsuu5 = "";}


    if(isset($view_brand_code[0]) && isset(${"past_brand_jack_js_" . $view_brand_code[0]}) && isset(${"past_brand2_jack_js_" . $view_brand_code[0]})){$js_brandcode_past_j_uriage1 = ${"past_brand_jack_js_" . $view_brand_code[0]};$js_brandcode_past_j_honsuu1 = ${"past_brand2_jack_js_" . $view_brand_code[0]};} else {$js_brandcode_past_j_uriage1 = "";$js_brandcode_past_j_honsuu1 = "";}
    if(isset($view_brand_code[1]) && isset(${"past_brand_jack_js_" . $view_brand_code[1]}) && isset(${"past_brand2_jack_js_" . $view_brand_code[1]})){$js_brandcode_past_j_uriage2 = ${"past_brand_jack_js_" . $view_brand_code[1]};$js_brandcode_past_j_honsuu2 = ${"past_brand2_jack_js_" . $view_brand_code[1]};} else {$js_brandcode_past_j_uriage2 = "";$js_brandcode_past_j_honsuu2 = "";}
    if(isset($view_brand_code[2]) && isset(${"past_brand_jack_js_" . $view_brand_code[2]}) && isset(${"past_brand2_jack_js_" . $view_brand_code[2]})){$js_brandcode_past_j_uriage3 = ${"past_brand_jack_js_" . $view_brand_code[2]};$js_brandcode_past_j_honsuu3 = ${"past_brand2_jack_js_" . $view_brand_code[2]};} else {$js_brandcode_past_j_uriage3 = "";$js_brandcode_past_j_honsuu3 = "";}
    if(isset($view_brand_code[3]) && isset(${"past_brand_jack_js_" . $view_brand_code[3]}) && isset(${"past_brand2_jack_js_" . $view_brand_code[3]})){$js_brandcode_past_j_uriage4 = ${"past_brand_jack_js_" . $view_brand_code[3]};$js_brandcode_past_j_honsuu4 = ${"past_brand2_jack_js_" . $view_brand_code[3]};} else {$js_brandcode_past_j_uriage4 = "";$js_brandcode_past_j_honsuu4 = "";}
    if(isset($view_brand_code[4]) && isset(${"past_brand_jack_js_" . $view_brand_code[4]}) && isset(${"past_brand2_jack_js_" . $view_brand_code[4]})){$js_brandcode_past_j_uriage5 = ${"past_brand_jack_js_" . $view_brand_code[4]};$js_brandcode_past_j_honsuu5 = ${"past_brand2_jack_js_" . $view_brand_code[4]};} else {$js_brandcode_past_j_uriage5 = "";$js_brandcode_past_j_honsuu5 = "";}

    if(isset($view_brand_name_b[0])){$js_brandname_now_b_uriage1 = $view_brand_name_b[0];} else {$js_brandname_now_b_uriage1 = "";}
    if(isset($view_brand_code_b[0]) && isset(${"now_brand_betty_js_" . $view_brand_code_b[0]}) && isset(${"now_brand2_betty_js_" . $view_brand_code_b[0]})){$js_brandcode_now_b_uriage1 = ${"now_brand_betty_js_" . $view_brand_code_b[0]};$js_brandcode_now_b_honsuu1 = ${"now_brand2_betty_js_" . $view_brand_code_b[0]};} else {$js_brandcode_now_b_uriage1 = "";$js_brandcode_now_b_honsuu1 = "";}
    if(isset($view_brand_name_b[1])){$js_brandname_now_b_uriage2 = $view_brand_name_b[1];} else {$js_brandname_now_b_uriage2 = "";}
    if(isset($view_brand_code_b[1]) && isset(${"now_brand_betty_js_" . $view_brand_code_b[1]}) && isset(${"now_brand2_betty_js_" . $view_brand_code_b[1]})){$js_brandcode_now_b_uriage2 = ${"now_brand_betty_js_" . $view_brand_code_b[1]};$js_brandcode_now_b_honsuu2 = ${"now_brand2_betty_js_" . $view_brand_code_b[1]};} else {$js_brandcode_now_b_uriage2 = "";$js_brandcode_now_b_honsuu2 = "";}
    if(isset($view_brand_name_b[2])){$js_brandname_now_b_uriage3 = $view_brand_name_b[2];} else {$js_brandname_now_b_uriage3 = "";}
    if(isset($view_brand_code_b[2]) && isset(${"now_brand_betty_js_" . $view_brand_code_b[2]}) && isset(${"now_brand2_betty_js_" . $view_brand_code_b[2]})){$js_brandcode_now_b_uriage3 = ${"now_brand_betty_js_" . $view_brand_code_b[2]};$js_brandcode_now_b_honsuu3 = ${"now_brand2_betty_js_" . $view_brand_code_b[2]};} else {$js_brandcode_now_b_uriage3 = "";$js_brandcode_now_b_honsuu3 = "";}
    if(isset($view_brand_name_b[3])){$js_brandname_now_b_uriage4 = $view_brand_name_b[3];} else {$js_brandname_now_b_uriage4 = "";}
    if(isset($view_brand_code_b[3]) && isset(${"now_brand_betty_js_" . $view_brand_code_b[3]}) && isset(${"now_brand2_betty_js_" . $view_brand_code_b[3]})){$js_brandcode_now_b_uriage4 = ${"now_brand_betty_js_" . $view_brand_code_b[3]};$js_brandcode_now_b_honsuu4 = ${"now_brand2_betty_js_" . $view_brand_code_b[3]};} else {$js_brandcode_now_b_uriage4 = "";$js_brandcode_now_b_honsuu4 = "";}
    if(isset($view_brand_name_b[4])){$js_brandname_now_b_uriage5 = $view_brand_name_b[4];} else {$js_brandname_now_b_uriage5 = "";}
    if(isset($view_brand_code_b[4]) && isset(${"now_brand_betty_js_" . $view_brand_code_b[4]}) && isset(${"now_brand2_betty_js_" . $view_brand_code_b[4]})){$js_brandcode_now_b_uriage5 = ${"now_brand_betty_js_" . $view_brand_code_b[4]};$js_brandcode_now_b_honsuu5 = ${"now_brand2_betty_js_" . $view_brand_code_b[4]};} else {$js_brandcode_now_b_uriage5 = "";$js_brandcode_now_b_honsuu5 = "";}


    if(isset($view_brand_code_b[0]) && isset(${"past_brand_betty_js_" . $view_brand_code_b[0]}) && isset(${"past_brand2_betty_js_" . $view_brand_code_b[0]})){$js_brandcode_past_b_uriage1 = ${"past_brand_betty_js_" . $view_brand_code_b[0]};$js_brandcode_past_b_honsuu1 = ${"past_brand2_betty_js_" . $view_brand_code_b[0]};} else {$js_brandcode_past_b_uriage1 = "";$js_brandcode_past_b_honsuu1 = "";}
    if(isset($view_brand_code_b[1]) && isset(${"past_brand_betty_js_" . $view_brand_code_b[1]}) && isset(${"past_brand2_betty_js_" . $view_brand_code_b[1]})){$js_brandcode_past_b_uriage2 = ${"past_brand_betty_js_" . $view_brand_code_b[1]};$js_brandcode_past_b_honsuu2 = ${"past_brand2_betty_js_" . $view_brand_code_b[1]};} else {$js_brandcode_past_b_uriage2 = "";$js_brandcode_past_b_honsuu2 = "";}
    if(isset($view_brand_code_b[2]) && isset(${"past_brand_betty_js_" . $view_brand_code_b[2]}) && isset(${"past_brand2_betty_js_" . $view_brand_code_b[2]})){$js_brandcode_past_b_uriage3 = ${"past_brand_betty_js_" . $view_brand_code_b[2]};$js_brandcode_past_b_honsuu3 = ${"past_brand2_betty_js_" . $view_brand_code_b[2]};} else {$js_brandcode_past_b_uriage3 = "";$js_brandcode_past_b_honsuu3 = "";}
    if(isset($view_brand_code_b[3]) && isset(${"past_brand_betty_js_" . $view_brand_code_b[3]}) && isset(${"past_brand2_betty_js_" . $view_brand_code_b[3]})){$js_brandcode_past_b_uriage4 = ${"past_brand_betty_js_" . $view_brand_code_b[3]};$js_brandcode_past_b_honsuu4 = ${"past_brand2_betty_js_" . $view_brand_code_b[3]};} else {$js_brandcode_past_b_uriage4 = "";$js_brandcode_past_b_honsuu4 = "";}
    if(isset($view_brand_code_b[4]) && isset(${"past_brand_betty_js_" . $view_brand_code_b[4]}) && isset(${"past_brand2_betty_js_" . $view_brand_code_b[4]})){$js_brandcode_past_b_uriage5 = ${"past_brand_betty_js_" . $view_brand_code_b[4]};$js_brandcode_past_b_honsuu5 = ${"past_brand2_betty_js_" . $view_brand_code_b[4]};} else {$js_brandcode_past_b_uriage5 = "";$js_brandcode_past_b_honsuu5 = "";}


    if(isset($view_brand_name_jw[0])){$js_brandname_now_jw_uriage1 = $view_brand_name_jw[0];} else {$js_brandname_now_jw_uriage1 = "";}
    if(isset($view_brand_code_jw[0]) && isset(${"now_brand_jewelry_js_" . $view_brand_code_jw[0]}) && isset(${"now_brand2_jewelry_js_" . $view_brand_code_jw[0]})){$js_brandcode_now_jw_uriage1 = ${"now_brand_jewelry_js_" . $view_brand_code_jw[0]};$js_brandcode_now_jw_honsuu1 = ${"now_brand2_jewelry_js_" . $view_brand_code_jw[0]};} else {$js_brandcode_now_jw_uriage1 = "";$js_brandcode_now_jw_honsuu1 = "";}
    if(isset($view_brand_name_jw[1])){$js_brandname_now_jw_uriage2 = $view_brand_name_jw[1];} else {$js_brandname_now_jw_uriage2 = "";}
    if(isset($view_brand_code_jw[1]) && isset(${"now_brand_jewelry_js_" . $view_brand_code_jw[1]}) && isset(${"now_brand2_jewelry_js_" . $view_brand_code_jw[1]})){$js_brandcode_now_jw_uriage2 = ${"now_brand_jewelry_js_" . $view_brand_code_jw[1]};$js_brandcode_now_jw_honsuu2 = ${"now_brand2_jewelry_js_" . $view_brand_code_jw[1]};} else {$js_brandcode_now_jw_uriage2 = "";$js_brandcode_now_jw_honsuu2 = "";}
    if(isset($view_brand_name_jw[2])){$js_brandname_now_jw_uriage3 = $view_brand_name_jw[2];} else {$js_brandname_now_jw_uriage3 = "";}
    if(isset($view_brand_code_jw[2]) && isset(${"now_brand_jewelry_js_" . $view_brand_code_jw[2]}) && isset(${"now_brand2_jewelry_js_" . $view_brand_code_jw[2]})){$js_brandcode_now_jw_uriage3 = ${"now_brand_jewelry_js_" . $view_brand_code_jw[2]};$js_brandcode_now_jw_honsuu3 = ${"now_brand2_jewelry_js_" . $view_brand_code_jw[2]};} else {$js_brandcode_now_jw_uriage3 = "";$js_brandcode_now_jw_honsuu3 = "";}
    if(isset($view_brand_name_jw[3])){$js_brandname_now_jw_uriage4 = $view_brand_name_jw[3];} else {$js_brandname_now_jw_uriage4 = "";}
    if(isset($view_brand_code_jw[3]) && isset(${"now_brand_jewelry_js_" . $view_brand_code_jw[3]}) && isset(${"now_brand2_jewelry_js_" . $view_brand_code_jw[3]})){$js_brandcode_now_jw_uriage4 = ${"now_brand_jewelry_js_" . $view_brand_code_jw[3]};$js_brandcode_now_jw_honsuu4 = ${"now_brand2_jewelry_js_" . $view_brand_code_jw[3]};} else {$js_brandcode_now_jw_uriage4 = "";$js_brandcode_now_jw_honsuu4 = "";}
    if(isset($view_brand_name_jw[4])){$js_brandname_now_jw_uriage5 = $view_brand_name_jw[4];} else {$js_brandname_now_jw_uriage5 = "";}
    if(isset($view_brand_code_jw[4]) && isset(${"now_brand_jewelry_js_" . $view_brand_code_jw[4]}) && isset(${"now_brand2_jewelry_js_" . $view_brand_code_jw[4]})){$js_brandcode_now_jw_uriage5 = ${"now_brand_jewelry_js_" . $view_brand_code_jw[4]};$js_brandcode_now_jw_honsuu5 = ${"now_brand2_jewelry_js_" . $view_brand_code_jw[4]};} else {$js_brandcode_now_jw_uriage5 = "";$js_brandcode_now_jw_honsuu5 = "";}


    if(isset($view_brand_code_jw[0]) && isset(${"past_brand_jewelry_js_" . $view_brand_code_jw[0]})){$js_brandcode_past_jw_uriage1 = ${"past_brand_jewelry_js_" . $view_brand_code_jw[0]};$js_brandcode_past_jw_honsuu1 = ${"past_brand2_jewelry_js_" . $view_brand_code_jw[0]};} else {$js_brandcode_past_jw_uriage1 = "";$js_brandcode_past_jw_honsuu1 = "";}
    if(isset($view_brand_code_jw[1]) && isset(${"past_brand_jewelry_js_" . $view_brand_code_jw[1]})){$js_brandcode_past_jw_uriage2 = ${"past_brand_jewelry_js_" . $view_brand_code_jw[1]};$js_brandcode_past_jw_honsuu2 = ${"past_brand2_jewelry_js_" . $view_brand_code_jw[1]};} else {$js_brandcode_past_jw_uriage2 = "";$js_brandcode_past_jw_honsuu2 = "";}
    if(isset($view_brand_code_jw[2]) && isset(${"past_brand_jewelry_js_" . $view_brand_code_jw[2]})){$js_brandcode_past_jw_uriage3 = ${"past_brand_jewelry_js_" . $view_brand_code_jw[2]};$js_brandcode_past_jw_honsuu3 = ${"past_brand2_jewelry_js_" . $view_brand_code_jw[2]};} else {$js_brandcode_past_jw_uriage3 = "";$js_brandcode_past_jw_honsuu3 = "";}
    if(isset($view_brand_code_jw[3]) && isset(${"past_brand_jewelry_js_" . $view_brand_code_jw[3]})){$js_brandcode_past_jw_uriage4 = ${"past_brand_jewelry_js_" . $view_brand_code_jw[3]};$js_brandcode_past_jw_honsuu4 = ${"past_brand2_jewelry_js_" . $view_brand_code_jw[3]};} else {$js_brandcode_past_jw_uriage4 = "";$js_brandcode_past_jw_honsuu4 = "";}
    if(isset($view_brand_code_jw[4]) && isset(${"past_brand_jewelry_js_" . $view_brand_code_jw[4]})){$js_brandcode_past_jw_uriage5 = ${"past_brand_jewelry_js_" . $view_brand_code_jw[4]};$js_brandcode_past_jw_honsuu5 = ${"past_brand2_jewelry_js_" . $view_brand_code_jw[4]};} else {$js_brandcode_past_jw_uriage5 = "";$js_brandcode_past_jw_honsuu5 = "";}




    if (PostRequest::has('brand_bumon_select')){ $brand_bumon_select = PostRequest::input('brand_bumon_select');} else {$brand_bumon_select = "";}
    if (PostRequest::has('view_select')){ $view_select = PostRequest::input('view_select');} else {$view_select = "";}



    return view($bladename,['first_day' => $first_day,'last_day' => $last_day,'next_year'=> $next_year,'this_year' => $this_year,'last_year' => $last_year,'two_years_ago' => $two_years_ago,'three_years_ago' => $three_years_ago,'start_year' => $start_year,'start_month' => $start_month,'start_day' => $start_day,'end_year' => $end_year,'end_month' => $end_month,'end_day' => $end_day,'output' => $output,'form_view' => $form_view,'out1' => $out1,'out1_a' => $out1_a,'out1_b' => $out1_b,'out1_c' => $out1_c,'out1_d' => $out1_d,'out2_a' => $out2_a,'out2_b' => $out2_b,'out2_c' => $out2_c,'out2_d' => $out2_d,'out2_e' => $out2_e,'out3_a' => $out3_a,'out3_b' => $out3_b,'out3_c' => $out3_c,'out3_d' => $out3_d,'out3_e' => $out3_e,'out3_f' => $out3_f,'out4_a' => $out4_a,'out4_b' => $out4_b,'all_now_brand_jack_sorce' => $all_now_brand_jack_sorce,'all_past_brand_jack_sorce' => $all_past_brand_jack_sorce,'all_now_brand2_jack_sorce' => $all_now_brand2_jack_sorce,'all_past_brand2_jack_sorce' => $all_past_brand2_jack_sorce/*,'temp5_all_sorce' => $temp5_all_sorce,'temp5_all_sorce2' => $temp5_all_sorce2,'js_web_uriage' => $js_web_uriage,'js_shop_uriage' => $js_shop_uriage,'js_oroshi_uriage' => $js_oroshi_uriage,'past_between_start' => $past_between_start,'past_between_end' => $past_between_end,'past_temp5_all_sorce' => $past_temp5_all_sorce,'past_temp5_all_sorce2' => $past_temp5_all_sorce2,'past_js_web_uriage' => $past_js_web_uriage,'past_js_shop_uriage' => $past_js_shop_uriage,'past_js_oroshi_uriage' => $past_js_oroshi_uriage,'past_js_web_number' => $past_js_web_number,'past_js_shop_number' => $past_js_shop_number,'past_js_oroshi_number' => $past_js_oroshi_number,'js_web_number' => $js_web_number,'js_shop_number' => $js_shop_number,'js_oroshi_number' => $js_oroshi_number,'js_all_month_uriage' => $js_all_month_uriage,'js_past_all_month_uriage' => $js_past_all_month_uriage,'js_all_month_number' => $js_all_month_number,'js_past_all_month_number' => $js_past_all_month_number,'js_web_arari' => $js_web_arari,'js_shop_arari' => $js_shop_arari,'js_oroshi_arari' => $js_oroshi_arari,'js_all_month_arari' => $js_all_month_arari,'past_js_web_arari' => $past_js_web_arari,'past_js_shop_arari' => $past_js_shop_arari,'past_js_oroshi_arari' => $past_js_oroshi_arari,'js_past_all_month_arari' => $js_past_all_month_arari,'temp5_all_sorce3' => $temp5_all_sorce3,'past_temp5_all_sorce3' => $past_temp5_all_sorce3,'search' => $search*/,'js_month' => $js_month,'line_width' => $line_width,'search' => $search,'out5' => $out5,'out5_a' => $out5_a,'out5_b' => $out5_b,'out5_c' => $out5_c,'js_brandname_now_j_uriage1' => $js_brandname_now_j_uriage1,'js_brandname_now_j_uriage2' => $js_brandname_now_j_uriage2,'js_brandname_now_j_uriage3' => $js_brandname_now_j_uriage3,'js_brandname_now_j_uriage4' => $js_brandname_now_j_uriage4,'js_brandname_now_j_uriage5' => $js_brandname_now_j_uriage5,'js_brandcode_now_j_uriage1' => $js_brandcode_now_j_uriage1,'js_brandcode_now_j_uriage2' => $js_brandcode_now_j_uriage2,'js_brandcode_now_j_uriage3' => $js_brandcode_now_j_uriage3,'js_brandcode_now_j_uriage4' => $js_brandcode_now_j_uriage4,'js_brandcode_now_j_uriage5' => $js_brandcode_now_j_uriage5,'js_brandcode_past_j_uriage1' => $js_brandcode_past_j_uriage1,'js_brandcode_past_j_uriage2' => $js_brandcode_past_j_uriage2,'js_brandcode_past_j_uriage3' => $js_brandcode_past_j_uriage3,'js_brandcode_past_j_uriage4' => $js_brandcode_past_j_uriage4,'js_brandcode_past_j_uriage5' => $js_brandcode_past_j_uriage5,'js_brandcode_now_j_honsuu1' => $js_brandcode_now_j_honsuu1,'js_brandcode_now_j_honsuu2' => $js_brandcode_now_j_honsuu2,'js_brandcode_now_j_honsuu3' => $js_brandcode_now_j_honsuu3,'js_brandcode_now_j_honsuu4' => $js_brandcode_now_j_honsuu4,'js_brandcode_now_j_honsuu5' => $js_brandcode_now_j_honsuu5,'js_brandcode_past_j_honsuu1' => $js_brandcode_past_j_honsuu1,'js_brandcode_past_j_honsuu2' => $js_brandcode_past_j_honsuu2,'js_brandcode_past_j_honsuu3' => $js_brandcode_past_j_honsuu3,'js_brandcode_past_j_honsuu4' => $js_brandcode_past_j_honsuu4,'js_brandcode_past_j_honsuu5' => $js_brandcode_past_j_honsuu5,'out5_view' => $out5_view,'js_brandcode_now_b_honsuu1' => $js_brandcode_now_b_honsuu1,'js_brandcode_now_b_honsuu2' => $js_brandcode_now_b_honsuu2,'js_brandcode_now_b_honsuu3' => $js_brandcode_now_b_honsuu3,'js_brandcode_now_b_honsuu4' => $js_brandcode_now_b_honsuu4,'js_brandcode_now_b_honsuu5' => $js_brandcode_now_b_honsuu5,'js_brandcode_past_b_honsuu1' => $js_brandcode_past_b_honsuu1,'js_brandcode_past_b_honsuu2' => $js_brandcode_past_b_honsuu2,'js_brandcode_past_b_honsuu3' => $js_brandcode_past_b_honsuu3,'js_brandcode_past_b_honsuu4' => $js_brandcode_past_b_honsuu4,'js_brandcode_past_b_honsuu5' => $js_brandcode_past_b_honsuu5,'js_brandcode_now_b_uriage1' => $js_brandcode_now_b_uriage1,'js_brandcode_now_b_uriage2' => $js_brandcode_now_b_uriage2,'js_brandcode_now_b_uriage3' => $js_brandcode_now_b_uriage3,'js_brandcode_now_b_uriage4' => $js_brandcode_now_b_uriage4,'js_brandcode_now_b_uriage5' => $js_brandcode_now_b_uriage5,'js_brandcode_past_b_uriage1' => $js_brandcode_past_b_uriage1,'js_brandcode_past_b_uriage2' => $js_brandcode_past_b_uriage2,'js_brandcode_past_b_uriage3' => $js_brandcode_past_b_uriage3,'js_brandcode_past_b_uriage4' => $js_brandcode_past_b_uriage4,'js_brandcode_past_b_uriage5' => $js_brandcode_past_b_uriage5,'js_brandcode_now_jw_honsuu1' => $js_brandcode_now_jw_honsuu1,'js_brandcode_now_jw_honsuu2' => $js_brandcode_now_jw_honsuu2,'js_brandcode_now_jw_honsuu3' => $js_brandcode_now_jw_honsuu3,'js_brandcode_now_jw_honsuu4' => $js_brandcode_now_jw_honsuu4,'js_brandcode_now_jw_honsuu5' => $js_brandcode_now_jw_honsuu5,'js_brandcode_past_jw_honsuu1' => $js_brandcode_past_jw_honsuu1,'js_brandcode_past_jw_honsuu2' => $js_brandcode_past_jw_honsuu2,'js_brandcode_past_jw_honsuu3' => $js_brandcode_past_jw_honsuu3,'js_brandcode_past_jw_honsuu4' => $js_brandcode_past_jw_honsuu4,'js_brandcode_past_jw_honsuu5' => $js_brandcode_past_jw_honsuu5,'js_brandcode_now_jw_uriage1' => $js_brandcode_now_jw_uriage1,'js_brandcode_now_jw_uriage2' => $js_brandcode_now_jw_uriage2,'js_brandcode_now_jw_uriage3' => $js_brandcode_now_jw_uriage3,'js_brandcode_now_jw_uriage4' => $js_brandcode_now_jw_uriage4,'js_brandcode_now_jw_uriage5' => $js_brandcode_now_jw_uriage5,'js_brandcode_past_jw_uriage1' => $js_brandcode_past_jw_uriage1,'js_brandcode_past_jw_uriage2' => $js_brandcode_past_jw_uriage2,'js_brandcode_past_jw_uriage3' => $js_brandcode_past_jw_uriage3,'js_brandcode_past_jw_uriage4' => $js_brandcode_past_jw_uriage4,'js_brandcode_past_jw_uriage5' => $js_brandcode_past_jw_uriage5,'all_now_brand_betty_sorce' => $all_now_brand_betty_sorce,'all_past_brand_betty_sorce' => $all_past_brand_betty_sorce,'all_now_brand2_betty_sorce' => $all_now_brand2_betty_sorce,'all_past_brand2_betty_sorce' => $all_past_brand2_betty_sorce,'all_now_brand_jewelry_sorce' => $all_now_brand_jewelry_sorce,'all_past_brand_jewelry_sorce' => $all_past_brand_jewelry_sorce,'all_now_brand2_jewelry_sorce' => $all_now_brand2_jewelry_sorce,'all_past_brand2_jewelry_sorce' => $all_past_brand2_jewelry_sorce,'js_brandname_now_j_uriage1' => $js_brandname_now_j_uriage1,'js_brandname_now_j_uriage1' => $js_brandname_now_j_uriage1,'js_brandname_now_j_uriage2' => $js_brandname_now_j_uriage2,'js_brandname_now_j_uriage3' => $js_brandname_now_j_uriage3,'js_brandname_now_j_uriage4' => $js_brandname_now_j_uriage4,'js_brandname_now_j_uriage5' => $js_brandname_now_j_uriage5,'js_brandname_now_j_uriage1' => $js_brandname_now_j_uriage1,'js_brandname_now_j_uriage1' => $js_brandname_now_j_uriage1,'js_brandname_now_j_uriage2' => $js_brandname_now_j_uriage2,'js_brandname_now_j_uriage3' => $js_brandname_now_j_uriage3,'js_brandname_now_j_uriage4' => $js_brandname_now_j_uriage4,'js_brandname_now_j_uriage5' => $js_brandname_now_j_uriage5,'js_brandname_now_b_uriage1' => $js_brandname_now_b_uriage1,'js_brandname_now_b_uriage1' => $js_brandname_now_b_uriage1,'js_brandname_now_b_uriage2' => $js_brandname_now_b_uriage2,'js_brandname_now_b_uriage3' => $js_brandname_now_b_uriage3,'js_brandname_now_b_uriage4' => $js_brandname_now_b_uriage4,'js_brandname_now_b_uriage5' => $js_brandname_now_b_uriage5,'js_brandname_now_b_uriage1' => $js_brandname_now_b_uriage1,'js_brandname_now_b_uriage1' => $js_brandname_now_b_uriage1,'js_brandname_now_b_uriage2' => $js_brandname_now_b_uriage2,'js_brandname_now_b_uriage3' => $js_brandname_now_b_uriage3,'js_brandname_now_b_uriage4' => $js_brandname_now_b_uriage4,'js_brandname_now_b_uriage5' => $js_brandname_now_b_uriage5,'js_brandname_now_jw_uriage1' => $js_brandname_now_jw_uriage1,'js_brandname_now_jw_uriage1' => $js_brandname_now_jw_uriage1,'js_brandname_now_jw_uriage2' => $js_brandname_now_jw_uriage2,'js_brandname_now_jw_uriage3' => $js_brandname_now_jw_uriage3,'js_brandname_now_jw_uriage4' => $js_brandname_now_jw_uriage4,'js_brandname_now_jw_uriage5' => $js_brandname_now_jw_uriage5,'js_brandname_now_jw_uriage1' => $js_brandname_now_jw_uriage1,'js_brandname_now_jw_uriage1' => $js_brandname_now_jw_uriage1,'js_brandname_now_jw_uriage2' => $js_brandname_now_jw_uriage2,'js_brandname_now_jw_uriage3' => $js_brandname_now_jw_uriage3,'js_brandname_now_jw_uriage4' => $js_brandname_now_jw_uriage4,'js_brandname_now_jw_uriage5' => $js_brandname_now_jw_uriage5,'brandselect' => $brandselect,'brandselect_b' => $brandselect_b,'brandselect_jw' => $brandselect_jw,'brand_bumon_select' => $brand_bumon_select,'view_select' => $view_select,'out6' => $out6,'out7' => $out7]);
                }






/************************************************************************************************************************************************************************************************************* */
    // DB情報取得（[売上]サマリ用）
/************************************************************************************************************************************************************************************************************* */


    public function db_info_get($a,$b,$c,$d,$e,$f,$g,$h,$j,$k,$l,$m,$n,$o,$p,$q,$r,$s,$t,$u,$v,$w){

        // 「groupBy」にロジックで作成した名称を指定した際のエラー対応（本番だとDB上のカラムに無い名称を「groupBy」するとエラーとなる。このエラーの場合selectに名称指定すると解決するらしいが、恐らくDBに無い名称だと別のエラーとなる。以下の二行を追記する事で対応）
                config(['database.connections.mysql.strict' => false]);
                DB::reconnect();


        $start_year = $a;
        $start_month = $b;
        $start_day = $c;
        $end_year = $d;
        $end_month = $e;
        $end_day = $f;
        $this_year = $g;
        $last_year = $h;
        $two_years_ago = $j;
        $output = $k;
        $out1 = $l;
        $out2 = $m;
        $out3 = $n;
        $out4 = $o;
        $out5 = $p;
        $search = $q;
        $three_years_ago = $r;
        $next_year = $s;
        $first_day = $t;
        $last_day = $u;
        $out6 = $v;
        $out7 = $w;


            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            // DB登録ロジックを実施
            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                

                    /************************************************************************************************************************************************************************************************************* */
                        // 定数管理用（メソッドの呼び出し）start
                    /************************************************************************************************************************************************************************************************************* */
                            $define = $this->define();
                            $def_i = 0;
                            // 各変数にパスやファイル名を代入
                                foreach($define as $def){
                                    if($def_i == 0){ $bladename = $def; }
                                    if($def_i == 1){ $file_pass = $def; }
                                    if($def_i == 2){ $file_pass2 = $def; }
                                    if($def_i == 3){ $file_name = $def; }
                                    if($def_i == 4){ $table_name = $def; }

                                    $def_i++;
                                }
                    /************************************************************************************************************************************************************************************************************* */
                        // 定数管理用（メソッドの呼び出し）end
                    /************************************************************************************************************************************************************************************************************* */
                
                    /************************************************************************************************************************************************************************************************************* */
                        // フォームボタン押下時情報の受け取り start
                    /************************************************************************************************************************************************************************************************************* */

                            // 検索期間を変数に代入
                                $between_start = $start_year . "/" . $start_month . "/" . $start_day ." 00-00:00";
                                $between_end = $end_year . "/" . $end_month . "/" . $end_day ." 23-59:59";
                                $between_start_view = $start_year . "/" . $start_month . "/" . $start_day;
                                $between_end_view = $end_year . "/" . $end_month . "/" . $end_day;


                                $diff_start1 = new DateTime($between_start_view);
                                $diff_end1 = new DateTime($between_end_view);

                                $interval1 = $diff_end1 -> diff($diff_start1);

                                $diff_year1= $interval1 -> y;
                                $diff_month1 = $interval1 -> m;
                                $diff_month1 = $diff_year1 * 12 + $diff_month1;

                            // 「フォーム表示ボタン」フラグ
                                if (PostRequest::has('form_view')) {
                                    $form_view = PostRequest::input('form_view');
                                } else {$form_view = "OFF";}
                            

                            // 「売却区分」フラグ
                                $out1_a = "OFF";
                                $out1_b = "OFF";
                                $out1_c = "OFF";
                                $out1_d = "OFF";
                                if($out1 <> "" && in_array('2',$out1)){ $out1_a = "ON";}
                                if($out1 <> "" && in_array('3',$out1)){ $out1_b = "ON";}
                                if($out1 <> "" && in_array('4',$out1)){ $out1_c = "ON";}
                                if($out1 <> "" && in_array('5',$out1)){ $out1_d = "ON";}
                                
                            // 新中アンフラグ
                                $out2_a = "OFF";
                                $out2_b = "OFF";
                                $out2_c = "OFF";
                                $out2_d = "OFF";
                                $out2_e = "OFF";
                                if($out2 <> "" && in_array('1',$out2)){ $out2_a = "ON";}
                                if($out2 <> "" && in_array('2',$out2)){ $out2_b = "ON";}
                                if($out2 <> "" && in_array('3',$out2)){ $out2_c = "ON";}
                                if($out2 <> "" && in_array('4',$out2)){ $out2_d = "ON";}
                                if($out2 <> "" && in_array('5',$out2)){ $out2_e = "ON";}

                            // 通販サイトフラグ
                                $out3_a = "OFF";
                                $out3_b = "OFF";
                                $out3_c = "OFF";
                                $out3_d = "OFF";
                                $out3_e = "OFF";
                                $out3_f = "OFF";
                                if($out3 <> "" && in_array('1',$out3)){ $out3_a = "ON";}
                                if($out3 <> "" && in_array('2',$out3)){ $out3_b = "ON";}
                                if($out3 <> "" && in_array('3',$out3)){ $out3_c = "ON";}
                                if($out3 <> "" && in_array('4',$out3)){ $out3_d = "ON";}
                                if($out3 <> "" && in_array('5',$out3)){ $out3_e = "ON";}
                                if($out3 <> "" && in_array('6',$out3)){ $out3_f = "ON";}
                                
                            // 免税フラグ
                                $out4_a = "OFF";
                                $out4_b = "OFF";
                                if($out4 <> "" && in_array('1',$out4)){ $out4_a = "ON";}
                                if($out4 <> "" && in_array('2',$out4)){ $out4_b = "ON";}
                                
                            // ブランドフラグ
                                $out5_a = "OFF";
                                $out5_b = "OFF";
                                $out5_c = "OFF";
                                if($out5 <> "" && in_array('2',$out5)){ $out5_a = "ON";}
                                if($out5 <> "" && in_array('3',$out5)){ $out5_b = "ON";}
                                if($out5 <> "" && in_array('4',$out5)){ $out5_c = "ON";}


                    /************************************************************************************************************************************************************************************************************* */
                        // フォームボタン押下時情報の受け取り end
                    /************************************************************************************************************************************************************************************************************* */


                    /************************************************************************************************************************************************************************************************************* */
                        // 検索期間の月数だけ遡った過去の期間を取得 start
                    /************************************************************************************************************************************************************************************************************* */


                            // 開始と終了期間の差分（～カ月）を取得                        
                                $start = $start_year . "-" . $start_month . "-" . $start_day;
                                $end = $end_year . "-" . $end_month . "-" . $end_day;
                                $diff_start = new DateTime($start);
                                $diff_end = new DateTime($end);

                                $interval = $diff_end -> diff($diff_start);

                                $diff_year = $interval -> y;
                                $diff_month = $interval -> m;
                                $diff_month = $diff_year * 12 + $diff_month;
                                //echo $diff_month . "カ月<br>";
                            // 差分の月だけ遡った過去の期間を取得
                                // 検索開始日                
                                    $start_now = date($start_year. "-" . $start_month. "-" . $start_day);
                                // 過去開始日
                                    //$start_past = date("Y-m-d", strtotime($start_now . " -" . $diff_month . " month"));
                                    $past_between_start = date("Y-m-d", strtotime($start_now . " -" . ($diff_month + 1) . " month"));
                                    $past_between_start_view = date("Y-m", strtotime($start_now . " -" . ($diff_month +1) . " month"));
                                // 検索終了日
                                    $end_now = date($end_year. "-" . $end_month. "-" . $end_day);
                                // 過去終了日
                                    //$end_past = date("Y-m-d", strtotime($end_now . " -" . $diff_month . " month"));
                                    $past_between_end = date("Y-m-d", strtotime($start_now . " -1 day"));
                                    $past_between_end_view = date("Y-m", strtotime($start_now . " -1 month"));

                                // 過去期間の月初日を配列へ代入（該当月のデータ登録が無い場合、JS代入値が空になってグラフがズレてしまう事を回避するため0代入ロジックに使う）
                                    // 配列版
                                        $manth_now_array = array();
                                        $manth_past_array = array();
                                    // カンマ区切りの文字列版
                                        $temp1_web_manthly_data = "";
                                        $temp1_web_manthly_data2 = "";
                                        $temp1_web_manthly_data3 = "";
                                        $past_temp1_web_manthly_data = "";
                                        $past_temp1_web_manthly_data2 = "";
                                        $past_temp1_web_manthly_data3 = "";
                                        $temp1_shop_manthly_data = "";
                                        $temp1_shop_manthly_data2 = "";
                                        $temp1_shop_manthly_data3 = "";
                                        $past_temp1_shop_manthly_data = "";
                                        $past_temp1_shop_manthly_data2 = "";
                                        $past_temp1_shop_manthly_data3 = "";
                                        $temp1_oroshi_manthly_data = "";
                                        $temp1_oroshi_manthly_data2 = "";
                                        $temp1_oroshi_manthly_data3 = "";
                                        $past_temp1_oroshi_manthly_data = "";
                                        $past_temp1_oroshi_manthly_data2 = "";
                                        $past_temp1_oroshi_manthly_data3 = "";
                                    for($past_ii = 0;  $past_ii <= $diff_month; $past_ii++){
                                        if($past_ii == 0){
                                            // 現在用
                                                $manth_now = date("Y-m", strtotime($start_now));
                                            // 過去用
                                                $past_manth = $past_between_start;
                                                $past_manth2 = mb_substr($past_between_start,0,-3);
                                        } else {
                                            // 現在用
                                                $manth_now = date("Y-m", strtotime($manth_now . " 1 month"));
                                            // 過去用
                                                $past_manth = date("Y-m-d", strtotime($past_manth . " 1 month"));
                                                $past_manth2 = date("Y-m", strtotime($past_manth2 . " 1 month"));
                                        }
                                        // 現在用
                                            array_push($manth_now_array,$manth_now);
                                        // 過去用
                                            array_push($manth_past_array,$past_manth);
                                            $temp1_web_manthly_data .= $manth_now . ",";
                                            $temp1_web_manthly_data2 .= $manth_now . ",";
                                            $temp1_web_manthly_data3 .= $manth_now . ",";
                                            $past_temp1_web_manthly_data .= $past_manth2 . ",";
                                            $past_temp1_web_manthly_data2 .= $past_manth2 . ",";
                                            $past_temp1_web_manthly_data3 .= $past_manth2 . ",";
                                            $temp1_shop_manthly_data .= $manth_now . ",";
                                            $temp1_shop_manthly_data2 .= $manth_now . ",";
                                            $temp1_shop_manthly_data3 .= $manth_now . ",";
                                            $past_temp1_shop_manthly_data .= $past_manth2 . ",";
                                            $past_temp1_shop_manthly_data2 .= $past_manth2 . ",";
                                            $past_temp1_shop_manthly_data3 .= $past_manth2 . ",";
                                            $temp1_oroshi_manthly_data .= $manth_now . ",";
                                            $temp1_oroshi_manthly_data2 .= $manth_now . ",";
                                            $temp1_oroshi_manthly_data3 .= $manth_now . ",";
                                            $past_temp1_oroshi_manthly_data .= $past_manth2 . ",";
                                            $past_temp1_oroshi_manthly_data2 .= $past_manth2 . ",";
                                            $past_temp1_oroshi_manthly_data3 .= $past_manth2 . ",";

                                    }
                                    $temp1_web_manthly_data = trim($temp1_web_manthly_data ,",");
                                    $temp1_web_manthly_data2 = trim($temp1_web_manthly_data2 ,",");
                                    $temp1_web_manthly_data3 = trim($temp1_web_manthly_data3 ,",");
                                    $past_temp1_web_manthly_data = trim($past_temp1_web_manthly_data ,",");
                                    $past_temp1_web_manthly_data2 = trim($past_temp1_web_manthly_data2 ,",");
                                    $past_temp1_web_manthly_data3 = trim($past_temp1_web_manthly_data3 ,",");
                                    $temp1_shop_manthly_data = trim($temp1_shop_manthly_data ,",");
                                    $temp1_shop_manthly_data2 = trim($temp1_shop_manthly_data2 ,",");
                                    $temp1_shop_manthly_data3 = trim($temp1_shop_manthly_data3 ,",");
                                    $past_temp1_shop_manthly_data = trim($past_temp1_shop_manthly_data ,",");
                                    $past_temp1_shop_manthly_data2 = trim($past_temp1_shop_manthly_data2 ,",");
                                    $past_temp1_shop_manthly_data3 = trim($past_temp1_shop_manthly_data3 ,",");
                                    $temp1_oroshi_manthly_data = trim($temp1_oroshi_manthly_data ,",");
                                    $temp1_oroshi_manthly_data2 = trim($temp1_oroshi_manthly_data2 ,",");
                                    $temp1_oroshi_manthly_data3 = trim($temp1_oroshi_manthly_data3 ,",");
                                    $past_temp1_oroshi_manthly_data = trim($past_temp1_oroshi_manthly_data ,",");
                                    $past_temp1_oroshi_manthly_data2 = trim($past_temp1_oroshi_manthly_data2 ,",");
                                    $past_temp1_oroshi_manthly_data3 = trim($past_temp1_oroshi_manthly_data3 ,",");


                    /************************************************************************************************************************************************************************************************************* */
                        // 検索期間の月数だけ遡った過去の期間を取得 end
                    /************************************************************************************************************************************************************************************************************* */


// 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
    // 当月の最終日
        $last_day2 = date('Y-m-d', strtotime('last day of' . $last_day));
    // データ格納最終日がその月の最終日と一致するか否かでフラグを作成（一致しない場合は平均の計算に含めないようにするため）
        if($last_day2 <> $last_day){ $last_nodata_flag = "ON"; } else { $last_nodata_flag = "OFF"; }


// 【進捗率の取得】
                                        

                                        /************************************************************************************************************************************************************************************************************* */
                                            // 検索期間の最初の日を求める（最終データ格納月の月初日）start
                                        /************************************************************************************************************************************************************************************************************* */
                                                    $last_day_array = explode('-',$last_day);
                                                    $i = 0;
                                                    $last_day_top = "";
                                                    foreach($last_day_array as $var){
                                                        // 年月
                                                            if($i <> 2){
                                                                $last_day_top .= $var . "-";
                                                            }
                                                        // 年
                                                            if($i == 0){
                                                                $last_year_last = $var;
                                                            }
                                                        // 月
                                                            if($i == 1){
                                                                $last_month_last = $var;
                                                            }
                                                        // 日
                                                            if($i == 2){
                                                                $last_day_last = $var;
                                                            }
                                                        $i++;
                                                    }
                                                    // 年月に月初日を加える
                                                        $last_day_top .= "01";
                                                    // 当月の最終日
                                                        $last_day_last2 = date("d", strtotime($last_day_top . " +1 month -1day"));

                                        /************************************************************************************************************************************************************************************************************* */
                                            // 検索期間の最初の日を求める（最終データ格納月の月初日）end
                                        /************************************************************************************************************************************************************************************************************* */

                                        /************************************************************************************************************************************************************************************************************* */
                                            // 比較年月取得（最終データ格納年月の先月） start
                                        /************************************************************************************************************************************************************************************************************* */
                                                // 先月初日
                                                    $last_month_top = date("Y-m-d", strtotime($last_day_top . " -1 month"));
                                                // 先月最終日
                                                    $last_month = date("Y-m-d", strtotime($last_day_top . " -1day"));
                                        
                                        /************************************************************************************************************************************************************************************************************* */
                                            // 比較年月取得（最終データ格納年月の先月） end
                                        /************************************************************************************************************************************************************************************************************* */

                                        /************************************************************************************************************************************************************************************************************* */
                                            // 比較年月取得（最終データ格納年月から検索期間の月数だけ遡った年月） start
                                        /************************************************************************************************************************************************************************************************************* */

                                                // 差分の月だけ遡った過去の期間を取得
                                                    // 過去開始日（最終データ格納年月から検索期間を遡った年月日を取得）
                                                        $past_between_start_progress = date("Y-m-d", strtotime($last_day_top . " -" . ($diff_month + 1) . " month"));
                                                    // 過去終了日（上記年月日の月末日を取得）
                                                        $past_between_end_progress = date("Y-m-d", strtotime($past_between_start_progress . " +1 month -1day"));
                                        
                                        /************************************************************************************************************************************************************************************************************* */
                                            // 比較年月取得（最終データ格納年月から検索期間の月数だけ遡った年月） end
                                        /************************************************************************************************************************************************************************************************************* */


                                       
                                        
                                        /************************************************************************************************************************************************************************************************************* */
                                            // 最終データ格納月のデータ取得　start
                                        /************************************************************************************************************************************************************************************************************* */


                                                            // DB検索（店舗値）スタート
                                                                $shop_progress = DB::table($table_name) 
                                                                // 月毎にグループ化して値を分けるための処理
                                                                    ->select([
                                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS shop_month'),
                                                                        \DB::raw("SUM(uriagekingaku) AS shop_uriage"),
                                                                        \DB::raw("SUM(uriagesuu) AS shop_number"),
                                                                        \DB::raw("SUM(ararikingaku) AS shop_arari"),
                                                                    ])
                                                                    // 条件（売上部門が店舗）
                                                                        ->where('baikyakukubun',1)
                                                                    // 条件（期間の指定）
                                                                        ->whereBetween($table_name . '.uriage', [$last_day_top, $last_day])
                                                                        
                                                                    // 条件（分類名）
                                                                        ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                            // 条件（商品区分分類名が新品）
                                                                                if($out2_a == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                }
                                                                            // 条件（商品区分分類名が中古）
                                                                                if($out2_b == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                }
                                                                            // 条件（商品区分分類名がアンティーク）
                                                                                if($out2_c == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                }
                                                                            // 条件（商品区分分類名がその他）
                                                                                if($out2_d == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                }
                                                                            // 条件（商品区分分類名が修理）
                                                                                if($out2_e == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（通販区分）
                                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                                            $query->orWhere('tsuuhankubun','');

                                                                            // 条件（通販区分が自社）
                                                                                if($out3_a == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',1);
                                                                                }
                                                                            // 条件（通販区分が楽天）
                                                                                if($out3_b == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',2);
                                                                                }
                                                                            // 条件（通販区分がヤフー）
                                                                                if($out3_c == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',3);
                                                                                }
                                                                            // 条件（通販区分が電話・雑誌）
                                                                                if($out3_d == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',5);
                                                                                }
                                                                            // 条件（通販区分がYオークション）
                                                                                if($out3_e == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',4);
                                                                                }
                                                                            // 条件（通販区分が修理品返送）
                                                                                if($out3_f == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',9);
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（免税）
                                                                    ->where(function ($query) use ($out4_a,$out4_b) {
                                                                            // 条件（免税区分が0:対象外）
                                                                                if($out4_a == "ON"){
                                                                                    $query->orwhere("menzei","like","%対象外%");
                                                                                }
                                                                            // 条件（免税区分が1:免税）
                                                                                if($out4_b == "ON"){
                                                                                    $query->orwhere("menzei","like","%免税%");
                                                                                }
                                                                    })
                                                                // 条件（扱い部門）
                                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                            $query->orWhere('bumonmei','');

                                                                            // 条件（扱い部門がジャック）
                                                                                if($out5_a == "ON"){
                                                                                    $query->orWhere('bumonmei','Jackroad');
                                                                                }
                                                                            // 条件（扱い部門がベティー）
                                                                                if($out5_b == "ON"){
                                                                                    $query->orWhere('bumonmei','BettyRoad');
                                                                                }
                                                                            // 条件（扱い部門がジュエリー）
                                                                                if($out5_c == "ON"){
                                                                                    $query->orWhere('bumonmei','Jewelry');
                                                                                }
                                                                
                                                                    })
                                                                // ソート順指定
                                                                    ->orderBy('uriage', 'asc')
                                                                    ->get();
                                                                // クエリビルダスタート
                                                                    // 変数リセット
                                                                        $shop_sum_uriage_progress = "";
                                                                        $i2 = 0;
                                                                        foreach ($shop_progress as $shop_buy_progress) {
                                                                            // 各月卸売上
                                                                            $shop_sum_uriage_progress = $shop_buy_progress -> shop_uriage;
                                                                            $shop_sum_number_progress = $shop_buy_progress -> shop_number;
                                                                            $shop_sum_arari_progress  = $shop_buy_progress -> shop_arari;
                                                                            $i2++;
                                                                        }

                                                            // DB検索（店舗値）スタート
                                                                $web_progress = DB::table($table_name) 
                                                                // 月毎にグループ化して値を分けるための処理
                                                                    ->select([
                                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS web_month'),
                                                                        \DB::raw("SUM(uriagekingaku) AS web_uriage"),
                                                                        \DB::raw("SUM(uriagesuu) AS web_number"),
                                                                        \DB::raw("SUM(ararikingaku) AS web_arari"),
                                                                ])
                                                                    // 条件（売上部門がWEB）
                                                                        ->where('baikyakukubun',2)
                                                                    // 条件（期間の指定）
                                                                        ->whereBetween($table_name
                                                                        
                                                                        . '.uriage', [$last_day_top, $last_day])
                                                                        
                                                                    // 条件（分類名）
                                                                        ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                            // 条件（商品区分分類名が新品）
                                                                                if($out2_a == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                }
                                                                            // 条件（商品区分分類名が中古）
                                                                                if($out2_b == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                }
                                                                            // 条件（商品区分分類名がアンティーク）
                                                                                if($out2_c == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                }
                                                                            // 条件（商品区分分類名がその他）
                                                                                if($out2_d == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                }
                                                                            // 条件（商品区分分類名が修理）
                                                                                if($out2_e == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（通販区分）
                                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                                            $query->orWhere('tsuuhankubun','');

                                                                            // 条件（通販区分が自社）
                                                                                if($out3_a == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',1);
                                                                                }
                                                                            // 条件（通販区分が楽天）
                                                                                if($out3_b == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',2);
                                                                                }
                                                                            // 条件（通販区分がヤフー）
                                                                                if($out3_c == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',3);
                                                                                }
                                                                            // 条件（通販区分が電話・雑誌）
                                                                                if($out3_d == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',5);
                                                                                }
                                                                            // 条件（通販区分がYオークション）
                                                                                if($out3_e == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',4);
                                                                                }
                                                                            // 条件（通販区分が修理品返送）
                                                                                if($out3_f == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',9);
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（免税）
                                                                    ->where(function ($query) use ($out4_a,$out4_b) {
                                                                            // 条件（免税区分が0:対象外）
                                                                                if($out4_a == "ON"){
                                                                                    $query->orwhere("menzei","like","%対象外%");
                                                                                }
                                                                            // 条件（免税区分が1:免税）
                                                                                if($out4_b == "ON"){
                                                                                    $query->orwhere("menzei","like","%免税%");
                                                                                }
                                                                    })
                                                                // 条件（扱い部門）
                                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                            $query->orWhere('bumonmei','');

                                                                            // 条件（扱い部門がジャック）
                                                                                if($out5_a == "ON"){
                                                                                    $query->orWhere('bumonmei','Jackroad');
                                                                                }
                                                                            // 条件（扱い部門がベティー）
                                                                                if($out5_b == "ON"){
                                                                                    $query->orWhere('bumonmei','BettyRoad');
                                                                                }
                                                                            // 条件（扱い部門がジュエリー）
                                                                                if($out5_c == "ON"){
                                                                                    $query->orWhere('bumonmei','Jewelry');
                                                                                }
                                                                
                                                                    })
                                                                // ソート順指定
                                                                    ->orderBy('uriage', 'asc')
                                                                    ->get();
                                                                // クエリビルダスタート
                                                                    // 変数リセット
                                                                        $web_sum_uriage_progress = "";
                                                                        $i2 = 0;
                                                                        foreach ($web_progress as $web_buy_progress) {
                                                                            // 各月卸売上
                                                                            $web_sum_uriage_progress = $web_buy_progress -> web_uriage;
                                                                            $web_sum_number_progress = $web_buy_progress -> web_number;
                                                                            $web_sum_arari_progress  = $web_buy_progress -> web_arari;
                                                                            $i2++;
                                                                        }




                                                            // DB検索（卸値）スタート
                                                                $oroshi_sum_uriage_progress = "";
                                                                $oroshi_sum_number_progress = "";
                                                                $oroshi_sum_arari_progress = "";

                                                                if($out1_c == "ON"){
                                                                        $oroshi_progress = DB::table($table_name) 
                                                                        // 月毎にグループ化して値を分けるための処理
                                                                            ->select([
                                                                                \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS oroshi_month'),
                                                                                \DB::raw("SUM(uriagekingaku) AS oroshi_uriage"),
                                                                                \DB::raw("SUM(uriagesuu) AS oroshi_number"),
                                                                                \DB::raw("SUM(ararikingaku) AS oroshi_arari"),
                                                                        ])
                                                                        // 条件（売上部門が卸）
                                                                                ->where(function ($query) use ($out1_d) {
                                                                                        if($out1_d == "ON"){
                                                                                            // 「卸」と空白（おそらく入力間違い分）を含む場合を取得（条件：「店舗」「通販」以外）
                                                                                                $query->Where([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2]]);
                                                                                        } else {
                                                                                            // 「卸」のみを取得
                                                                                                $query->where('baikyakukubun',3);
                                                                                        }
                                                                                })
                                                                        // 条件（期間の指定）
                                                                            ->whereBetween($table_name . '.uriage', [$last_day_top, $last_day])
                                                                                
                                                                            // 条件（分類名）
                                                                                ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                                    // 条件（商品区分分類名が新品）
                                                                                        if($out2_a == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が中古）
                                                                                        if($out2_b == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がアンティーク）
                                                                                        if($out2_c == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がその他）
                                                                                        if($out2_d == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が修理）
                                                                                        if($out2_e == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                        }
                                                                            
                                                                            })
                                                                        // 条件（通販区分）
                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                                                    $query->orWhere('tsuuhankubun','');

                                                                                    // 条件（通販区分が自社）
                                                                                        if($out3_a == "ON"){
                                                                                            $query->orWhere('tsuuhankubun',1);
                                                                                        }
                                                                                    // 条件（通販区分が楽天）
                                                                                        if($out3_b == "ON"){
                                                                                            $query->orWhere('tsuuhankubun',2);
                                                                                        }
                                                                                    // 条件（通販区分がヤフー）
                                                                                        if($out3_c == "ON"){
                                                                                            $query->orWhere('tsuuhankubun',3);
                                                                                        }
                                                                                    // 条件（通販区分が電話・雑誌）
                                                                                        if($out3_d == "ON"){
                                                                                            $query->orWhere('tsuuhankubun',5);
                                                                                        }
                                                                                    // 条件（通販区分がYオークション）
                                                                                        if($out3_e == "ON"){
                                                                                            $query->orWhere('tsuuhankubun',4);
                                                                                        }
                                                                                    // 条件（通販区分が修理品返送）
                                                                                        if($out3_f == "ON"){
                                                                                            $query->orWhere('tsuuhankubun',9);
                                                                                        }
                                                                            
                                                                            })
                                                                        // 条件（免税）
                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                    // 条件（免税区分が0:対象外）
                                                                                        if($out4_a == "ON"){
                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                        }
                                                                                    // 条件（免税区分が1:免税）
                                                                                        if($out4_b == "ON"){
                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                        }
                                                                            })
                                                                        // 条件（扱い部門）
                                                                            ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                                    $query->orWhere('bumonmei','');

                                                                                    // 条件（扱い部門がジャック）
                                                                                        if($out5_a == "ON"){
                                                                                            $query->orWhere('bumonmei','Jackroad');
                                                                                        }
                                                                                    // 条件（扱い部門がベティー）
                                                                                        if($out5_b == "ON"){
                                                                                            $query->orWhere('bumonmei','BettyRoad');
                                                                                        }
                                                                                    // 条件（扱い部門がジュエリー）
                                                                                        if($out5_c == "ON"){
                                                                                            $query->orWhere('bumonmei','Jewelry');
                                                                                        }
                                                                        
                                                                            })
                                                                        // ソート順指定
                                                                            ->orderBy('uriage', 'asc')
                                                                            ->get();
                                                                        // クエリビルダスタート
                                                                            // 変数リセット
                                                                                $oroshi_sum_uriage_progress = "";
                                                                                $i2 = 0;
                                                                                foreach ($oroshi_progress as $oroshi_buy_progress) {
                                                                                    // 各月卸売上
                                                                                    $oroshi_sum_uriage_progress = $oroshi_buy_progress -> oroshi_uriage;
                                                                                    $oroshi_sum_number_progress = $oroshi_buy_progress -> oroshi_number;
                                                                                    $oroshi_sum_arari_progress  = $oroshi_buy_progress -> oroshi_arari;
                                                                                    $i2++;
                                                                                }
                                                                }


                                        /************************************************************************************************************************************************************************************************************* */
                                            // 最終データ格納月のデータ取得　end
                                        /************************************************************************************************************************************************************************************************************* */
                                                    
                                        
                                        /************************************************************************************************************************************************************************************************************* */
                                            // 先月のデータ取得（最終データ格納年月比) start
                                        /************************************************************************************************************************************************************************************************************* */
                                        
                                                            // DB検索（店舗値）スタート
                                                                $shop_progress2 = DB::table($table_name) 
                                                                // 月毎にグループ化して値を分けるための処理
                                                                    ->select([
                                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS shop_month2'),
                                                                        \DB::raw("SUM(uriagekingaku) AS shop_uriage2"),
                                                                        \DB::raw("SUM(uriagesuu) AS shop_number2"),
                                                                        \DB::raw("SUM(ararikingaku) AS shop_arari2"),
                                                                    ])
                                                                    // 条件（売上部門が店舗）
                                                                        ->where('baikyakukubun',1)
                                                                    // 条件（期間の指定）
                                                                        ->whereBetween($table_name . '.uriage', [$last_month_top, $last_month])
                                                                        
                                                                    // 条件（分類名）
                                                                        ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                            // 条件（商品区分分類名が新品）
                                                                                if($out2_a == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                }
                                                                            // 条件（商品区分分類名が中古）
                                                                                if($out2_b == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                }
                                                                            // 条件（商品区分分類名がアンティーク）
                                                                                if($out2_c == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                }
                                                                            // 条件（商品区分分類名がその他）
                                                                                if($out2_d == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                }
                                                                            // 条件（商品区分分類名が修理）
                                                                                if($out2_e == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（通販区分）
                                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                                            $query->orWhere('tsuuhankubun','');

                                                                            // 条件（通販区分が自社）
                                                                                if($out3_a == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',1);
                                                                                }
                                                                            // 条件（通販区分が楽天）
                                                                                if($out3_b == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',2);
                                                                                }
                                                                            // 条件（通販区分がヤフー）
                                                                                if($out3_c == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',3);
                                                                                }
                                                                            // 条件（通販区分が電話・雑誌）
                                                                                if($out3_d == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',5);
                                                                                }
                                                                            // 条件（通販区分がYオークション）
                                                                                if($out3_e == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',4);
                                                                                }
                                                                            // 条件（通販区分が修理品返送）
                                                                                if($out3_f == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',9);
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（免税）
                                                                    ->where(function ($query) use ($out4_a,$out4_b) {
                                                                            // 条件（免税区分が0:対象外）
                                                                                if($out4_a == "ON"){
                                                                                    $query->orwhere("menzei","like","%対象外%");
                                                                                }
                                                                            // 条件（免税区分が1:免税）
                                                                                if($out4_b == "ON"){
                                                                                    $query->orwhere("menzei","like","%免税%");
                                                                                }
                                                                    })
                                                                // 条件（扱い部門）
                                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                            $query->orWhere('bumonmei','');

                                                                            // 条件（扱い部門がジャック）
                                                                                if($out5_a == "ON"){
                                                                                    $query->orWhere('bumonmei','Jackroad');
                                                                                }
                                                                            // 条件（扱い部門がベティー）
                                                                                if($out5_b == "ON"){
                                                                                    $query->orWhere('bumonmei','BettyRoad');
                                                                                }
                                                                            // 条件（扱い部門がジュエリー）
                                                                                if($out5_c == "ON"){
                                                                                    $query->orWhere('bumonmei','Jewelry');
                                                                                }
                                                                
                                                                    })
                                                                // ソート順指定
                                                                    ->orderBy('uriage', 'asc')
                                                                    ->get();
                                                                // クエリビルダスタート
                                                                    // 変数リセット
                                                                        $shop_sum_uriage_progress2 = "";
                                                                        $i2 = 0;
                                                                        foreach ($shop_progress2 as $shop_buy_progress2) {
                                                                            // 各月卸売上
                                                                            $shop_sum_uriage_progress2 = $shop_buy_progress2 -> shop_uriage2;
                                                                            $shop_sum_number_progress2 = $shop_buy_progress2 -> shop_number2;
                                                                            $shop_sum_arari_progress2  = $shop_buy_progress2 -> shop_arari2;
                                                                            $i2++;
                                                                        }

                                                            // DB検索（店舗値）スタート
                                                                $web_progress2 = DB::table($table_name) 
                                                                // 月毎にグループ化して値を分けるための処理
                                                                    ->select([
                                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS web_month2'),
                                                                        \DB::raw("SUM(uriagekingaku) AS web_uriage2"),
                                                                        \DB::raw("SUM(uriagesuu) AS web_number2"),
                                                                        \DB::raw("SUM(ararikingaku) AS web_arari2"),
                                                                ])
                                                                    // 条件（売上部門がWEB）
                                                                        ->where('baikyakukubun',2)
                                                                    // 条件（期間の指定）
                                                                        ->whereBetween($table_name . '.uriage', [$last_month_top, $last_month])
                                                                        
                                                                    // 条件（分類名）
                                                                        ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                            // 条件（商品区分分類名が新品）
                                                                                if($out2_a == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                }
                                                                            // 条件（商品区分分類名が中古）
                                                                                if($out2_b == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                }
                                                                            // 条件（商品区分分類名がアンティーク）
                                                                                if($out2_c == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                }
                                                                            // 条件（商品区分分類名がその他）
                                                                                if($out2_d == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                }
                                                                            // 条件（商品区分分類名が修理）
                                                                                if($out2_e == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（通販区分）
                                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                                            $query->orWhere('tsuuhankubun','');

                                                                            // 条件（通販区分が自社）
                                                                                if($out3_a == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',1);
                                                                                }
                                                                            // 条件（通販区分が楽天）
                                                                                if($out3_b == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',2);
                                                                                }
                                                                            // 条件（通販区分がヤフー）
                                                                                if($out3_c == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',3);
                                                                                }
                                                                            // 条件（通販区分が電話・雑誌）
                                                                                if($out3_d == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',5);
                                                                                }
                                                                            // 条件（通販区分がYオークション）
                                                                                if($out3_e == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',4);
                                                                                }
                                                                            // 条件（通販区分が修理品返送）
                                                                                if($out3_f == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',9);
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（免税）
                                                                    ->where(function ($query) use ($out4_a,$out4_b) {
                                                                            // 条件（免税区分が0:対象外）
                                                                                if($out4_a == "ON"){
                                                                                    $query->orwhere("menzei","like","%対象外%");
                                                                                }
                                                                            // 条件（免税区分が1:免税）
                                                                                if($out4_b == "ON"){
                                                                                    $query->orwhere("menzei","like","%免税%");
                                                                                }
                                                                    })
                                                                // 条件（扱い部門）
                                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                            $query->orWhere('bumonmei','');

                                                                            // 条件（扱い部門がジャック）
                                                                                if($out5_a == "ON"){
                                                                                    $query->orWhere('bumonmei','Jackroad');
                                                                                }
                                                                            // 条件（扱い部門がベティー）
                                                                                if($out5_b == "ON"){
                                                                                    $query->orWhere('bumonmei','BettyRoad');
                                                                                }
                                                                            // 条件（扱い部門がジュエリー）
                                                                                if($out5_c == "ON"){
                                                                                    $query->orWhere('bumonmei','Jewelry');
                                                                                }
                                                                
                                                                    })
                                                                // ソート順指定
                                                                    ->orderBy('uriage', 'asc')
                                                                    ->get();
                                                                // クエリビルダスタート
                                                                    // 変数リセット
                                                                        $web_sum_uriage_progress2 = "";
                                                                        $i2 = 0;
                                                                        foreach ($web_progress2 as $web_buy_progress2) {
                                                                            // 各月卸売上
                                                                            $web_sum_uriage_progress2 = $web_buy_progress2 -> web_uriage2;
                                                                            $web_sum_number_progress2 = $web_buy_progress2 -> web_number2;
                                                                            $web_sum_arari_progress2  = $web_buy_progress2 -> web_arari2;
                                                                            $i2++;
                                                                        }




                                                            // DB検索（卸値）スタート
                                                                $oroshi_sum_uriage_progress2 = "";
                                                                $oroshi_sum_number_progress2 = "";
                                                                $oroshi_sum_arari_progress2 = "";
                                                        
                                                                if($out1_c == "ON"){                                                                
                                                                        $oroshi_progress2 = DB::table($table_name) 
                                                                        // 月毎にグループ化して値を分けるための処理
                                                                            ->select([
                                                                                \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS oroshi_month2'),
                                                                                \DB::raw("SUM(uriagekingaku) AS oroshi_uriage2"),
                                                                                \DB::raw("SUM(uriagesuu) AS oroshi_number2"),
                                                                                \DB::raw("SUM(ararikingaku) AS oroshi_arari2"),
                                                                        ])
                                                                        // 条件（売上部門が卸）
                                                                                ->where(function ($query) use ($out1_d) {
                                                                                        if($out1_d == "ON"){
                                                                                            // 「卸」と空白（おそらく入力間違い分）を含む場合を取得（条件：「店舗」「通販」以外）
                                                                                                $query->Where([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2]]);
                                                                                        } else {
                                                                                            // 「卸」のみを取得
                                                                                                $query->where('baikyakukubun',3);
                                                                                        }
                                                                                })
                                                                        // 条件（期間の指定）
                                                                            ->whereBetween($table_name . '.uriage', [$last_month_top, $last_month])
                                                                                
                                                                            // 条件（分類名）
                                                                                ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                                    // 条件（商品区分分類名が新品）
                                                                                        if($out2_a == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が中古）
                                                                                        if($out2_b == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がアンティーク）
                                                                                        if($out2_c == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がその他）
                                                                                        if($out2_d == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が修理）
                                                                                        if($out2_e == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                        }
                                                                            
                                                                            })
                                                                        // 条件（通販区分）
                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                                                    $query->orWhere('tsuuhankubun','');

                                                                                    // 条件（通販区分が自社）
                                                                                        if($out3_a == "ON"){
                                                                                            $query->orWhere('tsuuhankubun',1);
                                                                                        }
                                                                                    // 条件（通販区分が楽天）
                                                                                        if($out3_b == "ON"){
                                                                                            $query->orWhere('tsuuhankubun',2);
                                                                                        }
                                                                                    // 条件（通販区分がヤフー）
                                                                                        if($out3_c == "ON"){
                                                                                            $query->orWhere('tsuuhankubun',3);
                                                                                        }
                                                                                    // 条件（通販区分が電話・雑誌）
                                                                                        if($out3_d == "ON"){
                                                                                            $query->orWhere('tsuuhankubun',5);
                                                                                        }
                                                                                    // 条件（通販区分がYオークション）
                                                                                        if($out3_e == "ON"){
                                                                                            $query->orWhere('tsuuhankubun',4);
                                                                                        }
                                                                                    // 条件（通販区分が修理品返送）
                                                                                        if($out3_f == "ON"){
                                                                                            $query->orWhere('tsuuhankubun',9);
                                                                                        }
                                                                            
                                                                            })
                                                                        // 条件（免税）
                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                    // 条件（免税区分が0:対象外）
                                                                                        if($out4_a == "ON"){
                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                        }
                                                                                    // 条件（免税区分が1:免税）
                                                                                        if($out4_b == "ON"){
                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                        }
                                                                            })
                                                                        // 条件（扱い部門）
                                                                            ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                                    $query->orWhere('bumonmei','');

                                                                                    // 条件（扱い部門がジャック）
                                                                                        if($out5_a == "ON"){
                                                                                            $query->orWhere('bumonmei','Jackroad');
                                                                                        }
                                                                                    // 条件（扱い部門がベティー）
                                                                                        if($out5_b == "ON"){
                                                                                            $query->orWhere('bumonmei','BettyRoad');
                                                                                        }
                                                                                    // 条件（扱い部門がジュエリー）
                                                                                        if($out5_c == "ON"){
                                                                                            $query->orWhere('bumonmei','Jewelry');
                                                                                        }
                                                                        
                                                                            })
                                                                        // ソート順指定
                                                                            ->orderBy('uriage', 'asc')
                                                                            ->get();
                                                                        // クエリビルダスタート
                                                                            // 変数リセット
                                                                                $oroshi_sum_uriage_progress2 = "";
                                                                                $i2 = 0;
                                                                                foreach ($oroshi_progress2 as $oroshi_buy_progress2) {
                                                                                    // 各月卸売上
                                                                                    $oroshi_sum_uriage_progress2 = $oroshi_buy_progress2 -> oroshi_uriage2;
                                                                                    $oroshi_sum_number_progress2 = $oroshi_buy_progress2 -> oroshi_number2;
                                                                                    $oroshi_sum_arari_progress2  = $oroshi_buy_progress2 -> oroshi_arari2;
                                                                                    $i2++;
                                                                                }
                                                                }
                                        
                                        
                                        /************************************************************************************************************************************************************************************************************* */
                                            // 先月のデータ取得（最終データ格納年月比) 　end
                                        /************************************************************************************************************************************************************************************************************* */
                                        



                                        /************************************************************************************************************************************************************************************************************* */
                                            // 検索期間の月数だけ遡った年月のデータ取得（最終データ格納年月比) start
                                        /************************************************************************************************************************************************************************************************************* */
                                        
                                                            // DB検索（店舗値）スタート
                                                                $shop_progress3 = DB::table($table_name) 
                                                                // 月毎にグループ化して値を分けるための処理
                                                                    ->select([
                                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS shop_month3'),
                                                                        \DB::raw("SUM(uriagekingaku) AS shop_uriage3"),
                                                                        \DB::raw("SUM(uriagesuu) AS shop_number3"),
                                                                        \DB::raw("SUM(ararikingaku) AS shop_arari3"),
                                                                    ])
                                                                    // 条件（売上部門が店舗）
                                                                        ->where('baikyakukubun',1)
                                                                    // 条件（期間の指定）
                                                                        ->whereBetween($table_name . '.uriage', [$past_between_start_progress, $past_between_end_progress])
                                                                        
                                                                    // 条件（分類名）
                                                                        ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                            // 条件（商品区分分類名が新品）
                                                                                if($out2_a == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                }
                                                                            // 条件（商品区分分類名が中古）
                                                                                if($out2_b == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                }
                                                                            // 条件（商品区分分類名がアンティーク）
                                                                                if($out2_c == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                }
                                                                            // 条件（商品区分分類名がその他）
                                                                                if($out2_d == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                }
                                                                            // 条件（商品区分分類名が修理）
                                                                                if($out2_e == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（通販区分）
                                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                                            $query->orWhere('tsuuhankubun','');

                                                                            // 条件（通販区分が自社）
                                                                                if($out3_a == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',1);
                                                                                }
                                                                            // 条件（通販区分が楽天）
                                                                                if($out3_b == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',2);
                                                                                }
                                                                            // 条件（通販区分がヤフー）
                                                                                if($out3_c == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',3);
                                                                                }
                                                                            // 条件（通販区分が電話・雑誌）
                                                                                if($out3_d == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',5);
                                                                                }
                                                                            // 条件（通販区分がYオークション）
                                                                                if($out3_e == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',4);
                                                                                }
                                                                            // 条件（通販区分が修理品返送）
                                                                                if($out3_f == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',9);
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（免税）
                                                                    ->where(function ($query) use ($out4_a,$out4_b) {
                                                                            // 条件（免税区分が0:対象外）
                                                                                if($out4_a == "ON"){
                                                                                    $query->orwhere("menzei","like","%対象外%");
                                                                                }
                                                                            // 条件（免税区分が1:免税）
                                                                                if($out4_b == "ON"){
                                                                                    $query->orwhere("menzei","like","%免税%");
                                                                                }
                                                                    })
                                                                // 条件（扱い部門）
                                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                            $query->orWhere('bumonmei','');

                                                                            // 条件（扱い部門がジャック）
                                                                                if($out5_a == "ON"){
                                                                                    $query->orWhere('bumonmei','Jackroad');
                                                                                }
                                                                            // 条件（扱い部門がベティー）
                                                                                if($out5_b == "ON"){
                                                                                    $query->orWhere('bumonmei','BettyRoad');
                                                                                }
                                                                            // 条件（扱い部門がジュエリー）
                                                                                if($out5_c == "ON"){
                                                                                    $query->orWhere('bumonmei','Jewelry');
                                                                                }
                                                                
                                                                    })
                                                                // ソート順指定
                                                                    ->orderBy('uriage', 'asc')
                                                                    ->get();
                                                                // クエリビルダスタート
                                                                    // 変数リセット
                                                                        $shop_sum_uriage_progress3 = "";
                                                                        $i2 = 0;
                                                                        foreach ($shop_progress3 as $shop_buy_progress3) {
                                                                            // 各月卸売上
                                                                            $shop_sum_uriage_progress3 = $shop_buy_progress3 -> shop_uriage3;
                                                                            $shop_sum_number_progress3 = $shop_buy_progress3 -> shop_number3;
                                                                            $shop_sum_arari_progress3  = $shop_buy_progress3 -> shop_arari3;
                                                                            $i2++;
                                                                        }

                                                            // DB検索（店舗値）スタート
                                                                $web_progress3 = DB::table($table_name) 
                                                                // 月毎にグループ化して値を分けるための処理
                                                                    ->select([
                                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS web_month3'),
                                                                        \DB::raw("SUM(uriagekingaku) AS web_uriage3"),
                                                                        \DB::raw("SUM(uriagesuu) AS web_number3"),
                                                                        \DB::raw("SUM(ararikingaku) AS web_arari3"),
                                                                ])
                                                                    // 条件（売上部門がWEB）
                                                                        ->where('baikyakukubun',2)
                                                                    // 条件（期間の指定）
                                                                        ->whereBetween($table_name . '.uriage', [$past_between_start_progress, $past_between_end_progress])
                                                                        
                                                                    // 条件（分類名）
                                                                        ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                            // 条件（商品区分分類名が新品）
                                                                                if($out2_a == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                }
                                                                            // 条件（商品区分分類名が中古）
                                                                                if($out2_b == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                }
                                                                            // 条件（商品区分分類名がアンティーク）
                                                                                if($out2_c == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                }
                                                                            // 条件（商品区分分類名がその他）
                                                                                if($out2_d == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                }
                                                                            // 条件（商品区分分類名が修理）
                                                                                if($out2_e == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（通販区分）
                                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                                            $query->orWhere('tsuuhankubun','');

                                                                            // 条件（通販区分が自社）
                                                                                if($out3_a == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',1);
                                                                                }
                                                                            // 条件（通販区分が楽天）
                                                                                if($out3_b == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',2);
                                                                                }
                                                                            // 条件（通販区分がヤフー）
                                                                                if($out3_c == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',3);
                                                                                }
                                                                            // 条件（通販区分が電話・雑誌）
                                                                                if($out3_d == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',5);
                                                                                }
                                                                            // 条件（通販区分がYオークション）
                                                                                if($out3_e == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',4);
                                                                                }
                                                                            // 条件（通販区分が修理品返送）
                                                                                if($out3_f == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',9);
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（免税）
                                                                    ->where(function ($query) use ($out4_a,$out4_b) {
                                                                            // 条件（免税区分が0:対象外）
                                                                                if($out4_a == "ON"){
                                                                                    $query->orwhere("menzei","like","%対象外%");
                                                                                }
                                                                            // 条件（免税区分が1:免税）
                                                                                if($out4_b == "ON"){
                                                                                    $query->orwhere("menzei","like","%免税%");
                                                                                }
                                                                    })
                                                                // 条件（扱い部門）
                                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                            $query->orWhere('bumonmei','');

                                                                            // 条件（扱い部門がジャック）
                                                                                if($out5_a == "ON"){
                                                                                    $query->orWhere('bumonmei','Jackroad');
                                                                                }
                                                                            // 条件（扱い部門がベティー）
                                                                                if($out5_b == "ON"){
                                                                                    $query->orWhere('bumonmei','BettyRoad');
                                                                                }
                                                                            // 条件（扱い部門がジュエリー）
                                                                                if($out5_c == "ON"){
                                                                                    $query->orWhere('bumonmei','Jewelry');
                                                                                }
                                                                
                                                                    })
                                                                // ソート順指定
                                                                    ->orderBy('uriage', 'asc')
                                                                    ->get();
                                                                // クエリビルダスタート
                                                                    // 変数リセット
                                                                        $web_sum_uriage_progress3 = "";
                                                                        $i2 = 0;
                                                                        foreach ($web_progress3 as $web_buy_progress3) {
                                                                            // 各月卸売上
                                                                            $web_sum_uriage_progress3 = $web_buy_progress3 -> web_uriage3;
                                                                            $web_sum_number_progress3 = $web_buy_progress3 -> web_number3;
                                                                            $web_sum_arari_progress3  = $web_buy_progress3 -> web_arari3;
                                                                            $i2++;
                                                                        }




                                                            // DB検索（卸値）スタート
                                                                $oroshi_sum_uriage_progress3 = "";
                                                                $oroshi_sum_number_progress3 = "";
                                                                $oroshi_sum_arari_progress3 = "";
                                                                if($out1_c == "ON"){                                                                
                                                                        $oroshi_progress3 = DB::table($table_name) 
                                                                        // 月毎にグループ化して値を分けるための処理
                                                                            ->select([
                                                                                \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS oroshi_month3'),
                                                                                \DB::raw("SUM(uriagekingaku) AS oroshi_uriage3"),
                                                                                \DB::raw("SUM(uriagesuu) AS oroshi_number3"),
                                                                                \DB::raw("SUM(ararikingaku) AS oroshi_arari3"),
                                                                        ])
                                                                        // 条件（売上部門が卸）
                                                                                ->where(function ($query) use ($out1_d) {
                                                                                        if($out1_d == "ON"){
                                                                                            // 「卸」と空白（おそらく入力間違い分）を含む場合を取得（条件：「店舗」「通販」以外）
                                                                                                $query->Where([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2]]);
                                                                                        } else {
                                                                                            // 「卸」のみを取得
                                                                                                $query->where('baikyakukubun',3);
                                                                                        }
                                                                                })
                                                                        // 条件（期間の指定）
                                                                            ->whereBetween($table_name . '.uriage', [$past_between_start_progress, $past_between_end_progress])
                                                                                
                                                                            // 条件（分類名）
                                                                                ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                                    // 条件（商品区分分類名が新品）
                                                                                        if($out2_a == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が中古）
                                                                                        if($out2_b == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がアンティーク）
                                                                                        if($out2_c == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がその他）
                                                                                        if($out2_d == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が修理）
                                                                                        if($out2_e == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                        }
                                                                            
                                                                            })
                                                                        // 条件（通販区分）
                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                                                    $query->orWhere('tsuuhankubun','');

                                                                                    // 条件（通販区分が自社）
                                                                                        if($out3_a == "ON"){
                                                                                            $query->orWhere('tsuuhankubun',1);
                                                                                        }
                                                                                    // 条件（通販区分が楽天）
                                                                                        if($out3_b == "ON"){
                                                                                            $query->orWhere('tsuuhankubun',2);
                                                                                        }
                                                                                    // 条件（通販区分がヤフー）
                                                                                        if($out3_c == "ON"){
                                                                                            $query->orWhere('tsuuhankubun',3);
                                                                                        }
                                                                                    // 条件（通販区分が電話・雑誌）
                                                                                        if($out3_d == "ON"){
                                                                                            $query->orWhere('tsuuhankubun',5);
                                                                                        }
                                                                                    // 条件（通販区分がYオークション）
                                                                                        if($out3_e == "ON"){
                                                                                            $query->orWhere('tsuuhankubun',4);
                                                                                        }
                                                                                    // 条件（通販区分が修理品返送）
                                                                                        if($out3_f == "ON"){
                                                                                            $query->orWhere('tsuuhankubun',9);
                                                                                        }
                                                                            
                                                                            })
                                                                        // 条件（免税）
                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                    // 条件（免税区分が0:対象外）
                                                                                        if($out4_a == "ON"){
                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                        }
                                                                                    // 条件（免税区分が1:免税）
                                                                                        if($out4_b == "ON"){
                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                        }
                                                                            })
                                                                        // 条件（扱い部門）
                                                                            ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                                    $query->orWhere('bumonmei','');

                                                                                    // 条件（扱い部門がジャック）
                                                                                        if($out5_a == "ON"){
                                                                                            $query->orWhere('bumonmei','Jackroad');
                                                                                        }
                                                                                    // 条件（扱い部門がベティー）
                                                                                        if($out5_b == "ON"){
                                                                                            $query->orWhere('bumonmei','BettyRoad');
                                                                                        }
                                                                                    // 条件（扱い部門がジュエリー）
                                                                                        if($out5_c == "ON"){
                                                                                            $query->orWhere('bumonmei','Jewelry');
                                                                                        }
                                                                        
                                                                            })
                                                                        // ソート順指定
                                                                            ->orderBy('uriage', 'asc')
                                                                            ->get();
                                                                        // クエリビルダスタート
                                                                            // 変数リセット
                                                                                $oroshi_sum_uriage_progress3 = "";
                                                                                $i2 = 0;
                                                                                foreach ($oroshi_progress3 as $oroshi_buy_progress3) {
                                                                                    // 各月卸売上
                                                                                    $oroshi_sum_uriage_progress3 = $oroshi_buy_progress3 -> oroshi_uriage3;
                                                                                    $oroshi_sum_number_progress3 = $oroshi_buy_progress3 -> oroshi_number3;
                                                                                    $oroshi_sum_arari_progress3  = $oroshi_buy_progress3 -> oroshi_arari3;
                                                                                    $i2++;
                                                                                }

                                                                }
                                      
                                        
                                        
                                        /************************************************************************************************************************************************************************************************************* */
                                            // 検索期間の月数だけ遡った年月のデータ取得（最終データ格納年月比) 　end
                                        /************************************************************************************************************************************************************************************************************* */
                                        

                                        /************************************************************************************************************************************************************************************************************* */
                                            // 各月間予測値と過去比を取得 start
                                        /************************************************************************************************************************************************************************************************************* */

                                                // 予測値
                                                        // 店舗・月間売上額予測
                                                            if($shop_sum_uriage_progress <> "" && $shop_sum_uriage_progress <> 0){
                                                                $shop_sum_uriage_progress_pre = (float)((int)$shop_sum_uriage_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                            } else {
                                                                $shop_sum_uriage_progress_pre = "";
                                                            }
                                                        // 店舗・月間売上点数予測
                                                            if($shop_sum_number_progress <> "" && $shop_sum_number_progress <> 0){
                                                                $shop_sum_number_progress_pre = (float)((int)$shop_sum_number_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                            } else {
                                                                $shop_sum_number_progress_pre = "";
                                                            }
                                                        // 店舗・月間売上粗利予測
                                                            if($shop_sum_arari_progress <> "" && $shop_sum_arari_progress <> 0){
                                                                $shop_sum_arari_progress_pre = (float)((int)$shop_sum_arari_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                            } else {
                                                                $shop_sum_arari_progress_pre = "";
                                                            }


                                                        // WEB・月間売上額予測
                                                            if($web_sum_uriage_progress <> "" && $web_sum_uriage_progress <> 0){
                                                                $web_sum_uriage_progress_pre = (float)((int)$web_sum_uriage_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                            } else {
                                                                $web_sum_uriage_progress_pre = "";
                                                            }
                                                        // WEB・月間売上点数予測
                                                            if($web_sum_number_progress <> "" && $web_sum_number_progress <> 0){
                                                                $web_sum_number_progress_pre = (float)((int)$web_sum_number_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                            } else {
                                                                $web_sum_number_progress_pre = "";
                                                            }
                                                        // WEB・月間売上粗利予測
                                                            if($web_sum_arari_progress <> "" && $web_sum_arari_progress <> 0){
                                                                $web_sum_arari_progress_pre = (float)((int)$web_sum_arari_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                            } else {
                                                                $web_sum_arari_progress_pre = "";
                                                            }
                                                        $oroshi_sum_uriage_progress_pre = "";
                                                        $oroshi_sum_number_progress_pre = "";
                                                        $oroshi_sum_arari_progress_pre = "";
                                                        if($out1_c == "ON"){ 
                                                            // 卸・月間売上額予測
                                                                if($oroshi_sum_uriage_progress <> "" && $oroshi_sum_uriage_progress <> 0){
                                                                    $oroshi_sum_uriage_progress_pre = (float)((int)$oroshi_sum_uriage_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                } else {
                                                                    $oroshi_sum_uriage_progress_pre = "";
                                                                }
                                                            // 卸・月間売上点数予測
                                                                if($oroshi_sum_number_progress <> "" && $oroshi_sum_number_progress <> 0){
                                                                    $oroshi_sum_number_progress_pre = (float)((int)$oroshi_sum_number_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                } else {
                                                                    $oroshi_sum_number_progress_pre = "";
                                                                }
                                                            // 卸・月間売上粗利予測
                                                                if($oroshi_sum_arari_progress <> "" && $oroshi_sum_arari_progress <> 0){
                                                                    $oroshi_sum_arari_progress_pre = (float)((int)$oroshi_sum_arari_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                } else {
                                                                    $oroshi_sum_arari_progress_pre = "";
                                                                }
                                                        }

                                                    
                                                // 先月比
                                                        // 店舗・売上額予測・先月比
                                                            if($shop_sum_uriage_progress_pre <> "" && $shop_sum_uriage_progress_pre <> 0 && $shop_sum_uriage_progress2 <> "" && $shop_sum_uriage_progress2 <> 0){
                                                                $shop_sum_uriage_progress_pre2 = (floor(((float)$shop_sum_uriage_progress_pre / (float)$shop_sum_uriage_progress2) * 100 * 10)) / 10;
                                                            } else {
                                                                $shop_sum_uriage_progress_pre2 = "---";
                                                            }

                                                        // 店舗・売上点数予測・先月比
                                                            if($shop_sum_number_progress_pre <> "" && $shop_sum_number_progress_pre <> 0 && $shop_sum_number_progress2 <> "" && $shop_sum_number_progress2 <> 0){
                                                                $shop_sum_number_progress_pre2 = (floor(((float)$shop_sum_number_progress_pre / (float)$shop_sum_number_progress2) * 100 * 10)) / 10;
                                                            } else {
                                                                $shop_sum_number_progress_pre2 = "---";
                                                            }

                                                        // 店舗・売上粗利予測・先月比
                                                            if($shop_sum_arari_progress_pre <> "" && $shop_sum_arari_progress_pre <> 0 && $shop_sum_arari_progress2 <> "" && $shop_sum_arari_progress2 <> 0){
                                                                $shop_sum_arari_progress_pre2 = (floor(((float)$shop_sum_arari_progress_pre / (float)$shop_sum_arari_progress2) * 100 * 10)) / 10;
                                                            } else {
                                                                $shop_sum_arari_progress_pre2 = "---";
                                                            }

                                                        // WEB・売上額予測・先月比
                                                            if($web_sum_uriage_progress_pre <> "" && $web_sum_uriage_progress_pre <> 0 && $web_sum_uriage_progress2 <> "" && $web_sum_uriage_progress2 <> 0){
                                                                $web_sum_uriage_progress_pre2 = (floor(((float)$web_sum_uriage_progress_pre / (float)$web_sum_uriage_progress2) * 100 * 10)) / 10;
                                                            } else {
                                                                $web_sum_uriage_progress_pre2 = "---";
                                                            }

                                                        // WEB・売上点数予測・先月比
                                                            if($web_sum_number_progress_pre <> "" && $web_sum_number_progress_pre <> 0 && $web_sum_number_progress2 <> "" && $web_sum_number_progress2 <> 0){
                                                                $web_sum_number_progress_pre2 = (floor(((float)$web_sum_number_progress_pre / (float)$web_sum_number_progress2) * 100 * 10)) / 10;
                                                            } else {
                                                                $web_sum_number_progress_pre2 = "---";
                                                            }

                                                        // WEB・売上粗利予測・先月比
                                                            if($web_sum_arari_progress_pre <> "" && $web_sum_arari_progress_pre <> 0 && $web_sum_arari_progress2 <> "" && $web_sum_arari_progress2 <> 0){
                                                                $web_sum_arari_progress_pre2 = (floor(((float)$web_sum_arari_progress_pre / (float)$web_sum_arari_progress2) * 100 * 10)) / 10;
                                                            } else {
                                                                $web_sum_arari_progress_pre2 = "---";
                                                            }
                                                        $oroshi_sum_uriage_progress_pre2 = "";
                                                        $oroshi_sum_number_progress_pre2 = "";
                                                        $oroshi_sum_arari_progress_pre2 = "";
                                                        if($out1_c == "ON"){ 
                                                            // 卸・売上額予測・先月比
                                                                if($oroshi_sum_uriage_progress_pre <> "" && $oroshi_sum_uriage_progress_pre <> 0 && $oroshi_sum_uriage_progress2 <> "" && $oroshi_sum_uriage_progress2 <> 0){
                                                                    $oroshi_sum_uriage_progress_pre2 = (floor(((float)$oroshi_sum_uriage_progress_pre / (float)$oroshi_sum_uriage_progress2) * 100 * 10)) / 10;
                                                                } else {
                                                                    $oroshi_sum_uriage_progress_pre2 = "---";
                                                                }

                                                            // 卸・売上点数予測・先月比
                                                                if($oroshi_sum_number_progress_pre <> "" && $oroshi_sum_number_progress_pre <> 0 && $oroshi_sum_number_progress2 <> "" && $oroshi_sum_number_progress2 <> 0){
                                                                    $oroshi_sum_number_progress_pre2 = (floor(((float)$oroshi_sum_number_progress_pre / (float)$oroshi_sum_number_progress2) * 100 * 10)) / 10;
                                                                } else {
                                                                    $oroshi_sum_number_progress_pre2 = "---";
                                                                }

                                                            // 卸・売上粗利予測・先月比
                                                                if($oroshi_sum_arari_progress_pre <> "" && $oroshi_sum_arari_progress_pre <> 0 && $oroshi_sum_arari_progress2 <> "" && $oroshi_sum_arari_progress2 <> 0){
                                                                    $oroshi_sum_arari_progress_pre2 = (floor(((float)$oroshi_sum_arari_progress_pre / (float)$oroshi_sum_arari_progress2) * 100 * 10)) / 10;
                                                                } else {
                                                                    $oroshi_sum_arari_progress_pre2 = "---";
                                                                }
                                                        }
                                                // 過去比
                                                        // 店舗・売上額予測・過去比
                                                            if($shop_sum_uriage_progress_pre <> "" && $shop_sum_uriage_progress_pre <> 0 && $shop_sum_uriage_progress3 <> "" && $shop_sum_uriage_progress3 <> 0){
                                                                $shop_sum_uriage_progress_pre3 = (floor(((float)$shop_sum_uriage_progress_pre / (float)$shop_sum_uriage_progress3) * 100 * 10)) / 10;
                                                            } else {
                                                                $shop_sum_uriage_progress_pre3 = "---";
                                                            }
                                                        // 店舗・売上点数予測・過去比
                                                            if($shop_sum_number_progress_pre <> "" && $shop_sum_number_progress_pre <> 0 && $shop_sum_number_progress3 <> "" && $shop_sum_number_progress3 <> 0){
                                                                $shop_sum_number_progress_pre3 = (floor(((float)$shop_sum_number_progress_pre / (float)$shop_sum_number_progress3) * 100 * 10)) / 10;
                                                            } else {
                                                                $shop_sum_number_progress_pre3 = "---";
                                                            }
                                                        // 店舗・売上粗利予測・過去比
                                                            if($shop_sum_arari_progress_pre <> "" && $shop_sum_arari_progress_pre <> 0 && $shop_sum_arari_progress3 <> "" && $shop_sum_arari_progress3 <> 0){
                                                                $shop_sum_arari_progress_pre3 = (floor(((float)$shop_sum_arari_progress_pre / (float)$shop_sum_arari_progress3) * 100 * 10)) / 10;
                                                            } else {
                                                                $shop_sum_arari_progress_pre3 = "---";
                                                            }
                                                            
                                                        // WEB・売上額予測・過去比
                                                            if($web_sum_uriage_progress_pre <> "" && $web_sum_uriage_progress_pre <> 0 && $web_sum_uriage_progress3 <> "" && $web_sum_uriage_progress3 <> 0){
                                                                $web_sum_uriage_progress_pre3 = (floor(((float)$web_sum_uriage_progress_pre / (float)$web_sum_uriage_progress3) * 100 * 10)) / 10;
                                                            } else {
                                                                $web_sum_uriage_progress_pre3 = "---";
                                                            }
                                                        // WEB・売上点数予測・過去比
                                                            if($web_sum_number_progress_pre <> "" && $web_sum_number_progress_pre <> 0 && $web_sum_number_progress3 <> "" && $web_sum_number_progress3 <> 0){
                                                                $web_sum_number_progress_pre3 = (floor(((float)$web_sum_number_progress_pre / (float)$web_sum_number_progress3) * 100 * 10)) / 10;
                                                            } else {
                                                                $web_sum_number_progress_pre3 = "---";
                                                            }
                                                        // WEB・売上粗利予測・過去比
                                                            if($web_sum_arari_progress_pre <> "" && $web_sum_arari_progress_pre <> 0 && $web_sum_arari_progress3 <> "" && $web_sum_arari_progress3 <> 0){
                                                                $web_sum_arari_progress_pre3 = (floor(((float)$web_sum_arari_progress_pre / (float)$web_sum_arari_progress3) * 100 * 10)) / 10;
                                                            } else {
                                                                $web_sum_arari_progress_pre3 = "---";
                                                            }
                                                        $oroshi_sum_uriage_progress_pre3 = "";
                                                        $oroshi_sum_number_progress_pre3 = "";
                                                        $oroshi_sum_arari_progress_pre3 = "";
                                                        if($out1_c == "ON"){ 
                                                            // 卸・売上額予測・過去比
                                                                if($oroshi_sum_uriage_progress_pre <> "" && $oroshi_sum_uriage_progress_pre <> 0 && $oroshi_sum_uriage_progress3 <> "" && $oroshi_sum_uriage_progress3 <> 0){
                                                                    $oroshi_sum_uriage_progress_pre3 = (floor(((float)$oroshi_sum_uriage_progress_pre / (float)$oroshi_sum_uriage_progress3) * 100 * 10)) / 10;
                                                                } else {
                                                                    $oroshi_sum_uriage_progress_pre3 = "---";
                                                                }
                                                            // 卸・売上点数予測・過去比
                                                                if($oroshi_sum_number_progress_pre <> "" && $oroshi_sum_number_progress_pre <> 0 && $oroshi_sum_number_progress3 <> "" && $oroshi_sum_number_progress3 <> 0){
                                                                    $oroshi_sum_number_progress_pre3 = (floor(((float)$oroshi_sum_number_progress_pre / (float)$oroshi_sum_number_progress3) * 100 * 10)) / 10;
                                                                } else {
                                                                    $oroshi_sum_number_progress_pre3 = "---";
                                                                }
                                                            // 卸・売上粗利予測・過去比
                                                                if($oroshi_sum_arari_progress_pre <> "" && $oroshi_sum_arari_progress_pre <> 0 && $oroshi_sum_arari_progress3 <> "" && $oroshi_sum_arari_progress3 <> 0){
                                                                    $oroshi_sum_arari_progress_pre3 = (floor(((float)$oroshi_sum_arari_progress_pre / (float)$oroshi_sum_arari_progress3) * 100 * 10)) / 10;
                                                                } else {
                                                                    $oroshi_sum_arari_progress_pre3 = "---";
                                                                }
                                                        }

                                                // 合計値
                                                        // データ格納最終月・売上額進捗合計
                                                            $all_sum_uriage_progress = (int)$shop_sum_uriage_progress + (int)$web_sum_uriage_progress + (int)$oroshi_sum_uriage_progress;
                                                        // データ格納最終月・売上点数進捗合計
                                                            $all_sum_number_progress = (int)$shop_sum_number_progress + (int)$web_sum_number_progress + (int)$oroshi_sum_number_progress;
                                                        // データ格納最終月・売上粗利進捗合計
                                                            $all_sum_arari_progress = (int)$shop_sum_arari_progress + (int)$web_sum_arari_progress + (int)$oroshi_sum_arari_progress;

                                                        // データ格納最終月・売上額・着地予測合計
                                                            $all_sum_uriage_progress_pre = (int)$shop_sum_uriage_progress_pre + (int)$web_sum_uriage_progress_pre + (int)$oroshi_sum_uriage_progress_pre;
                                                        // データ格納最終月・売上点数・着地予測合計
                                                            $all_sum_number_progress_pre = (int)$shop_sum_number_progress_pre + (int)$web_sum_number_progress_pre + (int)$oroshi_sum_number_progress_pre;
                                                        // データ格納最終月・売上粗利・着地予測合計
                                                            $all_sum_arari_progress_pre = (int)$shop_sum_arari_progress_pre + (int)$web_sum_arari_progress_pre + (int)$oroshi_sum_arari_progress_pre;

                                                        // 進捗合計に対する先月比
                                                            //20240519 if($all_sum_uriage_progress_pre <> "" && $all_sum_uriage_progress_pre <> "" && ((int)$shop_sum_uriage_progress2 + (int)$web_sum_uriage_progress2 + (int)$oroshi_sum_uriage_progress2) <> "" && ((int)$shop_sum_uriage_progress2 + (int)$web_sum_uriage_progress2 + (int)$oroshi_sum_uriage_progress2) <> ""){
                                                            if($all_sum_uriage_progress_pre <> "" && $all_sum_uriage_progress_pre <> 0 && ((int)$shop_sum_uriage_progress2 + (int)$web_sum_uriage_progress2 + (int)$oroshi_sum_uriage_progress2) <> "" && ((int)$shop_sum_uriage_progress2 + (int)$web_sum_uriage_progress2 + (int)$oroshi_sum_uriage_progress2) <> 0){
                                                                $all_sum_uriage_progress2 = (floor(((int)$all_sum_uriage_progress_pre / ((int)$shop_sum_uriage_progress2 + (int)$web_sum_uriage_progress2 + (int)$oroshi_sum_uriage_progress2)) * 100 * 10)) / 10;
                                                            } else {
                                                                $all_sum_uriage_progress2 = "---";
                                                            }
                                                            // 20240519 if($all_sum_number_progress_pre <> "" && $all_sum_number_progress_pre <> "" && ((int)$shop_sum_number_progress2 + (int)$web_sum_number_progress2 + (int)$oroshi_sum_number_progress2) <> "" && ((int)$shop_sum_number_progress2 + (int)$web_sum_number_progress2 + (int)$oroshi_sum_number_progress2) <> ""){
                                                            if($all_sum_number_progress_pre <> "" && $all_sum_number_progress_pre <> 0 && ((int)$shop_sum_number_progress2 + (int)$web_sum_number_progress2 + (int)$oroshi_sum_number_progress2) <> "" && ((int)$shop_sum_number_progress2 + (int)$web_sum_number_progress2 + (int)$oroshi_sum_number_progress2) <> 0){
                                                                $all_sum_number_progress2 = (floor(((int)$all_sum_number_progress_pre / ((int)$shop_sum_number_progress2 + (int)$web_sum_number_progress2 + (int)$oroshi_sum_number_progress2)) * 100 * 10)) / 10;
                                                            } else {
                                                                $all_sum_number_progress2 = "---";
                                                            }
                                                            //20240519 if($all_sum_arari_progress_pre <> "" && $all_sum_arari_progress_pre <> "" && ((int)$shop_sum_arari_progress2 + (int)$web_sum_arari_progress2 + (int)$oroshi_sum_arari_progress2) <> "" && ((int)$shop_sum_arari_progress2 + (int)$web_sum_arari_progress2 + (int)$oroshi_sum_arari_progress2) <> ""){
                                                            if($all_sum_arari_progress_pre <> "" && $all_sum_arari_progress_pre <> 0 && ((int)$shop_sum_arari_progress2 + (int)$web_sum_arari_progress2 + (int)$oroshi_sum_arari_progress2) <> "" && ((int)$shop_sum_arari_progress2 + (int)$web_sum_arari_progress2 + (int)$oroshi_sum_arari_progress2) <> 0){
                                                                $all_sum_arari_progress2 = (floor(((int)$all_sum_arari_progress_pre / ((int)$shop_sum_arari_progress2 + (int)$web_sum_arari_progress2 + (int)$oroshi_sum_arari_progress2)) * 100 * 10)) / 10;
                                                            } else {
                                                                $all_sum_arari_progress2 = "---";
                                                            }
                                                        // 進捗合計に対する過去比
                                                            //20240519 if($all_sum_uriage_progress_pre <> "" && $all_sum_uriage_progress_pre <> "" && ((int)$shop_sum_uriage_progress3 + (int)$web_sum_uriage_progress3 + (int)$oroshi_sum_uriage_progress3) <> "" && ((int)$shop_sum_uriage_progress3 + (int)$web_sum_uriage_progress3 + (int)$oroshi_sum_uriage_progress3) <> ""){
                                                            if($all_sum_uriage_progress_pre <> "" && $all_sum_uriage_progress_pre <> 0 && ((int)$shop_sum_uriage_progress3 + (int)$web_sum_uriage_progress3 + (int)$oroshi_sum_uriage_progress3) <> "" && ((int)$shop_sum_uriage_progress3 + (int)$web_sum_uriage_progress3 + (int)$oroshi_sum_uriage_progress3) <> 0){
                                                                $all_sum_uriage_progress3 = (floor(((int)$all_sum_uriage_progress_pre / ((int)$shop_sum_uriage_progress3 + (int)$web_sum_uriage_progress3 + (int)$oroshi_sum_uriage_progress3)) * 100 * 10)) / 10;
                                                            } else {
                                                                $all_sum_uriage_progress3 = "---";
                                                            }
                                                            //20240519 if($all_sum_number_progress_pre <> "" && $all_sum_number_progress_pre <> "" && ((int)$shop_sum_number_progress3 + (int)$web_sum_number_progress3 + (int)$oroshi_sum_number_progress3) <> "" && ((int)$shop_sum_number_progress3 + (int)$web_sum_number_progress3 + (int)$oroshi_sum_number_progress3) <> ""){
                                                            if($all_sum_number_progress_pre <> "" && $all_sum_number_progress_pre <> 0 && ((int)$shop_sum_number_progress3 + (int)$web_sum_number_progress3 + (int)$oroshi_sum_number_progress3) <> "" && ((int)$shop_sum_number_progress3 + (int)$web_sum_number_progress3 + (int)$oroshi_sum_number_progress3) <> 0){
                                                                $all_sum_number_progress3 = (floor(((int)$all_sum_number_progress_pre / ((int)$shop_sum_number_progress3 + (int)$web_sum_number_progress3 + (int)$oroshi_sum_number_progress3)) * 100 * 10)) / 10;
                                                            } else {
                                                                $all_sum_number_progress3 = "---";
                                                            }
                                                            //20240519 if($all_sum_arari_progress_pre <> "" && $all_sum_arari_progress_pre <> "" && ((int)$shop_sum_arari_progress3 + (int)$web_sum_arari_progress3 + (int)$oroshi_sum_arari_progress3) <> "" && ((int)$shop_sum_arari_progress3 + (int)$web_sum_arari_progress3 + (int)$oroshi_sum_arari_progress3) <> ""){
                                                            if($all_sum_arari_progress_pre <> "" && $all_sum_arari_progress_pre <> 0 && ((int)$shop_sum_arari_progress3 + (int)$web_sum_arari_progress3 + (int)$oroshi_sum_arari_progress3) <> "" && ((int)$shop_sum_arari_progress3 + (int)$web_sum_arari_progress3 + (int)$oroshi_sum_arari_progress3) <> 0){
                                                                $all_sum_arari_progress3 = (floor(((int)$all_sum_arari_progress_pre / ((int)$shop_sum_arari_progress3 + (int)$web_sum_arari_progress3 + (int)$oroshi_sum_arari_progress3)) * 100 * 10)) / 10;
                                                            } else {
                                                                $all_sum_arari_progress3 = "---";
                                                            }
                                                        // HTML作成
                                                            ($shop_sum_uriage_progress == 0 || $shop_sum_uriage_progress == "" || $shop_sum_uriage_progress == "---") ? $shop_uriage_view1 = $shop_sum_uriage_progress : $shop_uriage_view1 = number_format($shop_sum_uriage_progress);
                                                            ($shop_sum_uriage_progress_pre == 0 || $shop_sum_uriage_progress_pre == "" || $shop_sum_uriage_progress_pre == "---") ? $shop_uriage_view2 = $shop_sum_uriage_progress_pre : $shop_uriage_view2 = number_format($shop_sum_uriage_progress_pre);
                                                            ($shop_sum_uriage_progress_pre2 == 0 || $shop_sum_uriage_progress_pre2 == "" || $shop_sum_uriage_progress_pre2 == "---") ? $shop_uriage_view3 = $shop_sum_uriage_progress_pre2 : $shop_uriage_view3 = number_format($shop_sum_uriage_progress_pre2,1);
                                                            ($shop_sum_uriage_progress_pre3 == 0 || $shop_sum_uriage_progress_pre3 == "" || $shop_sum_uriage_progress_pre3 == "---") ? $shop_uriage_view4 = $shop_sum_uriage_progress_pre3 : $shop_uriage_view4 = number_format($shop_sum_uriage_progress_pre3,1);
                                                            ($web_sum_uriage_progress == 0 || $web_sum_uriage_progress == "" || $web_sum_uriage_progress == "---") ? $web_uriage_view1 = $web_sum_uriage_progress : $web_uriage_view1 = number_format($web_sum_uriage_progress);
                                                            ($web_sum_uriage_progress_pre == 0 || $web_sum_uriage_progress_pre == "" || $web_sum_uriage_progress_pre == "---") ? $web_uriage_view2 = $web_sum_uriage_progress_pre : $web_uriage_view2 = number_format($web_sum_uriage_progress_pre);
                                                            ($web_sum_uriage_progress_pre2 == 0 || $web_sum_uriage_progress_pre2 == "" || $web_sum_uriage_progress_pre2 == "---") ? $web_uriage_view3 = $web_sum_uriage_progress_pre2 : $web_uriage_view3 = number_format($web_sum_uriage_progress_pre2,1);
                                                            ($web_sum_uriage_progress_pre3 == 0 || $web_sum_uriage_progress_pre3 == "" || $web_sum_uriage_progress_pre3 == "---") ? $web_uriage_view4 = $web_sum_uriage_progress_pre3 : $web_uriage_view4 = number_format($web_sum_uriage_progress_pre3,1);
                                                            ($oroshi_sum_uriage_progress == 0 || $oroshi_sum_uriage_progress == "" || $oroshi_sum_uriage_progress == "---") ? $oroshi_uriage_view1 = $oroshi_sum_uriage_progress : $oroshi_uriage_view1 = number_format($oroshi_sum_uriage_progress);
                                                            ($oroshi_sum_uriage_progress_pre == 0 || $oroshi_sum_uriage_progress_pre == "" || $oroshi_sum_uriage_progress_pre == "---") ? $oroshi_uriage_view2 = $oroshi_sum_uriage_progress_pre : $oroshi_uriage_view2 = number_format($oroshi_sum_uriage_progress_pre);
                                                            ($oroshi_sum_uriage_progress_pre2 == 0 || $oroshi_sum_uriage_progress_pre2 == "" || $oroshi_sum_uriage_progress_pre2 == "---") ? $oroshi_uriage_view3 = $oroshi_sum_uriage_progress_pre2 : $oroshi_uriage_view3 = number_format($oroshi_sum_uriage_progress_pre2,1);
                                                            ($oroshi_sum_uriage_progress_pre3 == 0 || $oroshi_sum_uriage_progress_pre3 == "" || $oroshi_sum_uriage_progress_pre3 == "---") ? $oroshi_uriage_view4 = $oroshi_sum_uriage_progress_pre3 : $oroshi_uriage_view4 = number_format($oroshi_sum_uriage_progress_pre3,1);
                                                            ($all_sum_uriage_progress == 0 || $all_sum_uriage_progress == "" || $all_sum_uriage_progress == "---") ? $all_uriage_view1 = $all_sum_uriage_progress : $all_uriage_view1 = number_format($all_sum_uriage_progress);
                                                            ($all_sum_uriage_progress_pre == 0 || $all_sum_uriage_progress_pre == "" || $all_sum_uriage_progress_pre == "---") ? $all_uriage_view2 = $all_sum_uriage_progress_pre : $all_uriage_view2 = number_format($all_sum_uriage_progress_pre);
                                                            ($all_sum_uriage_progress2 == 0 || $all_sum_uriage_progress2 == "" || $all_sum_uriage_progress2 == "---") ? $all_uriage_view3 = $all_sum_uriage_progress2 : $all_uriage_view3 = number_format($all_sum_uriage_progress2,1);
                                                            ($all_sum_uriage_progress3 == 0 || $all_sum_uriage_progress3 == "" || $all_sum_uriage_progress3 == "---") ? $all_uriage_view4 = $all_sum_uriage_progress3 : $all_uriage_view4 = number_format($all_sum_uriage_progress3,1);
                                                            
                                                            
                                                            ($shop_sum_number_progress == 0 || $shop_sum_number_progress == "" || $shop_sum_number_progress == "---") ? $shop_number_view1 = $shop_sum_number_progress : $shop_number_view1 = number_format($shop_sum_number_progress);
                                                            ($shop_sum_number_progress_pre == 0 || $shop_sum_number_progress_pre == "" || $shop_sum_number_progress_pre == "---") ? $shop_number_view2 = $shop_sum_number_progress_pre : $shop_number_view2 = number_format($shop_sum_number_progress_pre);
                                                            ($shop_sum_number_progress_pre2 == 0 || $shop_sum_number_progress_pre2 == "" || $shop_sum_number_progress_pre2 == "---") ? $shop_number_view3 = $shop_sum_number_progress_pre2 : $shop_number_view3 = number_format($shop_sum_number_progress_pre2,1);
                                                            ($shop_sum_number_progress_pre3 == 0 || $shop_sum_number_progress_pre3 == "" || $shop_sum_number_progress_pre3 == "---") ? $shop_number_view4 = $shop_sum_number_progress_pre3 : $shop_number_view4 = number_format($shop_sum_number_progress_pre3,1);
                                                            ($web_sum_number_progress == 0 || $web_sum_number_progress == "" || $web_sum_number_progress == "---") ? $web_number_view1 = $web_sum_number_progress : $web_number_view1 = number_format($web_sum_number_progress);
                                                            ($web_sum_number_progress_pre == 0 || $web_sum_number_progress_pre == "" || $web_sum_number_progress_pre == "---") ? $web_number_view2 = $web_sum_number_progress_pre : $web_number_view2 = number_format($web_sum_number_progress_pre);
                                                            ($web_sum_number_progress_pre2 == 0 || $web_sum_number_progress_pre2 == "" || $web_sum_number_progress_pre2 == "---") ? $web_number_view3 = $web_sum_number_progress_pre2 : $web_number_view3 = number_format($web_sum_number_progress_pre2,1);
                                                            ($web_sum_number_progress_pre3 == 0 || $web_sum_number_progress_pre3 == "" || $web_sum_number_progress_pre3 == "---") ? $web_number_view4 = $web_sum_number_progress_pre3 : $web_number_view4 = number_format($web_sum_number_progress_pre3,1);
                                                            ($oroshi_sum_number_progress == 0 || $oroshi_sum_number_progress == "" || $oroshi_sum_number_progress == "---") ? $oroshi_number_view1 = $oroshi_sum_number_progress : $oroshi_number_view1 = number_format($oroshi_sum_number_progress);
                                                            ($oroshi_sum_number_progress_pre == 0 || $oroshi_sum_number_progress_pre == "" || $oroshi_sum_number_progress_pre == "---") ? $oroshi_number_view2 = $oroshi_sum_number_progress_pre : $oroshi_number_view2 = number_format($oroshi_sum_number_progress_pre);
                                                            ($oroshi_sum_number_progress_pre2 == 0 || $oroshi_sum_number_progress_pre2 == "" || $oroshi_sum_number_progress_pre2 == "---") ? $oroshi_number_view3 = $oroshi_sum_number_progress_pre2 : $oroshi_number_view3 = number_format($oroshi_sum_number_progress_pre2,1);
                                                            ($oroshi_sum_number_progress_pre3 == 0 || $oroshi_sum_number_progress_pre3 == "" || $oroshi_sum_number_progress_pre3 == "---") ? $oroshi_number_view4 = $oroshi_sum_number_progress_pre3 : $oroshi_number_view4 = number_format($oroshi_sum_number_progress_pre3,1);
                                                            ($all_sum_number_progress == 0 || $all_sum_number_progress == "" || $all_sum_number_progress == "---") ? $all_number_view1 = $all_sum_number_progress : $all_number_view1 = number_format($all_sum_number_progress);
                                                            ($all_sum_number_progress_pre == 0 || $all_sum_number_progress_pre == "" || $all_sum_number_progress_pre == "---") ? $all_number_view2 = $all_sum_number_progress_pre : $all_number_view2 = number_format($all_sum_number_progress_pre);
                                                            ($all_sum_number_progress2 == 0 || $all_sum_number_progress2 == "" || $all_sum_number_progress2 == "---") ? $all_number_view3 = $all_sum_number_progress2 : $all_number_view3 = number_format($all_sum_number_progress2,1);
                                                            ($all_sum_number_progress3 == 0 || $all_sum_number_progress3 == "" || $all_sum_number_progress3 == "---") ? $all_number_view4 = $all_sum_number_progress3 : $all_number_view4 = number_format($all_sum_number_progress3,1);
                                                            
                                                            ($shop_sum_arari_progress == 0 || $shop_sum_arari_progress == "" || $shop_sum_arari_progress == "---") ? $shop_arari_view1 = $shop_sum_arari_progress : $shop_arari_view1 = number_format($shop_sum_arari_progress);
                                                            ($shop_sum_arari_progress_pre == 0 || $shop_sum_arari_progress_pre == "" || $shop_sum_arari_progress_pre == "---") ? $shop_arari_view2 = $shop_sum_arari_progress_pre : $shop_arari_view2 = number_format($shop_sum_arari_progress_pre);
                                                            ($shop_sum_arari_progress_pre2 == 0 || $shop_sum_arari_progress_pre2 == "" || $shop_sum_arari_progress_pre2 == "---") ? $shop_arari_view3 = $shop_sum_arari_progress_pre2 : $shop_arari_view3 = number_format($shop_sum_arari_progress_pre2,1);
                                                            ($shop_sum_arari_progress_pre3 == 0 || $shop_sum_arari_progress_pre3 == "" || $shop_sum_arari_progress_pre3 == "---") ? $shop_arari_view4 = $shop_sum_arari_progress_pre3 : $shop_arari_view4 = number_format($shop_sum_arari_progress_pre3,1);
                                                            ($web_sum_arari_progress == 0 || $web_sum_arari_progress == "" || $web_sum_arari_progress == "---") ? $web_arari_view1 = $web_sum_arari_progress : $web_arari_view1 = number_format($web_sum_arari_progress);
                                                            ($web_sum_arari_progress_pre == 0 || $web_sum_arari_progress_pre == "" || $web_sum_arari_progress_pre == "---") ? $web_arari_view2 = $web_sum_arari_progress_pre : $web_arari_view2 = number_format($web_sum_arari_progress_pre);
                                                            ($web_sum_arari_progress_pre2 == 0 || $web_sum_arari_progress_pre2 == "" || $web_sum_arari_progress_pre2 == "---") ? $web_arari_view3 = $web_sum_arari_progress_pre2 : $web_arari_view3 = number_format($web_sum_arari_progress_pre2,1);
                                                            ($web_sum_arari_progress_pre3 == 0 || $web_sum_arari_progress_pre3 == ""|| $web_sum_arari_progress_pre3 == "---") ? $web_arari_view4 = $web_sum_arari_progress_pre3 : $web_arari_view4 = number_format($web_sum_arari_progress_pre3,1);
                                                            ($oroshi_sum_arari_progress == 0 || $oroshi_sum_arari_progress == "" || $oroshi_sum_arari_progress == "---") ? $oroshi_arari_view1 = $oroshi_sum_arari_progress : $oroshi_arari_view1 = number_format($oroshi_sum_arari_progress);
                                                            ($oroshi_sum_arari_progress_pre == 0 || $oroshi_sum_arari_progress_pre == "" || $oroshi_sum_arari_progress_pre == "---") ? $oroshi_arari_view2 = $oroshi_sum_arari_progress_pre : $oroshi_arari_view2 = number_format($oroshi_sum_arari_progress_pre);
                                                            ($oroshi_sum_arari_progress_pre2 == 0 || $oroshi_sum_arari_progress_pre2 == "" || $oroshi_sum_arari_progress_pre2 == "---") ? $oroshi_arari_view3 = $oroshi_sum_arari_progress_pre2 : $oroshi_arari_view3 = number_format($oroshi_sum_arari_progress_pre2,1);
                                                            ($oroshi_sum_arari_progress_pre3 == 0 || $oroshi_sum_arari_progress_pre3 == "" || $oroshi_sum_arari_progress_pre3 == "---") ? $oroshi_arari_view4 = $oroshi_sum_arari_progress_pre3 : $oroshi_arari_view4 = number_format($oroshi_sum_arari_progress_pre3,1);
                                                            ($all_sum_arari_progress == 0 || $all_sum_arari_progress == "" || $all_sum_arari_progress == "---") ? $all_arari_view1 = $all_sum_arari_progress : $all_arari_view1 = number_format($all_sum_arari_progress);
                                                            ($all_sum_arari_progress_pre == 0 || $all_sum_arari_progress_pre == "" || $all_sum_arari_progress_pre == "---") ? $all_arari_view2 = $all_sum_arari_progress_pre : $all_arari_view2 = number_format($all_sum_arari_progress_pre);
                                                            ($all_sum_arari_progress2 == 0 || $all_sum_arari_progress2 == "" || $all_sum_arari_progress2 == "---") ? $all_arari_view3 = $all_sum_arari_progress2 : $all_arari_view3 = number_format($all_sum_arari_progress2,1);
                                                            ($all_sum_arari_progress3 == 0 || $all_sum_arari_progress3 == "" || $all_sum_arari_progress3 == "---") ? $all_arari_view4 = $all_sum_arari_progress3 : $all_arari_view4 = number_format($all_sum_arari_progress3,1);
                                                            

                                                            ($shop_uriage_view3 < 100) ? $shop_uriage_view3 = "<div class='sinchoku fc_blue'>" . $shop_uriage_view3 . "%</div>" : $shop_uriage_view3 = "<div class='sinchoku fc_red'>" . $shop_uriage_view3 . "%</div>";
                                                            ($shop_uriage_view4 < 100) ? $shop_uriage_view4 = "<div class='sinchoku fc_blue'>" . $shop_uriage_view4 . "%</div>" : $shop_uriage_view4 = "<div class='sinchoku fc_red'>" . $shop_uriage_view4 . "%</div>";
                                                            ($web_uriage_view3 < 100) ? $web_uriage_view3 = "<div class='sinchoku fc_blue'>" . $web_uriage_view3 . "%</div>" : $web_uriage_view3 = "<div class='sinchoku fc_red'>" . $web_uriage_view3 . "%</div>";
                                                            ($web_uriage_view4 < 100) ? $web_uriage_view4 = "<div class='sinchoku fc_blue'>" . $web_uriage_view4 . "%</div>" : $web_uriage_view4 = "<div class='sinchoku fc_red'>" . $web_uriage_view4 . "%</div>";
                                                            ($oroshi_uriage_view3 < 100) ? $oroshi_uriage_view3 = "<div class='sinchoku fc_blue'>" . $oroshi_uriage_view3 . "%</div>" : $oroshi_uriage_view3 = "<div class='sinchoku fc_red'>" . $oroshi_uriage_view3 . "%</div>";
                                                            ($oroshi_uriage_view4 < 100) ? $oroshi_uriage_view4 = "<div class='sinchoku fc_blue'>" . $oroshi_uriage_view4 . "%</div>" : $oroshi_uriage_view4 = "<div class='sinchoku fc_red'>" . $oroshi_uriage_view4 . "%</div>";
                                                            ($all_uriage_view3 < 100) ? $all_uriage_view3 = "<div class='sinchoku bg_grey fc_blue'>" . $all_uriage_view3 . "%</div>" : $all_uriage_view3 = "<div class='sinchoku bg_grey fc_red'>" . $all_uriage_view3 . "%</div>";
                                                            ($all_uriage_view4 < 100) ? $all_uriage_view4 = "<div class='sinchoku bg_grey fc_blue'>" . $all_uriage_view4 . "%</div>" : $all_uriage_view4 = "<div class='sinchoku bg_grey fc_red'>" . $all_uriage_view4 . "%</div>";
                                                            ($shop_number_view3 < 100) ? $shop_number_view3 = "<div class='sinchoku fc_blue'>" . $shop_number_view3 . "%</div>" : $shop_number_view3 = "<div class='sinchoku fc_red'>" . $shop_number_view3 . "%</div>";
                                                            ($shop_number_view4 < 100) ? $shop_number_view4 = "<div class='sinchoku fc_blue'>" . $shop_number_view4 . "%</div>" : $shop_number_view4 = "<div class='sinchoku fc_red'>" . $shop_number_view4 . "%</div>";
                                                            ($web_number_view3 < 100) ? $web_number_view3 = "<div class='sinchoku fc_blue'>" . $web_number_view3 . "%</div>" : $web_number_view3 = "<div class='sinchoku fc_red'>" . $web_number_view3 . "%</div>";
                                                            ($web_number_view4 < 100) ? $web_number_view4 = "<div class='sinchoku fc_blue'>" . $web_number_view4 . "%</div>" : $web_number_view4 = "<div class='sinchoku fc_red'>" . $web_number_view4 . "%</div>";
                                                            ($oroshi_number_view3 < 100) ? $oroshi_number_view3 = "<div class='sinchoku fc_blue'>" . $oroshi_number_view3 . "%</div>" : $oroshi_number_view3 = "<div class='sinchoku fc_red'>" . $oroshi_number_view3 . "%</div>";
                                                            ($oroshi_number_view4 < 100) ? $oroshi_number_view4 = "<div class='sinchoku fc_blue'>" . $oroshi_number_view4 . "%</div>" : $oroshi_number_view4 = "<div class='sinchoku fc_red'>" . $oroshi_number_view4 . "%</div>";
                                                            ($all_number_view3 < 100) ? $all_number_view3 = "<div class='sinchoku bg_grey fc_blue'>" . $all_number_view3 . "%</div>" : $all_number_view3 = "<div class='sinchoku bg_grey fc_red'>" . $all_number_view3 . "%</div>";
                                                            ($all_number_view4 < 100) ? $all_number_view4 = "<div class='sinchoku bg_grey fc_blue'>" . $all_number_view4 . "%</div>" : $all_number_view4 = "<div class='sinchoku bg_grey fc_red'>" . $all_number_view4 . "%</div>";
                                                            ($shop_arari_view3 < 100) ? $shop_arari_view3 = "<div class='sinchoku fc_blue'>" . $shop_arari_view3 . "%</div>" : $shop_arari_view3 = "<div class='sinchoku fc_red'>" . $shop_arari_view3 . "%</div>";
                                                            ($shop_arari_view4 < 100) ? $shop_arari_view4 = "<div class='sinchoku fc_blue'>" . $shop_arari_view4 . "%</div>" : $shop_arari_view4 = "<div class='sinchoku fc_red'>" . $shop_arari_view4 . "%</div>";
                                                            ($web_arari_view3 < 100) ? $web_arari_view3 = "<div class='sinchoku fc_blue'>" . $web_arari_view3 . "%</div>" : $web_arari_view3 = "<div class='sinchoku fc_red'>" . $web_arari_view3 . "%</div>";
                                                            ($web_arari_view4 < 100) ? $web_arari_view4 = "<div class='sinchoku fc_blue'>" . $web_arari_view4 . "%</div>" : $web_arari_view4 = "<div class='sinchoku fc_red'>" . $web_arari_view4 . "%</div>";
                                                            ($oroshi_arari_view3 < 100) ? $oroshi_arari_view3 = "<div class='sinchoku fc_blue'>" . $oroshi_arari_view3 . "%</div>" : $oroshi_arari_view3 = "<div class='sinchoku fc_red'>" . $oroshi_arari_view3 . "%</div>";
                                                            ($oroshi_arari_view4 < 100) ? $oroshi_arari_view4 = "<div class='sinchoku fc_blue'>" . $oroshi_arari_view4 . "%</div>" : $oroshi_arari_view4 = "<div class='sinchoku fc_red'>" . $oroshi_arari_view4 . "%</div>";
                                                            ($all_arari_view3 < 100) ? $all_arari_view3 = "<div class='sinchoku bg_grey fc_blue'>" . $all_arari_view3 . "%</div>" : $all_arari_view3 = "<div class='sinchoku bg_grey fc_red'>" . $all_arari_view3 . "%</div>";
                                                            ($all_arari_view4 < 100) ? $all_arari_view4 = "<div class='sinchoku bg_grey fc_blue'>" . $all_arari_view4 . "%</div>" : $all_arari_view4 = "<div class='sinchoku bg_grey fc_red'>" . $all_arari_view4 . "%</div>";



                                        /************************************************************************************************************************************************************************************************************* */
                                            // 各予測値と過去比を取得 end
                                        /************************************************************************************************************************************************************************************************************* */
                                        



                    /************************************************************************************************************************************************************************************************************* */
                        // DB情報の受け取り（過去の期間）start
                    /************************************************************************************************************************************************************************************************************* */
                    
                            $past_temp1_title2 = "";
                            //$past_js_month = "";
                            $past_i = 0;

                            /************************************************************************************************************************************************************************************************************* */
                                // 通販用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */
                                    
                                    if($out1_b == "ON"){
                                            // DB検索（通販値）スタート
                                                $past_web_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS web_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS web_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS web_number"),
                                                        \DB::raw("SUM(ararikingaku) AS web_arari"),
                                                    ])
                                                    ->groupBy('web_month')
                                                // 条件（売上部門が通販）
                                                    ->where('baikyakukubun',2)
                                                // 条件（期間の指定）
                                                    ->whereBetween($table_name . '.uriage', [$past_between_start, $past_between_end])
                                                // 条件（分類名）
                                                    ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
															// 条件（商品区分分類名が新品）
																if($out2_a == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%新品%");
																}
															// 条件（商品区分分類名が中古）
																if($out2_b == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%中古%");
																}
															// 条件（商品区分分類名がアンティーク）
																if($out2_c == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
																}
															// 条件（商品区分分類名がその他）
																if($out2_d == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%その他%");
																}
															// 条件（商品区分分類名が修理）
																if($out2_e == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%修理%");
																}
                                                    
                                                    })
                                                // 条件（通販区分）
                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                            $query->orWhere('tsuuhankubun','');

															// 条件（通販区分が自社）
																if($out3_a == "ON"){
																	$query->orWhere('tsuuhankubun',1);
																}
															// 条件（通販区分が楽天）
																if($out3_b == "ON"){
																	$query->orWhere('tsuuhankubun',2);
																}
															// 条件（通販区分がヤフー）
																if($out3_c == "ON"){
																	$query->orWhere('tsuuhankubun',3);
																}
															// 条件（通販区分が電話・雑誌）
																if($out3_d == "ON"){
																	$query->orWhere('tsuuhankubun',5);
																}
															// 条件（通販区分がYオークション）
																if($out3_e == "ON"){
																	$query->orWhere('tsuuhankubun',4);
																}
															// 条件（通販区分が修理品返送）
																if($out3_f == "ON"){
																	$query->orWhere('tsuuhankubun',9);
																}
                                                    
                                                    })
                                                // 条件（免税）
                                                    ->where(function ($query) use ($out4_a,$out4_b) {
															// 条件（免税区分が0:対象外）
																if($out4_a == "ON"){
																	$query->orwhere("menzei","like","%対象外%");
																}
															// 条件（免税区分が1:免税）
																if($out4_b == "ON"){
																	$query->orwhere("menzei","like","%免税%");
																}
                                                    })
                                                // 条件（扱い部門）
                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                            $query->orWhere('bumonmei','');

															// 条件（扱い部門がジャック）
																if($out5_a == "ON"){
																	$query->orWhere('bumonmei','Jackroad');
																}
															// 条件（扱い部門がベティー）
																if($out5_b == "ON"){
																	$query->orWhere('bumonmei','BettyRoad');
																}
															// 条件（扱い部門がジュエリー）
																if($out5_c == "ON"){
																	$query->orWhere('bumonmei','Jewelry');
																}
                                                  
                                                    })
                                                // ソート順指定
                                                    ->orderBy('uriage', 'asc')
                                                    ->get();

                                            // クエリビルダスタート
                                                $past_i = 0;
                                                // 変数リセット
                                                    $past_web_sum_uriage = "";
                                                    $past_web_sum_number = "";
                                                    $past_web_sum_arari= "";
                                                    foreach ($past_web_buys as $past_web_buy) {
                                                        // 各月名
                                                            $past_web_month[$past_i]= $past_web_buy->web_month;
                                                        // 各月通販売上
                                                            $past_web_uriage[$past_i]= $past_web_buy->web_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($past_temp1_web_manthly_data, $past_web_month[$past_i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $past_temp1_web_manthly_data = str_replace($past_web_month[$past_i], $past_web_uriage[$past_i], $past_temp1_web_manthly_data);
                                                                }

                                                        // 全期間通販売上合計
                                                            $past_web_sum_uriage = (int)$past_web_sum_uriage + (int)$past_web_uriage[$past_i];

                                                        // 各月通販点数
                                                            $past_web_number[$past_i]= $past_web_buy->web_number;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($past_temp1_web_manthly_data2, $past_web_month[$past_i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $past_temp1_web_manthly_data2 = str_replace($past_web_month[$past_i], $past_web_number[$past_i], $past_temp1_web_manthly_data2);
                                                                }

                                                        // 全期間通販点数合計
                                                            $past_web_sum_number = (int)$past_web_sum_number + (int)$past_web_number[$past_i];



                                                        // 各月通販粗利
                                                            $past_web_arari[$past_i]= $past_web_buy->web_arari;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($past_temp1_web_manthly_data3, $past_web_month[$past_i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $past_temp1_web_manthly_data3 = str_replace($past_web_month[$past_i], $past_web_arari[$past_i], $past_temp1_web_manthly_data3);
                                                                }

                                                        // 全期間通販粗利合計
                                                            $past_web_sum_arari = (int)$past_web_sum_arari + (int)$past_web_arari[$past_i];
                                                            
                                                        $past_i++;
                                                    }
                                                // 全期間通販売上合計とその平均値のHTML作成
                                                    $past_temp1_web_sum = "";
                                                    if($past_web_sum_uriage <> 0 && $past_web_sum_uriage <> ""){
                                                        $past_web_sum_uriage_c = number_format((int)$past_web_sum_uriage); 
                                                        $past_web_sum_uriage_ave = number_format(floor((int)$past_web_sum_uriage / $past_i));
                                                        $past_web_sum_uriage_ave2 = floor((int)$past_web_sum_uriage / $past_i);
                                                    } else {
                                                        $past_web_sum_uriage_c = $past_web_sum_uriage; 
                                                        $past_web_sum_uriage_ave = 0;
                                                        $past_web_sum_uriage_ave2 = 0;
                                                    }
                                                    //$past_temp1_web_sum = "<div class='title4 ta_r'>" . number_format((int)$past_web_sum_uriage) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$past_web_sum_uriage / $past_i)) . "</div></div>";
                                                    $past_temp1_web_sum = "<div class='title4 ta_r'>" . $past_web_sum_uriage_c . "</div><div class='title4 ta_r'>" . $past_web_sum_uriage_ave . "</div></div>";
                                                // 全期間通販売上点数合計とその平均値のHTML作成
                                                    $past_temp1_web_sum2 = "";
                                                    if($past_web_sum_number <> 0 && $past_web_sum_number <> ""){
                                                        $past_web_sum_number_c = number_format((int)$past_web_sum_number); 
                                                        $past_web_sum_number_ave = number_format(floor((int)$past_web_sum_number / $past_i));
                                                        $past_web_sum_number_ave2 = floor((int)$past_web_sum_number / $past_i);
                                                    } else {
                                                        $past_web_sum_number_c = $past_web_sum_number; 
                                                        $past_web_sum_number_ave = 0;
                                                        $past_web_sum_number_ave2 = 0;
                                                    }
                                                    //$past_temp1_web_sum2 = "<div class='title4 ta_r'>" . number_format((int)$past_web_sum_number) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$past_web_sum_number/ $past_i)) . "</div></div>";
                                                    $past_temp1_web_sum2 = "<div class='title4 ta_r'>" . $past_web_sum_number_c . "</div><div class='title4 ta_r'>" . $past_web_sum_number_ave . "</div></div>";
                                                // 全期間通販粗利合計とその平均値のHTML作成
                                                    $past_temp1_web_sum3 = "";
                                                    if($past_web_sum_arari <> 0 && $past_web_sum_arari <> ""){
                                                        $past_web_sum_arari_c = number_format((int)$past_web_sum_arari); 
                                                        $past_web_sum_arari_ave = number_format(floor((int)$past_web_sum_arari / $past_i));
                                                        $past_web_sum_arari_ave2 = floor((int)$past_web_sum_arari / $past_i);
                                                    } else {
                                                        $past_web_sum_arari_c = $past_web_sum_arari; 
                                                        $past_web_sum_arari_ave = 0;
                                                        $past_web_sum_arari_ave2 = 0;
                                                    }
                                                    //$past_temp1_web_sum3 = "<div class='title4 ta_r'>" . number_format((int)$past_web_sum_arari) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$past_web_sum_arari/ $past_i)) . "</div></div>";
                                                    $past_temp1_web_sum3 = "<div class='title4 ta_r'>" . $past_web_sum_arari_c . "</div><div class='title4 ta_r'>" . $past_web_sum_arari_ave . "</div></div>";
                                    }
        

                            /************************************************************************************************************************************************************************************************************* */
                                // 店舗用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */
                                    if($out1_a == "ON"){
                                            // DB検索（店舗値）スタート
                                                $past_shop_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS shop_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS shop_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS shop_number"),
                                                        \DB::raw("SUM(ararikingaku) AS shop_arari"),
                                                    ])
                                                    ->groupBy('shop_month')
                                                // 条件（売上部門が店舗）
                                                    ->where('baikyakukubun',1)
                                                // 条件（期間の指定）
                                                    ->whereBetween($table_name . '.uriage', [$past_between_start, $past_between_end])
                                                // 条件（分類名）
                                                    ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
															// 条件（商品区分分類名が新品）
																if($out2_a == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%新品%");
																}
															// 条件（商品区分分類名が中古）
																if($out2_b == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%中古%");
																}
															// 条件（商品区分分類名がアンティーク）
																if($out2_c == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
																}
															// 条件（商品区分分類名がその他）
																if($out2_d == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%その他%");
																}
															// 条件（商品区分分類名が修理）
																if($out2_e == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%修理%");
																}
                                                    
                                                    })
                                                // 条件（通販区分）
                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                            $query->orWhere('tsuuhankubun','');

															// 条件（通販区分が自社）
																if($out3_a == "ON"){
																	$query->orWhere('tsuuhankubun',1);
																}
															// 条件（通販区分が楽天）
																if($out3_b == "ON"){
																	$query->orWhere('tsuuhankubun',2);
																}
															// 条件（通販区分がヤフー）
																if($out3_c == "ON"){
																	$query->orWhere('tsuuhankubun',3);
																}
															// 条件（通販区分が電話・雑誌）
																if($out3_d == "ON"){
																	$query->orWhere('tsuuhankubun',5);
																}
															// 条件（通販区分がYオークション）
																if($out3_e == "ON"){
																	$query->orWhere('tsuuhankubun',4);
																}
															// 条件（通販区分が修理品返送）
																if($out3_f == "ON"){
																	$query->orWhere('tsuuhankubun',9);
																}
                                                    
                                                    })
                                                // 条件（免税）
                                                    ->where(function ($query) use ($out4_a,$out4_b) {
															// 条件（免税区分が0:対象外）
																if($out4_a == "ON"){
																	$query->orwhere("menzei","like","%対象外%");
																}
															// 条件（免税区分が1:免税）
																if($out4_b == "ON"){
																	$query->orwhere("menzei","like","%免税%");
																}
                                                    })
                                                // 条件（扱い部門）
                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                            $query->orWhere('bumonmei','');

															// 条件（扱い部門がジャック）
																if($out5_a == "ON"){
																	$query->orWhere('bumonmei','Jackroad');
																}
															// 条件（扱い部門がベティー）
																if($out5_b == "ON"){
																	$query->orWhere('bumonmei','BettyRoad');
																}
															// 条件（扱い部門がジュエリー）
																if($out5_c == "ON"){
																	$query->orWhere('bumonmei','Jewelry');
																}
                                                  
                                                    })
                                                // ソート順指定
                                                    ->orderBy('uriage', 'asc')
                                                    ->get();

                                            // クエリビルダスタート
                                                $past_i = 0;
                                                // 変数リセット
                                                    $past_shop_sum_uriage = "";
                                                    $past_shop_sum_number = "";
                                                    $past_shop_sum_arari = "";
                                                    foreach ($past_shop_buys as $past_shop_buy) {
                                                        // 各月名
                                                            $past_shop_month[$past_i]= $past_shop_buy->shop_month;
                                                        // 各月店舗売上
                                                            $past_shop_uriage[$past_i]= $past_shop_buy->shop_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($past_temp1_shop_manthly_data, $past_shop_month[$past_i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $past_temp1_shop_manthly_data = str_replace($past_shop_month[$past_i], $past_shop_uriage[$past_i], $past_temp1_shop_manthly_data);
                                                                }
                                                        // 全期間店舗売上合計
                                                            $past_shop_sum_uriage = (int)$past_shop_sum_uriage + (int)$past_shop_uriage[$past_i];
                                                        
                                                        // 各月店舗点数
                                                            $past_shop_number[$past_i]= $past_shop_buy->shop_number;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($past_temp1_shop_manthly_data2, $past_shop_month[$past_i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $past_temp1_shop_manthly_data2 = str_replace($past_shop_month[$past_i], $past_shop_number[$past_i], $past_temp1_shop_manthly_data2);
                                                                }
                                                        // 全期間店舗点数合計
                                                            $past_shop_sum_number = (int)$past_shop_sum_number + (int)$past_shop_number[$past_i];
                                                          
                                                            
                                                        // 各月店舗粗利
                                                            $past_shop_arari[$past_i]= $past_shop_buy->shop_arari;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($past_temp1_shop_manthly_data3,$past_shop_month[$past_i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $past_temp1_shop_manthly_data3 = str_replace($past_shop_month[$past_i], $past_shop_arari[$past_i], $past_temp1_shop_manthly_data3);
                                                                }
                                                        // 全期間店舗粗利合計
                                                            $past_shop_sum_arari = (int)$past_shop_sum_arari + (int)$past_shop_arari[$past_i];
                                                            
                                                        $past_i++;
                                                    }
                                                // 全期間店舗売上合計とその平均値のHTML作成
                                                    $past_temp1_shop_sum = "";
                                                    if($past_shop_sum_uriage <> 0 && $past_shop_sum_uriage <> ""){
                                                        $past_shop_sum_uriage_c = number_format((int)$past_shop_sum_uriage); 
                                                        $past_shop_sum_uriage_ave = number_format(floor((int)$past_shop_sum_uriage / $past_i));
                                                        $past_shop_sum_uriage_ave2 = floor((int)$past_shop_sum_uriage / $past_i);
                                                    } else {
                                                        $past_shop_sum_uriage_c = $past_shop_sum_uriage; 
                                                        $past_shop_sum_uriage_ave = 0;
                                                        $past_shop_sum_uriage_ave2 = 0;
                                                    }
                                                    //$past_temp1_shop_sum = "<div class='title4 ta_r'>" . number_format((int)$past_shop_sum_uriage) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$past_shop_sum_uriage / $past_i)) . "</div></div>";
                                                    $past_temp1_shop_sum = "<div class='title4 ta_r'>" . $past_shop_sum_uriage_c . "</div><div class='title4 ta_r'>" . $past_shop_sum_uriage_ave . "</div></div>";
                                                // 全期間店舗売上点数合計とその平均値のHTML作成
                                                    $past_temp1_shop_sum2 = "";
                                                    if($past_shop_sum_number <> 0 && $past_shop_sum_number <> ""){
                                                        $past_shop_sum_number_c = number_format((int)$past_shop_sum_number); 
                                                        $past_shop_sum_number_ave = number_format(floor((int)$past_shop_sum_number / $past_i));
                                                        $past_shop_sum_number_ave2 = floor((int)$past_shop_sum_number / $past_i);
                                                    } else {
                                                        $past_shop_sum_number_c = $past_shop_sum_number; 
                                                        $past_shop_sum_number_ave = 0;
                                                        $past_shop_sum_number_ave2 = 0;
                                                    }
                                                    //$past_temp1_shop_sum2 = "<div class='title4 ta_r'>" . number_format((int)$past_shop_sum_number) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$past_shop_sum_number / $past_i)) . "</div></div>";
                                                    $past_temp1_shop_sum2 = "<div class='title4 ta_r'>" . $past_shop_sum_number_c . "</div><div class='title4 ta_r'>" . $past_shop_sum_number_ave . "</div></div>";
                                                // 全期間店舗粗利合計とその平均値のHTML作成
                                                    $past_temp1_shop_sum3 = "";
                                                    if($past_shop_sum_arari <> 0 && $past_shop_sum_arari <> ""){
                                                        $past_shop_sum_arari_c = number_format((int)$past_shop_sum_arari); 
                                                        $past_shop_sum_arari_ave = number_format(floor((int)$past_shop_sum_arari / $past_i));
                                                        $past_shop_sum_arari_ave2 = floor((int)$past_shop_sum_arari / $past_i);
                                                    } else {
                                                        $past_shop_sum_arari_c = $past_shop_sum_arari; 
                                                        $past_shop_sum_arari_ave = 0;
                                                        $past_shop_sum_arari_ave2 = 0;
                                                    }
                                                    //$past_temp1_shop_sum3 = "<div class='title4 ta_r'>" . number_format((int)$past_shop_sum_arari) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$past_shop_sum_arari / $past_i)) . "</div></div>";
                                                    $past_temp1_shop_sum3 = "<div class='title4 ta_r'>" . $past_shop_sum_arari_c . "</div><div class='title4 ta_r'>" . $past_shop_sum_arari_ave . "</div></div>";
                                    }

     

                            /************************************************************************************************************************************************************************************************************* */
                                // 卸用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */
                                    if($out1_c == "ON"){
                                            // DB検索（卸）スタート
                                                $past_oroshi_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS oroshi_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS oroshi_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS oroshi_number"),
                                                        \DB::raw("SUM(ararikingaku) AS oroshi_arari"),
                                                    ])
                                                    ->groupBy('oroshi_month')
                                                // 条件（売上部門が卸）
                                                    ->where('baikyakukubun',3)
                                                // 条件（期間の指定）
                                                    ->whereBetween($table_name . '.uriage', [$past_between_start, $past_between_end])
                                                // 条件（分類名）
                                                    ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
															// 条件（商品区分分類名が新品）
																if($out2_a == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%新品%");
																}
															// 条件（商品区分分類名が中古）
																if($out2_b == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%中古%");
																}
															// 条件（商品区分分類名がアンティーク）
																if($out2_c == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
																}
															// 条件（商品区分分類名がその他）
																if($out2_d == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%その他%");
																}
															// 条件（商品区分分類名が修理）
																if($out2_e == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%修理%");
																}
                                                    
                                                    })
                                                // 条件（通販区分）
                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                            $query->orWhere('tsuuhankubun','');

															// 条件（通販区分が自社）
																if($out3_a == "ON"){
																	$query->orWhere('tsuuhankubun',1);
																}
															// 条件（通販区分が楽天）
																if($out3_b == "ON"){
																	$query->orWhere('tsuuhankubun',2);
																}
															// 条件（通販区分がヤフー）
																if($out3_c == "ON"){
																	$query->orWhere('tsuuhankubun',3);
																}
															// 条件（通販区分が電話・雑誌）
																if($out3_d == "ON"){
																	$query->orWhere('tsuuhankubun',5);
																}
															// 条件（通販区分がYオークション）
																if($out3_e == "ON"){
																	$query->orWhere('tsuuhankubun',4);
																}
															// 条件（通販区分が修理品返送）
																if($out3_f == "ON"){
																	$query->orWhere('tsuuhankubun',9);
																}
                                                    
                                                    })
                                                // 条件（免税）
                                                    ->where(function ($query) use ($out4_a,$out4_b) {
															// 条件（免税区分が0:対象外）
																if($out4_a == "ON"){
																	$query->orwhere("menzei","like","%対象外%");
																}
															// 条件（免税区分が1:免税）
																if($out4_b == "ON"){
																	$query->orwhere("menzei","like","%免税%");
																}
                                                    })
                                                // 条件（扱い部門）
                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                            $query->orWhere('bumonmei','');

															// 条件（扱い部門がジャック）
																if($out5_a == "ON"){
																	$query->orWhere('bumonmei','Jackroad');
																}
															// 条件（扱い部門がベティー）
																if($out5_b == "ON"){
																	$query->orWhere('bumonmei','BettyRoad');
																}
															// 条件（扱い部門がジュエリー）
																if($out5_c == "ON"){
																	$query->orWhere('bumonmei','Jewelry');
																}
                                                  
                                                    })
                                                // ソート順指定
                                                    ->orderBy('uriage', 'asc')
                                                    ->get();

                                            // クエリビルダスタート
                                                // 以下の変数は月数フラグとして後のロジックで使用するが、フォームにて「免税のみ」を選択した場合「卸」は全月一つも無いので、上でロジックが止まってしまい月数カウントの変数も0のままとなる。「卸」のみ独立した変数名として、カウント用は店舗用で対応
                                                $past_i2 = 0;
                                                // 変数リセット
                                                    $past_oroshi_sum_uriage = 0;
                                                    $past_oroshi_sum_number = 0;
                                                    $past_oroshi_sum_arari= 0;
                                                    foreach ($past_oroshi_buys as $past_oroshi_buy) {
                                                        // 各月名
                                                            $past_oroshi_month[$past_i2]= $past_oroshi_buy->oroshi_month;
                                                        // 各月卸売上
                                                            $past_oroshi_uriage[$past_i2]= $past_oroshi_buy->oroshi_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($past_temp1_oroshi_manthly_data, $past_oroshi_month[$past_i2] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $past_temp1_oroshi_manthly_data = str_replace($past_oroshi_month[$past_i2], $past_oroshi_uriage[$past_i2], $past_temp1_oroshi_manthly_data);
                                                                }
                                                        // 全期間卸売上合計
                                                            $past_oroshi_sum_uriage = (int)$past_oroshi_sum_uriage + (int)$past_oroshi_uriage[$past_i2];
                                                        // 各月卸点数
                                                            $past_oroshi_number[$past_i2]= $past_oroshi_buy->oroshi_number;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($past_temp1_oroshi_manthly_data2, $past_oroshi_month[$past_i2] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $past_temp1_oroshi_manthly_data2 = str_replace($past_oroshi_month[$past_i2], $past_oroshi_number[$past_i2], $past_temp1_oroshi_manthly_data2);
                                                                }
                                                        // 全期間卸点数合計
                                                            $past_oroshi_sum_number = (int)$past_oroshi_sum_number + (int)$past_oroshi_number[$past_i2];
                                                        
                                                        // 各月卸粗利
                                                            $past_oroshi_arari[$past_i2]= $past_oroshi_buy->oroshi_arari;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($past_temp1_oroshi_manthly_data3, $past_oroshi_month[$past_i2] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $past_temp1_oroshi_manthly_data3 = str_replace($past_oroshi_month[$past_i2], $past_oroshi_arari[$past_i2], $past_temp1_oroshi_manthly_data3);
                                                                }
                                                        // 全期間卸粗利合計
                                                            $past_oroshi_sum_arari = (int)$past_oroshi_sum_arari + (int)$past_oroshi_arari[$past_i2];
                                                            
                                                            $past_i2++;
                                                    }
                                                // 全期間卸売上合計とその平均値のHTML作成
                                                    $past_temp1_oroshi_sum = "";
                                                    if($past_oroshi_sum_uriage <> 0 && $past_oroshi_sum_uriage <> ""){
                                                        $past_oroshi_sum_uriage_c = number_format((int)$past_oroshi_sum_uriage); 
                                                        $past_oroshi_sum_uriage_ave = number_format(floor((int)$past_oroshi_sum_uriage / $past_i2));
                                                        $past_oroshi_sum_uriage_ave2 = floor((int)$past_oroshi_sum_uriage / $past_i);
                                                    } else {
                                                        $past_oroshi_sum_uriage_c = $past_oroshi_sum_uriage; 
                                                        $past_oroshi_sum_uriage_ave = 0;
                                                        $past_oroshi_sum_uriage_ave2 = 0;
                                                    }
                                                    //$past_temp1_oroshi_sum .= "<div class='title4 ta_r'>" . number_format((int)$past_oroshi_sum_uriage) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$past_oroshi_sum_uriage / $past_i2)) . "</div></div>";
                                                    $past_temp1_oroshi_sum .= "<div class='title4 ta_r'>" . $past_oroshi_sum_uriage_c . "</div><div class='title4 ta_r'>" . $past_oroshi_sum_uriage_ave . "</div></div>";
                                                // 全期間卸売上点数合計とその平均値のHTML作成
                                                    $past_temp1_oroshi_sum2 = "";
                                                    if($past_oroshi_sum_number <> 0 && $past_oroshi_sum_number <> ""){
                                                        $past_oroshi_sum_number_c = number_format((int)$past_oroshi_sum_number); 
                                                        $past_oroshi_sum_number_ave = number_format(floor((int)$past_oroshi_sum_number / $past_i2));
                                                        $past_oroshi_sum_number_ave2 = floor((int)$past_oroshi_sum_number / $past_i);
                                                    } else {
                                                        $past_oroshi_sum_number_c = $past_oroshi_sum_number; 
                                                        $past_oroshi_sum_number_ave = 0;
                                                        $past_oroshi_sum_number_ave2 = 0;
                                                    }
                                                    //$past_temp1_oroshi_sum2 = "<div class='title4 ta_r'>" . number_format((int)$past_oroshi_sum_number) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$past_oroshi_sum_number / $past_i2)) . "</div></div>";
                                                    $past_temp1_oroshi_sum2 = "<div class='title4 ta_r'>" . $past_oroshi_sum_number_c . "</div><div class='title4 ta_r'>" . $past_oroshi_sum_number_ave . "</div></div>";
                                                // 全期間卸粗利合計とその平均値のHTML作成
                                                    $past_temp1_oroshi_sum3 = "";
                                                    if($past_oroshi_sum_arari <> 0 && $past_oroshi_sum_arari <> ""){
                                                        $past_oroshi_sum_arari_c = number_format((int)$past_oroshi_sum_arari); 
                                                        $past_oroshi_sum_arari_ave = number_format(floor((int)$past_oroshi_sum_arari / $past_i2));
                                                        $past_oroshi_sum_arari_ave2 = floor((int)$past_oroshi_sum_arari / $past_i);
                                                    } else {
                                                        $past_oroshi_sum_arari_c = $past_oroshi_sum_arari; 
                                                        $past_oroshi_sum_arari_ave = 0;
                                                        $past_oroshi_sum_arari_ave2 = 0;
                                                    }
                                                    //$past_temp1_oroshi_sum3 = "<div class='title4 ta_r'>" . number_format((int)$past_oroshi_sum_arari) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$past_oroshi_sum_arari / $past_i2)) . "</div></div>";
                                                    $past_temp1_oroshi_sum3 = "<div class='title4 ta_r'>" . $past_oroshi_sum_arari_c . "</div><div class='title4 ta_r'>" . $past_oroshi_sum_arari_ave . "</div></div>";
                                    }

                                            
                            /************************************************************************************************************************************************************************************************************* */
                                // 全件用
                            /************************************************************************************************************************************************************************************************************* */

                                        // 各月の全部門売上合計の先頭（1列目）部分のタイトルHTML
                                            //$past_all_sum_uriage = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $past_all_sum_number = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                        // 各月のタイトル表示用HTMLを作成
                                            $js_month = "";
                                            foreach($manth_now_array as $val){
                                                // JSグラフ用
                                                    $js_month .= "'" . $val . "(" . date("Y-m", strtotime($val. " -" . ($diff_month + 1) . " month")) . ")'" . ",";
                                            }
                                            $past_temp1_title2 = "";
                                            $past_temp1_title3 = "";
                                            $past_temp1_title4 = "";
                                            $past_temp1_title5 = "";
                                            foreach($manth_past_array as $val){
                                                // 表示用
                                                    $val = mb_substr($val,0,-3);
                                                    $past_temp1_title2 .= "<div class='title2 ta_c'>" . $val . "</div>";
                                                    $past_temp1_title3 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                                    $past_temp1_title4 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                                    $past_temp1_title5 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                            }
                                
                                            $past_temp1_title = "<div class='wid100 ul2'><div class='title5 ta_c'>" . $past_between_start_view. "～<br>" .$past_between_end_view . "</div>" .$past_temp1_title2 ."<div class='title6 ta_c'>累計</div><div class='title6 ta_c'>平均</div></div>";
                                            $past_temp1_title3 = "<div class='wid100 ul2'><div class='title7 ta_c'>" . $past_between_start_view. "～<br>" .$past_between_end_view . "</div>" .$past_temp1_title3 ."<div class='title7 ta_c'>平均</div></div>";
                                            $past_temp1_title4 = "<div class='wid100 ul2 bg_green'><div class='title7 ta_c'>" . $past_between_start_view. "～<br>" .$past_between_end_view . "</div>" .$past_temp1_title4 ."<div class='title7 ta_c'>平均</div></div>";
                                            $past_temp1_title5 = "<div class='wid100 ul2 bg_yellow'><div class='title7 ta_c'>" . $past_between_start_view. "～<br>" .$past_between_end_view . "</div>" .$past_temp1_title5 ."<div class='title7 ta_c'>平均</div></div>";
                                        
                                     
                                        
                                        // 全期間の全部門売上合計用変数リセット
                                            $past_all_sum_uriage_all = 0;
                                            $past_all_sum_number_all = 0;
                                            $past_all_sum_arari_all = 0;
                                            for($past_all_i = 0; $past_all_i < $past_i; $past_all_i++){
                                                // 各月の全部門売上合計用変数リセット
                                                    $past_all_month_uriage = 0;
                                                    $past_all_month_number= 0;
                                                    $past_all_month_arari= 0;
                                                // 各月の全部門売上合計をHTMLへ
                                                    if($out1_b == "ON"){ 
                                                        if(isset($past_web_uriage[$past_all_i])){$past_all_month_uriage = $past_all_month_uriage + (int)$past_web_uriage[$past_all_i];}
                                                        if(isset($past_web_number[$past_all_i])){$past_all_month_number = $past_all_month_number + (int)$past_web_number[$past_all_i]; }
                                                        if(isset($past_web_arari[$past_all_i])){$past_all_month_arari = $past_all_month_arari + (int)$past_web_arari[$past_all_i]; }
                                                    }
                                                    if($out1_a == "ON"){ 
                                                        if(isset($past_shop_uriage[$past_all_i])){$past_all_month_uriage = $past_all_month_uriage + (int)$past_shop_uriage[$past_all_i]; }
                                                        if(isset($past_shop_number[$past_all_i])){$past_all_month_number = $past_all_month_number + (int)$past_shop_number[$past_all_i];} 
                                                        if(isset($past_shop_arari[$past_all_i])){$past_all_month_arari = $past_all_month_arari + (int)$past_shop_arari[$past_all_i]; }
                                                    }
                                                    if($out1_c == "ON"){ 
                                                        // フォーム上の選択が「免税」のみだと「卸」は全月0なので「卸」を含む足し算だとエラーとなるため、条件分岐で回避
                                                            if($out4_a == "OFF" && $out4_b == "ON"){
                                                                $past_all_month_uriage = $past_all_month_uriage; 
                                                                $past_all_month_number = $past_all_month_number; 
                                                                $past_all_month_arari = $past_all_month_arari; 
                                                            } else {
                                                                if(isset($past_oroshi_uriage[$past_all_i])){ $past_all_month_uriage = $past_all_month_uriage + (int)$past_oroshi_uriage[$past_all_i]; }
                                                                if(isset($past_oroshi_number[$past_all_i])){ $past_all_month_number = $past_all_month_number + (int)$past_oroshi_number[$past_all_i]; }
                                                                if(isset($past_oroshi_arari[$past_all_i])){ $past_all_month_arari = $past_all_month_arari + (int)$past_oroshi_arari[$past_all_i]; }
                                                            }
                                                    }

                                                // 全期間の全部門売上合計
                                                    $past_all_sum_uriage_all = (int)$past_all_sum_uriage_all + (int)$past_all_month_uriage;
                                                    $past_all_sum_number_all = (int)$past_all_sum_number_all + (int)$past_all_month_number;
                                                    $past_all_sum_arari_all = (int)$past_all_sum_arari_all + (int)$past_all_month_arari;
                                                
                                            }



                            /************************************************************************************************************************************************************************************************************* */
                                // 最終ソース出力
                            /************************************************************************************************************************************************************************************************************* */
                                        


                                        // 通販（過去）用HTMLの作成
                                                $past_js_web_uriage  = "";
                                                $past_js_web_number  = "";
                                                $past_js_web_arari  = "";
                                                $past_temp1_web_manthly_html = "";
                                                $past_temp1_web_manthly_html2 = "";
                                                $past_temp1_web_manthly_html3 = "";
                                                if($out1_b == "ON"){     
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_past_array as $val){
                                                                $val = mb_substr($val,0,-3);
                                                                if(strpos($past_temp1_web_manthly_data, $val ) !== false){
                                                                    $past_temp1_web_manthly_data = str_replace($val, 0, $past_temp1_web_manthly_data);
                                                                }
                                                                if(strpos($past_temp1_web_manthly_data2, $val ) !== false){
                                                                    $past_temp1_web_manthly_data2 = str_replace($val, 0, $past_temp1_web_manthly_data2);
                                                                }
                                                                if(strpos($past_temp1_web_manthly_data3, $val ) !== false){
                                                                    $past_temp1_web_manthly_data3 = str_replace($val, 0, $past_temp1_web_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $past_temp1_web_manthly_array = explode(',',$past_temp1_web_manthly_data);
                                                        $past_temp1_web_manthly_array2 = explode(',',$past_temp1_web_manthly_data2);
                                                        $past_temp1_web_manthly_array3 = explode(',',$past_temp1_web_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        $past_web_last_uriage = "";

                                                        foreach($past_temp1_web_manthly_array as $val){
                                                            // 【進捗率の取得】最終月の「過去・通販・売上」を取得
                                                                //$past_web_last_uriage = $val;
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $past_js_web_uriage  .= "0, ";
                                                                // 表示用
                                                                    $past_temp1_web_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $past_js_web_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $past_temp1_web_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }

                                                        }
                                                        foreach($past_temp1_web_manthly_array2 as $val){
                                                            // 【進捗率の取得】最終月の「過去・通販・点数」を取得
                                                                //$past_web_last_number = $val;
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $past_js_web_number  .= "0, ";
                                                                // 表示用
                                                                    $past_temp1_web_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $past_js_web_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $past_temp1_web_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }

                                                        }
                                                        foreach($past_temp1_web_manthly_array3 as $val){
                                                            // 【進捗率の取得】最終月の「過去・通販・粗利」を取得
                                                                //$past_web_last_arari = $val;
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $past_js_web_arari  .= "0, ";
                                                                // 表示用
                                                                    $past_temp1_web_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $past_js_web_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $past_temp1_web_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }

                                                        }
                                                    // 全体HTMLの作成
                                                        if(isset($past_temp1_web_manthly_html) && isset($past_temp1_web_sum)){
                                                            $past_temp1_web_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>通販</div>" . $past_temp1_web_manthly_html . $past_temp1_web_sum;
                                                        }
                                                        if(isset($past_temp1_web_manthly_html2) && isset($past_temp1_web_sum2)){
                                                            $past_temp1_web_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>通販</div>" . $past_temp1_web_manthly_html2 . $past_temp1_web_sum2;
                                                        }
                                                        if(isset($past_temp1_web_manthly_html3) && isset($past_temp1_web_sum3)){
                                                            $past_temp1_web_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>通販</div>" . $past_temp1_web_manthly_html3 . $past_temp1_web_sum3;
                                                        }
                                                }
                                
                            
                                        // 店舗（過去）用HTMLの作成
                                                $past_js_shop_uriage  = "";
                                                $past_js_shop_number  = "";
                                                $past_js_shop_arari = "";
                                                $past_temp1_shop_manthly_html = "";
                                                $past_temp1_shop_manthly_html2 = "";
                                                $past_temp1_shop_manthly_html3 = "";
                                                if($out1_a == "ON"){     
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_past_array as $val){
                                                                $val = mb_substr($val,0,-3);
                                                                if(strpos($past_temp1_shop_manthly_data, $val ) !== false){
                                                                    $past_temp1_shop_manthly_data = str_replace($val, 0, $past_temp1_shop_manthly_data);
                                                                }
                                                                if(strpos($past_temp1_shop_manthly_data2, $val ) !== false){
                                                                    $past_temp1_shop_manthly_data2 = str_replace($val, 0, $past_temp1_shop_manthly_data2);
                                                                }
                                                                if(strpos($past_temp1_shop_manthly_data3, $val ) !== false){
                                                                    $past_temp1_shop_manthly_data3 = str_replace($val, 0, $past_temp1_shop_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $past_temp1_shop_manthly_array = explode(',',$past_temp1_shop_manthly_data);
                                                        $past_temp1_shop_manthly_array2 = explode(',',$past_temp1_shop_manthly_data2);
                                                        $past_temp1_shop_manthly_array3 = explode(',',$past_temp1_shop_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        foreach($past_temp1_shop_manthly_array as $val){
                                                            // 【進捗率の取得】最終月の「過去・店舗・売上」を取得
                                                                //$past_shop_last_uriage = $val;

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $past_js_shop_uriage  .= "0, ";
                                                                // 表示用
                                                                    $past_temp1_shop_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $past_js_shop_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $past_temp1_shop_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }

                                                        }
                                                        foreach($past_temp1_shop_manthly_array2 as $val){
                                                            // 【進捗率の取得】最終月の「過去・店舗・点数」を取得
                                                                //$past_shop_last_number = $val;
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $past_js_shop_number  .= "0, ";
                                                                // 表示用
                                                                    $past_temp1_shop_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $past_js_shop_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $past_temp1_shop_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }

                                                        }
                                                        foreach($past_temp1_shop_manthly_array3 as $val){
                                                            // 【進捗率の取得】最終月の「過去・店舗・粗利」を取得
                                                                //$past_shop_last_arari = $val;
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $past_js_shop_arari  .= "0, ";
                                                                // 表示用
                                                                    $past_temp1_shop_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $past_js_shop_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $past_temp1_shop_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }

                                                        }
                                                    // 全体HTMLの作成
                                                        if(isset($past_temp1_shop_manthly_html) && isset($past_temp1_shop_sum)){
                                                            $past_temp1_shop_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>店舗</div>" . $past_temp1_shop_manthly_html . $past_temp1_shop_sum;
                                                        }
                                                        if(isset($past_temp1_shop_manthly_html2) && isset($past_temp1_shop_sum2)){
                                                            $past_temp1_shop_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>店舗</div>" . $past_temp1_shop_manthly_html2 . $past_temp1_shop_sum2;
                                                        }
                                                        if(isset($past_temp1_shop_manthly_html3) && isset($past_temp1_shop_sum3)){
                                                            $past_temp1_shop_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>店舗</div>" . $past_temp1_shop_manthly_html3 . $past_temp1_shop_sum3;
                                                        }
                                                }


                                        // 卸（過去）用HTMLの作成
                                                $past_js_oroshi_uriage  = "";
                                                $past_js_oroshi_number  = "";
                                                $past_js_oroshi_arari  = "";
                                                $past_temp1_oroshi_manthly_html = "";
                                                $past_temp1_oroshi_manthly_html2 = "";
                                                $past_temp1_oroshi_manthly_html3 = "";
                                                if($out1_c == "ON"){     
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_past_array as $val){
                                                                $val = mb_substr($val,0,-3);
                                                                if(strpos($past_temp1_oroshi_manthly_data, $val ) !== false){
                                                                    $past_temp1_oroshi_manthly_data = str_replace($val, 0, $past_temp1_oroshi_manthly_data);
                                                                }
                                                                if(strpos($past_temp1_oroshi_manthly_data2, $val ) !== false){
                                                                    $past_temp1_oroshi_manthly_data2 = str_replace($val, 0, $past_temp1_oroshi_manthly_data2);
                                                                }
                                                                if(strpos($past_temp1_oroshi_manthly_data3, $val ) !== false){
                                                                    $past_temp1_oroshi_manthly_data3 = str_replace($val, 0, $past_temp1_oroshi_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $past_temp1_oroshi_manthly_array = explode(',',$past_temp1_oroshi_manthly_data);
                                                        $past_temp1_oroshi_manthly_array2 = explode(',',$past_temp1_oroshi_manthly_data2);
                                                        $past_temp1_oroshi_manthly_array3 = explode(',',$past_temp1_oroshi_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        foreach($past_temp1_oroshi_manthly_array as $val){
                                                            // 【進捗率の取得】最終月の「過去・卸・売上」を取得
                                                                //$past_oroshi_last_uriage = $val;
                                                            
                                                            if($val == ""){
                                                                // 表示用
                                                                    $past_temp1_oroshi_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                                // JSグラフ用
                                                                    $past_js_oroshi_uriage  .= "0, ";
                                                            } else {
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $past_temp1_oroshi_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                                // JSグラフ用
                                                                    $past_js_oroshi_uriage  .= $val . ", ";
                                                            }

                                                        }
                                                        foreach($past_temp1_oroshi_manthly_array2 as $val){
                                                            // 【進捗率の取得】最終月の「過去・卸・点数」を取得
                                                                //$past_oroshi_last_number = $val;

                                                            if($val == ""){
                                                                // 表示用
                                                                    $past_temp1_oroshi_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                                // JSグラフ用
                                                                    $past_js_oroshi_number  .= "0, ";
                                                            } else {
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $past_temp1_oroshi_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                                // JSグラフ用
                                                                    $past_js_oroshi_number  .= $val . ", ";
                                                            }

                                                        }
                                                        foreach($past_temp1_oroshi_manthly_array3 as $val){
                                                            // 【進捗率の取得】最終月の「過去・卸・粗利」を取得
                                                                //$past_oroshi_last_arari = $val;
                                                            
                                                            if($val == ""){
                                                                // 表示用
                                                                    $past_temp1_oroshi_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                                // JSグラフ用
                                                                    $past_js_oroshi_arari  .= "0, ";
                                                            } else {
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $past_temp1_oroshi_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                                // JSグラフ用
                                                                    $past_js_oroshi_arari  .= $val . ", ";
                                                            }

                                                        }
                                                    // 全体HTMLの作成
                                                        if(isset($past_temp1_oroshi_manthly_html) && isset($past_temp1_oroshi_sum)){
                                                            $past_temp1_oroshi_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>卸</div>" . $past_temp1_oroshi_manthly_html . $past_temp1_oroshi_sum;
                                                        }
                                                        if(isset($past_temp1_oroshi_manthly_html2) && isset($past_temp1_oroshi_sum2)){
                                                            $past_temp1_oroshi_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>卸</div>" . $past_temp1_oroshi_manthly_html2 . $past_temp1_oroshi_sum2;
                                                        }
                                                        if(isset($past_temp1_oroshi_manthly_html3) && isset($past_temp1_oroshi_sum3)){
                                                            $past_temp1_oroshi_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>卸</div>" . $past_temp1_oroshi_manthly_html3 . $past_temp1_oroshi_sum3;
                                                        }
                                                }

                                        // 各月の全部門売上合計のJS表示用
                                                $js_past_all_month_uriage = "";
                                                $js_past_all_month_number = "";
                                                $js_past_all_month_arari = "";
                                                $i = 0;
                                                foreach($manth_past_array as $val){
                                                    $all_js = 0;
                                                    $all_js2 = 0;
                                                    $all_js3 = 0;
                                                    if($out1_a == "ON"){ $all_js = (int)$all_js + (int)$past_temp1_shop_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$past_temp1_shop_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$past_temp1_shop_manthly_array3[$i];}
                                                    if($out1_b == "ON"){ $all_js = (int)$all_js + (int)$past_temp1_web_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$past_temp1_web_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$past_temp1_web_manthly_array3[$i];}
                                                    if($out1_c == "ON"){ $all_js = (int)$all_js + (int)$past_temp1_oroshi_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$past_temp1_oroshi_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$past_temp1_oroshi_manthly_array3[$i];}

                                                    $js_past_all_month_uriage .= $all_js . ", ";
                                                    $js_past_all_month_number .= $all_js2 . ", ";
                                                    $js_past_all_month_arari .= $all_js3 . ", ";
                                                    
                                                    $i++;
                                                }
        



// 過去・通販・粗利率

    $i = 0;
    $past_web_ratio = "";
    $past_web_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>粗利率(通販)</div>";
    $past_web_total = "";
    $past_web_total_js = "";
    $all_total = "";
    $past_web_total_ratio = "";
    foreach($past_temp1_web_manthly_array3 as $var){
        if($var == 0){
            $past_web_ratio = "---";
            $past_web_total = $past_web_total;
            if($past_temp1_web_manthly_array[$i] == 0){
                $all_total = $all_total;
            } else {
                $all_total = (int)$all_total + (int)$past_temp1_web_manthly_array[$i];
            }
        } else {
            if($past_temp1_web_manthly_array[$i] <> 0 && $var <> 0 && $past_temp1_web_manthly_array[$i] <> "" && $var <> ""){
                $past_web_ratio = (floor(((float)$var / (float)$past_temp1_web_manthly_array[$i]) * 100 * 10)) / 10;
            } else {
                $past_web_ratio = "---";
            }
            $past_web_total = (int)$past_web_total + (int)$var;
            if($past_temp1_web_manthly_array[$i] == 0){
                $all_total = $all_total;
            } else {
                $all_total = (int)$all_total + (int)$past_temp1_web_manthly_array[$i];
            }
        }
        ${"past_web_ratio_" .$i} = "";
        ${"past_web_ratio_" .$i} = $past_web_ratio;

        $past_web_total_js  .= (float)$past_web_ratio . ", ";
        if($past_web_ratio <> "" && $past_web_ratio <> 0){$past_web_ratio = number_format((float)$past_web_ratio ,1);}
        $past_web_sum_arari_per .= "<div class='title6 ta_r'>" . $past_web_ratio . "%</div>";

        $i++;
    }
    // 通販用粗利率を取得
        if($past_web_total <> 0 && $all_total <> 0 && $past_web_total <> "" && $all_total <> ""){
            $past_web_total_ratio = number_format((floor(((int)$past_web_total / (int)$all_total) * 100 * 10)) / 10 ,1);
        } else {
            $past_web_total_ratio = "---";
        }

        $past_web_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_web_total_ratio . "%</div></div>";

// 過去・店舗・粗利率

    $i = 0;
    $past_shop_ratio = "";
    $past_shop_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>粗利率(店舗)</div>";
    $past_shop_total = "";
    $past_shop_total_js = "";
    $past_all_total = "";
    $past_shop_total_ratio = "";
    foreach($past_temp1_shop_manthly_array3 as $var){
        if($var == 0){
            $past_shop_ratio = "---";
            $past_shop_total = $past_shop_total;
            if($past_temp1_shop_manthly_array[$i] == 0){
                $past_all_total = $past_all_total;
            } else {
                $past_all_total = (int)$past_all_total + (int)$past_temp1_shop_manthly_array[$i];
            }
        } else {
            if($var <> 0 && $past_temp1_shop_manthly_array[$i] <> 0 && $var <> "" && $past_temp1_shop_manthly_array[$i] <> ""){
                $past_shop_ratio = (floor(((float)$var / (float)$past_temp1_shop_manthly_array[$i]) * 100 * 10)) / 10;
            } else {
                $past_shop_ratio = "---";
            }
            $past_shop_total = (int)$past_shop_total + (int)$var;
            if($past_temp1_shop_manthly_array[$i] == 0){
                $past_all_total = $past_all_total;
            } else {
                $past_all_total = (int)$past_all_total + (int)$past_temp1_shop_manthly_array[$i];
            }
        }
        ${"past_shop_ratio_" .$i} = "";
        ${"past_shop_ratio_" .$i} = $past_shop_ratio;
        
        $past_shop_total_js  .= (float)$past_shop_ratio . ", ";
        $past_shop_sum_arari_per .= "<div class='title6 ta_r'>" . $past_shop_ratio . "%</div>";

        $i++;
    }
    // 過去・店舗用粗利率を取得
        if($past_shop_total <> 0 && $past_all_total <> 0 && $past_shop_total <> "" && $past_all_total <> ""){
            $past_shop_total_ratio = number_format((floor(((float)$past_shop_total / (float)$past_all_total) * 100 * 10)) / 10 ,1);
        } else {
            $past_shop_total_ratio = "---";
        }

        $past_shop_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_shop_total_ratio . "%</div></div>";


// 過去・卸・粗利率
    $past_oroshi_total_js = "";

    if($out1_c == "ON"){

		    $i = 0;
		    $past_oroshi_ratio = "";
		    $past_oroshi_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>粗利率(卸)</div>";
		    $past_oroshi_total = "";
		    $past_all_total = "";
		    $past_oroshi_total_ratio = "";
		    foreach($past_temp1_oroshi_manthly_array3 as $var){
		        if($var == 0){
		            $past_oroshi_ratio = "---";
		            $past_oroshi_total = $past_oroshi_total;
		            if($past_temp1_oroshi_manthly_array[$i] == 0){
		                $past_all_total = $past_all_total;
		            } else {
		                $past_all_total = (int)$past_all_total + (int)$past_temp1_oroshi_manthly_array[$i];
		            }
		        } else {
                    if($var <> 0 && $past_temp1_oroshi_manthly_array[$i] <> 0 && $var <> "" && $past_temp1_oroshi_manthly_array[$i] <> ""){
		                $past_oroshi_ratio = number_format((floor(((float)$var / (float)$past_temp1_oroshi_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                    } else {
		                $past_oroshi_ratio = "---";
                    }
		            $past_oroshi_total = (int)$past_oroshi_total + (int)$var;
		            if($past_temp1_oroshi_manthly_array[$i] == 0){
		                $past_all_total = $past_all_total;
		            } else {
		                $past_all_total = (int)$past_all_total + (int)$past_temp1_oroshi_manthly_array[$i];
		            }
		        }
                ${"past_oroshi_ratio_" .$i} = "";
                ${"past_oroshi_ratio_" .$i} = $past_oroshi_ratio;
                        
                $past_oroshi_total_js  .= (float)$past_oroshi_ratio . ", ";
		        $past_oroshi_sum_arari_per .= "<div class='title6 ta_r'>" . $past_oroshi_ratio . "%</div>";

		        $i++;
		    }
		    // 過去・店舗用粗利率を取得
                if($past_oroshi_total == 0 || $past_oroshi_total == "" || $past_all_total == 0 || $past_all_total == ""){
		            $past_oroshi_total_ratio = "---";
                } else {
		            $past_oroshi_total_ratio = number_format((floor(((int)$past_oroshi_total / (int)$past_all_total) * 100 * 10)) / 10 ,1);
                }

		        $past_oroshi_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_oroshi_total_ratio . "%</div></div>";
    }







                                        // 各月の全部門売上合計の先頭（1列目）部分のタイトルHTML
                                            $past_all_sum_uriage = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $past_all_sum_number = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $past_all_sum_arari = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $past_all_sum_arari_per = "<div class='wid100 ul3'><div class='title5 ta_c'>粗利率(合計)</div>";

                                        // 各月の全部門売上合計を配列に代入
                                            $past_temp1_all_m_sum_uriage_array = array();
                                            $past_temp1_all_m_sum_number_array = array();
                                            $past_temp1_all_m_sum_arari_array = array();
                                            $i = 0;
                                            foreach($manth_past_array as $val){
                                                $all = "";
                                                $all2 = "";
                                                $all3 = "";
                                                if($out1_a == "ON"){ $all = (int)$all + (int)$past_temp1_shop_manthly_array[$i]; $all2 = (int)$all2 + (int)$past_temp1_shop_manthly_array2[$i]; $all3 = (int)$all3 + (int)$past_temp1_shop_manthly_array3[$i];}
                                                if($out1_b == "ON"){ $all = (int)$all + (int)$past_temp1_web_manthly_array[$i]; $all2 = (int)$all2 + (int)$past_temp1_web_manthly_array2[$i]; $all3 = (int)$all3 + (int)$past_temp1_web_manthly_array3[$i];}
                                                if($out1_c == "ON"){ $all = (int)$all + (int)$past_temp1_oroshi_manthly_array[$i]; $all2 = (int)$all2 + (int)$past_temp1_oroshi_manthly_array2[$i]; $all3 = (int)$all3 + (int)$past_temp1_oroshi_manthly_array3[$i];}
                                                array_push($past_temp1_all_m_sum_uriage_array,$all);
                                                array_push($past_temp1_all_m_sum_number_array,$all2);
                                                array_push($past_temp1_all_m_sum_arari_array,$all3);

                                                $i++;
                                            }
                                        // 各月の全部門売上合計部分のHTML作成
                                            foreach($past_temp1_all_m_sum_uriage_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $past_all_sum_uriage .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $past_all_sum_uriage .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                            }
                                        // 各月の全部門売上点数合計部分のHTML作成
                                            foreach($past_temp1_all_m_sum_number_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $past_all_sum_number .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $past_all_sum_number .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                            }
                                        // 各月の全部門粗利合計部分のHTML作成
                                            $i = 0;
                                            $past_arari_ratio = "";
                                            $past_all_arari_total = "";
                                            foreach($past_temp1_all_m_sum_arari_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $past_all_sum_arari .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $past_all_sum_arari .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                                // 各月の粗利率を取得
                                                    if($past_temp1_all_m_sum_uriage_array[$i] == 0){
                                                        $past_arari_ratio = "---";
                                                    } else {
                                                        $past_arari_ratio = number_format((floor(((int)$var / (int)$past_temp1_all_m_sum_uriage_array[$i]) * 100 * 10)) / 10 ,1);
                                                    }
                                                    // 過去・粗利・縦軸合計
                                                        $past_all_sum_arari_per .= "<div class='title6 ta_r'>" . $past_arari_ratio . "%</div>";
                                                    // 過去・通販・店舗・卸・合計粗利率（JSグラフ用） 
                                                        $past_all_arari_total .= (float)$past_arari_ratio . ", ";
                                                    // 過去・現在の粗利率合計差の計算に使用
                                                        ${"past_arari_ratio_" . $i} = $past_arari_ratio;
                                                        
                                                $i++;
                                            }



                                                  
                                        // 全期間全部門売上合計とその平均値のHTML作成
                                            if($past_all_sum_uriage_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更
                                                    //$past_all_average = floor((int)$past_all_sum_uriage_all / $past_i);
                                                    if($out1_c == "ON"){
                                                        $past_all_average = (int)$past_web_sum_uriage_ave2 + (int)$past_shop_sum_uriage_ave2 + (int)$past_oroshi_sum_uriage_ave2;
                                                    } else {
                                                        $past_all_average = (int)$past_web_sum_uriage_ave2 + (int)$past_shop_sum_uriage_ave2;
                                                    }
                                            } else {
                                                $past_all_average = 0;
                                            }
                                            $past_all_sum_uriage .= "<div class='title6 ta_r'>" . number_format((int)$past_all_sum_uriage_all) . "</div><div class='title6 ta_r'>" . number_format((int)$past_all_average) . "</div></div>";
                                        // 全HTMLを合体（検索対象外は除く）
                                            $view = "";
                                            if($out1_a == "ON"){ $view .= $past_temp1_shop_manthly_html;}
                                            if($out1_b == "ON"){ $view .= $past_temp1_web_manthly_html;}
                                            if($out1_c == "ON"){ $view .= $past_temp1_oroshi_manthly_html;}
                                            if($out4_a == "ON" && $out4_b <> "ON"){ $view_title1 = "（免税以外）";} else if($out4_a <> "ON" && $out4_b == "ON"){$view_title1 = "（免税のみ）";} else {$view_title1 = "";}
                                            $past_temp1_all_sorce = "<p class='title_a'>金額（過去）" . $view_title1 . "</p><div class='box1'>" . $past_temp1_title . $view . $past_all_sum_uriage . "</div>";

                                        // 全期間全部門売上点数合計とその平均値のHTML作成
                                            if($past_all_sum_number_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更
                                                    //$past_all_average2 = floor((int)$past_all_sum_number_all / $past_i);
                                                    if($out1_c == "ON"){
                                                        $past_all_average2 = (int)$past_web_sum_number_ave2 + (int)$past_shop_sum_number_ave2 + (int)$past_oroshi_sum_number_ave2;
                                                    } else {
                                                        $past_all_average2 = (int)$past_web_sum_number_ave2 + (int)$past_shop_sum_number_ave2;
                                                    }
                                            } else {
                                                $past_all_average2 = 0;
                                            }
                                            $past_all_sum_number .= "<div class='title6 ta_r'>" . number_format((int)$past_all_sum_number_all) . "</div><div class='title6 ta_r'>" . number_format((int)$past_all_average2) . "</div></div>";
                                        // 全HTMLを合体（検索対象外は除く）
                                            $view2 = "";
                                            if($out1_a == "ON"){ $view2 .= $past_temp1_shop_manthly_html2;}
                                            if($out1_b == "ON"){ $view2 .= $past_temp1_web_manthly_html2;}
                                            if($out1_c == "ON"){ $view2 .= $past_temp1_oroshi_manthly_html2;}
                                            $past_temp1_all_sorce2 = "<p class='title_a'>点数（過去）" . $view_title1 . "</p><div class='box1'>" . $past_temp1_title . $view2 . $past_all_sum_number . "</div>";

                                        // 全期間全部門粗利合計とその平均値のHTML作成
                                            if($past_all_sum_arari_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更
                                                    //$past_all_average3 = floor((int)$past_all_sum_arari_all / $past_i);
                                                    if($out1_c == "ON"){
                                                        $past_all_average3 = (int)$past_web_sum_arari_ave2 + (int)$past_shop_sum_arari_ave2 + (int)$past_oroshi_sum_arari_ave2;
                                                    } else {
                                                        $past_all_average3 = (int)$past_web_sum_arari_ave2 + (int)$past_shop_sum_arari_ave2;
                                                    }
                                            } else {
                                                $past_all_average3 = 0;
                                            }
                                            $past_all_sum_arari .= "<div class='title6 ta_r'>" . number_format((int)$past_all_sum_arari_all) . "</div><div class='title6 ta_r'>" . number_format((int)$past_all_average3) . "</div></div>";
                                            // 粗利率の平均
                                                if($past_all_sum_arari_all <> 0){ $past_all_average4 = number_format(floor(((int)$past_all_sum_arari_all / (int)$past_all_sum_uriage_all) * 100 * 10) / 10 ,1);} else {$past_all_average4 = 0;}
                                                $past_all_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_all_average4 . "%</div></div>";
                                        
                                        // 全HTMLを合体（検索対象外は除く）
                                            $view3 = "";
                                            if($out1_a == "ON"){ $view3 .= $past_temp1_shop_manthly_html3;}
                                            if($out1_b == "ON"){ $view3 .= $past_temp1_web_manthly_html3;}
                                            if($out1_c == "ON"){ $view3 .= $past_temp1_oroshi_manthly_html3;}
                                            $past_temp1_all_sorce3 = "<p class='title_a'>粗利（過去）" . $view_title1 . "</p><div class='box1'>" . $past_temp1_title . $view3 . $past_all_sum_arari . $past_shop_sum_arari_per . $past_web_sum_arari_per;
                                            if($out1_c == "ON"){$past_temp1_all_sorce3 .= $past_oroshi_sum_arari_per;}
                                            $past_temp1_all_sorce3 .= $past_all_sum_arari_per  . "</div>";
                    
                    
                    /************************************************************************************************************************************************************************************************************* */
                        // DB情報の受け取り（過去の期間）end
                    /************************************************************************************************************************************************************************************************************* */





                    /************************************************************************************************************************************************************************************************************* */
                        // DB情報の受け取り（検索期間）start
                    /************************************************************************************************************************************************************************************************************* */
                            $temp1_title2 = "";
                            $i = 0;

                            /************************************************************************************************************************************************************************************************************* */
                                // 通販用
                            /************************************************************************************************************************************************************************************************************* */
                                    if($out1_b == "ON"){
                                            // DB検索（通販値）スタート
                                                $web_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS web_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS web_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS web_number"),
                                                        \DB::raw("SUM(ararikingaku) AS web_arari"),
                                                    ])
                                                    ->groupBy('web_month')
                                                // 条件（売上部門が通販）
                                                    ->where('baikyakukubun',2)
                                                // 条件（期間の指定）
                                                    ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                // 条件（分類名）
                                                    ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
															// 条件（商品区分分類名が新品）
																if($out2_a == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%新品%");
																}
															// 条件（商品区分分類名が中古）
																if($out2_b == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%中古%");
																}
															// 条件（商品区分分類名がアンティーク）
																if($out2_c == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
																}
															// 条件（商品区分分類名がその他）
																if($out2_d == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%その他%");
																}
															// 条件（商品区分分類名が修理）
																if($out2_e == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%修理%");
																}
                                                    
                                                    })
                                                // 条件（通販区分）
                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                            $query->orWhere('tsuuhankubun','');

															// 条件（通販区分が自社）
																if($out3_a == "ON"){
																	$query->orWhere('tsuuhankubun',1);
																}
															// 条件（通販区分が楽天）
																if($out3_b == "ON"){
																	$query->orWhere('tsuuhankubun',2);
																}
															// 条件（通販区分がヤフー）
																if($out3_c == "ON"){
																	$query->orWhere('tsuuhankubun',3);
																}
															// 条件（通販区分が電話・雑誌）
																if($out3_d == "ON"){
																	$query->orWhere('tsuuhankubun',5);
																}
															// 条件（通販区分がYオークション）
																if($out3_e == "ON"){
																	$query->orWhere('tsuuhankubun',4);
																}
															// 条件（通販区分が修理品返送）
																if($out3_f == "ON"){
																	$query->orWhere('tsuuhankubun',9);
																}
                                                    
                                                    })
                                                
                                                // 条件（免税）
                                                    ->where(function ($query) use ($out4_a,$out4_b) {
															// 条件（免税区分が0:対象外）
																if($out4_a == "ON"){
																	$query->orwhere("menzei","like","%対象外%");
																}
															// 条件（免税区分が1:免税）
																if($out4_b == "ON"){
																	$query->orwhere("menzei","like","%免税%");
																}
                                                    })
                                                // 条件（扱い部門）
                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                            $query->orWhere('bumonmei','');

															// 条件（扱い部門がジャック）
																if($out5_a == "ON"){
																	$query->orWhere('bumonmei','Jackroad');
																}
															// 条件（扱い部門がベティー）
																if($out5_b == "ON"){
																	$query->orWhere('bumonmei','BettyRoad');
																}
															// 条件（扱い部門がジュエリー）
																if($out5_c == "ON"){
																	$query->orWhere('bumonmei','Jewelry');
																}
                                                  
                                                    })
                                                    
                                                // 条件（期間の指定）
                                                    ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                // ソート順指定
                                                    ->orderBy('uriage', 'asc')
                                                    ->get();

                                            // クエリビルダスタート
                                                $i = 0;
                                                // 変数リセット
                                                    $web_sum_uriage = "";
                                                    $web_sum_number = "";
                                                    $web_sum_arari = "";
                                                foreach ($web_buys as $web_buy) {
                                                    // 各月名
                                                        $web_month[$i]= $web_buy->web_month;
                                                    // 各月通販売上
                                                        $web_uriage[$i]= $web_buy->web_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp1_web_manthly_data, $web_month[$i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp1_web_manthly_data = str_replace($web_month[$i], $web_uriage[$i], $temp1_web_manthly_data);
                                                                }
                                                    // 全期間通販売上合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $web_sum_uriage_average = (int)$web_sum_uriage;
                                                            } else {
                                                                $web_sum_uriage_average = (int)$web_sum_uriage + (int)$web_uriage[$i];
                                                            }

                                                        $web_sum_uriage = (int)$web_sum_uriage + (int)$web_uriage[$i];
                                                    // 各月通販点数
                                                        $web_number[$i]= $web_buy->web_number;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp1_web_manthly_data2, $web_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp1_web_manthly_data2 = str_replace($web_month[$i], $web_number[$i], $temp1_web_manthly_data2);
                                                            }

                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $web_sum_number_average = (int)$web_sum_number;
                                                            } else {
                                                                $web_sum_number_average = (int)$web_sum_number + (int)$web_number[$i];
                                                            }
                                                        $web_sum_number = (int)$web_sum_number + (int)$web_number[$i];

                                                    // 各月通販粗利
                                                        $web_arari[$i]= $web_buy->web_arari;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp1_web_manthly_data3, $web_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp1_web_manthly_data3 = str_replace($web_month[$i], $web_arari[$i], $temp1_web_manthly_data3);
                                                            }
                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $web_sum_arari_average = (int)$web_sum_arari;
                                                            } else {
                                                                $web_sum_arari_average = (int)$web_sum_arari + (int)$web_arari[$i];
                                                            }
                                                        $web_sum_arari = (int)$web_sum_arari + (int)$web_arari[$i];

                                                    $i++;
                                                }

                                                // 全期間通販売上合計とその平均値のHTML作成
                                                    $temp1_web_sum = "";
                                                    if($web_sum_uriage <> 0 && $web_sum_uriage <> ""){
                                                        $web_sum_uriage_c = number_format((int)$web_sum_uriage);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象                                                        
                                                        //$web_sum_uriage_ave = number_format(floor((int)$web_sum_uriage/ $i));
                                                        //$web_sum_uriage_ave2 = floor((int)$web_sum_uriage/ $i);
                                                        if($last_nodata_flag == "ON"){
                                                            if($web_sum_uriage_average <> "" && $web_sum_uriage_average <> 0){$web_sum_uriage_ave = number_format(floor((int)$web_sum_uriage_average / ((int)$i -1)));} else {$web_sum_uriage_ave = "---";}
                                                            if($web_sum_uriage_average <> "" && $web_sum_uriage_average <> 0){$web_sum_uriage_ave2 = floor((int)$web_sum_uriage_average / ((int)$i -1));} else {$web_sum_uriage_ave2 = "---";}
                                                        } else {
                                                            $web_sum_uriage_ave = number_format(floor((int)$web_sum_uriage / $i));
                                                            $web_sum_uriage_ave2 = floor((int)$web_sum_uriage / $i);
                                                        }
                                                    } else {
                                                        $web_sum_uriage_c = $web_sum_uriage;
                                                        $web_sum_uriage_ave = 0;
                                                        $web_sum_uriage_ave2 = 0;
                                                    }
                                                    //$temp1_web_sum = "<div class='title4 ta_r'>" . $web_sum_uriage_c . "</div><div class='title4 ta_c'>" . $yoy_uriage . "</div><div class='title4 ta_r'>" . $web_sum_uriage_ave . "</div></div>";
                                                    $temp1_web_sum = "<div class='title4 ta_r'>" . $web_sum_uriage_c . "</div><div class='title4 ta_r'>" . $web_sum_uriage_ave . "</div></div>";
                                                // 全期間通販売上点数合計とその平均値のHTML作成
                                                    $temp1_web_sum2 = "";
                                                    if($web_sum_number <> 0 && $web_sum_number <> ""){
                                                        $web_sum_number_c = number_format((int)$web_sum_number);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        //$web_sum_number_ave = number_format(floor((int)$web_sum_number/ $i));
                                                        //$web_sum_number_ave2 = floor((int)$web_sum_number/ $i);
                                                        if($last_nodata_flag == "ON"){
                                                            if($web_sum_number_average <> "" && $web_sum_number_average <> 0){$web_sum_number_ave = number_format(floor((int)$web_sum_number_average / ((int)$i -1)));} else {$web_sum_number_ave = "---";}
                                                            if($web_sum_number_average <> "" && $web_sum_number_average <> 0){$web_sum_number_ave2 = floor((int)$web_sum_number_average / ((int)$i -1));} else {$web_sum_number_ave2 = "---";}
                                                        } else {
                                                            $web_sum_number_ave = number_format(floor((int)$web_sum_number / $i));
                                                            $web_sum_number_ave2 = floor((int)$web_sum_number / $i);
                                                        }
                                                    } else {
                                                        $web_sum_number_c = $web_sum_number;
                                                        $web_sum_number_ave = 0;
                                                        $web_sum_number_ave2 = 0;
                                                    }
                                                    //$temp1_web_sum2 = "<div class='title4 ta_r'>" . $web_sum_number_c . "</div><div class='title4 ta_c'>" . $yoy_number . "</div><div class='title4 ta_r'>" . $web_sum_number_ave . "</div></div>";
                                                    $temp1_web_sum2 = "<div class='title4 ta_r'>" . $web_sum_number_c . "</div><div class='title4 ta_r'>" . $web_sum_number_ave . "</div></div>";
                                                // 全期間通販粗利合計とその平均値のHTML作成
                                                    $temp1_web_sum3 = "";
                                                    if($web_sum_arari <> 0 && $web_sum_arari <> ""){
                                                        $web_sum_arari_c = number_format((int)$web_sum_arari);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        //$web_sum_arari_ave = number_format(floor((int)$web_sum_arari/ $i));
                                                        //$web_sum_arari_ave2 = floor((int)$web_sum_arari/ $i);
                                                        if($last_nodata_flag == "ON"){
                                                            if($web_sum_arari_average <> "" && $web_sum_arari_average <> 0){$web_sum_arari_ave = number_format(floor((int)$web_sum_arari_average / ((int)$i -1)));} else {$web_sum_arari_ave = "---";}
                                                            if($web_sum_arari_average <> "" && $web_sum_arari_average <> 0){$web_sum_arari_ave2 = floor((int)$web_sum_arari_average / ((int)$i -1));} else {$web_sum_arari_ave2 = "---";}
                                                        } else {
                                                            $web_sum_arari_ave = number_format(floor((int)$web_sum_arari / $i));
                                                            $web_sum_arari_ave2 = floor((int)$web_sum_arari / $i);
                                                        }
                                                    } else {
                                                        $web_sum_arari_c = $web_sum_arari;
                                                        $web_sum_arari_ave = 0;
                                                        $web_sum_arari_ave2 = 0;
                                                    }
                                                    //$temp1_web_sum3 = "<div class='title4 ta_r'>" . $web_sum_arari_c . "</div><div class='title4 ta_c'>" . $yoy_arari . "</div><div class='title4 ta_r'>" . $web_sum_arari_ave . "</div></div>";
                                                    $temp1_web_sum3 = "<div class='title4 ta_r'>" . $web_sum_arari_c . "</div><div class='title4 ta_r'>" . $web_sum_arari_ave . "</div></div>";
                                        }



                            /************************************************************************************************************************************************************************************************************* */
                                // 店舗用
                            /************************************************************************************************************************************************************************************************************* */
                                    if($out1_a == "ON"){
                                            // DB検索（店舗値）スタート
                                                $shop_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS shop_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS shop_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS shop_number"),
                                                        \DB::raw("SUM(ararikingaku) AS shop_arari"),
                                                    ])
                                                    ->groupBy('shop_month')
                                                // 条件（売上部門が店舗）
                                                    ->where('baikyakukubun',1)
                                                // 条件（期間の指定）
                                                    ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                // 条件（分類名）
                                                    ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
															// 条件（商品区分分類名が新品）
																if($out2_a == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%新品%");
																}
															// 条件（商品区分分類名が中古）
																if($out2_b == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%中古%");
																}
															// 条件（商品区分分類名がアンティーク）
																if($out2_c == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
																}
															// 条件（商品区分分類名がその他）
																if($out2_d == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%その他%");
																}
															// 条件（商品区分分類名が修理）
																if($out2_e == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%修理%");
																}
                                                    
                                                    })
                                                // 条件（通販区分）
                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                            $query->orWhere('tsuuhankubun','');

															// 条件（通販区分が自社）
																if($out3_a == "ON"){
																	$query->orWhere('tsuuhankubun',1);
																}
															// 条件（通販区分が楽天）
																if($out3_b == "ON"){
																	$query->orWhere('tsuuhankubun',2);
																}
															// 条件（通販区分がヤフー）
																if($out3_c == "ON"){
																	$query->orWhere('tsuuhankubun',3);
																}
															// 条件（通販区分が電話・雑誌）
																if($out3_d == "ON"){
																	$query->orWhere('tsuuhankubun',5);
																}
															// 条件（通販区分がYオークション）
																if($out3_e == "ON"){
																	$query->orWhere('tsuuhankubun',4);
																}
															// 条件（通販区分が修理品返送）
																if($out3_f == "ON"){
																	$query->orWhere('tsuuhankubun',9);
																}
                                                    
                                                    })
                                                
                                                // 条件（免税）
                                                    ->where(function ($query) use ($out4_a,$out4_b) {
															// 条件（免税区分が0:対象外）
																if($out4_a == "ON"){
																	$query->orwhere("menzei","like","%対象外%");
																}
															// 条件（免税区分が1:免税）
																if($out4_b == "ON"){
																	$query->orwhere("menzei","like","%免税%");
																}
                                                    })
                                                // 条件（扱い部門）
                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                            $query->orWhere('bumonmei','');

															// 条件（扱い部門がジャック）
																if($out5_a == "ON"){
																	$query->orWhere('bumonmei','Jackroad');
																}
															// 条件（扱い部門がベティー）
																if($out5_b == "ON"){
																	$query->orWhere('bumonmei','BettyRoad');
																}
															// 条件（扱い部門がジュエリー）
																if($out5_c == "ON"){
																	$query->orWhere('bumonmei','Jewelry');
																}
                                                  
                                                    })
                                                    
                                                // ソート順指定
                                                    ->orderBy('uriage', 'asc')
                                                    ->get();

                                            // クエリビルダスタート
                                                $i = 0;
                                                // 変数リセット
                                                    $shop_sum_uriage = "";
                                                    $shop_sum_number = "";
                                                    $shop_sum_arari = "";
                                                    foreach ($shop_buys as $shop_buy) {
                                                        // 各月名
                                                            $shop_month[$i]= $shop_buy->shop_month;
                                                        // 各月店舗売上
                                                            $shop_uriage[$i]= $shop_buy->shop_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp1_shop_manthly_data, $shop_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp1_shop_manthly_data = str_replace($shop_month[$i], $shop_uriage[$i], $temp1_shop_manthly_data);
                                                            }
                                                        // 全期間店舗売上合計
                                                            // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                                if($last_nodata_flag == "ON"){
                                                                    $shop_sum_uriage_average = (int)$shop_sum_uriage;
                                                                } else {
                                                                    $shop_sum_uriage_average = (int)$shop_sum_uriage + (int)$shop_uriage[$i];
                                                                }
                                                            $shop_sum_uriage = (int)$shop_sum_uriage + (int)$shop_uriage[$i];
                                                        // 各月店舗点数
                                                            $shop_number[$i]= $shop_buy->shop_number;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp1_shop_manthly_data2, $shop_month[$i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp1_shop_manthly_data2 = str_replace($shop_month[$i], $shop_number[$i], $temp1_shop_manthly_data2);
                                                                }
                                                        // 全期間店舗点数合計
                                                            // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                                if($last_nodata_flag == "ON"){
                                                                    $shop_sum_number_average = (int)$shop_sum_number;
                                                                } else {
                                                                    $shop_sum_number_average = (int)$shop_sum_number + (int)$shop_number[$i];
                                                                }
                                                            $shop_sum_number = (int)$shop_sum_number + (int)$shop_number[$i];
                                                            
                                                        // 各月店舗粗利
                                                            $shop_arari[$i]= $shop_buy->shop_arari;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp1_shop_manthly_data3, $shop_month[$i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp1_shop_manthly_data3 = str_replace($shop_month[$i], $shop_arari[$i], $temp1_shop_manthly_data3);
                                                                }
                                                        // 全期間店舗点数合計
                                                            // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                                if($last_nodata_flag == "ON"){
                                                                    $shop_sum_arari_average = (int)$shop_sum_arari;
                                                                } else {
                                                                    $shop_sum_arari_average = (int)$shop_sum_arari + (int)$shop_arari[$i];
                                                                }
                                                            $shop_sum_arari = (int)$shop_sum_arari + (int)$shop_arari[$i];
                                                            
                                                        $i++;
                                                    }


                                                // 全期間店舗売上合計とその平均値のHTML作成
                                                    $temp1_shop_sum = "";
                                                    if($shop_sum_uriage <> 0 && $shop_sum_uriage <> ""){
                                                        $shop_sum_uriage_c = number_format((int)$shop_sum_uriage);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        //$shop_sum_uriage_ave = number_format(floor((int)$shop_sum_uriage/ $i));
                                                        //$shop_sum_uriage_ave2 = floor((int)$shop_sum_uriage/ $i);
                                                        if($last_nodata_flag == "ON"){
                                                            if($shop_sum_uriage_average <> "" && $shop_sum_uriage_average <> 0){$shop_sum_uriage_ave = number_format(floor((int)$shop_sum_uriage_average / ((int)$i -1)));} else {$shop_sum_uriage_ave = "---";}
                                                            if($shop_sum_uriage_average <> "" && $shop_sum_uriage_average <> 0){$shop_sum_uriage_ave2 = floor((int)$shop_sum_uriage_average / ((int)$i -1));} else {$shop_sum_uriage_ave2 = "---";}
                                                        } else {
                                                            $shop_sum_uriage_ave = number_format(floor((int)$shop_sum_uriage / $i));
                                                            $shop_sum_uriage_ave2 = floor((int)$shop_sum_uriage / $i);
                                                        }
                                                    } else {
                                                        $shop_sum_uriage_c = $shop_sum_uriage;
                                                        $shop_sum_uriage_ave = 0;
                                                        $shop_sum_uriage_ave2 = 0;
                                                    }
                                                    //$temp1_shop_sum = "<div class='title4 ta_r'>" . $shop_sum_uriage_c . "</div><div class='title4 ta_c'>" . $yoy_uriage2 . "</div><div class='title4 ta_r'>" . $shop_sum_uriage_ave . "</div></div>";
                                                    $temp1_shop_sum = "<div class='title4 ta_r'>" . $shop_sum_uriage_c . "</div><div class='title4 ta_r'>" . $shop_sum_uriage_ave . "</div></div>";
                                                // 全期間店舗売上点数合計とその平均値のHTML作成
                                                    $temp1_shop_sum2 = "";
                                                    if($shop_sum_number <> 0 && $shop_sum_number <> ""){
                                                        $shop_sum_number_c = number_format((int)$shop_sum_number);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        //$shop_sum_number_ave = number_format(floor((int)$shop_sum_number/ $i));
                                                        //$shop_sum_number_ave2 = floor((int)$shop_sum_number/ $i);
                                                        if($last_nodata_flag == "ON"){
                                                            if($shop_sum_number_average <> "" && $shop_sum_number_average <> 0){$shop_sum_number_ave = number_format(floor((int)$shop_sum_number_average / ((int)$i -1)));} else {$shop_sum_number_ave = "---";}
                                                            if($shop_sum_number_average <> "" && $shop_sum_number_average <> 0){$shop_sum_number_ave2 = floor((int)$shop_sum_number_average / ((int)$i -1));} else {$shop_sum_number_ave2 = "---";}
                                                        } else {
                                                            $shop_sum_number_ave = number_format(floor((int)$shop_sum_number / $i));
                                                            $shop_sum_number_ave2 = floor((int)$shop_sum_number / $i);
                                                        }
                                                    } else {
                                                        $shop_sum_number_c = $shop_sum_number;
                                                        $shop_sum_number_ave = 0;
                                                        $shop_sum_number_ave2 = 0;
                                                    }
                                                    //$temp1_shop_sum2 = "<div class='title4 ta_r'>" . $shop_sum_number_c . "</div><div class='title4 ta_c'>" . $yoy_number2 . "</div><div class='title4 ta_r'>" . $shop_sum_number_ave . "</div></div>";
                                                    $temp1_shop_sum2 = "<div class='title4 ta_r'>" . $shop_sum_number_c . "</div><div class='title4 ta_r'>" . $shop_sum_number_ave . "</div></div>";
                                                // 全期間店舗粗利合計とその平均値のHTML作成
                                                    $temp1_shop_sum3 = "";
                                                    if($shop_sum_arari <> 0 && $shop_sum_arari <> ""){
                                                        $shop_sum_arari_c = number_format((int)$shop_sum_arari);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        //$shop_sum_arari_ave = number_format(floor((int)$shop_sum_arari/ $i));
                                                        //$shop_sum_arari_ave2 = floor((int)$shop_sum_arari/ $i);
                                                        if($last_nodata_flag == "ON"){
                                                            if($shop_sum_arari_average <> "" && $shop_sum_arari_average <> 0){$shop_sum_arari_ave = number_format(floor((int)$shop_sum_arari_average / ((int)$i -1)));} else {$shop_sum_arari_ave = "---";}
                                                            if($shop_sum_arari_average <> "" && $shop_sum_arari_average <> 0){$shop_sum_arari_ave2 = floor((int)$shop_sum_arari_average / ((int)$i -1));} else {$shop_sum_arari_ave2 = "---";}
                                                        } else {
                                                            $shop_sum_arari_ave = number_format(floor((int)$shop_sum_arari / $i));
                                                            $shop_sum_arari_ave2 = floor((int)$shop_sum_arari / $i);
                                                        }
                                                    } else {
                                                        $shop_sum_arari_c = $shop_sum_arari;
                                                        $shop_sum_arari_ave = 0;
                                                        $shop_sum_arari_ave2 = 0;
                                                    }
                                                    //$temp1_shop_sum3 = "<div class='title4 ta_r'>" . $shop_sum_arari_c . "</div><div class='title4 ta_c'>" . $yoy_arari2 . "</div><div class='title4 ta_r'>" . $shop_sum_arari_ave . "</div></div>";
                                                    $temp1_shop_sum3 = "<div class='title4 ta_r'>" . $shop_sum_arari_c . "</div><div class='title4 ta_r'>" . $shop_sum_arari_ave . "</div></div>";
                                    }
                            /************************************************************************************************************************************************************************************************************* */
                                // 卸用
                            /************************************************************************************************************************************************************************************************************* */
                                    if($out1_c == "ON"){
                                            // DB検索（卸）スタート
                                                $oroshi_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS oroshi_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS oroshi_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS oroshi_number"),
                                                        \DB::raw("SUM(ararikingaku) AS oroshi_arari"),
                                                    ])
                                                    ->groupBy('oroshi_month')
                                                // 条件（売上部門が店舗）
                                                    //->where('baikyakukubun',3)
                                                    ->where(function ($query) use ($out1_d) {
															if($out1_d == "ON"){
                                                                // 「卸」と空白（おそらく入力間違い分）を含む場合を取得（条件：「店舗」「通販」以外）
	                                                                $query->Where([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2]]);
                                                            } else {
                                                                // 「卸」のみを取得
                                                                    $query->where('baikyakukubun',3);
                                                            }
                                                    })
                                                // 条件（期間の指定）
                                                    ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                // 条件（分類名）
                                                    ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
															// 条件（商品区分分類名が新品）
																if($out2_a == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%新品%");
																}
															// 条件（商品区分分類名が中古）
																if($out2_b == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%中古%");
																}
															// 条件（商品区分分類名がアンティーク）
																if($out2_c == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
																}
															// 条件（商品区分分類名がその他）
																if($out2_d == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%その他%");
																}
															// 条件（商品区分分類名が修理）
																if($out2_e == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%修理%");
																}
                                                    
                                                    })
                                                // 条件（通販区分）
                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                            $query->orWhere('tsuuhankubun','');

															// 条件（通販区分が自社）
																if($out3_a == "ON"){
																	$query->orWhere('tsuuhankubun',1);
																}
															// 条件（通販区分が楽天）
																if($out3_b == "ON"){
																	$query->orWhere('tsuuhankubun',2);
																}
															// 条件（通販区分がヤフー）
																if($out3_c == "ON"){
																	$query->orWhere('tsuuhankubun',3);
																}
															// 条件（通販区分が電話・雑誌）
																if($out3_d == "ON"){
																	$query->orWhere('tsuuhankubun',5);
																}
															// 条件（通販区分がYオークション）
																if($out3_e == "ON"){
																	$query->orWhere('tsuuhankubun',4);
																}
															// 条件（通販区分が修理品返送）
																if($out3_f == "ON"){
																	$query->orWhere('tsuuhankubun',9);
																}
                                                    
                                                    })
                                                
                                                // 条件（免税）
                                                    ->where(function ($query) use ($out4_a,$out4_b) {
															// 条件（免税区分が0:対象外）
																if($out4_a == "ON"){
																	$query->orwhere("menzei","like","%対象外%");
																}
															// 条件（免税区分が1:免税）
																if($out4_b == "ON"){
																	$query->orwhere("menzei","like","%免税%");
																}
                                                    })
                                                // 条件（扱い部門）
                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                            $query->orWhere('bumonmei','');

															// 条件（扱い部門がジャック）
																if($out5_a == "ON"){
																	$query->orWhere('bumonmei','Jackroad');
																}
															// 条件（扱い部門がベティー）
																if($out5_b == "ON"){
																	$query->orWhere('bumonmei','BettyRoad');
																}
															// 条件（扱い部門がジュエリー）
																if($out5_c == "ON"){
																	$query->orWhere('bumonmei','Jewelry');
																}
                                                  
                                                    })
                                                    
                                                // ソート順指定
                                                    ->orderBy('uriage', 'asc')
                                                    ->get();

                                            // クエリビルダスタート
                                                // 以下の変数は月数フラグとして後のロジックで使用するが、フォームにて「免税のみ」を選択した場合「卸」は全月一つも無いので、上でロジックが止まってしまい月数カウントの変数も0のままとなる。「卸」のみ独立した変数名として、カウント用は店舗用で対応
                                                $i2 = 0;
                                                // 変数リセット
                                                    $oroshi_sum_uriage = "";
                                                    $oroshi_sum_number = "";
                                                    $oroshi_sum_arari = "";
                                                    foreach ($oroshi_buys as $oroshi_buy) {
                                                        // 各月名
                                                            $oroshi_month[$i2]= $oroshi_buy->oroshi_month;
                                                        // 各月卸売上
                                                            $oroshi_uriage[$i2]= $oroshi_buy->oroshi_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp1_oroshi_manthly_data, $oroshi_month[$i2] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp1_oroshi_manthly_data = str_replace($oroshi_month[$i2], $oroshi_uriage[$i2], $temp1_oroshi_manthly_data);
                                                                }
                                                        // 全期間卸売上合計
                                                            // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                                if($last_nodata_flag == "ON"){
                                                                    $oroshi_sum_uriage_average = (int)$oroshi_sum_uriage;
                                                                } else {
                                                                    $oroshi_sum_uriage_average = (int)$oroshi_sum_uriage + (int)$oroshi_uriage[$i2];
                                                                }
                                                            $oroshi_sum_uriage = (int)$oroshi_sum_uriage + (int)$oroshi_uriage[$i2];
                                                        // 各月卸点数
                                                            $oroshi_number[$i2]= $oroshi_buy->oroshi_number;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp1_oroshi_manthly_data2, $oroshi_month[$i2] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp1_oroshi_manthly_data2 = str_replace($oroshi_month[$i2], $oroshi_number[$i2], $temp1_oroshi_manthly_data2);
                                                                }
                                                        // 全期間卸点数合計
                                                            // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                                if($last_nodata_flag == "ON"){
                                                                    $oroshi_sum_number_average = (int)$oroshi_sum_number;
                                                                } else {
                                                                    $oroshi_sum_number_average = (int)$oroshi_sum_number + (int)$oroshi_number[$i2];
                                                                }
                                                            $oroshi_sum_number = (int)$oroshi_sum_number + (int)$oroshi_number[$i2];

                                                        // 各月卸粗利
                                                            $oroshi_arari[$i2]= $oroshi_buy->oroshi_arari;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp1_oroshi_manthly_data3, $oroshi_month[$i2] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp1_oroshi_manthly_data3 = str_replace($oroshi_month[$i2], $oroshi_arari[$i2], $temp1_oroshi_manthly_data3);
                                                                }
                                                        // 全期間卸点数合計
                                                            // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                                if($last_nodata_flag == "ON"){
                                                                    $oroshi_sum_arari_average = (int)$oroshi_sum_arari;
                                                                } else {
                                                                    $oroshi_sum_arari_average = (int)$oroshi_sum_arari + (int)$oroshi_arari[$i2];
                                                                }
                                                            $oroshi_sum_arari = (int)$oroshi_sum_arari + (int)$oroshi_arari[$i2];



                                                        $i2++;
                                                    }


                                                // 全期間卸売上合計とその平均値のHTML作成
                                                    $temp1_oroshi_sum = "";
                                                    //$temp1_oroshi_sum = "<div class='title4 ta_r'>" . number_format((int)$oroshi_sum_uriage) . "</div><div class='title4 ta_c'>" . $yoy_uriage3 . "</div><div class='title4 ta_r'>" . number_format(floor((int)$oroshi_sum_uriage / $i)) . "</div></div>";
                                                    if($oroshi_sum_uriage == 0 || $oroshi_sum_uriage == ""){
                                                        $temp1_oroshi_sum = "<div class='title4 ta_r'>0</div><div class='title4 ta_r'>0</div></div>";
                                                        $oroshi_sum_uriage_ave = 0;
                                                        $oroshi_sum_uriage_ave2 = 0;
                                                    } else {
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        //$temp1_oroshi_sum = "<div class='title4 ta_r'>" . number_format((int)$oroshi_sum_uriage) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$oroshi_sum_uriage / $i)) . "</div></div>";
                                                        //$oroshi_sum_uriage_ave = number_format(floor((int)$oroshi_sum_uriage/ $i));                                                    
                                                        //$oroshi_sum_uriage_ave2 = floor((int)$oroshi_sum_uriage/ $i);  
                                                        if($last_nodata_flag == "ON"){
                                                            if($oroshi_sum_uriage_average <> "" && $oroshi_sum_uriage_average <> 0){$oroshi_sum_uriage_ave = number_format(floor((int)$oroshi_sum_uriage_average / ((int)$i -1)));} else {$oroshi_sum_uriage_ave = "---";}
                                                            if($oroshi_sum_uriage_average <> "" && $oroshi_sum_uriage_average <> 0){$oroshi_sum_uriage_ave2 = floor((int)$oroshi_sum_uriage_average / ((int)$i -1));} else {$oroshi_sum_uriage_ave2 = "---";}
                                                        } else {
                                                            $oroshi_sum_uriage_ave = number_format(floor((int)$oroshi_sum_uriage / $i));
                                                            $oroshi_sum_uriage_ave2 = floor((int)$oroshi_sum_uriage / $i);
                                                        }
                                                        $temp1_oroshi_sum = "<div class='title4 ta_r'>" . number_format((int)$oroshi_sum_uriage) . "</div><div class='title4 ta_r'>" . $oroshi_sum_uriage_ave . "</div></div>";
                                                    }
                                                // 全期間卸売上点数合計とその平均値のHTML作成
                                                    $temp1_oroshi_sum2 = "";
                                                    //$temp1_oroshi_sum2 = "<div class='title4 ta_r'>" . number_format((int)$oroshi_sum_number) . "</div><div class='title4 ta_c'>" . $yoy_number3 . "</div><div class='title4 ta_r'>" . number_format(floor((int)$oroshi_sum_number / $i)) . "</div></div>";
                                                    if($oroshi_sum_number == 0 || $oroshi_sum_number == ""){
                                                        $temp1_oroshi_sum2 = "<div class='title4 ta_r'>0</div><div class='title4 ta_r'>0</div></div>";
                                                        $oroshi_sum_number_ave = 0;
                                                        $oroshi_sum_number_ave2 = 0;
                                                    } else {
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        //$temp1_oroshi_sum2 = "<div class='title4 ta_r'>" . number_format((int)$oroshi_sum_number) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$oroshi_sum_number / $i)) . "</div></div>";
                                                        //$oroshi_sum_number_ave = number_format(floor((int)$oroshi_sum_number/ $i));                                                   
                                                        //$oroshi_sum_number_ave2 = floor((int)$oroshi_sum_number/ $i); 
                                                        if($last_nodata_flag == "ON"){
                                                            if($oroshi_sum_number_average <> "" && $oroshi_sum_number_average <> 0){$oroshi_sum_number_ave = number_format(floor((int)$oroshi_sum_number_average / ((int)$i -1)));} else {$oroshi_sum_number_ave = "---";}
                                                            if($oroshi_sum_number_average <> "" && $oroshi_sum_number_average <> 0){$oroshi_sum_number_ave2 = floor((int)$oroshi_sum_number_average / ((int)$i -1));} else {$oroshi_sum_number_ave2 = "---";}
                                                        } else {
                                                            $oroshi_sum_number_ave = number_format(floor((int)$oroshi_sum_number / $i));
                                                            $oroshi_sum_number_ave2 = floor((int)$oroshi_sum_number / $i);
                                                        }
                                                        $temp1_oroshi_sum2 = "<div class='title4 ta_r'>" . number_format((int)$oroshi_sum_number) . "</div><div class='title4 ta_r'>" . $oroshi_sum_number_ave . "</div></div>";
                                                    }

                                                // 全期間卸粗利合計とその平均値のHTML作成
                                                    $temp1_oroshi_sum3 = "";
                                                    //$temp1_oroshi_sum3 = "<div class='title4 ta_r'>" . number_format((int)$oroshi_sum_arari) . "</div><div class='title4 ta_c'>" . $yoy_arari3 . "</div><div class='title4 ta_r'>" . number_format(floor((int)$oroshi_sum_arari / $i)) . "</div></div>";
                                                    if($oroshi_sum_arari == 0 || $oroshi_sum_arari == ""){
                                                        $temp1_oroshi_sum3 = "<div class='title4 ta_r'>0</div><div class='title4 ta_r'>0</div></div>";
                                                        $oroshi_sum_arari_ave = 0;
                                                        $oroshi_sum_arari_ave2 = 0;
                                                    } else {
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        //$temp1_oroshi_sum3 = "<div class='title4 ta_r'>" . number_format((int)$oroshi_sum_arari) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$oroshi_sum_arari / $i)) . "</div></div>";
                                                        //$oroshi_sum_arari_ave = number_format(floor((int)$oroshi_sum_arari/ $i));
                                                        //$oroshi_sum_arari_ave2 = floor((int)$oroshi_sum_arari/ $i);  
                                                        if($last_nodata_flag == "ON"){
                                                            if($oroshi_sum_arari_average <> "" && $oroshi_sum_arari_average <> 0){$oroshi_sum_arari_ave = number_format(floor((int)$oroshi_sum_arari_average / ((int)$i -1)));} else {$oroshi_sum_arari_ave = "---";}
                                                            if($oroshi_sum_arari_average <> "" && $oroshi_sum_arari_average <> 0){$oroshi_sum_arari_ave2 = floor((int)$oroshi_sum_arari_average / ((int)$i -1));} else {$oroshi_sum_arari_ave2 = "---";}
                                                        } else {
                                                            $oroshi_sum_arari_ave = number_format(floor((int)$oroshi_sum_arari / $i));
                                                            $oroshi_sum_arari_ave2 = floor((int)$oroshi_sum_arari / $i);
                                                        }
                                                        $temp1_oroshi_sum3 = "<div class='title4 ta_r'>" . number_format((int)$oroshi_sum_arari) . "</div><div class='title4 ta_r'>" . $oroshi_sum_arari_ave . "</div></div>";
                                                    }
                                                    
                                    }
                            /************************************************************************************************************************************************************************************************************* */
                                // 全件用
                            /************************************************************************************************************************************************************************************************************* */


                                    // 各月のタイトル表示用HTMLを作成
                                        $temp1_title2 = "";
                                        $temp1_title3 = "";
                                        $temp1_title4 = "";
                                        $temp1_title5 = "";
                                        foreach($manth_now_array as $val){
                                                // 表示用
                                                $temp1_title2 .= "<div class='title2 ta_c'>" . $val . "</div>";
                                                // 20230803
                                                $temp1_title3 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                                $temp1_title4 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                                $temp1_title5 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                            }
                                
                                            $temp1_title = "<div class='wid100 ul2'><div class='title5 ta_c'>" . $between_start_view. "～<br>" .$between_end_view . "</div>" .$temp1_title2 ."<div class='title6 ta_c'>累計</div><!--<div class='title6 ta_c'>過去比</div>--><div class='title6 ta_c'>平均</div></div>";
                                            $temp1_title3 = "<div class='wid100 ul2'><div class='title7 ta_c'>" . $between_start_view. "～<br>" .$between_end_view . "</div>" .$temp1_title3 ."<div class='title7 ta_c'>平均</div></div>";
                                            $temp1_title4 = "<div class='wid100 ul2 bg_green'><div class='title7 ta_c'>" . $between_start_view. "～<br>" .$between_end_view . "</div>" .$temp1_title4 ."<div class='title7 ta_c'>平均</div></div>";
                                            $temp1_title5 = "<div class='wid100 ul2 bg_yellow'><div class='title7 ta_c'>" . $between_start_view. "～<br>" .$between_end_view . "</div>" .$temp1_title5 ."<div class='title7 ta_c'>平均</div></div>";
                                        
                                        
                                        // 全期間の全部門売上合計用変数リセット
                                            $all_sum_uriage_all = 0;
                                            $all_sum_number_all = 0;
                                            $all_sum_arari_all = 0;
                                            for($all_i = 0; $all_i < $i; $all_i++){
                                                // 各月の全部門売上合計用変数リセット
                                                    $all_month_uriage = 0;
                                                    $all_month_number= 0;
                                                    $all_month_arari= 0;
                                                // 各月の全部門売上合計をHTMLへ
                                                    if($out1_b == "ON"){ 
                                                        if(isset($web_uriage[$all_i])){$all_month_uriage = $all_month_uriage + (int)$web_uriage[$all_i]; }
                                                        if(isset($web_number[$all_i])){$all_month_number = $all_month_number + (int)$web_number[$all_i]; }
                                                        if(isset($web_arari[$all_i])){$all_month_arari = $all_month_arari+ (int)$web_arari[$all_i]; }
                                                    }
                                                    if($out1_a == "ON"){ 
                                                        if(isset($shop_uriage[$all_i])){$all_month_uriage = $all_month_uriage + (int)$shop_uriage[$all_i]; }
                                                        if(isset($shop_number[$all_i])){$all_month_number = $all_month_number + (int)$shop_number[$all_i]; }
                                                        if(isset($shop_arari[$all_i])){$all_month_arari = $all_month_arari + (int)$shop_arari[$all_i]; }
                                                    }
                                                    if($out1_c == "ON"){ 
                                                        // フォーム上の選択が「免税」のみだと「卸」は全月0なので「卸」を含む足し算だとエラーとなるため、条件分岐で回避
                                                            if($out4_a == "OFF" && $out4_b == "ON"){
                                                                $all_month_uriage = $all_month_uriage; 
                                                                $all_month_number = $all_month_number; 
                                                                $all_month_arari = $all_month_arari; 
                                                            } else {
                                                                if(isset($oroshi_uriage[$all_i])){ $all_month_uriage = $all_month_uriage + (int)$oroshi_uriage[$all_i]; }
                                                                if(isset($oroshi_number[$all_i])){ $all_month_number = $all_month_number + (int)$oroshi_number[$all_i]; }
                                                                if(isset($oroshi_arari[$all_i])){ $all_month_arari = $all_month_arari + (int)$oroshi_arari[$all_i]; }
                                                            }

                                                    }
                                                // 全期間の全部門売上合計
                                                    $all_sum_uriage_all = (int)$all_sum_uriage_all + (int)$all_month_uriage;
                                                    $all_sum_number_all = (int)$all_sum_number_all + (int)$all_month_number;
                                                    $all_sum_arari_all = (int)$all_sum_arari_all + (int)$all_month_arari;
                                                
                                            }







// 【進捗率の取得】
                                        

// 検索スタート日からデータが格納されている最終日までの日数
    $search_start = strtotime($start_now);
    $data_end = strtotime($last_day);
    $data_in_days = ($data_end - $search_start) / (60 * 60 * 24);

// 検索期間
    $search_start = strtotime($start_now);
    $search_end = strtotime($end_now);
    $search_days = ($search_end - $search_start) / (60 * 60 * 24);

// 検索期間・着地予測（期間合計 / データ格納期間 * 検索期間）
    ($shop_sum_uriage <> 0 && $shop_sum_uriage <> "") ? $shop_term_progress = $shop_sum_uriage / $data_in_days * $search_days : $shop_term_progress = "---";
    ($web_sum_uriage <> 0 && $web_sum_uriage <> "") ? $web_term_progress = $web_sum_uriage / $data_in_days * $search_days : $web_term_progress = "---";
    ($shop_sum_number <> 0 && $shop_sum_number <> "") ? $shop_term_progress_n = $shop_sum_number / $data_in_days * $search_days : $shop_term_progress_n = "---";
    ($web_sum_number <> 0 && $web_sum_number <> "") ? $web_term_progress_n = $web_sum_number / $data_in_days * $search_days : $web_term_progress_n = "---";
    ($shop_sum_arari <> 0 && $shop_sum_arari <> "") ? $shop_term_progress_a = $shop_sum_arari / $data_in_days * $search_days : $shop_term_progress_a = "---";
    ($web_sum_arari <> 0 && $web_sum_arari <> "") ? $web_term_progress_a = $web_sum_arari / $data_in_days * $search_days : $web_term_progress_a = "---";
    
    $oroshi_term_progress = 0;
    $oroshi_term_progress_n = 0;
    $oroshi_term_progress_a = 0;
    if($out1_c == "ON"){($oroshi_sum_uriage <> 0 && $oroshi_sum_uriage <> "") ? $oroshi_term_progress = $oroshi_sum_uriage / $data_in_days * $search_days : $oroshi_term_progress = "---";}
    if($out1_c == "ON"){($oroshi_sum_number <> 0 && $oroshi_sum_number <> "") ? $oroshi_term_progress_n = $oroshi_sum_number / $data_in_days * $search_days : $oroshi_term_progress_n = "---";}
    if($out1_c == "ON"){($oroshi_sum_arari <> 0 && $oroshi_sum_arari <> "") ? $oroshi_term_progress_a = $oroshi_sum_arari / $data_in_days * $search_days : $oroshi_term_progress_a = "---";}
    
    // 合計
        $all_term_progress = (int)$shop_term_progress + (int)$web_term_progress + (int)$oroshi_term_progress;
        $all_term_progress_n = (int)$shop_term_progress_n + (int)$web_term_progress_n + (int)$oroshi_term_progress_n;
        $all_term_progress_a = (int)$shop_term_progress_a + (int)$web_term_progress_a + (int)$oroshi_term_progress_a;
// 検索期間・過去との着地予測比（検索期間・着地予測 / 過去合計）
    ($shop_term_progress <> 0 && $shop_term_progress <> "" && $past_shop_sum_uriage <> 0 && $past_shop_sum_uriage <> "") ? $shop_term_progress2 = number_format((floor(((int)$shop_term_progress / (int)$past_shop_sum_uriage) * 100 * 10)) / 10,1) : $shop_term_progress2 = 0;
    ($web_term_progress <> 0 && $web_term_progress <> "" && $past_web_sum_uriage <> 0 && $past_web_sum_uriage <> "") ? $web_term_progress2 = number_format((floor(((int)$web_term_progress / (int)$past_web_sum_uriage) * 100 * 10)) / 10,1) : $web_term_progress2 = 0;
    ($shop_term_progress_n <> 0 && $shop_term_progress_n <> "" && $past_shop_sum_number <> 0 && $past_shop_sum_number <> "") ? $shop_term_progress2_n = number_format((floor(((int)$shop_term_progress_n / (int)$past_shop_sum_number) * 100 * 10)) / 10,1) : $shop_term_progress2_n = 0;
    ($web_term_progress_n <> 0 && $web_term_progress_n <> "" && $past_web_sum_number <> 0 && $past_web_sum_number <> "") ? $web_term_progress2_n = number_format((floor(((int)$web_term_progress_n / (int)$past_web_sum_number) * 100 * 10)) / 10,1) : $web_term_progress2_n = 0;
    ($shop_term_progress_a <> 0 && $shop_term_progress_a <> "" && $past_shop_sum_arari <> 0 && $past_shop_sum_arari <> "") ? $shop_term_progress2_a = number_format((floor(((int)$shop_term_progress_a / (int)$past_shop_sum_arari) * 100 * 10)) / 10,1) : $shop_term_progress2_a = 0;
    ($web_term_progress_a <> 0 && $web_term_progress_a <> "" && $past_web_sum_arari <> 0 && $past_web_sum_arari <> "") ? $web_term_progress2_a = number_format((floor(((int)$web_term_progress_a / (int)$past_web_sum_arari) * 100 * 10)) / 10,1) : $web_term_progress2_a = 0;
    
    if($out1_c == "ON"){
        if($oroshi_term_progress <> "" && $oroshi_term_progress <> 0 && $past_oroshi_sum_uriage <> "" && $past_oroshi_sum_uriage <> 0){
            $oroshi_term_progress2 = number_format((floor(((int)$oroshi_term_progress / (int)$past_oroshi_sum_uriage) * 100 * 10)) / 10,1);
        } else {
            $oroshi_term_progress2 = "---";
        }
        if($oroshi_term_progress_n <> "" && $oroshi_term_progress_n <> 0 && $past_oroshi_sum_number <> "" && $past_oroshi_sum_number <> 0){
            $oroshi_term_progress2_n = number_format((floor(((int)$oroshi_term_progress_n / (int)$past_oroshi_sum_number) * 100 * 10)) / 10,1);
        } else {
            $oroshi_term_progress2_n = "---"; 
        }
        if($oroshi_term_progress_a <> "" && $oroshi_term_progress_a <> 0 && $past_oroshi_sum_arari <> "" && $past_oroshi_sum_arari <> 0){
            $oroshi_term_progress2_a = number_format((floor(((int)$oroshi_term_progress_a / (int)$past_oroshi_sum_arari) * 100 * 10)) / 10,1);
        } else {
            $oroshi_term_progress2_a = "---"; 
        }
    }
    
    // 合計
    ($all_term_progress <> 0 && $all_term_progress <> "" && $past_all_sum_uriage_all <> 0 && $past_all_sum_uriage_all <> "") ? $all_term_progress2 = number_format((floor(((int)$all_term_progress / (int)$past_all_sum_uriage_all) * 100 * 10)) / 10,1) : $all_term_progress2 = "---";
    ($all_term_progress_n <> 0 && $all_term_progress_n <> "" && $past_all_sum_number_all <> 0 && $past_all_sum_number_all <> "") ? $all_term_progress2_n = number_format((floor(((int)$all_term_progress_n / (int)$past_all_sum_number_all) * 100 * 10)) / 10,1) : $all_term_progress2_n = "---";
    ($all_term_progress_a <> 0 && $all_term_progress_a <> "" && $past_all_sum_arari_all <> 0 && $past_all_sum_arari_all <> "") ? $all_term_progress2_a = number_format((floor(((int)$all_term_progress_a / (int)$past_all_sum_arari_all) * 100 * 10)) / 10,1) : $all_term_progress2_a = "---";

// HTML追記
    ($shop_term_progress <> 0 && $shop_term_progress <> "") ? $shop_term_progress_view = "<div class='sinchoku'>" . number_format((int)$shop_term_progress) . "</div>" : $shop_term_progress_view = "<div class='sinchoku'>---</div>";
    ($shop_sum_uriage <> 0 && $shop_sum_uriage <> "") ? $shop_sum_uriage_view = "<div class='sinchoku'>" . number_format($shop_sum_uriage) . "</div>" : $shop_sum_uriage_view = "<div class='sinchoku'>---</div>";
    ($shop_term_progress2 < 100) ? $shop_term_progress2_view = "<div class='sinchoku fc_blue'>" . $shop_term_progress2 . "%</div>" : $shop_term_progress2_view = "<div class='sinchoku fc_red'>" . $shop_term_progress2 . "%</div>";
    ($web_term_progress <> 0 && $web_term_progress <> "") ? $web_term_progress_view = "<div class='sinchoku'>" . number_format((int)$web_term_progress) . "</div>" : $web_term_progress_view = "<div class='sinchoku'>---</div>";
    ($web_sum_uriage <> 0 && $web_sum_uriage <> "") ? $web_sum_uriage_view = "<div class='sinchoku'>" . number_format((int)$web_sum_uriage) . "</div>" : $web_sum_uriage_view = "<div class='sinchoku'>---</div>";
    ($web_term_progress2 < 100) ? $web_term_progress2_view = "<div class='sinchoku fc_blue'>" . $web_term_progress2 . "%</div>" : $web_term_progress2_view = "<div class='sinchoku fc_red'>" . $web_term_progress2 . "%</div>";
    
    ($shop_term_progress_n <> 0 && $shop_term_progress_n <> "") ? $shop_term_progress_n_view = "<div class='sinchoku'>" . number_format((int)$shop_term_progress_n) . "</div>" : $shop_term_progress_n_view = "<div class='sinchoku'>---</div>";
    ($shop_sum_number <> 0 && $shop_sum_number <> "") ? $shop_sum_number_view = "<div class='sinchoku'>" . number_format($shop_sum_number) . "</div>" : $shop_sum_number_view = "<div class='sinchoku'>---</div>";
    ($shop_term_progress2_n < 100) ? $shop_term_progress2_n_view = "<div class='sinchoku fc_blue'>" . $shop_term_progress2_n . "%</div>" : $shop_term_progress2_n_view = "<div class='sinchoku fc_red'>" . $shop_term_progress2_n . "%</div>";
    ($web_term_progress_n <> 0 && $web_term_progress_n <> "") ? $web_term_progress_n_view = "<div class='sinchoku'>" . number_format((int)$web_term_progress_n) . "</div>" : $web_term_progress_n_view = "<div class='sinchoku'>---</div>";
    ($web_sum_number <> 0 && $web_sum_number <> "") ? $web_sum_number_view = "<div class='sinchoku'>" . number_format((int)$web_sum_number) . "</div>" : $web_sum_number_view = "<div class='sinchoku'>---</div>";
    ($web_term_progress2_n < 100) ? $web_term_progress2_n_view = "<div class='sinchoku fc_blue'>" . $web_term_progress2_n . "%</div>" : $web_term_progress2_n_view = "<div class='sinchoku fc_red'>" . $web_term_progress2_n . "%</div>";
  
    ($shop_term_progress_a <> 0 && $shop_term_progress_a <> "") ? $shop_term_progress_a_view = "<div class='sinchoku'>" . number_format((int)$shop_term_progress_a) . "</div>" : $shop_term_progress_a_view = "<div class='sinchoku'>---</div>";
    ($shop_sum_arari <> 0 && $shop_sum_arari <> "") ? $shop_sum_arari_view = "<div class='sinchoku'>" . number_format($shop_sum_arari) . "</div>" : $shop_sum_arari_view = "<div class='sinchoku'>---</div>";
    ($shop_term_progress2_a < 100) ? $shop_term_progress2_a_view = "<div class='sinchoku fc_blue'>" . $shop_term_progress2_a . "%</div>" : $shop_term_progress2_a_view = "<div class='sinchoku fc_red'>" . $shop_term_progress2_a . "%</div>";
    ($web_term_progress_a <> 0 && $web_term_progress_a <> "") ? $web_term_progress_a_view = "<div class='sinchoku'>" . number_format((int)$web_term_progress_a) . "</div>" : $web_term_progress_a_view = "<div class='sinchoku'>---</div>";
    ($web_sum_arari <> 0 && $web_sum_arari <> "") ? $web_sum_arari_view = "<div class='sinchoku'>" . number_format((int)$web_sum_arari) . "</div>" : $web_sum_arari_view = "<div class='sinchoku'>---</div>";
    ($web_term_progress2_a < 100) ? $web_term_progress2_a_view = "<div class='sinchoku fc_blue'>" . $web_term_progress2_a . "%</div>" : $web_term_progress2_a_view = "<div class='sinchoku fc_red'>" . $web_term_progress2_a . "%</div>";
    
    if($out1_c == "ON"){ 
        ($oroshi_term_progress <> 0 && $oroshi_term_progress <> "") ? $oroshi_term_progress_view = "<div class='sinchoku'>" . number_format((int)$oroshi_term_progress) . "</div>" : $oroshi_term_progress_view = "<div class='sinchoku'>---</div>";
        ($oroshi_sum_uriage <> 0 && $oroshi_sum_uriage <> "") ? $oroshi_sum_uriage_view = "<div class='sinchoku'>" . number_format((int)$oroshi_sum_uriage) . "</div>" : $oroshi_sum_uriage_view = "<div class='sinchoku'>---</div>";
        ($oroshi_term_progress2 < 100) ? $oroshi_term_progress2_view = "<div class='sinchoku fc_blue'>" . $oroshi_term_progress2 . "%</div>" : $oroshi_term_progress2_view = "<div class='sinchoku fc_red'>" . $oroshi_term_progress2 . "%</div>";
        ($oroshi_term_progress_n <> 0 && $oroshi_term_progress_n <> "") ? $oroshi_term_progress_n_view = "<div class='sinchoku'>" . number_format((int)$oroshi_term_progress_n) . "</div>" : $oroshi_term_progress_n_view = "<div class='sinchoku'>---</div>";
        ($oroshi_sum_number <> 0 && $oroshi_sum_number <> "") ? $oroshi_sum_number_view = "<div class='sinchoku'>" . number_format((int)$oroshi_sum_number) . "</div>" : $oroshi_sum_number_view = "<div class='sinchoku'>---</div>";
        ($oroshi_term_progress2_n < 100) ? $oroshi_term_progress2_n_view = "<div class='sinchoku fc_blue'>" . $oroshi_term_progress2_n . "%</div>" : $oroshi_term_progress2_n_view = "<div class='sinchoku fc_red'>" . $oroshi_term_progress2_n . "%</div>";
            ($oroshi_term_progress_a <> 0 && $oroshi_term_progress_a <> "") ? $oroshi_term_progress_a_view = "<div class='sinchoku'>" . number_format((int)$oroshi_term_progress_a) . "</div>" : $oroshi_term_progress_a_view = "<div class='sinchoku'>---</div>";
        ($oroshi_sum_arari <> 0 && $oroshi_sum_arari <> "") ? $oroshi_sum_arari_view = "<div class='sinchoku'>" . number_format((int)$oroshi_sum_arari) . "</div>" : $oroshi_sum_arari_view = "<div class='sinchoku'>---</div>";
        ($oroshi_term_progress2_a < 100) ? $oroshi_term_progress2_a_view = "<div class='sinchoku fc_blue'>" . $oroshi_term_progress2_a . "%</div>" : $oroshi_term_progress2_a_view = "<div class='sinchoku fc_red'>" . $oroshi_term_progress2_a . "%</div>";
    }
    ($all_term_progress <> 0 && $all_term_progress <> "") ? $all_term_progress_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_term_progress) . "</div>" : $all_term_progress_view = "<div class='sinchoku bg_grey'>---</div>";
    ($all_sum_uriage_all <> 0 && $all_sum_uriage_all <> "") ? $all_sum_uriage_all_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_sum_uriage_all) . "</div>" : $all_sum_uriage_all_view = "<div class='sinchoku bg_grey'>---</div>";
    ($all_term_progress2 < 100) ? $all_term_progress2_view = "<div class='sinchoku fc_blue bg_grey'>" . $all_term_progress2 . "%</div>" : $all_term_progress2_view = "<div class='sinchoku fc_red bg_grey'>" . $all_term_progress2 . "%</div>";
    ($all_term_progress_n <> 0 && $all_term_progress_n <> "") ? $all_term_progress_n_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_term_progress_n) . "</div>" : $all_term_progress_n_view = "<div class='sinchoku bg_grey'>---</div>";
    ($all_sum_number_all <> 0 && $all_sum_number_all <> "") ? $all_sum_number_all_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_sum_number_all) . "</div>" : $all_sum_number_all_view = "<div class='sinchoku bg_grey'>---</div>";
    ($all_term_progress2_n < 100) ? $all_term_progress2_n_view = "<div class='sinchoku fc_blue bg_grey'>" . $all_term_progress2_n . "%</div>" : $all_term_progress2_n_view = "<div class='sinchoku fc_red bg_grey'>" . $all_term_progress2_n . "%</div>";
    ($all_term_progress_a <> 0 && $all_term_progress_a <> "") ? $all_term_progress_a_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_term_progress_a) . "</div>" : $all_term_progress_a_view = "<div class='sinchoku bg_grey'>---</div>";
    ($all_sum_arari_all <> 0 && $all_sum_arari_all <> "") ? $all_sum_arari_all_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_sum_arari_all) . "</div>" : $all_sum_arari_all_view = "<div class='sinchoku bg_grey'>---</div>";
    ($all_term_progress2_a < 100) ? $all_term_progress2_a_view = "<div class='sinchoku fc_blue bg_grey'>" . $all_term_progress2_a . "%</div>" : $all_term_progress2_a_view = "<div class='sinchoku fc_red bg_grey'>" . $all_term_progress2_a . "%</div>";
    
    
    // 売上額進捗
                                                                    $uriage_progress_html = 
                                                                    "<div class='btn_bulldown_  pt2'><span class='view'>＋</span> 予測数値について</div>
                                                                    <div class='down'>
                                                                        <p class='text'>▼月間着地予測：データを有する最終月の数値 / 月初からデータを有する最終日までの日数 x 該当月の最終日の数字</p>
                                                                        <p class='text'>▼月間着地予測比（対過去・同月）：データを有する最終月を検索期間遡った過去月との対比（1～12月までの検索で、8月までのデータが存在するのなら、昨年の8月との対比）</p>
                                                                        <p class='text'>▼全期間着地予測：検索期間の累計 / 検索スタート日からデータを有する最終日までの日数 x 検索期間の総日数</p>
                                                                    </div>
                                                                    <div class='ul_p mt1'>
                                                                        <div class='sinchoku_t'>" . $last_year_last . "年" . $last_month_last. "月</div>
                                                                        <div class='sinchoku_t'>月間売上進捗</div>
                                                                        <div class='sinchoku_t'>月間着地予測</div>
                                                                        <div class='sinchoku_t'>月間着地予測比（対前月）</div>
                                                                        <div class='sinchoku_t'>月間着地予測比（対過去・同月）</div>
                                                                        <div class='sinchoku_t'>全期間売上進捗</div>
                                                                        <div class='sinchoku_t'>全期間着地予測</div>
                                                                        <div class='sinchoku_t'>全期間着地予測比（対過去・全期間）</div>
                                                                    </div>
                                                                    <div class='ul_p'>
                                                                        <div class='sinchoku ta_c'>店舗</div>
                                                                        <div class='sinchoku'>" . $shop_uriage_view1. "</div>
                                                                        <div class='sinchoku'>" . $shop_uriage_view2. "</div>
                                                                        " . $shop_uriage_view3 . "
                                                                        " . $shop_uriage_view4 . "
                                                                        " . $shop_sum_uriage_view . "
                                                                        " . $shop_term_progress_view. "
                                                                        " . $shop_term_progress2_view. "
                                                                    </div>
                                                                    <div class='ul_p'>
                                                                        <div class='sinchoku ta_c'>通販</div>
                                                                        <div class='sinchoku'>" . $web_uriage_view1 . "</div>
                                                                        <div class='sinchoku'>" . $web_uriage_view2. "</div>
                                                                        " . $web_uriage_view3 . "
                                                                        " . $web_uriage_view4 . "
                                                                        " . $web_sum_uriage_view . "
                                                                        " . $web_term_progress_view. "
                                                                        " . $web_term_progress2_view. "
                                                                    </div>";
                                                                    if($out1_c == "ON"){ 
                                                                    $uriage_progress_html .= 
                                                                    "<div class='ul_p'>
                                                                        <div class='sinchoku ta_c'>卸</div>
                                                                        <div class='sinchoku'>" . $oroshi_uriage_view1 . "</div>
                                                                        <div class='sinchoku'>" . $oroshi_uriage_view2. "</div>
                                                                        " . $oroshi_uriage_view3 . "
                                                                        " . $oroshi_uriage_view4 . "
                                                                        " . $oroshi_sum_uriage_view . "
                                                                        " . $oroshi_term_progress_view. "
                                                                        " . $oroshi_term_progress2_view. "
                                                                    </div>";
                                                                    }
                                                                    $uriage_progress_html .= 
                                                                    "<div class='ul_p'>
                                                                        <div class='sinchoku bg_grey ta_c'>合計</div>
                                                                        <div class='sinchoku bg_grey'>" . $all_uriage_view1 . "</div>
                                                                        <div class='sinchoku bg_grey'>" . $all_uriage_view2 . "</div>
                                                                        " . $all_uriage_view3 . "
                                                                        " . $all_uriage_view4 . "
                                                                        " . $all_sum_uriage_all_view . "
                                                                        " . $all_term_progress_view. "
                                                                        " . $all_term_progress2_view. "
                                                                    </div>";
                                                            // 売上点数進捗
                                                                    $number_progress_html = 
                                                                    "<div class='btn_bulldown_  pt2'><span class='view2'>＋</span> 予測数値について</div>
                                                                    <div class='down'>
                                                                    <p class='text'>▼月間着地予測：データを有する最終月の数値 / 月初からデータを有する最終日までの日数 x 該当月の最終日の数字</p>
                                                                    <p class='text'>▼月間着地予測比（対過去・同月）：データを有する最終月を検索期間遡った過去月との対比（1～12月までの検索で、8月までのデータが存在するのなら、昨年の8月との対比）</p>
                                                                    <p class='text'>▼全期間着地予測：検索期間の累計 / 検索スタート日からデータを有する最終日までの日数 x 検索期間の総日数</p>
                                                                    </div>
                                                                    <div class='ul_p mt1'>
                                                                        <div class='sinchoku_t'>" . $last_year_last . "年" . $last_month_last. "月</div>
                                                                        <div class='sinchoku_t'>月間売上進捗</div>
                                                                        <div class='sinchoku_t'>月間着地予測</div>
                                                                        <div class='sinchoku_t'>月間着地予測比（対前月）</div>
                                                                        <div class='sinchoku_t'>月間着地予測比（対過去・同月）</div>
                                                                        <div class='sinchoku_t'>全期間売上進捗</div>
                                                                        <div class='sinchoku_t'>全期間着地予測</div>
                                                                        <div class='sinchoku_t'>全期間着地予測比（対過去・全期間）</div>
                                                                    </div>
                                                                    <div class='ul_p'>
                                                                        <div class='sinchoku ta_c'>店舗</div>
                                                                        <div class='sinchoku'>" . $shop_number_view1. "</div>
                                                                        <div class='sinchoku'>" . $shop_number_view2. "</div>
                                                                        " . $shop_number_view3 . "
                                                                        " . $shop_number_view4 . "
                                                                        " . $shop_sum_number_view . "
                                                                        " . $shop_term_progress_n_view. "
                                                                        " . $shop_term_progress2_n_view. "
                                                                    </div>
                                                                    <div class='ul_p'>
                                                                        <div class='sinchoku ta_c'>通販</div>
                                                                        <div class='sinchoku'>" . $web_number_view1 . "</div>
                                                                        <div class='sinchoku'>" . $web_number_view2. "</div>
                                                                        " . $web_number_view3 . "
                                                                        " . $web_number_view4 . "
                                                                        " . $web_sum_number_view . "
                                                                        " . $web_term_progress_n_view. "
                                                                        " . $web_term_progress2_n_view. "
                                                                    </div>";
                                                                    if($out1_c == "ON"){ 
                                                                    $number_progress_html .= 
                                                                    "<div class='ul_p'>
                                                                        <div class='sinchoku ta_c'>卸</div>
                                                                        <div class='sinchoku'>" . $oroshi_number_view1 . "</div>
                                                                        <div class='sinchoku'>" . $oroshi_number_view2. "</div>
                                                                        " . $oroshi_number_view3 . "
                                                                        " . $oroshi_number_view4 . "
                                                                        " . $oroshi_sum_number_view . "
                                                                        " . $oroshi_term_progress_n_view. "
                                                                        " . $oroshi_term_progress2_n_view. "
                                                                    </div>";
                                                                    }
                                                                    $number_progress_html .= 
                                                                    "<div class='ul_p'>
                                                                        <div class='sinchoku bg_grey ta_c'>合計</div>
                                                                        <div class='sinchoku bg_grey'>" . $all_number_view1 . "</div>
                                                                        <div class='sinchoku bg_grey'>" . $all_number_view2 . "</div>
                                                                        " . $all_number_view3 . "
                                                                        " . $all_number_view4 . "
                                                                        " . $all_sum_number_all_view . "
                                                                        " . $all_term_progress_n_view. "
                                                                        " . $all_term_progress2_n_view. "
                                                                    </div>";
                                                            // 売上粗利進捗
                                                                    $arari_progress_html = 
                                                                    "<div class='btn_bulldown_  pt2'><span class='view3'>＋</span> 予測数値について</div>
                                                                    <div class='down'>
                                                                    <p class='text'>▼月間着地予測：データを有する最終月の数値 / 月初からデータを有する最終日までの日数 x 該当月の最終日の数字</p>
                                                                    <p class='text'>▼月間着地予測比（対過去・同月）：データを有する最終月を検索期間遡った過去月との対比（1～12月までの検索で、8月までのデータが存在するのなら、昨年の8月との対比）</p>
                                                                    <p class='text'>▼全期間着地予測：検索期間の累計 / 検索スタート日からデータを有する最終日までの日数 x 検索期間の総日数</p>
                                                                    </div>
                                                                    <div class='ul_p mt1'>
                                                                        <div class='sinchoku_t'>" . $last_year_last . "年" . $last_month_last. "月</div>
                                                                        <div class='sinchoku_t'>月間売上進捗</div>
                                                                        <div class='sinchoku_t'>月間着地予測</div>
                                                                        <div class='sinchoku_t'>月間着地予測比（対前月）</div>
                                                                        <div class='sinchoku_t'>月間着地予測比（対過去・同月）</div>
                                                                        <div class='sinchoku_t'>全期間売上進捗</div>
                                                                        <div class='sinchoku_t'>全期間着地予測</div>
                                                                        <div class='sinchoku_t'>全期間着地予測比（対過去・全期間）</div>
                                                                    </div>
                                                                    <div class='ul_p'>
                                                                        <div class='sinchoku ta_c'>店舗</div>
                                                                        <div class='sinchoku'>" . $shop_arari_view1. "</div>
                                                                        <div class='sinchoku'>" . $shop_arari_view2. "</div>
                                                                        " . $shop_arari_view3 . "
                                                                        " . $shop_arari_view4 . "
                                                                        " . $shop_sum_arari_view . "
                                                                        " . $shop_term_progress_a_view. "
                                                                        " . $shop_term_progress2_a_view. "
                                                                    </div>
                                                                    <div class='ul_p'>
                                                                        <div class='sinchoku ta_c'>通販</div>
                                                                        <div class='sinchoku'>" . $web_arari_view1 . "</div>
                                                                        <div class='sinchoku'>" . $web_arari_view2. "</div>
                                                                        " . $web_arari_view3 . "
                                                                        " . $web_arari_view4 . "
                                                                        " . $web_sum_arari_view . "
                                                                        " . $web_term_progress_a_view. "
                                                                        " . $web_term_progress2_a_view. "
                                                                    </div>";
                                                                    if($out1_c == "ON"){ 
                                                                    $arari_progress_html .= 
                                                                    "<div class='ul_p'>
                                                                        <div class='sinchoku ta_c'>卸</div>
                                                                        <div class='sinchoku'>" . $oroshi_arari_view1 . "</div>
                                                                        <div class='sinchoku'>" . $oroshi_arari_view2. "</div>
                                                                        " . $oroshi_arari_view3 . "
                                                                        " . $oroshi_arari_view4 . "
                                                                        " . $oroshi_sum_arari_view . "
                                                                        " . $oroshi_term_progress_a_view. "
                                                                        " . $oroshi_term_progress2_a_view. "
                                                                    </div>";
                                                                    }
                                                                    $arari_progress_html .= 
                                                                    "<div class='ul_p'>
                                                                        <div class='sinchoku bg_grey ta_c'>合計</div>
                                                                        <div class='sinchoku bg_grey'>" . $all_arari_view1 . "</div>
                                                                        <div class='sinchoku bg_grey'>" . $all_arari_view2 . "</div>
                                                                        " . $all_arari_view3 . "
                                                                        " . $all_arari_view4 . "
                                                                        " . $all_sum_arari_all_view . "
                                                                        " . $all_term_progress_a_view. "
                                                                        " . $all_term_progress2_a_view. "
                                                                    </div>";

                                                                    if($out6 <> "ON"){
                                                                        $uriage_progress_html = "";
                                                                        $number_progress_html = "";
                                                                        $arari_progress_html = "";
                                                                    }




                            /************************************************************************************************************************************************************************************************************* */
                                // 最終ソース出力
                            /************************************************************************************************************************************************************************************************************* */
                                        
                                            // 【進捗率の取得】検索最終月の日数を取得
                                                //$get_days = $end_year . "-" . $end_month;
                                                //$get_days2 = date('t', strtotime($get_days));
                            
                            
                                        // 店舗用HTMLの作成
                                                $js_shop_uriage  = "";
                                                $js_shop_number  = "";
                                                $js_shop_arari  = "";
                                                $temp1_shop_manthly_html = "";
                                                $temp1_shop_manthly_html2 = "";
                                                $temp1_shop_manthly_html3 = "";
                                                $progress_uriage_html = "";
                                                $progress_number_html = "";
                                                $progress_arari_html = "";
                                                if($out1_a == "ON"){     
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_now_array as $val){
                                                                //$val = mb_substr($val,0,-3);
                                                                if(strpos($temp1_shop_manthly_data, $val ) !== false){
                                                                    $temp1_shop_manthly_data = str_replace($val, 0, $temp1_shop_manthly_data);
                                                                }
                                                                if(strpos($temp1_shop_manthly_data2, $val ) !== false){
                                                                    $temp1_shop_manthly_data2 = str_replace($val, 0, $temp1_shop_manthly_data2);
                                                                }
                                                                if(strpos($temp1_shop_manthly_data3, $val ) !== false){
                                                                    $temp1_shop_manthly_data3 = str_replace($val, 0, $temp1_shop_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $temp1_shop_manthly_array = explode(',',$temp1_shop_manthly_data);
                                                        $temp1_shop_manthly_array2 = explode(',',$temp1_shop_manthly_data2);
                                                        $temp1_shop_manthly_array3 = explode(',',$temp1_shop_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        $shop_last_uriage = "";
                                                        $i = 0;
                                                        foreach($temp1_shop_manthly_array as $val){
                                                            // 【進捗率の取得】最終月の「現在・店舗・売上」を取得
                                                                //$shop_last_uriage = $val;

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_shop_uriage  .= "0, ";
                                                                // 表示用
                                                                    $temp1_shop_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_shop_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp1_shop_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }

                                                        $i = 0;
                                                        foreach($temp1_shop_manthly_array2 as $val){
                                                            // 【進捗率の取得】最終月の「現在・店舗・点数」を取得
                                                                //$shop_last_number = $val;
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_shop_number  .= "0, ";
                                                                // 表示用
                                                                    $temp1_shop_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_shop_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp1_shop_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp1_shop_manthly_array3 as $val){
                                                            // 【進捗率の取得】最終月の「現在・通販・粗利」を取得
                                                                //$shop_last_arari = $val;
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_shop_arari  .= "0, ";
                                                                // 表示用
                                                                    $temp1_shop_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_shop_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp1_shop_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                            
                                                        // 全体HTMLの作成
                                                            if(isset($temp1_shop_manthly_html) && isset($temp1_shop_sum)){
                                                                $temp1_shop_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>店舗</div>" . $temp1_shop_manthly_html . $temp1_shop_sum;
                                                            }
                                                            if(isset($temp1_shop_manthly_html2) && isset($temp1_shop_sum2)){
                                                                $temp1_shop_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>店舗</div>" . $temp1_shop_manthly_html2 . $temp1_shop_sum2;
                                                            }
                                                            if(isset($temp1_shop_manthly_html3) && isset($temp1_shop_sum3)){
                                                                $temp1_shop_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>店舗</div>" . $temp1_shop_manthly_html3 . $temp1_shop_sum3;
                                                            }
                                                    }

                                            // 通販用HTMLの作成
                                                $js_web_uriage  = "";
                                                $js_web_number  = "";
                                                $js_web_arari  = "";
                                                $temp1_web_manthly_html = "";
                                                $temp1_web_manthly_html2 = "";
                                                $temp1_web_manthly_html3 = "";
                                                if($out1_b == "ON"){     
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_now_array as $val){
                                                                //$val = mb_substr($val,0,-3);
                                                                if(strpos($temp1_web_manthly_data, $val ) !== false){
                                                                    $temp1_web_manthly_data = str_replace($val, 0, $temp1_web_manthly_data);
                                                                }
                                                                if(strpos($temp1_web_manthly_data2, $val ) !== false){
                                                                    $temp1_web_manthly_data2 = str_replace($val, 0, $temp1_web_manthly_data2);
                                                                }
                                                                if(strpos($temp1_web_manthly_data3, $val ) !== false){
                                                                    $temp1_web_manthly_data3 = str_replace($val, 0, $temp1_web_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $temp1_web_manthly_array = explode(',',$temp1_web_manthly_data);
                                                        $temp1_web_manthly_array2 = explode(',',$temp1_web_manthly_data2);
                                                        $temp1_web_manthly_array3 = explode(',',$temp1_web_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        //$web_last_uriage = "";

                                                        $i = 0;
                                                        foreach($temp1_web_manthly_array as $val){
                                                            // 【進捗率の取得】最終月の「現在・通販・売上」を取得
                                                                //$web_last_uriage = $val;

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_web_uriage  .= "0, ";
                                                                // 表示用
                                                                    $temp1_web_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_web_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp1_web_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp1_web_manthly_array2 as $val){
                                                            // 【進捗率の取得】最終月の「現在・通販・点数」を取得
                                                                //$web_last_number = $val;

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_web_number  .= "0, ";
                                                                // 表示用
                                                                    $temp1_web_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_web_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp1_web_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp1_web_manthly_array3 as $val){
                                                            // 【進捗率の取得】最終月の「現在・通販・粗利」を取得
                                                                //$web_last_arari = $val;
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_web_arari  .= "0, ";
                                                                // 表示用
                                                                    $temp1_web_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_web_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp1_web_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                    // 全体HTMLの作成
                                                            if(isset($temp1_web_manthly_html) && isset($temp1_web_sum)){
                                                                $temp1_web_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>通販</div>" . $temp1_web_manthly_html . $temp1_web_sum;
                                                            }
                                                            if(isset($temp1_web_manthly_html2) && isset($temp1_web_sum2)){
                                                                $temp1_web_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>通販</div>" . $temp1_web_manthly_html2 . $temp1_web_sum2;
                                                            }
                                                            if(isset($temp1_web_manthly_html3) && isset($temp1_web_sum3)){
                                                                $temp1_web_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>通販</div>" . $temp1_web_manthly_html3 . $temp1_web_sum3;
                                                            }
                                                }



                                        // 卸用HTMLの作成
                                                $js_oroshi_uriage  = "";
                                                $js_oroshi_number  = "";
                                                $js_oroshi_arari  = "";
                                                $temp1_oroshi_manthly_html = "";
                                                $temp1_oroshi_manthly_html2 = "";
                                                $temp1_oroshi_manthly_html3 = "";
                                                if($out1_c == "ON"){     
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_now_array as $val){
                                                                //$val = mb_substr($val,0,-3);
                                                                if(strpos($temp1_oroshi_manthly_data, $val ) !== false){
                                                                    $temp1_oroshi_manthly_data = str_replace($val, 0, $temp1_oroshi_manthly_data);
                                                                }
                                                                if(strpos($temp1_oroshi_manthly_data2, $val ) !== false){
                                                                    $temp1_oroshi_manthly_data2 = str_replace($val, 0, $temp1_oroshi_manthly_data2);
                                                                }
                                                                if(strpos($temp1_oroshi_manthly_data3, $val ) !== false){
                                                                    $temp1_oroshi_manthly_data3 = str_replace($val, 0, $temp1_oroshi_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $temp1_oroshi_manthly_array = explode(',',$temp1_oroshi_manthly_data);
                                                        $temp1_oroshi_manthly_array2 = explode(',',$temp1_oroshi_manthly_data2);
                                                        $temp1_oroshi_manthly_array3 = explode(',',$temp1_oroshi_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        //$oroshi_last_uriage = "";
                                                        $i = 0;
                                                        foreach($temp1_oroshi_manthly_array as $val){
                                                            // 【進捗率の取得】最終月の「現在・卸・売上」を取得
                                                                //$oroshi_last_uriage = $val;

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_oroshi_uriage  .= "0, ";
                                                                // 表示用
                                                                    $temp1_oroshi_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_oroshi_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp1_oroshi_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp1_oroshi_manthly_array2 as $val){
                                                            // 【進捗率の取得】最終月の「現在・卸・点数」を取得
                                                                //$oroshi_last_number = $val;
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_oroshi_number  .= "0, ";
                                                                // 表示用
                                                                    $temp1_oroshi_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_oroshi_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp1_oroshi_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp1_oroshi_manthly_array3 as $val){
                                                            // 【進捗率の取得】最終月の「現在・卸・粗利」を取得
                                                                //$oroshi_last_arari = $val;
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_oroshi_arari  .= "0, ";
                                                                // 表示用
                                                                    $temp1_oroshi_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_oroshi_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp1_oroshi_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }

                                                    // 全体HTMLの作成
                                                        if(isset($temp1_oroshi_manthly_html) && isset($temp1_oroshi_sum)){
                                                            $temp1_oroshi_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>卸</div>" . $temp1_oroshi_manthly_html . $temp1_oroshi_sum;
                                                        }
                                                        if(isset($temp1_oroshi_manthly_html2) && isset($temp1_oroshi_sum2)){
                                                            $temp1_oroshi_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>卸</div>" . $temp1_oroshi_manthly_html2 . $temp1_oroshi_sum2;
                                                        }
                                                        if(isset($temp1_oroshi_manthly_html3) && isset($temp1_oroshi_sum3)){
                                                            $temp1_oroshi_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>卸</div>" . $temp1_oroshi_manthly_html3 . $temp1_oroshi_sum3;
                                                        }
                                                }

                                        // 各月の全部門売上合計のJS表示用
                                                $js_all_month_uriage = "";
                                                $js_all_month_number = "";
                                                $js_all_month_arari = "";
                                                $i = 0;
                                                foreach($manth_now_array as $val){
                                                    $all_js = 0;
                                                    $all_js2 = 0;
                                                    $all_js3 = 0;
                                                    if($out1_a == "ON"){ $all_js = (int)$all_js + (int)$temp1_shop_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$temp1_shop_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$temp1_shop_manthly_array3[$i];}
                                                    if($out1_b == "ON"){ $all_js = (int)$all_js + (int)$temp1_web_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$temp1_web_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$temp1_web_manthly_array3[$i];}
                                                    if($out1_c == "ON"){ $all_js = (int)$all_js + (int)$temp1_oroshi_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$temp1_oroshi_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$temp1_oroshi_manthly_array3[$i];}

                                                    $js_all_month_uriage .= $all_js . ", ";
                                                    $js_all_month_number .= $all_js2 . ", ";
                                                    $js_all_month_arari .= $all_js3 . ", ";
                                                    
                                                    $i++;
                                                }



// 現在・通販・粗利率

    $i = 0;
    $web_ratio = "";
    $web_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>粗利率(通販)</div>";
    $web_total = "";
    $web_total_js = "";
    $all_total = "";
    $web_total_ratio = "";
    $web_ratio_cutting = "";
    $web_ratio_cutting_ave = "";
    $web_ratio_cutting_html = "";
    foreach($temp1_web_manthly_array3 as $var){
        if($var == 0){
            $web_ratio = "---";
            $web_total = $web_total;
            if($temp1_web_manthly_array[$i] == 0){
                $all_total = $all_total;
            } else {
                $all_total = (int)$all_total + (int)$temp1_web_manthly_array[$i];
            }
        } else {
            $web_ratio = number_format((floor(($var / $temp1_web_manthly_array[$i]) * 100 * 10)) / 10 ,1);
            $web_total = (int)$web_total + (int)$var;
            if($temp1_web_manthly_array[$i] == 0){
                $all_total = $all_total;
            } else {
                $all_total = (int)$all_total + (int)$temp1_web_manthly_array[$i];
            }
        }
        $web_total_js  .= (float)$web_ratio . ", ";
        $web_sum_arari_per .= "<div class='title6 ta_r'>" . $web_ratio . "%</div>";

        // 粗利率の過去比
            if($web_ratio <> "" && $web_ratio <> "---" && ${"past_web_ratio_" .$i} <> "" && ${"past_web_ratio_" .$i} <> "---"){
                $web_ratio_cutting = (float)$web_ratio - (float)${"past_web_ratio_" .$i};
                $web_ratio_cutting = number_format($web_ratio_cutting, 1);
                // 通販・全期間合計
                    $web_ratio_cutting_ave = (float)$web_ratio_cutting_ave + (float)$web_ratio_cutting;
            }
            //$web_ratio_cutting_html .= "<div class='title7 ta_r'>" . $web_ratio_cutting . "</div>";
            if($web_ratio_cutting < 0){
                $web_ratio_cutting_html .= "<div class='title7 ta_r fc_blue'>" . $web_ratio_cutting . "</div>";
            } else {
                $web_ratio_cutting_html .= "<div class='title7 ta_r fc_red'>" . $web_ratio_cutting . "</div>";
            }
    
        $i++;
    }
    // 通販・全期間合計の平均
        $web_ratio_cutting_ave = number_format((float)$web_ratio_cutting_ave / $i, 2);
    
    // 粗利率の過去比(トータル値追加)
        //$web_ratio_cutting_ave_html = "<div class='title7 ta_r'>" . (float)$web_ratio_cutting_ave . "</div>";
        if($web_ratio_cutting_ave < 0){
            $web_ratio_cutting_ave_html = "<div class='title7 ta_r fc_blue'>" . $web_ratio_cutting_ave . "</div>";
        } else {
            $web_ratio_cutting_ave_html = "<div class='title7 ta_r fc_red'>" . $web_ratio_cutting_ave . "</div>";
        }
    
        $web_ratio_cutting_html = $web_ratio_cutting_html . $web_ratio_cutting_ave_html;


    // 通販用粗利率を取得
        if($web_total <> 0 && $all_total <> 0 && $web_total <> "" && $all_total <> ""){
            $web_total_ratio = number_format((floor(((float)$web_total / (float)$all_total) * 100 * 10)) / 10 ,1);
        } else {
            $web_total_ratio = "---";
        }


        

        $web_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $web_total_ratio . "%</div></div>";

// 現在・店舗・粗利率

    $i = 0;
    $shop_ratio = "";
    $shop_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>粗利率(店舗)</div>";
    $shop_total = "";
    $shop_total_js = "";
    $all_total = "";
    $shop_total_ratio = "";
    $shop_ratio_cutting = "";
    $shop_ratio_cutting_ave = "";
    $shop_ratio_cutting_html = "";
    foreach($temp1_shop_manthly_array3 as $var){
        if($var == 0){
            $shop_ratio = "---";
            $shop_total = $shop_total;
            if($temp1_shop_manthly_array[$i] == 0){
                $all_total = $all_total;
            } else {
                $all_total = (int)$all_total + (int)$temp1_shop_manthly_array[$i];
            }
        } else {
            $shop_ratio = number_format((floor(($var / $temp1_shop_manthly_array[$i]) * 100 * 10)) / 10 ,1);
            $shop_total = (int)$shop_total + (int)$var;
            if($temp1_shop_manthly_array[$i] == 0){
                $all_total = $all_total;
            } else {
                $all_total = (int)$all_total + (int)$temp1_shop_manthly_array[$i];
            }
        }
        $shop_total_js  .= (float)$shop_ratio . ", ";
        $shop_sum_arari_per .= "<div class='title6 ta_r'>" . $shop_ratio . "%</div>";

        // 粗利率の過去比
            if($shop_ratio <> "" && $shop_ratio <> "---" && ${"past_shop_ratio_" .$i} <> "" && ${"past_shop_ratio_" .$i} <> "---"){
                $shop_ratio_cutting = (float)$shop_ratio - (float)${"past_shop_ratio_" .$i};
                $shop_ratio_cutting = number_format($shop_ratio_cutting, 1);
                // 店舗・全期間合計
                    $shop_ratio_cutting_ave = (float)$shop_ratio_cutting_ave + (float)$shop_ratio_cutting;
                
            }
            //$shop_ratio_cutting_html .= "<div class='title7 ta_r'>" . $shop_ratio_cutting . "</div>";
            if($shop_ratio_cutting < 0){
                $shop_ratio_cutting_html .= "<div class='title7 ta_r fc_blue'>" . $shop_ratio_cutting . "</div>";
            } else {
                $shop_ratio_cutting_html .= "<div class='title7 ta_r fc_red'>" . $shop_ratio_cutting . "</div>";
            }
    
        $i++;
    }
    // 店舗・全期間合計の平均
        $shop_ratio_cutting_ave = number_format((float)$shop_ratio_cutting_ave / $i, 2);
    // 粗利率の過去比(トータル値追加)
        //$shop_ratio_cutting_ave_html = "<div class='title7 ta_r'>" . (float)$shop_ratio_cutting_ave . "</div>";
        if($shop_ratio_cutting_ave < 0){
            $shop_ratio_cutting_ave_html = "<div class='title7 ta_r fc_blue'>" . $shop_ratio_cutting_ave . "</div>";
        } else {
            $shop_ratio_cutting_ave_html = "<div class='title7 ta_r fc_red'>" . $shop_ratio_cutting_ave . "</div>";
        }
        $shop_ratio_cutting_html = $shop_ratio_cutting_html . $shop_ratio_cutting_ave_html;
        
    // 現在・店舗用粗利率を取得
        if($shop_total <> 0 && $all_total <> 0 && $shop_total <> "" && $all_total <> ""){
            $shop_total_ratio = number_format((floor(((float)$shop_total / (float)$all_total) * 100 * 10)) / 10 ,1);
        } else {
            $shop_total_ratio = "---";
        }

        $shop_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $shop_total_ratio . "%</div></div>";


// 現在・卸・粗利率
    $oroshi_total_js = "";
    $oroshi_ratio_cutting = "";
    $oroshi_ratio_cutting_ave = "";
    $oroshi_ratio_cutting_html = "";
    if($out1_c == "ON"){

		    $i = 0;
		    $oroshi_ratio = "";
		    $oroshi_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>粗利率(卸)</div>";
		    $oroshi_total = "";
		    $all_total = "";
		    $oroshi_total_ratio = "";
		    foreach($temp1_oroshi_manthly_array3 as $var){
		        if($var == 0){
		            $oroshi_ratio = "---";
		            $oroshi_total = $oroshi_total;
		            if($temp1_oroshi_manthly_array[$i] == 0){
		                $all_total = $all_total;
		            } else {
		                $all_total = (int)$all_total + (int)$temp1_oroshi_manthly_array[$i];
		            }
		        } else {
		            $oroshi_ratio = number_format((floor(($var / $temp1_oroshi_manthly_array[$i]) * 100 * 10)) / 10 ,1);
		            $oroshi_total = (int)$oroshi_total + (int)$var;
		            if($temp1_oroshi_manthly_array[$i] == 0){
		                $all_total = $all_total;
		            } else {
		                $all_total = (int)$all_total + (int)$temp1_oroshi_manthly_array[$i];
		            }
		        }
                $oroshi_total_js  .= (float)$oroshi_ratio . ", ";
		        $oroshi_sum_arari_per .= "<div class='title6 ta_r'>" . $oroshi_ratio . "%</div>";

                // 粗利率の過去比
                    if($oroshi_ratio <> "" && $oroshi_ratio <> "---" && ${"past_oroshi_ratio_" .$i} <> "" && ${"past_oroshi_ratio_" .$i} <> "---"){
                        $oroshi_ratio_cutting = (float)$oroshi_ratio - (float)${"past_oroshi_ratio_" .$i};
                        $oroshi_ratio_cutting = number_format($oroshi_ratio_cutting, 1);
                        // 卸・全期間合計
                            $oroshi_ratio_cutting_ave = (float)$oroshi_ratio_cutting_ave + (float)$oroshi_ratio_cutting;
                    }
                    //$oroshi_ratio_cutting_html .= "<div class='title7 ta_r'>" . $oroshi_ratio_cutting . "</div>";
                    if($oroshi_ratio_cutting < 0){
                        $oroshi_ratio_cutting_html .= "<div class='title7 ta_r fc_blue'>" . $oroshi_ratio_cutting . "</div>";
                    } else {
                        $oroshi_ratio_cutting_html .= "<div class='title7 ta_r fc_red'>" . $oroshi_ratio_cutting . "</div>";
                    }
            
                $i++;
            }
            // 卸・全期間合計の平均
                $oroshi_ratio_cutting_ave = number_format((float)$oroshi_ratio_cutting_ave / $i, 2);
            // 粗利率の過去比(トータル値追加)
                //$oroshi_ratio_cutting_ave_html = "<div class='title7 ta_r'>" . (float)$oroshi_ratio_cutting_ave . "</div>";
                if($oroshi_ratio_cutting_ave < 0){
                    $oroshi_ratio_cutting_ave_html = "<div class='title7 ta_r fc_blue'>" . $oroshi_ratio_cutting_ave . "</div>";
                } else {
                    $oroshi_ratio_cutting_ave_html = "<div class='title7 ta_r fc_red'>" . $oroshi_ratio_cutting_ave . "</div>";
                }

                $oroshi_ratio_cutting_html = $oroshi_ratio_cutting_html . $oroshi_ratio_cutting_ave_html;
		    // 現在・卸用粗利率を取得
                if($oroshi_total == 0 || $oroshi_total == "" || $all_total == 0 || $all_total == ""){
                    $oroshi_total_ratio = "---";
                } else {
		            $oroshi_total_ratio = number_format((floor(((float)$oroshi_total / (float)$all_total) * 100 * 10)) / 10 ,1);
                }

		        $oroshi_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $oroshi_total_ratio . "%</div></div>";
    }



// 現在・金額構成比

    $i = 0;
    $total = "";
    $total2 = 0;
    $web_per = "";
    $shop_per = "";
    $oroshi_per = "";
    $web_total = "";
    $shop_total = "";
    $oroshi_total = "";
    $web_per_html = "";
    $shop_per_html = "";
    $oroshi_per_html = "";
    $web_total_js2 = "";
    $shop_total_js2 = "";
    $oroshi_total_js2 = "";
    foreach($temp1_web_manthly_array as $var){
        //echo $temp1_shop_manthly_array[$i] . "<br>";
        if($out1_c == "ON"){
            $total = (int)$var + (int)$temp1_shop_manthly_array[$i] + (int)$temp1_oroshi_manthly_array[$i];
        } else {
            $total = (int)$var + (int)$temp1_shop_manthly_array[$i];
        }
        $total2 = (int)$total2 + (int)$total;
        $web_total = (int)$web_total + (int)$var;
        $shop_total = (int)$shop_total + (int)$temp1_shop_manthly_array[$i];
        if($out1_c == "ON"){ $oroshi_total = (int)$oroshi_total + (int)$temp1_oroshi_manthly_array[$i]; }
        if($var == 0){
            $web_per = "---";
            if($temp1_shop_manthly_array[$i] == 0){
                $shop_per = "---";
            } else {
                if($out1_c == "ON"){ 
                    if($temp1_shop_manthly_array[$i] <> 0 && $total <> 0 && $temp1_shop_manthly_array[$i] <> "" && $total <> ""){
                        $shop_per = number_format((floor(($temp1_shop_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
                    } else {
                        $shop_per = "---"; 
                    }
                } else {
                    //$shop_per = 100 - $web_per;
                    $shop_per = number_format(bcsub('100', ((float)$web_per), 1) ,1);
                }
            }
            if($out1_c == "ON"){
                if($temp1_oroshi_manthly_array[$i] == 0){
                    $oroshi_per = "---";
                } else {
                    //$oroshi_per = 100 - $web_per - $shop_per;
                    $oroshi_per = number_format(bcsub('100', ($web_per + $shop_per), 1) ,1);
                }
            }
        } else {
            $web_per = number_format((floor(($var / $total) * 100 * 10)) / 10 ,1);
            if($temp1_shop_manthly_array[$i] == 0){
                $shop_per = "---";
            } else {
                if($out1_c == "ON"){ $shop_per = number_format((floor(($temp1_shop_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); } else {$shop_per = 100 - $web_per;}
            }
            if($out1_c == "ON"){
                if($temp1_oroshi_manthly_array[$i] == 0){
                    $oroshi_per = "---";
                } else {
                    //$oroshi_per = 100 - $web_per - $shop_per;
                    $oroshi_per = number_format(bcsub('100', ($web_per + $shop_per), 1) ,1);
                }
            }
        }
        $web_per_html .= "<div class='title7 ta_r'>" . $web_per . "%</div>";
        $shop_per_html .= "<div class='title7 ta_r'>" . $shop_per . "%</div>";
        $web_total_js2  .= (float)$web_per . ", ";
        $shop_total_js2  .= (float)$shop_per . ", ";
        if($out1_c == "ON"){
            $oroshi_per_html .= "<div class='title7 ta_r'>" . $oroshi_per . "%</div>";
            $oroshi_total_js2  .= (float)$oroshi_per . ", ";
        }
        //echo $web_per . "(" . $shop_per . ")<br>";

        $i++;
    }
    // 期間中の売上合計に対するパーセンテージを取得
       // $web_total_per = $web_total / $i;
        if($web_total <> 0 && $total2 <> 0 && $web_total <> "" && $total2 <> ""){
            $web_total_per = number_format((floor(((float)$web_total / (float)$total2) * 100 * 10)) / 10 ,1);
        } else {
            $web_total_per = "---";
        }
        if($shop_total <> 0 && $total2 <> 0 && $shop_total <> "" && $total2 <> ""){
            $shop_total_per = number_format((floor(((float)$shop_total / (float)$total2) * 100 * 10)) / 10 ,1);
        } else {
            $shop_total_per = "---";
        }
        //if($out1_c == "ON"){ $oroshi_total_per = 100 - ((float)$web_total_per + (float)$shop_total_per); }
        if($out1_c == "ON"){ $oroshi_total_per = number_format(bcsub('100', ((float)$web_total_per + (float)$shop_total_per), 1), 1);}

        $web_per_html .= "<div class='title7 ta_r'>" . $web_total_per . "%</div>";
        $shop_per_html .= "<div class='title7 ta_r'>" . $shop_total_per . "%</div>";
        if($out1_c == "ON"){ $oroshi_per_html .= "<div class='title7 ta_r'>" . $oroshi_total_per. "%</div>";}


    $temp1_all_sorce4 = "<p class='title_a'>金額・構成比</p><div class='box1'>" . $temp1_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>店舗    </div>" . $shop_per_html . "</div>";
    $temp1_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>通販</div>" . $web_per_html . "</div>";
    if($out1_c == "ON"){$temp1_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>卸</div>" . $oroshi_per_html . "</div>";}
    $temp1_all_sorce4 .= "</div>";




    // 現在・点数構成比

    $i = 0;
    $total = "";
    $total2 = 0;
    $web_per = "";
    $shop_per = "";
    $oroshi_per = "";
    $web_total = "";
    $shop_total = "";
    $oroshi_total = "";
    $web_per_html = "";
    $shop_per_html = "";
    $oroshi_per_html = "";
    $web_total_js3 = "";
    $shop_total_js3 = "";
    $oroshi_total_js3 = "";
    foreach($temp1_web_manthly_array2 as $var){
        //echo $temp1_shop_manthly_array2[$i] . "<br>";
        if($out1_c == "ON"){
            $total = (int)$var + (int)$temp1_shop_manthly_array2[$i] + (int)$temp1_oroshi_manthly_array2[$i];
        } else {
            $total = (int)$var + (int)$temp1_shop_manthly_array2[$i];
        }
        $total2 = (int)$total2 + (int)$total;
        $web_total = (int)$web_total + (int)$var;
        $shop_total = (int)$shop_total + (int)$temp1_shop_manthly_array2[$i];
        if($out1_c == "ON"){ $oroshi_total = (int)$oroshi_total + (int)$temp1_oroshi_manthly_array2[$i]; }
        if($var == 0){
            $web_per = "---";
            if($temp1_shop_manthly_array2[$i] == 0){
                $shop_per = "---";
            } else {
                if($out1_c == "ON"){ 
                    if($temp1_shop_manthly_array2[$i] <> 0 && $total <> 0 && $temp1_shop_manthly_array2[$i] <> "" && $total <> ""){
                        $shop_per = number_format((floor(($temp1_shop_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
                    } else {
                        $shop_per = "---"; 
                    }
                } else {
                    //$shop_per = 100 - $web_per;
                    $shop_per = number_format(bcsub('100', ((float)$web_per), 1) ,1);
            }
            }
            if($out1_c == "ON"){
                if($temp1_oroshi_manthly_array2[$i] == 0){
                    $oroshi_per = "---";
                } else {
                    //$oroshi_per = 100 - $web_per - $shop_per;
                    $oroshi_per = number_format(bcsub('100', ($web_per + $shop_per), 1) ,1);
                }
            }
        } else {
            $web_per = number_format((floor(($var / $total) * 100 * 10)) / 10 ,1);
            if($temp1_shop_manthly_array2[$i] == 0){
                $shop_per = "---";
            } else {
                if($out1_c == "ON"){ $shop_per = number_format((floor(($temp1_shop_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); } else {$shop_per = number_format(100 - $web_per ,1);}
            }
            if($out1_c == "ON"){
                if($temp1_oroshi_manthly_array2[$i] == 0){
                    $oroshi_per = "---";
                } else {
                    //$oroshi_per = 100 - $web_per - $shop_per;
                    $oroshi_per = number_format(bcsub('100', ($web_per + $shop_per), 1) ,1);
                }
            }
        }
        $web_per_html .= "<div class='title7 ta_r'>" . $web_per . "%</div>";
        $shop_per_html .= "<div class='title7 ta_r'>" . $shop_per . "%</div>";
        $web_total_js3  .= (float)$web_per . ", ";
        $shop_total_js3  .= (float)$shop_per . ", ";
        if($out1_c == "ON"){
            $oroshi_per_html .= "<div class='title7 ta_r'>" . $oroshi_per . "%</div>";
            $oroshi_total_js3  .= (float)$oroshi_per . ", ";
        }
        //echo $web_per . "(" . $shop_per . ")<br>";

        $i++;
    }
    // 期間中の売上合計点数に対するパーセンテージを取得
       // $web_total_per = $web_total / $i;
        if($web_total <> 0 && $total2 <> 0 && $web_total <> "" && $total2 <> ""){
            $web_total_per = number_format((floor(((float)$web_total / (float)$total2) * 100 * 10)) / 10 ,1);
        } else {
            $web_total_per = "---";
        }
        if($shop_total <> 0 && $total2 <> 0 && $shop_total <> "" && $total2 <> ""){
            $shop_total_per = number_format((floor(((float)$shop_total / (float)$total2) * 100 * 10)) / 10 ,1);
        } else {
            $shop_total_per = "---";
        }
        //if($out1_c == "ON"){ $oroshi_total_per = 100 - $web_total_per - $shop_total_per; }
        if($out1_c == "ON"){ $oroshi_total_per = number_format(bcsub('100', ((float)$web_total_per + (float)$shop_total_per), 1) ,1);}


        $web_per_html .= "<div class='title7 ta_r'>" . $web_total_per . "%</div>";
        $shop_per_html .= "<div class='title7 ta_r'>" . $shop_total_per . "%</div>";
        if($out1_c == "ON"){ $oroshi_per_html .= "<div class='title7 ta_r'>" . $oroshi_total_per . "%</div>";}


    $temp1_all_sorce5 = "<p class='title_a'>点数・構成比</p><div class='box1'>" . $temp1_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>店舗</div>" . $shop_per_html . "</div>";
    $temp1_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>通販</div>" . $web_per_html . "</div>";
    if($out1_c == "ON"){$temp1_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>卸</div>" . $oroshi_per_html . "</div>";}
    $temp1_all_sorce5 .= "</div>";



// 現在・平均単価

    $i = 0;
    $web_average = "";
    $web_ave_html = "";
    $web_total = "";
    $web_total2 = "";
    $web_total_ave = "";
    foreach($temp1_web_manthly_array as $var){

        if($var == 0){
            $web_average = 0;
            $web_total = (int)$web_total + (int)$var;
            if($temp1_web_manthly_array2[$i] == 0){
                $web_total2 = $web_total2;
            } else {
                $web_total2 = (int)$web_total2 + (int)$temp1_web_manthly_array2[$i];
            }
        } else {
            $web_average = (floor(((int)$var / (int)$temp1_web_manthly_array2[$i])) * 10) / 10;
            $web_total = (int)$web_total + (int)$var;
            if($temp1_web_manthly_array2[$i] == 0){
                $web_total2 = $web_total2;
            } else {
                $web_total2 = (int)$web_total2 + (int)$temp1_web_manthly_array2[$i];
            }
        }
        if($web_average <> 0 && $web_average <> ""){$web_average = number_format((int)$web_average);}
        $web_ave_html .= "<div class='title7 ta_r'>" . $web_average . "</div>";

        $i++;
    }
    // 期間中の売上合計に対する平均単価を取得
        if($web_total <> 0 && $web_total2 <> 0 && $web_total <> "" && $web_total2 <> ""){
            $web_total_ave = (floor(((int)$web_total / (int)$web_total2) * 10)) / 10;
        } else {
            $web_total_ave = "---";
        }
        if($web_total_ave <> 0 && $web_total_ave <> ""){$web_total_ave = number_format((int)$web_total_ave);}
        $web_ave_html .= "<div class='title7 ta_r'>" . $web_total_ave . "</div>";

    $i = 0;
    $shop_average = "";
    $shop_ave_html = "";
    $shop_total = "";
    $shop_total2 = "";
    $shop_total_ave = "";
    foreach($temp1_shop_manthly_array as $var){

        if($var == 0){
            $shop_average = 0;
            $shop_total = (int)$shop_total + (int)$var;
            if($temp1_shop_manthly_array2[$i] == 0){
                $shop_total2 = $shop_total2;
            } else {
                $shop_total2 = (int)$shop_total2 + (int)$temp1_shop_manthly_array2[$i];
            }
        } else {
            $shop_average = (floor(((int)$var / (int)$temp1_shop_manthly_array2[$i])) * 10) / 10;
            $shop_total = (int)$shop_total + (int)$var;
            if($temp1_shop_manthly_array2[$i] == 0){
                $shop_total2 = $shop_total2;
            } else {
                $shop_total2 = (int)$shop_total2 + (int)$temp1_shop_manthly_array2[$i];
            }
        }
        if($shop_average <> 0 && $shop_average <> ""){$shop_average = number_format((int)$shop_average);}
        $shop_ave_html .= "<div class='title7 ta_r'>" . $shop_average . "</div>";

        $i++;
    }
    // 期間中の売上合計に対する平均単価を取得
        if($shop_total <> 0 && $shop_total2 <> 0 && $shop_total <> "" && $shop_total2 <> ""){
            $shop_total_ave = (floor(((int)$shop_total / (int)$shop_total2) * 10)) / 10;
        } else {
            "---";
        }
        if($shop_total_ave <> 0 && $shop_total_ave <> ""){$shop_total_ave = number_format((int)$shop_total_ave);}
        $shop_ave_html .= "<div class='title7 ta_r'>" . $shop_total_ave . "</div>";


        if($out1_c == "ON"){    
            $i = 0;
            $oroshi_average = "";
            $oroshi_ave_html = "";
            $oroshi_total = "";
            $oroshi_total2 = "";
            $oroshi_total_ave = "";
            foreach($temp1_oroshi_manthly_array as $var){

                if($var == 0){
                    $oroshi_average = 0;
                    $oroshi_total = (int)$oroshi_total + (int)$var;
                    if($temp1_oroshi_manthly_array2[$i] == 0){
                        $oroshi_total2 = $oroshi_total2;
                    } else {
                        $oroshi_total2 = (int)$oroshi_total2 + (int)$temp1_oroshi_manthly_array2[$i];
                    }
                } else {
                    $oroshi_average = (floor(((int)$var / (int)$temp1_oroshi_manthly_array2[$i])) * 10) / 10;
                    $oroshi_total = (int)$oroshi_total + (int)$var;
                    if($temp1_oroshi_manthly_array2[$i] == 0){
                        $oroshi_total2 = $oroshi_total2;
                    } else {
                        $oroshi_total2 = (int)$oroshi_total2 + (int)$temp1_oroshi_manthly_array2[$i];
                    }
                }
                if($oroshi_average <> 0 && $oroshi_average <> ""){$oroshi_average = number_format((int)$oroshi_average);}
                $oroshi_ave_html .= "<div class='title7 ta_r'>" . $oroshi_average . "</div>";

                $i++;
            }
            // 期間中の売上合計に対する平均単価を取得
                if($oroshi_total == 0 || $oroshi_total2 == 0 || $oroshi_total == "" || $oroshi_total2 == ""){
                    $oroshi_total_ave = "---";
                } else {
                    $oroshi_total_ave = (floor(((int)$oroshi_total / (int)$oroshi_total2) * 10)) / 10;
                }
                if($oroshi_total_ave <> 0 && $oroshi_total_ave <> ""){$oroshi_total_ave = number_format((int)$oroshi_total_ave);}
                $oroshi_ave_html .= "<div class='title7 ta_r'>" . $oroshi_total_ave . "</div>";
        }


    $temp1_all_sorce6 = "<p class='title_a'>平均単価</p><div class='box1'>" . $temp1_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>店舗</div>" . $shop_ave_html . "</div>";
    $temp1_all_sorce6 .= "<div class='wid100 ul4'><div class='title7 ta_c'>通販</div>" . $web_ave_html . "</div>";
    if($out1_c == "ON"){$temp1_all_sorce6 .= "<div class='wid100 ul4'><div class='title7 ta_c'>卸</div>" . $oroshi_ave_html . "</div>";}
    $temp1_all_sorce6 .= "</div>";


// 通販・金額・過去比

    $i = 0;
    $web_ratio = "";
    $web_ratio_html = "";
    $web_total = "";
    $web_total_past = "";
    $web_total_ratio = "";
    foreach($temp1_web_manthly_array as $var){
        if($var == 0){
            $web_ratio = "---";
            $web_total = $web_total;
            if($past_temp1_web_manthly_array[$i] == 0){
                $web_total_past = $web_total_past;
            } else {
                $web_total_past = (int)$web_total_past + (int)$past_temp1_web_manthly_array[$i];
            }
        } else {
            if($var == 0 || $past_temp1_web_manthly_array[$i] == 0 || $var == "" || $past_temp1_web_manthly_array[$i] == ""){
                $web_ratio = "---";
            } else { 
                $web_ratio = number_format((floor(($var / $past_temp1_web_manthly_array[$i]) * 100 * 10)) / 10 ,1);
            }
            $web_total = (int)$web_total + (int)$var;
            if($past_temp1_web_manthly_array[$i] == 0){
                $web_total_past = $web_total_past;
            } else {
                $web_total_past = (int)$web_total_past + (int)$past_temp1_web_manthly_array[$i];
            }
        }
        if($web_ratio < 100){
            $web_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $web_ratio . "%</div>";
        } else {
            $web_ratio_html .= "<div class='title7 ta_r fc_red'>" . $web_ratio . "%</div>";
        }

        $i++;
    }
    // 過去の同期間売上金額に対する比率を取得
        if($web_total <> 0 && $web_total_past <> 0 && $web_total <> "" && $web_total_past <> ""){
            $web_total_ratio = number_format((floor(((float)$web_total / (float)$web_total_past) * 100 * 10)) / 10 ,1);
        } else {
            $web_total_ratio = "---";
        }

        if($web_total_ratio < 100){
            $web_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $web_total_ratio . "%</div>";
        } else {
            $web_ratio_html .= "<div class='title7 ta_r fc_red'>" . $web_total_ratio . "%</div>";
        }


// 店舗・金額・過去比

    $i = 0;
    $shop_ratio = "";
    $shop_ratio_html = "";
    $shop_total = "";
    $shop_total_past = "";
    $shop_total_ratio = "";
    foreach($temp1_shop_manthly_array as $var){
        if($var == 0){
            $shop_ratio = "---";
            $shop_total = $shop_total;
            if($past_temp1_shop_manthly_array[$i] == 0){
                $shop_total_past = $shop_total_past;
            } else {
                $shop_total_past = (int)$shop_total_past + (int)$past_temp1_shop_manthly_array[$i];
            }
        } else {
            if($var == 0 || $past_temp1_shop_manthly_array[$i] == 0 || $var == "" || $past_temp1_shop_manthly_array[$i] == ""){
                $shop_ratio = "---";
            } else {
                $shop_ratio = number_format((floor(($var / $past_temp1_shop_manthly_array[$i]) * 100 * 10)) / 10 ,1);
            }
            $shop_total = (int)$shop_total + (int)$var;
            if($past_temp1_shop_manthly_array[$i] == 0){
                $shop_total_past = $shop_total_past;
            } else {
                $shop_total_past = (int)$shop_total_past + (int)$past_temp1_shop_manthly_array[$i];
            }
        }
        if($shop_ratio < 100){
            $shop_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $shop_ratio . "%</div>";
        } else {
            $shop_ratio_html .= "<div class='title7 ta_r fc_red'>" . $shop_ratio . "%</div>";
        }
        

        $i++;
    }
    // 過去の同期間売上金額に対する比率を取得
        if($web_total <> 0 && $web_total_past <> 0 && $web_total <> "" && $web_total_past <> ""){
            $shop_total_ratio = number_format((floor(((float)$shop_total / (float)$shop_total_past) * 100 * 10)) / 10 ,1);
        } else {
            $shop_total_ratio = "---";
        }

        if($shop_total_ratio < 100){
            $shop_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $shop_total_ratio . "%</div>";
        } else {
            $shop_ratio_html .= "<div class='title7 ta_r fc_red'>" . $shop_total_ratio . "%</div>";
        }
        
    if($out1_c == "ON"){
        // 卸・金額・過去比
            $i = 0;
            $oroshi_ratio = "";
            $oroshi_ratio_html = "";
            $oroshi_total = "";
            $oroshi_total_past = "";
            $oroshi_total_ratio = "";
            foreach($temp1_oroshi_manthly_array as $var){
                if($var == 0){
                    $oroshi_ratio = "---";
                    $oroshi_total = $oroshi_total;
                    if($past_temp1_oroshi_manthly_array[$i] == 0){
                        $oroshi_total_past = $oroshi_total_past;
                    } else {
                        $oroshi_total_past = (int)$oroshi_total_past + (int)$past_temp1_oroshi_manthly_array[$i];
                    }
                } else {
                    if($var == 0 || $past_temp1_oroshi_manthly_array[$i] == 0 || $var == "" || $past_temp1_oroshi_manthly_array[$i] == ""){
                        $oroshi_ratio = "---";
                    } else {
                        $oroshi_ratio = number_format((floor(($var / $past_temp1_oroshi_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                    }
                    $oroshi_total = (int)$oroshi_total + (int)$var;
                    if($past_temp1_oroshi_manthly_array[$i] == 0){
                        $oroshi_total_past = $oroshi_total_past;
                    } else {
                        $oroshi_total_past = (int)$oroshi_total_past + (int)$past_temp1_oroshi_manthly_array[$i];
                    }
                }

                if($oroshi_ratio < 100){
                    $oroshi_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $oroshi_ratio . "%</div>";
                } else {
                    $oroshi_ratio_html .= "<div class='title7 ta_r fc_red'>" . $oroshi_ratio . "%</div>";
                }
        
                $i++;
            }
            // 過去の同期間売上金額に対する比率を取得
                if($oroshi_total == 0 || $oroshi_total_past == 0 || $oroshi_total == "" || $oroshi_total_past == ""){
                    $oroshi_total_ratio = "---";
                } else {
                    $oroshi_total_ratio = number_format((floor(((int)$oroshi_total / (int)$oroshi_total_past) * 100 * 10)) / 10 ,1);
                }

                if($oroshi_total_ratio < 100){
                    $oroshi_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $oroshi_total_ratio . "%</div>";
                } else {
                    $oroshi_ratio_html .= "<div class='title7 ta_r fc_red'>" . $oroshi_total_ratio . "%</div>";
                }
                
    }


// 通販・店舗・卸合計・金額・過去比

    $i = 0;
    $ratio = "";
    $ratio_html = "";
    $total = "";
    $total_past = "";
    $total_ratio = "";
    foreach($temp1_web_manthly_array as $var){
        if($var == 0 && $temp1_shop_manthly_array[$i] == 0/* && $temp1_oroshi_manthly_array[$i] == 0*/){
            $ratio = 0;
            $total = $total;
            if($past_temp1_web_manthly_array[$i] == 0 && $past_temp1_shop_manthly_array[$i] == 0/* && $past_temp1_oroshi_manthly_array[$i] == 0*/){
                $total_past = $total_past;
            } else {
                if($out1_c == "ON"){
                    $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array[$i] + (int)$past_temp1_shop_manthly_array[$i] + (int)$past_temp1_oroshi_manthly_array[$i];
                } else {
                    $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array[$i] + (int)$past_temp1_shop_manthly_array[$i];
                }
            }
        } else {
            if($out1_c == "ON"){
                if((int)$var + (int)$temp1_shop_manthly_array[$i] + (int)$temp1_oroshi_manthly_array[$i] == 0 || (int)$past_temp1_web_manthly_array[$i] + (int)$past_temp1_shop_manthly_array[$i] + (int)$past_temp1_oroshi_manthly_array[$i] == 0){
                    $ratio = "---";
                } else {
                    $ratio = number_format((floor((((int)$var + (int)$temp1_shop_manthly_array[$i] + (int)$temp1_oroshi_manthly_array[$i]) / ((int)$past_temp1_web_manthly_array[$i] + (int)$past_temp1_shop_manthly_array[$i] + (int)$past_temp1_oroshi_manthly_array[$i])) * 100 * 10)) / 10 ,1);
                }
                $total = (int)$total + (int)$var + (int)$temp1_shop_manthly_array[$i] + (int)$temp1_oroshi_manthly_array[$i];
            } else {
                if((int)$var + (int)$temp1_shop_manthly_array[$i] == 0 || (int)$past_temp1_web_manthly_array[$i] + (int)$past_temp1_shop_manthly_array[$i] == 0){
                    $ratio = "---";
                } else {
                    $ratio = number_format((floor((((int)$var + (int)$temp1_shop_manthly_array[$i]) / ((int)$past_temp1_web_manthly_array[$i] + (int)$past_temp1_shop_manthly_array[$i])) * 100 * 10)) / 10 ,1);
                }
                $total = (int)$total + (int)$var + (int)$temp1_shop_manthly_array[$i];
            }
            if($out1_c == "ON"){
                if($past_temp1_web_manthly_array[$i] == 0 && $past_temp1_shop_manthly_array[$i] == 0 && $past_temp1_oroshi_manthly_array[$i] == 0){
                    $total_past = $total_past;
                } else {
                    $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array[$i] + (int)$past_temp1_shop_manthly_array[$i] + (int)$past_temp1_oroshi_manthly_array[$i];
                }
            } else {
                if($past_temp1_web_manthly_array[$i] == 0 && $past_temp1_shop_manthly_array[$i] == 0){
                    $total_past = $total_past;
                } else {
                    $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array[$i] + (int)$past_temp1_shop_manthly_array[$i];
                }
            }
        }
        //$ratio_html .= "<div class='title7 ta_r'>" . $ratio . "%</div>";

        if($ratio < 100){
            $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ratio . "%</div>";
        } else {
            $ratio_html .= "<div class='title7 ta_r fc_red'>" . $ratio . "%</div>";
        }

        $i++;
    }
    // 過去の同期間売上金額に対する比率を取得
        if($total <> 0 && $total_past <> 0 && $total <> "" && $total_past <> ""){
            $total_ratio = number_format((floor(((float)$total / (float)$total_past) * 100 * 10)) / 10 ,1);
        } else {
            $total_ratio = "---";
        }

        //$ratio_html .= "<div class='title7 ta_r bg_grey'>" . $total_ratio . "%</div>";

        if($total_ratio < 100){
            $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $total_ratio . "%</div>";
        } else {
            $ratio_html .= "<div class='title7 ta_r fc_red'>" . $total_ratio . "%</div>";
        }


    $temp1_all_sorce7 = "<p class='title_a'>金額・過去比</p><div class='box1'>" . $temp1_title5 . "<div class='wid100 ul4'><div class='title7 ta_c'>店舗</div>" . $shop_ratio_html . "</div>";
    $temp1_all_sorce7 .= "<div class='wid100 ul4'><div class='title7 ta_c'>通販</div>" . $web_ratio_html . "</div>";
    if($out1_c == "ON"){$temp1_all_sorce7 .= "<div class='wid100 ul4'><div class='title7 ta_c'>卸</div>" . $oroshi_ratio_html . "</div>";}
    $temp1_all_sorce7 .= "<div class='wid100 ul4 bg_grey'><div class='title7 ta_c'>合計</div>" . $ratio_html . "</div></div>";


// 通販・点数・過去比

    $i = 0;
    $web_ratio = "";
    $web_ratio_html = "";
    $web_total = "";
    $web_total_past = "";
    $web_total_ratio = "";
    foreach($temp1_web_manthly_array2 as $var){
        if($var == 0){
            $web_ratio = "---";
            $web_total = $web_total;
            if($past_temp1_web_manthly_array2[$i] == 0){
                $web_total_past = $web_total_past;
            } else {
                $web_total_past = (int)$web_total_past + (int)$past_temp1_web_manthly_array2[$i];
            }
        } else {
            if($var == 0 || $past_temp1_web_manthly_array2[$i] == 0 || $var == "" || $past_temp1_web_manthly_array2[$i] == ""){
                $web_ratio = "---";
            } else {
                $web_ratio = number_format((floor(($var / $past_temp1_web_manthly_array2[$i]) * 100 * 10)) / 10 ,1);
            }
            $web_total = (int)$web_total + (int)$var;
            if($past_temp1_web_manthly_array2[$i] == 0){
                $web_total_past = $web_total_past;
            } else {
                $web_total_past = (int)$web_total_past + (int)$past_temp1_web_manthly_array2[$i];
            }
        }
        //$web_ratio_html .= "<div class='title7 ta_r'>" . $web_ratio . "%</div>";

        if($web_ratio < 100){
            $web_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $web_ratio . "%</div>";
        } else {
            $web_ratio_html .= "<div class='title7 ta_r fc_red'>" . $web_ratio . "%</div>";
        }

        $i++;
    }
    // 過去の同期間売上点数に対する比率を取得
        if($web_total <> 0 && $web_total_past <> 0 && $web_total <> "" && $web_total_past <> ""){
            $web_total_ratio = number_format((floor(((float)$web_total / (float)$web_total_past) * 100 * 10)) / 10 ,1);
        } else {
            $web_total_ratio = "---";
        }

        //$web_ratio_html .= "<div class='title7 ta_r'>" . $web_total_ratio . "%</div>";

        if($web_total_ratio < 100){
            $web_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $web_total_ratio . "%</div>";
        } else {
            $web_ratio_html .= "<div class='title7 ta_r fc_red'>" . $web_total_ratio . "%</div>";
        }


// 店舗・点数・過去比

    $i = 0;
    $shop_ratio = "";
    $shop_ratio_html = "";
    $shop_total = "";
    $shop_total_past = "";
    $shop_total_ratio = "";
    foreach($temp1_shop_manthly_array2 as $var){
        if($var == 0){
            $shop_ratio = "---";
            $shop_total = $shop_total;
            if($past_temp1_shop_manthly_array2[$i] == 0){
                $shop_total_past = $shop_total_past;
            } else {
                $shop_total_past = (int)$shop_total_past + (int)$past_temp1_shop_manthly_array2[$i];
            }
        } else {
            if($var == 0 || $past_temp1_shop_manthly_array2[$i] == 0 || $var == "" || $past_temp1_shop_manthly_array2[$i] == ""){
                $shop_ratio = "---";
            } else {
                $shop_ratio = number_format((floor(($var / $past_temp1_shop_manthly_array2[$i]) * 100 * 10)) / 10 ,1);
            }
            $shop_total = (int)$shop_total + (int)$var;
            if($past_temp1_shop_manthly_array2[$i] == 0){
                $shop_total_past = $shop_total_past;
            } else {
                $shop_total_past = (int)$shop_total_past + (int)$past_temp1_shop_manthly_array2[$i];
            }
        }
        //$shop_ratio_html .= "<div class='title7 ta_r'>" . $shop_ratio . "%</div>";
        if($shop_ratio < 100){
            $shop_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $shop_ratio . "%</div>";
        } else {
            $shop_ratio_html .= "<div class='title7 ta_r fc_red'>" . $shop_ratio . "%</div>";
        }

        $i++;
    }
    // 過去の同期間売上点数に対する比率を取得
        if($shop_total <> 0 && $shop_total_past <> 0 && $shop_total <> "" && $shop_total_past <> ""){
            $shop_total_ratio = number_format((floor(((float)$shop_total / (float)$shop_total_past) * 100 * 10)) / 10 ,1);
        } else {
            $shop_total_ratio = "---";
        }

        //$shop_ratio_html .= "<div class='title7 ta_r'>" . $shop_total_ratio . "%</div>";
        if($shop_total_ratio < 100){
            $shop_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $shop_total_ratio . "%</div>";
        } else {
            $shop_ratio_html .= "<div class='title7 ta_r fc_red'>" . $shop_total_ratio . "%</div>";
        }


    if($out1_c == "ON"){
        // 卸・金額・過去比
            $i = 0;
            $oroshi_ratio = "";
            $oroshi_ratio_html = "";
            $oroshi_total = "";
            $oroshi_total_past = "";
            $oroshi_total_ratio = "";
            foreach($temp1_oroshi_manthly_array2 as $var){
                if($var == 0){
                    $oroshi_ratio = "---";
                    $oroshi_total = $oroshi_total;
                    if($past_temp1_oroshi_manthly_array2[$i] == 0){
                        $oroshi_total_past = $oroshi_total_past;
                    } else {
                        $oroshi_total_past = (int)$oroshi_total_past + (int)$past_temp1_oroshi_manthly_array2[$i];
                    }
                } else {
                    if($var == 0 || $past_temp1_oroshi_manthly_array2[$i] == 0 || $var == "" || $past_temp1_oroshi_manthly_array2[$i] == ""){
                        $oroshi_ratio = "---";
                    } else {
                        $oroshi_ratio = number_format((floor(($var / $past_temp1_oroshi_manthly_array2[$i]) * 100 * 10)) / 10 ,1);
                    }
                    $oroshi_total = (int)$oroshi_total + (int)$var;
                    if($past_temp1_oroshi_manthly_array2[$i] == 0){
                        $oroshi_total_past = $oroshi_total_past;
                    } else {
                        $oroshi_total_past = (int)$oroshi_total_past + (int)$past_temp1_oroshi_manthly_array2[$i];
                    }
                }
                //$oroshi_ratio_html .= "<div class='title7 ta_r'>" . $oroshi_ratio . "%</div>";
                if($oroshi_ratio < 100){
                    $oroshi_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $oroshi_ratio . "%</div>";
                } else {
                    $oroshi_ratio_html .= "<div class='title7 ta_r fc_red'>" . $oroshi_ratio . "%</div>";
                }
        
                $i++;
            }
            // 過去の同期間売上金額に対する比率を取得
                if($oroshi_total == 0 || $oroshi_total_past == 0 || $oroshi_total == "" || $oroshi_total_past == ""){
                    $oroshi_total_ratio = "---";
                } else {
                    $oroshi_total_ratio = number_format((floor(((int)$oroshi_total / (int)$oroshi_total_past) * 100 * 10)) / 10 ,1);
                }

                //$oroshi_ratio_html .= "<div class='title7 ta_r'>" . $oroshi_total_ratio . "%</div>";
                if($oroshi_total_ratio < 100){
                    $oroshi_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $oroshi_total_ratio . "%</div>";
                } else {
                    $oroshi_ratio_html .= "<div class='title7 ta_r fc_red'>" . $oroshi_total_ratio . "%</div>";
                }
    }


// 通販・店舗・卸合計・点数・過去比

    $i = 0;
    $ratio = "";
    $ratio_html = "";
    $total = "";
    $total_past = "";
    $total_ratio = "";
    foreach($temp1_web_manthly_array2 as $var){
        if($var == 0 && $temp1_shop_manthly_array2[$i] == 0/* && $temp1_oroshi_manthly_array2[$i] == 0*/){
            $ratio = 0;
            $total = $total;
            if($past_temp1_web_manthly_array2[$i] == 0 && $past_temp1_shop_manthly_array2[$i] == 0/* && $past_temp1_oroshi_manthly_array2[$i] == 0*/){
                $total_past = $total_past;
            } else {
                if($out1_c == "ON"){
                    $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array2[$i] + (int)$past_temp1_shop_manthly_array2[$i] + (int)$past_temp1_oroshi_manthly_array2[$i];
                } else {
                    $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array2[$i] + (int)$past_temp1_shop_manthly_array2[$i];
                }
            }
        } else {
            if($out1_c == "ON"){
                if((int)$var + (int)$temp1_shop_manthly_array2[$i] + (int)$temp1_oroshi_manthly_array2[$i] == 0 || (int)$past_temp1_web_manthly_array2[$i] + (int)$past_temp1_shop_manthly_array2[$i] + (int)$past_temp1_oroshi_manthly_array2[$i] == 0){
                    $ratio = "---";
                } else {
                    $ratio = number_format((floor((((int)$var + (int)$temp1_shop_manthly_array2[$i] + (int)$temp1_oroshi_manthly_array2[$i]) / ((int)$past_temp1_web_manthly_array2[$i] + (int)$past_temp1_shop_manthly_array2[$i] + (int)$past_temp1_oroshi_manthly_array2[$i])) * 100 * 10)) / 10 ,1);
                }
                $total = (int)$total + (int)$var + (int)$temp1_shop_manthly_array2[$i] + (int)$temp1_oroshi_manthly_array2[$i];
            } else {
                if((int)$var + (int)$temp1_shop_manthly_array2[$i] == 0 || (int)$past_temp1_web_manthly_array2[$i] + (int)$past_temp1_shop_manthly_array2[$i] == 0){
                    $ratio = "---";
                } else {
                    $ratio = number_format((floor((((int)$var + (int)$temp1_shop_manthly_array2[$i]) / ((int)$past_temp1_web_manthly_array2[$i] + (int)$past_temp1_shop_manthly_array2[$i])) * 100 * 10)) / 10 ,1);
                }
                $total = (int)$total + (int)$var + (int)$temp1_shop_manthly_array2[$i];
            }
            if($out1_c == "ON"){
                if($past_temp1_web_manthly_array2[$i] == 0 && $past_temp1_shop_manthly_array2[$i] == 0 && $past_temp1_oroshi_manthly_array2[$i] == 0){
                    $total_past = $total_past;
                } else {
                    $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array2[$i] + (int)$past_temp1_shop_manthly_array2[$i] + (int)$past_temp1_oroshi_manthly_array2[$i];
                }
            } else {
                if($past_temp1_web_manthly_array2[$i] == 0 && $past_temp1_shop_manthly_array2[$i] == 0){
                    $total_past = $total_past;
                } else {
                    $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array2[$i] + (int)$past_temp1_shop_manthly_array2[$i];
                }
            }
        }
        //$ratio_html .= "<div class='title7 ta_r'>" . $ratio . "%</div>";
        if($ratio < 100){
            $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ratio . "%</div>";
        } else {
            $ratio_html .= "<div class='title7 ta_r fc_red'>" . $ratio . "%</div>";
        }

        $i++;
    }
    // 過去の同期間売上金額に対する比率を取得
        if($total <> 0 && $total_past <> 0 && $total <> "" && $total_past <> ""){
            $total_ratio = number_format((floor(((float)$total / (float)$total_past) * 100 * 10)) / 10 ,1);
        } else {
            $total_ratio = "---";
        }

        //$ratio_html .= "<div class='title7 ta_r bg_grey'>" . $total_ratio . "%</div>";
        if($total_ratio < 100){
            $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $total_ratio . "%</div>";
        } else {
            $ratio_html .= "<div class='title7 ta_r fc_red'>" . $total_ratio . "%</div>";
        }

    $temp1_all_sorce8 = "<p class='title_a'>点数・過去比</p><div class='box1'>" . $temp1_title5 . "<div class='wid100 ul4'><div class='title7 ta_c'>店舗</div>" . $shop_ratio_html . "</div>";
    $temp1_all_sorce8 .= "<div class='wid100 ul4'><div class='title7 ta_c'>通販</div>" . $web_ratio_html . "</div>";
    if($out1_c == "ON"){$temp1_all_sorce8 .= "<div class='wid100 ul4'><div class='title7 ta_c'>卸</div>" . $oroshi_ratio_html . "</div>";}
    $temp1_all_sorce8 .= "<div class='wid100 ul4 bg_grey'><div class='title7 ta_c'>合計</div>" . $ratio_html . "</div></div>";
    
        
// 通販・粗利・過去比

    $i = 0;
    $web_ratio = "";
    $web_ratio_html = "";
    $web_total = "";
    $web_total_past = "";
    $web_total_ratio = "";
    foreach($temp1_web_manthly_array3 as $var){
        if($var == 0){
            $web_ratio = "---";
            $web_total = $web_total;
            if($past_temp1_web_manthly_array3[$i] == 0){
                $web_total_past = $web_total_past;
            } else {
                $web_total_past = (int)$web_total_past + (int)$past_temp1_web_manthly_array3[$i];
            }
        } else {
            if($var == 0 || $past_temp1_web_manthly_array3[$i] == 0 || $var == "" || $past_temp1_web_manthly_array3[$i] == ""){
                $web_ratio = "---";
            } else {
                $web_ratio = number_format((floor(($var / $past_temp1_web_manthly_array3[$i]) * 100 * 10)) / 10 ,1);
            }
            $web_total = (int)$web_total + (int)$var;
            if($past_temp1_web_manthly_array3[$i] == 0){
                $web_total_past = $web_total_past;
            } else {
                $web_total_past = (int)$web_total_past + (int)$past_temp1_web_manthly_array3[$i];
            }
        }
        //$web_ratio_html .= "<div class='title7 ta_r'>" . $web_ratio . "%</div>";
        if($web_ratio < 100){
            $web_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $web_ratio . "%</div>";
        } else {
            $web_ratio_html .= "<div class='title7 ta_r fc_red'>" . $web_ratio . "%</div>";
        }

        $i++;
    }
    // 過去の同期間売上粗利に対する比率を取得
        if($web_total <> 0 && $web_total_past <> 0 && $web_total <> "" && $web_total_past <> ""){
            $web_total_ratio = number_format((floor(((float)$web_total / (float)$web_total_past) * 100 * 10)) / 10 ,1);
        } else {
            $web_total_ratio = "---";
        }

        //$web_ratio_html .= "<div class='title7 ta_r'>" . $web_total_ratio . "%</div>";
        if($web_total_ratio < 100){
            $web_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $web_total_ratio . "%</div>";
        } else {
            $web_ratio_html .= "<div class='title7 ta_r fc_red'>" . $web_total_ratio . "%</div>";
        }


// 店舗・粗利・過去比

    $i = 0;
    $shop_ratio = "";
    $shop_ratio_html = "";
    $shop_total = "";
    $shop_total_past = "";
    $shop_total_ratio = "";
    foreach($temp1_shop_manthly_array3 as $var){
        if($var == 0){
            $shop_ratio = "---";
            $shop_total = $shop_total;
            if($past_temp1_shop_manthly_array3[$i] == 0){
                $shop_total_past = $shop_total_past;
            } else {
                $shop_total_past = (int)$shop_total_past + (int)$past_temp1_shop_manthly_array3[$i];
            }
        } else {
            if($var == 0 || $past_temp1_shop_manthly_array3[$i] == 0 || $var == "" || $past_temp1_shop_manthly_array3[$i] == ""){
                $shop_ratio = "---";
            } else {
                $shop_ratio = number_format((floor(($var / $past_temp1_shop_manthly_array3[$i]) * 100 * 10)) / 10 ,1);
            }
            $shop_total = (int)$shop_total + (int)$var;
            if($past_temp1_shop_manthly_array3[$i] == 0){
                $shop_total_past = $shop_total_past;
            } else {
                $shop_total_past = (int)$shop_total_past + (int)$past_temp1_shop_manthly_array3[$i];
            }
        }
        //$shop_ratio_html .= "<div class='title7 ta_r'>" . $shop_ratio . "%</div>";
        if($shop_ratio < 100){
            $shop_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $shop_ratio . "%</div>";
        } else {
            $shop_ratio_html .= "<div class='title7 ta_r fc_red'>" . $shop_ratio . "%</div>";
        }

        $i++;
    }
    // 過去の同期間売上粗利に対する比率を取得
        if($shop_total <> 0 && $shop_total_past <> 0 && $shop_total <> "" && $shop_total_past <> ""){
            $shop_total_ratio = number_format((floor(((float)$shop_total / (float)$shop_total_past) * 100 * 10)) / 10 ,1);
        } else {
            $shop_total_ratio = "---";
        }

        //$shop_ratio_html .= "<div class='title7 ta_r'>" . $shop_total_ratio . "%</div>";
        if($shop_total_ratio < 100){
            $shop_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $shop_total_ratio . "%</div>";
        } else {
            $shop_ratio_html .= "<div class='title7 ta_r fc_red'>" . $shop_total_ratio . "%</div>";
        }

    if($out1_c == "ON"){
        // 卸・粗利・過去比
            $i = 0;
            $oroshi_ratio = "";
            $oroshi_ratio_html = "";
            $oroshi_total = "";
            $oroshi_total_past = "";
            $oroshi_total_ratio = "";
            foreach($temp1_oroshi_manthly_array3 as $var){
                if($var == 0){
                    $oroshi_ratio = "---";
                    $oroshi_total = $oroshi_total;
                    if($past_temp1_oroshi_manthly_array3[$i] == 0){
                        $oroshi_total_past = $oroshi_total_past;
                    } else {
                        $oroshi_total_past = (int)$oroshi_total_past + (int)$past_temp1_oroshi_manthly_array3[$i];
                    }
                } else {
                    if($var == 0 || $past_temp1_oroshi_manthly_array3[$i] == 0 || $var == "" || $past_temp1_oroshi_manthly_array3[$i] == ""){
                        $oroshi_ratio = "---";
                    } else {
                        $oroshi_ratio = number_format((floor(($var / $past_temp1_oroshi_manthly_array3[$i]) * 100 * 10)) / 10 ,1);
                    }
                    $oroshi_total = (int)$oroshi_total + (int)$var;
                    if($past_temp1_oroshi_manthly_array3[$i] == 0){
                        $oroshi_total_past = $oroshi_total_past;
                    } else {
                        $oroshi_total_past = (int)$oroshi_total_past + (int)$past_temp1_oroshi_manthly_array3[$i];
                    }
                }
                //$oroshi_ratio_html .= "<div class='title7 ta_r'>" . $oroshi_ratio . "%</div>";
                if($oroshi_ratio < 100){
                    $oroshi_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $oroshi_ratio . "%</div>";
                } else {
                    $oroshi_ratio_html .= "<div class='title7 ta_r fc_red'>" . $oroshi_ratio . "%</div>";
                }
        
                $i++;
            }
            // 過去の同期間売上金額に対する比率を取得
                if($oroshi_total == 0 || $oroshi_total_past == 0 || $oroshi_total == "" || $oroshi_total_past == ""){
                    $oroshi_total_ratio = "---";
                } else {
                    $oroshi_total_ratio = number_format((floor(((int)$oroshi_total / (int)$oroshi_total_past) * 100 * 10)) / 10 ,1);
                }


                //$oroshi_ratio_html .= "<div class='title7 ta_r'>" . $oroshi_total_ratio . "%</div>";
                if($oroshi_total_ratio < 100){
                    $oroshi_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $oroshi_total_ratio . "%</div>";
                } else {
                    $oroshi_ratio_html .= "<div class='title7 ta_r fc_red'>" . $oroshi_total_ratio . "%</div>";
                }
    }


// 通販・店舗・卸合計・粗利・過去比

    $i = 0;
    $ratio = "";
    $ratio_html = "";
    $total = "";
    $total_past = "";
    $total_ratio = "";
    foreach($temp1_web_manthly_array3 as $var){
        if($var == 0 && $temp1_shop_manthly_array3[$i] == 0/* && $temp1_oroshi_manthly_array3[$i] == 0*/){
            $ratio = 0;
            $total = $total;
            if($past_temp1_web_manthly_array3[$i] == 0 && $past_temp1_shop_manthly_array3[$i] == 0/* && $past_temp1_oroshi_manthly_array3[$i] == 0*/){
                $total_past = $total_past;
            } else {
                if($out1_c == "ON"){
                    $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array3[$i] + (int)$past_temp1_shop_manthly_array3[$i] + (int)$past_temp1_oroshi_manthly_array3[$i];
                } else {
                    $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array3[$i] + (int)$past_temp1_shop_manthly_array3[$i];
                }
            }
        } else {
            if($out1_c == "ON"){
                if((int)$var + (int)$temp1_shop_manthly_array3[$i] + (int)$temp1_oroshi_manthly_array3[$i] == 0 || (int)$past_temp1_web_manthly_array3[$i] + (int)$past_temp1_shop_manthly_array3[$i] + (int)$past_temp1_oroshi_manthly_array3[$i] == 0){
                    $ratio = "---";
                } else {
                    $ratio = number_format((floor((((int)$var + (int)$temp1_shop_manthly_array3[$i] + (int)$temp1_oroshi_manthly_array3[$i]) / ((int)$past_temp1_web_manthly_array3[$i] + (int)$past_temp1_shop_manthly_array3[$i] + (int)$past_temp1_oroshi_manthly_array3[$i])) * 100 * 10)) / 10 ,1);
                }
                $total = (int)$total + (int)$var + (int)$temp1_shop_manthly_array3[$i] + (int)$temp1_oroshi_manthly_array3[$i];
            } else {
                if((int)$var + (int)$temp1_shop_manthly_array3[$i] == 0 || (int)$past_temp1_web_manthly_array3[$i] + (int)$past_temp1_shop_manthly_array3[$i] == 0){
                    $ratio = "---";
                } else {
                    $ratio = number_format((floor((((int)$var + (int)$temp1_shop_manthly_array3[$i]) / ((int)$past_temp1_web_manthly_array3[$i] + (int)$past_temp1_shop_manthly_array3[$i])) * 100 * 10)) / 10 ,1);
                }
                $total = (int)$total + (int)$var + (int)$temp1_shop_manthly_array3[$i];
            }
            if($out1_c == "ON"){
                if($past_temp1_web_manthly_array3[$i] == 0 && $past_temp1_shop_manthly_array3[$i] == 0 && $past_temp1_oroshi_manthly_array3[$i] == 0){
                    $total_past = $total_past;
                } else {
                    $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array3[$i] + (int)$past_temp1_shop_manthly_array3[$i] + (int)$past_temp1_oroshi_manthly_array3[$i];
                }
            } else {
                if($past_temp1_web_manthly_array3[$i] == 0 && $past_temp1_shop_manthly_array3[$i] == 0){
                    $total_past = $total_past;
                } else {
                    $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array3[$i] + (int)$past_temp1_shop_manthly_array3[$i];
                }
            }
        }
        //$ratio_html .= "<div class='title7 ta_r'>" . $ratio . "%</div>";
        if($ratio < 100){
            $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ratio . "%</div>";
        } else {
            $ratio_html .= "<div class='title7 ta_r fc_red'>" . $ratio . "%</div>";
        }

        $i++;
    }
    // 過去の同期間売上金額に対する比率を取得
        if($total <> 0 && $total_past <> 0 && $total <> "" && $total_past <> ""){
            $total_ratio = number_format((floor(((float)$total / (float)$total_past) * 100 * 10)) / 10 ,1);
        } else {
            $total_ratio = "---";
        }

        //$ratio_html .= "<div class='title7 ta_r  bg_grey'>" . $total_ratio . "%</div>";
        if($total_ratio < 100){
            $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $total_ratio . "%</div>";
        } else {
            $ratio_html .= "<div class='title7 ta_r fc_red'>" . $total_ratio . "%</div>";
        }


    $temp1_all_sorce9 = "<p class='title_a'>粗利・過去比</p><div class='box1'>" . $temp1_title5 . "<div class='wid100 ul4'><div class='title7 ta_c'>店舗</div>" . $shop_ratio_html . "</div>";
    $temp1_all_sorce9 .= "<div class='wid100 ul4'><div class='title7 ta_c'>通販</div>" . $web_ratio_html . "</div>";
    if($out1_c == "ON"){$temp1_all_sorce9 .= "<div class='wid100 ul4'><div class='title7 ta_c'>卸</div>" . $oroshi_ratio_html . "</div>";}
    $temp1_all_sorce9 .= "<div class='wid100 ul4 bg_grey'><div class='title7 ta_c'>合計</div>" . $ratio_html . "</div></div>";


// 過去・金額構成比

    $i = 0;
    $total = "";
    $total2 = 0;
    $web_per = "";
    $shop_per = "";
    $oroshi_per = "";
    $web_total = "";
    $shop_total = "";
    $oroshi_total = "";
    $web_per_html = "";
    $shop_per_html = "";
    $oroshi_per_html = "";
    $past_web_total_js2 = "";
    $past_shop_total_js2 = "";
    $past_oroshi_total_js2 = "";
    foreach($past_temp1_web_manthly_array as $var){
        //echo $past_temp1_shop_manthly_array[$i] . "<br>";
        if($out1_c == "ON"){
            $total = (int)$var + (int)$past_temp1_shop_manthly_array[$i] + (int)$past_temp1_oroshi_manthly_array[$i];
        } else {
            $total = (int)$var + (int)$past_temp1_shop_manthly_array[$i];
        }
        $total2 = (int)$total2 + (int)$total;
        $web_total = (int)$web_total + (int)$var;
        $shop_total = (int)$shop_total + (int)$past_temp1_shop_manthly_array[$i];
        if($out1_c == "ON"){ $oroshi_total = (int)$oroshi_total + (int)$past_temp1_oroshi_manthly_array[$i]; }
        if($var == 0){
            $web_per = "---";
            if($past_temp1_shop_manthly_array[$i] == 0){
                $shop_per = "---";
            } else {
                if($out1_c == "ON"){ 
                    if($past_temp1_shop_manthly_array[$i] <> 0 && $total <> 0 && $past_temp1_shop_manthly_array[$i] <> "" && $total <> ""){
                        $shop_per = number_format((floor(($past_temp1_shop_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
                    } else {
                        $shop_per = "---"; 
                    }
                } else {
                    //$shop_per = 100 - $web_per;
                    $shop_per = number_format(bcsub('100', ((float)$web_per), 1) ,1);

                }
            }
            if($out1_c == "ON"){
                if($past_temp1_oroshi_manthly_array[$i] == 0){
                    $oroshi_per = "---";
                } else {
                    //$oroshi_per = 100 - $web_per - $shop_per;
                    $oroshi_per = number_format(bcsub('100', ($web_per + $shop_per), 1) ,1);
                }
            }
        } else {
            if($var <> 0 && $total <> 0 && $var <> "" && $total <> ""){
                $web_per = number_format((floor(($var / $total) * 100 * 10)) / 10 ,1);
            } else {
                $web_per = "---";
            }
            if($past_temp1_shop_manthly_array[$i] == 0){
                $shop_per = "---";
            } else {
                if($out1_c == "ON"){ 
                    if($past_temp1_shop_manthly_array[$i] <> 0 && $total <> 0 && $past_temp1_shop_manthly_array[$i] <> "" && $total <> ""){
                        $shop_per = number_format((floor(($past_temp1_shop_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
                    } else {
                        $shop_per = "---";
                    }
                } else {
                    //$shop_per = 100 - $web_per;
                    $shop_per = number_format(bcsub('100', ((float)$web_per), 1) ,1);

                }
            }
            if($out1_c == "ON"){
                if($past_temp1_oroshi_manthly_array[$i] == 0){
                    $oroshi_per = "---";
                } else {
                    //$oroshi_per = 100 - $web_per - $shop_per;
                    $oroshi_per = number_format(bcsub('100', ((float)$web_per + (float)$shop_per), 1) ,1);
                }
            }
        }
        $web_per_html .= "<div class='title7 ta_r'>" . $web_per . "%</div>";
        $shop_per_html .= "<div class='title7 ta_r'>" . $shop_per . "%</div>";
        $past_web_total_js2  .= (float)$web_per . ", ";
        $past_shop_total_js2  .= (float)$shop_per . ", ";

        if($out1_c == "ON"){
            $oroshi_per_html .= "<div class='title7 ta_r'>" . $oroshi_per . "%</div>";
            $past_oroshi_total_js2  .= (float)$oroshi_per . ", ";
        }

        $i++;
    }
    // 期間中の売上合計に対するパーセンテージを取得
       // $web_total_per = $web_total / $i;
        if($web_total <> 0 && $total2 <> 0 && $web_total <> "" && $total2 <> ""){
            $web_total_per = number_format((floor(($web_total / $total2) * 100 * 10)) / 10 ,1);
        } else {
            $web_total_per = "---";
        }
        if($shop_total <> 0 && $total2 <> 0 && $shop_total <> "" && $total2 <> ""){
            $shop_total_per = number_format((floor(($shop_total / $total2) * 100 * 10)) / 10 ,1);
        } else {
            $shop_total_per = "---";
        }
        //if($out1_c == "ON"){ $oroshi_total_per = 100 - $web_total_per - $shop_total_per; }
        if($out1_c == "ON"){ $oroshi_total_per = number_format(bcsub('100', ((float)$web_total_per + (float)$shop_total_per), 1) ,1);}
        $web_per_html .= "<div class='title7 ta_r'>" . $web_total_per . "%</div>";
        $shop_per_html .= "<div class='title7 ta_r'>" . $shop_total_per . "%</div>";
        if($out1_c == "ON"){ $oroshi_per_html .= "<div class='title7 ta_r'>" . $oroshi_total_per . "%</div>";}

    $past_temp1_all_sorce4 = "<p class='title_a'>金額・構成比（過去）</p><div class='box1'>" . $past_temp1_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>店舗</div>" . $shop_per_html . "</div>";
    $past_temp1_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>通販</div>" . $web_per_html . "</div>";
    if($out1_c == "ON"){$past_temp1_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>卸</div>" . $oroshi_per_html . "</div>";}
    $past_temp1_all_sorce4 .= "</div>";

// 過去・点数構成比

    $i = 0;
    $total = "";
    $total2 = 0;
    $web_per = "";
    $shop_per = "";
    $oroshi_per = "";
    $web_total = "";
    $shop_total = "";
    $oroshi_total = "";
    $web_per_html = "";
    $shop_per_html = "";
    $oroshi_per_html = "";
    $past_web_total_js3 = "";
    $past_shop_total_js3 = "";
    $past_oroshi_total_js3 = "";
    foreach($past_temp1_web_manthly_array2 as $var){
        //echo $past_temp1_shop_manthly_array2[$i] . "<br>";
        if($out1_c == "ON"){
            $total = (int)$var + (int)$past_temp1_shop_manthly_array2[$i] + (int)$past_temp1_oroshi_manthly_array2[$i];
        } else {
            $total = (int)$var + (int)$past_temp1_shop_manthly_array2[$i];
        }
        $total2 = (int)$total2 + (int)$total;
        $web_total = (int)$web_total + (int)$var;
        $shop_total = (int)$shop_total + (int)$past_temp1_shop_manthly_array2[$i];
        if($out1_c == "ON"){ $oroshi_total = (int)$oroshi_total + (int)$past_temp1_oroshi_manthly_array2[$i]; }
        if($var == 0){
            $web_per = "---";
            if($past_temp1_shop_manthly_array2[$i] == 0){
                $shop_per = "---";
            } else {
                if($out1_c == "ON"){ 
                    if($past_temp1_shop_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp1_shop_manthly_array2[$i] <> "" && $total <> ""){
                        $shop_per = number_format((floor(($past_temp1_shop_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
                    } else {
                        $shop_per = "---"; 
                    }
                } else {
                    //$shop_per = 100 - $web_per;
                    $shop_per = number_format(bcsub('100', ((float)$shop_per), 1) ,1);

                }
            }
            if($out1_c == "ON"){
                if($past_temp1_oroshi_manthly_array2[$i] == 0){
                    $oroshi_per = "---";
                } else {
                    //$oroshi_per = 100 - $web_per - $shop_per;
                    $oroshi_per = number_format(bcsub('100', ($web_per + $shop_per), 1) ,1);
                }
            }
        } else {
            if($var <> 0 && $total <> 0 && $var <> "" && $total <> ""){
                $web_per = number_format((floor(($var / $total) * 100 * 10)) / 10 ,1);
            } else {
                $web_per = "---";
            }
            if($past_temp1_shop_manthly_array2[$i] == 0){
                $shop_per = "---";
            } else {
                if($out1_c == "ON"){ 
                    if($past_temp1_shop_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp1_shop_manthly_array2[$i] <> "" && $total <> ""){
                        $shop_per = number_format((floor(($past_temp1_shop_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
                    } else {
                        $shop_per = "---"; 
                    }
                } else {
                    //$shop_per = 100 - $web_per;
                    $shop_per = number_format(bcsub('100', ((float)$web_per), 1) ,1);

                }
            }
            if($out1_c == "ON"){
                if($past_temp1_oroshi_manthly_array2[$i] == 0){
                    $oroshi_per = "---";
                } else {
                    //$oroshi_per = 100 - $web_per - $shop_per;
                    $oroshi_per = number_format(bcsub('100', ($web_per + $shop_per), 1) ,1);
                }
            }
        }
        $web_per_html .= "<div class='title7 ta_r'>" . $web_per . "%</div>";
        $shop_per_html .= "<div class='title7 ta_r'>" . $shop_per . "%</div>";
        $past_web_total_js3  .= (float)$web_per . ", ";
        $past_shop_total_js3  .= (float)$shop_per . ", ";
        if($out1_c == "ON"){
            $oroshi_per_html .= "<div class='title7 ta_r'>" . $oroshi_per . "%</div>";
            $past_oroshi_total_js3  .= (float)$oroshi_per . ", ";
        }

        $i++;
    }
    // 期間中の売上合計点数に対するパーセンテージを取得
       // $web_total_per = $web_total / $i;
        if($web_total <> 0 && $total2 <> 0 && $web_total <> "" && $total2 <> ""){
           $web_total_per = number_format((floor(($web_total / $total2) * 100 * 10)) / 10 ,1);
        } else {
            $web_total_per = "---";
        }
        if($shop_total <> 0 && $total2 <> 0 && $shop_total <> "" && $total2 <> ""){
            $shop_total_per = number_format((floor(($shop_total / $total2) * 100 * 10)) / 10 ,1);
        } else {
            $shop_total_per = "---";
        }
       //if($out1_c == "ON"){ $oroshi_total_per = 100 - $web_total_per - $shop_total_per; }
       if($out1_c == "ON"){ $oroshi_total_per = number_format(bcsub('100', ((float)$web_total_per + (float)$shop_total_per), 1) ,1);}
       $web_per_html .= "<div class='title7 ta_r'>" . $web_total_per . "%</div>";
       $shop_per_html .= "<div class='title7 ta_r'>" . $shop_total_per . "%</div>";
       if($out1_c == "ON"){ $oroshi_per_html .= "<div class='title7 ta_r'>" . $oroshi_total_per . "%</div>";}


    $past_temp1_all_sorce5 = "<p class='title_a'>点数・構成比（過去）</p><div class='box1'>" . $past_temp1_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>店舗</div>" . $shop_per_html . "</div>";
    $past_temp1_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>通販</div>" . $web_per_html . "</div>";
    if($out1_c == "ON"){$past_temp1_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>卸</div>" . $oroshi_per_html . "</div>";}
    $past_temp1_all_sorce5 .= "</div>";

// 過去・平均単価

    $i = 0;
    $web_average = "";
    $web_ave_html = "";
    $web_total = "";
    $web_total2 = "";
    $web_total_ave = "";
    foreach($past_temp1_web_manthly_array as $var){

        if($var == 0){
            $web_average = 0;
            $web_total = (int)$web_total + (int)$var;
            if($past_temp1_web_manthly_array2[$i] == 0){
                $web_total2 = $web_total2;
            } else {
                $web_total2 = (int)$web_total2 + (int)$past_temp1_web_manthly_array2[$i];
            }
        } else {
            if($var <> 0 && $past_temp1_web_manthly_array2[$i] <> 0 && $var <> "" && $past_temp1_web_manthly_array2[$i] <> ""){
                $web_average = (floor(((int)$var / (int)$past_temp1_web_manthly_array2[$i])) * 10) / 10;
            } else {
                $web_average = "---";
            }
            $web_total = (int)$web_total + (int)$var;
            if($past_temp1_web_manthly_array2[$i] == 0){
                $web_total2 = $web_total2;
            } else {
                $web_total2 = (int)$web_total2 + (int)$past_temp1_web_manthly_array2[$i];
            }
        }
        if($web_average <> 0 && $web_average <> ""){$web_average = number_format((int)$web_average);}
        $web_ave_html .= "<div class='title7 ta_r'>" . $web_average . "</div>";

        $i++;
    }
    // 期間中の売上合計に対する平均単価を取得
        if($web_total <> 0 && $web_total2 <> 0 && $web_total <> "" && $web_total2 <> ""){
            $web_total_ave = (floor(($web_total / $web_total2) * 10)) / 10;
        } else {
            $web_total_ave = "---";
        }
        if($web_total_ave <> 0 && $web_total_ave <> ""){$web_total_ave = number_format((int)$web_total_ave);}
        $web_ave_html .= "<div class='title7 ta_r'>" . $web_total_ave . "</div>";

    $i = 0;
    $shop_average = "";
    $shop_ave_html = "";
    $shop_total = "";
    $shop_total2 = "";
    $shop_total_ave = "";
    foreach($past_temp1_shop_manthly_array as $var){

        if($var == 0){
            $shop_average = 0;
            $shop_total = (int)$shop_total + (int)$var;
            if($past_temp1_shop_manthly_array2[$i] == 0){
                $shop_total2 = $shop_total2;
            } else {
                $shop_total2 = (int)$shop_total2 + (int)$past_temp1_shop_manthly_array2[$i];
            }
        } else {
            if($var <> 0 && $past_temp1_shop_manthly_array2[$i] <> 0 && $var <> "" && $past_temp1_shop_manthly_array2[$i] <> ""){
                $shop_average = (floor(((int)$var / (int)$past_temp1_shop_manthly_array2[$i])));
            } else {
                $shop_average = "---";
            }
            $shop_total = (int)$shop_total + (int)$var;
            if($past_temp1_shop_manthly_array2[$i] == 0){
                $shop_total2 = $shop_total2;
            } else {
                $shop_total2 = (int)$shop_total2 + (int)$past_temp1_shop_manthly_array2[$i];
            }
        }
        if($shop_average <> 0 && $shop_average <> ""){$shop_average = number_format((int)$shop_average);}
        $shop_ave_html .= "<div class='title7 ta_r'>" . $shop_average . "</div>";

        $i++;
    }
    // 期間中の売上合計に対する平均単価を取得
        if($shop_total <> 0 && $shop_total2 <> 0 && $shop_total <> "" && $shop_total2 <> ""){
            $shop_total_ave = (floor(((float)$shop_total / (float)$shop_total2)));
        } else {
            $shop_total_ave = "---";
        }
        if($shop_total_ave <> 0 && $shop_total_ave <> ""){$shop_total_ave = number_format((int)$shop_total_ave);}
        $shop_ave_html .= "<div class='title7 ta_r'>" . $shop_total_ave . "</div>";

        if($out1_c == "ON"){    
            $i = 0;
            $oroshi_average = "";
            $oroshi_ave_html = "";
            $oroshi_total = "";
            $oroshi_total2 = "";
            $oroshi_total_ave = "";
            foreach($past_temp1_oroshi_manthly_array as $var){

                if($var == 0){
                    $oroshi_average = 0;
                    $oroshi_total = (int)$oroshi_total + (int)$var;
                    if($past_temp1_oroshi_manthly_array2[$i] == 0){
                        $oroshi_total2 = $oroshi_total2;
                    } else {
                        $oroshi_total2 = (int)$oroshi_total2 + (int)$past_temp1_oroshi_manthly_array2[$i];
                    }
                } else {
                    if($var <> 0 && $past_temp1_oroshi_manthly_array2[$i] <> 0 && $var <> "" && $past_temp1_oroshi_manthly_array2[$i] <> ""){
                        $oroshi_average = (floor(((int)$var / (int)$past_temp1_oroshi_manthly_array2[$i])) * 10) / 10;
                    } else {
                        $oroshi_average = "---";
                    }
                    $oroshi_total = (int)$oroshi_total + (int)$var;
                    if($past_temp1_oroshi_manthly_array2[$i] == 0){
                        $oroshi_total2 = $oroshi_total2;
                    } else {
                        $oroshi_total2 = (int)$oroshi_total2 + (int)$past_temp1_oroshi_manthly_array2[$i];
                    }
                }
                if($oroshi_average <> 0 && $oroshi_average <> ""){$oroshi_average = number_format((int)$oroshi_average);}
                $oroshi_ave_html .= "<div class='title7 ta_r'>" . $oroshi_average . "</div>";

                $i++;
            }
            // 期間中の売上合計に対する平均単価を取得
                if($oroshi_total == 0 || $oroshi_total2 == 0 || $oroshi_total == "" || $oroshi_total2 == ""){
                    $oroshi_total_ave = "---";
                } else {
                    $oroshi_total_ave = (floor(((int)$oroshi_total / (int)$oroshi_total2) * 10)) / 10;
                }

                if($oroshi_total_ave <> 0 && $oroshi_total_ave <> ""){$oroshi_total_ave = number_format((int)$oroshi_total_ave);}
                $oroshi_ave_html .= "<div class='title7 ta_r'>" . $oroshi_total_ave . "</div>";
        }




        $past_temp1_all_sorce6 = "<p class='title_a'>平均単価（過去）</p><div class='box1'>" . $past_temp1_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>店舗</div>" . $shop_ave_html . "</div>";
        $past_temp1_all_sorce6 .= "<div class='wid100 ul4'><div class='title7 ta_c'>通販</div>" . $web_ave_html . "</div>";
        if($out1_c == "ON"){$past_temp1_all_sorce6 .= "<div class='wid100 ul4'><div class='title7 ta_c'>卸</div>" . $oroshi_ave_html . "</div>";}
        $past_temp1_all_sorce6 .= "</div>";
    



                                        // 各月の全部門売上合計の先頭（1列目）部分のタイトルHTML
                                            $all_sum_uriage = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $all_sum_number = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $all_sum_arari = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $all_sum_arari_per = "<div class='wid100 ul3'><div class='title5 ta_c'>粗利率(合計)</div>";

                                        // 各月の全部門売上合計を配列に代入
                                            $temp1_all_m_sum_uriage_array = array();
                                            $temp1_all_m_sum_number_array = array();
                                            $temp1_all_m_sum_arari_array = array();
                                            $i = 0;
                                            foreach($manth_now_array as $val){
                                                $all = "";
                                                $all2 = "";
                                                $all3 = "";
                                                if($out1_a == "ON"){ $all = (int)$all + (int)$temp1_shop_manthly_array[$i]; $all2 = (int)$all2 + (int)$temp1_shop_manthly_array2[$i]; $all3 = (int)$all3 + (int)$temp1_shop_manthly_array3[$i];}
                                                if($out1_b == "ON"){ $all = (int)$all + (int)$temp1_web_manthly_array[$i]; $all2 = (int)$all2 + (int)$temp1_web_manthly_array2[$i]; $all3 = (int)$all3 + (int)$temp1_web_manthly_array3[$i];}
                                                if($out1_c == "ON"){ $all = (int)$all + (int)$temp1_oroshi_manthly_array[$i]; $all2 = (int)$all2 + (int)$temp1_oroshi_manthly_array2[$i]; $all3 = (int)$all3 + (int)$temp1_oroshi_manthly_array3[$i];}

                                                array_push($temp1_all_m_sum_uriage_array,$all);
                                                array_push($temp1_all_m_sum_number_array,$all2);
                                                array_push($temp1_all_m_sum_arari_array,$all3);

                                                $i++;
                                            }
                                        // 各月の全部門売上合計部分のHTML作成
                                            foreach($temp1_all_m_sum_uriage_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $all_sum_uriage .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $all_sum_uriage .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                            }
                                            
                                        // 各月の全部門売上点数合計部分のHTML作成
                                            foreach($temp1_all_m_sum_number_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $all_sum_number .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $all_sum_number .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                            }
                                            
                                        // 各月の全部門粗利合計部分のHTML作成
                                            $i = 0;
                                            $arari_ratio = "";
                                            $all_arari_total = "";
                                            foreach($temp1_all_m_sum_arari_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $all_sum_arari .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $all_sum_arari .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                                // 各月の粗利率を取得
                                                    if($temp1_all_m_sum_uriage_array[$i] == 0){
                                                        $arari_ratio = "---";
                                                    } else {
                                                        $arari_ratio = number_format((floor(((int)$var / (int)$temp1_all_m_sum_uriage_array[$i]) * 100 * 10)) / 10 ,1);
                                                    }
                                                    // 現在・粗利・縦軸合計
                                                        $all_sum_arari_per .= "<div class='title6 ta_r'>" . $arari_ratio . "%</div>";
                                                    // 現在・通販・店舗・卸・合計粗利率（JSグラフ用） 
                                                        $all_arari_total .= (float)$arari_ratio . ", ";

                                                    // 過去・現在の粗利率合計差の計算に使用
                                                        ${"arari_ratio_" . $i} = $arari_ratio;


                                                $i++;
                                            }


                                        // 通販・店舗・卸の各月・粗利率合計を取得
                                            $arati_cutting_total_html = "";
                                            $arari_ratio_cutting = "";
                                            for($a = 0; $a < $i; $a++){
                                                $arati_cutting_total = "";
                                                $arari_ratio_cutting = (float)${"arari_ratio_" . $a} - (float)${"past_arari_ratio_" . $a};
                                                //$arati_cutting_total_html .= "<div class='title7 ta_r'>" . $arari_ratio_cutting . "</div>";
                                                if($arari_ratio_cutting < 0){
                                                    $arati_cutting_total_html .= "<div class='title7 ta_r fc_blue'>" . $arari_ratio_cutting . "%</div>";
                                                } else {
                                                    $arati_cutting_total_html .= "<div class='title7 ta_r fc_red'>" . $arari_ratio_cutting . "%</div>";
                                                }
                                            }
                                        // 通販・店舗・卸の各月合計・粗利率合計を取得

                                            if($out1_c == "ON"){
                                                $all_ratio_cutting_ave = (float)$web_ratio_cutting_ave + (float)$shop_ratio_cutting_ave + (float)$oroshi_ratio_cutting_ave;
                                                //$arati_cutting_total_html .= "<div class='title7 ta_r bg_grey'>" . $all_ratio_cutting_ave . "</div>";
                                                if($all_ratio_cutting_ave < 0){
                                                    $arati_cutting_total_html .= "<div class='title7 ta_r bg_grey fc_blue'>" . $all_ratio_cutting_ave . "%</div>";
                                                } else {
                                                    $arati_cutting_total_html .= "<div class='title7 ta_r bg_grey fc_red'>" . $all_ratio_cutting_ave . "%</div>";
                                                }
                                            } else {
                                                $all_ratio_cutting_ave = (float)$web_ratio_cutting_ave + (float)$shop_ratio_cutting_ave;
                                                //$arati_cutting_total_html .= "<div class='title7 ta_r bg_grey'>" . $all_ratio_cutting_ave . "</div>";
                                                if($all_ratio_cutting_ave < 0){
                                                    $arati_cutting_total_html .= "<div class='title7 ta_r bg_grey fc_blue'>" . $all_ratio_cutting_ave . "%</div>";
                                                } else {
                                                    $arati_cutting_total_html .= "<div class='title7 ta_r bg_grey fc_red'>" . $all_ratio_cutting_ave . "%</div>";
                                                }
                                            }


                                        $temp1_all_sorce10 = "<p class='title_a'>粗利率・過去比</p><div class='box1'>" . $temp1_title5 . "<div class='wid100 ul4'><div class='title7 ta_c'>店舗</div>" . $shop_ratio_cutting_html . "</div>";
                                        $temp1_all_sorce10 .= "<div class='wid100 ul4'><div class='title7 ta_c'>通販</div>" . $web_ratio_cutting_html . "</div>";
                                        if($out1_c == "ON"){$temp1_all_sorce10 .= "<div class='wid100 ul4'><div class='title7 ta_c'>卸</div>" . $oroshi_ratio_cutting_html . "</div>";}
                                        $temp1_all_sorce10 .= "<div class='wid100 ul4 bg_grey'><div class='title7 ta_c'>合計</div>" . $arati_cutting_total_html . "</div></div>";

                            
                                        // 全期間全部門売上合計とその平均値のHTML作成
                                            if($all_sum_uriage_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更
                                                    //$all_average = floor((int)$all_sum_uriage_all / $i);
                                                        if($out1_c == "ON"){
                                                            $all_average = (int)$web_sum_uriage_ave2 + (int)$shop_sum_uriage_ave2 + (int)$oroshi_sum_uriage_ave2;
                                                        } else {
                                                            $all_average = (int)$web_sum_uriage_ave2 + (int)$shop_sum_uriage_ave2;
                                                        }
                                            } else {
                                                $all_average = 0;            
                                            }
                                            //$all_sum_uriage .= "<div class='title6 ta_r'>" . number_format((int)$all_sum_uriage_all) . "</div><div class='title6 ta_r'>" . $yoy_uriage_sum . "</div><div class='title6 ta_r'>" . number_format((int)$all_average) . "</div></div>";
                                            $all_sum_uriage .= "<div class='title6 ta_r'>" . number_format((int)$all_sum_uriage_all) . "</div><div class='title6 ta_r'>" . number_format((int)$all_average) . "</div></div>";
                                        // 全HTMLを合体（検索対象外は除く）
                                            // 【進捗率の取得】
                                                /*if($out6 == "ON"){
                                                    $uriage_progress = "<div class='ul_p mt1'><div class='sinchoku_t'>" . $end_year . "年" . $end_month . "月</div><div class='sinchoku_t'>売上進捗</div><div class='sinchoku_t'>着地予測</div><div class='sinchoku_t'>着地予測比（対前月）</div><div class='sinchoku_t'>着地予測比（対過去・最終月）</div></div>" . $progress_uriage_html;
                                                } else {
                                                    $uriage_progress = "";
                                                }*/

                                            $view = "";
                                            if($out1_a == "ON"){ $view .= $temp1_shop_manthly_html;}
                                            if($out1_b == "ON"){ $view .= $temp1_web_manthly_html;}
                                            if($out1_c == "ON"){ $view .= $temp1_oroshi_manthly_html;}
                                            if($out4_a == "ON" && $out4_b <> "ON"){ $view_title1 = "（免税以外）";} else if($out4_a <> "ON" && $out4_b == "ON"){$view_title1 = "（免税のみ）";} else {$view_title1 = "";}
                                            $temp1_all_sorce = "<p class='title_a'>金額" . $view_title1 . "</p><div class='box1'>" . $temp1_title . $view . $all_sum_uriage . "</div>"/* . $uriage_progress*/;

                                        // 全期間全部門売上点数合計とその平均値のHTML作成
                                            if($all_sum_number_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更
                                                    //$all_average2 = floor((int)$all_sum_number_all / $i);
                                                        if($out1_c == "ON"){
                                                            $all_average2 = (int)$web_sum_number_ave2 + (int)$shop_sum_number_ave2 + (int)$oroshi_sum_number_ave2;
                                                        } else {
                                                            $all_average2 = (int)$web_sum_number_ave2 + (int)$shop_sum_number_ave2;
                                                        }
                                            } else {
                                                $all_average2 = 0;
                                            }
                                            //$all_sum_number .= "<div class='title6 ta_r'>" . number_format((int)$all_sum_number_all) . "</div><div class='title6 ta_r'>" . $yoy_number_sum . "</div><div class='title6 ta_r'>" . number_format((int)$all_average2) . "</div></div>";
                                            $all_sum_number .= "<div class='title6 ta_r'>" . number_format((int)$all_sum_number_all) . "</div><div class='title6 ta_r'>" . number_format((int)$all_average2) . "</div></div>";
                                        // 全HTMLを合体（検索対象外は除く）
                                        
                                            $view2 = "";
                                            if($out1_a == "ON"){ $view2 .= $temp1_shop_manthly_html2;}
                                            if($out1_b == "ON"){ $view2 .= $temp1_web_manthly_html2;}
                                            if($out1_c == "ON"){ $view2 .= $temp1_oroshi_manthly_html2;}
                                            $temp1_all_sorce2 = "<p class='title_a'>点数" . $view_title1 . "</p><div class='box1'>" . $temp1_title . $view2 . $all_sum_number . "</div>"/* . $number_progress*/;
                                        // 全期間全部門粗利合計とその平均値のHTML作成
                                            if($all_sum_arari_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更
                                                    //$all_average3 = floor((int)$all_sum_arari_all / $i);
                                                        if($out1_c == "ON"){
                                                            $all_average3 = (int)$web_sum_arari_ave2 + (int)$shop_sum_arari_ave2 + (int)$oroshi_sum_arari_ave2;
                                                        } else {
                                                            $all_average3 = (int)$web_sum_arari_ave2 + (int)$shop_sum_arari_ave2;
                                                        }
                                            } else {
                                                $all_average3 = 0;
                                            }
                                            //$all_sum_arari .= "<div class='title6 ta_r'>" . number_format((int)$all_sum_arari_all) . "</div><div class='title6 ta_r'>" . $yoy_arari_sum . "</div><div class='title6 ta_r'>" . number_format((int)$all_average3) . "</div></div>";
                                            $all_sum_arari .= "<div class='title6 ta_r'>" . number_format((int)$all_sum_arari_all) . "</div><div class='title6 ta_r'>" . number_format((int)$all_average3) . "</div></div>";
                                            // 粗利率の平均
                                                if($all_sum_arari_all <> 0){ $all_average4 = number_format(floor(((int)$all_sum_arari_all / (int)$all_sum_uriage_all) * 100 * 10) / 10 ,1);} else {$all_average4 = 0;}
                                                $all_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $all_average4 . "%</div></div>";
                                        // 全HTMLを合体（検索対象外は除く）
                                        
                                            $view3 = "";
                                            if($out1_a == "ON"){ $view3 .= $temp1_shop_manthly_html3;}
                                            if($out1_b == "ON"){ $view3 .= $temp1_web_manthly_html3;}
                                            if($out1_c == "ON"){ $view3 .= $temp1_oroshi_manthly_html3;}
                                            $temp1_all_sorce3 = "<p class='title_a'>粗利" . $view_title1 . "</p><div class='box1'>" . $temp1_title . $view3 . $all_sum_arari . $shop_sum_arari_per . $web_sum_arari_per;
                                            if($out1_c == "ON"){$temp1_all_sorce3 .= $oroshi_sum_arari_per;}
                                            $temp1_all_sorce3 .= $all_sum_arari_per  . "</div>"/* . $arari_progress*/;


                    /************************************************************************************************************************************************************************************************************* */
                        // DB情報の受け取り（検索期間） end
                    /************************************************************************************************************************************************************************************************************* */

                        // JSで表示させるための、期間売上などのデータを作成                    
                            if($out1_a == "ON"){$js_shop_uriage = substr($js_shop_uriage, 0, -2);} else {$js_shop_uriage = "";}
                            if($out1_b == "ON"){$js_web_uriage = substr($js_web_uriage, 0, -2);} else {$js_web_uriage = "";}
                            if($out1_c == "ON"){$js_oroshi_uriage = substr($js_oroshi_uriage, 0, -2);} else {$js_oroshi_uriage = "";}
                            //if($js_month <> ""){$js_month = substr($js_month, 0, -1);} else {$js_month = "";}
                        // 列の横幅を列数によって可変させる
                            $line_width = 100 / ($diff_month + 4);
                            // 20230803
                            $line_width2 = 100 / ($diff_month + 1);

                            
                            if (PostRequest::has('brand_bumon_select')){ $brand_bumon_select = PostRequest::input('brand_bumon_select');} else {$brand_bumon_select = "";}
                            if (PostRequest::has('view_select')){ $view_select = PostRequest::input('view_select');} else {$view_select = "";}
                            return view($bladename,['view_select' => $view_select,'brand_bumon_select' => $brand_bumon_select,'first_day' => $first_day,'last_day' => $last_day,'next_year' => $next_year,'this_year' => $this_year,'last_year' => $last_year,'two_years_ago' => $two_years_ago,'three_years_ago' => $three_years_ago,'start_year' => $start_year,'start_month' => $start_month,'start_day' => $start_day,'end_year' => $end_year,'end_month' => $end_month,'end_day' => $end_day,'output' => $output,'form_view' => $form_view,'out1' => $out1,'out1_a' => $out1_a,'out1_b' => $out1_b,'out1_c' => $out1_c,'out1_d' => $out1_d,'out2_a' => $out2_a,'out2_b' => $out2_b,'out2_c' => $out2_c,'out2_d' => $out2_d,'out2_e' => $out2_e,'out3_a' => $out3_a,'out3_b' => $out3_b,'out3_c' => $out3_c,'out3_d' => $out3_d,'out3_e' => $out3_e,'out3_f' => $out3_f,'out4_a' => $out4_a,'out4_b' => $out4_b,'temp1_all_sorce' => $temp1_all_sorce,'temp1_all_sorce2' => $temp1_all_sorce2,'js_web_uriage' => $js_web_uriage,'js_shop_uriage' => $js_shop_uriage,'js_oroshi_uriage' => $js_oroshi_uriage,'js_month' => $js_month,'past_between_start' => $past_between_start,'past_between_end' => $past_between_end,'past_temp1_all_sorce' => $past_temp1_all_sorce,'past_temp1_all_sorce2' => $past_temp1_all_sorce2,'past_js_web_uriage' => $past_js_web_uriage,'past_js_shop_uriage' => $past_js_shop_uriage,'past_js_oroshi_uriage' => $past_js_oroshi_uriage,'past_js_web_number' => $past_js_web_number,'past_js_shop_number' => $past_js_shop_number,'past_js_oroshi_number' => $past_js_oroshi_number,'js_web_number' => $js_web_number,'js_shop_number' => $js_shop_number,'js_oroshi_number' => $js_oroshi_number,'js_all_month_uriage' => $js_all_month_uriage,'js_past_all_month_uriage' => $js_past_all_month_uriage,'js_all_month_number' => $js_all_month_number,'js_past_all_month_number' => $js_past_all_month_number,'js_web_arari' => $js_web_arari,'js_shop_arari' => $js_shop_arari,'js_oroshi_arari' => $js_oroshi_arari,'js_all_month_arari' => $js_all_month_arari,'past_js_web_arari' => $past_js_web_arari,'past_js_shop_arari' => $past_js_shop_arari,'past_js_oroshi_arari' => $past_js_oroshi_arari,'js_past_all_month_arari' => $js_past_all_month_arari,'temp1_all_sorce3' => $temp1_all_sorce3,'past_temp1_all_sorce3' => $past_temp1_all_sorce3,'search' => $search,'line_width' => $line_width,'line_width2' => $line_width2,'out5' => $out5,'out5_a' => $out5_a,'out5_b' => $out5_b,'out5_c' => $out5_c,'temp1_all_sorce4' => $temp1_all_sorce4,'temp1_all_sorce5' => $temp1_all_sorce5,'temp1_all_sorce6' => $temp1_all_sorce6,'temp1_all_sorce7' => $temp1_all_sorce7,'temp1_all_sorce8' => $temp1_all_sorce8,'temp1_all_sorce9' => $temp1_all_sorce9,'temp1_all_sorce10' => $temp1_all_sorce10,'past_temp1_all_sorce4' => $past_temp1_all_sorce4,'past_temp1_all_sorce5' => $past_temp1_all_sorce5,'past_temp1_all_sorce6' => $past_temp1_all_sorce6,'web_total_js' => $web_total_js,'shop_total_js' => $shop_total_js,'oroshi_total_js' => $oroshi_total_js,'all_arari_total' => $all_arari_total,'past_web_total_js' => $past_web_total_js,'past_shop_total_js' => $past_shop_total_js,'past_oroshi_total_js' => $past_oroshi_total_js,'past_all_arari_total' => $past_all_arari_total,'web_total_js2' => $web_total_js2,'shop_total_js2' => $shop_total_js2,'oroshi_total_js2' => $oroshi_total_js2,'past_web_total_js2' => $past_web_total_js2,'past_shop_total_js2' => $past_shop_total_js2,'past_oroshi_total_js2' => $past_oroshi_total_js2,'web_total_js3' => $web_total_js3,'shop_total_js3' => $shop_total_js3,'oroshi_total_js3' => $oroshi_total_js3,'past_web_total_js3' => $past_web_total_js3,'past_shop_total_js3' => $past_shop_total_js3,'past_oroshi_total_js3' => $past_oroshi_total_js3,'out6' => $out6,'out7' => $out7,'uriage_progress_html' => $uriage_progress_html,'number_progress_html' => $number_progress_html,'arari_progress_html' => $arari_progress_html]);
        
                }




/************************************************************************************************************************************************************************************************************* */
    // DB情報取得（[売上]通販区分用）
/************************************************************************************************************************************************************************************************************* */


    public function db_info_get2($a,$b,$c,$d,$e,$f,$g,$h,$j,$k,$l,$m,$n,$o,$p,$q,$r,$s,$t,$u,$v,$w){

        // 「groupBy」にロジックで作成した名称を指定した際のエラー対応（本番だとDB上のカラムに無い名称を「groupBy」するとエラーとなる。このエラーの場合selectに名称指定すると解決するらしいが、恐らくDBに無い名称だと別のエラーとなる。以下の二行を追記する事で対応）
                config(['database.connections.mysql.strict' => false]);
                DB::reconnect();

                $start_year = $a;
                $start_month = $b;
                $start_day = $c;
                $end_year = $d;
                $end_month = $e;
                $end_day = $f;
                $this_year = $g;
                $last_year = $h;
                $two_years_ago = $j;
                $output = $k;
                $out1 = $l;
                $out2 = $m;
                $out3 = $n;
                $out4 = $o;
                $out5 = $p;
                $search = $q;
                $three_years_ago = $r;
                $next_year = $s;
                $first_day = $t;
                $last_day = $u;
                $out6 = $v;
                $out7 = $w;


            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            // DB登録ロジックを実施
            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                
                    /************************************************************************************************************************************************************************************************************* */
                        // 定数管理用（メソッドの呼び出し）start
                    /************************************************************************************************************************************************************************************************************* */
                            $define = $this->define();
                            $def_i = 0;
                            // 各変数にパスやファイル名を代入
                                foreach($define as $def){
                                    if($def_i == 0){ $bladename = $def; }
                                    if($def_i == 1){ $file_pass = $def; }
                                    if($def_i == 2){ $file_pass2 = $def; }
                                    if($def_i == 3){ $file_name = $def; }
                                    if($def_i == 4){ $table_name = $def; }

                                    $def_i++;
                                }
                    /************************************************************************************************************************************************************************************************************* */
                        // 定数管理用（メソッドの呼び出し）end
                    /************************************************************************************************************************************************************************************************************* */
                
                    /************************************************************************************************************************************************************************************************************* */
                        // フォームボタン押下時情報の受け取り start
                    /************************************************************************************************************************************************************************************************************* */

                            // 検索期間を変数に代入
                                $between_start = $start_year . "/" . $start_month . "/" . $start_day ." 00-00:00";
                                $between_end = $end_year . "/" . $end_month . "/" . $end_day ." 23-59:59";
                                $between_start_view = $start_year . "/" . $start_month . "/" . $start_day;
                                $between_end_view = $end_year . "/" . $end_month . "/" . $end_day;

                                $diff_start1 = new DateTime($between_start_view);
                                $diff_end1 = new DateTime($between_end_view);

                                $interval1 = $diff_end1 -> diff($diff_start1);

                                $diff_year1= $interval1 -> y;
                                $diff_month1 = $interval1 -> m;
                                $diff_month1 = $diff_year1 * 12 + $diff_month1;

                            // 「フォーム表示ボタン」フラグ
                                if (PostRequest::has('form_view')) {
                                    $form_view = PostRequest::input('form_view');
                                } else {$form_view = "OFF";}
                            

                            // 「売却区分」フラグ
                                $out1_a = "OFF";
                                $out1_b = "OFF";
                                $out1_c = "OFF";
                                $out1_d = "OFF";
                                if($out1 <> "" && in_array('2',$out1)){ $out1_a = "ON";}
                                if($out1 <> "" && in_array('3',$out1)){ $out1_b = "ON";}
                                if($out1 <> "" && in_array('4',$out1)){ $out1_c = "ON";}
                                if($out1 <> "" && in_array('5',$out1)){ $out1_d = "ON";}
                                
                            // 新中アンフラグ
                                $out2_a = "OFF";
                                $out2_b = "OFF";
                                $out2_c = "OFF";
                                $out2_d = "OFF";
                                $out2_e = "OFF";
                                if($out2 <> "" && in_array('1',$out2)){ $out2_a = "ON";}
                                if($out2 <> "" && in_array('2',$out2)){ $out2_b = "ON";}
                                if($out2 <> "" && in_array('3',$out2)){ $out2_c = "ON";}
                                if($out2 <> "" && in_array('4',$out2)){ $out2_d = "ON";}
                                if($out2 <> "" && in_array('5',$out2)){ $out2_e = "ON";}

                            // 通販サイトフラグ
                                $out3_a = "OFF";
                                $out3_b = "OFF";
                                $out3_c = "OFF";
                                $out3_d = "OFF";
                                $out3_e = "OFF";
                                $out3_f = "OFF";
                                if($out3 <> "" && in_array('1',$out3)){ $out3_a = "ON";}
                                if($out3 <> "" && in_array('2',$out3)){ $out3_b = "ON";}
                                if($out3 <> "" && in_array('3',$out3)){ $out3_c = "ON";}
                                if($out3 <> "" && in_array('4',$out3)){ $out3_d = "ON";}
                                if($out3 <> "" && in_array('5',$out3)){ $out3_e = "ON";}
                                if($out3 <> "" && in_array('6',$out3)){ $out3_f = "ON";}
                                
                            // 免税フラグ
                                $out4_a = "OFF";
                                $out4_b = "OFF";
                                if($out4 <> "" && in_array('1',$out4)){ $out4_a = "ON";}
                                if($out4 <> "" && in_array('2',$out4)){ $out4_b = "ON";}
                                
                            // ブランドフラグ
                                $out5_a = "OFF";
                                $out5_b = "OFF";
                                $out5_c = "OFF";
                                if($out5 <> "" && in_array('2',$out5)){ $out5_a = "ON";}
                                if($out5 <> "" && in_array('3',$out5)){ $out5_b = "ON";}
                                if($out5 <> "" && in_array('4',$out5)){ $out5_c = "ON";}


                    /************************************************************************************************************************************************************************************************************* */
                        // フォームボタン押下時情報の受け取り end
                    /************************************************************************************************************************************************************************************************************* */


                    /************************************************************************************************************************************************************************************************************* */
                        // 検索期間の月数だけ遡った過去の期間を取得 start
                    /************************************************************************************************************************************************************************************************************* */

                            // 開始と終了期間の差分（～カ月）を取得                        
                                $start = $start_year . "-" . $start_month . "-" . $start_day;
                                $end = $end_year . "-" . $end_month . "-" . $end_day;
                                $diff_start = new DateTime($start);
                                $diff_end = new DateTime($end);

                                $interval = $diff_end -> diff($diff_start);

                                $diff_year = $interval -> y;
                                $diff_month = $interval -> m;
                                $diff_month = $diff_year * 12 + $diff_month;
                                //echo $diff_month . "カ月<br>";
                            // 差分の月だけ遡った過去の期間を取得
                                // 検索開始日                
                                    $start_now = date($start_year. "-" . $start_month. "-" . $start_day);
                                // 過去開始日
                                    //$start_past = date("Y-m-d", strtotime($start_now . " -" . $diff_month . " month"));
                                    $past_between_start = date("Y-m-d", strtotime($start_now . " -" . ($diff_month + 1) . " month"));
                                    $past_between_start_view = date("Y-m", strtotime($start_now . " -" . ($diff_month +1) . " month"));
                                // 検索終了日
                                    $end_now = date($end_year. "-" . $end_month. "-" . $end_day);
                                // 過去終了日
                                    //$end_past = date("Y-m-d", strtotime($end_now . " -" . $diff_month . " month"));
                                    $past_between_end = date("Y-m-d", strtotime($start_now . " -1 day"));
                                    $past_between_end_view = date("Y-m", strtotime($start_now . " -1 month"));

                                // 過去期間の月初日を配列へ代入（該当月のデータ登録が無い場合、JS代入値が空になってグラフがズレてしまう事を回避するため0代入ロジックに使う）
                                    // 配列版
                                        $manth_now_array = array();
                                        $manth_past_array = array();
                                    // カンマ区切りの文字列版
                                        $temp3_r_manthly_data = "";
                                        $temp3_r_manthly_data2 = "";
                                        $temp3_r_manthly_data3 = "";
                                        $past_temp3_r_manthly_data = "";
                                        $past_temp3_r_manthly_data2 = "";
                                        $past_temp3_r_manthly_data3 = "";
                                        $temp3_j_manthly_data = "";
                                        $temp3_j_manthly_data2 = "";
                                        $temp3_j_manthly_data3 = "";
                                        $past_temp3_j_manthly_data = "";
                                        $past_temp3_j_manthly_data2 = "";
                                        $past_temp3_j_manthly_data3 = "";
                                        $temp3_y_manthly_data = "";
                                        $temp3_y_manthly_data2 = "";
                                        $temp3_y_manthly_data3 = "";
                                        $past_temp3_y_manthly_data = "";
                                        $past_temp3_y_manthly_data2 = "";
                                        $past_temp3_y_manthly_data3 = "";
                                        $temp3_o_manthly_data = "";
                                        $temp3_o_manthly_data2 = "";
                                        $temp3_o_manthly_data3 = "";
                                        $past_temp3_o_manthly_data = "";
                                        $past_temp3_o_manthly_data2 = "";
                                        $past_temp3_o_manthly_data3 = "";
                                    for($past_ii = 0;  $past_ii <= $diff_month; $past_ii++){
                                        if($past_ii == 0){
                                            // 現在用
                                                $manth_now = date("Y-m", strtotime($start_now));
                                            // 過去用
                                                $past_manth = $past_between_start;
                                                $past_manth2 = mb_substr($past_between_start,0,-3);
                                        } else {
                                            // 現在用
                                                $manth_now = date("Y-m", strtotime($manth_now . " 1 month"));
                                            // 過去用
                                                $past_manth = date("Y-m-d", strtotime($past_manth . " 1 month"));
                                                $past_manth2 = date("Y-m", strtotime($past_manth2 . " 1 month"));
                                        }
                                        // 現在用
                                            array_push($manth_now_array,$manth_now);
                                        // 過去用
                                            array_push($manth_past_array,$past_manth);
                                            $temp3_r_manthly_data .= $manth_now . ",";
                                            $temp3_r_manthly_data2 .= $manth_now . ",";
                                            $temp3_r_manthly_data3 .= $manth_now . ",";
                                            $past_temp3_r_manthly_data .= $past_manth2 . ",";
                                            $past_temp3_r_manthly_data2 .= $past_manth2 . ",";
                                            $past_temp3_r_manthly_data3 .= $past_manth2 . ",";
                                            $temp3_j_manthly_data .= $manth_now . ",";
                                            $temp3_j_manthly_data2 .= $manth_now . ",";
                                            $temp3_j_manthly_data3 .= $manth_now . ",";
                                            $past_temp3_j_manthly_data .= $past_manth2 . ",";
                                            $past_temp3_j_manthly_data2 .= $past_manth2 . ",";
                                            $past_temp3_j_manthly_data3 .= $past_manth2 . ",";
                                            $temp3_y_manthly_data .= $manth_now . ",";
                                            $temp3_y_manthly_data2 .= $manth_now . ",";
                                            $temp3_y_manthly_data3 .= $manth_now . ",";
                                            $past_temp3_y_manthly_data .= $past_manth2 . ",";
                                            $past_temp3_y_manthly_data2 .= $past_manth2 . ",";
                                            $past_temp3_y_manthly_data3 .= $past_manth2 . ",";
                                            $temp3_o_manthly_data .= $manth_now . ",";
                                            $temp3_o_manthly_data2 .= $manth_now . ",";
                                            $temp3_o_manthly_data3 .= $manth_now . ",";
                                            $past_temp3_o_manthly_data .= $past_manth2 . ",";
                                            $past_temp3_o_manthly_data2 .= $past_manth2 . ",";
                                            $past_temp3_o_manthly_data3 .= $past_manth2 . ",";

                                    }
                                    $temp3_r_manthly_data = trim($temp3_r_manthly_data ,",");
                                    $temp3_r_manthly_data2 = trim($temp3_r_manthly_data2 ,",");
                                    $temp3_r_manthly_data3 = trim($temp3_r_manthly_data3 ,",");
                                    $past_temp3_r_manthly_data = trim($past_temp3_r_manthly_data ,",");
                                    $past_temp3_r_manthly_data2 = trim($past_temp3_r_manthly_data2 ,",");
                                    $past_temp3_r_manthly_data3 = trim($past_temp3_r_manthly_data3 ,",");
                                    $temp3_j_manthly_data = trim($temp3_j_manthly_data ,",");
                                    $temp3_j_manthly_data2 = trim($temp3_j_manthly_data2 ,",");
                                    $temp3_j_manthly_data3 = trim($temp3_j_manthly_data3 ,",");
                                    $past_temp3_j_manthly_data = trim($past_temp3_j_manthly_data ,",");
                                    $past_temp3_j_manthly_data2 = trim($past_temp3_j_manthly_data2 ,",");
                                    $past_temp3_j_manthly_data3 = trim($past_temp3_j_manthly_data3 ,",");
                                    $temp3_y_manthly_data = trim($temp3_y_manthly_data ,",");
                                    $temp3_y_manthly_data2 = trim($temp3_y_manthly_data2 ,",");
                                    $temp3_y_manthly_data3 = trim($temp3_y_manthly_data3 ,",");
                                    $past_temp3_y_manthly_data = trim($past_temp3_y_manthly_data ,",");
                                    $past_temp3_y_manthly_data2 = trim($past_temp3_y_manthly_data2 ,",");
                                    $past_temp3_y_manthly_data3 = trim($past_temp3_y_manthly_data3 ,",");
                                    $temp3_o_manthly_data = trim($temp3_o_manthly_data ,",");
                                    $temp3_o_manthly_data2 = trim($temp3_o_manthly_data2 ,",");
                                    $temp3_o_manthly_data3 = trim($temp3_o_manthly_data3 ,",");
                                    $past_temp3_o_manthly_data = trim($past_temp3_o_manthly_data ,",");
                                    $past_temp3_o_manthly_data2 = trim($past_temp3_o_manthly_data2 ,",");
                                    $past_temp3_o_manthly_data3 = trim($past_temp3_o_manthly_data3 ,",");


                    /************************************************************************************************************************************************************************************************************* */
                        // 検索期間の月数だけ遡った過去の期間を取得 end
                    /************************************************************************************************************************************************************************************************************* */


                    // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                            // 当月の最終日
                                $last_day2 = date('Y-m-d', strtotime('last day of' . $last_day));
                            // データ格納最終日がその月の最終日と一致するか否かでフラグを作成（一致しない場合は平均の計算に含めないようにするため）
                                if($last_day2 <> $last_day){ $last_nodata_flag = "ON"; } else { $last_nodata_flag = "OFF"; }


                    /************************************************************************************************************************************************************************************************************* */
                        // 進捗率用ロジック start
                    /************************************************************************************************************************************************************************************************************* */



                                    // 【進捗率の取得】
                                                                

                                            /************************************************************************************************************************************************************************************************************* */
                                                // 検索期間の最初の日を求める（最終データ格納月の月初日）start
                                            /************************************************************************************************************************************************************************************************************* */
                                                        $last_day_array = explode('-',$last_day);
                                                        $i = 0;
                                                        $last_day_top = "";
                                                        foreach($last_day_array as $var){
                                                            // 年月
                                                                if($i <> 2){
                                                                    $last_day_top .= $var . "-";
                                                                }
                                                            // 年
                                                                if($i == 0){
                                                                    $last_year_last = $var;
                                                                }
                                                            // 月
                                                                if($i == 1){
                                                                    $last_month_last = $var;
                                                                }
                                                            // 日
                                                                if($i == 2){
                                                                    $last_day_last = $var;
                                                                }
                                                            $i++;
                                                        }
                                                        // 年月に月初日を加える
                                                            $last_day_top .= "01";
                                                        // 当月の最終日
                                                            $last_day_last2 = date("d", strtotime($last_day_top . " +1 month -1day"));

                                            /************************************************************************************************************************************************************************************************************* */
                                                // 検索期間の最初の日を求める（最終データ格納月の月初日）end
                                            /************************************************************************************************************************************************************************************************************* */

                                            /************************************************************************************************************************************************************************************************************* */
                                                // 比較年月取得（最終データ格納年月の先月） start
                                            /************************************************************************************************************************************************************************************************************* */
                                                    // 先月初日
                                                        $last_month_top = date("Y-m-d", strtotime($last_day_top . " -1 month"));
                                                    // 先月最終日
                                                        $last_month = date("Y-m-d", strtotime($last_day_top . " -1day"));
                                            
                                            /************************************************************************************************************************************************************************************************************* */
                                                // 比較年月取得（最終データ格納年月の先月） end
                                            /************************************************************************************************************************************************************************************************************* */

                                            /************************************************************************************************************************************************************************************************************* */
                                                // 比較年月取得（最終データ格納年月から検索期間の月数だけ遡った年月） start
                                            /************************************************************************************************************************************************************************************************************* */

                                                    // 差分の月だけ遡った過去の期間を取得
                                                        // 過去開始日（最終データ格納年月から検索期間を遡った年月日を取得）
                                                            $past_between_start_progress = date("Y-m-d", strtotime($last_day_top . " -" . ($diff_month + 1) . " month"));
                                                        // 過去終了日（上記年月日の月末日を取得）
                                                            $past_between_end_progress = date("Y-m-d", strtotime($past_between_start_progress . " +1 month -1day"));
                                            
                                            /************************************************************************************************************************************************************************************************************* */
                                                // 比較年月取得（最終データ格納年月から検索期間の月数だけ遡った年月） end
                                            /************************************************************************************************************************************************************************************************************* */


                                                            
                                                                
                                            /************************************************************************************************************************************************************************************************************* */
                                                // 最終データ格納月のデータ取得　start
                                            /************************************************************************************************************************************************************************************************************* */

                                                                // DB検索（自社値）スタート
                                                                        $j_progress = DB::table($table_name) 
                                                                        // 月毎にグループ化して値を分けるための処理
                                                                            ->select([
                                                                                \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS j_month'),
                                                                                \DB::raw("SUM(uriagekingaku) AS j_uriage"),
                                                                                \DB::raw("SUM(uriagesuu) AS j_number"),
                                                                                \DB::raw("SUM(ararikingaku) AS j_arari"),
                                                                            ])
                                                                            // 条件（売上部門の指定）
                                                                                ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                        
                                                                                    // 条件（売上部門が店舗）
                                                                                        if($out1_a == "ON"){
                                                                                            $query->orWhere('baikyakukubun', 1);
                                                                                        }
                                                                                    // 条件（売上部門が通販）
                                                                                        if($out1_b == "ON"){
                                                                                            $query->orWhere('baikyakukubun',2);
                                                                                        }
                                                                                    // 条件（売上部門が卸）
                                                                                        if($out1_c == "ON"){
                                                                                            $query->orWhere('baikyakukubun',3);
                                                                                        }
                                                                                    // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                        if($out1_d == "ON"){
                                                                                            $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                        }
                                                                            
                                                                                })

                                                                            // 条件（期間の指定）
                                                                                ->whereBetween($table_name . '.uriage', [$last_day_top, $last_day])
                                                                                
                                                                            // 条件（分類名）
                                                                                ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                                    // 条件（商品区分分類名が新品）
                                                                                        if($out2_a == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が中古）
                                                                                        if($out2_b == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がアンティーク）
                                                                                        if($out2_c == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がその他）
                                                                                        if($out2_d == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が修理）
                                                                                        if($out2_e == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                        }
                                                                            
                                                                            })
                                                                        // 条件（通販区分が自社）
                                                                            ->where('tsuuhankubun',1)

                                                                        // 条件（免税）
                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                    // 条件（免税区分が0:対象外）
                                                                                        if($out4_a == "ON"){
                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                        }
                                                                                    // 条件（免税区分が1:免税）
                                                                                        if($out4_b == "ON"){
                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                        }
                                                                            })
                                                                        // 条件（扱い部門）
                                                                            ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                                    $query->orWhere('bumonmei','');

                                                                                    // 条件（扱い部門がジャック）
                                                                                        if($out5_a == "ON"){
                                                                                            $query->orWhere('bumonmei','Jackroad');
                                                                                        }
                                                                                    // 条件（扱い部門がベティー）
                                                                                        if($out5_b == "ON"){
                                                                                            $query->orWhere('bumonmei','BettyRoad');
                                                                                        }
                                                                                    // 条件（扱い部門がジュエリー）
                                                                                        if($out5_c == "ON"){
                                                                                            $query->orWhere('bumonmei','Jewelry');
                                                                                        }
                                                                        
                                                                            })
                                                                        // ソート順指定
                                                                            ->orderBy('uriage', 'asc')
                                                                            ->get();
                                                                        // クエリビルダスタート
                                                                            // 変数リセット
                                                                                $j_sum_uriage_progress = "";
                                                                                $i2 = 0;
                                                                                foreach ($j_progress as $j_buy_progress) {
                                                                                    // 各月卸売上
                                                                                    $j_sum_uriage_progress = $j_buy_progress -> j_uriage;
                                                                                    $j_sum_number_progress = $j_buy_progress -> j_number;
                                                                                    $j_sum_arari_progress = $j_buy_progress -> j_arari;
                                                                                    $i2++;
                                                                                }

                                                                // DB検索（楽天値）スタート
                                                                        $r_progress = DB::table($table_name) 
                                                                            // 月毎にグループ化して値を分けるための処理
                                                                                ->select([
                                                                                    \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS r_month'),
                                                                                    \DB::raw("SUM(uriagekingaku) AS r_uriage"),
                                                                                    \DB::raw("SUM(uriagesuu) AS r_number"),
                                                                                    \DB::raw("SUM(ararikingaku) AS r_arari"),
                                                                            ])
                                                                            // 条件（売上部門の指定）
                                                                                ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                        
                                                                                    // 条件（売上部門が店舗）
                                                                                        if($out1_a == "ON"){
                                                                                            $query->orWhere('baikyakukubun', 1);
                                                                                        }
                                                                                    // 条件（売上部門が通販）
                                                                                        if($out1_b == "ON"){
                                                                                            $query->orWhere('baikyakukubun',2);
                                                                                        }
                                                                                    // 条件（売上部門が卸）
                                                                                        if($out1_c == "ON"){
                                                                                            $query->orWhere('baikyakukubun',3);
                                                                                        }
                                                                                    // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                        if($out1_d == "ON"){
                                                                                            $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                        }
                                                                            
                                                                                })
                                                                            // 条件（期間の指定）
                                                                                ->whereBetween($table_name . '.uriage', [$last_day_top, $last_day])
                                                                                
                                                                            // 条件（分類名）
                                                                                ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                                    // 条件（商品区分分類名が新品）
                                                                                        if($out2_a == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が中古）
                                                                                        if($out2_b == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がアンティーク）
                                                                                        if($out2_c == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がその他）
                                                                                        if($out2_d == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が修理）
                                                                                        if($out2_e == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                        }
                                                                            
                                                                                })
                                                                            // 条件（通販区分が楽天）
                                                                                ->where('tsuuhankubun',2)

                                                                            // 条件（免税）
                                                                                ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                        // 条件（免税区分が0:対象外）
                                                                                            if($out4_a == "ON"){
                                                                                                $query->orwhere("menzei","like","%対象外%");
                                                                                            }
                                                                                        // 条件（免税区分が1:免税）
                                                                                            if($out4_b == "ON"){
                                                                                                $query->orwhere("menzei","like","%免税%");
                                                                                            }
                                                                                })
                                                                            // 条件（扱い部門）
                                                                                ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                                        $query->orWhere('bumonmei','');

                                                                                        // 条件（扱い部門がジャック）
                                                                                            if($out5_a == "ON"){
                                                                                                $query->orWhere('bumonmei','Jackroad');
                                                                                            }
                                                                                        // 条件（扱い部門がベティー）
                                                                                            if($out5_b == "ON"){
                                                                                                $query->orWhere('bumonmei','BettyRoad');
                                                                                            }
                                                                                        // 条件（扱い部門がジュエリー）
                                                                                            if($out5_c == "ON"){
                                                                                                $query->orWhere('bumonmei','Jewelry');
                                                                                            }
                                                                            
                                                                                })
                                                                            // ソート順指定
                                                                                ->orderBy('uriage', 'asc')
                                                                                ->get();
                                                                            // クエリビルダスタート
                                                                                // 変数リセット
                                                                                    $r_sum_uriage_progress = "";
                                                                                    $i2 = 0;
                                                                                    foreach ($r_progress as $r_buy_progress) {
                                                                                        // 各月卸売上
                                                                                        $r_sum_uriage_progress = $r_buy_progress -> r_uriage;
                                                                                        $r_sum_number_progress = $r_buy_progress -> r_number;
                                                                                        $r_sum_arari_progress  = $r_buy_progress -> r_arari;
                                                                                        $i2++;
                                                                                    }


                                                                // DB検索（ヤフー値）スタート

                                                                        $y_progress = DB::table($table_name) 
                                                                            // 月毎にグループ化して値を分けるための処理
                                                                                ->select([
                                                                                    \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS y_month'),
                                                                                    \DB::raw("SUM(uriagekingaku) AS y_uriage"),
                                                                                    \DB::raw("SUM(uriagesuu) AS y_number"),
                                                                                    \DB::raw("SUM(ararikingaku) AS y_arari"),
                                                                            ])
                                                                            // 条件（売上部門の指定）
                                                                                ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                        
                                                                                    // 条件（売上部門が店舗）
                                                                                        if($out1_a == "ON"){
                                                                                            $query->orWhere('baikyakukubun', 1);
                                                                                        }
                                                                                    // 条件（売上部門が通販）
                                                                                        if($out1_b == "ON"){
                                                                                            $query->orWhere('baikyakukubun',2);
                                                                                        }
                                                                                    // 条件（売上部門が卸）
                                                                                        if($out1_c == "ON"){
                                                                                            $query->orWhere('baikyakukubun',3);
                                                                                        }
                                                                                    // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                        if($out1_d == "ON"){
                                                                                            $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                        }
                                                                            
                                                                                })
                                                                            // 条件（期間の指定）
                                                                                ->whereBetween($table_name . '.uriage', [$last_day_top, $last_day])
                                                                                
                                                                            // 条件（分類名）
                                                                                ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                                    // 条件（商品区分分類名が新品）
                                                                                        if($out2_a == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が中古）
                                                                                        if($out2_b == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がアンティーク）
                                                                                        if($out2_c == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がその他）
                                                                                        if($out2_d == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が修理）
                                                                                        if($out2_e == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                        }
                                                                            
                                                                            })
                                                                            // 条件（通販区分がヤフー）
                                                                                ->where('tsuuhankubun',3)
                                                                            // 条件（免税）
                                                                                ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                        // 条件（免税区分が0:対象外）
                                                                                            if($out4_a == "ON"){
                                                                                                $query->orwhere("menzei","like","%対象外%");
                                                                                            }
                                                                                        // 条件（免税区分が1:免税）
                                                                                            if($out4_b == "ON"){
                                                                                                $query->orwhere("menzei","like","%免税%");
                                                                                            }
                                                                                })
                                                                            // 条件（扱い部門）
                                                                                ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                                        $query->orWhere('bumonmei','');

                                                                                        // 条件（扱い部門がジャック）
                                                                                            if($out5_a == "ON"){
                                                                                                $query->orWhere('bumonmei','Jackroad');
                                                                                            }
                                                                                        // 条件（扱い部門がベティー）
                                                                                            if($out5_b == "ON"){
                                                                                                $query->orWhere('bumonmei','BettyRoad');
                                                                                            }
                                                                                        // 条件（扱い部門がジュエリー）
                                                                                            if($out5_c == "ON"){
                                                                                                $query->orWhere('bumonmei','Jewelry');
                                                                                            }
                                                                            
                                                                                })
                                                                            // ソート順指定
                                                                                ->orderBy('uriage', 'asc')
                                                                                ->get();
                                                                            // クエリビルダスタート
                                                                                // 変数リセット
                                                                                    $y_sum_uriage_progress = "";
                                                                                    $i2 = 0;
                                                                                    foreach ($y_progress as $y_buy_progress) {
                                                                                        // 各月卸売上
                                                                                        $y_sum_uriage_progress = $y_buy_progress -> y_uriage;
                                                                                        $y_sum_number_progress = $y_buy_progress -> y_number;
                                                                                        $y_sum_arari_progress  = $y_buy_progress -> y_arari;
                                                                                        $i2++;
                                                                                    }


                                                                // DB検索（その他値）スタート

                                                                        $o_progress = DB::table($table_name) 
                                                                            // 月毎にグループ化して値を分けるための処理
                                                                                ->select([
                                                                                    \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS o_month'),
                                                                                    \DB::raw("SUM(uriagekingaku) AS o_uriage"),
                                                                                    \DB::raw("SUM(uriagesuu) AS o_number"),
                                                                                    \DB::raw("SUM(ararikingaku) AS o_arari"),
                                                                            ])
                                                                            // 条件（売上部門の指定）
                                                                                ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                        
                                                                                    // 条件（売上部門が店舗）
                                                                                        if($out1_a == "ON"){
                                                                                            $query->orWhere('baikyakukubun', 1);
                                                                                        }
                                                                                    // 条件（売上部門が通販）
                                                                                        if($out1_b == "ON"){
                                                                                            $query->orWhere('baikyakukubun',2);
                                                                                        }
                                                                                    // 条件（売上部門が卸）
                                                                                        if($out1_c == "ON"){
                                                                                            $query->orWhere('baikyakukubun',3);
                                                                                        }
                                                                                    // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                        if($out1_d == "ON"){
                                                                                            $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                        }
                                                                            
                                                                                })
                                                                            // 条件（期間の指定）
                                                                                ->whereBetween($table_name . '.uriage', [$last_day_top, $last_day])
                                                                                
                                                                            // 条件（分類名）
                                                                                ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                                    // 条件（商品区分分類名が新品）
                                                                                        if($out2_a == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が中古）
                                                                                        if($out2_b == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がアンティーク）
                                                                                        if($out2_c == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がその他）
                                                                                        if($out2_d == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が修理）
                                                                                        if($out2_e == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                        }
                                                                            
                                                                            })
                                                                        // 条件（通販区分がその他「5：電話・雑誌」「4：Yオークション」「9：修理品返送」）
                                                                            //->Where([['tsuuhankubun', '==', 5], ['tsuuhankubun', '==', 4], ['tsuuhankubun', '==', 9]])
                                                                            ->where(function ($query) use ($out2_e) {
                                                                                $query->orwhere('.tsuuhankubun', 5);
                                                                                $query->orwhere('.tsuuhankubun', 4);
                                                                                    // 条件（商品区分分類名が修理）
                                                                                        if($out2_e == "ON"){
                                                                                            $query->orwhere('.tsuuhankubun', 9);
                                                                                        }
                                                                            })
                                                                        
                                                                        // 条件（免税）
                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                    // 条件（免税区分が0:対象外）
                                                                                        if($out4_a == "ON"){
                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                        }
                                                                                    // 条件（免税区分が1:免税）
                                                                                        if($out4_b == "ON"){
                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                        }
                                                                            })
                                                                        // 条件（扱い部門）
                                                                            ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                                    $query->orWhere('bumonmei','');

                                                                                    // 条件（扱い部門がジャック）
                                                                                        if($out5_a == "ON"){
                                                                                            $query->orWhere('bumonmei','Jackroad');
                                                                                        }
                                                                                    // 条件（扱い部門がベティー）
                                                                                        if($out5_b == "ON"){
                                                                                            $query->orWhere('bumonmei','BettyRoad');
                                                                                        }
                                                                                    // 条件（扱い部門がジュエリー）
                                                                                        if($out5_c == "ON"){
                                                                                            $query->orWhere('bumonmei','Jewelry');
                                                                                        }
                                                                        
                                                                            })
                                                                        // ソート順指定
                                                                            ->orderBy('uriage', 'asc')
                                                                            ->get();
                                                                        // クエリビルダスタート
                                                                            // 変数リセット
                                                                                $o_sum_uriage_progress = "";
                                                                                $i2 = 0;
                                                                                foreach ($o_progress as $o_buy_progress) {
                                                                                    // 各月卸売上
                                                                                    $o_sum_uriage_progress = $o_buy_progress -> o_uriage;
                                                                                    $o_sum_number_progress = $o_buy_progress -> o_number;
                                                                                    $o_sum_arari_progress  = $o_buy_progress -> o_arari;
                                                                                    $i2++;
                                                                                }
                                                                                

                                                        
                                            /************************************************************************************************************************************************************************************************************* */
                                                // 最終データ格納月のデータ取得　end
                                            /************************************************************************************************************************************************************************************************************* */


                                            /************************************************************************************************************************************************************************************************************* */
                                                // 先月のデータ取得（最終データ格納年月比) start
                                            /************************************************************************************************************************************************************************************************************* */
                                            
                                                                // DB検索（自社値）スタート
                                                                        $j_progress2 = DB::table($table_name) 
                                                                        // 月毎にグループ化して値を分けるための処理
                                                                            ->select([
                                                                                \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS j_month2'),
                                                                                \DB::raw("SUM(uriagekingaku) AS j_uriage2"),
                                                                                \DB::raw("SUM(uriagesuu) AS j_number2"),
                                                                                \DB::raw("SUM(ararikingaku) AS j_arari2"),
                                                                            ])
                                                                            // 条件（売上部門の指定）
                                                                                ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                        
                                                                                    // 条件（売上部門が店舗）
                                                                                        if($out1_a == "ON"){
                                                                                            $query->orWhere('baikyakukubun', 1);
                                                                                        }
                                                                                    // 条件（売上部門が通販）
                                                                                        if($out1_b == "ON"){
                                                                                            $query->orWhere('baikyakukubun',2);
                                                                                        }
                                                                                    // 条件（売上部門が卸）
                                                                                        if($out1_c == "ON"){
                                                                                            $query->orWhere('baikyakukubun',3);
                                                                                        }
                                                                                    // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                        if($out1_d == "ON"){
                                                                                            $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                        }
                                                                            
                                                                                })

                                                                            // 条件（期間の指定）
                                                                                ->whereBetween($table_name . '.uriage', [$last_month_top, $last_month])
                                                                                
                                                                            // 条件（分類名）
                                                                                ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                                    // 条件（商品区分分類名が新品）
                                                                                        if($out2_a == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が中古）
                                                                                        if($out2_b == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がアンティーク）
                                                                                        if($out2_c == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がその他）
                                                                                        if($out2_d == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が修理）
                                                                                        if($out2_e == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                        }
                                                                            
                                                                            })
                                                                        // 条件（通販区分が自社）
                                                                            ->where('tsuuhankubun',1)

                                                                        // 条件（免税）
                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                    // 条件（免税区分が0:対象外）
                                                                                        if($out4_a == "ON"){
                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                        }
                                                                                    // 条件（免税区分が1:免税）
                                                                                        if($out4_b == "ON"){
                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                        }
                                                                            })
                                                                        // 条件（扱い部門）
                                                                            ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                                    $query->orWhere('bumonmei','');

                                                                                    // 条件（扱い部門がジャック）
                                                                                        if($out5_a == "ON"){
                                                                                            $query->orWhere('bumonmei','Jackroad');
                                                                                        }
                                                                                    // 条件（扱い部門がベティー）
                                                                                        if($out5_b == "ON"){
                                                                                            $query->orWhere('bumonmei','BettyRoad');
                                                                                        }
                                                                                    // 条件（扱い部門がジュエリー）
                                                                                        if($out5_c == "ON"){
                                                                                            $query->orWhere('bumonmei','Jewelry');
                                                                                        }
                                                                        
                                                                            })
                                                                        // ソート順指定
                                                                            ->orderBy('uriage', 'asc')
                                                                            ->get();
                                                                        // クエリビルダスタート
                                                                            // 変数リセット
                                                                                $j_sum_uriage_progress2 = "";
                                                                                $i2 = 0;
                                                                                foreach ($j_progress2 as $j_buy_progress2) {
                                                                                    // 各月卸売上
                                                                                    $j_sum_uriage_progress2 = $j_buy_progress2 -> j_uriage2;
                                                                                    $j_sum_number_progress2 = $j_buy_progress2 -> j_number2;
                                                                                    $j_sum_arari_progress2 = $j_buy_progress2 -> j_arari2;
                                                                                    $i2++;
                                                                                }

                                                                // DB検索（楽天値）スタート
                                                                        $r_progress2 = DB::table($table_name) 
                                                                            // 月毎にグループ化して値を分けるための処理
                                                                                ->select([
                                                                                    \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS r_month2'),
                                                                                    \DB::raw("SUM(uriagekingaku) AS r_uriage2"),
                                                                                    \DB::raw("SUM(uriagesuu) AS r_number2"),
                                                                                    \DB::raw("SUM(ararikingaku) AS r_arari2"),
                                                                            ])
                                                                            // 条件（売上部門の指定）
                                                                                ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                        
                                                                                    // 条件（売上部門が店舗）
                                                                                        if($out1_a == "ON"){
                                                                                            $query->orWhere('baikyakukubun', 1);
                                                                                        }
                                                                                    // 条件（売上部門が通販）
                                                                                        if($out1_b == "ON"){
                                                                                            $query->orWhere('baikyakukubun',2);
                                                                                        }
                                                                                    // 条件（売上部門が卸）
                                                                                        if($out1_c == "ON"){
                                                                                            $query->orWhere('baikyakukubun',3);
                                                                                        }
                                                                                    // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                        if($out1_d == "ON"){
                                                                                            $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                        }
                                                                            
                                                                                })
                                                                            // 条件（期間の指定）
                                                                                ->whereBetween($table_name . '.uriage', [$last_month_top, $last_month])

                                                                            // 条件（分類名）
                                                                                ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                                    // 条件（商品区分分類名が新品）
                                                                                        if($out2_a == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が中古）
                                                                                        if($out2_b == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がアンティーク）
                                                                                        if($out2_c == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がその他）
                                                                                        if($out2_d == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が修理）
                                                                                        if($out2_e == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                        }
                                                                            
                                                                                })
                                                                            // 条件（通販区分が楽天）
                                                                                ->where('tsuuhankubun',2)

                                                                            // 条件（免税）
                                                                                ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                        // 条件（免税区分が0:対象外）
                                                                                            if($out4_a == "ON"){
                                                                                                $query->orwhere("menzei","like","%対象外%");
                                                                                            }
                                                                                        // 条件（免税区分が1:免税）
                                                                                            if($out4_b == "ON"){
                                                                                                $query->orwhere("menzei","like","%免税%");
                                                                                            }
                                                                                })
                                                                            // 条件（扱い部門）
                                                                                ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                                        $query->orWhere('bumonmei','');

                                                                                        // 条件（扱い部門がジャック）
                                                                                            if($out5_a == "ON"){
                                                                                                $query->orWhere('bumonmei','Jackroad');
                                                                                            }
                                                                                        // 条件（扱い部門がベティー）
                                                                                            if($out5_b == "ON"){
                                                                                                $query->orWhere('bumonmei','BettyRoad');
                                                                                            }
                                                                                        // 条件（扱い部門がジュエリー）
                                                                                            if($out5_c == "ON"){
                                                                                                $query->orWhere('bumonmei','Jewelry');
                                                                                            }
                                                                            
                                                                                })
                                                                            // ソート順指定
                                                                                ->orderBy('uriage', 'asc')
                                                                                ->get();
                                                                            // クエリビルダスタート
                                                                                // 変数リセット
                                                                                    $r_sum_uriage_progress2 = "";
                                                                                    $i2 = 0;
                                                                                    foreach ($r_progress2 as $r_buy_progress2) {
                                                                                        // 各月卸売上
                                                                                        $r_sum_uriage_progress2 = $r_buy_progress2 -> r_uriage2;
                                                                                        $r_sum_number_progress2 = $r_buy_progress2 -> r_number2;
                                                                                        $r_sum_arari_progress2  = $r_buy_progress2 -> r_arari2;
                                                                                        $i2++;
                                                                                    }


                                                                // DB検索（ヤフー値）スタート

                                                                        $y_progress2 = DB::table($table_name) 
                                                                            // 月毎にグループ化して値を分けるための処理
                                                                                ->select([
                                                                                    \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS y_month2'),
                                                                                    \DB::raw("SUM(uriagekingaku) AS y_uriage2"),
                                                                                    \DB::raw("SUM(uriagesuu) AS y_number2"),
                                                                                    \DB::raw("SUM(ararikingaku) AS y_arari2"),
                                                                            ])
                                                                            // 条件（売上部門の指定）
                                                                                ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                        
                                                                                    // 条件（売上部門が店舗）
                                                                                        if($out1_a == "ON"){
                                                                                            $query->orWhere('baikyakukubun', 1);
                                                                                        }
                                                                                    // 条件（売上部門が通販）
                                                                                        if($out1_b == "ON"){
                                                                                            $query->orWhere('baikyakukubun',2);
                                                                                        }
                                                                                    // 条件（売上部門が卸）
                                                                                        if($out1_c == "ON"){
                                                                                            $query->orWhere('baikyakukubun',3);
                                                                                        }
                                                                                    // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                        if($out1_d == "ON"){
                                                                                            $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                        }
                                                                            
                                                                                })
                                                                            // 条件（期間の指定）
                                                                                ->whereBetween($table_name . '.uriage', [$last_month_top, $last_month])
                                                                                
                                                                            // 条件（分類名）
                                                                                ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                                    // 条件（商品区分分類名が新品）
                                                                                        if($out2_a == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が中古）
                                                                                        if($out2_b == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がアンティーク）
                                                                                        if($out2_c == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がその他）
                                                                                        if($out2_d == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が修理）
                                                                                        if($out2_e == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                        }
                                                                            
                                                                            })
                                                                            // 条件（通販区分がヤフー）
                                                                                ->where('tsuuhankubun',3)
                                                                            // 条件（免税）
                                                                                ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                        // 条件（免税区分が0:対象外）
                                                                                            if($out4_a == "ON"){
                                                                                                $query->orwhere("menzei","like","%対象外%");
                                                                                            }
                                                                                        // 条件（免税区分が1:免税）
                                                                                            if($out4_b == "ON"){
                                                                                                $query->orwhere("menzei","like","%免税%");
                                                                                            }
                                                                                })
                                                                            // 条件（扱い部門）
                                                                                ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                                        $query->orWhere('bumonmei','');

                                                                                        // 条件（扱い部門がジャック）
                                                                                            if($out5_a == "ON"){
                                                                                                $query->orWhere('bumonmei','Jackroad');
                                                                                            }
                                                                                        // 条件（扱い部門がベティー）
                                                                                            if($out5_b == "ON"){
                                                                                                $query->orWhere('bumonmei','BettyRoad');
                                                                                            }
                                                                                        // 条件（扱い部門がジュエリー）
                                                                                            if($out5_c == "ON"){
                                                                                                $query->orWhere('bumonmei','Jewelry');
                                                                                            }
                                                                            
                                                                                })
                                                                            // ソート順指定
                                                                                ->orderBy('uriage', 'asc')
                                                                                ->get();
                                                                            // クエリビルダスタート
                                                                                // 変数リセット
                                                                                    $y_sum_uriage_progress2 = "";
                                                                                    $i2 = 0;
                                                                                    foreach ($y_progress2 as $y_buy_progress2) {
                                                                                        // 各月卸売上
                                                                                        $y_sum_uriage_progress2 = $y_buy_progress2 -> y_uriage2;
                                                                                        $y_sum_number_progress2 = $y_buy_progress2 -> y_number2;
                                                                                        $y_sum_arari_progress2  = $y_buy_progress2 -> y_arari2;
                                                                                        $i2++;
                                                                                    }


                                                                // DB検索（その他値）スタート

                                                                        $o_progress2 = DB::table($table_name) 
                                                                            // 月毎にグループ化して値を分けるための処理
                                                                                ->select([
                                                                                    \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS o_month2'),
                                                                                    \DB::raw("SUM(uriagekingaku) AS o_uriage2"),
                                                                                    \DB::raw("SUM(uriagesuu) AS o_number2"),
                                                                                    \DB::raw("SUM(ararikingaku) AS o_arari2"),
                                                                            ])
                                                                            // 条件（売上部門の指定）
                                                                                ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                        
                                                                                    // 条件（売上部門が店舗）
                                                                                        if($out1_a == "ON"){
                                                                                            $query->orWhere('baikyakukubun', 1);
                                                                                        }
                                                                                    // 条件（売上部門が通販）
                                                                                        if($out1_b == "ON"){
                                                                                            $query->orWhere('baikyakukubun',2);
                                                                                        }
                                                                                    // 条件（売上部門が卸）
                                                                                        if($out1_c == "ON"){
                                                                                            $query->orWhere('baikyakukubun',3);
                                                                                        }
                                                                                    // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                        if($out1_d == "ON"){
                                                                                            $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                        }
                                                                            
                                                                                })
                                                                            // 条件（期間の指定）
                                                                                ->whereBetween($table_name . '.uriage', [$last_month_top, $last_month])
                                                                                
                                                                            // 条件（分類名）
                                                                                ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                                    // 条件（商品区分分類名が新品）
                                                                                        if($out2_a == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が中古）
                                                                                        if($out2_b == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がアンティーク）
                                                                                        if($out2_c == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がその他）
                                                                                        if($out2_d == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が修理）
                                                                                        if($out2_e == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                        }
                                                                            
                                                                            })
                                                                        // 条件（通販区分がその他「5：電話・雑誌」「4：Yオークション」「9：修理品返送」）
                                                                            //->Where([['tsuuhankubun', '==', 5], ['tsuuhankubun', '==', 4], ['tsuuhankubun', '==', 9]])
                                                                            ->where(function ($query) use ($out2_e) {
                                                                                $query->orwhere('.tsuuhankubun', 5);
                                                                                $query->orwhere('.tsuuhankubun', 4);
                                                                                    // 条件（商品区分分類名が修理）
                                                                                        if($out2_e == "ON"){
                                                                                            $query->orwhere('.tsuuhankubun', 9);
                                                                                        }
                                                                            })
                                                                        // 条件（免税）
                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                    // 条件（免税区分が0:対象外）
                                                                                        if($out4_a == "ON"){
                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                        }
                                                                                    // 条件（免税区分が1:免税）
                                                                                        if($out4_b == "ON"){
                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                        }
                                                                            })
                                                                        // 条件（扱い部門）
                                                                            ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                                    $query->orWhere('bumonmei','');

                                                                                    // 条件（扱い部門がジャック）
                                                                                        if($out5_a == "ON"){
                                                                                            $query->orWhere('bumonmei','Jackroad');
                                                                                        }
                                                                                    // 条件（扱い部門がベティー）
                                                                                        if($out5_b == "ON"){
                                                                                            $query->orWhere('bumonmei','BettyRoad');
                                                                                        }
                                                                                    // 条件（扱い部門がジュエリー）
                                                                                        if($out5_c == "ON"){
                                                                                            $query->orWhere('bumonmei','Jewelry');
                                                                                        }
                                                                        
                                                                            })
                                                                        // ソート順指定
                                                                            ->orderBy('uriage', 'asc')
                                                                            ->get();
                                                                        // クエリビルダスタート
                                                                            // 変数リセット
                                                                                $o_sum_uriage_progress2 = "";
                                                                                $i2 = 0;
                                                                                foreach ($o_progress2 as $o_buy_progress2) {
                                                                                    // 各月卸売上
                                                                                    $o_sum_uriage_progress2 = $o_buy_progress2 -> o_uriage2;
                                                                                    $o_sum_number_progress2 = $o_buy_progress2 -> o_number2;
                                                                                    $o_sum_arari_progress2  = $o_buy_progress2 -> o_arari2;
                                                                                    $i2++;
                                                                                }
                                            
                                            
                                            
                                            /************************************************************************************************************************************************************************************************************* */
                                                // 先月のデータ取得（最終データ格納年月比) start
                                            /************************************************************************************************************************************************************************************************************* */

                            
                                            /************************************************************************************************************************************************************************************************************* */
                                                // 検索期間の月数だけ遡った年月のデータ取得（最終データ格納年月比) start
                                            /************************************************************************************************************************************************************************************************************* */
                                            
                                                                // DB検索（自社値）スタート
                                                                        $j_progress3 = DB::table($table_name) 
                                                                        // 月毎にグループ化して値を分けるための処理
                                                                            ->select([
                                                                                \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS j_month3'),
                                                                                \DB::raw("SUM(uriagekingaku) AS j_uriage3"),
                                                                                \DB::raw("SUM(uriagesuu) AS j_number3"),
                                                                                \DB::raw("SUM(ararikingaku) AS j_arari3"),
                                                                            ])
                                                                            // 条件（売上部門の指定）
                                                                                ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                        
                                                                                    // 条件（売上部門が店舗）
                                                                                        if($out1_a == "ON"){
                                                                                            $query->orWhere('baikyakukubun', 1);
                                                                                        }
                                                                                    // 条件（売上部門が通販）
                                                                                        if($out1_b == "ON"){
                                                                                            $query->orWhere('baikyakukubun',2);
                                                                                        }
                                                                                    // 条件（売上部門が卸）
                                                                                        if($out1_c == "ON"){
                                                                                            $query->orWhere('baikyakukubun',3);
                                                                                        }
                                                                                    // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                        if($out1_d == "ON"){
                                                                                            $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                        }
                                                                            
                                                                                })

                                                                            // 条件（期間の指定）
                                                                                ->whereBetween($table_name . '.uriage', [$past_between_start_progress, $past_between_end_progress])
                                                                                
                                                                            // 条件（分類名）
                                                                                ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                                    // 条件（商品区分分類名が新品）
                                                                                        if($out2_a == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が中古）
                                                                                        if($out2_b == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がアンティーク）
                                                                                        if($out2_c == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がその他）
                                                                                        if($out2_d == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が修理）
                                                                                        if($out2_e == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                        }
                                                                            
                                                                            })
                                                                        // 条件（通販区分が自社）
                                                                            ->where('tsuuhankubun',1)

                                                                        // 条件（免税）
                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                    // 条件（免税区分が0:対象外）
                                                                                        if($out4_a == "ON"){
                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                        }
                                                                                    // 条件（免税区分が1:免税）
                                                                                        if($out4_b == "ON"){
                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                        }
                                                                            })
                                                                        // 条件（扱い部門）
                                                                            ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                                    $query->orWhere('bumonmei','');

                                                                                    // 条件（扱い部門がジャック）
                                                                                        if($out5_a == "ON"){
                                                                                            $query->orWhere('bumonmei','Jackroad');
                                                                                        }
                                                                                    // 条件（扱い部門がベティー）
                                                                                        if($out5_b == "ON"){
                                                                                            $query->orWhere('bumonmei','BettyRoad');
                                                                                        }
                                                                                    // 条件（扱い部門がジュエリー）
                                                                                        if($out5_c == "ON"){
                                                                                            $query->orWhere('bumonmei','Jewelry');
                                                                                        }
                                                                        
                                                                            })
                                                                        // ソート順指定
                                                                            ->orderBy('uriage', 'asc')
                                                                            ->get();
                                                                        // クエリビルダスタート
                                                                            // 変数リセット
                                                                                $j_sum_uriage_progress3 = "";
                                                                                $i2 = 0;
                                                                                foreach ($j_progress3 as $j_buy_progress3) {
                                                                                    // 各月卸売上
                                                                                    $j_sum_uriage_progress3 = $j_buy_progress3 -> j_uriage3;
                                                                                    $j_sum_number_progress3 = $j_buy_progress3 -> j_number3;
                                                                                    $j_sum_arari_progress3 = $j_buy_progress3 -> j_arari3;
                                                                                    $i2++;
                                                                                }

                                                                // DB検索（楽天値）スタート
                                                                        $r_progress3 = DB::table($table_name) 
                                                                            // 月毎にグループ化して値を分けるための処理
                                                                                ->select([
                                                                                    \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS r_month3'),
                                                                                    \DB::raw("SUM(uriagekingaku) AS r_uriage3"),
                                                                                    \DB::raw("SUM(uriagesuu) AS r_number3"),
                                                                                    \DB::raw("SUM(ararikingaku) AS r_arari3"),
                                                                            ])
                                                                            // 条件（売上部門の指定）
                                                                                ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                        
                                                                                    // 条件（売上部門が店舗）
                                                                                        if($out1_a == "ON"){
                                                                                            $query->orWhere('baikyakukubun', 1);
                                                                                        }
                                                                                    // 条件（売上部門が通販）
                                                                                        if($out1_b == "ON"){
                                                                                            $query->orWhere('baikyakukubun',2);
                                                                                        }
                                                                                    // 条件（売上部門が卸）
                                                                                        if($out1_c == "ON"){
                                                                                            $query->orWhere('baikyakukubun',3);
                                                                                        }
                                                                                    // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                        if($out1_d == "ON"){
                                                                                            $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                        }
                                                                            
                                                                                })
                                                                            // 条件（期間の指定）
                                                                                ->whereBetween($table_name . '.uriage', [$past_between_start_progress, $past_between_end_progress])

                                                                            // 条件（分類名）
                                                                                ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                                    // 条件（商品区分分類名が新品）
                                                                                        if($out2_a == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が中古）
                                                                                        if($out2_b == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がアンティーク）
                                                                                        if($out2_c == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がその他）
                                                                                        if($out2_d == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が修理）
                                                                                        if($out2_e == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                        }
                                                                            
                                                                                })
                                                                            // 条件（通販区分が楽天）
                                                                                ->where('tsuuhankubun',2)

                                                                            // 条件（免税）
                                                                                ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                        // 条件（免税区分が0:対象外）
                                                                                            if($out4_a == "ON"){
                                                                                                $query->orwhere("menzei","like","%対象外%");
                                                                                            }
                                                                                        // 条件（免税区分が1:免税）
                                                                                            if($out4_b == "ON"){
                                                                                                $query->orwhere("menzei","like","%免税%");
                                                                                            }
                                                                                })
                                                                            // 条件（扱い部門）
                                                                                ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                                        $query->orWhere('bumonmei','');

                                                                                        // 条件（扱い部門がジャック）
                                                                                            if($out5_a == "ON"){
                                                                                                $query->orWhere('bumonmei','Jackroad');
                                                                                            }
                                                                                        // 条件（扱い部門がベティー）
                                                                                            if($out5_b == "ON"){
                                                                                                $query->orWhere('bumonmei','BettyRoad');
                                                                                            }
                                                                                        // 条件（扱い部門がジュエリー）
                                                                                            if($out5_c == "ON"){
                                                                                                $query->orWhere('bumonmei','Jewelry');
                                                                                            }
                                                                            
                                                                                })
                                                                            // ソート順指定
                                                                                ->orderBy('uriage', 'asc')
                                                                                ->get();
                                                                            // クエリビルダスタート
                                                                                // 変数リセット
                                                                                    $r_sum_uriage_progress3 = "";
                                                                                    $i2 = 0;
                                                                                    foreach ($r_progress3 as $r_buy_progress3) {
                                                                                        // 各月卸売上
                                                                                        $r_sum_uriage_progress3 = $r_buy_progress3 -> r_uriage3;
                                                                                        $r_sum_number_progress3 = $r_buy_progress3 -> r_number3;
                                                                                        $r_sum_arari_progress3  = $r_buy_progress3 -> r_arari3;
                                                                                        $i2++;
                                                                                    }


                                                                // DB検索（ヤフー値）スタート

                                                                        $y_progress3 = DB::table($table_name) 
                                                                            // 月毎にグループ化して値を分けるための処理
                                                                                ->select([
                                                                                    \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS y_month3'),
                                                                                    \DB::raw("SUM(uriagekingaku) AS y_uriage3"),
                                                                                    \DB::raw("SUM(uriagesuu) AS y_number3"),
                                                                                    \DB::raw("SUM(ararikingaku) AS y_arari3"),
                                                                            ])
                                                                            // 条件（売上部門の指定）
                                                                                ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                        
                                                                                    // 条件（売上部門が店舗）
                                                                                        if($out1_a == "ON"){
                                                                                            $query->orWhere('baikyakukubun', 1);
                                                                                        }
                                                                                    // 条件（売上部門が通販）
                                                                                        if($out1_b == "ON"){
                                                                                            $query->orWhere('baikyakukubun',2);
                                                                                        }
                                                                                    // 条件（売上部門が卸）
                                                                                        if($out1_c == "ON"){
                                                                                            $query->orWhere('baikyakukubun',3);
                                                                                        }
                                                                                    // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                        if($out1_d == "ON"){
                                                                                            $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                        }
                                                                            
                                                                                })
                                                                            // 条件（期間の指定）
                                                                                ->whereBetween($table_name . '.uriage', [$past_between_start_progress, $past_between_end_progress])
                                                                                
                                                                            // 条件（分類名）
                                                                                ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                                    // 条件（商品区分分類名が新品）
                                                                                        if($out2_a == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が中古）
                                                                                        if($out2_b == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がアンティーク）
                                                                                        if($out2_c == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がその他）
                                                                                        if($out2_d == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が修理）
                                                                                        if($out2_e == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                        }
                                                                            
                                                                            })
                                                                            // 条件（通販区分がヤフー）
                                                                                ->where('tsuuhankubun',3)
                                                                            // 条件（免税）
                                                                                ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                        // 条件（免税区分が0:対象外）
                                                                                            if($out4_a == "ON"){
                                                                                                $query->orwhere("menzei","like","%対象外%");
                                                                                            }
                                                                                        // 条件（免税区分が1:免税）
                                                                                            if($out4_b == "ON"){
                                                                                                $query->orwhere("menzei","like","%免税%");
                                                                                            }
                                                                                })
                                                                            // 条件（扱い部門）
                                                                                ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                                        $query->orWhere('bumonmei','');

                                                                                        // 条件（扱い部門がジャック）
                                                                                            if($out5_a == "ON"){
                                                                                                $query->orWhere('bumonmei','Jackroad');
                                                                                            }
                                                                                        // 条件（扱い部門がベティー）
                                                                                            if($out5_b == "ON"){
                                                                                                $query->orWhere('bumonmei','BettyRoad');
                                                                                            }
                                                                                        // 条件（扱い部門がジュエリー）
                                                                                            if($out5_c == "ON"){
                                                                                                $query->orWhere('bumonmei','Jewelry');
                                                                                            }
                                                                            
                                                                                })
                                                                            // ソート順指定
                                                                                ->orderBy('uriage', 'asc')
                                                                                ->get();
                                                                            // クエリビルダスタート
                                                                                // 変数リセット
                                                                                    $y_sum_uriage_progress3 = "";
                                                                                    $i2 = 0;
                                                                                    foreach ($y_progress3 as $y_buy_progress3) {
                                                                                        // 各月卸売上
                                                                                        $y_sum_uriage_progress3 = $y_buy_progress3 -> y_uriage3;
                                                                                        $y_sum_number_progress3 = $y_buy_progress3 -> y_number3;
                                                                                        $y_sum_arari_progress3  = $y_buy_progress3 -> y_arari3;
                                                                                        $i2++;
                                                                                    }


                                                                // DB検索（その他値）スタート

                                                                        $o_progress3 = DB::table($table_name) 
                                                                            // 月毎にグループ化して値を分けるための処理
                                                                                ->select([
                                                                                    \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS o_month3'),
                                                                                    \DB::raw("SUM(uriagekingaku) AS o_uriage3"),
                                                                                    \DB::raw("SUM(uriagesuu) AS o_number3"),
                                                                                    \DB::raw("SUM(ararikingaku) AS o_arari3"),
                                                                            ])
                                                                            // 条件（売上部門の指定）
                                                                                ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                        
                                                                                    // 条件（売上部門が店舗）
                                                                                        if($out1_a == "ON"){
                                                                                            $query->orWhere('baikyakukubun', 1);
                                                                                        }
                                                                                    // 条件（売上部門が通販）
                                                                                        if($out1_b == "ON"){
                                                                                            $query->orWhere('baikyakukubun',2);
                                                                                        }
                                                                                    // 条件（売上部門が卸）
                                                                                        if($out1_c == "ON"){
                                                                                            $query->orWhere('baikyakukubun',3);
                                                                                        }
                                                                                    // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                        if($out1_d == "ON"){
                                                                                            $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                        }
                                                                            
                                                                                })
                                                                            // 条件（期間の指定）
                                                                                ->whereBetween($table_name . '.uriage', [$past_between_start_progress, $past_between_end_progress])
                                                                                
                                                                            // 条件（分類名）
                                                                                ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                                    // 条件（商品区分分類名が新品）
                                                                                        if($out2_a == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が中古）
                                                                                        if($out2_b == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がアンティーク）
                                                                                        if($out2_c == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                        }
                                                                                    // 条件（商品区分分類名がその他）
                                                                                        if($out2_d == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                        }
                                                                                    // 条件（商品区分分類名が修理）
                                                                                        if($out2_e == "ON"){
                                                                                            $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                        }
                                                                            
                                                                            })
                                                                        // 条件（通販区分がその他「5：電話・雑誌」「4：Yオークション」「9：修理品返送」）
                                                                            //->Where([['tsuuhankubun', '==', 5], ['tsuuhankubun', '==', 4], ['tsuuhankubun', '==', 9]])
                                                                            ->where(function ($query) use ($out2_e) {
                                                                                $query->orwhere('.tsuuhankubun', 5);
                                                                                $query->orwhere('.tsuuhankubun', 4);
                                                                                    // 条件（商品区分分類名が修理）
                                                                                        if($out2_e == "ON"){
                                                                                            $query->orwhere('.tsuuhankubun', 9);
                                                                                        }
                                                                            })
                                                                        // 条件（免税）
                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                    // 条件（免税区分が0:対象外）
                                                                                        if($out4_a == "ON"){
                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                        }
                                                                                    // 条件（免税区分が1:免税）
                                                                                        if($out4_b == "ON"){
                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                        }
                                                                            })
                                                                        // 条件（扱い部門）
                                                                            ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                                    $query->orWhere('bumonmei','');

                                                                                    // 条件（扱い部門がジャック）
                                                                                        if($out5_a == "ON"){
                                                                                            $query->orWhere('bumonmei','Jackroad');
                                                                                        }
                                                                                    // 条件（扱い部門がベティー）
                                                                                        if($out5_b == "ON"){
                                                                                            $query->orWhere('bumonmei','BettyRoad');
                                                                                        }
                                                                                    // 条件（扱い部門がジュエリー）
                                                                                        if($out5_c == "ON"){
                                                                                            $query->orWhere('bumonmei','Jewelry');
                                                                                        }
                                                                        
                                                                            })
                                                                        // ソート順指定
                                                                            ->orderBy('uriage', 'asc')
                                                                            ->get();
                                                                        // クエリビルダスタート
                                                                            // 変数リセット
                                                                                $o_sum_uriage_progress3 = "";
                                                                                $i2 = 0;
                                                                                foreach ($o_progress3 as $o_buy_progress3) {
                                                                                    // 各月卸売上
                                                                                    $o_sum_uriage_progress3 = $o_buy_progress3 -> o_uriage3;
                                                                                    $o_sum_number_progress3 = $o_buy_progress3 -> o_number3;
                                                                                    $o_sum_arari_progress3  = $o_buy_progress3 -> o_arari3;
                                                                                    $i2++;
                                                                                }
                                            
                                            
                                            
                                            /************************************************************************************************************************************************************************************************************* */
                                                // 検索期間の月数だけ遡った年月のデータ取得（最終データ格納年月比) end
                                            /************************************************************************************************************************************************************************************************************* */
                            
                            
                            
                                            /************************************************************************************************************************************************************************************************************* */
                                                // 各月間予測値と過去比を取得 start
                                            /************************************************************************************************************************************************************************************************************* */

                                                    // 予測値
                                                            // 自社・月間売上額予測
                                                                if($j_sum_uriage_progress <> "" && $j_sum_uriage_progress <> 0){
                                                                    $j_sum_uriage_progress_pre = (float)((int)$j_sum_uriage_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                } else {
                                                                    $j_sum_uriage_progress_pre = "";
                                                                }
                                                            // 自社・月間売上点数予測
                                                                if($j_sum_number_progress <> "" && $j_sum_number_progress <> 0){
                                                                    $j_sum_number_progress_pre = (float)((int)$j_sum_number_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                } else {
                                                                    $j_sum_number_progress_pre = "";
                                                                }
                                                            // 自社・月間売上粗利予測
                                                                if($j_sum_arari_progress <> "" && $j_sum_arari_progress <> 0){
                                                                    $j_sum_arari_progress_pre = (float)((int)$j_sum_arari_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                } else {
                                                                    $j_sum_arari_progress_pre = "";
                                                                }

                                                            // 楽天・月間売上額予測
                                                                if($r_sum_uriage_progress <> "" && $r_sum_uriage_progress <> 0){
                                                                    $r_sum_uriage_progress_pre = (float)((int)$r_sum_uriage_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                } else {
                                                                    $r_sum_uriage_progress_pre = "";
                                                                }
                                                            // 楽天・月間売上点数予測
                                                                if($r_sum_number_progress <> "" && $r_sum_number_progress <> 0){
                                                                    $r_sum_number_progress_pre = (float)((int)$r_sum_number_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                } else {
                                                                    $r_sum_number_progress_pre = "";
                                                                }
                                                            // 楽天・月間売上粗利予測
                                                                if($r_sum_arari_progress <> "" && $r_sum_arari_progress <> 0){
                                                                    $r_sum_arari_progress_pre = (float)((int)$r_sum_arari_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                } else {
                                                                    $r_sum_arari_progress_pre = "";
                                                                }
                                                            // ヤフー・月間売上額予測
                                                                if($y_sum_uriage_progress <> "" && $y_sum_uriage_progress <> 0){
                                                                    $y_sum_uriage_progress_pre = (float)((int)$y_sum_uriage_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                } else {
                                                                    $y_sum_uriage_progress_pre = "";
                                                                }
                                                            // ヤフー・月間売上点数予測
                                                                if($y_sum_number_progress <> "" && $y_sum_number_progress <> 0){
                                                                    $y_sum_number_progress_pre = (float)((int)$y_sum_number_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                } else {
                                                                    $y_sum_number_progress_pre = "";
                                                                }
                                                            // ヤフー・月間売上粗利予測
                                                                if($y_sum_arari_progress <> "" && $y_sum_arari_progress <> 0){
                                                                    $y_sum_arari_progress_pre = (float)((int)$y_sum_arari_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                } else {
                                                                    $y_sum_arari_progress_pre = "";
                                                                }
                                                            // その他・月間売上額予測
                                                                if($o_sum_uriage_progress <> "" && $o_sum_uriage_progress <> 0){
                                                                    $o_sum_uriage_progress_pre = (float)((int)$o_sum_uriage_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                } else {
                                                                    $o_sum_uriage_progress_pre = "";
                                                                }
                                                            // その他・月間売上点数予測
                                                                if($o_sum_number_progress <> "" && $o_sum_number_progress <> 0){
                                                                    $o_sum_number_progress_pre = (float)((int)$o_sum_number_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                } else {
                                                                    $o_sum_number_progress_pre = "";
                                                                }
                                                            // その他・月間売上粗利予測
                                                                if($o_sum_arari_progress <> "" && $o_sum_arari_progress <> 0){
                                                                    $o_sum_arari_progress_pre = (float)((int)$o_sum_arari_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                } else {
                                                                    $o_sum_arari_progress_pre = "";
                                                                }
                                                                
                                                        
                                                    // 先月比
                                                            // 自社・売上額予測・先月比
                                                                if($j_sum_uriage_progress_pre <> "" && $j_sum_uriage_progress_pre <> 0 && $j_sum_uriage_progress2 <> "" && $j_sum_uriage_progress2 <> 0){
                                                                    $j_sum_uriage_progress_pre2 = (floor(((float)$j_sum_uriage_progress_pre / (float)$j_sum_uriage_progress2) * 100 * 10)) / 10;
                                                                } else {
                                                                    $j_sum_uriage_progress_pre2 = "---";
                                                                }

                                                            // 自社・売上点数予測・先月比
                                                                if($j_sum_number_progress_pre <> "" && $j_sum_number_progress_pre <> 0 && $j_sum_number_progress2 <> "" && $j_sum_number_progress2 <> 0){
                                                                    $j_sum_number_progress_pre2 = (floor(((float)$j_sum_number_progress_pre / (float)$j_sum_number_progress2) * 100 * 10)) / 10;
                                                                } else {
                                                                    $j_sum_number_progress_pre2 = "---";
                                                                }

                                                            // 自社・売上粗利予測・先月比
                                                                if($j_sum_arari_progress_pre <> "" && $j_sum_arari_progress_pre <> 0 && $j_sum_arari_progress2 <> "" && $j_sum_arari_progress2 <> 0){
                                                                    $j_sum_arari_progress_pre2 = (floor(((float)$j_sum_arari_progress_pre / (float)$j_sum_arari_progress2) * 100 * 10)) / 10;
                                                                } else {
                                                                    $j_sum_arari_progress_pre2 = "---";
                                                                }

                                                            // 楽天・売上額予測・先月比
                                                                if($r_sum_uriage_progress_pre <> "" && $r_sum_uriage_progress_pre <> 0 && $r_sum_uriage_progress2 <> "" && $r_sum_uriage_progress2 <> 0){
                                                                    $r_sum_uriage_progress_pre2 = (floor(((float)$r_sum_uriage_progress_pre / (float)$r_sum_uriage_progress2) * 100 * 10)) / 10;
                                                                } else {
                                                                    $r_sum_uriage_progress_pre2 = "---";
                                                                }

                                                            // 楽天・売上点数予測・先月比
                                                                if($r_sum_number_progress_pre <> "" && $r_sum_number_progress_pre <> 0 && $r_sum_number_progress2 <> "" && $r_sum_number_progress2 <> 0){
                                                                    $r_sum_number_progress_pre2 = (floor(((float)$r_sum_number_progress_pre / (float)$r_sum_number_progress2) * 100 * 10)) / 10;
                                                                } else {
                                                                    $r_sum_number_progress_pre2 = "---";
                                                                }

                                                            // 楽天・売上粗利予測・先月比
                                                                if($r_sum_arari_progress_pre <> "" && $r_sum_arari_progress_pre <> 0 && $r_sum_arari_progress2 <> "" && $r_sum_arari_progress2 <> 0){
                                                                    $r_sum_arari_progress_pre2 = (floor(((float)$r_sum_arari_progress_pre / (float)$r_sum_arari_progress2) * 100 * 10)) / 10;
                                                                } else {
                                                                    $r_sum_arari_progress_pre2 = "---";
                                                                }

                                                            // ヤフー・売上額予測・先月比
                                                                if($y_sum_uriage_progress_pre <> "" && $y_sum_uriage_progress_pre <> 0 && $y_sum_uriage_progress2 <> "" && $y_sum_uriage_progress2 <> 0){
                                                                    $y_sum_uriage_progress_pre2 = (floor(((float)$y_sum_uriage_progress_pre / (float)$y_sum_uriage_progress2) * 100 * 10)) / 10;
                                                                } else {
                                                                    $y_sum_uriage_progress_pre2 = "---";
                                                                }

                                                            // ヤフー・売上点数予測・先月比
                                                                if($y_sum_number_progress_pre <> "" && $y_sum_number_progress_pre <> 0 && $y_sum_number_progress2 <> "" && $y_sum_number_progress2 <> 0){
                                                                    $y_sum_number_progress_pre2 = (floor(((float)$y_sum_number_progress_pre / (float)$y_sum_number_progress2) * 100 * 10)) / 10;
                                                                } else {
                                                                    $y_sum_number_progress_pre2 = "---";
                                                                }

                                                            // ヤフー・売上粗利予測・先月比
                                                                if($y_sum_arari_progress_pre <> "" && $y_sum_arari_progress_pre <> 0 && $y_sum_arari_progress2 <> "" && $y_sum_arari_progress2 <> 0){
                                                                    $y_sum_arari_progress_pre2 = (floor(((float)$y_sum_arari_progress_pre / (float)$y_sum_arari_progress2) * 100 * 10)) / 10;
                                                                } else {
                                                                    $y_sum_arari_progress_pre2 = "---";
                                                                }
                                                            // その他・売上額予測・先月比
                                                                if($o_sum_uriage_progress_pre <> "" && $o_sum_uriage_progress_pre <> 0 && $o_sum_uriage_progress2 <> "" && $o_sum_uriage_progress2 <> 0){
                                                                    $o_sum_uriage_progress_pre2 = (floor(((float)$o_sum_uriage_progress_pre / (float)$o_sum_uriage_progress2) * 100 * 10)) / 10;
                                                                } else {
                                                                    $o_sum_uriage_progress_pre2 = "---";
                                                                }

                                                            // その他・売上点数予測・先月比
                                                                if($o_sum_number_progress_pre <> "" && $o_sum_number_progress_pre <> 0 && $o_sum_number_progress2 <> "" && $o_sum_number_progress2 <> 0){
                                                                    $o_sum_number_progress_pre2 = (floor(((float)$o_sum_number_progress_pre / (float)$o_sum_number_progress2) * 100 * 10)) / 10;
                                                                } else {
                                                                    $o_sum_number_progress_pre2 = "---";
                                                                }

                                                            // その他・売上粗利予測・先月比
                                                                if($o_sum_arari_progress_pre <> "" && $o_sum_arari_progress_pre <> 0 && $o_sum_arari_progress2 <> "" && $o_sum_arari_progress2 <> 0){
                                                                    $o_sum_arari_progress_pre2 = (floor(((float)$o_sum_arari_progress_pre / (float)$o_sum_arari_progress2) * 100 * 10)) / 10;
                                                                } else {
                                                                    $o_sum_arari_progress_pre2 = "---";
                                                                }
                                                                
                                                    // 過去比
                                                            // 自社・売上額予測・過去比
                                                                if($j_sum_uriage_progress_pre <> "" && $j_sum_uriage_progress_pre <> 0 && $j_sum_uriage_progress3 <> "" && $j_sum_uriage_progress3 <> 0){
                                                                    $j_sum_uriage_progress_pre3 = (floor(((float)$j_sum_uriage_progress_pre / (float)$j_sum_uriage_progress3) * 100 * 10)) / 10;
                                                                } else {
                                                                    $j_sum_uriage_progress_pre3 = "---";
                                                                }
                                                            // 自社・売上点数予測・過去比
                                                                if($j_sum_number_progress_pre <> "" && $j_sum_number_progress_pre <> 0 && $j_sum_number_progress3 <> "" && $j_sum_number_progress3 <> 0){
                                                                    $j_sum_number_progress_pre3 = (floor(((float)$j_sum_number_progress_pre / (float)$j_sum_number_progress3) * 100 * 10)) / 10;
                                                                } else {
                                                                    $j_sum_number_progress_pre3 = "---";
                                                                }
                                                            // 自社・売上粗利予測・過去比
                                                                if($j_sum_arari_progress_pre <> "" && $j_sum_arari_progress_pre <> 0 && $j_sum_arari_progress3 <> "" && $j_sum_arari_progress3 <> 0){
                                                                    $j_sum_arari_progress_pre3 = (floor(((float)$j_sum_arari_progress_pre / (float)$j_sum_arari_progress3) * 100 * 10)) / 10;
                                                                } else {
                                                                    $j_sum_arari_progress_pre3 = "---";
                                                                }
                                                                
                                                            // 楽天・売上額予測・過去比
                                                                if($r_sum_uriage_progress_pre <> "" && $r_sum_uriage_progress_pre <> 0 && $r_sum_uriage_progress3 <> "" && $r_sum_uriage_progress3 <> 0){
                                                                    $r_sum_uriage_progress_pre3 = (floor(((float)$r_sum_uriage_progress_pre / (float)$r_sum_uriage_progress3) * 100 * 10)) / 10;
                                                                } else {
                                                                    $r_sum_uriage_progress_pre3 = "---";
                                                                }
                                                            // 楽天・売上点数予測・過去比
                                                                if($r_sum_number_progress_pre <> "" && $r_sum_number_progress_pre <> 0 && $r_sum_number_progress3 <> "" && $r_sum_number_progress3 <> 0){
                                                                    $r_sum_number_progress_pre3 = (floor(((float)$r_sum_number_progress_pre / (float)$r_sum_number_progress3) * 100 * 10)) / 10;
                                                                } else {
                                                                    $r_sum_number_progress_pre3 = "---";
                                                                }
                                                            // 楽天・売上粗利予測・過去比
                                                                if($r_sum_arari_progress_pre <> "" && $r_sum_arari_progress_pre <> 0 && $r_sum_arari_progress3 <> "" && $r_sum_arari_progress3 <> 0){
                                                                    $r_sum_arari_progress_pre3 = (floor(((float)$r_sum_arari_progress_pre / (float)$r_sum_arari_progress3) * 100 * 10)) / 10;
                                                                } else {
                                                                    $r_sum_arari_progress_pre3 = "---";
                                                                }
                                                            // ヤフー・売上額予測・過去比
                                                                if($y_sum_uriage_progress_pre <> "" && $y_sum_uriage_progress_pre <> 0 && $y_sum_uriage_progress3 <> "" && $y_sum_uriage_progress3 <> 0){
                                                                    $y_sum_uriage_progress_pre3 = (floor(((float)$y_sum_uriage_progress_pre / (float)$y_sum_uriage_progress3) * 100 * 10)) / 10;
                                                                } else {
                                                                    $y_sum_uriage_progress_pre3 = "---";
                                                                }
                                                            // ヤフー・売上点数予測・過去比
                                                                if($y_sum_number_progress_pre <> "" && $y_sum_number_progress_pre <> 0 && $y_sum_number_progress3 <> "" && $y_sum_number_progress3 <> 0){
                                                                    $y_sum_number_progress_pre3 = (floor(((float)$y_sum_number_progress_pre / (float)$y_sum_number_progress3) * 100 * 10)) / 10;
                                                                } else {
                                                                    $y_sum_number_progress_pre3 = "---";
                                                                }
                                                            // ヤフー・売上粗利予測・過去比
                                                                if($y_sum_arari_progress_pre <> "" && $y_sum_arari_progress_pre <> 0 && $y_sum_arari_progress3 <> "" && $y_sum_arari_progress3 <> 0){
                                                                    $y_sum_arari_progress_pre3 = (floor(((float)$y_sum_arari_progress_pre / (float)$y_sum_arari_progress3) * 100 * 10)) / 10;
                                                                } else {
                                                                    $y_sum_arari_progress_pre3 = "---";
                                                                }
                                                            // その他・売上額予測・過去比
                                                                if($o_sum_uriage_progress_pre <> "" && $o_sum_uriage_progress_pre <> 0 && $o_sum_uriage_progress3 <> "" && $o_sum_uriage_progress3 <> 0){
                                                                    $o_sum_uriage_progress_pre3 = (floor(((float)$o_sum_uriage_progress_pre / (float)$o_sum_uriage_progress3) * 100 * 10)) / 10;
                                                                } else {
                                                                    $o_sum_uriage_progress_pre3 = "---";
                                                                }
                                                            // その他・売上点数予測・過去比
                                                                if($o_sum_number_progress_pre <> "" && $o_sum_number_progress_pre <> 0 && $o_sum_number_progress3 <> "" && $o_sum_number_progress3 <> 0){
                                                                    $o_sum_number_progress_pre3 = (floor(((float)$o_sum_number_progress_pre / (float)$o_sum_number_progress3) * 100 * 10)) / 10;
                                                                } else {
                                                                    $o_sum_number_progress_pre3 = "---";
                                                                }
                                                            // その他・売上粗利予測・過去比
                                                                if($o_sum_arari_progress_pre <> "" && $o_sum_arari_progress_pre <> 0 && $o_sum_arari_progress3 <> "" && $o_sum_arari_progress3 <> 0){
                                                                    $o_sum_arari_progress_pre3 = (floor(((float)$o_sum_arari_progress_pre / (float)$o_sum_arari_progress3) * 100 * 10)) / 10;
                                                                } else {
                                                                    $o_sum_arari_progress_pre3 = "---";
                                                                }
                                                                

                                                    // 合計値
                                                            // データ格納最終月・売上額進捗合計
                                                                $all_sum_uriage_progress = (int)$j_sum_uriage_progress + (int)$r_sum_uriage_progress + (int)$y_sum_uriage_progress + (int)$o_sum_uriage_progress;
                                                            // データ格納最終月・売上点数進捗合計
                                                                $all_sum_number_progress = (int)$j_sum_number_progress + (int)$r_sum_number_progress + (int)$y_sum_number_progress + (int)$o_sum_number_progress;
                                                            // データ格納最終月・売上粗利進捗合計
                                                                $all_sum_arari_progress = (int)$j_sum_arari_progress + (int)$r_sum_arari_progress + (int)$y_sum_arari_progress + (int)$o_sum_arari_progress;

                                                            // データ格納最終月・売上額・着地予測合計
                                                                $all_sum_uriage_progress_pre = (int)$j_sum_uriage_progress_pre + (int)$r_sum_uriage_progress_pre + (int)$y_sum_uriage_progress_pre + (int)$o_sum_uriage_progress_pre;
                                                            // データ格納最終月・売上点数・着地予測合計
                                                                $all_sum_number_progress_pre = (int)$j_sum_number_progress_pre + (int)$r_sum_number_progress_pre + (int)$y_sum_number_progress_pre + (int)$o_sum_number_progress_pre;
                                                            // データ格納最終月・売上粗利・着地予測合計
                                                                $all_sum_arari_progress_pre = (int)$j_sum_arari_progress_pre + (int)$r_sum_arari_progress_pre + (int)$y_sum_arari_progress_pre + (int)$o_sum_arari_progress_pre;

                                                            // 進捗合計に対する先月比
                                                                if($all_sum_uriage_progress_pre <> "" && $all_sum_uriage_progress_pre <> "" && ((int)$j_sum_uriage_progress2 + (int)$r_sum_uriage_progress2 + (int)$y_sum_uriage_progress2 + (int)$o_sum_uriage_progress2) <> "" && ((int)$j_sum_uriage_progress2 + (int)$r_sum_uriage_progress2 + (int)$y_sum_uriage_progress2 + (int)$o_sum_uriage_progress2) <> 0){
                                                                    $all_sum_uriage_progress2 = (floor(((int)$all_sum_uriage_progress_pre / ((int)$j_sum_uriage_progress2 + (int)$r_sum_uriage_progress2 + (int)$y_sum_uriage_progress2 + (int)$o_sum_uriage_progress2)) * 100 * 10)) / 10;
                                                                } else {
                                                                    $all_sum_uriage_progress2 = "---";
                                                                }
                                                                if($all_sum_number_progress_pre <> "" && $all_sum_number_progress_pre <> "" && ((int)$j_sum_number_progress2 + (int)$r_sum_number_progress2 + (int)$y_sum_number_progress2 + (int)$o_sum_number_progress2) <> "" && ((int)$j_sum_number_progress2 + (int)$r_sum_number_progress2 + (int)$y_sum_number_progress2 + (int)$o_sum_number_progress2) <> 0){
                                                                    $all_sum_number_progress2 = (floor(((int)$all_sum_number_progress_pre / ((int)$j_sum_number_progress2 + (int)$r_sum_number_progress2 + (int)$y_sum_number_progress2 + (int)$o_sum_number_progress2)) * 100 * 10)) / 10;
                                                                } else {
                                                                    $all_sum_number_progress2 = "---";
                                                                }
                                                                if($all_sum_arari_progress_pre <> "" && $all_sum_arari_progress_pre <> "" && ((int)$j_sum_arari_progress2 + (int)$r_sum_arari_progress2 + (int)$y_sum_arari_progress2 + (int)$o_sum_arari_progress2) <> "" && ((int)$j_sum_arari_progress2 + (int)$r_sum_arari_progress2 + (int)$y_sum_arari_progress2 + (int)$o_sum_arari_progress2) <> 0){
                                                                    $all_sum_arari_progress2 = (floor(((int)$all_sum_arari_progress_pre / ((int)$j_sum_arari_progress2 + (int)$r_sum_arari_progress2 + (int)$y_sum_arari_progress2 + (int) + $o_sum_arari_progress2)) * 100 * 10)) / 10;
                                                                } else {
                                                                    $all_sum_arari_progress2 = "---";
                                                                }
                                                            // 進捗合計に対する過去比
                                                                if($all_sum_uriage_progress_pre <> "" && $all_sum_uriage_progress_pre <> "" && ((int)$j_sum_uriage_progress3 + (int)$r_sum_uriage_progress3 + (int)$y_sum_uriage_progress3 + (int)$o_sum_uriage_progress3) <> "" && ((int)$j_sum_uriage_progress3 + (int)$r_sum_uriage_progress3 + (int)$y_sum_uriage_progress3 + (int)$o_sum_uriage_progress3) <> 0){
                                                                    $all_sum_uriage_progress3 = (floor(((int)$all_sum_uriage_progress_pre / ((int)$j_sum_uriage_progress3 + (int)$r_sum_uriage_progress3 + (int)$y_sum_uriage_progress3 + (int)$o_sum_uriage_progress3)) * 100 * 10)) / 10;
                                                                } else {
                                                                    $all_sum_uriage_progress3 = "---";
                                                                }
                                                                if($all_sum_number_progress_pre <> "" && $all_sum_number_progress_pre <> "" && ((int)$j_sum_number_progress3 + (int)$r_sum_number_progress3 + (int)$y_sum_number_progress3 + (int)$o_sum_number_progress3) <> "" && ((int)$j_sum_number_progress3 + (int)$r_sum_number_progress3 + (int)$y_sum_number_progress3 + (int)$o_sum_number_progress3) <> 0){
                                                                    $all_sum_number_progress3 = (floor(((int)$all_sum_number_progress_pre / ((int)$j_sum_number_progress3 + (int)$r_sum_number_progress3 + (int)$y_sum_number_progress3 + (int)$o_sum_number_progress3)) * 100 * 10)) / 10;
                                                                } else {
                                                                    $all_sum_number_progress3 = "---";
                                                                }
                                                                if($all_sum_arari_progress_pre <> "" && $all_sum_arari_progress_pre <> "" && ((int)$j_sum_arari_progress3 + (int)$r_sum_arari_progress3 + (int)$y_sum_arari_progress3 + (int)$o_sum_arari_progress3) <> "" && ((int)$j_sum_arari_progress3 + (int)$r_sum_arari_progress3 + (int)$y_sum_arari_progress3 + (int)$o_sum_arari_progress3) <> 0){
                                                                    $all_sum_arari_progress3 = (floor(((int)$all_sum_arari_progress_pre / ((int)$j_sum_arari_progress3 + (int)$r_sum_arari_progress3 + (int)$y_sum_arari_progress3 + (int)$o_sum_arari_progress3)) * 100 * 10)) / 10;
                                                                } else {
                                                                    $all_sum_arari_progress3 = "---";
                                                                }
                                                                
                                                            // HTML作成
                                                                ($j_sum_uriage_progress == 0 || $j_sum_uriage_progress == "" || $j_sum_uriage_progress == "---") ? $j_uriage_view1 = $j_sum_uriage_progress : $j_uriage_view1 = number_format($j_sum_uriage_progress);
                                                                ($j_sum_uriage_progress_pre == 0 || $j_sum_uriage_progress_pre == "" || $j_sum_uriage_progress_pre == "---") ? $j_uriage_view2 = $j_sum_uriage_progress_pre : $j_uriage_view2 = number_format($j_sum_uriage_progress_pre);
                                                                ($j_sum_uriage_progress_pre2 == 0 || $j_sum_uriage_progress_pre2 == "" || $j_sum_uriage_progress_pre2 == "---") ? $j_uriage_view3 = $j_sum_uriage_progress_pre2 : $j_uriage_view3 = number_format($j_sum_uriage_progress_pre2,1);
                                                                ($j_sum_uriage_progress_pre3 == 0 || $j_sum_uriage_progress_pre3 == "" || $j_sum_uriage_progress_pre3 == "---") ? $j_uriage_view4 = $j_sum_uriage_progress_pre3 : $j_uriage_view4 = number_format($j_sum_uriage_progress_pre3,1);
                                                                ($r_sum_uriage_progress == 0 || $r_sum_uriage_progress == "" || $r_sum_uriage_progress == "---") ? $r_uriage_view1 = $r_sum_uriage_progress : $r_uriage_view1 = number_format($r_sum_uriage_progress);
                                                                ($r_sum_uriage_progress_pre == 0 || $r_sum_uriage_progress_pre == "" || $r_sum_uriage_progress_pre == "---") ? $r_uriage_view2 = $r_sum_uriage_progress_pre : $r_uriage_view2 = number_format($r_sum_uriage_progress_pre);
                                                                ($r_sum_uriage_progress_pre2 == 0 || $r_sum_uriage_progress_pre2 == "" || $r_sum_uriage_progress_pre2 == "---") ? $r_uriage_view3 = $r_sum_uriage_progress_pre2 : $r_uriage_view3 = number_format($r_sum_uriage_progress_pre2,1);
                                                                ($r_sum_uriage_progress_pre3 == 0 || $r_sum_uriage_progress_pre3 == "" || $r_sum_uriage_progress_pre3 == "---") ? $r_uriage_view4 = $r_sum_uriage_progress_pre3 : $r_uriage_view4 = number_format($r_sum_uriage_progress_pre3,1);
                                                                ($y_sum_uriage_progress == 0 || $y_sum_uriage_progress == "" || $y_sum_uriage_progress == "---") ? $y_uriage_view1 = $y_sum_uriage_progress : $y_uriage_view1 = number_format($y_sum_uriage_progress);
                                                                ($y_sum_uriage_progress_pre == 0 || $y_sum_uriage_progress_pre == "" || $y_sum_uriage_progress_pre == "---") ? $y_uriage_view2 = $y_sum_uriage_progress_pre : $y_uriage_view2 = number_format($y_sum_uriage_progress_pre);
                                                                ($y_sum_uriage_progress_pre2 == 0 || $y_sum_uriage_progress_pre2 == "" || $y_sum_uriage_progress_pre2 == "---") ? $y_uriage_view3 = $y_sum_uriage_progress_pre2 : $y_uriage_view3 = number_format($y_sum_uriage_progress_pre2,1);
                                                                ($y_sum_uriage_progress_pre3 == 0 || $y_sum_uriage_progress_pre3 == "" || $y_sum_uriage_progress_pre3 == "---") ? $y_uriage_view4 = $y_sum_uriage_progress_pre3 : $y_uriage_view4 = number_format($y_sum_uriage_progress_pre3,1);
                                                                ($o_sum_uriage_progress == 0 || $o_sum_uriage_progress == "" || $o_sum_uriage_progress == "---") ? $o_uriage_view1 = $o_sum_uriage_progress : $o_uriage_view1 = number_format($o_sum_uriage_progress);
                                                                ($o_sum_uriage_progress_pre == 0 || $o_sum_uriage_progress_pre == "" || $o_sum_uriage_progress_pre == "---") ? $o_uriage_view2 = $o_sum_uriage_progress_pre : $o_uriage_view2 = number_format($o_sum_uriage_progress_pre);
                                                                ($o_sum_uriage_progress_pre2 == 0 || $o_sum_uriage_progress_pre2 == "" || $o_sum_uriage_progress_pre2 == "---") ? $o_uriage_view3 = $o_sum_uriage_progress_pre2 : $o_uriage_view3 = number_format((float)$o_sum_uriage_progress_pre2,1);
                                                                ($o_sum_uriage_progress_pre3 == 0 || $o_sum_uriage_progress_pre3 == "" || $o_sum_uriage_progress_pre3 == "---") ? $o_uriage_view4 = $o_sum_uriage_progress_pre3 : $o_uriage_view4 = number_format((float)$o_sum_uriage_progress_pre3,1);
                                                                ($all_sum_uriage_progress == 0 || $all_sum_uriage_progress == "") ? $all_uriage_view1 = $all_sum_uriage_progress : $all_uriage_view1 = number_format($all_sum_uriage_progress);
                                                                ($all_sum_uriage_progress_pre == 0 || $all_sum_uriage_progress_pre == "" || $all_sum_uriage_progress_pre == "---") ? $all_uriage_view2 = $all_sum_uriage_progress_pre : $all_uriage_view2 = number_format($all_sum_uriage_progress_pre);
                                                                ($all_sum_uriage_progress2 == 0 || $all_sum_uriage_progress2 == "" || $all_sum_uriage_progress2 == "---") ? $all_uriage_view3 = $all_sum_uriage_progress2 : $all_uriage_view3 = number_format($all_sum_uriage_progress2,1);
                                                                ($all_sum_uriage_progress3 == 0 || $all_sum_uriage_progress3 == "" || $all_sum_uriage_progress3 == "---") ? $all_uriage_view4 = $all_sum_uriage_progress3 : $all_uriage_view4 = number_format($all_sum_uriage_progress3,1);
                                                                
                                                                
                                                                ($j_sum_number_progress == 0 || $j_sum_number_progress == "" || $j_sum_number_progress == "---") ? $j_number_view1 = $j_sum_number_progress : $j_number_view1 = number_format($j_sum_number_progress);
                                                                ($j_sum_number_progress_pre == 0 || $j_sum_number_progress_pre == "" || $j_sum_number_progress_pre == "---") ? $j_number_view2 = $j_sum_number_progress_pre : $j_number_view2 = number_format($j_sum_number_progress_pre);
                                                                ($j_sum_number_progress_pre2 == 0 || $j_sum_number_progress_pre2 == "" || $j_sum_number_progress_pre2 == "---") ? $j_number_view3 = $j_sum_number_progress_pre2 : $j_number_view3 = number_format($j_sum_number_progress_pre2,1);
                                                                ($j_sum_number_progress_pre3 == 0 || $j_sum_number_progress_pre3 == "" || $j_sum_number_progress_pre3 == "---") ? $j_number_view4 = $j_sum_number_progress_pre3 : $j_number_view4 = number_format($j_sum_number_progress_pre3,1);
                                                                ($r_sum_number_progress == 0 || $r_sum_number_progress == "" || $r_sum_number_progress == "---") ? $r_number_view1 = $r_sum_number_progress : $r_number_view1 = number_format($r_sum_number_progress);
                                                                ($r_sum_number_progress_pre == 0 || $r_sum_number_progress_pre == "" || $r_sum_number_progress_pre == "---") ? $r_number_view2 = $r_sum_number_progress_pre : $r_number_view2 = number_format($r_sum_number_progress_pre);
                                                                ($r_sum_number_progress_pre2 == 0 || $r_sum_number_progress_pre2 == "" || $r_sum_number_progress_pre2 == "---") ? $r_number_view3 = $r_sum_number_progress_pre2 : $r_number_view3 = number_format($r_sum_number_progress_pre2,1);
                                                                ($r_sum_number_progress_pre3 == 0 || $r_sum_number_progress_pre3 == "" || $r_sum_number_progress_pre3 == "---") ? $r_number_view4 = $r_sum_number_progress_pre3 : $r_number_view4 = number_format($r_sum_number_progress_pre3,1);
                                                                ($y_sum_number_progress == 0 || $y_sum_number_progress == "" || $y_sum_number_progress == "---") ? $y_number_view1 = $y_sum_number_progress : $y_number_view1 = number_format($y_sum_number_progress);
                                                                ($y_sum_number_progress_pre == 0 || $y_sum_number_progress_pre == "" || $y_sum_number_progress_pre == "---") ? $y_number_view2 = $y_sum_number_progress_pre : $y_number_view2 = number_format($y_sum_number_progress_pre);
                                                                ($y_sum_number_progress_pre2 == 0 || $y_sum_number_progress_pre2 == "" || $y_sum_number_progress_pre2 == "---") ? $y_number_view3 = $y_sum_number_progress_pre2 : $y_number_view3 = number_format($y_sum_number_progress_pre2,1);
                                                                ($y_sum_number_progress_pre3 == 0 || $y_sum_number_progress_pre3 == "" || $y_sum_number_progress_pre3 == "---") ? $y_number_view4 = $y_sum_number_progress_pre3 : $y_number_view4 = number_format($y_sum_number_progress_pre3,1);
                                                                ($o_sum_number_progress == 0 || $o_sum_number_progress == "" || $o_sum_number_progress == "---") ? $o_number_view1 = $o_sum_number_progress : $o_number_view1 = number_format($o_sum_number_progress);
                                                                ($o_sum_number_progress_pre == 0 || $o_sum_number_progress_pre == "" || $o_sum_number_progress_pre == "---") ? $o_number_view2 = $o_sum_number_progress_pre : $o_number_view2 = number_format($o_sum_number_progress_pre);
                                                                ($o_sum_number_progress_pre2 == 0 || $o_sum_number_progress_pre2 == "" || $o_sum_number_progress_pre2 == "---") ? $o_number_view3 = $o_sum_number_progress_pre2 : $o_number_view3 = number_format((float)$o_sum_number_progress_pre2,1);
                                                                ($o_sum_number_progress_pre3 == 0 || $o_sum_number_progress_pre3 == "" || $o_sum_number_progress_pre3 == "---") ? $o_number_view4 = $o_sum_number_progress_pre3 : $o_number_view4 = number_format((float)$o_sum_number_progress_pre3,1);
                                                                ($all_sum_number_progress == 0 || $all_sum_number_progress == "") ? $all_number_view1 = $all_sum_number_progress : $all_number_view1 = number_format($all_sum_number_progress);
                                                                ($all_sum_number_progress_pre == 0 || $all_sum_number_progress_pre == "" || $all_sum_number_progress_pre == "---") ? $all_number_view2 = $all_sum_number_progress_pre : $all_number_view2 = number_format($all_sum_number_progress_pre);
                                                                ($all_sum_number_progress2 == 0 || $all_sum_number_progress2 == "" || $all_sum_number_progress2 == "---") ? $all_number_view3 = $all_sum_number_progress2 : $all_number_view3 = number_format($all_sum_number_progress2,1);
                                                                ($all_sum_number_progress3 == 0 || $all_sum_number_progress3 == "" || $all_sum_number_progress3 == "---") ? $all_number_view4 = $all_sum_number_progress3 : $all_number_view4 = number_format($all_sum_number_progress3,1);
                                                                
                                                                ($j_sum_arari_progress == 0 || $j_sum_arari_progress == "" || $j_sum_arari_progress == "---") ? $j_arari_view1 = $j_sum_arari_progress : $j_arari_view1 = number_format($j_sum_arari_progress);
                                                                ($j_sum_arari_progress_pre == 0 || $j_sum_arari_progress_pre == "" || $j_sum_arari_progress_pre == "---") ? $j_arari_view2 = $j_sum_arari_progress_pre : $j_arari_view2 = number_format($j_sum_arari_progress_pre);
                                                                ($j_sum_arari_progress_pre2 == 0 || $j_sum_arari_progress_pre2 == "" || $j_sum_arari_progress_pre2 == "---") ? $j_arari_view3 = $j_sum_arari_progress_pre2 : $j_arari_view3 = number_format($j_sum_arari_progress_pre2,1);
                                                                ($j_sum_arari_progress_pre3 == 0 || $j_sum_arari_progress_pre3 == "" || $j_sum_arari_progress_pre3 == "---") ? $j_arari_view4 = $j_sum_arari_progress_pre3 : $j_arari_view4 = number_format($j_sum_arari_progress_pre3,1);
                                                                ($r_sum_arari_progress == 0 || $r_sum_arari_progress == "" || $r_sum_arari_progress == "---") ? $r_arari_view1 = $r_sum_arari_progress : $r_arari_view1 = number_format($r_sum_arari_progress);
                                                                ($r_sum_arari_progress_pre == 0 || $r_sum_arari_progress_pre == "" || $r_sum_arari_progress_pre == "---") ? $r_arari_view2 = $r_sum_arari_progress_pre : $r_arari_view2 = number_format($r_sum_arari_progress_pre);
                                                                ($r_sum_arari_progress_pre2 == 0 || $r_sum_arari_progress_pre2 == "" || $r_sum_arari_progress_pre2 == "---") ? $r_arari_view3 = $r_sum_arari_progress_pre2 : $r_arari_view3 = number_format($r_sum_arari_progress_pre2,1);
                                                                ($r_sum_arari_progress_pre3 == 0 || $r_sum_arari_progress_pre3 == "" || $r_sum_arari_progress_pre3 == "---") ? $r_arari_view4 = $r_sum_arari_progress_pre3 : $r_arari_view4 = number_format($r_sum_arari_progress_pre3,1);
                                                                ($y_sum_arari_progress == 0 || $y_sum_arari_progress == "" || $y_sum_arari_progress == "---") ? $y_arari_view1 = $y_sum_arari_progress : $y_arari_view1 = number_format($y_sum_arari_progress);
                                                                ($y_sum_arari_progress_pre == 0 || $y_sum_arari_progress_pre == "" || $y_sum_arari_progress_pre == "---") ? $y_arari_view2 = $y_sum_arari_progress_pre : $y_arari_view2 = number_format($y_sum_arari_progress_pre);
                                                                ($y_sum_arari_progress_pre2 == 0 || $y_sum_arari_progress_pre2 == "" || $y_sum_arari_progress_pre2 == "---") ? $y_arari_view3 = $y_sum_arari_progress_pre2 : $y_arari_view3 = number_format($y_sum_arari_progress_pre2,1);
                                                                ($y_sum_arari_progress_pre3 == 0 || $y_sum_arari_progress_pre3 == "" || $y_sum_arari_progress_pre3 == "---") ? $y_arari_view4 = $y_sum_arari_progress_pre3 : $y_arari_view4 = number_format($y_sum_arari_progress_pre3,1);
                                                                ($o_sum_arari_progress == 0 || $o_sum_arari_progress == "") ? $o_arari_view1 = $o_sum_arari_progress : $o_arari_view1 = number_format($o_sum_arari_progress);
                                                                ($o_sum_arari_progress_pre == 0 || $o_sum_arari_progress_pre == "" || $o_sum_arari_progress_pre == "---") ? $o_arari_view2 = $o_sum_arari_progress_pre : $o_arari_view2 = number_format($o_sum_arari_progress_pre);
                                                                ($o_sum_arari_progress_pre2 == 0 || $o_sum_arari_progress_pre2 == "" || $o_sum_arari_progress_pre2 == "---") ? $o_arari_view3 = $o_sum_arari_progress_pre2 : $o_arari_view3 = number_format((float)$o_sum_arari_progress_pre2,1);
                                                                ($o_sum_arari_progress_pre3 == 0 || $o_sum_arari_progress_pre3 == "" || $o_sum_arari_progress_pre3 == "---") ? $o_arari_view4 = $o_sum_arari_progress_pre3 : $o_arari_view4 = number_format((float)$o_sum_arari_progress_pre3,1);
                                                                ($all_sum_arari_progress == 0 || $all_sum_arari_progress == "" || $all_sum_arari_progress == "---") ? $all_arari_view1 = $all_sum_arari_progress : $all_arari_view1 = number_format($all_sum_arari_progress);
                                                                ($all_sum_arari_progress_pre == 0 || $all_sum_arari_progress_pre == "" || $all_sum_arari_progress_pre == "---") ? $all_arari_view2 = $all_sum_arari_progress_pre : $all_arari_view2 = number_format($all_sum_arari_progress_pre);
                                                                ($all_sum_arari_progress2 == 0 || $all_sum_arari_progress2 == "" || $all_sum_arari_progress2 == "---") ? $all_arari_view3 = $all_sum_arari_progress2 : $all_arari_view3 = number_format($all_sum_arari_progress2,1);
                                                                ($all_sum_arari_progress3 == 0 || $all_sum_arari_progress3 == "" || $all_sum_arari_progress3 == "---") ? $all_arari_view4 = $all_sum_arari_progress3 : $all_arari_view4 = number_format($all_sum_arari_progress3,1);
                                                                

                                                                ($j_uriage_view3 < 100) ? $j_uriage_view3 = "<div class='sinchoku fc_blue'>" . $j_uriage_view3 . "%</div>" : $j_uriage_view3 = "<div class='sinchoku fc_red'>" . $j_uriage_view3 . "%</div>";
                                                                ($j_uriage_view4 < 100) ? $j_uriage_view4 = "<div class='sinchoku fc_blue'>" . $j_uriage_view4 . "%</div>" : $j_uriage_view4 = "<div class='sinchoku fc_red'>" . $j_uriage_view4 . "%</div>";
                                                                ($r_uriage_view3 < 100) ? $r_uriage_view3 = "<div class='sinchoku fc_blue'>" . $r_uriage_view3 . "%</div>" : $r_uriage_view3 = "<div class='sinchoku fc_red'>" . $r_uriage_view3 . "%</div>";
                                                                ($r_uriage_view4 < 100) ? $r_uriage_view4 = "<div class='sinchoku fc_blue'>" . $r_uriage_view4 . "%</div>" : $r_uriage_view4 = "<div class='sinchoku fc_red'>" . $r_uriage_view4 . "%</div>";
                                                                ($y_uriage_view3 < 100) ? $y_uriage_view3 = "<div class='sinchoku fc_blue'>" . $y_uriage_view3 . "%</div>" : $y_uriage_view3 = "<div class='sinchoku fc_red'>" . $y_uriage_view3 . "%</div>";
                                                                ($y_uriage_view4 < 100) ? $y_uriage_view4 = "<div class='sinchoku fc_blue'>" . $y_uriage_view4 . "%</div>" : $y_uriage_view4 = "<div class='sinchoku fc_red'>" . $y_uriage_view4 . "%</div>";
                                                                ($o_uriage_view3 < 100) ? $o_uriage_view3 = "<div class='sinchoku fc_blue'>" . $o_uriage_view3 . "%</div>" : $o_uriage_view3 = "<div class='sinchoku fc_red'>" . $o_uriage_view3 . "%</div>";
                                                                ($o_uriage_view4 < 100) ? $o_uriage_view4 = "<div class='sinchoku fc_blue'>" . $o_uriage_view4 . "%</div>" : $o_uriage_view4 = "<div class='sinchoku fc_red'>" . $o_uriage_view4 . "%</div>";
                                                                ($all_uriage_view3 < 100) ? $all_uriage_view3 = "<div class='sinchoku bg_grey fc_blue'>" . $all_uriage_view3 . "%</div>" : $all_uriage_view3 = "<div class='sinchoku bg_grey fc_red'>" . $all_uriage_view3 . "%</div>";
                                                                ($all_uriage_view4 < 100) ? $all_uriage_view4 = "<div class='sinchoku bg_grey fc_blue'>" . $all_uriage_view4 . "%</div>" : $all_uriage_view4 = "<div class='sinchoku bg_grey fc_red'>" . $all_uriage_view4 . "%</div>";
                                                                ($j_number_view3 < 100) ? $j_number_view3 = "<div class='sinchoku fc_blue'>" . $j_number_view3 . "%</div>" : $j_number_view3 = "<div class='sinchoku fc_red'>" . $j_number_view3 . "%</div>";
                                                                ($j_number_view4 < 100) ? $j_number_view4 = "<div class='sinchoku fc_blue'>" . $j_number_view4 . "%</div>" : $j_number_view4 = "<div class='sinchoku fc_red'>" . $j_number_view4 . "%</div>";
                                                                ($r_number_view3 < 100) ? $r_number_view3 = "<div class='sinchoku fc_blue'>" . $r_number_view3 . "%</div>" : $r_number_view3 = "<div class='sinchoku fc_red'>" . $r_number_view3 . "%</div>";
                                                                ($r_number_view4 < 100) ? $r_number_view4 = "<div class='sinchoku fc_blue'>" . $r_number_view4 . "%</div>" : $r_number_view4 = "<div class='sinchoku fc_red'>" . $r_number_view4 . "%</div>";
                                                                ($y_number_view3 < 100) ? $y_number_view3 = "<div class='sinchoku fc_blue'>" . $y_number_view3 . "%</div>" : $y_number_view3 = "<div class='sinchoku fc_red'>" . $y_number_view3 . "%</div>";
                                                                ($y_number_view4 < 100) ? $y_number_view4 = "<div class='sinchoku fc_blue'>" . $y_number_view4 . "%</div>" : $y_number_view4 = "<div class='sinchoku fc_red'>" . $y_number_view4 . "%</div>";
                                                                ($o_number_view3 < 100) ? $o_number_view3 = "<div class='sinchoku fc_blue'>" . $o_number_view3 . "%</div>" : $o_number_view3 = "<div class='sinchoku fc_red'>" . $o_number_view3 . "%</div>";
                                                                ($o_number_view4 < 100) ? $o_number_view4 = "<div class='sinchoku fc_blue'>" . $o_number_view4 . "%</div>" : $o_number_view4 = "<div class='sinchoku fc_red'>" . $o_number_view4 . "%</div>";
                                                                ($all_number_view3 < 100) ? $all_number_view3 = "<div class='sinchoku bg_grey fc_blue'>" . $all_number_view3 . "%</div>" : $all_number_view3 = "<div class='sinchoku bg_grey fc_red'>" . $all_number_view3 . "%</div>";
                                                                ($all_number_view4 < 100) ? $all_number_view4 = "<div class='sinchoku bg_grey fc_blue'>" . $all_number_view4 . "%</div>" : $all_number_view4 = "<div class='sinchoku bg_grey fc_red'>" . $all_number_view4 . "%</div>";
                                                                ($j_arari_view3 < 100) ? $j_arari_view3 = "<div class='sinchoku fc_blue'>" . $j_arari_view3 . "%</div>" : $j_arari_view3 = "<div class='sinchoku fc_red'>" . $j_arari_view3 . "%</div>";
                                                                ($j_arari_view4 < 100) ? $j_arari_view4 = "<div class='sinchoku fc_blue'>" . $j_arari_view4 . "%</div>" : $j_arari_view4 = "<div class='sinchoku fc_red'>" . $j_arari_view4 . "%</div>";
                                                                ($r_arari_view3 < 100) ? $r_arari_view3 = "<div class='sinchoku fc_blue'>" . $r_arari_view3 . "%</div>" : $r_arari_view3 = "<div class='sinchoku fc_red'>" . $r_arari_view3 . "%</div>";
                                                                ($r_arari_view4 < 100) ? $r_arari_view4 = "<div class='sinchoku fc_blue'>" . $r_arari_view4 . "%</div>" : $r_arari_view4 = "<div class='sinchoku fc_red'>" . $r_arari_view4 . "%</div>";
                                                                ($y_arari_view3 < 100) ? $y_arari_view3 = "<div class='sinchoku fc_blue'>" . $y_arari_view3 . "%</div>" : $y_arari_view3 = "<div class='sinchoku fc_red'>" . $y_arari_view3 . "%</div>";
                                                                ($y_arari_view4 < 100) ? $y_arari_view4 = "<div class='sinchoku fc_blue'>" . $y_arari_view4 . "%</div>" : $y_arari_view4 = "<div class='sinchoku fc_red'>" . $y_arari_view4 . "%</div>";
                                                                ($o_arari_view3 < 100) ? $o_arari_view3 = "<div class='sinchoku fc_blue'>" . $o_arari_view3 . "%</div>" : $o_arari_view3 = "<div class='sinchoku fc_red'>" . $o_arari_view3 . "%</div>";
                                                                ($o_arari_view4 < 100) ? $o_arari_view4 = "<div class='sinchoku fc_blue'>" . $o_arari_view4 . "%</div>" : $o_arari_view4 = "<div class='sinchoku fc_red'>" . $o_arari_view4 . "%</div>";
                                                                ($all_arari_view3 < 100) ? $all_arari_view3 = "<div class='sinchoku bg_grey fc_blue'>" . $all_arari_view3 . "%</div>" : $all_arari_view3 = "<div class='sinchoku bg_grey fc_red'>" . $all_arari_view3 . "%</div>";
                                                                ($all_arari_view4 < 100) ? $all_arari_view4 = "<div class='sinchoku bg_grey fc_blue'>" . $all_arari_view4 . "%</div>" : $all_arari_view4 = "<div class='sinchoku bg_grey fc_red'>" . $all_arari_view4 . "%</div>";



                                            /************************************************************************************************************************************************************************************************************* */
                                                // 各予測値と過去比を取得 end
                                            /************************************************************************************************************************************************************************************************************* */
                                        
                    /************************************************************************************************************************************************************************************************************* */
                        // 進捗率用ロジック end
                    /************************************************************************************************************************************************************************************************************* */
                    


                    /************************************************************************************************************************************************************************************************************* */
                        // DB情報の受け取り（過去の期間）start
                    /************************************************************************************************************************************************************************************************************* */
                    
                            $past_temp3_title2 = "";
                            $past_i = 0;
    
                            /************************************************************************************************************************************************************************************************************* */
                                // 自社用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */

                                                // DB検索（自社値）スタート
                                                        $past_j_buys = DB::table($table_name) 
                                                        // 月毎にグループ化して値を分けるための処理
                                                            ->select([
                                                                \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS j_month'),
                                                                \DB::raw("SUM(uriagekingaku) AS j_uriage"),
                                                                \DB::raw("SUM(uriagesuu) AS j_number"),
                                                                \DB::raw("SUM(ararikingaku) AS j_arari"),
                                                            ])
                                                            ->groupBy('j_month')
                                                            // 条件（売上部門の指定）
                                                                ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
        
                                                                    // 条件（売上部門が店舗）
                                                                        if($out1_a == "ON"){
                                                                            $query->orWhere('baikyakukubun', 1);
                                                                        }
                                                                    // 条件（売上部門が通販）
                                                                        if($out1_b == "ON"){
                                                                            $query->orWhere('baikyakukubun',2);
                                                                        }
                                                                    // 条件（売上部門が卸）
                                                                        if($out1_c == "ON"){
                                                                            $query->orWhere('baikyakukubun',3);
                                                                        }
                                                                    // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                        if($out1_d == "ON"){
                                                                            $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                        }
                                                            
                                                                })

                                                            // 条件（過去の期間））
                                                                ->whereBetween($table_name . '.uriage', [$past_between_start, $past_between_end])
                                                                
                                                            // 条件（分類名）
                                                                ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                    // 条件（商品区分分類名が新品）
                                                                        if($out2_a == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                        }
                                                                    // 条件（商品区分分類名が中古）
                                                                        if($out2_b == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                        }
                                                                    // 条件（商品区分分類名がアンティーク）
                                                                        if($out2_c == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                        }
                                                                    // 条件（商品区分分類名がその他）
                                                                        if($out2_d == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                        }
                                                                    // 条件（商品区分分類名が修理）
                                                                        if($out2_e == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                        }
                                                            
                                                            })
                                                        // 条件（通販区分が自社）
                                                            ->where('tsuuhankubun',1)

                                                        // 条件（免税）
                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                    // 条件（免税区分が0:対象外）
                                                                        if($out4_a == "ON"){
                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                        }
                                                                    // 条件（免税区分が1:免税）
                                                                        if($out4_b == "ON"){
                                                                            $query->orwhere("menzei","like","%免税%");
                                                                        }
                                                            })
                                                        // 条件（扱い部門）
                                                            ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                    $query->orWhere('bumonmei','');

                                                                    // 条件（扱い部門がジャック）
                                                                        if($out5_a == "ON"){
                                                                            $query->orWhere('bumonmei','Jackroad');
                                                                        }
                                                                    // 条件（扱い部門がベティー）
                                                                        if($out5_b == "ON"){
                                                                            $query->orWhere('bumonmei','BettyRoad');
                                                                        }
                                                                    // 条件（扱い部門がジュエリー）
                                                                        if($out5_c == "ON"){
                                                                            $query->orWhere('bumonmei','Jewelry');
                                                                        }
                                                        
                                                            })
                                                        // ソート順指定
                                                            ->orderBy('uriage', 'asc')
                                                            ->get();
                                                        // クエリビルダスタート
                                                            $past_i = 0;
                                                            // 変数リセット
                                                                $past_j_sum_uriage = "";
                                                                $past_j_sum_number = "";
                                                                $past_j_sum_arari= "";
                                                                foreach ($past_j_buys as $past_j_buy) {
                                                                    // 各月名
                                                                        $past_j_month[$past_i]= $past_j_buy->j_month;
                                                                    // 各月自社売上
                                                                        $past_j_uriage[$past_i]= $past_j_buy->j_uriage;
                                                                        // 全過去期間に現在の期間が含まれている場合
                                                                            if(strpos($past_temp3_j_manthly_data, $past_j_month[$past_i] ) !== false){
                                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                                    $past_temp3_j_manthly_data = str_replace($past_j_month[$past_i], $past_j_uriage[$past_i], $past_temp3_j_manthly_data);
                                                                            }

                                                                    // 全期間自社売上合計
                                                                        $past_j_sum_uriage = (int)$past_j_sum_uriage + (int)$past_j_uriage[$past_i];

                                                                    // 各月自社点数
                                                                        $past_j_number[$past_i]= $past_j_buy->j_number;
                                                                        // 全過去期間に現在の期間が含まれている場合
                                                                            if(strpos($past_temp3_j_manthly_data2, $past_j_month[$past_i] ) !== false){
                                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                                    $past_temp3_j_manthly_data2 = str_replace($past_j_month[$past_i], $past_j_number[$past_i], $past_temp3_j_manthly_data2);
                                                                            }

                                                                    // 全期間自社点数合計
                                                                        $past_j_sum_number = (int)$past_j_sum_number + (int)$past_j_number[$past_i];



                                                                    // 各月自社粗利
                                                                        $past_j_arari[$past_i]= $past_j_buy->j_arari;
                                                                        // 全過去期間に現在の期間が含まれている場合
                                                                            if(strpos($past_temp3_j_manthly_data3, $past_j_month[$past_i] ) !== false){
                                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                                    $past_temp3_j_manthly_data3 = str_replace($past_j_month[$past_i], $past_j_arari[$past_i], $past_temp3_j_manthly_data3);
                                                                            }

                                                                    // 全期間自社粗利合計
                                                                        $past_j_sum_arari = (int)$past_j_sum_arari + (int)$past_j_arari[$past_i];
                                                                        
                                                                    $past_i++;
                                                                }

                                                            // 全期間自社売上合計とその平均値のHTML作成
                                                                $past_temp3_j_sum = "";
                                                                if($past_j_sum_uriage <> 0 && $past_j_sum_uriage <> ""){
                                                                    $past_j_sum_uriage_c = number_format((int)$past_j_sum_uriage); 
                                                                    $past_j_sum_uriage_ave = number_format(floor((int)$past_j_sum_uriage / $past_i));
                                                                    $past_j_sum_uriage_ave2 = floor((int)$past_j_sum_uriage / $past_i);
                                                                } else {
                                                                    $past_j_sum_uriage_c = $past_j_sum_uriage; 
                                                                    $past_j_sum_uriage_ave = 0;
                                                                    $past_j_sum_uriage_ave2 = 0;
                                                                }
                                                                $past_temp3_j_sum = "<div class='title4 ta_r'>" . $past_j_sum_uriage_c . "</div><div class='title4 ta_r'>" . $past_j_sum_uriage_ave . "</div></div>";
                                                            // 全期間自社売上点数合計とその平均値のHTML作成
                                                                $past_temp3_j_sum2 = "";
                                                                if($past_j_sum_number <> 0 && $past_j_sum_number <> ""){
                                                                    $past_j_sum_number_c = number_format((int)$past_j_sum_number); 
                                                                    $past_j_sum_number_ave = number_format(floor((int)$past_j_sum_number / $past_i));
                                                                    $past_j_sum_number_ave2 = floor((int)$past_j_sum_number / $past_i);
                                                                } else {
                                                                    $past_j_sum_number_c = $past_j_sum_number; 
                                                                    $past_j_sum_number_ave = 0;
                                                                    $past_j_sum_number_ave2 = 0;
                                                                }
                                                                $past_temp3_j_sum2 = "<div class='title4 ta_r'>" . $past_j_sum_number_c . "</div><div class='title4 ta_r'>" . $past_j_sum_number_ave . "</div></div>";
                                                            // 全期間自社粗利合計とその平均値のHTML作成
                                                                $past_temp3_j_sum3 = "";
                                                                if($past_j_sum_arari <> 0 && $past_j_sum_arari <> ""){
                                                                    $past_j_sum_arari_c = number_format((int)$past_j_sum_arari); 
                                                                    $past_j_sum_arari_ave = number_format(floor((int)$past_j_sum_arari / $past_i));
                                                                    $past_j_sum_arari_ave2 = floor((int)$past_j_sum_arari / $past_i);
                                                                } else {
                                                                    $past_j_sum_arari_c = $past_j_sum_arari; 
                                                                    $past_j_sum_arari_ave = 0;
                                                                    $past_j_sum_arari_ave2 = 0;
                                                                }
                                                                $past_temp3_j_sum3 = "<div class='title4 ta_r'>" . $past_j_sum_arari_c . "</div><div class='title4 ta_r'>" . $past_j_sum_arari_ave . "</div></div>";
            
                            /************************************************************************************************************************************************************************************************************* */
                                // 楽天用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */

                                                // DB検索（楽天値）スタート
                                                        $past_r_buys = DB::table($table_name) 
                                                        // 月毎にグループ化して値を分けるための処理
                                                            ->select([
                                                                \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS r_month'),
                                                                \DB::raw("SUM(uriagekingaku) AS r_uriage"),
                                                                \DB::raw("SUM(uriagesuu) AS r_number"),
                                                                \DB::raw("SUM(ararikingaku) AS r_arari"),
                                                            ])
                                                            ->groupBy('r_month')
                                                            // 条件（売上部門の指定）
                                                                ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
        
                                                                    // 条件（売上部門が店舗）
                                                                        if($out1_a == "ON"){
                                                                            $query->orWhere('baikyakukubun', 1);
                                                                        }
                                                                    // 条件（売上部門が通販）
                                                                        if($out1_b == "ON"){
                                                                            $query->orWhere('baikyakukubun',2);
                                                                        }
                                                                    // 条件（売上部門が卸）
                                                                        if($out1_c == "ON"){
                                                                            $query->orWhere('baikyakukubun',3);
                                                                        }
                                                                    // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                        if($out1_d == "ON"){
                                                                            $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                        }
                                                            
                                                                })

                                                            // 条件（期間の指定）
                                                                ->whereBetween($table_name . '.uriage', [$past_between_start, $past_between_end])
                                                                
                                                            // 条件（分類名）
                                                                ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                    // 条件（商品区分分類名が新品）
                                                                        if($out2_a == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                        }
                                                                    // 条件（商品区分分類名が中古）
                                                                        if($out2_b == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                        }
                                                                    // 条件（商品区分分類名がアンティーク）
                                                                        if($out2_c == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                        }
                                                                    // 条件（商品区分分類名がその他）
                                                                        if($out2_d == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                        }
                                                                    // 条件（商品区分分類名が修理）
                                                                        if($out2_e == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                        }
                                                            
                                                            })
                                                        // 条件（通販区分が楽天）
                                                            ->where('tsuuhankubun',2)

                                                        // 条件（免税）
                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                    // 条件（免税区分が0:対象外）
                                                                        if($out4_a == "ON"){
                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                        }
                                                                    // 条件（免税区分が1:免税）
                                                                        if($out4_b == "ON"){
                                                                            $query->orwhere("menzei","like","%免税%");
                                                                        }
                                                            })
                                                        // 条件（扱い部門）
                                                            ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                    $query->orWhere('bumonmei','');

                                                                    // 条件（扱い部門がジャック）
                                                                        if($out5_a == "ON"){
                                                                            $query->orWhere('bumonmei','Jackroad');
                                                                        }
                                                                    // 条件（扱い部門がベティー）
                                                                        if($out5_b == "ON"){
                                                                            $query->orWhere('bumonmei','BettyRoad');
                                                                        }
                                                                    // 条件（扱い部門がジュエリー）
                                                                        if($out5_c == "ON"){
                                                                            $query->orWhere('bumonmei','Jewelry');
                                                                        }
                                                        
                                                            })
                                                        // ソート順指定
                                                            ->orderBy('uriage', 'asc')
                                                            ->get();
                                                        // クエリビルダスタート
                                                            $past_i = 0;
                                                            // 変数リセット
                                                                $past_r_sum_uriage = "";
                                                                $past_r_sum_number = "";
                                                                $past_r_sum_arari= "";
                                                                foreach ($past_r_buys as $past_r_buy) {
                                                                    // 各月名
                                                                        $past_r_month[$past_i]= $past_r_buy->r_month;
                                                                    // 各月楽天売上
                                                                        $past_r_uriage[$past_i]= $past_r_buy->r_uriage;
                                                                        // 全過去期間に現在の期間が含まれている場合
                                                                            if(strpos($past_temp3_r_manthly_data, $past_r_month[$past_i] ) !== false){
                                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                                    $past_temp3_r_manthly_data = str_replace($past_r_month[$past_i], $past_r_uriage[$past_i], $past_temp3_r_manthly_data);
                                                                            }

                                                                    // 全期間楽天売上合計
                                                                        $past_r_sum_uriage = (int)$past_r_sum_uriage + (int)$past_r_uriage[$past_i];

                                                                    // 各月楽天点数
                                                                        $past_r_number[$past_i]= $past_r_buy->r_number;
                                                                        // 全過去期間に現在の期間が含まれている場合
                                                                            if(strpos($past_temp3_r_manthly_data2, $past_r_month[$past_i] ) !== false){
                                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                                    $past_temp3_r_manthly_data2 = str_replace($past_r_month[$past_i], $past_r_number[$past_i], $past_temp3_r_manthly_data2);
                                                                            }

                                                                    // 全期間楽天点数合計
                                                                        $past_r_sum_number = (int)$past_r_sum_number + (int)$past_r_number[$past_i];



                                                                    // 各月楽天粗利
                                                                        $past_r_arari[$past_i]= $past_r_buy->r_arari;
                                                                        // 全過去期間に現在の期間が含まれている場合
                                                                            if(strpos($past_temp3_r_manthly_data3, $past_r_month[$past_i] ) !== false){
                                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                                    $past_temp3_r_manthly_data3 = str_replace($past_r_month[$past_i], $past_r_arari[$past_i], $past_temp3_r_manthly_data3);
                                                                            }

                                                                    // 全期間楽天粗利合計
                                                                        $past_r_sum_arari = (int)$past_r_sum_arari + (int)$past_r_arari[$past_i];
                                                                        
                                                                    $past_i++;
                                                                }

                                                            // 全期間楽天売上合計とその平均値のHTML作成
                                                                $past_temp3_r_sum = "";
                                                                if($past_r_sum_uriage <> 0 && $past_r_sum_uriage <> ""){
                                                                    $past_r_sum_uriage_c = number_format((int)$past_r_sum_uriage); 
                                                                    $past_r_sum_uriage_ave = number_format(floor((int)$past_r_sum_uriage / $past_i));
                                                                    $past_r_sum_uriage_ave2 = floor((int)$past_r_sum_uriage / $past_i);
                                                                } else {
                                                                    $past_r_sum_uriage_c = $past_r_sum_uriage; 
                                                                    $past_r_sum_uriage_ave = 0;
                                                                    $past_r_sum_uriage_ave2 = 0;
                                                                }
                                                                $past_temp3_r_sum = "<div class='title4 ta_r'>" . $past_r_sum_uriage_c . "</div><div class='title4 ta_r'>" . $past_r_sum_uriage_ave . "</div></div>";
                                                            // 全期間楽天売上点数合計とその平均値のHTML作成
                                                                $past_temp3_r_sum2 = "";
                                                                if($past_r_sum_number <> 0 && $past_r_sum_number <> ""){
                                                                    $past_r_sum_number_c = number_format((int)$past_r_sum_number); 
                                                                    $past_r_sum_number_ave = number_format(floor((int)$past_r_sum_number / $past_i));
                                                                    $past_r_sum_number_ave2 = floor((int)$past_r_sum_number / $past_i);
                                                                } else {
                                                                    $past_r_sum_number_c = $past_r_sum_number; 
                                                                    $past_r_sum_number_ave = 0;
                                                                    $past_r_sum_number_ave2 = 0;
                                                                }
                                                                $past_temp3_r_sum2 = "<div class='title4 ta_r'>" . $past_r_sum_number_c . "</div><div class='title4 ta_r'>" . $past_r_sum_number_ave . "</div></div>";
                                                            // 全期間楽天粗利合計とその平均値のHTML作成
                                                                $past_temp3_r_sum3 = "";
                                                                if($past_r_sum_arari <> 0 && $past_r_sum_arari <> ""){
                                                                    $past_r_sum_arari_c = number_format((int)$past_r_sum_arari); 
                                                                    $past_r_sum_arari_ave = number_format(floor((int)$past_r_sum_arari / $past_i));
                                                                    $past_r_sum_arari_ave2 = floor((int)$past_r_sum_arari / $past_i);
                                                                } else {
                                                                    $past_r_sum_arari_c = $past_r_sum_arari; 
                                                                    $past_r_sum_arari_ave = 0;
                                                                    $past_r_sum_arari_ave2 = 0;
                                                                }
                                                                $past_temp3_r_sum3 = "<div class='title4 ta_r'>" . $past_r_sum_arari_c . "</div><div class='title4 ta_r'>" . $past_r_sum_arari_ave . "</div></div>";


                            /************************************************************************************************************************************************************************************************************* */
                                // ヤフー用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */

                                                // DB検索（ヤフー値）スタート
                                                        $past_y_buys = DB::table($table_name) 
                                                        // 月毎にグループ化して値を分けるための処理
                                                            ->select([
                                                                \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS y_month'),
                                                                \DB::raw("SUM(uriagekingaku) AS y_uriage"),
                                                                \DB::raw("SUM(uriagesuu) AS y_number"),
                                                                \DB::raw("SUM(ararikingaku) AS y_arari"),
                                                            ])
                                                            ->groupBy('y_month')
                                                            // 条件（売上部門の指定）
                                                                ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
        
                                                                    // 条件（売上部門が店舗）
                                                                        if($out1_a == "ON"){
                                                                            $query->orWhere('baikyakukubun', 1);
                                                                        }
                                                                    // 条件（売上部門が通販）
                                                                        if($out1_b == "ON"){
                                                                            $query->orWhere('baikyakukubun',2);
                                                                        }
                                                                    // 条件（売上部門が卸）
                                                                        if($out1_c == "ON"){
                                                                            $query->orWhere('baikyakukubun',3);
                                                                        }
                                                                    // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                        if($out1_d == "ON"){
                                                                            $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                        }
                                                            
                                                                })

                                                            // 条件（期間の指定）
                                                                ->whereBetween($table_name . '.uriage', [$past_between_start, $past_between_end])
                                                                
                                                            // 条件（分類名）
                                                                ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                    // 条件（商品区分分類名が新品）
                                                                        if($out2_a == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                        }
                                                                    // 条件（商品区分分類名が中古）
                                                                        if($out2_b == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                        }
                                                                    // 条件（商品区分分類名がアンティーク）
                                                                        if($out2_c == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                        }
                                                                    // 条件（商品区分分類名がその他）
                                                                        if($out2_d == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                        }
                                                                    // 条件（商品区分分類名が修理）
                                                                        if($out2_e == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                        }
                                                            
                                                            })
                                                        // 条件（通販区分がヤフー）
                                                            ->where('tsuuhankubun',3)

                                                        // 条件（免税）
                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                    // 条件（免税区分が0:対象外）
                                                                        if($out4_a == "ON"){
                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                        }
                                                                    // 条件（免税区分が1:免税）
                                                                        if($out4_b == "ON"){
                                                                            $query->orwhere("menzei","like","%免税%");
                                                                        }
                                                            })
                                                        // 条件（扱い部門）
                                                            ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                    $query->orWhere('bumonmei','');

                                                                    // 条件（扱い部門がジャック）
                                                                        if($out5_a == "ON"){
                                                                            $query->orWhere('bumonmei','Jackroad');
                                                                        }
                                                                    // 条件（扱い部門がベティー）
                                                                        if($out5_b == "ON"){
                                                                            $query->orWhere('bumonmei','BettyRoad');
                                                                        }
                                                                    // 条件（扱い部門がジュエリー）
                                                                        if($out5_c == "ON"){
                                                                            $query->orWhere('bumonmei','Jewelry');
                                                                        }
                                                        
                                                            })
                                                        // ソート順指定
                                                            ->orderBy('uriage', 'asc')
                                                            ->get();
                                                        // クエリビルダスタート
                                                            $past_i = 0;
                                                            // 変数リセット
                                                                $past_y_sum_uriage = "";
                                                                $past_y_sum_number = "";
                                                                $past_y_sum_arari= "";
                                                                foreach ($past_y_buys as $past_y_buy) {
                                                                    // 各月名
                                                                        $past_y_month[$past_i]= $past_y_buy->y_month;
                                                                    // 各月ヤフー売上
                                                                        $past_y_uriage[$past_i]= $past_y_buy->y_uriage;
                                                                        // 全過去期間に現在の期間が含まれている場合
                                                                            if(strpos($past_temp3_y_manthly_data, $past_y_month[$past_i] ) !== false){
                                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                                    $past_temp3_y_manthly_data = str_replace($past_y_month[$past_i], $past_y_uriage[$past_i], $past_temp3_y_manthly_data);
                                                                            }

                                                                    // 全期間ヤフー売上合計
                                                                        $past_y_sum_uriage = (int)$past_y_sum_uriage + (int)$past_y_uriage[$past_i];
                                                                    // 各月ヤフー点数
                                                                        $past_y_number[$past_i]= $past_y_buy->y_number;
                                                                        // 全過去期間に現在の期間が含まれている場合
                                                                            if(strpos($past_temp3_y_manthly_data2, $past_y_month[$past_i] ) !== false){
                                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                                    $past_temp3_y_manthly_data2 = str_replace($past_y_month[$past_i], $past_y_number[$past_i], $past_temp3_y_manthly_data2);
                                                                            }

                                                                    // 全期間ヤフー点数合計
                                                                        $past_y_sum_number = (int)$past_y_sum_number + (int)$past_y_number[$past_i];



                                                                    // 各月ヤフー粗利
                                                                        $past_y_arari[$past_i]= $past_y_buy->y_arari;
                                                                        // 全過去期間に現在の期間が含まれている場合
                                                                            if(strpos($past_temp3_y_manthly_data3, $past_y_month[$past_i] ) !== false){
                                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                                    $past_temp3_y_manthly_data3 = str_replace($past_y_month[$past_i], $past_y_arari[$past_i], $past_temp3_y_manthly_data3);
                                                                            }

                                                                    // 全期間ヤフー粗利合計
                                                                        $past_y_sum_arari = (int)$past_y_sum_arari + (int)$past_y_arari[$past_i];
                                                                        
                                                                    $past_i++;
                                                                }

                                                            // 全期間ヤフー売上合計とその平均値のHTML作成
                                                                $past_temp3_y_sum = "";
                                                                if($past_y_sum_uriage <> 0 && $past_y_sum_uriage <> ""){
                                                                    $past_y_sum_uriage_c = number_format((int)$past_y_sum_uriage); 
                                                                    $past_y_sum_uriage_ave = number_format(floor((int)$past_y_sum_uriage / $past_i));
                                                                    $past_y_sum_uriage_ave2 = floor((int)$past_y_sum_uriage / $past_i);
                                                                } else {
                                                                    $past_y_sum_uriage_c = $past_y_sum_uriage; 
                                                                    $past_y_sum_uriage_ave = 0;
                                                                    $past_y_sum_uriage_ave2 = 0;
                                                                }
                                                                $past_temp3_y_sum = "<div class='title4 ta_y'>" . $past_y_sum_uriage_c . "</div><div class='title4 ta_y'>" . $past_y_sum_uriage_ave . "</div></div>";
                                                            // 全期間ヤフー売上点数合計とその平均値のHTML作成
                                                                $past_temp3_y_sum2 = "";
                                                                if($past_y_sum_number <> 0 && $past_y_sum_number <> ""){
                                                                    $past_y_sum_number_c = number_format((int)$past_y_sum_number); 
                                                                    $past_y_sum_number_ave = number_format(floor((int)$past_y_sum_number / $past_i));
                                                                    $past_y_sum_number_ave2 = floor((int)$past_y_sum_number / $past_i);
                                                                } else {
                                                                    $past_y_sum_number_c = $past_y_sum_number; 
                                                                    $past_y_sum_number_ave = 0;
                                                                    $past_y_sum_number_ave2 = 0;
                                                                }
                                                                $past_temp3_y_sum2 = "<div class='title4 ta_y'>" . $past_y_sum_number_c . "</div><div class='title4 ta_y'>" . $past_y_sum_number_ave . "</div></div>";
                                                            // 全期間ヤフー粗利合計とその平均値のHTML作成
                                                                $past_temp3_y_sum3 = "";
                                                                if($past_y_sum_arari <> 0 && $past_y_sum_arari <> ""){
                                                                    $past_y_sum_arari_c = number_format((int)$past_y_sum_arari); 
                                                                    $past_y_sum_arari_ave = number_format(floor((int)$past_y_sum_arari / $past_i));
                                                                    $past_y_sum_arari_ave2 = floor((int)$past_y_sum_arari / $past_i);
                                                                } else {
                                                                    $past_y_sum_arari_c = $past_y_sum_arari; 
                                                                    $past_y_sum_arari_ave = 0;
                                                                    $past_y_sum_arari_ave2 = 0;
                                                                }
                                                                $past_temp3_y_sum3 = "<div class='title4 ta_y'>" . $past_y_sum_arari_c . "</div><div class='title4 ta_y'>" . $past_y_sum_arari_ave . "</div></div>";



                            /************************************************************************************************************************************************************************************************************* */
                                // その他用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */
                            

                                                // DB検索（その他値）スタート
                                                        $past_o_buys = DB::table($table_name) 
                                                        // 月毎にグループ化して値を分けるための処理
                                                            ->select([
                                                                \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS o_month'),
                                                                \DB::raw("SUM(uriagekingaku) AS o_uriage"),
                                                                \DB::raw("SUM(uriagesuu) AS o_number"),
                                                                \DB::raw("SUM(ararikingaku) AS o_arari"),
                                                            ])
                                                            ->groupBy('o_month')
                                                            // 条件（売上部門の指定）
                                                                ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
        
                                                                    // 条件（売上部門が店舗）
                                                                        if($out1_a == "ON"){
                                                                            $query->orWhere('baikyakukubun', 1);
                                                                        }
                                                                    // 条件（売上部門が通販）
                                                                        if($out1_b == "ON"){
                                                                            $query->orWhere('baikyakukubun',2);
                                                                        }
                                                                    // 条件（売上部門が卸）
                                                                        if($out1_c == "ON"){
                                                                            $query->orWhere('baikyakukubun',3);
                                                                        }
                                                                    // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                        if($out1_d == "ON"){
                                                                            $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                        }
                                                            
                                                                })

                                                            // 条件（期間の指定）
                                                                ->whereBetween($table_name . '.uriage', [$past_between_start, $past_between_end])
                                                                
                                                            // 条件（分類名）
                                                                ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                    // 条件（商品区分分類名が新品）
                                                                        if($out2_a == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                        }
                                                                    // 条件（商品区分分類名が中古）
                                                                        if($out2_b == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                        }
                                                                    // 条件（商品区分分類名がアンティーク）
                                                                        if($out2_c == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                        }
                                                                    // 条件（商品区分分類名がその他）
                                                                        if($out2_d == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                        }
                                                                    // 条件（商品区分分類名が修理）
                                                                        if($out2_e == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                        }
                                                            
                                                            })
                                                        // 条件（通販区分がその他「5：電話・雑誌」「4：Yオークション」「9：修理品返送」）
                                                            //->Where([['tsuuhankubun', '==', 5], ['tsuuhankubun', '==', 4], ['tsuuhankubun', '==', 9]])
                                                            ->where(function ($query) use ($out2_e) {
                                                                $query->orwhere('.tsuuhankubun', 5);
                                                                $query->orwhere('.tsuuhankubun', 4);
                                                                    // 条件（商品区分分類名が修理）
                                                                        if($out2_e == "ON"){
                                                                            $query->orwhere('.tsuuhankubun', 9);
                                                                        }
                                                            })

                                                        // 条件（免税）
                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                    // 条件（免税区分が0:対象外）
                                                                        if($out4_a == "ON"){
                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                        }
                                                                    // 条件（免税区分が1:免税）
                                                                        if($out4_b == "ON"){
                                                                            $query->orwhere("menzei","like","%免税%");
                                                                        }
                                                            })
                                                        // 条件（扱い部門）
                                                            ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                    $query->orWhere('bumonmei','');

                                                                    // 条件（扱い部門がジャック）
                                                                        if($out5_a == "ON"){
                                                                            $query->orWhere('bumonmei','Jackroad');
                                                                        }
                                                                    // 条件（扱い部門がベティー）
                                                                        if($out5_b == "ON"){
                                                                            $query->orWhere('bumonmei','BettyRoad');
                                                                        }
                                                                    // 条件（扱い部門がジュエリー）
                                                                        if($out5_c == "ON"){
                                                                            $query->orWhere('bumonmei','Jewelry');
                                                                        }
                                                        
                                                            })
                                                        // ソート順指定
                                                            ->orderBy('uriage', 'asc')
                                                            ->get();
                                                        // クエリビルダスタート
                                                            $past_i = 0;
                                                            // 変数リセット
                                                                $past_o_sum_uriage = "";
                                                                $past_o_sum_number = "";
                                                                $past_o_sum_arari= "";
                                                                foreach ($past_o_buys as $past_o_buy) {
                                                                    // 各月名
                                                                        $past_o_month[$past_i]= $past_o_buy->o_month;
                                                                    // 各月その他売上
                                                                        $past_o_uriage[$past_i]= $past_o_buy->o_uriage;
                                                                        // 全過去期間に現在の期間が含まれている場合
                                                                            if(strpos($past_temp3_o_manthly_data, $past_o_month[$past_i] ) !== false){
                                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                                    $past_temp3_o_manthly_data = str_replace($past_o_month[$past_i], $past_o_uriage[$past_i], $past_temp3_o_manthly_data);
                                                                            }

                                                                    // 全期間その他売上合計
                                                                        $past_o_sum_uriage = (int)$past_o_sum_uriage + (int)$past_o_uriage[$past_i];

                                                                    // 各月その他点数
                                                                        $past_o_number[$past_i]= $past_o_buy->o_number;
                                                                        // 全過去期間に現在の期間が含まれている場合
                                                                            if(strpos($past_temp3_o_manthly_data2, $past_o_month[$past_i] ) !== false){
                                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                                    $past_temp3_o_manthly_data2 = str_replace($past_o_month[$past_i], $past_o_number[$past_i], $past_temp3_o_manthly_data2);
                                                                            }

                                                                    // 全期間その他点数合計
                                                                        $past_o_sum_number = (int)$past_o_sum_number + (int)$past_o_number[$past_i];



                                                                    // 各月その他粗利
                                                                        $past_o_arari[$past_i]= $past_o_buy->o_arari;
                                                                        // 全過去期間に現在の期間が含まれている場合
                                                                            if(strpos($past_temp3_o_manthly_data3, $past_o_month[$past_i] ) !== false){
                                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                                    $past_temp3_o_manthly_data3 = str_replace($past_o_month[$past_i], $past_o_arari[$past_i], $past_temp3_o_manthly_data3);
                                                                            }

                                                                    // 全期間その他粗利合計
                                                                        $past_o_sum_arari = (int)$past_o_sum_arari + (int)$past_o_arari[$past_i];
                                                                        
                                                                    $past_i++;
                                                                }

                                                            // 全期間その他売上合計とその平均値のHTML作成
                                                                $past_temp3_o_sum = "";
                                                                if($past_o_sum_uriage <> 0 && $past_o_sum_uriage <> ""){
                                                                    $past_o_sum_uriage_c = number_format((int)$past_o_sum_uriage); 
                                                                    $past_o_sum_uriage_ave = number_format(floor((int)$past_o_sum_uriage / $past_i));
                                                                    $past_o_sum_uriage_ave2 = floor((int)$past_o_sum_uriage / $past_i);
                                                                } else {
                                                                    $past_o_sum_uriage_c = $past_o_sum_uriage; 
                                                                    $past_o_sum_uriage_ave = 0;
                                                                    $past_o_sum_uriage_ave2 = 0;
                                                                }
                                                                $past_temp3_o_sum = "<div class='title4 ta_o'>" . $past_o_sum_uriage_c . "</div><div class='title4 ta_o'>" . $past_o_sum_uriage_ave . "</div></div>";
                                                            // 全期間その他売上点数合計とその平均値のHTML作成
                                                                $past_temp3_o_sum2 = "";
                                                                if($past_o_sum_number <> 0 && $past_o_sum_number <> ""){
                                                                    $past_o_sum_number_c = number_format((int)$past_o_sum_number); 
                                                                    $past_o_sum_number_ave = number_format(floor((int)$past_o_sum_number / $past_i));
                                                                    $past_o_sum_number_ave2 = floor((int)$past_o_sum_number / $past_i);
                                                                } else {
                                                                    $past_o_sum_number_c = $past_o_sum_number; 
                                                                    $past_o_sum_number_ave = 0;
                                                                    $past_o_sum_number_ave2 = 0;
                                                                }
                                                                $past_temp3_o_sum2 = "<div class='title4 ta_o'>" . $past_o_sum_number_c . "</div><div class='title4 ta_o'>" . $past_o_sum_number_ave . "</div></div>";
                                                            // 全期間その他粗利合計とその平均値のHTML作成
                                                                $past_temp3_o_sum3 = "";
                                                                if($past_o_sum_arari <> 0 && $past_o_sum_arari <> ""){
                                                                    $past_o_sum_arari_c = number_format((int)$past_o_sum_arari); 
                                                                    $past_o_sum_arari_ave = number_format(floor((int)$past_o_sum_arari / $past_i));
                                                                    $past_o_sum_arari_ave2 = floor((int)$past_o_sum_arari / $past_i);
                                                                } else {
                                                                    $past_o_sum_arari_c = $past_o_sum_arari; 
                                                                    $past_o_sum_arari_ave = 0;
                                                                    $past_o_sum_arari_ave2 = 0;
                                                                }
                                                                $past_temp3_o_sum3 = "<div class='title4 ta_o'>" . $past_o_sum_arari_c . "</div><div class='title4 ta_o'>" . $past_o_sum_arari_ave . "</div></div>";


                            

                            /************************************************************************************************************************************************************************************************************* */
                                // 全件用
                            /************************************************************************************************************************************************************************************************************* */

                                        // 各月の全部門売上合計の先頭（1列目）部分のタイトルHTML
                                            //$past_all_sum_uriage = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $past_all_sum_number = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                        // 各月のタイトル表示用HTMLを作成
                                            $js_month = "";
                                            foreach($manth_now_array as $val){
                                                // JSグラフ用
                                                    $js_month .= "'" . $val . "(" . date("Y-m", strtotime($val. " -" . ($diff_month + 1) . " month")) . ")'" . ",";
                                            }
                                            $past_temp3_title2 = "";
                                            $past_temp3_title3 = "";
                                            $past_temp3_title4 = "";
                                            $past_temp3_title5 = "";
                                            foreach($manth_past_array as $val){
                                                // 表示用
                                                    $val = mb_substr($val,0,-3);
                                                    $past_temp3_title2 .= "<div class='title2 ta_c'>" . $val . "</div>";
                                                    $past_temp3_title3 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                                    $past_temp3_title4 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                                    $past_temp3_title5 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                            }
                                
                                            $past_temp3_title = "<div class='wid100 ul2'><div class='title5 ta_c'>" . $past_between_start_view. "～<br>" .$past_between_end_view . "</div>" .$past_temp3_title2 ."<div class='title6 ta_c'>累計</div><div class='title6 ta_c'>平均</div></div>";
                                            $past_temp3_title3 = "<div class='wid100 ul2'><div class='title7 ta_c'>" . $past_between_start_view. "～<br>" .$past_between_end_view . "</div>" .$past_temp3_title3 ."<div class='title7 ta_c'>平均</div></div>";
                                            $past_temp3_title4 = "<div class='wid100 ul2 bg_green'><div class='title7 ta_c'>" . $past_between_start_view. "～<br>" .$past_between_end_view . "</div>" .$past_temp3_title4 ."<div class='title7 ta_c'>平均</div></div>";
                                            $past_temp3_title5 = "<div class='wid100 ul2 bg_yellow'><div class='title7 ta_c'>" . $past_between_start_view. "～<br>" .$past_between_end_view . "</div>" .$past_temp3_title5 ."<div class='title7 ta_c'>平均</div></div>";
                                        
                                     
                                        
                                        // 全期間の全部門売上合計用変数リセット
                                            $past_all_sum_uriage_all = 0;
                                            $past_all_sum_number_all = 0;
                                            $past_all_sum_arari_all = 0;
                                            for($past_all_i = 0; $past_all_i < $past_i; $past_all_i++){
                                                // 各月の全部門売上合計用変数リセット
                                                    $past_all_month_uriage = 0;
                                                    $past_all_month_number= 0;
                                                    $past_all_month_arari= 0;
                                                // 各月の全部門売上合計をHTMLへ
                                                        if(isset($past_r_uriage[$past_all_i])){$past_all_month_uriage = $past_all_month_uriage + (int)$past_r_uriage[$past_all_i];}
                                                        if(isset($past_r_number[$past_all_i])){$past_all_month_number = $past_all_month_number + (int)$past_r_number[$past_all_i]; }
                                                        if(isset($past_r_arari[$past_all_i])){$past_all_month_arari = $past_all_month_arari + (int)$past_r_arari[$past_all_i]; }
                                                        if(isset($past_j_uriage[$past_all_i])){$past_all_month_uriage = $past_all_month_uriage + (int)$past_j_uriage[$past_all_i]; }
                                                        if(isset($past_j_number[$past_all_i])){$past_all_month_number = $past_all_month_number + (int)$past_j_number[$past_all_i];} 
                                                        if(isset($past_j_arari[$past_all_i])){$past_all_month_arari = $past_all_month_arari + (int)$past_j_arari[$past_all_i]; }
                                                        if(isset($past_y_uriage[$past_all_i])){ $past_all_month_uriage = $past_all_month_uriage + (int)$past_y_uriage[$past_all_i]; }
                                                        if(isset($past_y_number[$past_all_i])){ $past_all_month_number = $past_all_month_number + (int)$past_y_number[$past_all_i]; }
                                                        if(isset($past_y_arari[$past_all_i])){ $past_all_month_arari = $past_all_month_arari + (int)$past_y_arari[$past_all_i]; }
                                                        if(isset($past_o_uriage[$past_all_i])){ $past_all_month_uriage = $past_all_month_uriage + (int)$past_o_uriage[$past_all_i]; }
                                                        if(isset($past_o_number[$past_all_i])){ $past_all_month_number = $past_all_month_number + (int)$past_o_number[$past_all_i]; }
                                                        if(isset($past_o_arari[$past_all_i])){ $past_all_month_arari = $past_all_month_arari + (int)$past_o_arari[$past_all_i]; }

                                                 // 全期間の全部門売上合計
                                                    $past_all_sum_uriage_all = (int)$past_all_sum_uriage_all + (int)$past_all_month_uriage;
                                                    $past_all_sum_number_all = (int)$past_all_sum_number_all + (int)$past_all_month_number;
                                                    $past_all_sum_arari_all = (int)$past_all_sum_arari_all + (int)$past_all_month_arari;
                                                
                                            }



                            /************************************************************************************************************************************************************************************************************* */
                                // 最終ソース出力
                            /************************************************************************************************************************************************************************************************************* */
                                        


                                        // 楽天（過去）用HTMLの作成
                                                $past_js_r_uriage  = "";
                                                $past_js_r_number  = "";
                                                $past_js_r_arari  = "";
                                                $past_temp3_r_manthly_html = "";
                                                $past_temp3_r_manthly_html2 = "";
                                                $past_temp3_r_manthly_html3 = "";
                                                // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                    foreach($manth_past_array as $val){
                                                            $val = mb_substr($val,0,-3);
                                                            if(strpos($past_temp3_r_manthly_data, $val ) !== false){
                                                                $past_temp3_r_manthly_data = str_replace($val, 0, $past_temp3_r_manthly_data);
                                                            }
                                                            if(strpos($past_temp3_r_manthly_data2, $val ) !== false){
                                                                $past_temp3_r_manthly_data2 = str_replace($val, 0, $past_temp3_r_manthly_data2);
                                                            }
                                                            if(strpos($past_temp3_r_manthly_data3, $val ) !== false){
                                                                $past_temp3_r_manthly_data3 = str_replace($val, 0, $past_temp3_r_manthly_data3);
                                                            }
                                                    }
                                                // 各月売上が記載された文字列を配列へ変換
                                                    $past_temp3_r_manthly_array = explode(',',$past_temp3_r_manthly_data);
                                                    $past_temp3_r_manthly_array2 = explode(',',$past_temp3_r_manthly_data2);
                                                    $past_temp3_r_manthly_array3 = explode(',',$past_temp3_r_manthly_data3);
                                                // 各月のHTMLを作成
                                                    $past_r_last_uriage = "";
                                                    foreach($past_temp3_r_manthly_array as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_r_uriage  .= "0, ";
                                                            // 表示用
                                                                $past_temp3_r_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_r_uriage  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp3_r_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp3_r_manthly_array2 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_r_number  .= "0, ";
                                                            // 表示用
                                                                $past_temp3_r_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_r_number  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp3_r_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp3_r_manthly_array3 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_r_arari  .= "0, ";
                                                            // 表示用
                                                                $past_temp3_r_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_r_arari  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp3_r_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    // 全体HTMLの作成
                                                        if(isset($past_temp3_r_manthly_html) && isset($past_temp3_r_sum)){
                                                            $past_temp3_r_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>楽天</div>" . $past_temp3_r_manthly_html . $past_temp3_r_sum;
                                                        }
                                                        if(isset($past_temp3_r_manthly_html2) && isset($past_temp3_r_sum2)){
                                                            $past_temp3_r_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>楽天</div>" . $past_temp3_r_manthly_html2 . $past_temp3_r_sum2;
                                                        }
                                                        if(isset($past_temp3_r_manthly_html3) && isset($past_temp3_r_sum3)){
                                                            $past_temp3_r_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>楽天</div>" . $past_temp3_r_manthly_html3 . $past_temp3_r_sum3;
                                                        }
                                
                            
                                        // 自社（過去）用HTMLの作成
                                                $past_js_j_uriage  = "";
                                                $past_js_j_number  = "";
                                                $past_js_j_arari = "";
                                                $past_temp3_j_manthly_html = "";
                                                $past_temp3_j_manthly_html2 = "";
                                                $past_temp3_j_manthly_html3 = "";
                                                // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                    foreach($manth_past_array as $val){
                                                            $val = mb_substr($val,0,-3);
                                                            if(strpos($past_temp3_j_manthly_data, $val ) !== false){
                                                                $past_temp3_j_manthly_data = str_replace($val, 0, $past_temp3_j_manthly_data);
                                                            }
                                                            if(strpos($past_temp3_j_manthly_data2, $val ) !== false){
                                                                $past_temp3_j_manthly_data2 = str_replace($val, 0, $past_temp3_j_manthly_data2);
                                                            }
                                                            if(strpos($past_temp3_j_manthly_data3, $val ) !== false){
                                                                $past_temp3_j_manthly_data3 = str_replace($val, 0, $past_temp3_j_manthly_data3);
                                                            }
                                                    }
                                                // 各月売上が記載された文字列を配列へ変換
                                                    $past_temp3_j_manthly_array = explode(',',$past_temp3_j_manthly_data);
                                                    $past_temp3_j_manthly_array2 = explode(',',$past_temp3_j_manthly_data2);
                                                    $past_temp3_j_manthly_array3 = explode(',',$past_temp3_j_manthly_data3);
                                                // 各月のHTMLを作成
                                                    foreach($past_temp3_j_manthly_array as $val){

                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_j_uriage  .= "0, ";
                                                            // 表示用
                                                                $past_temp3_j_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_j_uriage  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp3_j_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp3_j_manthly_array2 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_j_number  .= "0, ";
                                                            // 表示用
                                                                $past_temp3_j_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_j_number  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp3_j_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp3_j_manthly_array3 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_j_arari  .= "0, ";
                                                            // 表示用
                                                                $past_temp3_j_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_j_arari  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp3_j_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                // 全体HTMLの作成
                                                    if(isset($past_temp3_j_manthly_html) && isset($past_temp3_j_sum)){
                                                        $past_temp3_j_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>自社</div>" . $past_temp3_j_manthly_html . $past_temp3_j_sum;
                                                    }
                                                    if(isset($past_temp3_j_manthly_html2) && isset($past_temp3_j_sum2)){
                                                        $past_temp3_j_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>自社</div>" . $past_temp3_j_manthly_html2 . $past_temp3_j_sum2;
                                                    }
                                                    if(isset($past_temp3_j_manthly_html3) && isset($past_temp3_j_sum3)){
                                                        $past_temp3_j_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>自社</div>" . $past_temp3_j_manthly_html3 . $past_temp3_j_sum3;
                                                    }


                                        // ヤフー（過去）用HTMLの作成
                                                $past_js_y_uriage  = "";
                                                $past_js_y_number  = "";
                                                $past_js_y_arari  = "";
                                                $past_temp3_y_manthly_html = "";
                                                $past_temp3_y_manthly_html2 = "";
                                                $past_temp3_y_manthly_html3 = "";
                                                // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                    foreach($manth_past_array as $val){
                                                            $val = mb_substr($val,0,-3);
                                                            if(strpos($past_temp3_y_manthly_data, $val ) !== false){
                                                                $past_temp3_y_manthly_data = str_replace($val, 0, $past_temp3_y_manthly_data);
                                                            }
                                                            if(strpos($past_temp3_y_manthly_data2, $val ) !== false){
                                                                $past_temp3_y_manthly_data2 = str_replace($val, 0, $past_temp3_y_manthly_data2);
                                                            }
                                                            if(strpos($past_temp3_y_manthly_data3, $val ) !== false){
                                                                $past_temp3_y_manthly_data3 = str_replace($val, 0, $past_temp3_y_manthly_data3);
                                                            }
                                                    }
                                                // 各月売上が記載された文字列を配列へ変換
                                                    $past_temp3_y_manthly_array = explode(',',$past_temp3_y_manthly_data);
                                                    $past_temp3_y_manthly_array2 = explode(',',$past_temp3_y_manthly_data2);
                                                    $past_temp3_y_manthly_array3 = explode(',',$past_temp3_y_manthly_data3);
                                                // 各月のHTMLを作成
                                                    foreach($past_temp3_y_manthly_array as $val){
                                                        
                                                        if($val == ""){
                                                            // 表示用
                                                                $past_temp3_y_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            // JSグラフ用
                                                                $past_js_y_uriage  .= "0, ";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_y_uriage  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp3_y_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp3_y_manthly_array2 as $val){

                                                        if($val == ""){
                                                            // 表示用
                                                                $past_temp3_y_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            // JSグラフ用
                                                                $past_js_y_number  .= "0, ";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_y_number  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp3_y_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp3_y_manthly_array3 as $val){
                                                        
                                                        if($val == ""){
                                                            // 表示用
                                                                $past_temp3_y_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            // JSグラフ用
                                                                $past_js_y_arari  .= "0, ";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_y_arari  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp3_y_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                // 全体HTMLの作成
                                                    if(isset($past_temp3_y_manthly_html) && isset($past_temp3_y_sum)){
                                                        $past_temp3_y_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>ヤフー</div>" . $past_temp3_y_manthly_html . $past_temp3_y_sum;
                                                    }
                                                    if(isset($past_temp3_y_manthly_html2) && isset($past_temp3_y_sum2)){
                                                        $past_temp3_y_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>ヤフー</div>" . $past_temp3_y_manthly_html2 . $past_temp3_y_sum2;
                                                    }
                                                    if(isset($past_temp3_y_manthly_html3) && isset($past_temp3_y_sum3)){
                                                        $past_temp3_y_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>ヤフー</div>" . $past_temp3_y_manthly_html3 . $past_temp3_y_sum3;
                                                    }

                                        // その他（過去）用HTMLの作成
                                                $past_js_o_uriage  = "";
                                                $past_js_o_number  = "";
                                                $past_js_o_arari  = "";
                                                $past_temp3_o_manthly_html = "";
                                                $past_temp3_o_manthly_html2 = "";
                                                $past_temp3_o_manthly_html3 = "";
                                                // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                    foreach($manth_past_array as $val){
                                                            $val = mb_substr($val,0,-3);
                                                            if(strpos($past_temp3_o_manthly_data, $val ) !== false){
                                                                $past_temp3_o_manthly_data = str_replace($val, 0, $past_temp3_o_manthly_data);
                                                            }
                                                            if(strpos($past_temp3_o_manthly_data2, $val ) !== false){
                                                                $past_temp3_o_manthly_data2 = str_replace($val, 0, $past_temp3_o_manthly_data2);
                                                            }
                                                            if(strpos($past_temp3_o_manthly_data3, $val ) !== false){
                                                                $past_temp3_o_manthly_data3 = str_replace($val, 0, $past_temp3_o_manthly_data3);
                                                            }
                                                    }
                                                // 各月売上が記載された文字列を配列へ変換
                                                    $past_temp3_o_manthly_array = explode(',',$past_temp3_o_manthly_data);
                                                    $past_temp3_o_manthly_array2 = explode(',',$past_temp3_o_manthly_data2);
                                                    $past_temp3_o_manthly_array3 = explode(',',$past_temp3_o_manthly_data3);
                                                // 各月のHTMLを作成
                                                    foreach($past_temp3_o_manthly_array as $val){
                                                        
                                                        if($val == ""){
                                                            // 表示用
                                                                $past_temp3_o_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            // JSグラフ用
                                                                $past_js_o_uriage  .= "0, ";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_o_uriage  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp3_o_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp3_o_manthly_array2 as $val){

                                                        if($val == ""){
                                                            // 表示用
                                                                $past_temp3_o_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            // JSグラフ用
                                                                $past_js_o_number  .= "0, ";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_o_number  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp3_o_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp3_o_manthly_array3 as $val){
                                                        
                                                        if($val == ""){
                                                            // 表示用
                                                                $past_temp3_o_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            // JSグラフ用
                                                                $past_js_o_arari  .= "0, ";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_o_arari  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp3_o_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                // 全体HTMLの作成
                                                    if(isset($past_temp3_o_manthly_html) && isset($past_temp3_o_sum)){
                                                        $past_temp3_o_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>その他</div>" . $past_temp3_o_manthly_html . $past_temp3_o_sum;
                                                    }
                                                    if(isset($past_temp3_o_manthly_html2) && isset($past_temp3_o_sum2)){
                                                        $past_temp3_o_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>その他</div>" . $past_temp3_o_manthly_html2 . $past_temp3_o_sum2;
                                                    }
                                                    if(isset($past_temp3_o_manthly_html3) && isset($past_temp3_o_sum3)){
                                                        $past_temp3_o_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>その他</div>" . $past_temp3_o_manthly_html3 . $past_temp3_o_sum3;
                                                    }





                                        // 各月の全部門売上合計のJS表示用
                                                $js_past_all_month_uriage = "";
                                                $js_past_all_month_number = "";
                                                $js_past_all_month_arari = "";
                                                $i = 0;
                                                foreach($manth_past_array as $val){
                                                    $all_js = 0;
                                                    $all_js2 = 0;
                                                    $all_js3 = 0;
                                                    $all_js = (int)$all_js + (int)$past_temp3_j_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$past_temp3_j_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$past_temp3_j_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$past_temp3_r_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$past_temp3_r_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$past_temp3_r_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$past_temp3_y_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$past_temp3_y_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$past_temp3_y_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$past_temp3_o_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$past_temp3_o_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$past_temp3_o_manthly_array3[$i];

                                                    $js_past_all_month_uriage .= $all_js . ", ";
                                                    $js_past_all_month_number .= $all_js2 . ", ";
                                                    $js_past_all_month_arari .= $all_js3 . ", ";
                                                    
                                                    $i++;
                                                }
        


                                // 過去・楽天・粗利率

                                    $i = 0;
                                    $past_r_ratio = "";
                                    $past_r_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>粗利率(楽天)</div>";
                                    $past_r_total = "";
                                    $past_r_total_js = "";
                                    $all_total = "";
                                    $past_r_total_ratio = "";
                                    foreach($past_temp3_r_manthly_array3 as $var){
                                        if($var == 0){
                                            $past_r_ratio = "---";
                                            $past_r_total = $past_r_total;
                                            if($past_temp3_r_manthly_array[$i] == 0){
                                                $all_total = $all_total;
                                            } else {
                                                $all_total = (int)$all_total + (int)$past_temp3_r_manthly_array[$i];
                                            }
                                        } else {
                                            if($past_temp3_r_manthly_array[$i] <> 0 && $var <> 0 && $past_temp3_r_manthly_array[$i] <> "" && $var <> ""){
                                                $past_r_ratio = (floor(((float)$var / (float)$past_temp3_r_manthly_array[$i]) * 100 * 10)) / 10;
                                            } else {
                                                $past_r_ratio = "---";
                                            }
                                            $past_r_total = (int)$past_r_total + (int)$var;
                                            if($past_temp3_r_manthly_array[$i] == 0){
                                                $all_total = $all_total;
                                            } else {
                                                $all_total = (int)$all_total + (int)$past_temp3_r_manthly_array[$i];
                                            }
                                        }
                                        ${"past_r_ratio_" .$i} = "";
                                        ${"past_r_ratio_" .$i} = $past_r_ratio;

                                        $past_r_total_js  .= (float)$past_r_ratio . ", ";
                                        if($past_r_ratio <> "" && $past_r_ratio <> 0){$past_r_ratio = number_format((float)$past_r_ratio ,1);}
                                        $past_r_sum_arari_per .= "<div class='title6 ta_r'>" . $past_r_ratio . "%</div>";

                                        $i++;
                                    }
                                    // 楽天用粗利率を取得
                                        if($past_r_total <> 0 && $all_total <> 0 && $past_r_total <> "" && $all_total <> ""){
                                            $past_r_total_ratio = number_format((floor(((int)$past_r_total / (int)$all_total) * 100 * 10)) / 10 ,1);
                                        } else {
                                            $past_r_total_ratio = "---";
                                        }

                                        $past_r_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_r_total_ratio . "%</div></div>";

                                    // 過去・自社・粗利率

                                        $i = 0;
                                        $past_j_ratio = "";
                                        $past_j_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>粗利率(自社)</div>";
                                        $past_j_total = "";
                                        $past_j_total_js = "";
                                        $past_all_total = "";
                                        $past_j_total_ratio = "";
                                        foreach($past_temp3_j_manthly_array3 as $var){
                                            if($var == 0){
                                                $past_j_ratio = "---";
                                                $past_j_total = $past_j_total;
                                                if($past_temp3_j_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp3_j_manthly_array[$i];
                                                }
                                            } else {
                                                if($var <> 0 && $past_temp3_j_manthly_array[$i] <> 0 && $var <> "" && $past_temp3_j_manthly_array[$i] <> ""){
                                                    $past_j_ratio = (floor(((float)$var / (float)$past_temp3_j_manthly_array[$i]) * 100 * 10)) / 10;
                                                } else {
                                                    $past_j_ratio = "---";
                                                }
                                                $past_j_total = (int)$past_j_total + (int)$var;
                                                if($past_temp3_j_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp3_j_manthly_array[$i];
                                                }
                                            }
                                            ${"past_j_ratio_" .$i} = "";
                                            ${"past_j_ratio_" .$i} = $past_j_ratio;
                                            
                                            $past_j_total_js  .= (float)$past_j_ratio . ", ";
                                            $past_j_sum_arari_per .= "<div class='title6 ta_r'>" . $past_j_ratio . "%</div>";

                                            $i++;
                                        }
                                        // 過去・自社用粗利率を取得
                                            if($past_j_total <> 0 && $past_all_total <> 0 && $past_j_total <> "" && $past_all_total <> ""){
                                                $past_j_total_ratio = number_format((floor(((float)$past_j_total / (float)$past_all_total) * 100 * 10)) / 10 ,1);
                                            } else {
                                                $past_j_total_ratio = "---";
                                            }

                                            $past_j_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_j_total_ratio . "%</div></div>";


                                    // 過去・ヤフー・粗利率
                                        $past_y_total_js = "";

                                        $i = 0;
                                        $past_y_ratio = "";
                                        $past_y_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>粗利率(ヤフー)</div>";
                                        $past_y_total = "";
                                        $past_all_total = "";
                                        $past_y_total_ratio = "";
                                        foreach($past_temp3_y_manthly_array3 as $var){
                                            if($var == 0){
                                                $past_y_ratio = "---";
                                                $past_y_total = $past_y_total;
                                                if($past_temp3_y_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp3_y_manthly_array[$i];
                                                }
                                            } else {
                                                if($var <> 0 && $past_temp3_y_manthly_array[$i] <> 0 && $var <> "" && $past_temp3_y_manthly_array[$i] <> ""){
                                                    $past_y_ratio = number_format((floor(((float)$var / (float)$past_temp3_y_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $past_y_ratio = "---";
                                                }
                                                $past_y_total = (int)$past_y_total + (int)$var;
                                                if($past_temp3_y_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp3_y_manthly_array[$i];
                                                }
                                            }
                                            ${"past_y_ratio_" .$i} = "";
                                            ${"past_y_ratio_" .$i} = $past_y_ratio;
                                                    
                                            $past_y_total_js  .= (float)$past_y_ratio . ", ";
                                            $past_y_sum_arari_per .= "<div class='title6 ta_r'>" . $past_y_ratio . "%</div>";

                                            $i++;
                                        }
                                        // 過去・自社用粗利率を取得
                                            if($past_y_total == 0 || $past_y_total == "" || $past_all_total == 0 || $past_all_total == ""){
                                                $past_y_total_ratio = "---";
                                            } else {
                                                $past_y_total_ratio = number_format((floor(((int)$past_y_total / (int)$past_all_total) * 100 * 10)) / 10 ,1);
                                            }

                                            $past_y_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_y_total_ratio . "%</div></div>";


                                    // 過去・その他・粗利率
                                        $past_o_total_js = "";

                                        $i = 0;
                                        $past_o_ratio = "";
                                        $past_o_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>粗利率(その他)</div>";
                                        $past_o_total = "";
                                        $past_all_total = "";
                                        $past_o_total_ratio = "";
                                        foreach($past_temp3_o_manthly_array3 as $var){
                                            if($var == 0){
                                                $past_o_ratio = "---";
                                                $past_o_total = $past_o_total;
                                                if($past_temp3_o_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp3_o_manthly_array[$i];
                                                }
                                            } else {
                                                if($var <> 0 && $past_temp3_o_manthly_array[$i] <> 0 && $var <> "" && $past_temp3_o_manthly_array[$i] <> ""){
                                                    $past_o_ratio = number_format((floor(((float)$var / (float)$past_temp3_o_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $past_o_ratio = "---";
                                                }
                                                $past_o_total = (int)$past_o_total + (int)$var;
                                                if($past_temp3_o_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp3_o_manthly_array[$i];
                                                }
                                            }
                                            ${"past_o_ratio_" .$i} = "";
                                            ${"past_o_ratio_" .$i} = $past_o_ratio;
                                                    
                                            $past_o_total_js  .= (float)$past_o_ratio . ", ";
                                            $past_o_sum_arari_per .= "<div class='title6 ta_r'>" . $past_o_ratio . "%</div>";

                                            $i++;
                                        }
                                        // 過去・自社用粗利率を取得
                                            if($past_o_total == 0 || $past_o_total == "" || $past_all_total == 0 || $past_all_total == ""){
                                                $past_o_total_ratio = "---";
                                            } else {
                                                $past_o_total_ratio = number_format((floor(((int)$past_o_total / (int)$past_all_total) * 100 * 10)) / 10 ,1);
                                            }

                                            $past_o_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_o_total_ratio . "%</div></div>";




                                        // 各月の全部門売上合計の先頭（1列目）部分のタイトルHTML
                                            $past_all_sum_uriage = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $past_all_sum_number = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $past_all_sum_arari = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $past_all_sum_arari_per = "<div class='wid100 ul3'><div class='title5 ta_c'>粗利率(合計)</div>";

                                        // 各月の全部門売上合計を配列に代入
                                            $past_temp3_all_m_sum_uriage_array = array();
                                            $past_temp3_all_m_sum_number_array = array();
                                            $past_temp3_all_m_sum_arari_array = array();
                                            $i = 0;
                                            foreach($manth_past_array as $val){
                                                $all = "";
                                                $all2 = "";
                                                $all3 = "";
                                                $all = (int)$all + (int)$past_temp3_j_manthly_array[$i]; $all2 = (int)$all2 + (int)$past_temp3_j_manthly_array2[$i]; $all3 = (int)$all3 + (int)$past_temp3_j_manthly_array3[$i];
                                                $all = (int)$all + (int)$past_temp3_r_manthly_array[$i]; $all2 = (int)$all2 + (int)$past_temp3_r_manthly_array2[$i]; $all3 = (int)$all3 + (int)$past_temp3_r_manthly_array3[$i];
                                                $all = (int)$all + (int)$past_temp3_y_manthly_array[$i]; $all2 = (int)$all2 + (int)$past_temp3_y_manthly_array2[$i]; $all3 = (int)$all3 + (int)$past_temp3_y_manthly_array3[$i];
                                                $all = (int)$all + (int)$past_temp3_o_manthly_array[$i]; $all2 = (int)$all2 + (int)$past_temp3_o_manthly_array2[$i]; $all3 = (int)$all3 + (int)$past_temp3_o_manthly_array3[$i];
                                                array_push($past_temp3_all_m_sum_uriage_array,$all);
                                                array_push($past_temp3_all_m_sum_number_array,$all2);
                                                array_push($past_temp3_all_m_sum_arari_array,$all3);

                                                $i++;
                                            }
                                        // 各月の全部門売上合計部分のHTML作成
                                            foreach($past_temp3_all_m_sum_uriage_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $past_all_sum_uriage .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $past_all_sum_uriage .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                            }
                                        // 各月の全部門売上点数合計部分のHTML作成
                                            foreach($past_temp3_all_m_sum_number_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $past_all_sum_number .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $past_all_sum_number .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                            }
                                        // 各月の全部門粗利合計部分のHTML作成
                                            $i = 0;
                                            $past_arari_ratio = "";
                                            $past_all_arari_total = "";
                                            foreach($past_temp3_all_m_sum_arari_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $past_all_sum_arari .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $past_all_sum_arari .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                                // 各月の粗利率を取得
                                                    if($past_temp3_all_m_sum_uriage_array[$i] == 0){
                                                        $past_arari_ratio = "---";
                                                    } else {
                                                        $past_arari_ratio = number_format((floor(((int)$var / (int)$past_temp3_all_m_sum_uriage_array[$i]) * 100 * 10)) / 10 ,1);
                                                    }
                                                    // 過去・粗利・縦軸合計
                                                        $past_all_sum_arari_per .= "<div class='title6 ta_r'>" . $past_arari_ratio . "%</div>";
                                                    // 過去・楽天・自社・ヤフー・合計粗利率（JSグラフ用） 
                                                        $past_all_arari_total .= (float)$past_arari_ratio . ", ";
                                                    // 過去・現在の粗利率合計差の計算に使用
                                                        ${"past_arari_ratio_" . $i} = $past_arari_ratio;
                                                        
                                                $i++;
                                            }



                                                  
                                        // 全期間全部門売上合計とその平均値のHTML作成
                                            if($past_all_sum_uriage_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更
                                                    //$past_all_average = floor((int)$past_all_sum_uriage_all / $past_i);
                                                        $past_all_average = (int)$past_r_sum_uriage_ave2 + (int)$past_j_sum_uriage_ave2 + (int)$past_y_sum_uriage_ave2 + (int)$past_o_sum_uriage_ave2;
                                            } else {
                                                $past_all_average = 0;
                                            }
                                            $past_all_sum_uriage .= "<div class='title6 ta_r'>" . number_format((int)$past_all_sum_uriage_all) . "</div><div class='title6 ta_r'>" . number_format((int)$past_all_average) . "</div></div>";
                                        // 全HTMLを合体（検索対象外は除く）
                                            $view = "";
                                            $view .= $past_temp3_j_manthly_html;
                                            $view .= $past_temp3_r_manthly_html;
                                            $view .= $past_temp3_y_manthly_html;
                                            $view .= $past_temp3_o_manthly_html;
                                            if($out4_a == "ON" && $out4_b <> "ON"){ $view_title1 = "（免税以外）";} else if($out4_a <> "ON" && $out4_b == "ON"){$view_title1 = "（免税のみ）";} else {$view_title1 = "";}
                                            $past_temp3_all_sorce = "<p class='title_a'>金額（過去）" . $view_title1 . "</p><div class='box1'>" . $past_temp3_title . $view . $past_all_sum_uriage . "</div>";

                                        // 全期間全部門売上点数合計とその平均値のHTML作成
                                            if($past_all_sum_number_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更
                                                        $past_all_average2 = (int)$past_r_sum_number_ave2 + (int)$past_j_sum_number_ave2 + (int)$past_y_sum_number_ave2 + (int)$past_o_sum_number_ave2;
                                            } else {
                                                $past_all_average2 = 0;
                                            }
                                            $past_all_sum_number .= "<div class='title6 ta_r'>" . number_format((int)$past_all_sum_number_all) . "</div><div class='title6 ta_r'>" . number_format((int)$past_all_average2) . "</div></div>";
                                        // 全HTMLを合体（検索対象外は除く）
                                            $view2 = "";
                                            $view2 .= $past_temp3_j_manthly_html2;
                                            $view2 .= $past_temp3_r_manthly_html2;
                                            $view2 .= $past_temp3_y_manthly_html2;
                                            $view2 .= $past_temp3_o_manthly_html2;
                                            $past_temp3_all_sorce2 = "<p class='title_a'>点数（過去）" . $view_title1 . "</p><div class='box1'>" . $past_temp3_title . $view2 . $past_all_sum_number . "</div>";

                                        // 全期間全部門粗利合計とその平均値のHTML作成
                                            if($past_all_sum_arari_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更
                                                    $past_all_average3 = (int)$past_r_sum_arari_ave2 + (int)$past_j_sum_arari_ave2 + (int)$past_y_sum_arari_ave2 + (int)$past_o_sum_arari_ave2;
                                            } else {
                                                $past_all_average3 = 0;
                                            }
                                            $past_all_sum_arari .= "<div class='title6 ta_r'>" . number_format((int)$past_all_sum_arari_all) . "</div><div class='title6 ta_r'>" . number_format((int)$past_all_average3) . "</div></div>";
                                            // 粗利率の平均
                                                if($past_all_sum_arari_all <> 0){ $past_all_average4 = number_format(floor(((int)$past_all_sum_arari_all / (int)$past_all_sum_uriage_all) * 100 * 10) / 10 ,1);} else {$past_all_average4 = 0;}
                                                $past_all_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_all_average4 . "%</div></div>";
                                        
                                        // 全HTMLを合体（検索対象外は除く）
                                            $view3 = "";
                                            $view3 .= $past_temp3_j_manthly_html3;
                                            $view3 .= $past_temp3_r_manthly_html3;
                                            $view3 .= $past_temp3_y_manthly_html3;
                                            $view3 .= $past_temp3_o_manthly_html3;
                                            $past_temp3_all_sorce3 = "<p class='title_a'>粗利（過去）" . $view_title1 . "</p><div class='box1'>" . $past_temp3_title . $view3 . $past_all_sum_arari . $past_j_sum_arari_per . $past_r_sum_arari_per;
                                            $past_temp3_all_sorce3 .= $past_y_sum_arari_per;
                                            $past_temp3_all_sorce3 .= $past_o_sum_arari_per;
                                            $past_temp3_all_sorce3 .= $past_all_sum_arari_per  . "</div>";
                    
                    /************************************************************************************************************************************************************************************************************* */
                        // DB情報の受け取り（過去の期間）end
                    /************************************************************************************************************************************************************************************************************* */



                    /************************************************************************************************************************************************************************************************************* */
                        // DB情報の受け取り（検索期間）start
                    /************************************************************************************************************************************************************************************************************* */
                            $temp3_title2 = "";
                            $i = 0;

                            /************************************************************************************************************************************************************************************************************* */
                                // 自社用
                            /************************************************************************************************************************************************************************************************************* */

                                        // DB検索（自社値）スタート
                                                $j_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS j_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS j_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS j_number"),
                                                        \DB::raw("SUM(ararikingaku) AS j_arari"),
                                                    ])
                                                    ->groupBy('j_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
 
                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                      
                                                        })

                                                    // 条件（期間の指定）
                                                       // ->whereBetween($table_name . '.uriage', [$last_day_top, $last_day])
                                                        ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                            // 条件（商品区分分類名が新品）
                                                                if($out2_a == "ON"){
                                                                    $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                }
                                                            // 条件（商品区分分類名が中古）
                                                                if($out2_b == "ON"){
                                                                    $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                }
                                                            // 条件（商品区分分類名がアンティーク）
                                                                if($out2_c == "ON"){
                                                                    $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                }
                                                            // 条件（商品区分分類名がその他）
                                                                if($out2_d == "ON"){
                                                                    $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                }
                                                            // 条件（商品区分分類名が修理）
                                                                if($out2_e == "ON"){
                                                                    $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                }
                                                    
                                                    })
                                                // 条件（通販区分が自社）
                                                    ->where('tsuuhankubun',1)

                                                // 条件（免税）
                                                    ->where(function ($query) use ($out4_a,$out4_b) {
                                                            // 条件（免税区分が0:対象外）
                                                                if($out4_a == "ON"){
                                                                    $query->orwhere("menzei","like","%対象外%");
                                                                }
                                                            // 条件（免税区分が1:免税）
                                                                if($out4_b == "ON"){
                                                                    $query->orwhere("menzei","like","%免税%");
                                                                }
                                                    })
                                                // 条件（扱い部門）
                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                            $query->orWhere('bumonmei','');

                                                            // 条件（扱い部門がジャック）
                                                                if($out5_a == "ON"){
                                                                    $query->orWhere('bumonmei','Jackroad');
                                                                }
                                                            // 条件（扱い部門がベティー）
                                                                if($out5_b == "ON"){
                                                                    $query->orWhere('bumonmei','BettyRoad');
                                                                }
                                                            // 条件（扱い部門がジュエリー）
                                                                if($out5_c == "ON"){
                                                                    $query->orWhere('bumonmei','Jewelry');
                                                                }
                                                
                                                    })
                                                // ソート順指定
                                                    ->orderBy('uriage', 'asc')
                                                    ->get();
                                            // クエリビルダスタート
                                                $i = 0;
                                                // 変数リセット
                                                    $j_sum_uriage = "";
                                                    $j_sum_number = "";
                                                    $j_sum_arari = "";
                                                foreach ($j_buys as $j_buy) {
                                                    // 各月名
                                                        $j_month[$i]= $j_buy->j_month;
                                                    // 各月通販売上
                                                        $j_uriage[$i]= $j_buy->j_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp3_j_manthly_data, $j_month[$i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp3_j_manthly_data = str_replace($j_month[$i], $j_uriage[$i], $temp3_j_manthly_data);
                                                                }
                                                    // 全期間通販売上合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $j_sum_uriage_average = (int)$j_sum_uriage;
                                                            } else {
                                                                $j_sum_uriage_average = (int)$j_sum_uriage + (int)$j_uriage[$i];
                                                            }

                                                        $j_sum_uriage = (int)$j_sum_uriage + (int)$j_uriage[$i];
                                                    // 各月通販点数
                                                        $j_number[$i]= $j_buy->j_number;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp3_j_manthly_data2, $j_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp3_j_manthly_data2 = str_replace($j_month[$i], $j_number[$i], $temp3_j_manthly_data2);
                                                            }

                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $j_sum_number_average = (int)$j_sum_number;
                                                            } else {
                                                                $j_sum_number_average = (int)$j_sum_number + (int)$j_number[$i];
                                                            }
                                                        $j_sum_number = (int)$j_sum_number + (int)$j_number[$i];

                                                    // 各月通販粗利
                                                        $j_arari[$i]= $j_buy->j_arari;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp3_j_manthly_data3, $j_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp3_j_manthly_data3 = str_replace($j_month[$i], $j_arari[$i], $temp3_j_manthly_data3);
                                                            }
                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $j_sum_arari_average = (int)$j_sum_arari;
                                                            } else {
                                                                $j_sum_arari_average = (int)$j_sum_arari + (int)$j_arari[$i];
                                                            }
                                                        $j_sum_arari = (int)$j_sum_arari + (int)$j_arari[$i];

                                                    $i++;
                                                }

                                                // 全期間通販売上合計とその平均値のHTML作成
                                                    $temp3_j_sum = "";
                                                    if($j_sum_uriage <> 0 && $j_sum_uriage <> ""){
                                                        $j_sum_uriage_c = number_format((int)$j_sum_uriage);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象                                                        
                                                        if($last_nodata_flag == "ON"){
                                                            if($j_sum_uriage_average <> "" && $j_sum_uriage_average <> 0){$j_sum_uriage_ave = number_format(floor((int)$j_sum_uriage_average / ((int)$i -1)));} else {$j_sum_uriage_ave = "---";}
                                                            if($j_sum_uriage_average <> "" && $j_sum_uriage_average <> 0){$j_sum_uriage_ave2 = floor((int)$j_sum_uriage_average / ((int)$i -1));} else {$j_sum_uriage_ave2 = "---";}
                                                        } else {
                                                            $j_sum_uriage_ave = number_format(floor((int)$j_sum_uriage / $i));
                                                            $j_sum_uriage_ave2 = floor((int)$j_sum_uriage / $i);
                                                        }
                                                    } else {
                                                        $j_sum_uriage_c = $j_sum_uriage;
                                                        $j_sum_uriage_ave = 0;
                                                        $j_sum_uriage_ave2 = 0;
                                                    }
                                                    $temp3_j_sum = "<div class='title4 ta_r'>" . $j_sum_uriage_c . "</div><div class='title4 ta_r'>" . $j_sum_uriage_ave . "</div></div>";
                                                // 全期間通販売上点数合計とその平均値のHTML作成
                                                    $temp3_j_sum2 = "";
                                                    if($j_sum_number <> 0 && $j_sum_number <> ""){
                                                        $j_sum_number_c = number_format((int)$j_sum_number);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($j_sum_number_average <> "" && $j_sum_number_average <> 0){$j_sum_number_ave = number_format(floor((int)$j_sum_number_average / ((int)$i -1)));} else {$j_sum_number_ave = "---";}
                                                            if($j_sum_number_average <> "" && $j_sum_number_average <> 0){$j_sum_number_ave2 = floor((int)$j_sum_number_average / ((int)$i -1));} else {$j_sum_number_ave2 = "---";}
                                                        } else {
                                                            $j_sum_number_ave = number_format(floor((int)$j_sum_number / $i));
                                                            $j_sum_number_ave2 = floor((int)$j_sum_number / $i);
                                                        }
                                                    } else {
                                                        $j_sum_number_c = $j_sum_number;
                                                        $j_sum_number_ave = 0;
                                                        $j_sum_number_ave2 = 0;
                                                    }
                                                    $temp3_j_sum2 = "<div class='title4 ta_r'>" . $j_sum_number_c . "</div><div class='title4 ta_r'>" . $j_sum_number_ave . "</div></div>";
                                                // 全期間通販粗利合計とその平均値のHTML作成
                                                    $temp3_j_sum3 = "";
                                                    if($j_sum_arari <> 0 && $j_sum_arari <> ""){
                                                        $j_sum_arari_c = number_format((int)$j_sum_arari);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($j_sum_arari_average <> "" && $j_sum_arari_average <> 0){$j_sum_arari_ave = number_format(floor((int)$j_sum_arari_average / ((int)$i -1)));} else {$j_sum_arari_ave = "---";}
                                                            if($j_sum_arari_average <> "" && $j_sum_arari_average <> 0){$j_sum_arari_ave2 = floor((int)$j_sum_arari_average / ((int)$i -1));} else {$j_sum_arari_ave2 = "---";}
                                                        } else {
                                                            $j_sum_arari_ave = number_format(floor((int)$j_sum_arari / $i));
                                                            $j_sum_arari_ave2 = floor((int)$j_sum_arari / $i);
                                                        }
                                                    } else {
                                                        $j_sum_arari_c = $j_sum_arari;
                                                        $j_sum_arari_ave = 0;
                                                        $j_sum_arari_ave2 = 0;
                                                    }
                                                    $temp3_j_sum3 = "<div class='title4 ta_r'>" . $j_sum_arari_c . "</div><div class='title4 ta_r'>" . $j_sum_arari_ave . "</div></div>";


                            /************************************************************************************************************************************************************************************************************* */
                                // 楽天用
                            /************************************************************************************************************************************************************************************************************* */

                                        // DB検索（楽天値）スタート
                                                $r_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS r_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS r_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS r_number"),
                                                        \DB::raw("SUM(ararikingaku) AS r_arari"),
                                                    ])
                                                    ->groupBy('r_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
 
                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                      
                                                        })

                                                    // 条件（期間の指定）
                                                        //->whereBetween($table_name . '.uriage', [$last_day_top, $last_day])
                                                        ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                            // 条件（商品区分分類名が新品）
                                                                if($out2_a == "ON"){
                                                                    $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                }
                                                            // 条件（商品区分分類名が中古）
                                                                if($out2_b == "ON"){
                                                                    $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                }
                                                            // 条件（商品区分分類名がアンティーク）
                                                                if($out2_c == "ON"){
                                                                    $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                }
                                                            // 条件（商品区分分類名がその他）
                                                                if($out2_d == "ON"){
                                                                    $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                }
                                                            // 条件（商品区分分類名が修理）
                                                                if($out2_e == "ON"){
                                                                    $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                }
                                                    
                                                    })
                                                // 条件（通販区分が楽天）
                                                    ->where('tsuuhankubun',2)

                                                // 条件（免税）
                                                    ->where(function ($query) use ($out4_a,$out4_b) {
                                                            // 条件（免税区分が0:対象外）
                                                                if($out4_a == "ON"){
                                                                    $query->orwhere("menzei","like","%対象外%");
                                                                }
                                                            // 条件（免税区分が1:免税）
                                                                if($out4_b == "ON"){
                                                                    $query->orwhere("menzei","like","%免税%");
                                                                }
                                                    })
                                                // 条件（扱い部門）
                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                            $query->orWhere('bumonmei','');

                                                            // 条件（扱い部門がジャック）
                                                                if($out5_a == "ON"){
                                                                    $query->orWhere('bumonmei','Jackroad');
                                                                }
                                                            // 条件（扱い部門がベティー）
                                                                if($out5_b == "ON"){
                                                                    $query->orWhere('bumonmei','BettyRoad');
                                                                }
                                                            // 条件（扱い部門がジュエリー）
                                                                if($out5_c == "ON"){
                                                                    $query->orWhere('bumonmei','Jewelry');
                                                                }
                                                
                                                    })
                                                // ソート順指定
                                                    ->orderBy('uriage', 'asc')
                                                    ->get();
                                            // クエリビルダスタート
                                                $i = 0;
                                                // 変数リセット
                                                    $r_sum_uriage = "";
                                                    $r_sum_number = "";
                                                    $r_sum_arari = "";
                                                foreach ($r_buys as $r_buy) {
                                                    // 各月名
                                                        $r_month[$i]= $r_buy->r_month;
                                                    // 各月通販売上
                                                        $r_uriage[$i]= $r_buy->r_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp3_r_manthly_data, $r_month[$i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp3_r_manthly_data = str_replace($r_month[$i], $r_uriage[$i], $temp3_r_manthly_data);
                                                                }
                                                    // 全期間通販売上合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $r_sum_uriage_average = (int)$r_sum_uriage;
                                                            } else {
                                                                $r_sum_uriage_average = (int)$r_sum_uriage + (int)$r_uriage[$i];
                                                            }

                                                        $r_sum_uriage = (int)$r_sum_uriage + (int)$r_uriage[$i];
                                                    // 各月通販点数
                                                        $r_number[$i]= $r_buy->r_number;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp3_r_manthly_data2, $r_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp3_r_manthly_data2 = str_replace($r_month[$i], $r_number[$i], $temp3_r_manthly_data2);
                                                            }

                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $r_sum_number_average = (int)$r_sum_number;
                                                            } else {
                                                                $r_sum_number_average = (int)$r_sum_number + (int)$r_number[$i];
                                                            }
                                                        $r_sum_number = (int)$r_sum_number + (int)$r_number[$i];

                                                    // 各月通販粗利
                                                        $r_arari[$i]= $r_buy->r_arari;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp3_r_manthly_data3, $r_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp3_r_manthly_data3 = str_replace($r_month[$i], $r_arari[$i], $temp3_r_manthly_data3);
                                                            }
                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $r_sum_arari_average = (int)$r_sum_arari;
                                                            } else {
                                                                $r_sum_arari_average = (int)$r_sum_arari + (int)$r_arari[$i];
                                                            }
                                                        $r_sum_arari = (int)$r_sum_arari + (int)$r_arari[$i];

                                                    $i++;
                                                }

                                                // 全期間通販売上合計とその平均値のHTML作成
                                                    $temp3_r_sum = "";
                                                    if($r_sum_uriage <> 0 && $r_sum_uriage <> ""){
                                                        $r_sum_uriage_c = number_format((int)$r_sum_uriage);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象                                                        
                                                        if($last_nodata_flag == "ON"){
                                                            if($r_sum_uriage_average <> "" && $r_sum_uriage_average <> 0){$r_sum_uriage_ave = number_format(floor((int)$r_sum_uriage_average / ((int)$i -1)));} else {$r_sum_uriage_ave = "---";}
                                                            if($r_sum_uriage_average <> "" && $r_sum_uriage_average <> 0){$r_sum_uriage_ave2 = floor((int)$r_sum_uriage_average / ((int)$i -1));} else {$r_sum_uriage_ave2 = "---";}
                                                        } else {
                                                            $r_sum_uriage_ave = number_format(floor((int)$r_sum_uriage / $i));
                                                            $r_sum_uriage_ave2 = floor((int)$r_sum_uriage / $i);
                                                        }
                                                    } else {
                                                        $r_sum_uriage_c = $r_sum_uriage;
                                                        $r_sum_uriage_ave = 0;
                                                        $r_sum_uriage_ave2 = 0;
                                                    }
                                                    $temp3_r_sum = "<div class='title4 ta_r'>" . $r_sum_uriage_c . "</div><div class='title4 ta_r'>" . $r_sum_uriage_ave . "</div></div>";
                                                // 全期間通販売上点数合計とその平均値のHTML作成
                                                    $temp3_r_sum2 = "";
                                                    if($r_sum_number <> 0 && $r_sum_number <> ""){
                                                        $r_sum_number_c = number_format((int)$r_sum_number);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($r_sum_number_average <> "" && $r_sum_number_average <> 0){$r_sum_number_ave = number_format(floor((int)$r_sum_number_average / ((int)$i -1)));} else {$r_sum_number_ave = "---";}
                                                            if($r_sum_number_average <> "" && $r_sum_number_average <> 0){$r_sum_number_ave2 = floor((int)$r_sum_number_average / ((int)$i -1));} else {$r_sum_number_ave2 = "---";}
                                                        } else {
                                                            $r_sum_number_ave = number_format(floor((int)$r_sum_number / $i));
                                                            $r_sum_number_ave2 = floor((int)$r_sum_number / $i);
                                                        }
                                                    } else {
                                                        $r_sum_number_c = $r_sum_number;
                                                        $r_sum_number_ave = 0;
                                                        $r_sum_number_ave2 = 0;
                                                    }
                                                    $temp3_r_sum2 = "<div class='title4 ta_r'>" . $r_sum_number_c . "</div><div class='title4 ta_r'>" . $r_sum_number_ave . "</div></div>";
                                                // 全期間通販粗利合計とその平均値のHTML作成
                                                    $temp3_r_sum3 = "";
                                                    if($r_sum_arari <> 0 && $r_sum_arari <> ""){
                                                        $r_sum_arari_c = number_format((int)$r_sum_arari);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($r_sum_arari_average <> "" && $r_sum_arari_average <> 0){$r_sum_arari_ave = number_format(floor((int)$r_sum_arari_average / ((int)$i -1)));} else {$r_sum_arari_ave = "---";}
                                                            if($r_sum_arari_average <> "" && $r_sum_arari_average <> 0){$r_sum_arari_ave2 = floor((int)$r_sum_arari_average / ((int)$i -1));} else {$r_sum_arari_ave2 = "---";}
                                                        } else {
                                                            $r_sum_arari_ave = number_format(floor((int)$r_sum_arari / $i));
                                                            $r_sum_arari_ave2 = floor((int)$r_sum_arari / $i);
                                                        }
                                                    } else {
                                                        $r_sum_arari_c = $r_sum_arari;
                                                        $r_sum_arari_ave = 0;
                                                        $r_sum_arari_ave2 = 0;
                                                    }
                                                    $temp3_r_sum3 = "<div class='title4 ta_r'>" . $r_sum_arari_c . "</div><div class='title4 ta_r'>" . $r_sum_arari_ave . "</div></div>";


                            /************************************************************************************************************************************************************************************************************* */
                                // ヤフー用
                            /************************************************************************************************************************************************************************************************************* */

                                        // DB検索（ヤフー値）スタート
                                                $y_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS y_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS y_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS y_number"),
                                                        \DB::raw("SUM(ararikingaku) AS y_arari"),
                                                    ])
                                                    ->groupBy('y_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
 
                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                      
                                                        })

                                                    // 条件（期間の指定）
                                                        //->whereBetween($table_name . '.uriage', [$last_day_top, $last_day])
                                                        ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                            // 条件（商品区分分類名が新品）
                                                                if($out2_a == "ON"){
                                                                    $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                }
                                                            // 条件（商品区分分類名が中古）
                                                                if($out2_b == "ON"){
                                                                    $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                }
                                                            // 条件（商品区分分類名がアンティーク）
                                                                if($out2_c == "ON"){
                                                                    $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                }
                                                            // 条件（商品区分分類名がその他）
                                                                if($out2_d == "ON"){
                                                                    $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                }
                                                            // 条件（商品区分分類名が修理）
                                                                if($out2_e == "ON"){
                                                                    $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                }
                                                    
                                                    })
                                                // 条件（通販区分がヤフー）
                                                    ->where('tsuuhankubun',3)

                                                // 条件（免税）
                                                    ->where(function ($query) use ($out4_a,$out4_b) {
                                                            // 条件（免税区分が0:対象外）
                                                                if($out4_a == "ON"){
                                                                    $query->orwhere("menzei","like","%対象外%");
                                                                }
                                                            // 条件（免税区分が1:免税）
                                                                if($out4_b == "ON"){
                                                                    $query->orwhere("menzei","like","%免税%");
                                                                }
                                                    })
                                                // 条件（扱い部門）
                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                            $query->orWhere('bumonmei','');

                                                            // 条件（扱い部門がジャック）
                                                                if($out5_a == "ON"){
                                                                    $query->orWhere('bumonmei','Jackroad');
                                                                }
                                                            // 条件（扱い部門がベティー）
                                                                if($out5_b == "ON"){
                                                                    $query->orWhere('bumonmei','BettyRoad');
                                                                }
                                                            // 条件（扱い部門がジュエリー）
                                                                if($out5_c == "ON"){
                                                                    $query->orWhere('bumonmei','Jewelry');
                                                                }
                                                
                                                    })
                                                // ソート順指定
                                                    ->orderBy('uriage', 'asc')
                                                    ->get();
                                            // クエリビルダスタート
                                                $i = 0;
                                                // 変数リセット
                                                    $y_sum_uriage = "";
                                                    $y_sum_number = "";
                                                    $y_sum_arari = "";
                                                foreach ($y_buys as $y_buy) {
                                                    // 各月名
                                                        $y_month[$i]= $y_buy->y_month;
                                                    // 各月通販売上
                                                        $y_uriage[$i]= $y_buy->y_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp3_y_manthly_data, $y_month[$i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp3_y_manthly_data = str_replace($y_month[$i], $y_uriage[$i], $temp3_y_manthly_data);
                                                                }
                                                    // 全期間通販売上合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $y_sum_uriage_average = (int)$y_sum_uriage;
                                                            } else {
                                                                $y_sum_uriage_average = (int)$y_sum_uriage + (int)$y_uriage[$i];
                                                            }

                                                        $y_sum_uriage = (int)$y_sum_uriage + (int)$y_uriage[$i];
                                                    // 各月通販点数
                                                        $y_number[$i]= $y_buy->y_number;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp3_y_manthly_data2, $y_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp3_y_manthly_data2 = str_replace($y_month[$i], $y_number[$i], $temp3_y_manthly_data2);
                                                            }

                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $y_sum_number_average = (int)$y_sum_number;
                                                            } else {
                                                                $y_sum_number_average = (int)$y_sum_number + (int)$y_number[$i];
                                                            }
                                                        $y_sum_number = (int)$y_sum_number + (int)$y_number[$i];

                                                    // 各月通販粗利
                                                        $y_arari[$i]= $y_buy->y_arari;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp3_y_manthly_data3, $y_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp3_y_manthly_data3 = str_replace($y_month[$i], $y_arari[$i], $temp3_y_manthly_data3);
                                                            }
                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $y_sum_arari_average = (int)$y_sum_arari;
                                                            } else {
                                                                $y_sum_arari_average = (int)$y_sum_arari + (int)$y_arari[$i];
                                                            }
                                                        $y_sum_arari = (int)$y_sum_arari + (int)$y_arari[$i];

                                                    $i++;
                                                }

                                                // 全期間通販売上合計とその平均値のHTML作成
                                                    $temp3_y_sum = "";
                                                    if($y_sum_uriage <> 0 && $y_sum_uriage <> ""){
                                                        $y_sum_uriage_c = number_format((int)$y_sum_uriage);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象                                                        
                                                        if($last_nodata_flag == "ON"){
                                                            if($y_sum_uriage_average <> "" && $y_sum_uriage_average <> 0){$y_sum_uriage_ave = number_format(floor((int)$y_sum_uriage_average / ((int)$i -1)));} else {$y_sum_uriage_ave = "---";}
                                                            if($y_sum_uriage_average <> "" && $y_sum_uriage_average <> 0){$y_sum_uriage_ave2 = floor((int)$y_sum_uriage_average / ((int)$i -1));} else {$y_sum_uriage_ave2 = "---";}
                                                        } else {
                                                            $y_sum_uriage_ave = number_format(floor((int)$y_sum_uriage / $i));
                                                            $y_sum_uriage_ave2 = floor((int)$y_sum_uriage / $i);
                                                        }
                                                    } else {
                                                        $y_sum_uriage_c = $y_sum_uriage;
                                                        $y_sum_uriage_ave = 0;
                                                        $y_sum_uriage_ave2 = 0;
                                                    }
                                                    $temp3_y_sum = "<div class='title4 ta_r'>" . $y_sum_uriage_c . "</div><div class='title4 ta_r'>" . $y_sum_uriage_ave . "</div></div>";
                                                // 全期間通販売上点数合計とその平均値のHTML作成
                                                    $temp3_y_sum2 = "";
                                                    if($y_sum_number <> 0 && $y_sum_number <> ""){
                                                        $y_sum_number_c = number_format((int)$y_sum_number);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($y_sum_number_average <> "" && $y_sum_number_average <> 0){$y_sum_number_ave = number_format(floor((int)$y_sum_number_average / ((int)$i -1)));} else {$y_sum_number_ave = "---";}
                                                            if($y_sum_number_average <> "" && $y_sum_number_average <> 0){$y_sum_number_ave2 = floor((int)$y_sum_number_average / ((int)$i -1));} else {$y_sum_number_ave2 = "---";}
                                                        } else {
                                                            $y_sum_number_ave = number_format(floor((int)$y_sum_number / $i));
                                                            $y_sum_number_ave2 = floor((int)$y_sum_number / $i);
                                                        }
                                                    } else {
                                                        $y_sum_number_c = $y_sum_number;
                                                        $y_sum_number_ave = 0;
                                                        $y_sum_number_ave2 = 0;
                                                    }
                                                    $temp3_y_sum2 = "<div class='title4 ta_r'>" . $y_sum_number_c . "</div><div class='title4 ta_r'>" . $y_sum_number_ave . "</div></div>";
                                                // 全期間通販粗利合計とその平均値のHTML作成
                                                    $temp3_y_sum3 = "";
                                                    if($y_sum_arari <> 0 && $y_sum_arari <> ""){
                                                        $y_sum_arari_c = number_format((int)$y_sum_arari);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($y_sum_arari_average <> "" && $y_sum_arari_average <> 0){$y_sum_arari_ave = number_format(floor((int)$y_sum_arari_average / ((int)$i -1)));} else {$y_sum_arari_ave = "---";}
                                                            if($y_sum_arari_average <> "" && $y_sum_arari_average <> 0){$y_sum_arari_ave2 = floor((int)$y_sum_arari_average / ((int)$i -1));} else {$y_sum_arari_ave2 = "---";}
                                                        } else {
                                                            $y_sum_arari_ave = number_format(floor((int)$y_sum_arari / $i));
                                                            $y_sum_arari_ave2 = floor((int)$y_sum_arari / $i);
                                                        }
                                                    } else {
                                                        $y_sum_arari_c = $y_sum_arari;
                                                        $y_sum_arari_ave = 0;
                                                        $y_sum_arari_ave2 = 0;
                                                    }
                                                    $temp3_y_sum3 = "<div class='title4 ta_r'>" . $y_sum_arari_c . "</div><div class='title4 ta_r'>" . $y_sum_arari_ave . "</div></div>";


                            /************************************************************************************************************************************************************************************************************* */
                                // その他用
                            /************************************************************************************************************************************************************************************************************* */

                                        // DB検索（その他値）スタート
                                                $o_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS o_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS o_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS o_number"),
                                                        \DB::raw("SUM(ararikingaku) AS o_arari"),
                                                    ])
                                                    ->groupBy('o_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
 
                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                      
                                                        })

                                                    // 条件（期間の指定）
                                                        //->whereBetween($table_name . '.uriage', [$last_day_top, $last_day])
                                                        ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                            // 条件（商品区分分類名が新品）
                                                                if($out2_a == "ON"){
                                                                    $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                }
                                                            // 条件（商品区分分類名が中古）
                                                                if($out2_b == "ON"){
                                                                    $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                }
                                                            // 条件（商品区分分類名がアンティーク）
                                                                if($out2_c == "ON"){
                                                                    $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                }
                                                            // 条件（商品区分分類名がその他）
                                                                if($out2_d == "ON"){
                                                                    $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                }
                                                            // 条件（商品区分分類名が修理）
                                                                if($out2_e == "ON"){
                                                                    $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                }
                                                    
                                                    })
                                                // 条件（通販区分がその他「5：電話・雑誌」「4：Yオークション」「9：修理品返送」）
                                                    //->Where([['tsuuhankubun', '==', 5], ['tsuuhankubun', '==', 4], ['tsuuhankubun', '==', 9]])
                                                    ->where(function ($query) use ($out2_e) {
                                                        $query->orwhere('.tsuuhankubun', 5);
                                                        $query->orwhere('.tsuuhankubun', 4);
                                                            // 条件（商品区分分類名が修理）
                                                                if($out2_e == "ON"){
                                                                    $query->orwhere('.tsuuhankubun', 9);
                                                                }
                                                    })

                                               // 条件（免税）
                                                    ->where(function ($query) use ($out4_a,$out4_b) {
                                                            // 条件（免税区分が0:対象外）
                                                                if($out4_a == "ON"){
                                                                    $query->orwhere("menzei","like","%対象外%");
                                                                }
                                                            // 条件（免税区分が1:免税）
                                                                if($out4_b == "ON"){
                                                                    $query->orwhere("menzei","like","%免税%");
                                                                }
                                                    })
                                                // 条件（扱い部門）
                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                            $query->orWhere('bumonmei','');

                                                            // 条件（扱い部門がジャック）
                                                                if($out5_a == "ON"){
                                                                    $query->orWhere('bumonmei','Jackroad');
                                                                }
                                                            // 条件（扱い部門がベティー）
                                                                if($out5_b == "ON"){
                                                                    $query->orWhere('bumonmei','BettyRoad');
                                                                }
                                                            // 条件（扱い部門がジュエリー）
                                                                if($out5_c == "ON"){
                                                                    $query->orWhere('bumonmei','Jewelry');
                                                                }
                                                
                                                    })
                                                // ソート順指定
                                                    ->orderBy('uriage', 'asc')
                                                    ->get();
                                            // クエリビルダスタート
                                                $i = 0;
                                                // 変数リセット
                                                    $o_sum_uriage = "";
                                                    $o_sum_number = "";
                                                    $o_sum_arari = "";
                                                foreach ($o_buys as $o_buy) {
                                                    // 各月名
                                                        $o_month[$i]= $o_buy->o_month;
                                                    // 各月通販売上
                                                        $o_uriage[$i]= $o_buy->o_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp3_o_manthly_data, $o_month[$i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp3_o_manthly_data = str_replace($o_month[$i], $o_uriage[$i], $temp3_o_manthly_data);
                                                                }
                                                    // 全期間通販売上合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $o_sum_uriage_average = (int)$o_sum_uriage;
                                                            } else {
                                                                $o_sum_uriage_average = (int)$o_sum_uriage + (int)$o_uriage[$i];
                                                            }

                                                        $o_sum_uriage = (int)$o_sum_uriage + (int)$o_uriage[$i];
                                                    // 各月通販点数
                                                        $o_number[$i]= $o_buy->o_number;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp3_o_manthly_data2, $o_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp3_o_manthly_data2 = str_replace($o_month[$i], $o_number[$i], $temp3_o_manthly_data2);
                                                            }

                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $o_sum_number_average = (int)$o_sum_number;
                                                            } else {
                                                                $o_sum_number_average = (int)$o_sum_number + (int)$o_number[$i];
                                                            }
                                                        $o_sum_number = (int)$o_sum_number + (int)$o_number[$i];

                                                    // 各月通販粗利
                                                        $o_arari[$i]= $o_buy->o_arari;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp3_o_manthly_data3, $o_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp3_o_manthly_data3 = str_replace($o_month[$i], $o_arari[$i], $temp3_o_manthly_data3);
                                                            }
                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $o_sum_arari_average = (int)$o_sum_arari;
                                                            } else {
                                                                $o_sum_arari_average = (int)$o_sum_arari + (int)$o_arari[$i];
                                                            }
                                                        $o_sum_arari = (int)$o_sum_arari + (int)$o_arari[$i];

                                                    $i++;
                                                }

                                                // 全期間通販売上合計とその平均値のHTML作成
                                                    $temp3_o_sum = "";
                                                    if($o_sum_uriage <> 0 && $o_sum_uriage <> ""){
                                                        $o_sum_uriage_c = number_format((int)$o_sum_uriage);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象                                                        
                                                        if($last_nodata_flag == "ON"){
                                                            if($o_sum_uriage_average <> "" && $o_sum_uriage_average <> 0){$o_sum_uriage_ave = number_format(floor((int)$o_sum_uriage_average / ((int)$i -1)));} else {$o_sum_uriage_ave = "---";}
                                                            if($o_sum_uriage_average <> "" && $o_sum_uriage_average <> 0){$o_sum_uriage_ave2 = floor((int)$o_sum_uriage_average / ((int)$i -1));} else {$o_sum_uriage_ave2 = "---";}
                                                        } else {
                                                            $o_sum_uriage_ave = number_format(floor((int)$o_sum_uriage / $i));
                                                            $o_sum_uriage_ave2 = floor((int)$o_sum_uriage / $i);
                                                        }
                                                    } else {
                                                        $o_sum_uriage_c = $o_sum_uriage;
                                                        $o_sum_uriage_ave = 0;
                                                        $o_sum_uriage_ave2 = 0;
                                                    }
                                                    $temp3_o_sum = "<div class='title4 ta_r'>" . $o_sum_uriage_c . "</div><div class='title4 ta_r'>" . $o_sum_uriage_ave . "</div></div>";
                                                // 全期間通販売上点数合計とその平均値のHTML作成
                                                    $temp3_o_sum2 = "";
                                                    if($o_sum_number <> 0 && $o_sum_number <> ""){
                                                        $o_sum_number_c = number_format((int)$o_sum_number);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($o_sum_number_average <> "" && $o_sum_number_average <> 0){$o_sum_number_ave = number_format(floor((int)$o_sum_number_average / ((int)$i -1)));} else {$o_sum_number_ave = "---";}
                                                            if($o_sum_number_average <> "" && $o_sum_number_average <> 0){$o_sum_number_ave2 = floor((int)$o_sum_number_average / ((int)$i -1));} else {$o_sum_number_ave2 = "---";}
                                                        } else {
                                                            $o_sum_number_ave = number_format(floor((int)$o_sum_number / $i));
                                                            $o_sum_number_ave2 = floor((int)$o_sum_number / $i);
                                                        }
                                                    } else {
                                                        $o_sum_number_c = $o_sum_number;
                                                        $o_sum_number_ave = 0;
                                                        $o_sum_number_ave2 = 0;
                                                    }
                                                    $temp3_o_sum2 = "<div class='title4 ta_r'>" . $o_sum_number_c . "</div><div class='title4 ta_r'>" . $o_sum_number_ave . "</div></div>";
                                                // 全期間通販粗利合計とその平均値のHTML作成
                                                    $temp3_o_sum3 = "";
                                                    if($o_sum_arari <> 0 && $o_sum_arari <> ""){
                                                        $o_sum_arari_c = number_format((int)$o_sum_arari);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($o_sum_arari_average <> "" && $o_sum_arari_average <> 0){$o_sum_arari_ave = number_format(floor((int)$o_sum_arari_average / ((int)$i -1)));} else {$o_sum_arari_ave = "---";}
                                                            if($o_sum_arari_average <> "" && $o_sum_arari_average <> 0){$o_sum_arari_ave2 = floor((int)$o_sum_arari_average / ((int)$i -1));} else {$o_sum_arari_ave2 = "---";}
                                                        } else {
                                                            $o_sum_arari_ave = number_format(floor((int)$o_sum_arari / $i));
                                                            $o_sum_arari_ave2 = floor((int)$o_sum_arari / $i);
                                                        }
                                                    } else {
                                                        $o_sum_arari_c = $o_sum_arari;
                                                        $o_sum_arari_ave = 0;
                                                        $o_sum_arari_ave2 = 0;
                                                    }
                                                    $temp3_o_sum3 = "<div class='title4 ta_r'>" . $o_sum_arari_c . "</div><div class='title4 ta_r'>" . $o_sum_arari_ave . "</div></div>";
                            
                            
                            
                         
                            
                            
                            /************************************************************************************************************************************************************************************************************* */
                                // 全件用
                            /************************************************************************************************************************************************************************************************************* */


                                    // 各月のタイトル表示用HTMLを作成
                                        $temp3_title2 = "";
                                        $temp3_title3 = "";
                                        $temp3_title4 = "";
                                        $temp3_title5 = "";
                                        foreach($manth_now_array as $val){
                                                // 表示用
                                                $temp3_title2 .= "<div class='title2 ta_c'>" . $val . "</div>";
                                                $temp3_title3 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                                $temp3_title4 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                                $temp3_title5 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                            }
                                
                                            $temp3_title = "<div class='wid100 ul2'><div class='title5 ta_c'>" . $between_start_view. "～<br>" .$between_end_view . "</div>" .$temp3_title2 ."<div class='title6 ta_c'>累計</div><!--<div class='title6 ta_c'>過去比</div>--><div class='title6 ta_c'>平均</div></div>";
                                            $temp3_title3 = "<div class='wid100 ul2'><div class='title7 ta_c'>" . $between_start_view. "～<br>" .$between_end_view . "</div>" .$temp3_title3 ."<div class='title7 ta_c'>平均</div></div>";
                                            $temp3_title4 = "<div class='wid100 ul2 bg_green'><div class='title7 ta_c'>" . $between_start_view. "～<br>" .$between_end_view . "</div>" .$temp3_title4 ."<div class='title7 ta_c'>平均</div></div>";
                                            $temp3_title5 = "<div class='wid100 ul2 bg_yellow'><div class='title7 ta_c'>" . $between_start_view. "～<br>" .$between_end_view . "</div>" .$temp3_title5 ."<div class='title7 ta_c'>平均</div></div>";
                                        
                                        
                                    // 全期間の全部門売上合計用変数リセット
                                        $all_sum_uriage_all = 0;
                                        $all_sum_number_all = 0;
                                        $all_sum_arari_all = 0;
                                        for($all_i = 0; $all_i < $i; $all_i++){
                                            // 各月の全部門売上合計用変数リセット
                                                $all_month_uriage = 0;
                                                $all_month_number= 0;
                                                $all_month_arari= 0;
                                            // 各月の全部門売上合計をHTMLへ
                                                    if(isset($r_uriage[$all_i])){$all_month_uriage = $all_month_uriage + (int)$r_uriage[$all_i]; }
                                                    if(isset($r_number[$all_i])){$all_month_number = $all_month_number + (int)$r_number[$all_i]; }
                                                    if(isset($r_arari[$all_i])){$all_month_arari = $all_month_arari+ (int)$r_arari[$all_i]; }
                                                    if(isset($j_uriage[$all_i])){$all_month_uriage = $all_month_uriage + (int)$j_uriage[$all_i]; }
                                                    if(isset($j_number[$all_i])){$all_month_number = $all_month_number + (int)$j_number[$all_i]; }
                                                    if(isset($j_arari[$all_i])){$all_month_arari = $all_month_arari + (int)$j_arari[$all_i]; }
                                                    if(isset($y_uriage[$all_i])){ $all_month_uriage = $all_month_uriage + (int)$y_uriage[$all_i]; }
                                                    if(isset($y_number[$all_i])){ $all_month_number = $all_month_number + (int)$y_number[$all_i]; }
                                                    if(isset($y_arari[$all_i])){ $all_month_arari = $all_month_arari + (int)$y_arari[$all_i]; }
                                                    if(isset($o_uriage[$all_i])){ $all_month_uriage = $all_month_uriage + (int)$o_uriage[$all_i]; }
                                                    if(isset($o_number[$all_i])){ $all_month_number = $all_month_number + (int)$o_number[$all_i]; }
                                                    if(isset($o_arari[$all_i])){ $all_month_arari = $all_month_arari + (int)$o_arari[$all_i]; }

                                            // 全期間の全部門売上合計
                                                $all_sum_uriage_all = (int)$all_sum_uriage_all + (int)$all_month_uriage;
                                                $all_sum_number_all = (int)$all_sum_number_all + (int)$all_month_number;
                                                $all_sum_arari_all = (int)$all_sum_arari_all + (int)$all_month_arari;
                                            
                                        }



									// 【進捗率の取得】
                                        

											// 検索スタート日からデータが格納されている最終日までの日数
											    $search_start = strtotime($start_now);
											    $data_end = strtotime($last_day);
											    $data_in_days = ($data_end - $search_start) / (60 * 60 * 24);

											// 検索期間
											    $search_start = strtotime($start_now);
											    $search_end = strtotime($end_now);
											    $search_days = ($search_end - $search_start) / (60 * 60 * 24);

											// 検索期間・着地予測（期間合計 / データ格納期間 * 検索期間）
											    ($j_sum_uriage <> 0 && $j_sum_uriage <> "") ? $j_term_progress = $j_sum_uriage / $data_in_days * $search_days : $j_term_progress = "---";
											    ($r_sum_uriage <> 0 && $r_sum_uriage <> "") ? $r_term_progress = $r_sum_uriage / $data_in_days * $search_days : $r_term_progress = "---";
											    ($j_sum_number <> 0 && $j_sum_number <> "") ? $j_term_progress_n = $j_sum_number / $data_in_days * $search_days : $j_term_progress_n = "---";
											    ($r_sum_number <> 0 && $r_sum_number <> "") ? $r_term_progress_n = $r_sum_number / $data_in_days * $search_days : $r_term_progress_n = "---";
											    ($j_sum_arari <> 0 && $j_sum_arari <> "") ? $j_term_progress_a = $j_sum_arari / $data_in_days * $search_days : $j_term_progress_a = "---";
											    ($r_sum_arari <> 0 && $r_sum_arari <> "") ? $r_term_progress_a = $r_sum_arari / $data_in_days * $search_days : $r_term_progress_a = "---";
											    ($y_sum_uriage <> 0 && $y_sum_uriage <> "") ? $y_term_progress = $y_sum_uriage / $data_in_days * $search_days : $y_term_progress = "---";
											    ($y_sum_number <> 0 && $y_sum_number <> "") ? $y_term_progress_n = $y_sum_number / $data_in_days * $search_days : $y_term_progress_n = "---";
											    ($y_sum_arari <> 0 && $y_sum_arari <> "") ? $y_term_progress_a = $y_sum_arari / $data_in_days * $search_days : $y_term_progress_a = "---";
											    ($o_sum_uriage <> 0 && $o_sum_uriage <> "") ? $o_term_progress = $o_sum_uriage / $data_in_days * $search_days : $o_term_progress = "---";
											    ($o_sum_number <> 0 && $o_sum_number <> "") ? $o_term_progress_n = $o_sum_number / $data_in_days * $search_days : $o_term_progress_n = "---";
											    ($o_sum_arari <> 0 && $o_sum_arari <> "") ? $o_term_progress_a = $o_sum_arari / $data_in_days * $search_days : $o_term_progress_a = "---";


											// 合計
											    $all_term_progress = (int)$j_term_progress + (int)$r_term_progress + (int)$y_term_progress + (int)$o_term_progress;
											    $all_term_progress_n = (int)$j_term_progress_n + (int)$r_term_progress_n + (int)$y_term_progress_n + (int)$o_term_progress_n;
											    $all_term_progress_a = (int)$j_term_progress_a + (int)$r_term_progress_a + (int)$y_term_progress_a + (int)$o_term_progress_a;
											// 検索期間・過去との着地予測比（検索期間・着地予測 / 過去合計）
											    ($j_term_progress <> 0 && $j_term_progress <> "" && $past_j_sum_uriage <> 0 && $past_j_sum_uriage <> "") ? $j_term_progress2 = number_format((floor(((int)$j_term_progress / (int)$past_j_sum_uriage) * 100 * 10)) / 10,1) : $j_term_progress2 = 0;
											    ($r_term_progress <> 0 && $r_term_progress <> "" && $past_r_sum_uriage <> 0 && $past_r_sum_uriage <> "") ? $r_term_progress2 = number_format((floor(((int)$r_term_progress / (int)$past_r_sum_uriage) * 100 * 10)) / 10,1) : $r_term_progress2 = 0;
											    ($j_term_progress_n <> 0 && $j_term_progress_n <> "" && $past_j_sum_number <> 0 && $past_j_sum_number <> "") ? $j_term_progress2_n = number_format((floor(((int)$j_term_progress_n / (int)$past_j_sum_number) * 100 * 10)) / 10,1) : $j_term_progress2_n = 0;
											    ($r_term_progress_n <> 0 && $r_term_progress_n <> "" && $past_r_sum_number <> 0 && $past_r_sum_number <> "") ? $r_term_progress2_n = number_format((floor(((int)$r_term_progress_n / (int)$past_r_sum_number) * 100 * 10)) / 10,1) : $r_term_progress2_n = 0;
											    ($j_term_progress_a <> 0 && $j_term_progress_a <> "" && $past_j_sum_arari <> 0 && $past_j_sum_arari <> "") ? $j_term_progress2_a = number_format((floor(((int)$j_term_progress_a / (int)$past_j_sum_arari) * 100 * 10)) / 10,1) : $j_term_progress2_a = 0;
											    ($r_term_progress_a <> 0 && $r_term_progress_a <> "" && $past_r_sum_arari <> 0 && $past_r_sum_arari <> "") ? $r_term_progress2_a = number_format((floor(((int)$r_term_progress_a / (int)$past_r_sum_arari) * 100 * 10)) / 10,1) : $r_term_progress2_a = 0;
											    
											    if($y_term_progress <> "" && $y_term_progress <> 0 && $past_y_sum_uriage <> "" && $past_y_sum_uriage <> 0){
											        $y_term_progress2 = number_format((floor(((int)$y_term_progress / (int)$past_y_sum_uriage) * 100 * 10)) / 10,1);
											    } else {
											        $y_term_progress2 = "---";
											    }
											    if($y_term_progress_n <> "" && $y_term_progress_n <> 0 && $past_y_sum_number <> "" && $past_y_sum_number <> 0){
											        $y_term_progress2_n = number_format((floor(((int)$y_term_progress_n / (int)$past_y_sum_number) * 100 * 10)) / 10,1);
											    } else {
											        $y_term_progress2_n = "---"; 
											    }
											    if($y_term_progress_a <> "" && $y_term_progress_a <> 0 && $past_y_sum_arari <> "" && $past_y_sum_arari <> 0){
											        $y_term_progress2_a = number_format((floor(((int)$y_term_progress_a / (int)$past_y_sum_arari) * 100 * 10)) / 10,1);
											    } else {
											        $y_term_progress2_a = "---"; 
											    }
											    if($o_term_progress <> "" && $o_term_progress <> 0 && $past_o_sum_uriage <> "" && $past_o_sum_uriage <> 0){
											        $o_term_progress2 = number_format((floor(((int)$o_term_progress / (int)$past_o_sum_uriage) * 100 * 10)) / 10,1);
											    } else {
											        $o_term_progress2 = "---";
											    }
											    if($o_term_progress_n <> "" && $o_term_progress_n <> 0 && $past_o_sum_number <> "" && $past_o_sum_number <> 0){
											        $o_term_progress2_n = number_format((floor(((int)$o_term_progress_n / (int)$past_o_sum_number) * 100 * 10)) / 10,1);
											    } else {
											        $o_term_progress2_n = "---"; 
											    }
											    if($o_term_progress_a <> "" && $o_term_progress_a <> 0 && $past_o_sum_arari <> "" && $past_o_sum_arari <> 0){
											        $o_term_progress2_a = number_format((floor(((int)$o_term_progress_a / (int)$past_o_sum_arari) * 100 * 10)) / 10,1);
											    } else {
											        $o_term_progress2_a = "---"; 
											    }
											// 合計
											    ($all_term_progress <> 0 && $all_term_progress <> "" && $past_all_sum_uriage_all <> 0 && $past_all_sum_uriage_all <> "") ? $all_term_progress2 = number_format((floor(((int)$all_term_progress / (int)$past_all_sum_uriage_all) * 100 * 10)) / 10,1) : $all_term_progress2 = "---";
											    ($all_term_progress_n <> 0 && $all_term_progress_n <> "" && $past_all_sum_number_all <> 0 && $past_all_sum_number_all <> "") ? $all_term_progress2_n = number_format((floor(((int)$all_term_progress_n / (int)$past_all_sum_number_all) * 100 * 10)) / 10,1) : $all_term_progress2_n = "---";
											    ($all_term_progress_a <> 0 && $all_term_progress_a <> "" && $past_all_sum_arari_all <> 0 && $past_all_sum_arari_all <> "") ? $all_term_progress2_a = number_format((floor(((int)$all_term_progress_a / (int)$past_all_sum_arari_all) * 100 * 10)) / 10,1) : $all_term_progress2_a = "---";

											// HTML追記
											    ($j_term_progress <> 0 && $j_term_progress <> "") ? $j_term_progress_view = "<div class='sinchoku'>" . number_format((int)$j_term_progress) . "</div>" : $j_term_progress_view = "<div class='sinchoku'>---</div>";
											    ($j_sum_uriage <> 0 && $j_sum_uriage <> "") ? $j_sum_uriage_view = "<div class='sinchoku'>" . number_format($j_sum_uriage) . "</div>" : $j_sum_uriage_view = "<div class='sinchoku'>---</div>";
											    ($j_term_progress2 < 100) ? $j_term_progress2_view = "<div class='sinchoku fc_blue'>" . $j_term_progress2 . "%</div>" : $j_term_progress2_view = "<div class='sinchoku fc_red'>" . $j_term_progress2 . "%</div>";
											    ($r_term_progress <> 0 && $r_term_progress <> "") ? $r_term_progress_view = "<div class='sinchoku'>" . number_format((int)$r_term_progress) . "</div>" : $r_term_progress_view = "<div class='sinchoku'>---</div>";
											    ($r_sum_uriage <> 0 && $r_sum_uriage <> "") ? $r_sum_uriage_view = "<div class='sinchoku'>" . number_format((int)$r_sum_uriage) . "</div>" : $r_sum_uriage_view = "<div class='sinchoku'>---</div>";
											    ($r_term_progress2 < 100) ? $r_term_progress2_view = "<div class='sinchoku fc_blue'>" . $r_term_progress2 . "%</div>" : $r_term_progress2_view = "<div class='sinchoku fc_red'>" . $r_term_progress2 . "%</div>";
											    
											    ($j_term_progress_n <> 0 && $j_term_progress_n <> "") ? $j_term_progress_n_view = "<div class='sinchoku'>" . number_format((int)$j_term_progress_n) . "</div>" : $j_term_progress_n_view = "<div class='sinchoku'>---</div>";
											    ($j_sum_number <> 0 && $j_sum_number <> "") ? $j_sum_number_view = "<div class='sinchoku'>" . number_format($j_sum_number) . "</div>" : $j_sum_number_view = "<div class='sinchoku'>---</div>";
											    ($j_term_progress2_n < 100) ? $j_term_progress2_n_view = "<div class='sinchoku fc_blue'>" . $j_term_progress2_n . "%</div>" : $j_term_progress2_n_view = "<div class='sinchoku fc_red'>" . $j_term_progress2_n . "%</div>";
											    ($r_term_progress_n <> 0 && $r_term_progress_n <> "") ? $r_term_progress_n_view = "<div class='sinchoku'>" . number_format((int)$r_term_progress_n) . "</div>" : $r_term_progress_n_view = "<div class='sinchoku'>---</div>";
											    ($r_sum_number <> 0 && $r_sum_number <> "") ? $r_sum_number_view = "<div class='sinchoku'>" . number_format((int)$r_sum_number) . "</div>" : $r_sum_number_view = "<div class='sinchoku'>---</div>";
											    ($r_term_progress2_n < 100) ? $r_term_progress2_n_view = "<div class='sinchoku fc_blue'>" . $r_term_progress2_n . "%</div>" : $r_term_progress2_n_view = "<div class='sinchoku fc_red'>" . $r_term_progress2_n . "%</div>";
											  
											    ($j_term_progress_a <> 0 && $j_term_progress_a <> "") ? $j_term_progress_a_view = "<div class='sinchoku'>" . number_format((int)$j_term_progress_a) . "</div>" : $j_term_progress_a_view = "<div class='sinchoku'>---</div>";
											    ($j_sum_arari <> 0 && $j_sum_arari <> "") ? $j_sum_arari_view = "<div class='sinchoku'>" . number_format($j_sum_arari) . "</div>" : $j_sum_arari_view = "<div class='sinchoku'>---</div>";
											    ($j_term_progress2_a < 100) ? $j_term_progress2_a_view = "<div class='sinchoku fc_blue'>" . $j_term_progress2_a . "%</div>" : $j_term_progress2_a_view = "<div class='sinchoku fc_red'>" . $j_term_progress2_a . "%</div>";
											    ($r_term_progress_a <> 0 && $r_term_progress_a <> "") ? $r_term_progress_a_view = "<div class='sinchoku'>" . number_format((int)$r_term_progress_a) . "</div>" : $r_term_progress_a_view = "<div class='sinchoku'>---</div>";
											    ($r_sum_arari <> 0 && $r_sum_arari <> "") ? $r_sum_arari_view = "<div class='sinchoku'>" . number_format((int)$r_sum_arari) . "</div>" : $r_sum_arari_view = "<div class='sinchoku'>---</div>";
											    ($r_term_progress2_a < 100) ? $r_term_progress2_a_view = "<div class='sinchoku fc_blue'>" . $r_term_progress2_a . "%</div>" : $r_term_progress2_a_view = "<div class='sinchoku fc_red'>" . $r_term_progress2_a . "%</div>";
											    
											    ($y_term_progress <> 0 && $y_term_progress <> "") ? $y_term_progress_view = "<div class='sinchoku'>" . number_format((int)$y_term_progress) . "</div>" : $y_term_progress_view = "<div class='sinchoku'>---</div>";
											    ($y_sum_uriage <> 0 && $y_sum_uriage <> "") ? $y_sum_uriage_view = "<div class='sinchoku'>" . number_format((int)$y_sum_uriage) . "</div>" : $y_sum_uriage_view = "<div class='sinchoku'>---</div>";
											    ($y_term_progress2 < 100) ? $y_term_progress2_view = "<div class='sinchoku fc_blue'>" . $y_term_progress2 . "%</div>" : $y_term_progress2_view = "<div class='sinchoku fc_red'>" . $y_term_progress2 . "%</div>";
											    ($y_term_progress_n <> 0 && $y_term_progress_n <> "") ? $y_term_progress_n_view = "<div class='sinchoku'>" . number_format((int)$y_term_progress_n) . "</div>" : $y_term_progress_n_view = "<div class='sinchoku'>---</div>";
											    ($y_sum_number <> 0 && $y_sum_number <> "") ? $y_sum_number_view = "<div class='sinchoku'>" . number_format((int)$y_sum_number) . "</div>" : $y_sum_number_view = "<div class='sinchoku'>---</div>";
											    ($y_term_progress2_n < 100) ? $y_term_progress2_n_view = "<div class='sinchoku fc_blue'>" . $y_term_progress2_n . "%</div>" : $y_term_progress2_n_view = "<div class='sinchoku fc_red'>" . $y_term_progress2_n . "%</div>";
											    ($y_term_progress_a <> 0 && $y_term_progress_a <> "") ? $y_term_progress_a_view = "<div class='sinchoku'>" . number_format((int)$y_term_progress_a) . "</div>" : $y_term_progress_a_view = "<div class='sinchoku'>---</div>";
											    ($y_sum_arari <> 0 && $y_sum_arari <> "") ? $y_sum_arari_view = "<div class='sinchoku'>" . number_format((int)$y_sum_arari) . "</div>" : $y_sum_arari_view = "<div class='sinchoku'>---</div>";
											    ($y_term_progress2_a < 100) ? $y_term_progress2_a_view = "<div class='sinchoku fc_blue'>" . $y_term_progress2_a . "%</div>" : $y_term_progress2_a_view = "<div class='sinchoku fc_red'>" . $y_term_progress2_a . "%</div>";
											    
                                                ($o_term_progress <> 0 && $o_term_progress <> "") ? $o_term_progress_view = "<div class='sinchoku'>" . number_format((int)$o_term_progress) . "</div>" : $o_term_progress_view = "<div class='sinchoku'>---</div>";
											    ($o_sum_uriage <> 0 && $o_sum_uriage <> "") ? $o_sum_uriage_view = "<div class='sinchoku'>" . number_format((int)$o_sum_uriage) . "</div>" : $o_sum_uriage_view = "<div class='sinchoku'>---</div>";
											    ($o_term_progress2 < 100) ? $o_term_progress2_view = "<div class='sinchoku fc_blue'>" . $o_term_progress2 . "%</div>" : $o_term_progress2_view = "<div class='sinchoku fc_red'>" . $o_term_progress2 . "%</div>";
											    ($o_term_progress_n <> 0 && $o_term_progress_n <> "") ? $o_term_progress_n_view = "<div class='sinchoku'>" . number_format((int)$o_term_progress_n) . "</div>" : $o_term_progress_n_view = "<div class='sinchoku'>---</div>";
											    ($o_sum_number <> 0 && $o_sum_number <> "") ? $o_sum_number_view = "<div class='sinchoku'>" . number_format((int)$o_sum_number) . "</div>" : $o_sum_number_view = "<div class='sinchoku'>---</div>";
											    ($o_term_progress2_n < 100) ? $o_term_progress2_n_view = "<div class='sinchoku fc_blue'>" . $o_term_progress2_n . "%</div>" : $o_term_progress2_n_view = "<div class='sinchoku fc_red'>" . $o_term_progress2_n . "%</div>";
											    ($o_term_progress_a <> 0 && $o_term_progress_a <> "") ? $o_term_progress_a_view = "<div class='sinchoku'>" . number_format((int)$o_term_progress_a) . "</div>" : $o_term_progress_a_view = "<div class='sinchoku'>---</div>";
											    ($o_sum_arari <> 0 && $o_sum_arari <> "") ? $o_sum_arari_view = "<div class='sinchoku'>" . number_format((int)$o_sum_arari) . "</div>" : $o_sum_arari_view = "<div class='sinchoku'>---</div>";
											    ($o_term_progress2_a < 100) ? $o_term_progress2_a_view = "<div class='sinchoku fc_blue'>" . $o_term_progress2_a . "%</div>" : $o_term_progress2_a_view = "<div class='sinchoku fc_red'>" . $o_term_progress2_a . "%</div>";
                                                
											    ($all_term_progress <> 0 && $all_term_progress <> "") ? $all_term_progress_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_term_progress) . "</div>" : $all_term_progress_view = "<div class='sinchoku bg_grey'>---</div>";
											    ($all_sum_uriage_all <> 0 && $all_sum_uriage_all <> "") ? $all_sum_uriage_all_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_sum_uriage_all) . "</div>" : $all_sum_uriage_all_view = "<div class='sinchoku bg_grey'>---</div>";
											    ($all_term_progress2 < 100) ? $all_term_progress2_view = "<div class='sinchoku fc_blue bg_grey'>" . $all_term_progress2 . "%</div>" : $all_term_progress2_view = "<div class='sinchoku fc_red bg_grey'>" . $all_term_progress2 . "%</div>";
											    ($all_term_progress_n <> 0 && $all_term_progress_n <> "") ? $all_term_progress_n_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_term_progress_n) . "</div>" : $all_term_progress_n_view = "<div class='sinchoku bg_grey'>---</div>";
											    ($all_sum_number_all <> 0 && $all_sum_number_all <> "") ? $all_sum_number_all_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_sum_number_all) . "</div>" : $all_sum_number_all_view = "<div class='sinchoku bg_grey'>---</div>";
											    ($all_term_progress2_n < 100) ? $all_term_progress2_n_view = "<div class='sinchoku fc_blue bg_grey'>" . $all_term_progress2_n . "%</div>" : $all_term_progress2_n_view = "<div class='sinchoku fc_red bg_grey'>" . $all_term_progress2_n . "%</div>";
											    ($all_term_progress_a <> 0 && $all_term_progress_a <> "") ? $all_term_progress_a_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_term_progress_a) . "</div>" : $all_term_progress_a_view = "<div class='sinchoku bg_grey'>---</div>";
											    ($all_sum_arari_all <> 0 && $all_sum_arari_all <> "") ? $all_sum_arari_all_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_sum_arari_all) . "</div>" : $all_sum_arari_all_view = "<div class='sinchoku bg_grey'>---</div>";
											    ($all_term_progress2_a < 100) ? $all_term_progress2_a_view = "<div class='sinchoku fc_blue bg_grey'>" . $all_term_progress2_a . "%</div>" : $all_term_progress2_a_view = "<div class='sinchoku fc_red bg_grey'>" . $all_term_progress2_a . "%</div>";
    
    
   									 // 売上額進捗
                                                 	$uriage_progress_html = 
	                                                 "<div class='btn_bulldown_  pt2'><span class='view'>＋</span> 予測数値について</div>
	                                                 <div class='down'>
	                                                     <p class='text'>▼月間着地予測：データを有する最終月の数値 / 月初からデータを有する最終日までの日数 x 該当月の最終日の数字</p>
	                                                     <p class='text'>▼月間着地予測比（対過去・同月）：データを有する最終月を検索期間遡った過去月との対比（1～12月までの検索で、8月までのデータが存在するのなら、昨年の8月との対比）</p>
	                                                     <p class='text'>▼全期間着地予測：検索期間の累計 / 検索スタート日からデータを有する最終日までの日数 x 検索期間の総日数</p>
	                                                 </div>
	                                                 <div class='ul_p mt1'>
	                                                     <div class='sinchoku_t'>" . $last_year_last . "年" . $last_month_last. "月</div>
	                                                     <div class='sinchoku_t'>月間売上進捗</div>
	                                                     <div class='sinchoku_t'>月間着地予測</div>
	                                                     <div class='sinchoku_t'>月間着地予測比（対前月）</div>
	                                                     <div class='sinchoku_t'>月間着地予測比（対過去・同月）</div>
	                                                     <div class='sinchoku_t'>全期間売上進捗</div>
	                                                     <div class='sinchoku_t'>全期間着地予測</div>
	                                                     <div class='sinchoku_t'>全期間着地予測比（対過去・全期間）</div>
	                                                 </div>
	                                                 <div class='ul_p'>
	                                                     <div class='sinchoku ta_c'>自社</div>
	                                                     <div class='sinchoku'>" . $j_uriage_view1. "</div>
	                                                     <div class='sinchoku'>" . $j_uriage_view2. "</div>
	                                                     " . $j_uriage_view3 . "
	                                                     " . $j_uriage_view4 . "
	                                                     " . $j_sum_uriage_view . "
	                                                     " . $j_term_progress_view. "
	                                                     " . $j_term_progress2_view. "
	                                                 </div>
	                                                 <div class='ul_p'>
	                                                     <div class='sinchoku ta_c'>楽天</div>
	                                                     <div class='sinchoku'>" . $r_uriage_view1 . "</div>
	                                                     <div class='sinchoku'>" . $r_uriage_view2. "</div>
	                                                     " . $r_uriage_view3 . "
	                                                     " . $r_uriage_view4 . "
	                                                     " . $r_sum_uriage_view . "
	                                                     " . $r_term_progress_view. "
	                                                     " . $r_term_progress2_view. "
	                                                 </div>";
	                                                 $uriage_progress_html .= 
	                                                 "<div class='ul_p'>
	                                                     <div class='sinchoku ta_c'>ヤフー</div>
	                                                     <div class='sinchoku'>" . $y_uriage_view1 . "</div>
	                                                     <div class='sinchoku'>" . $y_uriage_view2. "</div>
	                                                     " . $y_uriage_view3 . "
	                                                     " . $y_uriage_view4 . "
	                                                     " . $y_sum_uriage_view . "
	                                                     " . $y_term_progress_view. "
	                                                     " . $y_term_progress2_view. "
	                                                 </div>";
	                                                 $uriage_progress_html .= 
	                                                 "<div class='ul_p'>
	                                                     <div class='sinchoku ta_c'>その他</div>
	                                                     <div class='sinchoku'>" . $o_uriage_view1 . "</div>
	                                                     <div class='sinchoku'>" . $o_uriage_view2. "</div>
	                                                     " . $o_uriage_view3 . "
	                                                     " . $o_uriage_view4 . "
	                                                     " . $o_sum_uriage_view . "
	                                                     " . $o_term_progress_view. "
	                                                     " . $o_term_progress2_view. "
	                                                 </div>";
	                                                 $uriage_progress_html .= 
	                                                 "<div class='ul_p'>
	                                                     <div class='sinchoku bg_grey ta_c'>合計</div>
	                                                     <div class='sinchoku bg_grey'>" . $all_uriage_view1 . "</div>
	                                                     <div class='sinchoku bg_grey'>" . $all_uriage_view2 . "</div>
	                                                     " . $all_uriage_view3 . "
	                                                     " . $all_uriage_view4 . "
	                                                     " . $all_sum_uriage_all_view . "
	                                                     " . $all_term_progress_view. "
	                                                     " . $all_term_progress2_view. "
	                                                 </div>";
                                     // 売上点数進捗
                                                    $number_progress_html = 
                                                    "<div class='btn_bulldown_  pt2'><span class='view2'>＋</span> 予測数値について</div>
                                                    <div class='down'>
                                                    <p class='text'>▼月間着地予測：データを有する最終月の数値 / 月初からデータを有する最終日までの日数 x 該当月の最終日の数字</p>
                                                    <p class='text'>▼月間着地予測比（対過去・同月）：データを有する最終月を検索期間遡った過去月との対比（1～12月までの検索で、8月までのデータが存在するのなら、昨年の8月との対比）</p>
                                                    <p class='text'>▼全期間着地予測：検索期間の累計 / 検索スタート日からデータを有する最終日までの日数 x 検索期間の総日数</p>
                                                    </div>
                                                    <div class='ul_p mt1'>
                                                        <div class='sinchoku_t'>" . $last_year_last . "年" . $last_month_last. "月</div>
                                                        <div class='sinchoku_t'>月間売上進捗</div>
                                                        <div class='sinchoku_t'>月間着地予測</div>
                                                        <div class='sinchoku_t'>月間着地予測比（対前月）</div>
                                                        <div class='sinchoku_t'>月間着地予測比（対過去・同月）</div>
                                                        <div class='sinchoku_t'>全期間売上進捗</div>
                                                        <div class='sinchoku_t'>全期間着地予測</div>
                                                        <div class='sinchoku_t'>全期間着地予測比（対過去・全期間）</div>
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>自社</div>
                                                        <div class='sinchoku'>" . $j_number_view1. "</div>
                                                        <div class='sinchoku'>" . $j_number_view2. "</div>
                                                        " . $j_number_view3 . "
                                                        " . $j_number_view4 . "
                                                        " . $j_sum_number_view . "
                                                        " . $j_term_progress_n_view. "
                                                        " . $j_term_progress2_n_view. "
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>楽天</div>
                                                        <div class='sinchoku'>" . $r_number_view1 . "</div>
                                                        <div class='sinchoku'>" . $r_number_view2. "</div>
                                                        " . $r_number_view3 . "
                                                        " . $r_number_view4 . "
                                                        " . $r_sum_number_view . "
                                                        " . $r_term_progress_n_view. "
                                                        " . $r_term_progress2_n_view. "
                                                    </div>";
                                                    $number_progress_html .= 
                                                    "<div class='ul_p'>
                                                        <div class='sinchoku ta_c'>ヤフー</div>
                                                        <div class='sinchoku'>" . $y_number_view1 . "</div>
                                                        <div class='sinchoku'>" . $y_number_view2. "</div>
                                                        " . $y_number_view3 . "
                                                        " . $y_number_view4 . "
                                                        " . $y_sum_number_view . "
                                                        " . $y_term_progress_n_view. "
                                                        " . $y_term_progress2_n_view. "
                                                    </div>";
                                                    $number_progress_html .= 
                                                    "<div class='ul_p'>
                                                        <div class='sinchoku ta_c'>その他</div>
                                                        <div class='sinchoku'>" . $o_number_view1 . "</div>
                                                        <div class='sinchoku'>" . $o_number_view2. "</div>
                                                        " . $o_number_view3 . "
                                                        " . $o_number_view4 . "
                                                        " . $o_sum_number_view . "
                                                        " . $o_term_progress_n_view. "
                                                        " . $o_term_progress2_n_view. "
                                                    </div>";
                                                    $number_progress_html .= 
                                                    "<div class='ul_p'>
                                                        <div class='sinchoku bg_grey ta_c'>合計</div>
                                                        <div class='sinchoku bg_grey'>" . $all_number_view1 . "</div>
                                                        <div class='sinchoku bg_grey'>" . $all_number_view2 . "</div>
                                                        " . $all_number_view3 . "
                                                        " . $all_number_view4 . "
                                                        " . $all_sum_number_all_view . "
                                                        " . $all_term_progress_n_view. "
                                                        " . $all_term_progress2_n_view. "
                                                    </div>";
                                     // 売上粗利進捗
                                                    $arari_progress_html = 
                                                    "<div class='btn_bulldown_  pt2'><span class='view3'>＋</span> 予測数値について</div>
                                                    <div class='down'>
                                                    <p class='text'>▼月間着地予測：データを有する最終月の数値 / 月初からデータを有する最終日までの日数 x 該当月の最終日の数字</p>
                                                    <p class='text'>▼月間着地予測比（対過去・同月）：データを有する最終月を検索期間遡った過去月との対比（1～12月までの検索で、8月までのデータが存在するのなら、昨年の8月との対比）</p>
                                                    <p class='text'>▼全期間着地予測：検索期間の累計 / 検索スタート日からデータを有する最終日までの日数 x 検索期間の総日数</p>
                                                    </div>
                                                    <div class='ul_p mt1'>
                                                        <div class='sinchoku_t'>" . $last_year_last . "年" . $last_month_last. "月</div>
                                                        <div class='sinchoku_t'>月間売上進捗</div>
                                                        <div class='sinchoku_t'>月間着地予測</div>
                                                        <div class='sinchoku_t'>月間着地予測比（対前月）</div>
                                                        <div class='sinchoku_t'>月間着地予測比（対過去・同月）</div>
                                                        <div class='sinchoku_t'>全期間売上進捗</div>
                                                        <div class='sinchoku_t'>全期間着地予測</div>
                                                        <div class='sinchoku_t'>全期間着地予測比（対過去・全期間）</div>
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>自社</div>
                                                        <div class='sinchoku'>" . $j_arari_view1. "</div>
                                                        <div class='sinchoku'>" . $j_arari_view2. "</div>
                                                        " . $j_arari_view3 . "
                                                        " . $j_arari_view4 . "
                                                        " . $j_sum_arari_view . "
                                                        " . $j_term_progress_a_view. "
                                                        " . $j_term_progress2_a_view. "
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>楽天</div>
                                                        <div class='sinchoku'>" . $r_arari_view1 . "</div>
                                                        <div class='sinchoku'>" . $r_arari_view2. "</div>
                                                        " . $r_arari_view3 . "
                                                        " . $r_arari_view4 . "
                                                        " . $r_sum_arari_view . "
                                                        " . $r_term_progress_a_view. "
                                                        " . $r_term_progress2_a_view. "
                                                    </div>";
                                                    $arari_progress_html .= 
                                                    "<div class='ul_p'>
                                                        <div class='sinchoku ta_c'>ヤフー</div>
                                                        <div class='sinchoku'>" . $y_arari_view1 . "</div>
                                                        <div class='sinchoku'>" . $y_arari_view2. "</div>
                                                        " . $y_arari_view3 . "
                                                        " . $y_arari_view4 . "
                                                        " . $y_sum_arari_view . "
                                                        " . $y_term_progress_a_view. "
                                                        " . $y_term_progress2_a_view. "
                                                    </div>";
                                                    $arari_progress_html .= 
                                                    "<div class='ul_p'>
                                                        <div class='sinchoku ta_c'>その他</div>
                                                        <div class='sinchoku'>" . $o_arari_view1 . "</div>
                                                        <div class='sinchoku'>" . $o_arari_view2. "</div>
                                                        " . $o_arari_view3 . "
                                                        " . $o_arari_view4 . "
                                                        " . $o_sum_arari_view . "
                                                        " . $o_term_progress_a_view. "
                                                        " . $o_term_progress2_a_view. "
                                                    </div>";
                                                    $arari_progress_html .= 
                                                    "<div class='ul_p'>
                                                        <div class='sinchoku bg_grey ta_c'>合計</div>
                                                        <div class='sinchoku bg_grey'>" . $all_arari_view1 . "</div>
                                                        <div class='sinchoku bg_grey'>" . $all_arari_view2 . "</div>
                                                        " . $all_arari_view3 . "
                                                        " . $all_arari_view4 . "
                                                        " . $all_sum_arari_all_view . "
                                                        " . $all_term_progress_a_view. "
                                                        " . $all_term_progress2_a_view. "
                                                    </div>";

                                                    if($out6 <> "ON"){
                                                        $uriage_progress_html = "";
                                                        $number_progress_html = "";
                                                        $arari_progress_html = "";
                                                    }


                            /************************************************************************************************************************************************************************************************************* */
                                // 最終ソース出力
                            /************************************************************************************************************************************************************************************************************* */
                                        
                                        // 【進捗率の取得】検索最終月の日数を取得
                           
                            
                                        // 自社用HTMLの作成
                                                $js_j_uriage  = "";
                                                $js_j_number  = "";
                                                $js_j_arari  = "";
                                                $temp3_j_manthly_html = "";
                                                $temp3_j_manthly_html2 = "";
                                                $temp3_j_manthly_html3 = "";
                                                $progress_uriage_html = "";
                                                $progress_number_html = "";
                                                $progress_arari_html = "";
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_now_array as $val){
                                                                //$val = mb_substr($val,0,-3);
                                                                if(strpos($temp3_j_manthly_data, $val ) !== false){
                                                                    $temp3_j_manthly_data = str_replace($val, 0, $temp3_j_manthly_data);
                                                                }
                                                                if(strpos($temp3_j_manthly_data2, $val ) !== false){
                                                                    $temp3_j_manthly_data2 = str_replace($val, 0, $temp3_j_manthly_data2);
                                                                }
                                                                if(strpos($temp3_j_manthly_data3, $val ) !== false){
                                                                    $temp3_j_manthly_data3 = str_replace($val, 0, $temp3_j_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $temp3_j_manthly_array = explode(',',$temp3_j_manthly_data);
                                                        $temp3_j_manthly_array2 = explode(',',$temp3_j_manthly_data2);
                                                        $temp3_j_manthly_array3 = explode(',',$temp3_j_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        $j_last_uriage = "";
                                                        $i = 0;
                                                        foreach($temp3_j_manthly_array as $val){
                                                            // 【進捗率の取得】最終月の「現在・自社・売上」を取得
                                                                //$j_last_uriage = $val;

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_j_uriage  .= "0, ";
                                                                // 表示用
                                                                    $temp3_j_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_j_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp3_j_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }

                                                        $i = 0;
                                                        foreach($temp3_j_manthly_array2 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_j_number  .= "0, ";
                                                                // 表示用
                                                                    $temp3_j_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_j_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp3_j_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp3_j_manthly_array3 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_j_arari  .= "0, ";
                                                                // 表示用
                                                                    $temp3_j_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_j_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp3_j_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                            
                                                        // 全体HTMLの作成
                                                            if(isset($temp3_j_manthly_html) && isset($temp3_j_sum)){
                                                                $temp3_j_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>自社</div>" . $temp3_j_manthly_html . $temp3_j_sum;
                                                            }
                                                            if(isset($temp3_j_manthly_html2) && isset($temp3_j_sum2)){
                                                                $temp3_j_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>自社</div>" . $temp3_j_manthly_html2 . $temp3_j_sum2;
                                                            }
                                                            if(isset($temp3_j_manthly_html3) && isset($temp3_j_sum3)){
                                                                $temp3_j_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>自社</div>" . $temp3_j_manthly_html3 . $temp3_j_sum3;
                                                            }

                                            // 楽天用HTMLの作成
                                                $js_r_uriage  = "";
                                                $js_r_number  = "";
                                                $js_r_arari  = "";
                                                $temp3_r_manthly_html = "";
                                                $temp3_r_manthly_html2 = "";
                                                $temp3_r_manthly_html3 = "";
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_now_array as $val){
                                                                if(strpos($temp3_r_manthly_data, $val ) !== false){
                                                                    $temp3_r_manthly_data = str_replace($val, 0, $temp3_r_manthly_data);
                                                                }
                                                                if(strpos($temp3_r_manthly_data2, $val ) !== false){
                                                                    $temp3_r_manthly_data2 = str_replace($val, 0, $temp3_r_manthly_data2);
                                                                }
                                                                if(strpos($temp3_r_manthly_data3, $val ) !== false){
                                                                    $temp3_r_manthly_data3 = str_replace($val, 0, $temp3_r_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $temp3_r_manthly_array = explode(',',$temp3_r_manthly_data);
                                                        $temp3_r_manthly_array2 = explode(',',$temp3_r_manthly_data2);
                                                        $temp3_r_manthly_array3 = explode(',',$temp3_r_manthly_data3);
                                                    // 各月のHTMLを作成

                                                        $i = 0;
                                                        foreach($temp3_r_manthly_array as $val){

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_r_uriage  .= "0, ";
                                                                // 表示用
                                                                    $temp3_r_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_r_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp3_r_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp3_r_manthly_array2 as $val){

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_r_number  .= "0, ";
                                                                // 表示用
                                                                    $temp3_r_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_r_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp3_r_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp3_r_manthly_array3 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_r_arari  .= "0, ";
                                                                // 表示用
                                                                    $temp3_r_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_r_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp3_r_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                    // 全体HTMLの作成
                                                            if(isset($temp3_r_manthly_html) && isset($temp3_r_sum)){
                                                                $temp3_r_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>楽天</div>" . $temp3_r_manthly_html . $temp3_r_sum;
                                                            }
                                                            if(isset($temp3_r_manthly_html2) && isset($temp3_r_sum2)){
                                                                $temp3_r_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>楽天</div>" . $temp3_r_manthly_html2 . $temp3_r_sum2;
                                                            }
                                                            if(isset($temp3_r_manthly_html3) && isset($temp3_r_sum3)){
                                                                $temp3_r_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>楽天</div>" . $temp3_r_manthly_html3 . $temp3_r_sum3;
                                                            }



                                        // ヤフー用HTMLの作成
                                                $js_y_uriage  = "";
                                                $js_y_number  = "";
                                                $js_y_arari  = "";
                                                $temp3_y_manthly_html = "";
                                                $temp3_y_manthly_html2 = "";
                                                $temp3_y_manthly_html3 = "";
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_now_array as $val){
                                                                if(strpos($temp3_y_manthly_data, $val ) !== false){
                                                                    $temp3_y_manthly_data = str_replace($val, 0, $temp3_y_manthly_data);
                                                                }
                                                                if(strpos($temp3_y_manthly_data2, $val ) !== false){
                                                                    $temp3_y_manthly_data2 = str_replace($val, 0, $temp3_y_manthly_data2);
                                                                }
                                                                if(strpos($temp3_y_manthly_data3, $val ) !== false){
                                                                    $temp3_y_manthly_data3 = str_replace($val, 0, $temp3_y_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $temp3_y_manthly_array = explode(',',$temp3_y_manthly_data);
                                                        $temp3_y_manthly_array2 = explode(',',$temp3_y_manthly_data2);
                                                        $temp3_y_manthly_array3 = explode(',',$temp3_y_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        $i = 0;
                                                        foreach($temp3_y_manthly_array as $val){

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_y_uriage  .= "0, ";
                                                                // 表示用
                                                                    $temp3_y_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_y_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp3_y_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp3_y_manthly_array2 as $val){
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_y_number  .= "0, ";
                                                                // 表示用
                                                                    $temp3_y_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_y_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp3_y_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp3_y_manthly_array3 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_y_arari  .= "0, ";
                                                                // 表示用
                                                                    $temp3_y_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_y_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp3_y_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }

                                                    // 全体HTMLの作成
                                                        if(isset($temp3_y_manthly_html) && isset($temp3_y_sum)){
                                                            $temp3_y_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>ヤフー</div>" . $temp3_y_manthly_html . $temp3_y_sum;
                                                        }
                                                        if(isset($temp3_y_manthly_html2) && isset($temp3_y_sum2)){
                                                            $temp3_y_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>ヤフー</div>" . $temp3_y_manthly_html2 . $temp3_y_sum2;
                                                        }
                                                        if(isset($temp3_y_manthly_html3) && isset($temp3_y_sum3)){
                                                            $temp3_y_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>ヤフー</div>" . $temp3_y_manthly_html3 . $temp3_y_sum3;
                                                        }

                                        // その他用HTMLの作成
                                                $js_o_uriage  = "";
                                                $js_o_number  = "";
                                                $js_o_arari  = "";
                                                $temp3_o_manthly_html = "";
                                                $temp3_o_manthly_html2 = "";
                                                $temp3_o_manthly_html3 = "";
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_now_array as $val){
                                                                if(strpos($temp3_o_manthly_data, $val ) !== false){
                                                                    $temp3_o_manthly_data = str_replace($val, 0, $temp3_o_manthly_data);
                                                                }
                                                                if(strpos($temp3_o_manthly_data2, $val ) !== false){
                                                                    $temp3_o_manthly_data2 = str_replace($val, 0, $temp3_o_manthly_data2);
                                                                }
                                                                if(strpos($temp3_o_manthly_data3, $val ) !== false){
                                                                    $temp3_o_manthly_data3 = str_replace($val, 0, $temp3_o_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $temp3_o_manthly_array = explode(',',$temp3_o_manthly_data);
                                                        $temp3_o_manthly_array2 = explode(',',$temp3_o_manthly_data2);
                                                        $temp3_o_manthly_array3 = explode(',',$temp3_o_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        $i = 0;
                                                        foreach($temp3_o_manthly_array as $val){

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_o_uriage  .= "0, ";
                                                                // 表示用
                                                                    $temp3_o_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_o_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp3_o_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp3_o_manthly_array2 as $val){
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_o_number  .= "0, ";
                                                                // 表示用
                                                                    $temp3_o_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_o_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp3_o_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp3_o_manthly_array3 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_o_arari  .= "0, ";
                                                                // 表示用
                                                                    $temp3_o_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_o_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp3_o_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }

                                                    // 全体HTMLの作成
                                                        if(isset($temp3_o_manthly_html) && isset($temp3_o_sum)){
                                                            $temp3_o_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>その他</div>" . $temp3_o_manthly_html . $temp3_o_sum;
                                                        }
                                                        if(isset($temp3_o_manthly_html2) && isset($temp3_o_sum2)){
                                                            $temp3_o_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>その他</div>" . $temp3_o_manthly_html2 . $temp3_o_sum2;
                                                        }
                                                        if(isset($temp3_o_manthly_html3) && isset($temp3_o_sum3)){
                                                            $temp3_o_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>その他</div>" . $temp3_o_manthly_html3 . $temp3_o_sum3;
                                                        }



                                        // 各月の全部門売上合計のJS表示用
                                                $js_all_month_uriage = "";
                                                $js_all_month_number = "";
                                                $js_all_month_arari = "";
                                                $i = 0;
                                                foreach($manth_now_array as $val){
                                                    $all_js = 0;
                                                    $all_js2 = 0;
                                                    $all_js3 = 0;
                                                    $all_js = (int)$all_js + (int)$temp3_j_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$temp3_j_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$temp3_j_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$temp3_r_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$temp3_r_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$temp3_r_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$temp3_y_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$temp3_y_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$temp3_y_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$temp3_o_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$temp3_o_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$temp3_o_manthly_array3[$i];

                                                    $js_all_month_uriage .= $all_js . ", ";
                                                    $js_all_month_number .= $all_js2 . ", ";
                                                    $js_all_month_arari .= $all_js3 . ", ";
                                                    
                                                    $i++;
                                                }



// 現在・楽天・粗利率

    $i = 0;
    $r_ratio = "";
    $r_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>粗利率(楽天)</div>";
    $r_total = "";
    $r_total_js = "";
    $all_total = "";
    $r_total_ratio = "";
    $r_ratio_cutting = "";
    $r_ratio_cutting_ave = "";
    $r_ratio_cutting_html = "";
    foreach($temp3_r_manthly_array3 as $var){
        if($var == 0){
            $r_ratio = "---";
            $r_total = $r_total;
            if($temp3_r_manthly_array[$i] == 0){
                $all_total = $all_total;
            } else {
                $all_total = (int)$all_total + (int)$temp3_r_manthly_array[$i];
            }
        } else {
            $r_ratio = number_format((floor(($var / $temp3_r_manthly_array[$i]) * 100 * 10)) / 10 ,1);
            $r_total = (int)$r_total + (int)$var;
            if($temp3_r_manthly_array[$i] == 0){
                $all_total = $all_total;
            } else {
                $all_total = (int)$all_total + (int)$temp3_r_manthly_array[$i];
            }
        }
        $r_total_js  .= (float)$r_ratio . ", ";
        $r_sum_arari_per .= "<div class='title6 ta_r'>" . $r_ratio . "%</div>";

        // 粗利率の過去比
            if($r_ratio <> "" && $r_ratio <> "---" && ${"past_r_ratio_" .$i} <> "" && ${"past_r_ratio_" .$i} <> "---"){
                $r_ratio_cutting = (float)$r_ratio - (float)${"past_r_ratio_" .$i};
                $r_ratio_cutting = number_format($r_ratio_cutting, 1);
                // 楽天・全期間合計
                    $r_ratio_cutting_ave = (float)$r_ratio_cutting_ave + (float)$r_ratio_cutting;
            }
            if($r_ratio_cutting < 0){
                $r_ratio_cutting_html .= "<div class='title7 ta_r fc_blue'>" . $r_ratio_cutting . "</div>";
            } else {
                $r_ratio_cutting_html .= "<div class='title7 ta_r fc_red'>" . $r_ratio_cutting . "</div>";
            }
    
        $i++;
    }
    // 楽天・全期間合計の平均
        $r_ratio_cutting_ave = number_format((float)$r_ratio_cutting_ave / $i, 2);
    
    // 粗利率の過去比(トータル値追加)
        if($r_ratio_cutting_ave < 0){
            $r_ratio_cutting_ave_html = "<div class='title7 ta_r fc_blue'>" . $r_ratio_cutting_ave . "</div>";
        } else {
            $r_ratio_cutting_ave_html = "<div class='title7 ta_r fc_red'>" . $r_ratio_cutting_ave . "</div>";
        }
    
        $r_ratio_cutting_html = $r_ratio_cutting_html . $r_ratio_cutting_ave_html;


    // 楽天用粗利率を取得
        if($r_total <> 0 && $all_total <> 0 && $r_total <> "" && $all_total <> ""){
            $r_total_ratio = number_format((floor(((float)$r_total / (float)$all_total) * 100 * 10)) / 10 ,1);
        } else {
            $r_total_ratio = "---";
        }

        $r_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $r_total_ratio . "%</div></div>";

// 現在・自社・粗利率

    $i = 0;
    $j_ratio = "";
    $j_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>粗利率(自社)</div>";
    $j_total = "";
    $j_total_js = "";
    $all_total = "";
    $j_total_ratio = "";
    $j_ratio_cutting = "";
    $j_ratio_cutting_ave = "";
    $j_ratio_cutting_html = "";
    foreach($temp3_j_manthly_array3 as $var){
        if($var == 0){
            $j_ratio = "---";
            $j_total = $j_total;
            if($temp3_j_manthly_array[$i] == 0){
                $all_total = $all_total;
            } else {
                $all_total = (int)$all_total + (int)$temp3_j_manthly_array[$i];
            }
        } else {
            $j_ratio = number_format((floor(($var / $temp3_j_manthly_array[$i]) * 100 * 10)) / 10 ,1);
            $j_total = (int)$j_total + (int)$var;
            if($temp3_j_manthly_array[$i] == 0){
                $all_total = $all_total;
            } else {
                $all_total = (int)$all_total + (int)$temp3_j_manthly_array[$i];
            }
        }
        $j_total_js  .= (float)$j_ratio . ", ";
        $j_sum_arari_per .= "<div class='title6 ta_r'>" . $j_ratio . "%</div>";

        // 粗利率の過去比
            if($j_ratio <> "" && $j_ratio <> "---" && ${"past_j_ratio_" .$i} <> "" && ${"past_j_ratio_" .$i} <> "---"){
                $j_ratio_cutting = (float)$j_ratio - (float)${"past_j_ratio_" .$i};
                $j_ratio_cutting = number_format($j_ratio_cutting, 1);
                // 自社・全期間合計
                    $j_ratio_cutting_ave = (float)$j_ratio_cutting_ave + (float)$j_ratio_cutting;
                
            }
            if($j_ratio_cutting < 0){
                $j_ratio_cutting_html .= "<div class='title7 ta_r fc_blue'>" . $j_ratio_cutting . "</div>";
            } else {
                $j_ratio_cutting_html .= "<div class='title7 ta_r fc_red'>" . $j_ratio_cutting . "</div>";
            }
    
        $i++;
    }
    // 自社・全期間合計の平均
        $j_ratio_cutting_ave = number_format((float)$j_ratio_cutting_ave / $i, 2);
    // 粗利率の過去比(トータル値追加)
        //$j_ratio_cutting_ave_html = "<div class='title7 ta_r'>" . (float)$j_ratio_cutting_ave . "</div>";
        if($j_ratio_cutting_ave < 0){
            $j_ratio_cutting_ave_html = "<div class='title7 ta_r fc_blue'>" . $j_ratio_cutting_ave . "</div>";
        } else {
            $j_ratio_cutting_ave_html = "<div class='title7 ta_r fc_red'>" . $j_ratio_cutting_ave . "</div>";
        }
        $j_ratio_cutting_html = $j_ratio_cutting_html . $j_ratio_cutting_ave_html;
        
    // 現在・自社用粗利率を取得
        if($j_total <> 0 && $all_total <> 0 && $j_total <> "" && $all_total <> ""){
            $j_total_ratio = number_format((floor(((float)$j_total / (float)$all_total) * 100 * 10)) / 10 ,1);
        } else {
            $j_total_ratio = "---";
        }

        $j_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $j_total_ratio . "%</div></div>";


// 現在・ヤフー・粗利率
    $y_total_js = "";
    $y_ratio_cutting = "";
    $y_ratio_cutting_ave = "";
    $y_ratio_cutting_html = "";

		    $i = 0;
		    $y_ratio = "";
		    $y_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>粗利率(ヤフー)</div>";
		    $y_total = "";
		    $all_total = "";
		    $y_total_ratio = "";
		    foreach($temp3_y_manthly_array3 as $var){
		        if($var == 0){
		            $y_ratio = "---";
		            $y_total = $y_total;
		            if($temp3_y_manthly_array[$i] == 0){
		                $all_total = $all_total;
		            } else {
		                $all_total = (int)$all_total + (int)$temp3_y_manthly_array[$i];
		            }
		        } else {
		            $y_ratio = number_format((floor(($var / $temp3_y_manthly_array[$i]) * 100 * 10)) / 10 ,1);
		            $y_total = (int)$y_total + (int)$var;
		            if($temp3_y_manthly_array[$i] == 0){
		                $all_total = $all_total;
		            } else {
		                $all_total = (int)$all_total + (int)$temp3_y_manthly_array[$i];
		            }
		        }
                $y_total_js  .= (float)$y_ratio . ", ";
		        $y_sum_arari_per .= "<div class='title6 ta_r'>" . $y_ratio . "%</div>";

                // 粗利率の過去比
                    if($y_ratio <> "" && $y_ratio <> "---" && ${"past_y_ratio_" .$i} <> "" && ${"past_y_ratio_" .$i} <> "---"){
                        $y_ratio_cutting = (float)$y_ratio - (float)${"past_y_ratio_" .$i};
                        $y_ratio_cutting = number_format($y_ratio_cutting, 1);
                        // ヤフー・全期間合計
                            $y_ratio_cutting_ave = (float)$y_ratio_cutting_ave + (float)$y_ratio_cutting;
                    }
                    //$y_ratio_cutting_html .= "<div class='title7 ta_r'>" . $y_ratio_cutting . "</div>";
                    if($y_ratio_cutting < 0){
                        $y_ratio_cutting_html .= "<div class='title7 ta_r fc_blue'>" . $y_ratio_cutting . "</div>";
                    } else {
                        $y_ratio_cutting_html .= "<div class='title7 ta_r fc_red'>" . $y_ratio_cutting . "</div>";
                    }
            
                $i++;
            }
            // ヤフー・全期間合計の平均
                $y_ratio_cutting_ave = number_format((float)$y_ratio_cutting_ave / $i, 2);
            // 粗利率の過去比(トータル値追加)
                //$y_ratio_cutting_ave_html = "<div class='title7 ta_r'>" . (float)$y_ratio_cutting_ave . "</div>";
                if($y_ratio_cutting_ave < 0){
                    $y_ratio_cutting_ave_html = "<div class='title7 ta_r fc_blue'>" . $y_ratio_cutting_ave . "</div>";
                } else {
                    $y_ratio_cutting_ave_html = "<div class='title7 ta_r fc_red'>" . $y_ratio_cutting_ave . "</div>";
                }

                $y_ratio_cutting_html = $y_ratio_cutting_html . $y_ratio_cutting_ave_html;
		    // 現在・ヤフー用粗利率を取得
                if($y_total == 0 || $y_total == "" || $all_total == 0 || $all_total == ""){
                    $y_total_ratio = "---";
                } else {
		            $y_total_ratio = number_format((floor(((float)$y_total / (float)$all_total) * 100 * 10)) / 10 ,1);
                }

		        $y_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $y_total_ratio . "%</div></div>";


// 現在・その他・粗利率
    $o_total_js = "";
    $o_ratio_cutting = "";
    $o_ratio_cutting_ave = "";
    $o_ratio_cutting_html = "";

		    $i = 0;
		    $o_ratio = "";
		    $o_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>粗利率(その他)</div>";
		    $o_total = "";
		    $all_total = "";
		    $o_total_ratio = "";
		    foreach($temp3_o_manthly_array3 as $var){
		        if($var == 0){
		            $o_ratio = "---";
		            $o_total = $o_total;
		            if($temp3_o_manthly_array[$i] == 0){
		                $all_total = $all_total;
		            } else {
		                $all_total = (int)$all_total + (int)$temp3_o_manthly_array[$i];
		            }
		        } else {
		            $o_ratio = number_format((floor(($var / $temp3_o_manthly_array[$i]) * 100 * 10)) / 10 ,1);
		            $o_total = (int)$o_total + (int)$var;
		            if($temp3_o_manthly_array[$i] == 0){
		                $all_total = $all_total;
		            } else {
		                $all_total = (int)$all_total + (int)$temp3_o_manthly_array[$i];
		            }
		        }
                $o_total_js  .= (float)$o_ratio . ", ";
		        $o_sum_arari_per .= "<div class='title6 ta_r'>" . $o_ratio . "%</div>";

                // 粗利率の過去比
                    if($o_ratio <> "" && $o_ratio <> "---" && ${"past_o_ratio_" .$i} <> "" && ${"past_o_ratio_" .$i} <> "---"){
                        $o_ratio_cutting = (float)$o_ratio - (float)${"past_o_ratio_" .$i};
                        $o_ratio_cutting = number_format($o_ratio_cutting, 1);
                        // その他・全期間合計
                            $o_ratio_cutting_ave = (float)$o_ratio_cutting_ave + (float)$o_ratio_cutting;
                    }
                    //$o_ratio_cutting_html .= "<div class='title7 ta_r'>" . $o_ratio_cutting . "</div>";
                    if($o_ratio_cutting < 0){
                        $o_ratio_cutting_html .= "<div class='title7 ta_r fc_blue'>" . $o_ratio_cutting . "</div>";
                    } else {
                        $o_ratio_cutting_html .= "<div class='title7 ta_r fc_red'>" . $o_ratio_cutting . "</div>";
                    }
            
                $i++;
            }
            // その他・全期間合計の平均
                $o_ratio_cutting_ave = number_format((float)$o_ratio_cutting_ave / $i, 2);
            // 粗利率の過去比(トータル値追加)
                //$o_ratio_cutting_ave_html = "<div class='title7 ta_r'>" . (float)$o_ratio_cutting_ave . "</div>";
                if($o_ratio_cutting_ave < 0){
                    $o_ratio_cutting_ave_html = "<div class='title7 ta_r fc_blue'>" . $o_ratio_cutting_ave . "</div>";
                } else {
                    $o_ratio_cutting_ave_html = "<div class='title7 ta_r fc_red'>" . $o_ratio_cutting_ave . "</div>";
                }

                $o_ratio_cutting_html = $o_ratio_cutting_html . $o_ratio_cutting_ave_html;
		    // 現在・その他用粗利率を取得
                if($o_total == 0 || $o_total == "" || $all_total == 0 || $all_total == ""){
                    $o_total_ratio = "---";
                } else {
		            $o_total_ratio = number_format((floor(((float)$o_total / (float)$all_total) * 100 * 10)) / 10 ,1);
                }

		        $o_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $o_total_ratio . "%</div></div>";




// 現在・金額構成比

    $i = 0;
    $total = "";
    $total2 = 0;
    $r_per = "";
    $j_per = "";
    $y_per = "";
    $o_per = "";
    $r_total = "";
    $j_total = "";
    $y_total = "";
    $o_total = "";
    $r_per_html = "";
    $j_per_html = "";
    $y_per_html = "";
    $o_per_html = "";
    $r_total_js2 = "";
    $j_total_js2 = "";
    $y_total_js2 = "";
    $o_total_js2 = "";
    foreach($temp3_r_manthly_array as $var){
        $total = (int)$var + (int)$temp3_j_manthly_array[$i] + (int)$temp3_y_manthly_array[$i] + (int)$temp3_o_manthly_array[$i];
        $total2 = (int)$total2 + (int)$total;
        $r_total = (int)$r_total + (int)$var;
        $j_total = (int)$j_total + (int)$temp3_j_manthly_array[$i];
        $y_total = (int)$y_total + (int)$temp3_y_manthly_array[$i];
        $o_total = (int)$o_total + (int)$temp3_o_manthly_array[$i];
        if($var == 0){
            $r_per = "---";
            if($temp3_j_manthly_array[$i] == 0){
                $j_per = "---";
            } else {
                    if($temp3_j_manthly_array[$i] <> 0 && $total <> 0 && $temp3_j_manthly_array[$i] <> "" && $total <> ""){
                        $j_per = number_format((floor(($temp3_j_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
                    } else {
                        $j_per = "---"; 
                    }
            }
            if($temp3_y_manthly_array[$i] == 0){
                $y_per = "---";
            } else {
                    if($temp3_y_manthly_array[$i] <> 0 && $total <> 0 && $temp3_y_manthly_array[$i] <> "" && $total <> ""){
                        $y_per = number_format((floor(($temp3_y_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
                    } else {
                        $y_per = "---"; 
                    }
            }
            if($temp3_o_manthly_array[$i] == 0){
                    $o_per = "---";
            } else {
                $o_per = number_format(bcsub('100', ($r_per + $j_per + $y_per), 1) ,1);
            }

        } else {
            $r_per = number_format((floor(($var / $total) * 100 * 10)) / 10 ,1);
            if($temp3_j_manthly_array[$i] == 0){
                $j_per = "---";
            } else {
                $j_per = number_format((floor(($temp3_j_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1);
            }
            if($temp3_y_manthly_array[$i] == 0){
                $y_per = "---";
            } else {
                $y_per = number_format((floor(($temp3_y_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1);
            }
            if($temp3_o_manthly_array[$i] == 0){
                $o_per = "---";
            } else {
                //$o_per = number_format(bcsub('100', ($r_per + $j_per + $y_per), 1) ,1);
                $o_per = number_format(bcsub('100', ((int)$r_per + (int)$j_per + (int)$y_per), 1) ,1);
            }
        }
        $r_per_html .= "<div class='title7 ta_r'>" . $r_per . "%</div>";
        $j_per_html .= "<div class='title7 ta_r'>" . $j_per . "%</div>";
        $r_total_js2  .= (float)$r_per . ", ";
        $j_total_js2  .= (float)$j_per . ", ";
        $y_per_html .= "<div class='title7 ta_r'>" . $y_per . "%</div>";
        $y_total_js2  .= (float)$y_per . ", ";
        $o_per_html .= "<div class='title7 ta_r'>" . $o_per . "%</div>";
        $o_total_js2  .= (float)$o_per . ", ";

        $i++;
    }
    // 期間中の売上合計に対するパーセンテージを取得
       // $r_total_per = $r_total / $i;
        if($r_total <> 0 && $total2 <> 0 && $r_total <> "" && $total2 <> ""){
            $r_total_per = number_format((floor(((float)$r_total / (float)$total2) * 100 * 10)) / 10 ,1);
        } else {
            $r_total_per = "---";
        }
        if($j_total <> 0 && $total2 <> 0 && $j_total <> "" && $total2 <> ""){
            $j_total_per = number_format((floor(((float)$j_total / (float)$total2) * 100 * 10)) / 10 ,1);
        } else {
            $j_total_per = "---";
        }
        if($y_total <> 0 && $total2 <> 0 && $y_total <> "" && $total2 <> ""){
            $y_total_per = number_format((floor(((float)$y_total / (float)$total2) * 100 * 10)) / 10 ,1);
        } else {
            $y_total_per = "---";
        }
        $o_total_per = number_format(bcsub('100', ((float)$r_total_per + (float)$j_total_per + (float)$y_total_per), 1), 1);

        $r_per_html .= "<div class='title7 ta_r'>" . $r_total_per . "%</div>";
        $j_per_html .= "<div class='title7 ta_r'>" . $j_total_per . "%</div>";
        $y_per_html .= "<div class='title7 ta_r'>" . $y_total_per. "%</div>";
        $o_per_html .= "<div class='title7 ta_r'>" . $o_total_per. "%</div>";


    $temp3_all_sorce4 = "<p class='title_a'>金額・構成比</p><div class='box1'>" . $temp3_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>自社    </div>" . $j_per_html . "</div>";
    $temp3_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>楽天</div>" . $r_per_html . "</div>";
    $temp3_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ヤフー</div>" . $y_per_html . "</div>";
    $temp3_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>その他</div>" . $o_per_html . "</div>";
    $temp3_all_sorce4 .= "</div>";



    // 現在・点数構成比

    $i = 0;
    $total = "";
    $total2 = 0;
    $r_per = "";
    $j_per = "";
    $y_per = "";
    $o_per = "";
    $r_total = "";
    $j_total = "";
    $y_total = "";
    $o_total = "";
    $r_per_html = "";
    $j_per_html = "";
    $y_per_html = "";
    $o_per_html = "";
    $r_total_js3 = "";
    $j_total_js3 = "";
    $y_total_js3 = "";
    $o_total_js3 = "";
    foreach($temp3_r_manthly_array2 as $var){
        $total = (int)$var + (int)$temp3_j_manthly_array2[$i] + (int)$temp3_y_manthly_array2[$i] + (int)$temp3_o_manthly_array2[$i];
        $total2 = (int)$total2 + (int)$total;
        $r_total = (int)$r_total + (int)$var;
        $j_total = (int)$j_total + (int)$temp3_j_manthly_array2[$i];
        $y_total = (int)$y_total + (int)$temp3_y_manthly_array2[$i];
        $o_total = (int)$o_total + (int)$temp3_o_manthly_array2[$i];
        if($var == 0){
            $r_per = "---";
            if($temp3_j_manthly_array2[$i] == 0){
                $j_per = "---";
            } else {
                    if($temp3_j_manthly_array2[$i] <> 0 && $total <> 0 && $temp3_j_manthly_array2[$i] <> "" && $total <> ""){
                        $j_per = number_format((floor(($temp3_j_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
                    } else {
                        $j_per = "---"; 
                    }
            }
            if($temp3_y_manthly_array2[$i] == 0){
                $y_per = "---";
            } else {
                    if($temp3_y_manthly_array2[$i] <> 0 && $total <> 0 && $temp3_y_manthly_array2[$i] <> "" && $total <> ""){
                        $y_per = number_format((floor(($temp3_y_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
                    } else {
                        $y_per = "---"; 
                    }
            }
            
            if($temp3_o_manthly_array2[$i] == 0){
                $o_per = "---";
            } else {
                $o_per = number_format(bcsub('100', ($r_per + $j_per + $y_per), 1) ,1);
            }
        } else {
            $r_per = number_format((floor(($var / $total) * 100 * 10)) / 10 ,1);
            if($temp3_j_manthly_array2[$i] == 0){
                $j_per = "---";
            } else {
                $j_per = number_format((floor(($temp3_j_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1);;
            }
            if($temp3_y_manthly_array2[$i] == 0){
                $y_per = "---";
            } else {
                $y_per = number_format((floor(($temp3_y_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1);;
            }

            if($temp3_o_manthly_array2[$i] == 0){
                $o_per = "---";
            } else {
                //$o_per = number_format(bcsub('100', ($r_per + $j_per + $y_per), 1) ,1);
                $o_per = number_format(bcsub('100', ((int)$r_per + (int)$j_per + (int)$y_per), 1) ,1);
            }
        }
        $r_per_html .= "<div class='title7 ta_r'>" . $r_per . "%</div>";
        $j_per_html .= "<div class='title7 ta_r'>" . $j_per . "%</div>";
        $r_total_js3  .= (float)$r_per . ", ";
        $j_total_js3  .= (float)$j_per . ", ";
        $y_per_html .= "<div class='title7 ta_r'>" . $y_per . "%</div>";
        $y_total_js3  .= (float)$y_per . ", ";
        $o_per_html .= "<div class='title7 ta_r'>" . $o_per . "%</div>";
        $o_total_js3  .= (float)$o_per . ", ";

        $i++;
    }
    // 期間中の売上合計点数に対するパーセンテージを取得
        if($r_total <> 0 && $total2 <> 0 && $r_total <> "" && $total2 <> ""){
            $r_total_per = number_format((floor(((float)$r_total / (float)$total2) * 100 * 10)) / 10 ,1);
        } else {
            $r_total_per = "---";
        }
        if($j_total <> 0 && $total2 <> 0 && $j_total <> "" && $total2 <> ""){
            $j_total_per = number_format((floor(((float)$j_total / (float)$total2) * 100 * 10)) / 10 ,1);
        } else {
            $j_total_per = "---";
        }
        if($y_total <> 0 && $total2 <> 0 && $y_total <> "" && $total2 <> ""){
            $y_total_per = number_format((floor(((float)$y_total / (float)$total2) * 100 * 10)) / 10 ,1);
        } else {
            $y_total_per = "---";
        }
        $y_total_per = number_format(bcsub('100', ((float)$r_total_per + (float)$j_total_per + (float)$y_total_per), 1) ,1);


        $r_per_html .= "<div class='title7 ta_r'>" . $r_total_per . "%</div>";
        $j_per_html .= "<div class='title7 ta_r'>" . $j_total_per . "%</div>";
        $y_per_html .= "<div class='title7 ta_r'>" . $y_total_per . "%</div>";
        $o_per_html .= "<div class='title7 ta_r'>" . $o_total_per . "%</div>";


    $temp3_all_sorce5 = "<p class='title_a'>点数・構成比</p><div class='box1'>" . $temp3_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>自社</div>" . $j_per_html . "</div>";
    $temp3_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>楽天</div>" . $r_per_html . "</div>";
    $temp3_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ヤフー</div>" . $y_per_html . "</div>";
    $temp3_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>その他</div>" . $o_per_html . "</div>";
    $temp3_all_sorce5 .= "</div>";



// 現在・平均単価

    $i = 0;
    $r_average = "";
    $r_ave_html = "";
    $r_total = "";
    $r_total2 = "";
    $r_total_ave = "";
    foreach($temp3_r_manthly_array as $var){

        if($var == 0){
            $r_average = 0;
            $r_total = (int)$r_total + (int)$var;
            if($temp3_r_manthly_array2[$i] == 0){
                $r_total2 = $r_total2;
            } else {
                $r_total2 = (int)$r_total2 + (int)$temp3_r_manthly_array2[$i];
            }
        } else {
            $r_average = (floor(((int)$var / (int)$temp3_r_manthly_array2[$i])) * 10) / 10;
            $r_total = (int)$r_total + (int)$var;
            if($temp3_r_manthly_array2[$i] == 0){
                $r_total2 = $r_total2;
            } else {
                $r_total2 = (int)$r_total2 + (int)$temp3_r_manthly_array2[$i];
            }
        }
        if($r_average <> 0 && $r_average <> ""){$r_average = number_format((int)$r_average);}
        $r_ave_html .= "<div class='title7 ta_r'>" . $r_average . "</div>";

        $i++;
    }
    // 期間中の売上合計に対する平均単価を取得
        if($r_total <> 0 && $r_total2 <> 0 && $r_total <> "" && $r_total2 <> ""){
            $r_total_ave = (floor(((int)$r_total / (int)$r_total2) * 10)) / 10;
        } else {
            $r_total_ave = "---";
        }
        if($r_total_ave <> 0 && $r_total_ave <> ""){$r_total_ave = number_format((int)$r_total_ave);}
        $r_ave_html .= "<div class='title7 ta_r'>" . $r_total_ave . "</div>";

    $i = 0;
    $j_average = "";
    $j_ave_html = "";
    $j_total = "";
    $j_total2 = "";
    $j_total_ave = "";
    foreach($temp3_j_manthly_array as $var){

        if($var == 0){
            $j_average = 0;
            $j_total = (int)$j_total + (int)$var;
            if($temp3_j_manthly_array2[$i] == 0){
                $j_total2 = $j_total2;
            } else {
                $j_total2 = (int)$j_total2 + (int)$temp3_j_manthly_array2[$i];
            }
        } else {
            $j_average = (floor(((int)$var / (int)$temp3_j_manthly_array2[$i])) * 10) / 10;
            $j_total = (int)$j_total + (int)$var;
            if($temp3_j_manthly_array2[$i] == 0){
                $j_total2 = $j_total2;
            } else {
                $j_total2 = (int)$j_total2 + (int)$temp3_j_manthly_array2[$i];
            }
        }
        if($j_average <> 0 && $j_average <> ""){$j_average = number_format((int)$j_average);}
        $j_ave_html .= "<div class='title7 ta_r'>" . $j_average . "</div>";

        $i++;
    }
    // 期間中の売上合計に対する平均単価を取得
        if($j_total <> 0 && $j_total2 <> 0 && $j_total <> "" && $j_total2 <> ""){
            $j_total_ave = (floor(((int)$j_total / (int)$j_total2) * 10)) / 10;
        } else {
            "---";
        }
        if($j_total_ave <> 0 && $j_total_ave <> ""){$j_total_ave = number_format((int)$j_total_ave);}
        $j_ave_html .= "<div class='title7 ta_r'>" . $j_total_ave . "</div>";


            $i = 0;
            $y_average = "";
            $y_ave_html = "";
            $y_total = "";
            $y_total2 = "";
            $y_total_ave = "";
            foreach($temp3_y_manthly_array as $var){

                if($var == 0){
                    $y_average = 0;
                    $y_total = (int)$y_total + (int)$var;
                    if($temp3_y_manthly_array2[$i] == 0){
                        $y_total2 = $y_total2;
                    } else {
                        $y_total2 = (int)$y_total2 + (int)$temp3_y_manthly_array2[$i];
                    }
                } else {
                    $y_average = (floor(((int)$var / (int)$temp3_y_manthly_array2[$i])) * 10) / 10;
                    $y_total = (int)$y_total + (int)$var;
                    if($temp3_y_manthly_array2[$i] == 0){
                        $y_total2 = $y_total2;
                    } else {
                        $y_total2 = (int)$y_total2 + (int)$temp3_y_manthly_array2[$i];
                    }
                }
                if($y_average <> 0 && $y_average <> ""){$y_average = number_format((int)$y_average);}
                $y_ave_html .= "<div class='title7 ta_r'>" . $y_average . "</div>";

                $i++;
            }
            // 期間中の売上合計に対する平均単価を取得
                if($y_total == 0 || $y_total2 == 0 || $y_total == "" || $y_total2 == ""){
                    $y_total_ave = "---";
                } else {
                    $y_total_ave = (floor(((int)$y_total / (int)$y_total2) * 10)) / 10;
                }
                if($y_total_ave <> 0 && $y_total_ave <> ""){$y_total_ave = number_format((int)$y_total_ave);}
                $y_ave_html .= "<div class='title7 ta_r'>" . $y_total_ave . "</div>";


            $i = 0;
            $o_average = "";
            $o_ave_html = "";
            $o_total = "";
            $o_total2 = "";
            $o_total_ave = "";
            foreach($temp3_o_manthly_array as $var){

                if($var == 0){
                    $o_average = 0;
                    $o_total = (int)$o_total + (int)$var;
                    if($temp3_o_manthly_array2[$i] == 0){
                        $o_total2 = $o_total2;
                    } else {
                        $o_total2 = (int)$o_total2 + (int)$temp3_o_manthly_array2[$i];
                    }
                } else {
                    $o_average = (floor(((int)$var / (int)$temp3_o_manthly_array2[$i])) * 10) / 10;
                    $o_total = (int)$o_total + (int)$var;
                    if($temp3_o_manthly_array2[$i] == 0){
                        $o_total2 = $o_total2;
                    } else {
                        $o_total2 = (int)$o_total2 + (int)$temp3_o_manthly_array2[$i];
                    }
                }
                if($o_average <> 0 && $o_average <> ""){$o_average = number_format((int)$o_average);}
                $o_ave_html .= "<div class='title7 ta_r'>" . $o_average . "</div>";

                $i++;
            }
            // 期間中の売上合計に対する平均単価を取得
                if($o_total == 0 || $o_total2 == 0 || $o_total == "" || $o_total2 == ""){
                    $o_total_ave = "---";
                } else {
                    $o_total_ave = (floor(((int)$o_total / (int)$o_total2) * 10)) / 10;
                }
                if($o_total_ave <> 0 && $o_total_ave <> ""){$o_total_ave = number_format((int)$o_total_ave);}
                $o_ave_html .= "<div class='title7 ta_r'>" . $o_total_ave . "</div>";




    $temp3_all_sorce6 = "<p class='title_a'>平均単価</p><div class='box1'>" . $temp3_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>自社</div>" . $j_ave_html . "</div>";
    $temp3_all_sorce6 .= "<div class='wid100 ul4'><div class='title7 ta_c'>楽天</div>" . $r_ave_html . "</div>";
    $temp3_all_sorce6 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ヤフー</div>" . $y_ave_html . "</div>";
    $temp3_all_sorce6 .= "<div class='wid100 ul4'><div class='title7 ta_c'>その他</div>" . $o_ave_html . "</div>";
    $temp3_all_sorce6 .= "</div>";


// 楽天・金額・過去比

    $i = 0;
    $r_ratio = "";
    $r_ratio_html = "";
    $r_total = "";
    $r_total_past = "";
    $r_total_ratio = "";
    foreach($temp3_r_manthly_array as $var){
        if($var == 0){
            $r_ratio = "---";
            $r_total = $r_total;
            if($past_temp3_r_manthly_array[$i] == 0){
                $r_total_past = $r_total_past;
            } else {
                $r_total_past = (int)$r_total_past + (int)$past_temp3_r_manthly_array[$i];
            }
        } else {
            if($var == 0 || $past_temp3_r_manthly_array[$i] == 0 || $var == "" || $past_temp3_r_manthly_array[$i] == ""){
                $r_ratio = "---";
            } else { 
                $r_ratio = number_format((floor(($var / $past_temp3_r_manthly_array[$i]) * 100 * 10)) / 10 ,1);
            }
            $r_total = (int)$r_total + (int)$var;
            if($past_temp3_r_manthly_array[$i] == 0){
                $r_total_past = $r_total_past;
            } else {
                $r_total_past = (int)$r_total_past + (int)$past_temp3_r_manthly_array[$i];
            }
        }
        if($r_ratio < 100){
            $r_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $r_ratio . "%</div>";
        } else {
            $r_ratio_html .= "<div class='title7 ta_r fc_red'>" . $r_ratio . "%</div>";
        }

        $i++;
    }
    // 過去の同期間売上金額に対する比率を取得
        if($r_total <> 0 && $r_total_past <> 0 && $r_total <> "" && $r_total_past <> ""){
            $r_total_ratio = number_format((floor(((float)$r_total / (float)$r_total_past) * 100 * 10)) / 10 ,1);
        } else {
            $r_total_ratio = "---";
        }

        if($r_total_ratio < 100){
            $r_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $r_total_ratio . "%</div>";
        } else {
            $r_ratio_html .= "<div class='title7 ta_r fc_red'>" . $r_total_ratio . "%</div>";
        }


// 自社・金額・過去比

    $i = 0;
    $j_ratio = "";
    $j_ratio_html = "";
    $j_total = "";
    $j_total_past = "";
    $j_total_ratio = "";
    foreach($temp3_j_manthly_array as $var){
        if($var == 0){
            $j_ratio = "---";
            $j_total = $j_total;
            if($past_temp3_j_manthly_array[$i] == 0){
                $j_total_past = $j_total_past;
            } else {
                $j_total_past = (int)$j_total_past + (int)$past_temp3_j_manthly_array[$i];
            }
        } else {
            if($var == 0 || $past_temp3_j_manthly_array[$i] == 0 || $var == "" || $past_temp3_j_manthly_array[$i] == ""){
                $j_ratio = "---";
            } else {
                $j_ratio = number_format((floor(($var / $past_temp3_j_manthly_array[$i]) * 100 * 10)) / 10 ,1);
            }
            $j_total = (int)$j_total + (int)$var;
            if($past_temp3_j_manthly_array[$i] == 0){
                $j_total_past = $j_total_past;
            } else {
                $j_total_past = (int)$j_total_past + (int)$past_temp3_j_manthly_array[$i];
            }
        }
        if($j_ratio < 100){
            $j_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $j_ratio . "%</div>";
        } else {
            $j_ratio_html .= "<div class='title7 ta_r fc_red'>" . $j_ratio . "%</div>";
        }
        

        $i++;
    }
    // 過去の同期間売上金額に対する比率を取得
        if($r_total <> 0 && $r_total_past <> 0 && $r_total <> "" && $r_total_past <> ""){
            $j_total_ratio = number_format((floor(((float)$j_total / (float)$j_total_past) * 100 * 10)) / 10 ,1);
        } else {
            $j_total_ratio = "---";
        }

        if($j_total_ratio < 100){
            $j_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $j_total_ratio . "%</div>";
        } else {
            $j_ratio_html .= "<div class='title7 ta_r fc_red'>" . $j_total_ratio . "%</div>";
        }
        
        // ヤフー・金額・過去比
            $i = 0;
            $y_ratio = "";
            $y_ratio_html = "";
            $y_total = "";
            $y_total_past = "";
            $y_total_ratio = "";
            foreach($temp3_y_manthly_array as $var){
                if($var == 0){
                    $y_ratio = "---";
                    $y_total = $y_total;
                    if($past_temp3_y_manthly_array[$i] == 0){
                        $y_total_past = $y_total_past;
                    } else {
                        $y_total_past = (int)$y_total_past + (int)$past_temp3_y_manthly_array[$i];
                    }
                } else {
                    if($var == 0 || $past_temp3_y_manthly_array[$i] == 0 || $var == "" || $past_temp3_y_manthly_array[$i] == ""){
                        $y_ratio = "---";
                    } else {
                        $y_ratio = number_format((floor(($var / $past_temp3_y_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                    }
                    $y_total = (int)$y_total + (int)$var;
                    if($past_temp3_y_manthly_array[$i] == 0){
                        $y_total_past = $y_total_past;
                    } else {
                        $y_total_past = (int)$y_total_past + (int)$past_temp3_y_manthly_array[$i];
                    }
                }

                if($y_ratio < 100){
                    $y_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $y_ratio . "%</div>";
                } else {
                    $y_ratio_html .= "<div class='title7 ta_r fc_red'>" . $y_ratio . "%</div>";
                }
        
                $i++;
            }
            // 過去の同期間売上金額に対する比率を取得
                if($y_total == 0 || $y_total_past == 0 || $y_total == "" || $y_total_past == ""){
                    $y_total_ratio = "---";
                } else {
                    $y_total_ratio = number_format((floor(((int)$y_total / (int)$y_total_past) * 100 * 10)) / 10 ,1);
                }

                if($y_total_ratio < 100){
                    $y_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $y_total_ratio . "%</div>";
                } else {
                    $y_ratio_html .= "<div class='title7 ta_r fc_red'>" . $y_total_ratio . "%</div>";
                }
                
        // その他・金額・過去比
            $i = 0;
            $o_ratio = "";
            $o_ratio_html = "";
            $o_total = "";
            $o_total_past = "";
            $o_total_ratio = "";
            foreach($temp3_o_manthly_array as $var){
                if($var == 0){
                    $o_ratio = "---";
                    $o_total = $o_total;
                    if($past_temp3_o_manthly_array[$i] == 0){
                        $o_total_past = $o_total_past;
                    } else {
                        $o_total_past = (int)$o_total_past + (int)$past_temp3_o_manthly_array[$i];
                    }
                } else {
                    if($var == 0 || $past_temp3_o_manthly_array[$i] == 0 || $var == "" || $past_temp3_o_manthly_array[$i] == ""){
                        $o_ratio = "---";
                    } else {
                        $o_ratio = number_format((floor(($var / $past_temp3_o_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                    }
                    $o_total = (int)$o_total + (int)$var;
                    if($past_temp3_o_manthly_array[$i] == 0){
                        $o_total_past = $o_total_past;
                    } else {
                        $o_total_past = (int)$o_total_past + (int)$past_temp3_o_manthly_array[$i];
                    }
                }

                if($o_ratio < 100){
                    $o_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $o_ratio . "%</div>";
                } else {
                    $o_ratio_html .= "<div class='title7 ta_r fc_red'>" . $o_ratio . "%</div>";
                }
        
                $i++;
            }
            // 過去の同期間売上金額に対する比率を取得
                if($o_total == 0 || $o_total_past == 0 || $o_total == "" || $o_total_past == ""){
                    $o_total_ratio = "---";
                } else {
                    $o_total_ratio = number_format((floor(((int)$o_total / (int)$o_total_past) * 100 * 10)) / 10 ,1);
                }

                if($o_total_ratio < 100){
                    $o_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $o_total_ratio . "%</div>";
                } else {
                    $o_ratio_html .= "<div class='title7 ta_r fc_red'>" . $o_total_ratio . "%</div>";
                }



// 楽天・自社・ヤフー合計・金額・過去比

    $i = 0;
    $ratio = "";
    $ratio_html = "";
    $total = "";
    $total_past = "";
    $total_ratio = "";
    foreach($temp3_r_manthly_array as $var){
        if($var == 0 && $temp3_j_manthly_array[$i] == 0/* && $temp3_y_manthly_array[$i] == 0*/){
            $ratio = 0;
            $total = $total;
            if($past_temp3_r_manthly_array[$i] == 0 && $past_temp3_j_manthly_array[$i] == 0/* && $past_temp3_y_manthly_array[$i] == 0*/){
                $total_past = $total_past;
            } else {
                    $total_past = (int)$total_past + (int)$past_temp3_r_manthly_array[$i] + (int)$past_temp3_j_manthly_array[$i] + (int)$past_temp3_y_manthly_array[$i] + (int)$past_temp3_o_manthly_array[$i];
            }
        } else {
                if((int)$var + (int)$temp3_j_manthly_array[$i] + (int)$temp3_y_manthly_array[$i]  + (int)$temp3_o_manthly_array[$i] == 0 || (int)$past_temp3_r_manthly_array[$i] + (int)$past_temp3_j_manthly_array[$i] + (int)$past_temp3_y_manthly_array[$i] + (int)$past_temp3_o_manthly_array[$i] == 0){
                    $ratio = "---";
                } else {
                    $ratio = number_format((floor((((int)$var + (int)$temp3_j_manthly_array[$i] + (int)$temp3_y_manthly_array[$i] + (int)$temp3_o_manthly_array[$i]) / ((int)$past_temp3_r_manthly_array[$i] + (int)$past_temp3_j_manthly_array[$i] + (int)$past_temp3_y_manthly_array[$i] + (int)$past_temp3_o_manthly_array[$i])) * 100 * 10)) / 10 ,1);
                }
                $total = (int)$total + (int)$var + (int)$temp3_j_manthly_array[$i] + (int)$temp3_y_manthly_array[$i] + (int)$temp3_o_manthly_array[$i];
                if($past_temp3_r_manthly_array[$i] == 0 && $past_temp3_j_manthly_array[$i] == 0 && $past_temp3_y_manthly_array[$i] == 0 && $past_temp3_o_manthly_array[$i] == 0){
                    $total_past = $total_past;
                } else {
                    $total_past = (int)$total_past + (int)$past_temp3_r_manthly_array[$i] + (int)$past_temp3_j_manthly_array[$i] + (int)$past_temp3_y_manthly_array[$i] + (int)$past_temp3_o_manthly_array[$i];
                }
        }

        if($ratio < 100){
            $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ratio . "%</div>";
        } else {
            $ratio_html .= "<div class='title7 ta_r fc_red'>" . $ratio . "%</div>";
        }

        $i++;
    }
    // 過去の同期間売上金額に対する比率を取得
        if($total <> 0 && $total_past <> 0 && $total <> "" && $total_past <> ""){
            $total_ratio = number_format((floor(((float)$total / (float)$total_past) * 100 * 10)) / 10 ,1);
        } else {
            $total_ratio = "---";
        }

        //$ratio_html .= "<div class='title7 ta_r bg_grey'>" . $total_ratio . "%</div>";

        if($total_ratio < 100){
            $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $total_ratio . "%</div>";
        } else {
            $ratio_html .= "<div class='title7 ta_r fc_red'>" . $total_ratio . "%</div>";
        }


    $temp3_all_sorce7 = "<p class='title_a'>金額・過去比</p><div class='box1'>" . $temp3_title5 . "<div class='wid100 ul4'><div class='title7 ta_c'>自社</div>" . $j_ratio_html . "</div>";
    $temp3_all_sorce7 .= "<div class='wid100 ul4'><div class='title7 ta_c'>楽天</div>" . $r_ratio_html . "</div>";
    $temp3_all_sorce7 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ヤフー</div>" . $y_ratio_html . "</div>";
    $temp3_all_sorce7 .= "<div class='wid100 ul4'><div class='title7 ta_c'>その他</div>" . $o_ratio_html . "</div>";
    $temp3_all_sorce7 .= "<div class='wid100 ul4 bg_grey'><div class='title7 ta_c'>合計</div>" . $ratio_html . "</div></div>";


// 楽天・点数・過去比

    $i = 0;
    $r_ratio = "";
    $r_ratio_html = "";
    $r_total = "";
    $r_total_past = "";
    $r_total_ratio = "";
    foreach($temp3_r_manthly_array2 as $var){
        if($var == 0){
            $r_ratio = "---";
            $r_total = $r_total;
            if($past_temp3_r_manthly_array2[$i] == 0){
                $r_total_past = $r_total_past;
            } else {
                $r_total_past = (int)$r_total_past + (int)$past_temp3_r_manthly_array2[$i];
            }
        } else {
            if($var == 0 || $past_temp3_r_manthly_array2[$i] == 0 || $var == "" || $past_temp3_r_manthly_array2[$i] == ""){
                $r_ratio = "---";
            } else {
                $r_ratio = number_format((floor(($var / $past_temp3_r_manthly_array2[$i]) * 100 * 10)) / 10 ,1);
            }
            $r_total = (int)$r_total + (int)$var;
            if($past_temp3_r_manthly_array2[$i] == 0){
                $r_total_past = $r_total_past;
            } else {
                $r_total_past = (int)$r_total_past + (int)$past_temp3_r_manthly_array2[$i];
            }
        }

        if($r_ratio < 100){
            $r_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $r_ratio . "%</div>";
        } else {
            $r_ratio_html .= "<div class='title7 ta_r fc_red'>" . $r_ratio . "%</div>";
        }

        $i++;
    }
    // 過去の同期間売上点数に対する比率を取得
        if($r_total <> 0 && $r_total_past <> 0 && $r_total <> "" && $r_total_past <> ""){
            $r_total_ratio = number_format((floor(((float)$r_total / (float)$r_total_past) * 100 * 10)) / 10 ,1);
        } else {
            $r_total_ratio = "---";
        }

        //$r_ratio_html .= "<div class='title7 ta_r'>" . $r_total_ratio . "%</div>";

        if($r_total_ratio < 100){
            $r_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $r_total_ratio . "%</div>";
        } else {
            $r_ratio_html .= "<div class='title7 ta_r fc_red'>" . $r_total_ratio . "%</div>";
        }


// 自社・点数・過去比

    $i = 0;
    $j_ratio = "";
    $j_ratio_html = "";
    $j_total = "";
    $j_total_past = "";
    $j_total_ratio = "";
    foreach($temp3_j_manthly_array2 as $var){
        if($var == 0){
            $j_ratio = "---";
            $j_total = $j_total;
            if($past_temp3_j_manthly_array2[$i] == 0){
                $j_total_past = $j_total_past;
            } else {
                $j_total_past = (int)$j_total_past + (int)$past_temp3_j_manthly_array2[$i];
            }
        } else {
            if($var == 0 || $past_temp3_j_manthly_array2[$i] == 0 || $var == "" || $past_temp3_j_manthly_array2[$i] == ""){
                $j_ratio = "---";
            } else {
                $j_ratio = number_format((floor(($var / $past_temp3_j_manthly_array2[$i]) * 100 * 10)) / 10 ,1);
            }
            $j_total = (int)$j_total + (int)$var;
            if($past_temp3_j_manthly_array2[$i] == 0){
                $j_total_past = $j_total_past;
            } else {
                $j_total_past = (int)$j_total_past + (int)$past_temp3_j_manthly_array2[$i];
            }
        }
        if($j_ratio < 100){
            $j_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $j_ratio . "%</div>";
        } else {
            $j_ratio_html .= "<div class='title7 ta_r fc_red'>" . $j_ratio . "%</div>";
        }

        $i++;
    }
    // 過去の同期間売上点数に対する比率を取得
        if($j_total <> 0 && $j_total_past <> 0 && $j_total <> "" && $j_total_past <> ""){
            $j_total_ratio = number_format((floor(((float)$j_total / (float)$j_total_past) * 100 * 10)) / 10 ,1);
        } else {
            $j_total_ratio = "---";
        }

        if($j_total_ratio < 100){
            $j_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $j_total_ratio . "%</div>";
        } else {
            $j_ratio_html .= "<div class='title7 ta_r fc_red'>" . $j_total_ratio . "%</div>";
        }


        // ヤフー・金額・過去比
            $i = 0;
            $y_ratio = "";
            $y_ratio_html = "";
            $y_total = "";
            $y_total_past = "";
            $y_total_ratio = "";
            foreach($temp3_y_manthly_array2 as $var){
                if($var == 0){
                    $y_ratio = "---";
                    $y_total = $y_total;
                    if($past_temp3_y_manthly_array2[$i] == 0){
                        $y_total_past = $y_total_past;
                    } else {
                        $y_total_past = (int)$y_total_past + (int)$past_temp3_y_manthly_array2[$i];
                    }
                } else {
                    if($var == 0 || $past_temp3_y_manthly_array2[$i] == 0 || $var == "" || $past_temp3_y_manthly_array2[$i] == ""){
                        $y_ratio = "---";
                    } else {
                        $y_ratio = number_format((floor(($var / $past_temp3_y_manthly_array2[$i]) * 100 * 10)) / 10 ,1);
                    }
                    $y_total = (int)$y_total + (int)$var;
                    if($past_temp3_y_manthly_array2[$i] == 0){
                        $y_total_past = $y_total_past;
                    } else {
                        $y_total_past = (int)$y_total_past + (int)$past_temp3_y_manthly_array2[$i];
                    }
                }
                if($y_ratio < 100){
                    $y_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $y_ratio . "%</div>";
                } else {
                    $y_ratio_html .= "<div class='title7 ta_r fc_red'>" . $y_ratio . "%</div>";
                }
        
                $i++;
            }
            // 過去の同期間売上金額に対する比率を取得
                if($y_total == 0 || $y_total_past == 0 || $y_total == "" || $y_total_past == ""){
                    $y_total_ratio = "---";
                } else {
                    $y_total_ratio = number_format((floor(((int)$y_total / (int)$y_total_past) * 100 * 10)) / 10 ,1);
                }

                if($y_total_ratio < 100){
                    $y_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $y_total_ratio . "%</div>";
                } else {
                    $y_ratio_html .= "<div class='title7 ta_r fc_red'>" . $y_total_ratio . "%</div>";
                }


        // その他・金額・過去比
            $i = 0;
            $o_ratio = "";
            $o_ratio_html = "";
            $o_total = "";
            $o_total_past = "";
            $o_total_ratio = "";
            foreach($temp3_o_manthly_array2 as $var){
                if($var == 0){
                    $o_ratio = "---";
                    $o_total = $o_total;
                    if($past_temp3_o_manthly_array2[$i] == 0){
                        $o_total_past = $o_total_past;
                    } else {
                        $o_total_past = (int)$o_total_past + (int)$past_temp3_o_manthly_array2[$i];
                    }
                } else {
                    if($var == 0 || $past_temp3_o_manthly_array2[$i] == 0 || $var == "" || $past_temp3_o_manthly_array2[$i] == ""){
                        $o_ratio = "---";
                    } else {
                        $o_ratio = number_format((floor(($var / $past_temp3_o_manthly_array2[$i]) * 100 * 10)) / 10 ,1);
                    }
                    $o_total = (int)$o_total + (int)$var;
                    if($past_temp3_o_manthly_array2[$i] == 0){
                        $o_total_past = $o_total_past;
                    } else {
                        $o_total_past = (int)$o_total_past + (int)$past_temp3_o_manthly_array2[$i];
                    }
                }
                if($o_ratio < 100){
                    $o_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $o_ratio . "%</div>";
                } else {
                    $o_ratio_html .= "<div class='title7 ta_r fc_red'>" . $o_ratio . "%</div>";
                }
        
                $i++;
            }
            // 過去の同期間売上金額に対する比率を取得
                if($o_total == 0 || $o_total_past == 0 || $o_total == "" || $o_total_past == ""){
                    $o_total_ratio = "---";
                } else {
                    $o_total_ratio = number_format((floor(((int)$o_total / (int)$o_total_past) * 100 * 10)) / 10 ,1);
                }

                if($o_total_ratio < 100){
                    $o_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $o_total_ratio . "%</div>";
                } else {
                    $o_ratio_html .= "<div class='title7 ta_r fc_red'>" . $o_total_ratio . "%</div>";
                }
                

// 楽天・自社・ヤフー合計・点数・過去比

    $i = 0;
    $ratio = "";
    $ratio_html = "";
    $total = "";
    $total_past = "";
    $total_ratio = "";
    foreach($temp3_r_manthly_array2 as $var){
        if($var == 0 && $temp3_j_manthly_array2[$i] == 0/* && $temp3_y_manthly_array2[$i] == 0*/){
            $ratio = 0;
            $total = $total;
            if($past_temp3_r_manthly_array2[$i] == 0 && $past_temp3_j_manthly_array2[$i] == 0/* && $past_temp3_y_manthly_array2[$i] == 0*/){
                $total_past = $total_past;
            } else {
                    $total_past = (int)$total_past + (int)$past_temp3_r_manthly_array2[$i] + (int)$past_temp3_j_manthly_array2[$i] + (int)$past_temp3_y_manthly_array2[$i] + (int)$past_temp3_o_manthly_array2[$i];
            }
        } else {
                if((int)$var + (int)$temp3_j_manthly_array2[$i] + (int)$temp3_y_manthly_array2[$i] + (int)$temp3_o_manthly_array2[$i] == 0 || (int)$past_temp3_r_manthly_array2[$i] + (int)$past_temp3_j_manthly_array2[$i] + (int)$past_temp3_y_manthly_array2[$i] + (int)$past_temp3_o_manthly_array2[$i] == 0){
                    $ratio = "---";
                } else {
                    $ratio = number_format((floor((((int)$var + (int)$temp3_j_manthly_array2[$i] + (int)$temp3_y_manthly_array2[$i] + (int)$temp3_o_manthly_array2[$i]) / ((int)$past_temp3_r_manthly_array2[$i] + (int)$past_temp3_j_manthly_array2[$i] + (int)$past_temp3_y_manthly_array2[$i] + (int)$past_temp3_o_manthly_array2[$i])) * 100 * 10)) / 10 ,1);
                }
                $total = (int)$total + (int)$var + (int)$temp3_j_manthly_array2[$i] + (int)$temp3_y_manthly_array2[$i] + (int)$temp3_o_manthly_array2[$i];
                if($past_temp3_r_manthly_array2[$i] == 0 && $past_temp3_j_manthly_array2[$i] == 0 && $past_temp3_y_manthly_array2[$i] == 0 && $past_temp3_o_manthly_array2[$i] == 0){
                    $total_past = $total_past;
                } else {
                    $total_past = (int)$total_past + (int)$past_temp3_r_manthly_array2[$i] + (int)$past_temp3_j_manthly_array2[$i] + (int)$past_temp3_y_manthly_array2[$i] + (int)$past_temp3_o_manthly_array2[$i];
                }
        }
        if($ratio < 100){
            $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ratio . "%</div>";
        } else {
            $ratio_html .= "<div class='title7 ta_r fc_red'>" . $ratio . "%</div>";
        }

        $i++;
    }
    // 過去の同期間売上金額に対する比率を取得
        if($total <> 0 && $total_past <> 0 && $total <> "" && $total_past <> ""){
            $total_ratio = number_format((floor(((float)$total / (float)$total_past) * 100 * 10)) / 10 ,1);
        } else {
            $total_ratio = "---";
        }

        //$ratio_html .= "<div class='title7 ta_r bg_grey'>" . $total_ratio . "%</div>";
        if($total_ratio < 100){
            $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $total_ratio . "%</div>";
        } else {
            $ratio_html .= "<div class='title7 ta_r fc_red'>" . $total_ratio . "%</div>";
        }

    $temp3_all_sorce8 = "<p class='title_a'>点数・過去比</p><div class='box1'>" . $temp3_title5 . "<div class='wid100 ul4'><div class='title7 ta_c'>自社</div>" . $j_ratio_html . "</div>";
    $temp3_all_sorce8 .= "<div class='wid100 ul4'><div class='title7 ta_c'>楽天</div>" . $r_ratio_html . "</div>";
    $temp3_all_sorce8 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ヤフー</div>" . $y_ratio_html . "</div>";
    $temp3_all_sorce8 .= "<div class='wid100 ul4'><div class='title7 ta_c'>その他</div>" . $o_ratio_html . "</div>";
    $temp3_all_sorce8 .= "<div class='wid100 ul4 bg_grey'><div class='title7 ta_c'>合計</div>" . $ratio_html . "</div></div>";
    
        
// 楽天・粗利・過去比

    $i = 0;
    $r_ratio = "";
    $r_ratio_html = "";
    $r_total = "";
    $r_total_past = "";
    $r_total_ratio = "";
    foreach($temp3_r_manthly_array3 as $var){
        if($var == 0){
            $r_ratio = "---";
            $r_total = $r_total;
            if($past_temp3_r_manthly_array3[$i] == 0){
                $r_total_past = $r_total_past;
            } else {
                $r_total_past = (int)$r_total_past + (int)$past_temp3_r_manthly_array3[$i];
            }
        } else {
            if($var == 0 || $past_temp3_r_manthly_array3[$i] == 0 || $var == "" || $past_temp3_r_manthly_array3[$i] == ""){
                $r_ratio = "---";
            } else {
                $r_ratio = number_format((floor(($var / $past_temp3_r_manthly_array3[$i]) * 100 * 10)) / 10 ,1);
            }
            $r_total = (int)$r_total + (int)$var;
            if($past_temp3_r_manthly_array3[$i] == 0){
                $r_total_past = $r_total_past;
            } else {
                $r_total_past = (int)$r_total_past + (int)$past_temp3_r_manthly_array3[$i];
            }
        }
        if($r_ratio < 100){
            $r_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $r_ratio . "%</div>";
        } else {
            $r_ratio_html .= "<div class='title7 ta_r fc_red'>" . $r_ratio . "%</div>";
        }

        $i++;
    }
    // 過去の同期間売上粗利に対する比率を取得
        if($r_total <> 0 && $r_total_past <> 0 && $r_total <> "" && $r_total_past <> ""){
            $r_total_ratio = number_format((floor(((float)$r_total / (float)$r_total_past) * 100 * 10)) / 10 ,1);
        } else {
            $r_total_ratio = "---";
        }
        if($r_total_ratio < 100){
            $r_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $r_total_ratio . "%</div>";
        } else {
            $r_ratio_html .= "<div class='title7 ta_r fc_red'>" . $r_total_ratio . "%</div>";
        }


// 自社・粗利・過去比

    $i = 0;
    $j_ratio = "";
    $j_ratio_html = "";
    $j_total = "";
    $j_total_past = "";
    $j_total_ratio = "";
    foreach($temp3_j_manthly_array3 as $var){
        if($var == 0){
            $j_ratio = "---";
            $j_total = $j_total;
            if($past_temp3_j_manthly_array3[$i] == 0){
                $j_total_past = $j_total_past;
            } else {
                $j_total_past = (int)$j_total_past + (int)$past_temp3_j_manthly_array3[$i];
            }
        } else {
            if($var == 0 || $past_temp3_j_manthly_array3[$i] == 0 || $var == "" || $past_temp3_j_manthly_array3[$i] == ""){
                $j_ratio = "---";
            } else {
                $j_ratio = number_format((floor(($var / $past_temp3_j_manthly_array3[$i]) * 100 * 10)) / 10 ,1);
            }
            $j_total = (int)$j_total + (int)$var;
            if($past_temp3_j_manthly_array3[$i] == 0){
                $j_total_past = $j_total_past;
            } else {
                $j_total_past = (int)$j_total_past + (int)$past_temp3_j_manthly_array3[$i];
            }
        }
        if($j_ratio < 100){
            $j_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $j_ratio . "%</div>";
        } else {
            $j_ratio_html .= "<div class='title7 ta_r fc_red'>" . $j_ratio . "%</div>";
        }

        $i++;
    }
    // 過去の同期間売上粗利に対する比率を取得
        if($j_total <> 0 && $j_total_past <> 0 && $j_total <> "" && $j_total_past <> ""){
            $j_total_ratio = number_format((floor(((float)$j_total / (float)$j_total_past) * 100 * 10)) / 10 ,1);
        } else {
            $j_total_ratio = "---";
        }

        if($j_total_ratio < 100){
            $j_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $j_total_ratio . "%</div>";
        } else {
            $j_ratio_html .= "<div class='title7 ta_r fc_red'>" . $j_total_ratio . "%</div>";
        }

        // ヤフー・粗利・過去比
            $i = 0;
            $y_ratio = "";
            $y_ratio_html = "";
            $y_total = "";
            $y_total_past = "";
            $y_total_ratio = "";
            foreach($temp3_y_manthly_array3 as $var){
                if($var == 0){
                    $y_ratio = "---";
                    $y_total = $y_total;
                    if($past_temp3_y_manthly_array3[$i] == 0){
                        $y_total_past = $y_total_past;
                    } else {
                        $y_total_past = (int)$y_total_past + (int)$past_temp3_y_manthly_array3[$i];
                    }
                } else {
                    if($var == 0 || $past_temp3_y_manthly_array3[$i] == 0 || $var == "" || $past_temp3_y_manthly_array3[$i] == ""){
                        $y_ratio = "---";
                    } else {
                        $y_ratio = number_format((floor(($var / $past_temp3_y_manthly_array3[$i]) * 100 * 10)) / 10 ,1);
                    }
                    $y_total = (int)$y_total + (int)$var;
                    if($past_temp3_y_manthly_array3[$i] == 0){
                        $y_total_past = $y_total_past;
                    } else {
                        $y_total_past = (int)$y_total_past + (int)$past_temp3_y_manthly_array3[$i];
                    }
                }
                //$y_ratio_html .= "<div class='title7 ta_r'>" . $y_ratio . "%</div>";
                if($y_ratio < 100){
                    $y_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $y_ratio . "%</div>";
                } else {
                    $y_ratio_html .= "<div class='title7 ta_r fc_red'>" . $y_ratio . "%</div>";
                }
        
                $i++;
            }
            // 過去の同期間売上金額に対する比率を取得
                if($y_total == 0 || $y_total_past == 0 || $y_total == "" || $y_total_past == ""){
                    $y_total_ratio = "---";
                } else {
                    $y_total_ratio = number_format((floor(((int)$y_total / (int)$y_total_past) * 100 * 10)) / 10 ,1);
                }


                //$y_ratio_html .= "<div class='title7 ta_r'>" . $y_total_ratio . "%</div>";
                if($y_total_ratio < 100){
                    $y_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $y_total_ratio . "%</div>";
                } else {
                    $y_ratio_html .= "<div class='title7 ta_r fc_red'>" . $y_total_ratio . "%</div>";
                }


        // その他・粗利・過去比
            $i = 0;
            $o_ratio = "";
            $o_ratio_html = "";
            $o_total = "";
            $o_total_past = "";
            $o_total_ratio = "";
            foreach($temp3_o_manthly_array3 as $var){
                if($var == 0){
                    $o_ratio = "---";
                    $o_total = $o_total;
                    if($past_temp3_o_manthly_array3[$i] == 0){
                        $o_total_past = $o_total_past;
                    } else {
                        $o_total_past = (int)$o_total_past + (int)$past_temp3_o_manthly_array3[$i];
                    }
                } else {
                    if($var == 0 || $past_temp3_o_manthly_array3[$i] == 0 || $var == "" || $past_temp3_o_manthly_array3[$i] == ""){
                        $o_ratio = "---";
                    } else {
                        $o_ratio = number_format((floor(($var / $past_temp3_o_manthly_array3[$i]) * 100 * 10)) / 10 ,1);
                    }
                    $o_total = (int)$o_total + (int)$var;
                    if($past_temp3_o_manthly_array3[$i] == 0){
                        $o_total_past = $o_total_past;
                    } else {
                        $o_total_past = (int)$o_total_past + (int)$past_temp3_o_manthly_array3[$i];
                    }
                }
                //$o_ratio_html .= "<div class='title7 ta_r'>" . $o_ratio . "%</div>";
                if($o_ratio < 100){
                    $o_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $o_ratio . "%</div>";
                } else {
                    $o_ratio_html .= "<div class='title7 ta_r fc_red'>" . $o_ratio . "%</div>";
                }
        
                $i++;
            }
            // 過去の同期間売上金額に対する比率を取得
                if($o_total == 0 || $o_total_past == 0 || $o_total == "" || $o_total_past == ""){
                    $o_total_ratio = "---";
                } else {
                    $o_total_ratio = number_format((floor(((int)$o_total / (int)$o_total_past) * 100 * 10)) / 10 ,1);
                }


                //$o_ratio_html .= "<div class='title7 ta_r'>" . $o_total_ratio . "%</div>";
                if($o_total_ratio < 100){
                    $o_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $o_total_ratio . "%</div>";
                } else {
                    $o_ratio_html .= "<div class='title7 ta_r fc_red'>" . $o_total_ratio . "%</div>";
                }



// 楽天・自社・ヤフー合計・粗利・過去比

    $i = 0;
    $ratio = "";
    $ratio_html = "";
    $total = "";
    $total_past = "";
    $total_ratio = "";
    foreach($temp3_r_manthly_array3 as $var){
        if($var == 0 && $temp3_j_manthly_array3[$i] == 0/* && $temp3_y_manthly_array3[$i] == 0*/){
            $ratio = 0;
            $total = $total;
            if($past_temp3_r_manthly_array3[$i] == 0 && $past_temp3_j_manthly_array3[$i] == 0/* && $past_temp3_y_manthly_array3[$i] == 0*/){
                $total_past = $total_past;
            } else {
                    $total_past = (int)$total_past + (int)$past_temp3_r_manthly_array3[$i] + (int)$past_temp3_j_manthly_array3[$i] + (int)$past_temp3_y_manthly_array3[$i] + (int)$past_temp3_o_manthly_array3[$i];
            }
        } else {
                if((int)$var + (int)$temp3_j_manthly_array3[$i] + (int)$temp3_y_manthly_array3[$i] + (int)$temp3_o_manthly_array3[$i] == 0 || (int)$past_temp3_r_manthly_array3[$i] + (int)$past_temp3_j_manthly_array3[$i] + (int)$past_temp3_y_manthly_array3[$i] + (int)$past_temp3_o_manthly_array3[$i] == 0){
                    $ratio = "---";
                } else {
                    $ratio = number_format((floor((((int)$var + (int)$temp3_j_manthly_array3[$i] + (int)$temp3_y_manthly_array3[$i] + (int)$temp3_o_manthly_array3[$i]) / ((int)$past_temp3_r_manthly_array3[$i] + (int)$past_temp3_j_manthly_array3[$i] + (int)$past_temp3_y_manthly_array3[$i] + (int)$past_temp3_o_manthly_array3[$i])) * 100 * 10)) / 10 ,1);
                }
                $total = (int)$total + (int)$var + (int)$temp3_j_manthly_array3[$i] + (int)$temp3_y_manthly_array3[$i] + (int)$temp3_o_manthly_array3[$i];
                if($past_temp3_r_manthly_array3[$i] == 0 && $past_temp3_j_manthly_array3[$i] == 0 && $past_temp3_y_manthly_array3[$i] == 0 && $past_temp3_o_manthly_array3[$i] == 0){
                    $total_past = $total_past;
                } else {
                    $total_past = (int)$total_past + (int)$past_temp3_r_manthly_array3[$i] + (int)$past_temp3_j_manthly_array3[$i] + (int)$past_temp3_y_manthly_array3[$i] + (int)$past_temp3_o_manthly_array3[$i];
                }
        }
        if($ratio < 100){
            $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ratio . "%</div>";
        } else {
            $ratio_html .= "<div class='title7 ta_r fc_red'>" . $ratio . "%</div>";
        }

        $i++;
    }
    // 過去の同期間売上金額に対する比率を取得
        if($total <> 0 && $total_past <> 0 && $total <> "" && $total_past <> ""){
            $total_ratio = number_format((floor(((float)$total / (float)$total_past) * 100 * 10)) / 10 ,1);
        } else {
            $total_ratio = "---";
        }

        //$ratio_html .= "<div class='title7 ta_r  bg_grey'>" . $total_ratio . "%</div>";
        if($total_ratio < 100){
            $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $total_ratio . "%</div>";
        } else {
            $ratio_html .= "<div class='title7 ta_r fc_red'>" . $total_ratio . "%</div>";
        }


    $temp3_all_sorce9 = "<p class='title_a'>粗利・過去比</p><div class='box1'>" . $temp3_title5 . "<div class='wid100 ul4'><div class='title7 ta_c'>自社</div>" . $j_ratio_html . "</div>";
    $temp3_all_sorce9 .= "<div class='wid100 ul4'><div class='title7 ta_c'>楽天</div>" . $r_ratio_html . "</div>";
    $temp3_all_sorce9 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ヤフー</div>" . $y_ratio_html . "</div>";
    $temp3_all_sorce9 .= "<div class='wid100 ul4'><div class='title7 ta_c'>その他</div>" . $o_ratio_html . "</div>";
    $temp3_all_sorce9 .= "<div class='wid100 ul4 bg_grey'><div class='title7 ta_c'>合計</div>" . $ratio_html . "</div></div>";


// 過去・金額構成比

    $i = 0;
    $total = "";
    $total2 = 0;
    $r_per = "";
    $j_per = "";
    $y_per = "";
    $o_per = "";
    $r_total = "";
    $j_total = "";
    $y_total = "";
    $o_total = "";
    $r_per_html = "";
    $j_per_html = "";
    $y_per_html = "";
    $o_per_html = "";
    $past_r_total_js2 = "";
    $past_j_total_js2 = "";
    $past_y_total_js2 = "";
    $past_o_total_js2 = "";
    foreach($past_temp3_r_manthly_array as $var){
            $total = (int)$var + (int)$past_temp3_j_manthly_array[$i] + (int)$past_temp3_y_manthly_array[$i] + (int)$past_temp3_o_manthly_array[$i];
        $total2 = (int)$total2 + (int)$total;
        $r_total = (int)$r_total + (int)$var;
        $j_total = (int)$j_total + (int)$past_temp3_j_manthly_array[$i];
        $y_total = (int)$y_total + (int)$past_temp3_y_manthly_array[$i];
        $o_total = (int)$o_total + (int)$past_temp3_o_manthly_array[$i];
        if($var == 0){
            $r_per = "---";
            if($past_temp3_j_manthly_array[$i] == 0){
                $j_per = "---";
            } else {
                    if($past_temp3_j_manthly_array[$i] <> 0 && $total <> 0 && $past_temp3_j_manthly_array[$i] <> "" && $total <> ""){
                        $j_per = number_format((floor(($past_temp3_j_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
                    } else {
                        $j_per = "---"; 
                    }
            }
            if($past_temp3_y_manthly_array[$i] == 0){
                $y_per = "---";
            } else {
                    if($past_temp3_y_manthly_array[$i] <> 0 && $total <> 0 && $past_temp3_y_manthly_array[$i] <> "" && $total <> ""){
                        $y_per = number_format((floor(($past_temp3_y_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
                    } else {
                        $y_per = "---"; 
                    }
            }
            
            if($past_temp3_o_manthly_array[$i] == 0){
                $o_per = "---";
            } else {
                 $o_per = number_format(bcsub('100', ((float)$r_per + (float)$j_per + (float)$y_per), 1) ,1);
            }
        } else {
            if($var <> 0 && $total <> 0 && $var <> "" && $total <> ""){
                $r_per = number_format((floor(($var / $total) * 100 * 10)) / 10 ,1);
            } else {
                $r_per = "---";
            }
            if($past_temp3_j_manthly_array[$i] == 0){
                $j_per = "---";
            } else {
                    if($past_temp3_j_manthly_array[$i] <> 0 && $total <> 0 && $past_temp3_j_manthly_array[$i] <> "" && $total <> ""){
                        $j_per = number_format((floor(($past_temp3_j_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
                    } else {
                        $j_per = "---";
                    }
            }
            if($past_temp3_y_manthly_array[$i] == 0){
                $y_per = "---";
            } else {
                    if($past_temp3_y_manthly_array[$i] <> 0 && $total <> 0 && $past_temp3_y_manthly_array[$i] <> "" && $total <> ""){
                        $y_per = number_format((floor(($past_temp3_y_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
                    } else {
                        $y_per = "---";
                    }
            }
            if($past_temp3_o_manthly_array[$i] == 0){
                $o_per = "---";
            } else {
                $o_per = number_format(bcsub('100', ((float)$r_per + (float)$j_per + (float)$y_per), 1) ,1);
            }
        }
        $r_per_html .= "<div class='title7 ta_r'>" . $r_per . "%</div>";
        $j_per_html .= "<div class='title7 ta_r'>" . $j_per . "%</div>";
        $past_r_total_js2  .= (float)$r_per . ", ";
        $past_j_total_js2  .= (float)$j_per . ", ";

        $y_per_html .= "<div class='title7 ta_r'>" . $y_per . "%</div>";
        $past_y_total_js2  .= (float)$y_per . ", ";
        $o_per_html .= "<div class='title7 ta_r'>" . $o_per . "%</div>";
        $past_o_total_js2  .= (float)$o_per . ", ";

        $i++;
    }
    // 期間中の売上合計に対するパーセンテージを取得
        if($r_total <> 0 && $total2 <> 0 && $r_total <> "" && $total2 <> ""){
            $r_total_per = number_format((floor(($r_total / $total2) * 100 * 10)) / 10 ,1);
        } else {
            $r_total_per = "---";
        }
        if($j_total <> 0 && $total2 <> 0 && $j_total <> "" && $total2 <> ""){
            $j_total_per = number_format((floor(($j_total / $total2) * 100 * 10)) / 10 ,1);
        } else {
            $j_total_per = "---";
        }
        if($y_total <> 0 && $total2 <> 0 && $y_total <> "" && $total2 <> ""){
            $y_total_per = number_format((floor(($y_total / $total2) * 100 * 10)) / 10 ,1);
        } else {
            $y_total_per = "---";
        }
        $o_total_per = number_format(bcsub('100', ((float)$r_total_per + (float)$j_total_per + (float)$y_total_per), 1) ,1);
        $r_per_html .= "<div class='title7 ta_r'>" . $r_total_per . "%</div>";
        $j_per_html .= "<div class='title7 ta_r'>" . $j_total_per . "%</div>";
        $y_per_html .= "<div class='title7 ta_r'>" . $y_total_per . "%</div>";
        $o_per_html .= "<div class='title7 ta_r'>" . $o_total_per . "%</div>";

    $past_temp3_all_sorce4 = "<p class='title_a'>金額・構成比（過去）</p><div class='box1'>" . $past_temp3_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>自社</div>" . $j_per_html . "</div>";
    $past_temp3_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>楽天</div>" . $r_per_html . "</div>";
    $past_temp3_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ヤフー</div>" . $y_per_html . "</div>";
    $past_temp3_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>その他</div>" . $o_per_html . "</div>";
    $past_temp3_all_sorce4 .= "</div>";

// 過去・点数構成比

    $i = 0;
    $total = "";
    $total2 = 0;
    $r_per = "";
    $j_per = "";
    $y_per = "";
    $o_per = "";
    $r_total = "";
    $j_total = "";
    $y_total = "";
    $o_total = "";
    $r_per_html = "";
    $j_per_html = "";
    $y_per_html = "";
    $o_per_html = "";
    $past_r_total_js3 = "";
    $past_j_total_js3 = "";
    $past_y_total_js3 = "";
    $past_o_total_js3 = "";
    foreach($past_temp3_r_manthly_array2 as $var){
        $total = (int)$var + (int)$past_temp3_j_manthly_array2[$i] + (int)$past_temp3_y_manthly_array2[$i] + (int)$past_temp3_o_manthly_array2[$i];
        $total2 = (int)$total2 + (int)$total;
        $r_total = (int)$r_total + (int)$var;
        $j_total = (int)$j_total + (int)$past_temp3_j_manthly_array2[$i];
        $y_total = (int)$y_total + (int)$past_temp3_y_manthly_array2[$i];
        $o_total = (int)$o_total + (int)$past_temp3_o_manthly_array2[$i];
        if($var == 0){
            $r_per = "---";
            if($past_temp3_j_manthly_array2[$i] == 0){
                $j_per = "---";
            } else {
                    if($past_temp3_j_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp3_j_manthly_array2[$i] <> "" && $total <> ""){
                        $j_per = number_format((floor(($past_temp3_j_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
                    } else {
                        $j_per = "---"; 
                    }
            }
            if($past_temp3_y_manthly_array2[$i] == 0){
                $y_per = "---";
            } else {
                    if($past_temp3_y_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp3_y_manthly_array2[$i] <> "" && $total <> ""){
                        $y_per = number_format((floor(($past_temp3_y_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
                    } else {
                        $y_per = "---"; 
                    }
            }
            if($past_temp3_o_manthly_array2[$i] == 0){
                $o_per = "---";
            } else {
                $o_per = number_format(bcsub('100', ((float)$r_per + (float)$j_per + (float)$o_per), 1) ,1);
            }
        } else {
            if($var <> 0 && $total <> 0 && $var <> "" && $total <> ""){
                $r_per = number_format((floor(($var / $total) * 100 * 10)) / 10 ,1);
            } else {
                $r_per = "---";
            }
            if($past_temp3_j_manthly_array2[$i] == 0){
                $j_per = "---";
            } else {
                    if($past_temp3_j_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp3_j_manthly_array2[$i] <> "" && $total <> ""){
                        $j_per = number_format((floor(($past_temp3_j_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
                    } else {
                        $j_per = "---"; 
                    }
            }
            if($past_temp3_y_manthly_array2[$i] == 0){
                $y_per = "---";
            } else {
                    if($past_temp3_y_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp3_y_manthly_array2[$i] <> "" && $total <> ""){
                        $y_per = number_format((floor(($past_temp3_y_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
                    } else {
                        $y_per = "---"; 
                    }
            }
            if($past_temp3_o_manthly_array2[$i] == 0){
                $o_per = "---";
            } else {
                $o_per = number_format(bcsub('100', ((float)$r_per + (float)$j_per + (float)$y_per), 1) ,1);
            }
        }
        $r_per_html .= "<div class='title7 ta_r'>" . $r_per . "%</div>";
        $j_per_html .= "<div class='title7 ta_r'>" . $j_per . "%</div>";
        $past_r_total_js3  .= (float)$r_per . ", ";
        $past_j_total_js3  .= (float)$j_per . ", ";
        $y_per_html .= "<div class='title7 ta_r'>" . $y_per . "%</div>";
        $past_y_total_js3  .= (float)$y_per . ", ";
        $o_per_html .= "<div class='title7 ta_r'>" . $o_per . "%</div>";
        $past_o_total_js3  .= (float)$o_per . ", ";

        $i++;
    }
    // 期間中の売上合計点数に対するパーセンテージを取得
        if($r_total <> 0 && $total2 <> 0 && $r_total <> "" && $total2 <> ""){
           $r_total_per = number_format((floor(($r_total / $total2) * 100 * 10)) / 10 ,1);
        } else {
            $r_total_per = "---";
        }
        if($j_total <> 0 && $total2 <> 0 && $j_total <> "" && $total2 <> ""){
            $j_total_per = number_format((floor(($j_total / $total2) * 100 * 10)) / 10 ,1);
        } else {
            $j_total_per = "---";
        }
        if($y_total <> 0 && $total2 <> 0 && $y_total <> "" && $total2 <> ""){
            $y_total_per = number_format((floor(($y_total / $total2) * 100 * 10)) / 10 ,1);
        } else {
            $y_total_per = "---";
        }
       $o_total_per = number_format(bcsub('100', ((float)$r_total_per + (float)$j_total_per + (float)$y_total_per), 1) ,1);
       $r_per_html .= "<div class='title7 ta_r'>" . $r_total_per . "%</div>";
       $j_per_html .= "<div class='title7 ta_r'>" . $j_total_per . "%</div>";
       $y_per_html .= "<div class='title7 ta_r'>" . $y_total_per . "%</div>";
       $o_per_html .= "<div class='title7 ta_r'>" . $o_total_per . "%</div>";


    $past_temp3_all_sorce5 = "<p class='title_a'>点数・構成比（過去）</p><div class='box1'>" . $past_temp3_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>自社</div>" . $j_per_html . "</div>";
    $past_temp3_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>楽天</div>" . $r_per_html . "</div>";
    $past_temp3_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ヤフー</div>" . $y_per_html . "</div>";
    $past_temp3_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>その他</div>" . $o_per_html . "</div>";
    $past_temp3_all_sorce5 .= "</div>";

// 過去・平均単価

    $i = 0;
    $r_average = "";
    $r_ave_html = "";
    $r_total = "";
    $r_total2 = "";
    $r_total_ave = "";
    foreach($past_temp3_r_manthly_array as $var){

        if($var == 0){
            $r_average = 0;
            $r_total = (int)$r_total + (int)$var;
            if($past_temp3_r_manthly_array2[$i] == 0){
                $r_total2 = $r_total2;
            } else {
                $r_total2 = (int)$r_total2 + (int)$past_temp3_r_manthly_array2[$i];
            }
        } else {
            if($var <> 0 && $past_temp3_r_manthly_array2[$i] <> 0 && $var <> "" && $past_temp3_r_manthly_array2[$i] <> ""){
                $r_average = (floor(((int)$var / (int)$past_temp3_r_manthly_array2[$i])) * 10) / 10;
            } else {
                $r_average = "---";
            }
            $r_total = (int)$r_total + (int)$var;
            if($past_temp3_r_manthly_array2[$i] == 0){
                $r_total2 = $r_total2;
            } else {
                $r_total2 = (int)$r_total2 + (int)$past_temp3_r_manthly_array2[$i];
            }
        }
        if($r_average <> 0 && $r_average <> ""){$r_average = number_format((int)$r_average);}
        $r_ave_html .= "<div class='title7 ta_r'>" . $r_average . "</div>";

        $i++;
    }
    // 期間中の売上合計に対する平均単価を取得
        if($r_total <> 0 && $r_total2 <> 0 && $r_total <> "" && $r_total2 <> ""){
            $r_total_ave = (floor(($r_total / $r_total2) * 10)) / 10;
        } else {
            $r_total_ave = "---";
        }
        if($r_total_ave <> 0 && $r_total_ave <> ""){$r_total_ave = number_format((int)$r_total_ave);}
        $r_ave_html .= "<div class='title7 ta_r'>" . $r_total_ave . "</div>";

    $i = 0;
    $j_average = "";
    $j_ave_html = "";
    $j_total = "";
    $j_total2 = "";
    $j_total_ave = "";
    foreach($past_temp3_j_manthly_array as $var){

        if($var == 0){
            $j_average = 0;
            $j_total = (int)$j_total + (int)$var;
            if($past_temp3_j_manthly_array2[$i] == 0){
                $j_total2 = $j_total2;
            } else {
                $j_total2 = (int)$j_total2 + (int)$past_temp3_j_manthly_array2[$i];
            }
        } else {
            if($var <> 0 && $past_temp3_j_manthly_array2[$i] <> 0 && $var <> "" && $past_temp3_j_manthly_array2[$i] <> ""){
                $j_average = (floor(((int)$var / (int)$past_temp3_j_manthly_array2[$i])));
            } else {
                $j_average = "---";
            }
            $j_total = (int)$j_total + (int)$var;
            if($past_temp3_j_manthly_array2[$i] == 0){
                $j_total2 = $j_total2;
            } else {
                $j_total2 = (int)$j_total2 + (int)$past_temp3_j_manthly_array2[$i];
            }
        }
        if($j_average <> 0 && $j_average <> ""){$j_average = number_format((int)$j_average);}
        $j_ave_html .= "<div class='title7 ta_r'>" . $j_average . "</div>";

        $i++;
    }
    // 期間中の売上合計に対する平均単価を取得
        if($j_total <> 0 && $j_total2 <> 0 && $j_total <> "" && $j_total2 <> ""){
            $j_total_ave = (floor(((float)$j_total / (float)$j_total2)));
        } else {
            $j_total_ave = "---";
        }
        if($j_total_ave <> 0 && $j_total_ave <> ""){$j_total_ave = number_format((int)$j_total_ave);}
        $j_ave_html .= "<div class='title7 ta_r'>" . $j_total_ave . "</div>";

            $i = 0;
            $y_average = "";
            $y_ave_html = "";
            $y_total = "";
            $y_total2 = "";
            $y_total_ave = "";
            foreach($past_temp3_y_manthly_array as $var){

                if($var == 0){
                    $y_average = 0;
                    $y_total = (int)$y_total + (int)$var;
                    if($past_temp3_y_manthly_array2[$i] == 0){
                        $y_total2 = $y_total2;
                    } else {
                        $y_total2 = (int)$y_total2 + (int)$past_temp3_y_manthly_array2[$i];
                    }
                } else {
                    if($var <> 0 && $past_temp3_y_manthly_array2[$i] <> 0 && $var <> "" && $past_temp3_y_manthly_array2[$i] <> ""){
                        $y_average = (floor(((int)$var / (int)$past_temp3_y_manthly_array2[$i])) * 10) / 10;
                    } else {
                        $y_average = "---";
                    }
                    $y_total = (int)$y_total + (int)$var;
                    if($past_temp3_y_manthly_array2[$i] == 0){
                        $y_total2 = $y_total2;
                    } else {
                        $y_total2 = (int)$y_total2 + (int)$past_temp3_y_manthly_array2[$i];
                    }
                }
                if($y_average <> 0 && $y_average <> ""){$y_average = number_format((int)$y_average);}
                $y_ave_html .= "<div class='title7 ta_r'>" . $y_average . "</div>";

                $i++;
            }
            // 期間中の売上合計に対する平均単価を取得
                if($y_total == 0 || $y_total2 == 0 || $y_total == "" || $y_total2 == ""){
                    $y_total_ave = "---";
                } else {
                    $y_total_ave = (floor(((int)$y_total / (int)$y_total2) * 10)) / 10;
                }

                if($y_total_ave <> 0 && $y_total_ave <> ""){$y_total_ave = number_format((int)$y_total_ave);}
                $y_ave_html .= "<div class='title7 ta_r'>" . $y_total_ave . "</div>";



            $i = 0;
            $o_average = "";
            $o_ave_html = "";
            $o_total = "";
            $o_total2 = "";
            $o_total_ave = "";
            foreach($past_temp3_o_manthly_array as $var){

                if($var == 0){
                    $o_average = 0;
                    $o_total = (int)$o_total + (int)$var;
                    if($past_temp3_o_manthly_array2[$i] == 0){
                        $o_total2 = $o_total2;
                    } else {
                        $o_total2 = (int)$o_total2 + (int)$past_temp3_o_manthly_array2[$i];
                    }
                } else {
                    if($var <> 0 && $past_temp3_o_manthly_array2[$i] <> 0 && $var <> "" && $past_temp3_o_manthly_array2[$i] <> ""){
                        $o_average = (floor(((int)$var / (int)$past_temp3_o_manthly_array2[$i])) * 10) / 10;
                    } else {
                        $o_average = "---";
                    }
                    $o_total = (int)$o_total + (int)$var;
                    if($past_temp3_o_manthly_array2[$i] == 0){
                        $o_total2 = $o_total2;
                    } else {
                        $o_total2 = (int)$o_total2 + (int)$past_temp3_o_manthly_array2[$i];
                    }
                }
                if($o_average <> 0 && $o_average <> ""){$o_average = number_format((int)$o_average);}
                $o_ave_html .= "<div class='title7 ta_r'>" . $o_average . "</div>";

                $i++;
            }
            // 期間中の売上合計に対する平均単価を取得
                if($o_total == 0 || $o_total2 == 0 || $o_total == "" || $o_total2 == ""){
                    $o_total_ave = "---";
                } else {
                    $o_total_ave = (floor(((int)$o_total / (int)$o_total2) * 10)) / 10;
                }

                if($o_total_ave <> 0 && $o_total_ave <> ""){$o_total_ave = number_format((int)$o_total_ave);}
                $o_ave_html .= "<div class='title7 ta_r'>" . $o_total_ave . "</div>";


        $past_temp3_all_sorce6 = "<p class='title_a'>平均単価（過去）</p><div class='box1'>" . $past_temp3_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>自社</div>" . $j_ave_html . "</div>";
        $past_temp3_all_sorce6 .= "<div class='wid100 ul4'><div class='title7 ta_c'>楽天</div>" . $r_ave_html . "</div>";
        $past_temp3_all_sorce6 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ヤフー</div>" . $y_ave_html . "</div>";
        $past_temp3_all_sorce6 .= "<div class='wid100 ul4'><div class='title7 ta_c'>その他</div>" . $o_ave_html . "</div>";
        $past_temp3_all_sorce6 .= "</div>";
    



                                        // 各月の全部門売上合計の先頭（1列目）部分のタイトルHTML
                                            $all_sum_uriage = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $all_sum_number = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $all_sum_arari = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $all_sum_arari_per = "<div class='wid100 ul3'><div class='title5 ta_c'>粗利率(合計)</div>";

                                        // 各月の全部門売上合計を配列に代入
                                            $temp3_all_m_sum_uriage_array = array();
                                            $temp3_all_m_sum_number_array = array();
                                            $temp3_all_m_sum_arari_array = array();
                                            $i = 0;
                                            foreach($manth_now_array as $val){
                                                $all = "";
                                                $all2 = "";
                                                $all3 = "";
                                                $all = (int)$all + (int)$temp3_j_manthly_array[$i]; $all2 = (int)$all2 + (int)$temp3_j_manthly_array2[$i]; $all3 = (int)$all3 + (int)$temp3_j_manthly_array3[$i];
                                                $all = (int)$all + (int)$temp3_r_manthly_array[$i]; $all2 = (int)$all2 + (int)$temp3_r_manthly_array2[$i]; $all3 = (int)$all3 + (int)$temp3_r_manthly_array3[$i];
                                                $all = (int)$all + (int)$temp3_y_manthly_array[$i]; $all2 = (int)$all2 + (int)$temp3_y_manthly_array2[$i]; $all3 = (int)$all3 + (int)$temp3_y_manthly_array3[$i];
                                                $all = (int)$all + (int)$temp3_o_manthly_array[$i]; $all2 = (int)$all2 + (int)$temp3_o_manthly_array2[$i]; $all3 = (int)$all3 + (int)$temp3_o_manthly_array3[$i];

                                                array_push($temp3_all_m_sum_uriage_array,$all);
                                                array_push($temp3_all_m_sum_number_array,$all2);
                                                array_push($temp3_all_m_sum_arari_array,$all3);

                                                $i++;
                                            }
                                        // 各月の全部門売上合計部分のHTML作成
                                            foreach($temp3_all_m_sum_uriage_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $all_sum_uriage .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $all_sum_uriage .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                            }
                                            
                                        // 各月の全部門売上点数合計部分のHTML作成
                                            foreach($temp3_all_m_sum_number_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $all_sum_number .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $all_sum_number .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                            }
                                            
                                        // 各月の全部門粗利合計部分のHTML作成
                                            $i = 0;
                                            $arari_ratio = "";
                                            $all_arari_total = "";
                                            foreach($temp3_all_m_sum_arari_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $all_sum_arari .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $all_sum_arari .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                                // 各月の粗利率を取得
                                                    if($temp3_all_m_sum_uriage_array[$i] == 0){
                                                        $arari_ratio = "---";
                                                    } else {
                                                        $arari_ratio = number_format((floor(((int)$var / (int)$temp3_all_m_sum_uriage_array[$i]) * 100 * 10)) / 10 ,1);
                                                    }
                                                    // 現在・粗利・縦軸合計
                                                        $all_sum_arari_per .= "<div class='title6 ta_r'>" . $arari_ratio . "%</div>";
                                                    // 現在・楽天・自社・ヤフー・合計粗利率（JSグラフ用） 
                                                        $all_arari_total .= (float)$arari_ratio . ", ";

                                                    // 過去・現在の粗利率合計差の計算に使用
                                                        ${"arari_ratio_" . $i} = $arari_ratio;


                                                $i++;
                                            }


                                        // 楽天・自社・ヤフーの各月・粗利率合計を取得
                                            $arati_cutting_total_html = "";
                                            $arari_ratio_cutting = "";
                                            for($a = 0; $a < $i; $a++){
                                                $arati_cutting_total = "";
                                                $arari_ratio_cutting = (float)${"arari_ratio_" . $a} - (float)${"past_arari_ratio_" . $a};
                                                //$arati_cutting_total_html .= "<div class='title7 ta_r'>" . $arari_ratio_cutting . "</div>";
                                                if($arari_ratio_cutting < 0){
                                                    $arati_cutting_total_html .= "<div class='title7 ta_r fc_blue'>" . $arari_ratio_cutting . "%</div>";
                                                } else {
                                                    $arati_cutting_total_html .= "<div class='title7 ta_r fc_red'>" . $arari_ratio_cutting . "%</div>";
                                                }
                                            }
                                        // 楽天・自社・ヤフーの各月合計・粗利率合計を取得
                                                $all_ratio_cutting_ave = (float)$r_ratio_cutting_ave + (float)$j_ratio_cutting_ave + (float)$y_ratio_cutting_ave + (float)$o_ratio_cutting_ave;
                                                //$arati_cutting_total_html .= "<div class='title7 ta_r bg_grey'>" . $all_ratio_cutting_ave . "</div>";
                                                if($all_ratio_cutting_ave < 0){
                                                    $arati_cutting_total_html .= "<div class='title7 ta_r bg_grey fc_blue'>" . $all_ratio_cutting_ave . "%</div>";
                                                } else {
                                                    $arati_cutting_total_html .= "<div class='title7 ta_r bg_grey fc_red'>" . $all_ratio_cutting_ave . "%</div>";
                                                }



                                        $temp3_all_sorce10 = "<p class='title_a'>粗利率・過去比</p><div class='box1'>" . $temp3_title5 . "<div class='wid100 ul4'><div class='title7 ta_c'>自社</div>" . $j_ratio_cutting_html . "</div>";
                                        $temp3_all_sorce10 .= "<div class='wid100 ul4'><div class='title7 ta_c'>楽天</div>" . $r_ratio_cutting_html . "</div>";
                                        $temp3_all_sorce10 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ヤフー</div>" . $y_ratio_cutting_html . "</div>";
                                        $temp3_all_sorce10 .= "<div class='wid100 ul4'><div class='title7 ta_c'>その他</div>" . $o_ratio_cutting_html . "</div>";
                                        $temp3_all_sorce10 .= "<div class='wid100 ul4 bg_grey'><div class='title7 ta_c'>合計</div>" . $arati_cutting_total_html . "</div></div>";

                            
                                        // 全期間全部門売上合計とその平均値のHTML作成
                                            if($all_sum_uriage_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更
                                                            $all_average = (int)$r_sum_uriage_ave2 + (int)$j_sum_uriage_ave2 + (int)$y_sum_uriage_ave2 + (int)$o_sum_uriage_ave2;

                                            } else {
                                                $all_average = 0;            
                                            }
                                            //$all_sum_uriage .= "<div class='title6 ta_r'>" . number_format((int)$all_sum_uriage_all) . "</div><div class='title6 ta_r'>" . $yoy_uriage_sum . "</div><div class='title6 ta_r'>" . number_format((int)$all_average) . "</div></div>";
                                            $all_sum_uriage .= "<div class='title6 ta_r'>" . number_format((int)$all_sum_uriage_all) . "</div><div class='title6 ta_r'>" . number_format((int)$all_average) . "</div></div>";
                                        // 全HTMLを合体（検索対象外は除く）

                                            $view = "";
                                            $view .= $temp3_j_manthly_html;
                                            $view .= $temp3_r_manthly_html;
                                            $view .= $temp3_y_manthly_html;
                                            $view .= $temp3_o_manthly_html;
                                            if($out4_a == "ON" && $out4_b <> "ON"){ $view_title1 = "（免税以外）";} else if($out4_a <> "ON" && $out4_b == "ON"){$view_title1 = "（免税のみ）";} else {$view_title1 = "";}
                                            $temp3_all_sorce = "<p class='title_a'>金額" . $view_title1 . "</p><div class='box1'>" . $temp3_title . $view . $all_sum_uriage . "</div>"/* . $uriage_progress*/;

                                        // 全期間全部門売上点数合計とその平均値のHTML作成
                                            if($all_sum_number_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更

                                                            $all_average2 = (int)$r_sum_number_ave2 + (int)$j_sum_number_ave2 + (int)$y_sum_number_ave2 + (int)$o_sum_number_ave2;
                                            } else {
                                                $all_average2 = 0;
                                            }
                                            //$all_sum_number .= "<div class='title6 ta_r'>" . number_format((int)$all_sum_number_all) . "</div><div class='title6 ta_r'>" . $yoy_number_sum . "</div><div class='title6 ta_r'>" . number_format((int)$all_average2) . "</div></div>";
                                            $all_sum_number .= "<div class='title6 ta_r'>" . number_format((int)$all_sum_number_all) . "</div><div class='title6 ta_r'>" . number_format((int)$all_average2) . "</div></div>";
                                        // 全HTMLを合体（検索対象外は除く）
                                        
                                            $view2 = "";
                                            $view2 .= $temp3_j_manthly_html2;
                                            $view2 .= $temp3_r_manthly_html2;
                                            $view2 .= $temp3_y_manthly_html2;
                                            $view2 .= $temp3_o_manthly_html2;
                                            $temp3_all_sorce2 = "<p class='title_a'>点数" . $view_title1 . "</p><div class='box1'>" . $temp3_title . $view2 . $all_sum_number . "</div>"/* . $number_progress*/;
                                        // 全期間全部門粗利合計とその平均値のHTML作成
                                            if($all_sum_arari_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更
                                                            $all_average3 = (int)$r_sum_arari_ave2 + (int)$j_sum_arari_ave2 + (int)$y_sum_arari_ave2 + (int)$o_sum_arari_ave2;
                                            } else {
                                                
                                                $all_average3 = 0;
                                            }
                                            //$all_sum_arari .= "<div class='title6 ta_r'>" . number_format((int)$all_sum_arari_all) . "</div><div class='title6 ta_r'>" . $yoy_arari_sum . "</div><div class='title6 ta_r'>" . number_format((int)$all_average3) . "</div></div>";
                                            $all_sum_arari .= "<div class='title6 ta_r'>" . number_format((int)$all_sum_arari_all) . "</div><div class='title6 ta_r'>" . number_format((int)$all_average3) . "</div></div>";
                                            // 粗利率の平均
                                                if($all_sum_arari_all <> 0){ $all_average4 = number_format(floor(((int)$all_sum_arari_all / (int)$all_sum_uriage_all) * 100 * 10) / 10 ,1);} else {$all_average4 = 0;}
                                                $all_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $all_average4 . "%</div></div>";
                                        // 全HTMLを合体（検索対象外は除く）
                                        
                                            $view3 = "";
                                            $view3 .= $temp3_j_manthly_html3;
                                            $view3 .= $temp3_r_manthly_html3;
                                            $view3 .= $temp3_y_manthly_html3;
                                            $view3 .= $temp3_o_manthly_html3;
                                            $temp3_all_sorce3 = "<p class='title_a'>粗利" . $view_title1 . "</p><div class='box1'>" . $temp3_title . $view3 . $all_sum_arari . $j_sum_arari_per . $r_sum_arari_per;
                                            $temp3_all_sorce3 .= $y_sum_arari_per;
                                            $temp3_all_sorce3 .= $o_sum_arari_per;
                                            $temp3_all_sorce3 .= $all_sum_arari_per  . "</div>"/* . $arari_progress*/;


                    /************************************************************************************************************************************************************************************************************* */
                        // DB情報の受け取り（検索期間） end
                    /************************************************************************************************************************************************************************************************************* */

                        // JSで表示させるための、期間売上などのデータを作成                    
                            $js_j_uriage = substr($js_j_uriage, 0, -2);
                            $js_r_uriage = substr($js_r_uriage, 0, -2);
                            $js_y_uriage = substr($js_y_uriage, 0, -2);
                            $js_o_uriage = substr($js_o_uriage, 0, -2);
                            //if($js_month <> ""){$js_month = substr($js_month, 0, -1);} else {$js_month = "";}
                        // 列の横幅を列数によって可変させる
                            $line_width = 100 / ($diff_month + 4);
                            // 20230803
                            $line_width2 = 100 / ($diff_month + 1);

                            
                            if (PostRequest::has('brand_bumon_select')){ $brand_bumon_select = PostRequest::input('brand_bumon_select');} else {$brand_bumon_select = "";}
                            if (PostRequest::has('view_select')){ $view_select = PostRequest::input('view_select');} else {$view_select = "";}
                            return view($bladename,['view_select' => $view_select,'brand_bumon_select' => $brand_bumon_select,'first_day' => $first_day,'last_day' => $last_day,'next_year' => $next_year,'this_year' => $this_year,'last_year' => $last_year,'two_years_ago' => $two_years_ago,'three_years_ago' => $three_years_ago,'start_year' => $start_year,'start_month' => $start_month,'start_day' => $start_day,'end_year' => $end_year,'end_month' => $end_month,'end_day' => $end_day,'output' => $output,'form_view' => $form_view,'out1' => $out1,'out1_a' => $out1_a,'out1_b' => $out1_b,'out1_c' => $out1_c,'out1_d' => $out1_d,'out2_a' => $out2_a,'out2_b' => $out2_b,'out2_c' => $out2_c,'out2_d' => $out2_d,'out2_e' => $out2_e,'out3_a' => $out3_a,'out3_b' => $out3_b,'out3_c' => $out3_c,'out3_d' => $out3_d,'out3_e' => $out3_e,'out3_f' => $out3_f,'out4_a' => $out4_a,'out4_b' => $out4_b,'temp3_all_sorce' => $temp3_all_sorce,'temp3_all_sorce2' => $temp3_all_sorce2,'js_r_uriage' => $js_r_uriage,'js_j_uriage' => $js_j_uriage,'js_y_uriage' => $js_y_uriage,'js_o_uriage' => $js_o_uriage,'js_month' => $js_month,'past_between_start' => $past_between_start,'past_between_end' => $past_between_end,'past_temp3_all_sorce' => $past_temp3_all_sorce,'past_temp3_all_sorce2' => $past_temp3_all_sorce2,'past_js_r_uriage' => $past_js_r_uriage,'past_js_j_uriage' => $past_js_j_uriage,'past_js_y_uriage' => $past_js_y_uriage,'past_js_o_uriage' => $past_js_o_uriage,'past_js_r_number' => $past_js_r_number,'past_js_j_number' => $past_js_j_number,'past_js_y_number' => $past_js_y_number,'past_js_o_number' => $past_js_o_number,'js_r_number' => $js_r_number,'js_j_number' => $js_j_number,'js_y_number' => $js_y_number,'js_o_number' => $js_o_number,'js_all_month_uriage' => $js_all_month_uriage,'js_past_all_month_uriage' => $js_past_all_month_uriage,'js_all_month_number' => $js_all_month_number,'js_past_all_month_number' => $js_past_all_month_number,'js_r_arari' => $js_r_arari,'js_j_arari' => $js_j_arari,'js_y_arari' => $js_y_arari,'js_o_arari' => $js_o_arari,'js_all_month_arari' => $js_all_month_arari,'past_js_r_arari' => $past_js_r_arari,'past_js_j_arari' => $past_js_j_arari,'past_js_y_arari' => $past_js_y_arari,'past_js_o_arari' => $past_js_o_arari,'js_past_all_month_arari' => $js_past_all_month_arari,'temp3_all_sorce3' => $temp3_all_sorce3,'past_temp3_all_sorce3' => $past_temp3_all_sorce3,'search' => $search,'line_width' => $line_width,'line_width2' => $line_width2,'out5' => $out5,'out5_a' => $out5_a,'out5_b' => $out5_b,'out5_c' => $out5_c,'temp3_all_sorce4' => $temp3_all_sorce4,'temp3_all_sorce5' => $temp3_all_sorce5,'temp3_all_sorce6' => $temp3_all_sorce6,'temp3_all_sorce7' => $temp3_all_sorce7,'temp3_all_sorce8' => $temp3_all_sorce8,'temp3_all_sorce9' => $temp3_all_sorce9,'temp3_all_sorce10' => $temp3_all_sorce10,'past_temp3_all_sorce4' => $past_temp3_all_sorce4,'past_temp3_all_sorce5' => $past_temp3_all_sorce5,'past_temp3_all_sorce6' => $past_temp3_all_sorce6,'r_total_js' => $r_total_js,'j_total_js' => $j_total_js,'y_total_js' => $y_total_js,'o_total_js' => $o_total_js,'all_arari_total' => $all_arari_total,'past_r_total_js' => $past_r_total_js,'past_j_total_js' => $past_j_total_js,'past_y_total_js' => $past_y_total_js,'past_o_total_js' => $past_o_total_js,'past_all_arari_total' => $past_all_arari_total,'r_total_js2' => $r_total_js2,'j_total_js2' => $j_total_js2,'y_total_js2' => $y_total_js2,'o_total_js2' => $o_total_js2,'past_r_total_js2' => $past_r_total_js2,'past_j_total_js2' => $past_j_total_js2,'past_y_total_js2' => $past_y_total_js2,'past_o_total_js2' => $past_o_total_js2,'r_total_js3' => $r_total_js3,'j_total_js3' => $j_total_js3,'y_total_js3' => $y_total_js3,'o_total_js3' => $o_total_js3,'past_r_total_js3' => $past_r_total_js3,'past_j_total_js3' => $past_j_total_js3,'past_y_total_js3' => $past_y_total_js3,'past_o_total_js3' => $past_o_total_js3,'out6' => $out6,'out7' => $out7,'uriage_progress_html' => $uriage_progress_html,'number_progress_html' => $number_progress_html,'arari_progress_html' => $arari_progress_html]);





    
    }


/************************************************************************************************************************************************************************************************************* */
    // DB情報取得（[売上]扱い部門用）
/************************************************************************************************************************************************************************************************************* */


        public function db_info_get3($a,$b,$c,$d,$e,$f,$g,$h,$j,$k,$l,$m,$n,$o,$p,$q,$r,$s,$t,$u,$v,$w){

            // 「groupBy」にロジックで作成した名称を指定した際のエラー対応（本番だとDB上のカラムに無い名称を「groupBy」するとエラーとなる。このエラーの場合selectに名称指定すると解決するらしいが、恐らくDBに無い名称だと別のエラーとなる。以下の二行を追記する事で対応）
                    config(['database.connections.mysql.strict' => false]);
                    DB::reconnect();

                    $start_year = $a;
                    $start_month = $b;
                    $start_day = $c;
                    $end_year = $d;
                    $end_month = $e;
                    $end_day = $f;
                    $this_year = $g;
                    $last_year = $h;
                    $two_years_ago = $j;
                    $output = $k;
                    $out1 = $l;
                    $out2 = $m;
                    $out3 = $n;
                    $out4 = $o;
                    $out5 = $p;
                    $search = $q;
                    $three_years_ago = $r;
                    $next_year = $s;
                    $first_day = $t;
                    $last_day = $u;
                    $out6 = $v;
                    $out7 = $w;


                ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                // DB登録ロジックを実施
                ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                    
                        /************************************************************************************************************************************************************************************************************* */
                            // 定数管理用（メソッドの呼び出し）start
                        /************************************************************************************************************************************************************************************************************* */
                                $define = $this->define();
                                $def_i = 0;
                                // 各変数にパスやファイル名を代入
                                    foreach($define as $def){
                                        if($def_i == 0){ $bladename = $def; }
                                        if($def_i == 1){ $file_pass = $def; }
                                        if($def_i == 2){ $file_pass2 = $def; }
                                        if($def_i == 3){ $file_name = $def; }
                                        if($def_i == 4){ $table_name = $def; }

                                        $def_i++;
                                    }
                        /************************************************************************************************************************************************************************************************************* */
                            // 定数管理用（メソッドの呼び出し）end
                        /************************************************************************************************************************************************************************************************************* */
                    
                        /************************************************************************************************************************************************************************************************************* */
                            // フォームボタン押下時情報の受け取り start
                        /************************************************************************************************************************************************************************************************************* */

                                // 検索期間を変数に代入
                                    $between_start = $start_year . "/" . $start_month . "/" . $start_day ." 00-00:00";
                                    $between_end = $end_year . "/" . $end_month . "/" . $end_day ." 23-59:59";
                                    $between_start_view = $start_year . "/" . $start_month . "/" . $start_day;
                                    $between_end_view = $end_year . "/" . $end_month . "/" . $end_day;

                                    $diff_start1 = new DateTime($between_start_view);
                                    $diff_end1 = new DateTime($between_end_view);

                                    $interval1 = $diff_end1 -> diff($diff_start1);

                                    $diff_year1= $interval1 -> y;
                                    $diff_month1 = $interval1 -> m;
                                    $diff_month1 = $diff_year1 * 12 + $diff_month1;

                                // 「フォーム表示ボタン」フラグ
                                    if (PostRequest::has('form_view')) {
                                        $form_view = PostRequest::input('form_view');
                                    } else {$form_view = "OFF";}
                                

                                // 「売却区分」フラグ
                                    $out1_a = "OFF";
                                    $out1_b = "OFF";
                                    $out1_c = "OFF";
                                    $out1_d = "OFF";
                                    if($out1 <> "" && in_array('2',$out1)){ $out1_a = "ON";}
                                    if($out1 <> "" && in_array('3',$out1)){ $out1_b = "ON";}
                                    if($out1 <> "" && in_array('4',$out1)){ $out1_c = "ON";}
                                    if($out1 <> "" && in_array('5',$out1)){ $out1_d = "ON";}
                                    
                                // 新中アンフラグ
                                    $out2_a = "OFF";
                                    $out2_b = "OFF";
                                    $out2_c = "OFF";
                                    $out2_d = "OFF";
                                    $out2_e = "OFF";
                                    if($out2 <> "" && in_array('1',$out2)){ $out2_a = "ON";}
                                    if($out2 <> "" && in_array('2',$out2)){ $out2_b = "ON";}
                                    if($out2 <> "" && in_array('3',$out2)){ $out2_c = "ON";}
                                    if($out2 <> "" && in_array('4',$out2)){ $out2_d = "ON";}
                                    if($out2 <> "" && in_array('5',$out2)){ $out2_e = "ON";}

                                // 通販サイトフラグ
                                    $out3_a = "OFF";
                                    $out3_b = "OFF";
                                    $out3_c = "OFF";
                                    $out3_d = "OFF";
                                    $out3_e = "OFF";
                                    $out3_f = "OFF";
                                    if($out3 <> "" && in_array('1',$out3)){ $out3_a = "ON";}
                                    if($out3 <> "" && in_array('2',$out3)){ $out3_b = "ON";}
                                    if($out3 <> "" && in_array('3',$out3)){ $out3_c = "ON";}
                                    if($out3 <> "" && in_array('4',$out3)){ $out3_d = "ON";}
                                    if($out3 <> "" && in_array('5',$out3)){ $out3_e = "ON";}
                                    if($out3 <> "" && in_array('6',$out3)){ $out3_f = "ON";}
                                    
                                // 免税フラグ
                                    $out4_a = "OFF";
                                    $out4_b = "OFF";
                                    if($out4 <> "" && in_array('1',$out4)){ $out4_a = "ON";}
                                    if($out4 <> "" && in_array('2',$out4)){ $out4_b = "ON";}
                                    
                                // ブランドフラグ
                                    $out5_a = "OFF";
                                    $out5_b = "OFF";
                                    $out5_c = "OFF";
                                    if($out5 <> "" && in_array('2',$out5)){ $out5_a = "ON";}
                                    if($out5 <> "" && in_array('3',$out5)){ $out5_b = "ON";}
                                    if($out5 <> "" && in_array('4',$out5)){ $out5_c = "ON";}


                        /************************************************************************************************************************************************************************************************************* */
                            // フォームボタン押下時情報の受け取り end
                        /************************************************************************************************************************************************************************************************************* */


                        /************************************************************************************************************************************************************************************************************* */
                            // 検索期間の月数だけ遡った過去の期間を取得 start
                        /************************************************************************************************************************************************************************************************************* */

                                // 開始と終了期間の差分（～カ月）を取得                        
                                    $start = $start_year . "-" . $start_month . "-" . $start_day;
                                    $end = $end_year . "-" . $end_month . "-" . $end_day;
                                    $diff_start = new DateTime($start);
                                    $diff_end = new DateTime($end);

                                    $interval = $diff_end -> diff($diff_start);

                                    $diff_year = $interval -> y;
                                    $diff_month = $interval -> m;
                                    $diff_month = $diff_year * 12 + $diff_month;
                                    //echo $diff_month . "カ月<br>";
                                // 差分の月だけ遡った過去の期間を取得
                                    // 検索開始日                
                                        $start_now = date($start_year. "-" . $start_month. "-" . $start_day);
                                    // 過去開始日
                                        //$start_past = date("Y-m-d", strtotime($start_now . " -" . $diff_month . " month"));
                                        $past_between_start = date("Y-m-d", strtotime($start_now . " -" . ($diff_month + 1) . " month"));
                                        $past_between_start_view = date("Y-m", strtotime($start_now . " -" . ($diff_month +1) . " month"));
                                    // 検索終了日
                                        $end_now = date($end_year. "-" . $end_month. "-" . $end_day);
                                    // 過去終了日
                                        //$end_past = date("Y-m-d", strtotime($end_now . " -" . $diff_month . " month"));
                                        $past_between_end = date("Y-m-d", strtotime($start_now . " -1 day"));
                                        $past_between_end_view = date("Y-m", strtotime($start_now . " -1 month"));

                                    // 過去期間の月初日を配列へ代入（該当月のデータ登録が無い場合、JS代入値が空になってグラフがズレてしまう事を回避するため0代入ロジックに使う）
                                        // 配列版
                                            $manth_now_array = array();
                                            $manth_past_array = array();
                                        // カンマ区切りの文字列版
                                            $temp4_jn_manthly_data = "";
                                            $temp4_jn_manthly_data2 = "";
                                            $temp4_jn_manthly_data3 = "";
                                            $past_temp4_jn_manthly_data = "";
                                            $past_temp4_jn_manthly_data2 = "";
                                            $past_temp4_jn_manthly_data3 = "";
                                            $temp4_ju_manthly_data = "";
                                            $temp4_ju_manthly_data2 = "";
                                            $temp4_ju_manthly_data3 = "";
                                            $past_temp4_ju_manthly_data = "";
                                            $past_temp4_ju_manthly_data2 = "";
                                            $past_temp4_ju_manthly_data3 = "";
                                            $temp4_ja_manthly_data = "";
                                            $temp4_ja_manthly_data2 = "";
                                            $temp4_ja_manthly_data3 = "";
                                            $past_temp4_ja_manthly_data = "";
                                            $past_temp4_ja_manthly_data2 = "";
                                            $past_temp4_ja_manthly_data3 = "";
                                            
                                            $temp4_bn_manthly_data = "";
                                            $temp4_bn_manthly_data2 = "";
                                            $temp4_bn_manthly_data3 = "";
                                            $past_temp4_bn_manthly_data = "";
                                            $past_temp4_bn_manthly_data2 = "";
                                            $past_temp4_bn_manthly_data3 = "";
                                            $temp4_bu_manthly_data = "";
                                            $temp4_bu_manthly_data2 = "";
                                            $temp4_bu_manthly_data3 = "";
                                            $past_temp4_bu_manthly_data = "";
                                            $past_temp4_bu_manthly_data2 = "";
                                            $past_temp4_bu_manthly_data3 = "";
                                            $temp4_ba_manthly_data = "";
                                            $temp4_ba_manthly_data2 = "";
                                            $temp4_ba_manthly_data3 = "";
                                            $past_temp4_ba_manthly_data = "";
                                            $past_temp4_ba_manthly_data2 = "";
                                            $past_temp4_ba_manthly_data3 = "";
                                            
                                            $temp4_jln_manthly_data = "";
                                            $temp4_jln_manthly_data2 = "";
                                            $temp4_jln_manthly_data3 = "";
                                            $past_temp4_jln_manthly_data = "";
                                            $past_temp4_jln_manthly_data2 = "";
                                            $past_temp4_jln_manthly_data3 = "";
                                            $temp4_jlu_manthly_data = "";
                                            $temp4_jlu_manthly_data2 = "";
                                            $temp4_jlu_manthly_data3 = "";
                                            $past_temp4_jlu_manthly_data = "";
                                            $past_temp4_jlu_manthly_data2 = "";
                                            $past_temp4_jlu_manthly_data3 = "";
                                            $temp4_jla_manthly_data = "";
                                            $temp4_jla_manthly_data2 = "";
                                            $temp4_jla_manthly_data3 = "";
                                            $past_temp4_jla_manthly_data = "";
                                            $past_temp4_jla_manthly_data2 = "";
                                            $past_temp4_jla_manthly_data3 = "";
                                            
                                            $temp4_bgn_manthly_data = "";
                                            $temp4_bgn_manthly_data2 = "";
                                            $temp4_bgn_manthly_data3 = "";
                                            $past_temp4_bgn_manthly_data = "";
                                            $past_temp4_bgn_manthly_data2 = "";
                                            $past_temp4_bgn_manthly_data3 = "";
                                            $temp4_bgu_manthly_data = "";
                                            $temp4_bgu_manthly_data2 = "";
                                            $temp4_bgu_manthly_data3 = "";
                                            $past_temp4_bgu_manthly_data = "";
                                            $past_temp4_bgu_manthly_data2 = "";
                                            $past_temp4_bgu_manthly_data3 = "";
                                            
                                            
                                        for($past_ii = 0;  $past_ii <= $diff_month; $past_ii++){
                                            if($past_ii == 0){
                                                // 現在用
                                                    $manth_now = date("Y-m", strtotime($start_now));
                                                // 過去用
                                                    $past_manth = $past_between_start;
                                                    $past_manth2 = mb_substr($past_between_start,0,-3);
                                            } else {
                                                // 現在用
                                                    $manth_now = date("Y-m", strtotime($manth_now . " 1 month"));
                                                // 過去用
                                                    $past_manth = date("Y-m-d", strtotime($past_manth . " 1 month"));
                                                    $past_manth2 = date("Y-m", strtotime($past_manth2 . " 1 month"));
                                            }
                                            // 現在用
                                                array_push($manth_now_array,$manth_now);
                                            // 過去用
                                                array_push($manth_past_array,$past_manth);
                                                $temp4_jn_manthly_data .= $manth_now . ",";
                                                $temp4_jn_manthly_data2 .= $manth_now . ",";
                                                $temp4_jn_manthly_data3 .= $manth_now . ",";
                                                $past_temp4_jn_manthly_data .= $past_manth2 . ",";
                                                $past_temp4_jn_manthly_data2 .= $past_manth2 . ",";
                                                $past_temp4_jn_manthly_data3 .= $past_manth2 . ",";
                                                $temp4_ju_manthly_data .= $manth_now . ",";
                                                $temp4_ju_manthly_data2 .= $manth_now . ",";
                                                $temp4_ju_manthly_data3 .= $manth_now . ",";
                                                $past_temp4_ju_manthly_data .= $past_manth2 . ",";
                                                $past_temp4_ju_manthly_data2 .= $past_manth2 . ",";
                                                $past_temp4_ju_manthly_data3 .= $past_manth2 . ",";
                                                $temp4_ja_manthly_data .= $manth_now . ",";
                                                $temp4_ja_manthly_data2 .= $manth_now . ",";
                                                $temp4_ja_manthly_data3 .= $manth_now . ",";
                                                $past_temp4_ja_manthly_data .= $past_manth2 . ",";
                                                $past_temp4_ja_manthly_data2 .= $past_manth2 . ",";
                                                $past_temp4_ja_manthly_data3 .= $past_manth2 . ",";
                                                
                                                $temp4_bn_manthly_data .= $manth_now . ",";
                                                $temp4_bn_manthly_data2 .= $manth_now . ",";
                                                $temp4_bn_manthly_data3 .= $manth_now . ",";
                                                $past_temp4_bn_manthly_data .= $past_manth2 . ",";
                                                $past_temp4_bn_manthly_data2 .= $past_manth2 . ",";
                                                $past_temp4_bn_manthly_data3 .= $past_manth2 . ",";
                                                $temp4_bu_manthly_data .= $manth_now . ",";
                                                $temp4_bu_manthly_data2 .= $manth_now . ",";
                                                $temp4_bu_manthly_data3 .= $manth_now . ",";
                                                $past_temp4_bu_manthly_data .= $past_manth2 . ",";
                                                $past_temp4_bu_manthly_data2 .= $past_manth2 . ",";
                                                $past_temp4_bu_manthly_data3 .= $past_manth2 . ",";
                                                $temp4_ba_manthly_data .= $manth_now . ",";
                                                $temp4_ba_manthly_data2 .= $manth_now . ",";
                                                $temp4_ba_manthly_data3 .= $manth_now . ",";
                                                $past_temp4_ba_manthly_data .= $past_manth2 . ",";
                                                $past_temp4_ba_manthly_data2 .= $past_manth2 . ",";
                                                $past_temp4_ba_manthly_data3 .= $past_manth2 . ",";
                                            
                                                $temp4_jln_manthly_data .= $manth_now . ",";
                                                $temp4_jln_manthly_data2 .= $manth_now . ",";
                                                $temp4_jln_manthly_data3 .= $manth_now . ",";
                                                $past_temp4_jln_manthly_data .= $past_manth2 . ",";
                                                $past_temp4_jln_manthly_data2 .= $past_manth2 . ",";
                                                $past_temp4_jln_manthly_data3 .= $past_manth2 . ",";
                                                $temp4_jlu_manthly_data .= $manth_now . ",";
                                                $temp4_jlu_manthly_data2 .= $manth_now . ",";
                                                $temp4_jlu_manthly_data3 .= $manth_now . ",";
                                                $past_temp4_jlu_manthly_data .= $past_manth2 . ",";
                                                $past_temp4_jlu_manthly_data2 .= $past_manth2 . ",";
                                                $past_temp4_jlu_manthly_data3 .= $past_manth2 . ",";
                                                
                                                $temp4_bgn_manthly_data .= $manth_now . ",";
                                                $temp4_bgn_manthly_data2 .= $manth_now . ",";
                                                $temp4_bgn_manthly_data3 .= $manth_now . ",";
                                                $past_temp4_bgn_manthly_data .= $past_manth2 . ",";
                                                $past_temp4_bgn_manthly_data2 .= $past_manth2 . ",";
                                                $past_temp4_bgn_manthly_data3 .= $past_manth2 . ",";
                                                
                                                $temp4_bgu_manthly_data .= $manth_now . ",";
                                                $temp4_bgu_manthly_data2 .= $manth_now . ",";
                                                $temp4_bgu_manthly_data3 .= $manth_now . ",";
                                                $past_temp4_bgu_manthly_data .= $past_manth2 . ",";
                                                $past_temp4_bgu_manthly_data2 .= $past_manth2 . ",";
                                                $past_temp4_bgu_manthly_data3 .= $past_manth2 . ",";
                                                
                                                

                                        }
                                        $temp4_jn_manthly_data = trim($temp4_jn_manthly_data ,",");
                                        $temp4_jn_manthly_data2 = trim($temp4_jn_manthly_data2 ,",");
                                        $temp4_jn_manthly_data3 = trim($temp4_jn_manthly_data3 ,",");
                                        $past_temp4_jn_manthly_data = trim($past_temp4_jn_manthly_data ,",");
                                        $past_temp4_jn_manthly_data2 = trim($past_temp4_jn_manthly_data2 ,",");
                                        $past_temp4_jn_manthly_data3 = trim($past_temp4_jn_manthly_data3 ,",");
                                        $temp4_ju_manthly_data = trim($temp4_ju_manthly_data ,",");
                                        $temp4_ju_manthly_data2 = trim($temp4_ju_manthly_data2 ,",");
                                        $temp4_ju_manthly_data3 = trim($temp4_ju_manthly_data3 ,",");
                                        $past_temp4_ju_manthly_data = trim($past_temp4_ju_manthly_data ,",");
                                        $past_temp4_ju_manthly_data2 = trim($past_temp4_ju_manthly_data2 ,",");
                                        $past_temp4_ju_manthly_data3 = trim($past_temp4_ju_manthly_data3 ,",");
                                        $temp4_ja_manthly_data = trim($temp4_ja_manthly_data ,",");
                                        $temp4_ja_manthly_data2 = trim($temp4_ja_manthly_data2 ,",");
                                        $temp4_ja_manthly_data3 = trim($temp4_ja_manthly_data3 ,",");
                                        $past_temp4_ja_manthly_data = trim($past_temp4_ja_manthly_data ,",");
                                        $past_temp4_ja_manthly_data2 = trim($past_temp4_ja_manthly_data2 ,",");
                                        $past_temp4_ja_manthly_data3 = trim($past_temp4_ja_manthly_data3 ,",");
                                        
                                        $temp4_bn_manthly_data = trim($temp4_bn_manthly_data ,",");
                                        $temp4_bn_manthly_data2 = trim($temp4_bn_manthly_data2 ,",");
                                        $temp4_bn_manthly_data3 = trim($temp4_bn_manthly_data3 ,",");
                                        $past_temp4_bn_manthly_data = trim($past_temp4_bn_manthly_data ,",");
                                        $past_temp4_bn_manthly_data2 = trim($past_temp4_bn_manthly_data2 ,",");
                                        $past_temp4_bn_manthly_data3 = trim($past_temp4_bn_manthly_data3 ,",");
                                        $temp4_bu_manthly_data = trim($temp4_bu_manthly_data ,",");
                                        $temp4_bu_manthly_data2 = trim($temp4_bu_manthly_data2 ,",");
                                        $temp4_bu_manthly_data3 = trim($temp4_bu_manthly_data3 ,",");
                                        $past_temp4_bu_manthly_data = trim($past_temp4_bu_manthly_data ,",");
                                        $past_temp4_bu_manthly_data2 = trim($past_temp4_bu_manthly_data2 ,",");
                                        $past_temp4_bu_manthly_data3 = trim($past_temp4_bu_manthly_data3 ,",");
                                        $temp4_ba_manthly_data = trim($temp4_bu_manthly_data ,",");
                                        $temp4_ba_manthly_data2 = trim($temp4_ba_manthly_data2 ,",");
                                        $temp4_ba_manthly_data3 = trim($temp4_ba_manthly_data3 ,",");
                                        $past_temp4_ba_manthly_data = trim($past_temp4_ba_manthly_data ,",");
                                        $past_temp4_ba_manthly_data2 = trim($past_temp4_ba_manthly_data2 ,",");
                                        $past_temp4_ba_manthly_data3 = trim($past_temp4_ba_manthly_data3 ,",");
                                        
                                        $temp4_jln_manthly_data = trim($temp4_jln_manthly_data ,",");
                                        $temp4_jln_manthly_data2 = trim($temp4_jln_manthly_data2 ,",");
                                        $temp4_jln_manthly_data3 = trim($temp4_jln_manthly_data3 ,",");
                                        $past_temp4_jln_manthly_data = trim($past_temp4_jln_manthly_data ,",");
                                        $past_temp4_jln_manthly_data2 = trim($past_temp4_jln_manthly_data2 ,",");
                                        $past_temp4_jln_manthly_data3 = trim($past_temp4_jln_manthly_data3 ,",");
                                        $temp4_jlu_manthly_data = trim($temp4_jlu_manthly_data ,",");
                                        $temp4_jlu_manthly_data2 = trim($temp4_jlu_manthly_data2 ,",");
                                        $temp4_jlu_manthly_data3 = trim($temp4_jlu_manthly_data3 ,",");
                                        $past_temp4_jlu_manthly_data = trim($past_temp4_jlu_manthly_data ,",");
                                        $past_temp4_jlu_manthly_data2 = trim($past_temp4_jlu_manthly_data2 ,",");
                                        $past_temp4_jlu_manthly_data3 = trim($past_temp4_jlu_manthly_data3 ,",");
                                        
                                        $temp4_bgn_manthly_data = trim($temp4_bgn_manthly_data ,",");
                                        $temp4_bgn_manthly_data2 = trim($temp4_bgn_manthly_data2 ,",");
                                        $temp4_bgn_manthly_data3 = trim($temp4_bgn_manthly_data3 ,",");
                                        $past_temp4_bgn_manthly_data = trim($past_temp4_bgn_manthly_data ,",");
                                        $past_temp4_bgn_manthly_data2 = trim($past_temp4_bgn_manthly_data2 ,",");
                                        $past_temp4_bgn_manthly_data3 = trim($past_temp4_bgn_manthly_data3 ,",");
                                        $temp4_bgu_manthly_data = trim($temp4_bgu_manthly_data ,",");
                                        $temp4_bgu_manthly_data2 = trim($temp4_bgu_manthly_data2 ,",");
                                        $temp4_bgu_manthly_data3 = trim($temp4_bgu_manthly_data3 ,",");
                                        $past_temp4_bgu_manthly_data = trim($past_temp4_bgu_manthly_data ,",");
                                        $past_temp4_bgu_manthly_data2 = trim($past_temp4_bgu_manthly_data2 ,",");
                                        $past_temp4_bgu_manthly_data3 = trim($past_temp4_bgu_manthly_data3 ,",");


                        /************************************************************************************************************************************************************************************************************* */
                            // 検索期間の月数だけ遡った過去の期間を取得 end
                        /************************************************************************************************************************************************************************************************************* */
                        
                    

                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                // 当月の最終日
                                    $last_day2 = date('Y-m-d', strtotime('last day of' . $last_day));
                                // データ格納最終日がその月の最終日と一致するか否かでフラグを作成（一致しない場合は平均の計算に含めないようにするため）
                                    if($last_day2 <> $last_day){ $last_nodata_flag = "ON"; } else { $last_nodata_flag = "OFF"; }




                        /************************************************************************************************************************************************************************************************************* */
                            // 進捗率用ロジック start
                        /************************************************************************************************************************************************************************************************************* */


                                                // 【進捗率の取得】
                                                                            

                                                        /************************************************************************************************************************************************************************************************************* */
                                                            // 検索期間の最初の日を求める（最終データ格納月の月初日）start
                                                        /************************************************************************************************************************************************************************************************************* */
                                                                    $last_day_array = explode('-',$last_day);
                                                                    $i = 0;
                                                                    $last_day_top = "";
                                                                    foreach($last_day_array as $var){
                                                                        // 年月
                                                                            if($i <> 2){
                                                                                $last_day_top .= $var . "-";
                                                                            }
                                                                        // 年
                                                                            if($i == 0){
                                                                                $last_year_last = $var;
                                                                            }
                                                                        // 月
                                                                            if($i == 1){
                                                                                $last_month_last = $var;
                                                                            }
                                                                        // 日
                                                                            if($i == 2){
                                                                                $last_day_last = $var;
                                                                            }
                                                                        $i++;
                                                                    }
                                                                    // 年月に月初日を加える
                                                                        $last_day_top .= "01";
                                                                    // 当月の最終日
                                                                        $last_day_last2 = date("d", strtotime($last_day_top . " +1 month -1day"));

                                                        /************************************************************************************************************************************************************************************************************* */
                                                            // 検索期間の最初の日を求める（最終データ格納月の月初日）end
                                                        /************************************************************************************************************************************************************************************************************* */

                                                        /************************************************************************************************************************************************************************************************************* */
                                                            // 比較年月取得（最終データ格納年月の先月） start
                                                        /************************************************************************************************************************************************************************************************************* */
                                                                // 先月初日
                                                                    $last_month_top = date("Y-m-d", strtotime($last_day_top . " -1 month"));
                                                                // 先月最終日
                                                                    $last_month = date("Y-m-d", strtotime($last_day_top . " -1day"));
                                                        
                                                        /************************************************************************************************************************************************************************************************************* */
                                                            // 比較年月取得（最終データ格納年月の先月） end
                                                        /************************************************************************************************************************************************************************************************************* */

                                                        /************************************************************************************************************************************************************************************************************* */
                                                            // 比較年月取得（最終データ格納年月から検索期間の月数だけ遡った年月） start
                                                        /************************************************************************************************************************************************************************************************************* */

                                                                // 差分の月だけ遡った過去の期間を取得
                                                                    // 過去開始日（最終データ格納年月から検索期間を遡った年月日を取得）
                                                                        $past_between_start_progress = date("Y-m-d", strtotime($last_day_top . " -" . ($diff_month + 1) . " month"));
                                                                    // 過去終了日（上記年月日の月末日を取得）
                                                                        $past_between_end_progress = date("Y-m-d", strtotime($past_between_start_progress . " +1 month -1day"));
                                                        
                                                        /************************************************************************************************************************************************************************************************************* */
                                                            // 比較年月取得（最終データ格納年月から検索期間の月数だけ遡った年月） end
                                                        /************************************************************************************************************************************************************************************************************* */


                                                                        
                                                                            
                                                        /************************************************************************************************************************************************************************************************************* */
                                                            // 最終データ格納月のデータ取得　start
                                                        /************************************************************************************************************************************************************************************************************* */


                                                                            // DB検索（ジャック・N）スタート
                                                                                    $jn_progress = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS jn_month'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS jn_uriage"),
                                                                                            \DB::raw("SUM(uriagesuu) AS jn_number"),
                                                                                            \DB::raw("SUM(ararikingaku) AS jn_arari"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$last_day_top, $last_day])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%新品%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Jackroad')

                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $jn_sum_uriage_progress = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($jn_progress as $jn_buy_progress) {
                                                                                                    // 各月卸売上
                                                                                                    $jn_sum_uriage_progress = $jn_buy_progress -> jn_uriage;
                                                                                                    $jn_sum_number_progress = $jn_buy_progress -> jn_number;
                                                                                                    $jn_sum_arari_progress = $jn_buy_progress -> jn_arari;
                                                                                                    $i2++;
                                                                                                }




                                                                            // DB検索（ジャック・U）スタート
                                                                                    $ju_progress = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS ju_month'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS ju_uriage"),
                                                                                            \DB::raw("SUM(uriagesuu) AS ju_number"),
                                                                                            \DB::raw("SUM(ararikingaku) AS ju_arari"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$last_day_top, $last_day])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%中古%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Jackroad')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $ju_sum_uriage_progress = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($ju_progress as $ju_buy_progress) {
                                                                                                    // 各月卸売上
                                                                                                    $ju_sum_uriage_progress = $ju_buy_progress -> ju_uriage;
                                                                                                    $ju_sum_number_progress = $ju_buy_progress -> ju_number;
                                                                                                    $ju_sum_arari_progress = $ju_buy_progress -> ju_arari;
                                                                                                    $i2++;
                                                                                                }



                                                                            // DB検索（ジャック・A）スタート
                                                                                    $ja_progress = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS ja_month'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS ja_uriage"),
                                                                                            \DB::raw("SUM(uriagesuu) AS ja_number"),
                                                                                            \DB::raw("SUM(ararikingaku) AS ja_arari"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$last_day_top, $last_day])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%アンティーク%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Jackroad')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $ja_sum_uriage_progress = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($ja_progress as $ja_buy_progress) {
                                                                                                    // 各月卸売上
                                                                                                    $ja_sum_uriage_progress = $ja_buy_progress -> ja_uriage;
                                                                                                    $ja_sum_number_progress = $ja_buy_progress -> ja_number;
                                                                                                    $ja_sum_arari_progress = $ja_buy_progress -> ja_arari;
                                                                                                    $i2++;
                                                                                                }





                                                                            // DB検索（ベティー・N）スタート
                                                                                    $bn_progress = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS bn_month'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS bn_uriage"),
                                                                                            \DB::raw("SUM(uriagesuu) AS bn_number"),
                                                                                            \DB::raw("SUM(ararikingaku) AS bn_arari"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$last_day_top, $last_day])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%新品%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Bettyroad')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $bn_sum_uriage_progress = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($bn_progress as $bn_buy_progress) {
                                                                                                    // 各月卸売上
                                                                                                    $bn_sum_uriage_progress = $bn_buy_progress -> bn_uriage;
                                                                                                    $bn_sum_number_progress = $bn_buy_progress -> bn_number;
                                                                                                    $bn_sum_arari_progress = $bn_buy_progress -> bn_arari;
                                                                                                    $i2++;
                                                                                                }



                                                                            // DB検索（ベティー・U）スタート
                                                                                    $bu_progress = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS bu_month'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS bu_uriage"),
                                                                                            \DB::raw("SUM(uriagesuu) AS bu_number"),
                                                                                            \DB::raw("SUM(ararikingaku) AS bu_arari"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$last_day_top, $last_day])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%中古%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Bettyroad')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $bu_sum_uriage_progress = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($bu_progress as $bu_buy_progress) {
                                                                                                    // 各月卸売上
                                                                                                    $bu_sum_uriage_progress = $bu_buy_progress -> bu_uriage;
                                                                                                    $bu_sum_number_progress = $bu_buy_progress -> bu_number;
                                                                                                    $bu_sum_arari_progress = $bu_buy_progress -> bu_arari;
                                                                                                    $i2++;
                                                                                                }



                                                                            // DB検索（ベティー・A）スタート
                                                                                    $ba_progress = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS ba_month'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS ba_uriage"),
                                                                                            \DB::raw("SUM(uriagesuu) AS ba_number"),
                                                                                            \DB::raw("SUM(ararikingaku) AS ba_arari"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$last_day_top, $last_day])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%アンティーク%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Bettyroad')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $ba_sum_uriage_progress = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($ba_progress as $ba_buy_progress) {
                                                                                                    // 各月卸売上
                                                                                                    $ba_sum_uriage_progress = $ba_buy_progress -> ba_uriage;
                                                                                                    $ba_sum_number_progress = $ba_buy_progress -> ba_number;
                                                                                                    $ba_sum_arari_progress = $ba_buy_progress -> ba_arari;
                                                                                                    $i2++;
                                                                                                }


                                                                                                
                                                                            // DB検索（ｼﾞｭｴﾘｰ新品）スタート
                                                                                    $jln_progress = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS jln_month'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS jln_uriage"),
                                                                                            \DB::raw("SUM(uriagesuu) AS jln_number"),
                                                                                            \DB::raw("SUM(ararikingaku) AS jln_arari"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$last_day_top, $last_day])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%ｼﾞｭｴﾘｰ新品%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Jewelry')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $jln_sum_uriage_progress = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($jln_progress as $jln_buy_progress) {
                                                                                                    // 各月卸売上
                                                                                                    $jln_sum_uriage_progress = $jln_buy_progress -> jln_uriage;
                                                                                                    $jln_sum_number_progress = $jln_buy_progress -> jln_number;
                                                                                                    $jln_sum_arari_progress = $jln_buy_progress -> jln_arari;
                                                                                                    $i2++;
                                                                                                }



                                                                            // DB検索（ｼﾞｭｴﾘｰ中古）スタート
                                                                                    $jlu_progress = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS jlu_month'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS jlu_uriage"),
                                                                                            \DB::raw("SUM(uriagesuu) AS jlu_number"),
                                                                                            \DB::raw("SUM(ararikingaku) AS jlu_arari"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$last_day_top, $last_day])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%ｼﾞｭｴﾘｰ中古%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Jewelry')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $jlu_sum_uriage_progress = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($jlu_progress as $jlu_buy_progress) {
                                                                                                    // 各月卸売上
                                                                                                    $jlu_sum_uriage_progress = $jlu_buy_progress -> jlu_uriage;
                                                                                                    $jlu_sum_number_progress = $jlu_buy_progress -> jlu_number;
                                                                                                    $jlu_sum_arari_progress = $jlu_buy_progress -> jlu_arari;
                                                                                                    $i2++;
                                                                                                }





                                                                            // DB検索（ﾊﾞｯｸﾞ新品）スタート
                                                                                    $bgn_progress = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS bgn_month'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS bgn_uriage"),
                                                                                            \DB::raw("SUM(uriagesuu) AS bgn_number"),
                                                                                            \DB::raw("SUM(ararikingaku) AS bgn_arari"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$last_day_top, $last_day])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%ﾊﾞｯｸﾞ新品%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Jewelry')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $bgn_sum_uriage_progress = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($bgn_progress as $bgn_buy_progress) {
                                                                                                    // 各月卸売上
                                                                                                    $bgn_sum_uriage_progress = $bgn_buy_progress -> bgn_uriage;
                                                                                                    $bgn_sum_number_progress = $bgn_buy_progress -> bgn_number;
                                                                                                    $bgn_sum_arari_progress = $bgn_buy_progress -> bgn_arari;
                                                                                                    $i2++;
                                                                                                }



                                                                            // DB検索（ﾊﾞｯｸﾞ中古）スタート
                                                                                    $bgu_progress = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS bgu_month'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS bgu_uriage"),
                                                                                            \DB::raw("SUM(uriagesuu) AS bgu_number"),
                                                                                            \DB::raw("SUM(ararikingaku) AS bgu_arari"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$last_day_top, $last_day])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%ﾊﾞｯｸﾞ中古%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Jewelry')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $bgu_sum_uriage_progress = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($bgu_progress as $bgu_buy_progress) {
                                                                                                    // 各月卸売上
                                                                                                    $bgu_sum_uriage_progress = $bgu_buy_progress -> bgu_uriage;
                                                                                                    $bgu_sum_number_progress = $bgu_buy_progress -> bgu_number;
                                                                                                    $bgu_sum_arari_progress = $bgu_buy_progress -> bgu_arari;
                                                                                                    $i2++;
                                                                                                }


                                                        /************************************************************************************************************************************************************************************************************* */
                                                            // 最終データ格納月のデータ取得　end
                                                        /************************************************************************************************************************************************************************************************************* */


                                                        /************************************************************************************************************************************************************************************************************* */
                                                            // 先月のデータ取得（最終データ格納年月比) start
                                                        /************************************************************************************************************************************************************************************************************* */


                                                                            // DB検索（ジャック・N）スタート
                                                                                    $jn_progress2 = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS jn_month2'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS jn_uriage2"),
                                                                                            \DB::raw("SUM(uriagesuu) AS jn_number2"),
                                                                                            \DB::raw("SUM(ararikingaku) AS jn_arari2"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$last_month_top, $last_month])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%新品%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Jackroad')

                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $jn_sum_uriage_progress2 = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($jn_progress2 as $jn_buy_progress2) {
                                                                                                    // 各月卸売上
                                                                                                    $jn_sum_uriage_progress2 = $jn_buy_progress2 -> jn_uriage2;
                                                                                                    $jn_sum_number_progress2 = $jn_buy_progress2 -> jn_number2;
                                                                                                    $jn_sum_arari_progress2 = $jn_buy_progress2 -> jn_arari2;
                                                                                                    $i2++;
                                                                                                }




                                                                            // DB検索（ジャック・U）スタート
                                                                                    $ju_progress2 = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS ju_month2'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS ju_uriage2"),
                                                                                            \DB::raw("SUM(uriagesuu) AS ju_number2"),
                                                                                            \DB::raw("SUM(ararikingaku) AS ju_arari2"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$last_month_top, $last_month])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%中古%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Jackroad')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $ju_sum_uriage_progress2 = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($ju_progress2 as $ju_buy_progress2) {
                                                                                                    // 各月卸売上
                                                                                                    $ju_sum_uriage_progress2 = $ju_buy_progress2 -> ju_uriage2;
                                                                                                    $ju_sum_number_progress2 = $ju_buy_progress2 -> ju_number2;
                                                                                                    $ju_sum_arari_progress2 = $ju_buy_progress2 -> ju_arari2;
                                                                                                    $i2++;
                                                                                                }



                                                                            // DB検索（ジャック・A）スタート
                                                                                    $ja_progress2 = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS ja_month2'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS ja_uriage2"),
                                                                                            \DB::raw("SUM(uriagesuu) AS ja_number2"),
                                                                                            \DB::raw("SUM(ararikingaku) AS ja_arari2"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$last_month_top, $last_month])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%アンティーク%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Jackroad')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $ja_sum_uriage_progress2 = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($ja_progress2 as $ja_buy_progress2) {
                                                                                                    // 各月卸売上
                                                                                                    $ja_sum_uriage_progress2 = $ja_buy_progress2 -> ja_uriage2;
                                                                                                    $ja_sum_number_progress2 = $ja_buy_progress2 -> ja_number2;
                                                                                                    $ja_sum_arari_progress2 = $ja_buy_progress2 -> ja_arari2;
                                                                                                    $i2++;
                                                                                                }





                                                                            // DB検索（ベティー・N）スタート
                                                                                    $bn_progress2 = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS bn_month2'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS bn_uriage2"),
                                                                                            \DB::raw("SUM(uriagesuu) AS bn_number2"),
                                                                                            \DB::raw("SUM(ararikingaku) AS bn_arari2"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$last_month_top, $last_month])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%新品%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Bettyroad')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $bn_sum_uriage_progress2 = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($bn_progress2 as $bn_buy_progress2) {
                                                                                                    // 各月卸売上
                                                                                                    $bn_sum_uriage_progress2 = $bn_buy_progress2 -> bn_uriage2;
                                                                                                    $bn_sum_number_progress2 = $bn_buy_progress2 -> bn_number2;
                                                                                                    $bn_sum_arari_progress2 = $bn_buy_progress2 -> bn_arari2;
                                                                                                    $i2++;
                                                                                                }



                                                                            // DB検索（ベティー・U）スタート
                                                                                    $bu_progress2 = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS bu_month2'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS bu_uriage2"),
                                                                                            \DB::raw("SUM(uriagesuu) AS bu_number2"),
                                                                                            \DB::raw("SUM(ararikingaku) AS bu_arari2"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$last_month_top, $last_month])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%中古%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Bettyroad')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $bu_sum_uriage_progress2 = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($bu_progress2 as $bu_buy_progress2) {
                                                                                                    // 各月卸売上
                                                                                                    $bu_sum_uriage_progress2 = $bu_buy_progress2 -> bu_uriage2;
                                                                                                    $bu_sum_number_progress2 = $bu_buy_progress2 -> bu_number2;
                                                                                                    $bu_sum_arari_progress2 = $bu_buy_progress2 -> bu_arari2;
                                                                                                    $i2++;
                                                                                                }



                                                                            // DB検索（ベティー・A）スタート
                                                                                    $ba_progress2 = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS ba_month2'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS ba_uriage2"),
                                                                                            \DB::raw("SUM(uriagesuu) AS ba_number2"),
                                                                                            \DB::raw("SUM(ararikingaku) AS ba_arari2"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$last_month_top, $last_month])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%アンティーク%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Bettyroad')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $ba_sum_uriage_progress2 = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($ba_progress2 as $ba_buy_progress2) {
                                                                                                    // 各月卸売上
                                                                                                    $ba_sum_uriage_progress2 = $ba_buy_progress2 -> ba_uriage2;
                                                                                                    $ba_sum_number_progress2 = $ba_buy_progress2 -> ba_number2;
                                                                                                    $ba_sum_arari_progress2 = $ba_buy_progress2 -> ba_arari2;
                                                                                                    $i2++;
                                                                                                }


                                                                                                
                                                                            // DB検索（ｼﾞｭｴﾘｰ新品）スタート
                                                                                    $jln_progress2 = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS jln_month2'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS jln_uriage2"),
                                                                                            \DB::raw("SUM(uriagesuu) AS jln_number2"),
                                                                                            \DB::raw("SUM(ararikingaku) AS jln_arari2"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$last_month_top, $last_month])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%ｼﾞｭｴﾘｰ新品%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Jewelry')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $jln_sum_uriage_progress2 = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($jln_progress2 as $jln_buy_progress2) {
                                                                                                    // 各月卸売上
                                                                                                    $jln_sum_uriage_progress2 = $jln_buy_progress2 -> jln_uriage2;
                                                                                                    $jln_sum_number_progress2 = $jln_buy_progress2 -> jln_number2;
                                                                                                    $jln_sum_arari_progress2 = $jln_buy_progress2 -> jln_arari2;
                                                                                                    $i2++;
                                                                                                }



                                                                            // DB検索（ｼﾞｭｴﾘｰ中古）スタート
                                                                                    $jlu_progress2 = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS jlu_month2'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS jlu_uriage2"),
                                                                                            \DB::raw("SUM(uriagesuu) AS jlu_number2"),
                                                                                            \DB::raw("SUM(ararikingaku) AS jlu_arari2"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$last_month_top, $last_month])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%ｼﾞｭｴﾘｰ中古%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Jewelry')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $jlu_sum_uriage_progress2 = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($jlu_progress2 as $jlu_buy_progress2) {
                                                                                                    // 各月卸売上
                                                                                                    $jlu_sum_uriage_progress2 = $jlu_buy_progress2 -> jlu_uriage2;
                                                                                                    $jlu_sum_number_progress2 = $jlu_buy_progress2 -> jlu_number2;
                                                                                                    $jlu_sum_arari_progress2 = $jlu_buy_progress2 -> jlu_arari2;
                                                                                                    $i2++;
                                                                                                }





                                                                            // DB検索（ﾊﾞｯｸﾞ新品）スタート
                                                                                    $bgn_progress2 = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS bgn_month2'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS bgn_uriage2"),
                                                                                            \DB::raw("SUM(uriagesuu) AS bgn_number2"),
                                                                                            \DB::raw("SUM(ararikingaku) AS bgn_arari2"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$last_month_top, $last_month])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%ﾊﾞｯｸﾞ新品%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Jewelry')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $bgn_sum_uriage_progress2 = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($bgn_progress2 as $bgn_buy_progress2) {
                                                                                                    // 各月卸売上
                                                                                                    $bgn_sum_uriage_progress2 = $bgn_buy_progress2 -> bgn_uriage2;
                                                                                                    $bgn_sum_number_progress2 = $bgn_buy_progress2 -> bgn_number2;
                                                                                                    $bgn_sum_arari_progress2 = $bgn_buy_progress2 -> bgn_arari2;
                                                                                                    $i2++;
                                                                                                }



                                                                            // DB検索（ﾊﾞｯｸﾞ中古）スタート
                                                                                    $bgu_progress2 = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS bgu_month2'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS bgu_uriage2"),
                                                                                            \DB::raw("SUM(uriagesuu) AS bgu_number2"),
                                                                                            \DB::raw("SUM(ararikingaku) AS bgu_arari2"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$last_month_top, $last_month])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%ﾊﾞｯｸﾞ中古%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Jewelry')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $bgu_sum_uriage_progress2 = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($bgu_progress2 as $bgu_buy_progress2) {
                                                                                                    // 各月卸売上
                                                                                                    $bgu_sum_uriage_progress2 = $bgu_buy_progress2 -> bgu_uriage2;
                                                                                                    $bgu_sum_number_progress2 = $bgu_buy_progress2 -> bgu_number2;
                                                                                                    $bgu_sum_arari_progress2 = $bgu_buy_progress2 -> bgu_arari2;
                                                                                                    $i2++;
                                                                                                }
                                                        


                                                        /************************************************************************************************************************************************************************************************************* */
                                                            // 先月のデータ取得（最終データ格納年月比) end
                                                        /************************************************************************************************************************************************************************************************************* */


                                                        /************************************************************************************************************************************************************************************************************* */
                                                            // 検索期間の月数だけ遡った年月のデータ取得（最終データ格納年月比) start
                                                        /************************************************************************************************************************************************************************************************************* */
                                                        
                                                        
                                                                            // DB検索（ジャック・N）スタート
                                                                                    $jn_progress3 = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS jn_month3'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS jn_uriage3"),
                                                                                            \DB::raw("SUM(uriagesuu) AS jn_number3"),
                                                                                            \DB::raw("SUM(ararikingaku) AS jn_arari3"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$past_between_start_progress, $past_between_end_progress])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%新品%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Jackroad')

                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $jn_sum_uriage_progress3 = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($jn_progress3 as $jn_buy_progress3) {
                                                                                                    // 各月卸売上
                                                                                                    $jn_sum_uriage_progress3 = $jn_buy_progress3 -> jn_uriage3;
                                                                                                    $jn_sum_number_progress3 = $jn_buy_progress3 -> jn_number3;
                                                                                                    $jn_sum_arari_progress3 = $jn_buy_progress3 -> jn_arari3;
                                                                                                    $i2++;
                                                                                                }




                                                                            // DB検索（ジャック・U）スタート
                                                                                    $ju_progress3 = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS ju_month3'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS ju_uriage3"),
                                                                                            \DB::raw("SUM(uriagesuu) AS ju_number3"),
                                                                                            \DB::raw("SUM(ararikingaku) AS ju_arari3"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$past_between_start_progress, $past_between_end_progress])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%中古%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Jackroad')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $ju_sum_uriage_progress3 = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($ju_progress3 as $ju_buy_progress3) {
                                                                                                    // 各月卸売上
                                                                                                    $ju_sum_uriage_progress3 = $ju_buy_progress3 -> ju_uriage3;
                                                                                                    $ju_sum_number_progress3 = $ju_buy_progress3 -> ju_number3;
                                                                                                    $ju_sum_arari_progress3 = $ju_buy_progress3 -> ju_arari3;
                                                                                                    $i2++;
                                                                                                }



                                                                            // DB検索（ジャック・A）スタート
                                                                                    $ja_progress3 = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS ja_month3'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS ja_uriage3"),
                                                                                            \DB::raw("SUM(uriagesuu) AS ja_number3"),
                                                                                            \DB::raw("SUM(ararikingaku) AS ja_arari3"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$past_between_start_progress, $past_between_end_progress])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%アンティーク%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Jackroad')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $ja_sum_uriage_progress3 = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($ja_progress3 as $ja_buy_progress3) {
                                                                                                    // 各月卸売上
                                                                                                    $ja_sum_uriage_progress3 = $ja_buy_progress3 -> ja_uriage3;
                                                                                                    $ja_sum_number_progress3 = $ja_buy_progress3 -> ja_number3;
                                                                                                    $ja_sum_arari_progress3 = $ja_buy_progress3 -> ja_arari3;
                                                                                                    $i2++;
                                                                                                }





                                                                            // DB検索（ベティー・N）スタート
                                                                                    $bn_progress3 = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS bn_month3'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS bn_uriage3"),
                                                                                            \DB::raw("SUM(uriagesuu) AS bn_number3"),
                                                                                            \DB::raw("SUM(ararikingaku) AS bn_arari3"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$past_between_start_progress, $past_between_end_progress])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%新品%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Bettyroad')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $bn_sum_uriage_progress3 = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($bn_progress3 as $bn_buy_progress3) {
                                                                                                    // 各月卸売上
                                                                                                    $bn_sum_uriage_progress3 = $bn_buy_progress3 -> bn_uriage3;
                                                                                                    $bn_sum_number_progress3 = $bn_buy_progress3 -> bn_number3;
                                                                                                    $bn_sum_arari_progress3 = $bn_buy_progress3 -> bn_arari3;
                                                                                                    $i2++;
                                                                                                }



                                                                            // DB検索（ベティー・U）スタート
                                                                                    $bu_progress3 = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS bu_month3'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS bu_uriage3"),
                                                                                            \DB::raw("SUM(uriagesuu) AS bu_number3"),
                                                                                            \DB::raw("SUM(ararikingaku) AS bu_arari3"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$past_between_start_progress, $past_between_end_progress])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%中古%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Bettyroad')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $bu_sum_uriage_progress3 = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($bu_progress3 as $bu_buy_progress3) {
                                                                                                    // 各月卸売上
                                                                                                    $bu_sum_uriage_progress3 = $bu_buy_progress3 -> bu_uriage3;
                                                                                                    $bu_sum_number_progress3 = $bu_buy_progress3 -> bu_number3;
                                                                                                    $bu_sum_arari_progress3 = $bu_buy_progress3 -> bu_arari3;
                                                                                                    $i2++;
                                                                                                }



                                                                            // DB検索（ベティー・A）スタート
                                                                                    $ba_progress3 = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS ba_month3'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS ba_uriage3"),
                                                                                            \DB::raw("SUM(uriagesuu) AS ba_number3"),
                                                                                            \DB::raw("SUM(ararikingaku) AS ba_arari3"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$past_between_start_progress, $past_between_end_progress])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%アンティーク%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Bettyroad')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $ba_sum_uriage_progress3 = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($ba_progress3 as $ba_buy_progress3) {
                                                                                                    // 各月卸売上
                                                                                                    $ba_sum_uriage_progress3 = $ba_buy_progress3 -> ba_uriage3;
                                                                                                    $ba_sum_number_progress3 = $ba_buy_progress3 -> ba_number3;
                                                                                                    $ba_sum_arari_progress3 = $ba_buy_progress3 -> ba_arari3;
                                                                                                    $i2++;
                                                                                                }


                                                                                                
                                                                            // DB検索（ｼﾞｭｴﾘｰ新品）スタート
                                                                                    $jln_progress3 = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS jln_month3'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS jln_uriage3"),
                                                                                            \DB::raw("SUM(uriagesuu) AS jln_number3"),
                                                                                            \DB::raw("SUM(ararikingaku) AS jln_arari3"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$past_between_start_progress, $past_between_end_progress])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%ｼﾞｭｴﾘｰ新品%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Jewelry')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $jln_sum_uriage_progress3 = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($jln_progress3 as $jln_buy_progress3) {
                                                                                                    // 各月卸売上
                                                                                                    $jln_sum_uriage_progress3 = $jln_buy_progress3 -> jln_uriage3;
                                                                                                    $jln_sum_number_progress3 = $jln_buy_progress3 -> jln_number3;
                                                                                                    $jln_sum_arari_progress3 = $jln_buy_progress3 -> jln_arari3;
                                                                                                    $i2++;
                                                                                                }



                                                                            // DB検索（ｼﾞｭｴﾘｰ中古）スタート
                                                                                    $jlu_progress3 = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS jlu_month3'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS jlu_uriage3"),
                                                                                            \DB::raw("SUM(uriagesuu) AS jlu_number3"),
                                                                                            \DB::raw("SUM(ararikingaku) AS jlu_arari3"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$past_between_start_progress, $past_between_end_progress])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%ｼﾞｭｴﾘｰ中古%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Jewelry')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $jlu_sum_uriage_progress3 = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($jlu_progress3 as $jlu_buy_progress3) {
                                                                                                    // 各月卸売上
                                                                                                    $jlu_sum_uriage_progress3 = $jlu_buy_progress3 -> jlu_uriage3;
                                                                                                    $jlu_sum_number_progress3 = $jlu_buy_progress3 -> jlu_number3;
                                                                                                    $jlu_sum_arari_progress3 = $jlu_buy_progress3 -> jlu_arari3;
                                                                                                    $i2++;
                                                                                                }





                                                                            // DB検索（ﾊﾞｯｸﾞ新品）スタート
                                                                                    $bgn_progress3 = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS bgn_month3'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS bgn_uriage3"),
                                                                                            \DB::raw("SUM(uriagesuu) AS bgn_number3"),
                                                                                            \DB::raw("SUM(ararikingaku) AS bgn_arari3"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$past_between_start_progress, $past_between_end_progress])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%ﾊﾞｯｸﾞ新品%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Jewelry')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $bgn_sum_uriage_progress3 = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($bgn_progress3 as $bgn_buy_progress3) {
                                                                                                    // 各月卸売上
                                                                                                    $bgn_sum_uriage_progress3 = $bgn_buy_progress3 -> bgn_uriage3;
                                                                                                    $bgn_sum_number_progress3 = $bgn_buy_progress3 -> bgn_number3;
                                                                                                    $bgn_sum_arari_progress3 = $bgn_buy_progress3 -> bgn_arari3;
                                                                                                    $i2++;
                                                                                                }



                                                                            // DB検索（ﾊﾞｯｸﾞ中古）スタート
                                                                                    $bgu_progress3 = DB::table($table_name) 
                                                                                    // 月毎にグループ化して値を分けるための処理
                                                                                        ->select([
                                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS bgu_month3'),
                                                                                            \DB::raw("SUM(uriagekingaku) AS bgu_uriage3"),
                                                                                            \DB::raw("SUM(uriagesuu) AS bgu_number3"),
                                                                                            \DB::raw("SUM(ararikingaku) AS bgu_arari3"),
                                                                                        ])
                                                                                        // 条件（売上部門の指定）
                                                                                            ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {
                                    
                                                                                                // 条件（売上部門が店舗）
                                                                                                    if($out1_a == "ON"){
                                                                                                        $query->orWhere('baikyakukubun', 1);
                                                                                                    }
                                                                                                // 条件（売上部門が通販）
                                                                                                    if($out1_b == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',2);
                                                                                                    }
                                                                                                // 条件（売上部門が卸）
                                                                                                    if($out1_c == "ON"){
                                                                                                        $query->orWhere('baikyakukubun',3);
                                                                                                    }
                                                                                                // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                                                    if($out1_d == "ON"){
                                                                                                        $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                                                    }
                                                                                        
                                                                                            })

                                                                                        // 条件（期間の指定）
                                                                                            ->whereBetween($table_name . '.uriage', [$past_between_start_progress, $past_between_end_progress])
                                                                                            
                                                                                        // 条件（分類名）
                                                                                            ->where("shouhinkubunbunruimei","like","%ﾊﾞｯｸﾞ中古%")
                                                                                        // 条件（通販区分）
                                                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                                                                $query->orWhere('tsuuhankubun','');
                                    
                                                                                                // 条件（通販区分が自社）
                                                                                                    if($out3_a == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',1);
                                                                                                    }
                                                                                                // 条件（通販区分が楽天）
                                                                                                    if($out3_b == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',2);
                                                                                                    }
                                                                                                // 条件（通販区分がヤフー）
                                                                                                    if($out3_c == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',3);
                                                                                                    }
                                                                                                // 条件（通販区分が電話・雑誌）
                                                                                                    if($out3_d == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',5);
                                                                                                    }
                                                                                                // 条件（通販区分がYオークション）
                                                                                                    if($out3_e == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',4);
                                                                                                    }
                                                                                                // 条件（通販区分が修理品返送）
                                                                                                    if($out3_f == "ON"){
                                                                                                        $query->orWhere('tsuuhankubun',9);
                                                                                                    }
                                    
                                                                                            })
                                
                                                                                        // 条件（免税）
                                                                                            ->where(function ($query) use ($out4_a,$out4_b) {
                                                                                                    // 条件（免税区分が0:対象外）
                                                                                                        if($out4_a == "ON"){
                                                                                                            $query->orwhere("menzei","like","%対象外%");
                                                                                                        }
                                                                                                    // 条件（免税区分が1:免税）
                                                                                                        if($out4_b == "ON"){
                                                                                                            $query->orwhere("menzei","like","%免税%");
                                                                                                        }
                                                                                            })
                                                                                        // 条件（扱い部門）
                                                                                            ->Where('bumonmei','Jewelry')
                                                                                        // ソート順指定
                                                                                            ->orderBy('uriage', 'asc')
                                                                                            ->get();
                                                                                        // クエリビルダスタート
                                                                                            // 変数リセット
                                                                                                $bgu_sum_uriage_progress3 = "";
                                                                                                $i2 = 0;
                                                                                                foreach ($bgu_progress3 as $bgu_buy_progress3) {
                                                                                                    // 各月卸売上
                                                                                                    $bgu_sum_uriage_progress3 = $bgu_buy_progress3 -> bgu_uriage3;
                                                                                                    $bgu_sum_number_progress3 = $bgu_buy_progress3 -> bgu_number3;
                                                                                                    $bgu_sum_arari_progress3 = $bgu_buy_progress3 -> bgu_arari3;
                                                                                                    $i2++;
                                                                                                }
                                                        
                                                        
                                                        
                                                        /************************************************************************************************************************************************************************************************************* */
                                                            // 検索期間の月数だけ遡った年月のデータ取得（最終データ格納年月比) end
                                                        /************************************************************************************************************************************************************************************************************* */



                                                        /************************************************************************************************************************************************************************************************************* */
                                                            // 各月間予測値と過去比を取得 start
                                                        /************************************************************************************************************************************************************************************************************* */
                                                        
                                                        
                                                                // 予測値
                                                                        // ジャック新品・月間売上額予測
                                                                        if($jn_sum_uriage_progress <> "" && $jn_sum_uriage_progress <> 0){
                                                                            $jn_sum_uriage_progress_pre = (float)((int)$jn_sum_uriage_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $jn_sum_uriage_progress_pre = "";
                                                                        }
                                                                    // ジャック新品・月間売上点数予測
                                                                        if($jn_sum_number_progress <> "" && $jn_sum_number_progress <> 0){
                                                                            $jn_sum_number_progress_pre = (float)((int)$jn_sum_number_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $jn_sum_number_progress_pre = "";
                                                                        }
                                                                    // ジャック新品・月間売上粗利予測
                                                                        if($jn_sum_arari_progress <> "" && $jn_sum_arari_progress <> 0){
                                                                            $jn_sum_arari_progress_pre = (float)((int)$jn_sum_arari_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $jn_sum_arari_progress_pre = "";
                                                                        }
                                                                    // ジャック中古・月間売上額予測
                                                                        if($ju_sum_uriage_progress <> "" && $ju_sum_uriage_progress <> 0){
                                                                            $ju_sum_uriage_progress_pre = (float)((int)$ju_sum_uriage_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $ju_sum_uriage_progress_pre = "";
                                                                        }
                                                                    // ジャック中古・月間売上点数予測
                                                                        if($ju_sum_number_progress <> "" && $ju_sum_number_progress <> 0){
                                                                            $ju_sum_number_progress_pre = (float)((int)$ju_sum_number_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $ju_sum_number_progress_pre = "";
                                                                        }
                                                                    // ジャック中古・月間売上粗利予測
                                                                        if($ju_sum_arari_progress <> "" && $ju_sum_arari_progress <> 0){
                                                                            $ju_sum_arari_progress_pre = (float)((int)$ju_sum_arari_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $ju_sum_arari_progress_pre = "";
                                                                        }
                                                                    // ジャックアンティーク・月間売上額予測
                                                                        if($ja_sum_uriage_progress <> "" && $ja_sum_uriage_progress <> 0){
                                                                            $ja_sum_uriage_progress_pre = (float)((int)$ja_sum_uriage_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $ja_sum_uriage_progress_pre = "";
                                                                        }
                                                                    // ジャックアンティーク・月間売上点数予測
                                                                        if($ja_sum_number_progress <> "" && $ja_sum_number_progress <> 0){
                                                                            $ja_sum_number_progress_pre = (float)((int)$ja_sum_number_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $ja_sum_number_progress_pre = "";
                                                                        }
                                                                    // ジャックアンティーク・月間売上粗利予測
                                                                        if($ja_sum_arari_progress <> "" && $ja_sum_arari_progress <> 0){
                                                                            $ja_sum_arari_progress_pre = (float)((int)$ja_sum_arari_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $ja_sum_arari_progress_pre = "";
                                                                        }
                                                                        

                                                                    // ベティー新品・月間売上額予測
                                                                        if($bn_sum_uriage_progress <> "" && $bn_sum_uriage_progress <> 0){
                                                                            $bn_sum_uriage_progress_pre = (float)((int)$bn_sum_uriage_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $bn_sum_uriage_progress_pre = "";
                                                                        }
                                                                    // ベティー新品・月間売上点数予測
                                                                        if($bn_sum_number_progress <> "" && $bn_sum_number_progress <> 0){
                                                                            $bn_sum_number_progress_pre = (float)((int)$bn_sum_number_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $bn_sum_number_progress_pre = "";
                                                                        }
                                                                    // ベティー新品・月間売上粗利予測
                                                                        if($bn_sum_arari_progress <> "" && $bn_sum_arari_progress <> 0){
                                                                            $bn_sum_arari_progress_pre = (float)((int)$bn_sum_arari_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $bn_sum_arari_progress_pre = "";
                                                                        }
                                                                    // ベティー中古・月間売上額予測
                                                                        if($bu_sum_uriage_progress <> "" && $bu_sum_uriage_progress <> 0){
                                                                            $bu_sum_uriage_progress_pre = (float)((int)$bu_sum_uriage_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $bu_sum_uriage_progress_pre = "";
                                                                        }
                                                                    // ベティー中古・月間売上点数予測
                                                                        if($bu_sum_number_progress <> "" && $bu_sum_number_progress <> 0){
                                                                            $bu_sum_number_progress_pre = (float)((int)$bu_sum_number_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $bu_sum_number_progress_pre = "";
                                                                        }
                                                                    // ベティー中古・月間売上粗利予測
                                                                        if($bu_sum_arari_progress <> "" && $bu_sum_arari_progress <> 0){
                                                                            $bu_sum_arari_progress_pre = (float)((int)$bu_sum_arari_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $bu_sum_arari_progress_pre = "";
                                                                        }
                                                                    // ベティーアンティーク・月間売上額予測
                                                                        if($ba_sum_uriage_progress <> "" && $ba_sum_uriage_progress <> 0){
                                                                            $ba_sum_uriage_progress_pre = (float)((int)$ba_sum_uriage_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $ba_sum_uriage_progress_pre = "";
                                                                        }
                                                                    // ベティーアンティーク・月間売上点数予測
                                                                        if($ba_sum_number_progress <> "" && $ba_sum_number_progress <> 0){
                                                                            $ba_sum_number_progress_pre = (float)((int)$ba_sum_number_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $ba_sum_number_progress_pre = "";
                                                                        }
                                                                    // ベティーアンティーク・月間売上粗利予測
                                                                        if($ba_sum_arari_progress <> "" && $ba_sum_arari_progress <> 0){
                                                                            $ba_sum_arari_progress_pre = (float)((int)$ba_sum_arari_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $ba_sum_arari_progress_pre = "";
                                                                        }
                                                                        
                                                                    // ジュエリー新品・月間売上額予測
                                                                        if($jln_sum_uriage_progress <> "" && $jln_sum_uriage_progress <> 0){
                                                                            $jln_sum_uriage_progress_pre = (float)((int)$jln_sum_uriage_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $jln_sum_uriage_progress_pre = "";
                                                                        }
                                                                    // ジュエリー新品・月間売上点数予測
                                                                        if($jln_sum_number_progress <> "" && $jln_sum_number_progress <> 0){
                                                                            $jln_sum_number_progress_pre = (float)((int)$jln_sum_number_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $jln_sum_number_progress_pre = "";
                                                                        }
                                                                    // ジュエリー新品・月間売上粗利予測
                                                                        if($jln_sum_arari_progress <> "" && $jln_sum_arari_progress <> 0){
                                                                            $jln_sum_arari_progress_pre = (float)((int)$jln_sum_arari_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $jln_sum_arari_progress_pre = "";
                                                                        }
                                                                    // ジュエリー中古・月間売上額予測
                                                                        if($jlu_sum_uriage_progress <> "" && $jlu_sum_uriage_progress <> 0){
                                                                            $jlu_sum_uriage_progress_pre = (float)((int)$jlu_sum_uriage_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $jlu_sum_uriage_progress_pre = "";
                                                                        }
                                                                    // ジュエリー中古・月間売上点数予測
                                                                        if($jlu_sum_number_progress <> "" && $jlu_sum_number_progress <> 0){
                                                                            $jlu_sum_number_progress_pre = (float)((int)$jlu_sum_number_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $jlu_sum_number_progress_pre = "";
                                                                        }
                                                                    // ジュエリー中古・月間売上粗利予測
                                                                        if($jlu_sum_arari_progress <> "" && $jlu_sum_arari_progress <> 0){
                                                                            $jlu_sum_arari_progress_pre = (float)((int)$jlu_sum_arari_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $jlu_sum_arari_progress_pre = "";
                                                                        }
                                                                        
                                                                        
                                                                    // バッグ新品・月間売上額予測
                                                                        if($bgn_sum_uriage_progress <> "" && $bgn_sum_uriage_progress <> 0){
                                                                            $bgn_sum_uriage_progress_pre = (float)((int)$bgn_sum_uriage_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $bgn_sum_uriage_progress_pre = "";
                                                                        }
                                                                    // バッグ新品・月間売上点数予測
                                                                        if($bgn_sum_number_progress <> "" && $bgn_sum_number_progress <> 0){
                                                                            $bgn_sum_number_progress_pre = (float)((int)$bgn_sum_number_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $bgn_sum_number_progress_pre = "";
                                                                        }
                                                                    // バッグ新品・月間売上粗利予測
                                                                        if($bgn_sum_arari_progress <> "" && $bgn_sum_arari_progress <> 0){
                                                                            $bgn_sum_arari_progress_pre = (float)((int)$bgn_sum_arari_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $bgn_sum_arari_progress_pre = "";
                                                                        }
                                                                    // バッグ中古・月間売上額予測
                                                                        if($bgu_sum_uriage_progress <> "" && $bgu_sum_uriage_progress <> 0){
                                                                            $bgu_sum_uriage_progress_pre = (float)((int)$bgu_sum_uriage_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $bgu_sum_uriage_progress_pre = "";
                                                                        }
                                                                    // バッグ中古・月間売上点数予測
                                                                        if($bgu_sum_number_progress <> "" && $bgu_sum_number_progress <> 0){
                                                                            $bgu_sum_number_progress_pre = (float)((int)$bgu_sum_number_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $bgu_sum_number_progress_pre = "";
                                                                        }
                                                                    // バッグ中古・月間売上粗利予測
                                                                        if($bgu_sum_arari_progress <> "" && $bgu_sum_arari_progress <> 0){
                                                                            $bgu_sum_arari_progress_pre = (float)((int)$bgu_sum_arari_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                                        } else {
                                                                            $bgu_sum_arari_progress_pre = "";
                                                                        }
                                                                        
                                                                        
                                                                        
                                                                
                                                            // 先月比
                                                                    // ジャック新品・売上額予測・先月比
                                                                        if($jn_sum_uriage_progress_pre <> "" && $jn_sum_uriage_progress_pre <> 0 && $jn_sum_uriage_progress2 <> "" && $jn_sum_uriage_progress2 <> 0){
                                                                            $jn_sum_uriage_progress_pre2 = (floor(((float)$jn_sum_uriage_progress_pre / (float)$jn_sum_uriage_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $jn_sum_uriage_progress_pre2 = "---";
                                                                        }

                                                                    // ジャック新品・売上点数予測・先月比
                                                                        if($jn_sum_number_progress_pre <> "" && $jn_sum_number_progress_pre <> 0 && $jn_sum_number_progress2 <> "" && $jn_sum_number_progress2 <> 0){
                                                                            $jn_sum_number_progress_pre2 = (floor(((float)$jn_sum_number_progress_pre / (float)$jn_sum_number_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $jn_sum_number_progress_pre2 = "---";
                                                                        }

                                                                    // ジャック新品・売上粗利予測・先月比
                                                                        if($jn_sum_arari_progress_pre <> "" && $jn_sum_arari_progress_pre <> 0 && $jn_sum_arari_progress2 <> "" && $jn_sum_arari_progress2 <> 0){
                                                                            $jn_sum_arari_progress_pre2 = (floor(((float)$jn_sum_arari_progress_pre / (float)$jn_sum_arari_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $jn_sum_arari_progress_pre2 = "---";
                                                                        }
                                                                    // ジャック中古・売上額予測・先月比
                                                                        if($ju_sum_uriage_progress_pre <> "" && $ju_sum_uriage_progress_pre <> 0 && $ju_sum_uriage_progress2 <> "" && $ju_sum_uriage_progress2 <> 0){
                                                                            $ju_sum_uriage_progress_pre2 = (floor(((float)$ju_sum_uriage_progress_pre / (float)$ju_sum_uriage_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $ju_sum_uriage_progress_pre2 = "---";
                                                                        }

                                                                    // ジャック中古・売上点数予測・先月比
                                                                        if($ju_sum_number_progress_pre <> "" && $ju_sum_number_progress_pre <> 0 && $ju_sum_number_progress2 <> "" && $ju_sum_number_progress2 <> 0){
                                                                            $ju_sum_number_progress_pre2 = (floor(((float)$ju_sum_number_progress_pre / (float)$ju_sum_number_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $ju_sum_number_progress_pre2 = "---";
                                                                        }

                                                                    // ジャック中古・売上粗利予測・先月比
                                                                        if($ju_sum_arari_progress_pre <> "" && $ju_sum_arari_progress_pre <> 0 && $ju_sum_arari_progress2 <> "" && $ju_sum_arari_progress2 <> 0){
                                                                            $ju_sum_arari_progress_pre2 = (floor(((float)$ju_sum_arari_progress_pre / (float)$ju_sum_arari_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $ju_sum_arari_progress_pre2 = "---";
                                                                        }
                                                                    // ジャックアンティーク・売上額予測・先月比
                                                                        if($ja_sum_uriage_progress_pre <> "" && $ja_sum_uriage_progress_pre <> 0 && $ja_sum_uriage_progress2 <> "" && $ja_sum_uriage_progress2 <> 0){
                                                                            $ja_sum_uriage_progress_pre2 = (floor(((float)$ja_sum_uriage_progress_pre / (float)$ja_sum_uriage_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $ja_sum_uriage_progress_pre2 = "---";
                                                                        }

                                                                    // ジャックアンティーク・売上点数予測・先月比
                                                                        if($ja_sum_number_progress_pre <> "" && $ja_sum_number_progress_pre <> 0 && $ja_sum_number_progress2 <> "" && $ja_sum_number_progress2 <> 0){
                                                                            $ja_sum_number_progress_pre2 = (floor(((float)$ja_sum_number_progress_pre / (float)$ja_sum_number_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $ja_sum_number_progress_pre2 = "---";
                                                                        }

                                                                    // ジャックアンティーク・売上粗利予測・先月比
                                                                        if($ja_sum_arari_progress_pre <> "" && $ja_sum_arari_progress_pre <> 0 && $ja_sum_arari_progress2 <> "" && $ja_sum_arari_progress2 <> 0){
                                                                            $ja_sum_arari_progress_pre2 = (floor(((float)$ja_sum_arari_progress_pre / (float)$ja_sum_arari_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $ja_sum_arari_progress_pre2 = "---";
                                                                        }
                                                                        

                                                                    // ベティー新品・売上額予測・先月比
                                                                        if($bn_sum_uriage_progress_pre <> "" && $bn_sum_uriage_progress_pre <> 0 && $bn_sum_uriage_progress2 <> "" && $bn_sum_uriage_progress2 <> 0){
                                                                            $bn_sum_uriage_progress_pre2 = (floor(((float)$bn_sum_uriage_progress_pre / (float)$bn_sum_uriage_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bn_sum_uriage_progress_pre2 = "---";
                                                                        }

                                                                    // ベティー新品・売上点数予測・先月比
                                                                        if($bn_sum_number_progress_pre <> "" && $bn_sum_number_progress_pre <> 0 && $bn_sum_number_progress2 <> "" && $bn_sum_number_progress2 <> 0){
                                                                            $bn_sum_number_progress_pre2 = (floor(((float)$bn_sum_number_progress_pre / (float)$bn_sum_number_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bn_sum_number_progress_pre2 = "---";
                                                                        }

                                                                    // ベティー新品・売上粗利予測・先月比
                                                                        if($bn_sum_arari_progress_pre <> "" && $bn_sum_arari_progress_pre <> 0 && $bn_sum_arari_progress2 <> "" && $bn_sum_arari_progress2 <> 0){
                                                                            $bn_sum_arari_progress_pre2 = (floor(((float)$bn_sum_arari_progress_pre / (float)$bn_sum_arari_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bn_sum_arari_progress_pre2 = "---";
                                                                        }
                                                                    // ベティー中古・売上額予測・先月比
                                                                        if($bu_sum_uriage_progress_pre <> "" && $bu_sum_uriage_progress_pre <> 0 && $bu_sum_uriage_progress2 <> "" && $bu_sum_uriage_progress2 <> 0){
                                                                            $bu_sum_uriage_progress_pre2 = (floor(((float)$bu_sum_uriage_progress_pre / (float)$bu_sum_uriage_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bu_sum_uriage_progress_pre2 = "---";
                                                                        }

                                                                    // ベティー中古・売上点数予測・先月比
                                                                        if($bu_sum_number_progress_pre <> "" && $bu_sum_number_progress_pre <> 0 && $bu_sum_number_progress2 <> "" && $bu_sum_number_progress2 <> 0){
                                                                            $bu_sum_number_progress_pre2 = (floor(((float)$bu_sum_number_progress_pre / (float)$bu_sum_number_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bu_sum_number_progress_pre2 = "---";
                                                                        }

                                                                    // ベティー中古・売上粗利予測・先月比
                                                                        if($bu_sum_arari_progress_pre <> "" && $bu_sum_arari_progress_pre <> 0 && $bu_sum_arari_progress2 <> "" && $bu_sum_arari_progress2 <> 0){
                                                                            $bu_sum_arari_progress_pre2 = (floor(((float)$bu_sum_arari_progress_pre / (float)$bu_sum_arari_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bu_sum_arari_progress_pre2 = "---";
                                                                        }
                                                                        

                                                                    // ベティーアンティーク・売上額予測・先月比
                                                                        if($ba_sum_uriage_progress_pre <> "" && $ba_sum_uriage_progress_pre <> 0 && $ba_sum_uriage_progress2 <> "" && $ba_sum_uriage_progress2 <> 0){
                                                                            $ba_sum_uriage_progress_pre2 = (floor(((float)$ba_sum_uriage_progress_pre / (float)$ba_sum_uriage_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $ba_sum_uriage_progress_pre2 = "---";
                                                                        }

                                                                    // ベティーアンティーク・売上点数予測・先月比
                                                                        if($ba_sum_number_progress_pre <> "" && $ba_sum_number_progress_pre <> 0 && $ba_sum_number_progress2 <> "" && $ba_sum_number_progress2 <> 0){
                                                                            $ba_sum_number_progress_pre2 = (floor(((float)$ba_sum_number_progress_pre / (float)$ba_sum_number_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $ba_sum_number_progress_pre2 = "---";
                                                                        }

                                                                    // ベティーアンティーク・売上粗利予測・先月比
                                                                        if($ba_sum_arari_progress_pre <> "" && $ba_sum_arari_progress_pre <> 0 && $ba_sum_arari_progress2 <> "" && $ba_sum_arari_progress2 <> 0){
                                                                            $ba_sum_arari_progress_pre2 = (floor(((float)$ba_sum_arari_progress_pre / (float)$ba_sum_arari_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $ba_sum_arari_progress_pre2 = "---";
                                                                        }
                                                                        

                                                                    // ジュエリー新品・売上額予測・先月比
                                                                        if($jln_sum_uriage_progress_pre <> "" && $jln_sum_uriage_progress_pre <> 0 && $jln_sum_uriage_progress2 <> "" && $jln_sum_uriage_progress2 <> 0){
                                                                            $jln_sum_uriage_progress_pre2 = (floor(((float)$jln_sum_uriage_progress_pre / (float)$jln_sum_uriage_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $jln_sum_uriage_progress_pre2 = "---";
                                                                        }

                                                                    // ジュエリー新品・売上点数予測・先月比
                                                                        if($jln_sum_number_progress_pre <> "" && $jln_sum_number_progress_pre <> 0 && $jln_sum_number_progress2 <> "" && $jln_sum_number_progress2 <> 0){
                                                                            $jln_sum_number_progress_pre2 = (floor(((float)$jln_sum_number_progress_pre / (float)$jln_sum_number_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $jln_sum_number_progress_pre2 = "---";
                                                                        }

                                                                    // ジュエリー新品・売上粗利予測・先月比
                                                                        if($jln_sum_arari_progress_pre <> "" && $jln_sum_arari_progress_pre <> 0 && $jln_sum_arari_progress2 <> "" && $jln_sum_arari_progress2 <> 0){
                                                                            $jln_sum_arari_progress_pre2 = (floor(((float)$jln_sum_arari_progress_pre / (float)$jln_sum_arari_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $jln_sum_arari_progress_pre2 = "---";
                                                                        }
                                                                    // ジュエリー中古・売上額予測・先月比
                                                                        if($jlu_sum_uriage_progress_pre <> "" && $jlu_sum_uriage_progress_pre <> 0 && $jlu_sum_uriage_progress2 <> "" && $jlu_sum_uriage_progress2 <> 0){
                                                                            $jlu_sum_uriage_progress_pre2 = (floor(((float)$jlu_sum_uriage_progress_pre / (float)$jlu_sum_uriage_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $jlu_sum_uriage_progress_pre2 = "---";
                                                                        }

                                                                    // ジュエリー中古・売上点数予測・先月比
                                                                        if($jlu_sum_number_progress_pre <> "" && $jlu_sum_number_progress_pre <> 0 && $jlu_sum_number_progress2 <> "" && $jlu_sum_number_progress2 <> 0){
                                                                            $jlu_sum_number_progress_pre2 = (floor(((float)$jlu_sum_number_progress_pre / (float)$jlu_sum_number_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $jlu_sum_number_progress_pre2 = "---";
                                                                        }

                                                                    // ジュエリー中古・売上粗利予測・先月比
                                                                        if($jlu_sum_arari_progress_pre <> "" && $jlu_sum_arari_progress_pre <> 0 && $jlu_sum_arari_progress2 <> "" && $jlu_sum_arari_progress2 <> 0){
                                                                            $jlu_sum_arari_progress_pre2 = (floor(((float)$jlu_sum_arari_progress_pre / (float)$jlu_sum_arari_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $jlu_sum_arari_progress_pre2 = "---";
                                                                        }
                                                                        
                                                                        
                                                                    // バッグ新品・売上額予測・先月比
                                                                        if($bgn_sum_uriage_progress_pre <> "" && $bgn_sum_uriage_progress_pre <> 0 && $bgn_sum_uriage_progress2 <> "" && $bgn_sum_uriage_progress2 <> 0){
                                                                            $bgn_sum_uriage_progress_pre2 = (floor(((float)$bgn_sum_uriage_progress_pre / (float)$bgn_sum_uriage_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bgn_sum_uriage_progress_pre2 = "---";
                                                                        }

                                                                    // バッグ新品・売上点数予測・先月比
                                                                        if($bgn_sum_number_progress_pre <> "" && $bgn_sum_number_progress_pre <> 0 && $bgn_sum_number_progress2 <> "" && $bgn_sum_number_progress2 <> 0){
                                                                            $bgn_sum_number_progress_pre2 = (floor(((float)$bgn_sum_number_progress_pre / (float)$bgn_sum_number_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bgn_sum_number_progress_pre2 = "---";
                                                                        }

                                                                    // バッグ新品・売上粗利予測・先月比
                                                                        if($bgn_sum_arari_progress_pre <> "" && $bgn_sum_arari_progress_pre <> 0 && $bgn_sum_arari_progress2 <> "" && $bgn_sum_arari_progress2 <> 0){
                                                                            $bgn_sum_arari_progress_pre2 = (floor(((float)$bgn_sum_arari_progress_pre / (float)$bgn_sum_arari_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bgn_sum_arari_progress_pre2 = "---";
                                                                        }
                                                                        
                                                                    // バッグ中古・売上額予測・先月比
                                                                        if($bgu_sum_uriage_progress_pre <> "" && $bgu_sum_uriage_progress_pre <> 0 && $bgu_sum_uriage_progress2 <> "" && $bgu_sum_uriage_progress2 <> 0){
                                                                            $bgu_sum_uriage_progress_pre2 = (floor(((float)$bgu_sum_uriage_progress_pre / (float)$bgu_sum_uriage_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bgu_sum_uriage_progress_pre2 = "---";
                                                                        }

                                                                    // バッグ中古・売上点数予測・先月比
                                                                        if($bgu_sum_number_progress_pre <> "" && $bgu_sum_number_progress_pre <> 0 && $bgu_sum_number_progress2 <> "" && $bgu_sum_number_progress2 <> 0){
                                                                            $bgu_sum_number_progress_pre2 = (floor(((float)$bgu_sum_number_progress_pre / (float)$bgu_sum_number_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bgu_sum_number_progress_pre2 = "---";
                                                                        }

                                                                    // バッグ中古・売上粗利予測・先月比
                                                                        if($bgu_sum_arari_progress_pre <> "" && $bgu_sum_arari_progress_pre <> 0 && $bgu_sum_arari_progress2 <> "" && $bgu_sum_arari_progress2 <> 0){
                                                                            $bgu_sum_arari_progress_pre2 = (floor(((float)$bgu_sum_arari_progress_pre / (float)$bgu_sum_arari_progress2) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bgu_sum_arari_progress_pre2 = "---";
                                                                        }
                                                                        
                                                                        
                                                                        
                                                            // 過去比
                                                                    // ジャック新品・売上額予測・過去比
                                                                        if($jn_sum_uriage_progress_pre <> "" && $jn_sum_uriage_progress_pre <> 0 && $jn_sum_uriage_progress3 <> "" && $jn_sum_uriage_progress3 <> 0){
                                                                            $jn_sum_uriage_progress_pre3 = (floor(((float)$jn_sum_uriage_progress_pre / (float)$jn_sum_uriage_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $jn_sum_uriage_progress_pre3 = "---";
                                                                        }
                                                                    // ジャック新品・売上点数予測・過去比
                                                                        if($jn_sum_number_progress_pre <> "" && $jn_sum_number_progress_pre <> 0 && $jn_sum_number_progress3 <> "" && $jn_sum_number_progress3 <> 0){
                                                                            $jn_sum_number_progress_pre3 = (floor(((float)$jn_sum_number_progress_pre / (float)$jn_sum_number_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $jn_sum_number_progress_pre3 = "---";
                                                                        }
                                                                    // ジャック新品・売上粗利予測・過去比
                                                                        if($jn_sum_arari_progress_pre <> "" && $jn_sum_arari_progress_pre <> 0 && $jn_sum_arari_progress3 <> "" && $jn_sum_arari_progress3 <> 0){
                                                                            $jn_sum_arari_progress_pre3 = (floor(((float)$jn_sum_arari_progress_pre / (float)$jn_sum_arari_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $jn_sum_arari_progress_pre3 = "---";
                                                                        }
                                                                    // ジャック中古・売上額予測・過去比
                                                                        if($ju_sum_uriage_progress_pre <> "" && $ju_sum_uriage_progress_pre <> 0 && $ju_sum_uriage_progress3 <> "" && $ju_sum_uriage_progress3 <> 0){
                                                                            $ju_sum_uriage_progress_pre3 = (floor(((float)$ju_sum_uriage_progress_pre / (float)$ju_sum_uriage_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $ju_sum_uriage_progress_pre3 = "---";
                                                                        }
                                                                    // ジャック中古・売上点数予測・過去比
                                                                        if($ju_sum_number_progress_pre <> "" && $ju_sum_number_progress_pre <> 0 && $ju_sum_number_progress3 <> "" && $ju_sum_number_progress3 <> 0){
                                                                            $ju_sum_number_progress_pre3 = (floor(((float)$ju_sum_number_progress_pre / (float)$ju_sum_number_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $ju_sum_number_progress_pre3 = "---";
                                                                        }
                                                                    // ジャック中古・売上粗利予測・過去比
                                                                        if($ju_sum_arari_progress_pre <> "" && $ju_sum_arari_progress_pre <> 0 && $ju_sum_arari_progress3 <> "" && $ju_sum_arari_progress3 <> 0){
                                                                            $ju_sum_arari_progress_pre3 = (floor(((float)$ju_sum_arari_progress_pre / (float)$ju_sum_arari_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $ju_sum_arari_progress_pre3 = "---";
                                                                        }
                                                                    // ジャックアンティーク・売上額予測・過去比
                                                                        if($ja_sum_uriage_progress_pre <> "" && $ja_sum_uriage_progress_pre <> 0 && $ja_sum_uriage_progress3 <> "" && $ja_sum_uriage_progress3 <> 0){
                                                                            $ja_sum_uriage_progress_pre3 = (floor(((float)$ja_sum_uriage_progress_pre / (float)$ja_sum_uriage_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $ja_sum_uriage_progress_pre3 = "---";
                                                                        }
                                                                    // ジャックアンティーク・売上点数予測・過去比
                                                                        if($ja_sum_number_progress_pre <> "" && $ja_sum_number_progress_pre <> 0 && $ja_sum_number_progress3 <> "" && $ja_sum_number_progress3 <> 0){
                                                                            $ja_sum_number_progress_pre3 = (floor(((float)$ja_sum_number_progress_pre / (float)$ja_sum_number_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $ja_sum_number_progress_pre3 = "---";
                                                                        }
                                                                    // ジャックアンティーク・売上粗利予測・過去比
                                                                        if($ja_sum_arari_progress_pre <> "" && $ja_sum_arari_progress_pre <> 0 && $ja_sum_arari_progress3 <> "" && $ja_sum_arari_progress3 <> 0){
                                                                            $ja_sum_arari_progress_pre3 = (floor(((float)$ja_sum_arari_progress_pre / (float)$ja_sum_arari_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $ja_sum_arari_progress_pre3 = "---";
                                                                        }
                                                                        
                                                                        
                                                                    // ベティー新品・売上額予測・過去比
                                                                        if($bn_sum_uriage_progress_pre <> "" && $bn_sum_uriage_progress_pre <> 0 && $bn_sum_uriage_progress3 <> "" && $bn_sum_uriage_progress3 <> 0){
                                                                            $bn_sum_uriage_progress_pre3 = (floor(((float)$bn_sum_uriage_progress_pre / (float)$bn_sum_uriage_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bn_sum_uriage_progress_pre3 = "---";
                                                                        }
                                                                    // ベティー新品・売上点数予測・過去比
                                                                        if($bn_sum_number_progress_pre <> "" && $bn_sum_number_progress_pre <> 0 && $bn_sum_number_progress3 <> "" && $bn_sum_number_progress3 <> 0){
                                                                            $bn_sum_number_progress_pre3 = (floor(((float)$bn_sum_number_progress_pre / (float)$bn_sum_number_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bn_sum_number_progress_pre3 = "---";
                                                                        }
                                                                    // ベティー新品・売上粗利予測・過去比
                                                                        if($bn_sum_arari_progress_pre <> "" && $bn_sum_arari_progress_pre <> 0 && $bn_sum_arari_progress3 <> "" && $bn_sum_arari_progress3 <> 0){
                                                                            $bn_sum_arari_progress_pre3 = (floor(((float)$bn_sum_arari_progress_pre / (float)$bn_sum_arari_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bn_sum_arari_progress_pre3 = "---";
                                                                        }
                                                                    // ベティー中古・売上額予測・過去比
                                                                        if($bu_sum_uriage_progress_pre <> "" && $bu_sum_uriage_progress_pre <> 0 && $bu_sum_uriage_progress3 <> "" && $bu_sum_uriage_progress3 <> 0){
                                                                            $bu_sum_uriage_progress_pre3 = (floor(((float)$bu_sum_uriage_progress_pre / (float)$bu_sum_uriage_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bu_sum_uriage_progress_pre3 = "---";
                                                                        }
                                                                    // ベティー中古・売上点数予測・過去比
                                                                        if($bu_sum_number_progress_pre <> "" && $bu_sum_number_progress_pre <> 0 && $bu_sum_number_progress3 <> "" && $bu_sum_number_progress3 <> 0){
                                                                            $bu_sum_number_progress_pre3 = (floor(((float)$bu_sum_number_progress_pre / (float)$bu_sum_number_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bu_sum_number_progress_pre3 = "---";
                                                                        }
                                                                    // ベティー中古・売上粗利予測・過去比
                                                                        if($bu_sum_arari_progress_pre <> "" && $bu_sum_arari_progress_pre <> 0 && $bu_sum_arari_progress3 <> "" && $bu_sum_arari_progress3 <> 0){
                                                                            $bu_sum_arari_progress_pre3 = (floor(((float)$bu_sum_arari_progress_pre / (float)$bu_sum_arari_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bu_sum_arari_progress_pre3 = "---";
                                                                        }
                                                                    // ベティーアンティーク・売上額予測・過去比
                                                                        if($ba_sum_uriage_progress_pre <> "" && $ba_sum_uriage_progress_pre <> 0 && $ba_sum_uriage_progress3 <> "" && $ba_sum_uriage_progress3 <> 0){
                                                                            $ba_sum_uriage_progress_pre3 = (floor(((float)$ba_sum_uriage_progress_pre / (float)$ba_sum_uriage_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $ba_sum_uriage_progress_pre3 = "---";
                                                                        }
                                                                    // ベティーアンティーク・売上点数予測・過去比
                                                                        if($ba_sum_number_progress_pre <> "" && $ba_sum_number_progress_pre <> 0 && $ba_sum_number_progress3 <> "" && $ba_sum_number_progress3 <> 0){
                                                                            $ba_sum_number_progress_pre3 = (floor(((float)$ba_sum_number_progress_pre / (float)$ba_sum_number_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $ba_sum_number_progress_pre3 = "---";
                                                                        }
                                                                    // ベティーアンティーク新品・売上粗利予測・過去比
                                                                        if($ba_sum_arari_progress_pre <> "" && $ba_sum_arari_progress_pre <> 0 && $ba_sum_arari_progress3 <> "" && $ba_sum_arari_progress3 <> 0){
                                                                            $ba_sum_arari_progress_pre3 = (floor(((float)$ba_sum_arari_progress_pre / (float)$ba_sum_arari_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $ba_sum_arari_progress_pre3 = "---";
                                                                        }
                                                                        
                                                                        
                                                                    // ジュエリー新品・売上額予測・過去比
                                                                        if($jln_sum_uriage_progress_pre <> "" && $jln_sum_uriage_progress_pre <> 0 && $jln_sum_uriage_progress3 <> "" && $jln_sum_uriage_progress3 <> 0){
                                                                            $jln_sum_uriage_progress_pre3 = (floor(((float)$jln_sum_uriage_progress_pre / (float)$jln_sum_uriage_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $jln_sum_uriage_progress_pre3 = "---";
                                                                        }
                                                                    // ジュエリー新品・売上点数予測・過去比
                                                                        if($jln_sum_number_progress_pre <> "" && $jln_sum_number_progress_pre <> 0 && $jln_sum_number_progress3 <> "" && $jln_sum_number_progress3 <> 0){
                                                                            $jln_sum_number_progress_pre3 = (floor(((float)$jln_sum_number_progress_pre / (float)$jln_sum_number_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $jln_sum_number_progress_pre3 = "---";
                                                                        }
                                                                    // ジュエリー新品・売上粗利予測・過去比
                                                                        if($jln_sum_arari_progress_pre <> "" && $jln_sum_arari_progress_pre <> 0 && $jln_sum_arari_progress3 <> "" && $jln_sum_arari_progress3 <> 0){
                                                                            $jln_sum_arari_progress_pre3 = (floor(((float)$jln_sum_arari_progress_pre / (float)$jln_sum_arari_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $jln_sum_arari_progress_pre3 = "---";
                                                                        }
                                                                    // ジュエリー中古・売上額予測・過去比
                                                                        if($jlu_sum_uriage_progress_pre <> "" && $jlu_sum_uriage_progress_pre <> 0 && $jlu_sum_uriage_progress3 <> "" && $jlu_sum_uriage_progress3 <> 0){
                                                                            $jlu_sum_uriage_progress_pre3 = (floor(((float)$jlu_sum_uriage_progress_pre / (float)$jlu_sum_uriage_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $jlu_sum_uriage_progress_pre3 = "---";
                                                                        }
                                                                    // ジュエリー中古・売上点数予測・過去比
                                                                        if($jlu_sum_number_progress_pre <> "" && $jlu_sum_number_progress_pre <> 0 && $jlu_sum_number_progress3 <> "" && $jlu_sum_number_progress3 <> 0){
                                                                            $jlu_sum_number_progress_pre3 = (floor(((float)$jlu_sum_number_progress_pre / (float)$jlu_sum_number_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $jlu_sum_number_progress_pre3 = "---";
                                                                        }
                                                                    // ジュエリー中古・売上粗利予測・過去比
                                                                        if($jlu_sum_arari_progress_pre <> "" && $jlu_sum_arari_progress_pre <> 0 && $jlu_sum_arari_progress3 <> "" && $jlu_sum_arari_progress3 <> 0){
                                                                            $jlu_sum_arari_progress_pre3 = (floor(((float)$jlu_sum_arari_progress_pre / (float)$jlu_sum_arari_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $jlu_sum_arari_progress_pre3 = "---";
                                                                        }
                                                                        
                                                                        
                                                                    // バッグ新品・売上額予測・過去比
                                                                        if($bgn_sum_uriage_progress_pre <> "" && $bgn_sum_uriage_progress_pre <> 0 && $bgn_sum_uriage_progress3 <> "" && $bgn_sum_uriage_progress3 <> 0){
                                                                            $bgn_sum_uriage_progress_pre3 = (floor(((float)$bgn_sum_uriage_progress_pre / (float)$bgn_sum_uriage_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bgn_sum_uriage_progress_pre3 = "---";
                                                                        }
                                                                    // バッグ新品・売上点数予測・過去比
                                                                        if($bgn_sum_number_progress_pre <> "" && $bgn_sum_number_progress_pre <> 0 && $bgn_sum_number_progress3 <> "" && $bgn_sum_number_progress3 <> 0){
                                                                            $bgn_sum_number_progress_pre3 = (floor(((float)$bgn_sum_number_progress_pre / (float)$bgn_sum_number_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bgn_sum_number_progress_pre3 = "---";
                                                                        }
                                                                    // バッグ新品・売上粗利予測・過去比
                                                                        if($bgn_sum_arari_progress_pre <> "" && $bgn_sum_arari_progress_pre <> 0 && $bgn_sum_arari_progress3 <> "" && $bgn_sum_arari_progress3 <> 0){
                                                                            $bgn_sum_arari_progress_pre3 = (floor(((float)$bgn_sum_arari_progress_pre / (float)$bgn_sum_arari_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bgn_sum_arari_progress_pre3 = "---";
                                                                        }
                                                                    // バッグ中古・売上額予測・過去比
                                                                        if($bgu_sum_uriage_progress_pre <> "" && $bgu_sum_uriage_progress_pre <> 0 && $bgu_sum_uriage_progress3 <> "" && $bgu_sum_uriage_progress3 <> 0){
                                                                            $bgu_sum_uriage_progress_pre3 = (floor(((float)$bgu_sum_uriage_progress_pre / (float)$bgu_sum_uriage_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bgu_sum_uriage_progress_pre3 = "---";
                                                                        }
                                                                    // バッグ中古・売上点数予測・過去比
                                                                        if($bgu_sum_number_progress_pre <> "" && $bgu_sum_number_progress_pre <> 0 && $bgu_sum_number_progress3 <> "" && $bgu_sum_number_progress3 <> 0){
                                                                            $bgu_sum_number_progress_pre3 = (floor(((float)$bgu_sum_number_progress_pre / (float)$bgu_sum_number_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bgu_sum_number_progress_pre3 = "---";
                                                                        }
                                                                    // バッグ中古・売上粗利予測・過去比
                                                                        if($bgu_sum_arari_progress_pre <> "" && $bgu_sum_arari_progress_pre <> 0 && $bgu_sum_arari_progress3 <> "" && $bgu_sum_arari_progress3 <> 0){
                                                                            $bgu_sum_arari_progress_pre3 = (floor(((float)$bgu_sum_arari_progress_pre / (float)$bgu_sum_arari_progress3) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $bgu_sum_arari_progress_pre3 = "---";
                                                                        }
                                                                        
                                                                        
                                                                        

                                                            // 合計値(ジャック・N,ジャック・U,ジャック・A,ベティー・N,ベティー・U,ベティー・A,ジュエリー・N,ジュエリー・U,バッグ・N,バッグ・U)
                                                                    // データ格納最終月・売上額進捗合計
                                                                        //$all_sum_uriage_progress = (int)$jn_sum_uriage_progress + (int)$ju_sum_uriage_progress + (int)$ja_sum_uriage_progress + (int)$bn_sum_uriage_progress + (int)$bu_sum_uriage_progress + (int)$ba_sum_uriage_progress + (int)$jln_sum_uriage_progress + (int)$jlu_sum_uriage_progress + (int)$bgn_sum_uriage_progress + (int)$bgu_sum_uriage_progress;
                                                                        $all_sum_uriage_progress = round($jn_sum_uriage_progress) + round($ju_sum_uriage_progress) + round($ja_sum_uriage_progress) + round($bn_sum_uriage_progress) + round($bu_sum_uriage_progress) + round($ba_sum_uriage_progress) + round($jln_sum_uriage_progress) + round($jlu_sum_uriage_progress) + round($bgn_sum_uriage_progress) + round($bgu_sum_uriage_progress);
                                                                    // データ格納最終月・売上点数進捗合計
                                                                        //$all_sum_number_progress = (int)$jn_sum_number_progress + (int)$ju_sum_number_progress + (int)$ja_sum_number_progress + (int)$bn_sum_number_progress + (int)$bu_sum_number_progress + (int)$ba_sum_number_progress + (int)$jln_sum_number_progress + (int)$jlu_sum_number_progress + (int)$bgn_sum_number_progress + (int)$bgu_sum_number_progress;
                                                                        $all_sum_number_progress = round($jn_sum_number_progress) + round($ju_sum_number_progress) + round($ja_sum_number_progress) + round($bn_sum_number_progress) + round($bu_sum_number_progress) + round($ba_sum_number_progress) + round($jln_sum_number_progress) + round($jlu_sum_number_progress) + round($bgn_sum_number_progress) + round($bgu_sum_number_progress);
                                                                    // データ格納最終月・売上粗利進捗合計
                                                                        //$all_sum_arari_progress = (int)$jn_sum_arari_progress + (int)$ju_sum_arari_progress + (int)$ja_sum_arari_progress + (int)$bn_sum_arari_progress + (int)$bu_sum_arari_progress + (int)$ba_sum_arari_progress + (int)$jln_sum_arari_progress + (int)$jlu_sum_arari_progress + (int)$bgn_sum_arari_progress + (int)$bgu_sum_arari_progress;
                                                                        $all_sum_arari_progress = round($jn_sum_arari_progress) + round($ju_sum_arari_progress) + round($ja_sum_arari_progress) + round($bn_sum_arari_progress) + round($bu_sum_arari_progress) + round($ba_sum_arari_progress) + round($jln_sum_arari_progress) + round($jlu_sum_arari_progress) + round($bgn_sum_arari_progress) + round($bgu_sum_arari_progress);
                                                                    // データ格納最終月・売上額・着地予測合計
                                                                        //$all_sum_uriage_progress_pre = (int)$jn_sum_uriage_progress_pre + (int)$ju_sum_uriage_progress_pre + (int)$ja_sum_uriage_progress_pre + (int)$bn_sum_uriage_progress_pre + (int)$bu_sum_uriage_progress_pre + (int)$ba_sum_uriage_progress_pre + (int)$jln_sum_uriage_progress_pre + (int)$jlu_sum_uriage_progress_pre + (int)$bgn_sum_uriage_progress_pre + (int)$bgu_sum_uriage_progress_pre;
                                                                        $all_sum_uriage_progress_pre = round($jn_sum_uriage_progress_pre) + round($ju_sum_uriage_progress_pre) + round($ja_sum_uriage_progress_pre) + round($bn_sum_uriage_progress_pre) + round($bu_sum_uriage_progress_pre) + round($ba_sum_uriage_progress_pre) + round($jln_sum_uriage_progress_pre) + round($jlu_sum_uriage_progress_pre) + round($bgn_sum_uriage_progress_pre) + round($bgu_sum_uriage_progress_pre);
                                                                    // データ格納最終月・売上点数・着地予測合計
                                                                        //$all_sum_number_progress_pre = (int)$jn_sum_number_progress_pre + (int)$ju_sum_number_progress_pre + (int)$ja_sum_number_progress_pre + (int)$bn_sum_number_progress_pre + (int)$bu_sum_number_progress_pre + (int)$ba_sum_number_progress_pre + (int)$jln_sum_number_progress_pre + (int)$jlu_sum_number_progress_pre + (int)$bgn_sum_number_progress_pre + (int)$bgu_sum_number_progress_pre;
                                                                        $all_sum_number_progress_pre = round($jn_sum_number_progress_pre) + round($ju_sum_number_progress_pre) + round($ja_sum_number_progress_pre) + round($bn_sum_number_progress_pre) + round($bu_sum_number_progress_pre) + round($ba_sum_number_progress_pre) + round($jln_sum_number_progress_pre) + round($jlu_sum_number_progress_pre) + round($bgn_sum_number_progress_pre) + round($bgu_sum_number_progress_pre);
                                                                    // データ格納最終月・売上粗利・着地予測合計
                                                                        $all_sum_arari_progress_pre = round($jn_sum_arari_progress_pre) + round($ju_sum_arari_progress_pre) + round($ja_sum_arari_progress_pre) + round($bn_sum_arari_progress_pre) + round($bu_sum_arari_progress_pre) + round($ba_sum_arari_progress_pre) + round($jln_sum_arari_progress_pre) + round($jlu_sum_arari_progress_pre) + round($bgn_sum_arari_progress_pre) + round($bgu_sum_arari_progress_pre);
                                                                    

                                                                    // 進捗合計に対する先月比
                                                                        if($all_sum_uriage_progress_pre <> "" && $all_sum_uriage_progress_pre <> 0 && ((int)$jn_sum_uriage_progress2 + (int)$ju_sum_uriage_progress2 + (int)$ja_sum_uriage_progress2 + (int)$bn_sum_uriage_progress2 + (int)$bu_sum_uriage_progress2 + (int)$ba_sum_uriage_progress2 + (int)$jln_sum_uriage_progress2 + (int)$jlu_sum_uriage_progress2 + (int)$bgn_sum_uriage_progress2 + (int)$bgu_sum_uriage_progress2) <> 0){
                                                                            $all_sum_uriage_progress2 = (floor(((int)$all_sum_uriage_progress_pre / ((int)$jn_sum_uriage_progress2 + (int)$ju_sum_uriage_progress2 + (int)$ja_sum_uriage_progress2 + (int)$bn_sum_uriage_progress2 + (int)$bu_sum_uriage_progress2 + (int)$ba_sum_uriage_progress2 + (int)$jln_sum_uriage_progress2 + (int)$jlu_sum_uriage_progress2 + (int)$bgn_sum_uriage_progress2 + (int)$bgu_sum_uriage_progress2)) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $all_sum_uriage_progress2 = "---";
                                                                        }
                                                                        
                                                                        if($all_sum_number_progress_pre <> "" && $all_sum_number_progress_pre <> 0 && ((int)$jn_sum_number_progress2 + (int)$ju_sum_number_progress2 + (int)$ja_sum_number_progress2 + (int)$bn_sum_number_progress2 + (int)$bu_sum_number_progress2 + (int)$ba_sum_number_progress2 + (int)$jln_sum_number_progress2 + (int)$jlu_sum_number_progress2 + (int)$bgn_sum_number_progress2 + (int)$bgu_sum_number_progress2) <> 0){
                                                                            $all_sum_number_progress2 = (floor(((int)$all_sum_number_progress_pre / ((int)$jn_sum_number_progress2 + (int)$ju_sum_number_progress2 + (int)$ja_sum_number_progress2 + (int)$bn_sum_number_progress2 + (int)$bu_sum_number_progress2 + (int)$ba_sum_number_progress2 + (int)$jln_sum_number_progress2 + (int)$jlu_sum_number_progress2 + (int)$bgn_sum_number_progress2 + (int)$bgu_sum_number_progress2)) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $all_sum_number_progress2 = "---";
                                                                        }
                                                                        
                                                                        if($all_sum_arari_progress_pre <> "" && $all_sum_arari_progress_pre <> 0 && ((int)$jn_sum_arari_progress2 + (int)$ju_sum_arari_progress2 + (int)$ja_sum_arari_progress2 + (int)$bn_sum_arari_progress2 + (int)$bu_sum_arari_progress2 + (int)$ba_sum_arari_progress2 + (int)$jln_sum_arari_progress2 + (int)$jlu_sum_arari_progress2 + (int)$bgn_sum_arari_progress2 + (int)$bgu_sum_arari_progress2) <> 0){
                                                                            $all_sum_arari_progress2 = (floor(((int)$all_sum_arari_progress_pre / ((int)$jn_sum_arari_progress2 + (int)$ju_sum_arari_progress2 + (int)$ja_sum_arari_progress2 + (int)$bn_sum_arari_progress2 + (int)$bu_sum_arari_progress2 + (int)$ba_sum_arari_progress2 + (int)$jln_sum_arari_progress2 + (int)$jlu_sum_arari_progress2 + (int)$bgn_sum_arari_progress2 + (int)$bgu_sum_arari_progress2)) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $all_sum_arari_progress2 = "---";
                                                                        }
                                                                        
                                                                        
                                                                    // 進捗合計に対する過去比
                                                                        if($all_sum_uriage_progress_pre <> "" && $all_sum_uriage_progress_pre <> 0 && ((int)$jn_sum_uriage_progress3 + (int)$ju_sum_uriage_progress3 + (int)$ja_sum_uriage_progress3 + (int)$bn_sum_uriage_progress3 + (int)$bu_sum_uriage_progress3 + (int)$ba_sum_uriage_progress3 + (int)$jln_sum_uriage_progress3 + (int)$jlu_sum_uriage_progress3 + (int)$bgn_sum_uriage_progress3 + (int)$bgu_sum_uriage_progress3) <> 0){
                                                                            $all_sum_uriage_progress3 = (floor(((int)$all_sum_uriage_progress_pre / ((int)$jn_sum_uriage_progress3 + (int)$ju_sum_uriage_progress3 + (int)$ja_sum_uriage_progress3 + (int)$bn_sum_uriage_progress3 + (int)$bu_sum_uriage_progress3 + (int)$ba_sum_uriage_progress3 + (int)$jln_sum_uriage_progress3 + (int)$jlu_sum_uriage_progress3 + (int)$bgn_sum_uriage_progress3 + (int)$bgu_sum_uriage_progress3)) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $all_sum_uriage_progress3 = "---";
                                                                        }
                                                                       
                                                                        if($all_sum_number_progress_pre <> "" && $all_sum_number_progress_pre <> 0 && ((int)$jn_sum_number_progress3 + (int)$ju_sum_number_progress3 + (int)$ja_sum_number_progress3 + (int)$bn_sum_number_progress3 + (int)$bu_sum_number_progress3 + (int)$ba_sum_number_progress3 + (int)$jln_sum_number_progress3 + (int)$jlu_sum_number_progress3 + (int)$bgn_sum_number_progress3 + (int)$bgu_sum_number_progress3) <> 0){
                                                                            $all_sum_number_progress3 = (floor(((int)$all_sum_number_progress_pre / ((int)$jn_sum_number_progress3 + (int)$ju_sum_number_progress3 + (int)$ja_sum_number_progress3 + (int)$bn_sum_number_progress3 + (int)$bu_sum_number_progress3 + (int)$ba_sum_number_progress3 + (int)$jln_sum_number_progress3 + (int)$jlu_sum_number_progress3 + (int)$bgn_sum_number_progress3 + (int)$bgu_sum_number_progress3)) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $all_sum_number_progress3 = "---";
                                                                        }
                                                                           
                                                                        if($all_sum_arari_progress_pre <> "" && $all_sum_arari_progress_pre <> 0 && ((int)$jn_sum_arari_progress3 + (int)$ju_sum_arari_progress3 + (int)$ja_sum_arari_progress3 + (int)$bn_sum_arari_progress3 + (int)$bu_sum_arari_progress3 + (int)$ba_sum_arari_progress3 + (int)$jln_sum_arari_progress3 + (int)$jlu_sum_arari_progress3 + (int)$bgn_sum_arari_progress3 + (int)$bgu_sum_arari_progress3) <> 0){
                                                                            $all_sum_arari_progress3 = (floor(((int)$all_sum_arari_progress_pre / ((int)$jn_sum_arari_progress3 + (int)$ju_sum_arari_progress3 + (int)$ja_sum_arari_progress3 + (int)$bn_sum_arari_progress3 + (int)$bu_sum_arari_progress3 + (int)$ba_sum_arari_progress3 + (int)$jln_sum_arari_progress3 + (int)$jlu_sum_arari_progress3 + (int)$bgn_sum_arari_progress3 + (int)$bgu_sum_arari_progress3)) * 100 * 10)) / 10;
                                                                        } else {
                                                                            $all_sum_arari_progress3 = "---";
                                                                        }

                                                                        
                                                                    // HTML作成
                                                                        ($jn_sum_uriage_progress == 0 || $jn_sum_uriage_progress == "") ? $jn_uriage_view1 = $jn_sum_uriage_progress : $jn_uriage_view1 = number_format((float)$jn_sum_uriage_progress);
                                                                        ($ju_sum_uriage_progress == 0 || $ju_sum_uriage_progress == "") ? $ju_uriage_view1 = $ju_sum_uriage_progress : $ju_uriage_view1 = number_format((float)$ju_sum_uriage_progress);
                                                                        ($ja_sum_uriage_progress == 0 || $ja_sum_uriage_progress == "") ? $ja_uriage_view1 = $ja_sum_uriage_progress : $ja_uriage_view1 = number_format((float)$ja_sum_uriage_progress);
                                                                        
                                                                        ($jn_sum_uriage_progress_pre == 0 || $jn_sum_uriage_progress_pre == "") ? $jn_uriage_view2 = $jn_sum_uriage_progress_pre : $jn_uriage_view2 = number_format((float)$jn_sum_uriage_progress_pre);
                                                                        ($ju_sum_uriage_progress_pre == 0 || $ju_sum_uriage_progress_pre == "") ? $ju_uriage_view2 = $ju_sum_uriage_progress_pre : $ju_uriage_view2 = number_format((float)$ju_sum_uriage_progress_pre);
                                                                        ($ja_sum_uriage_progress_pre == 0 || $ja_sum_uriage_progress_pre == "") ? $ja_uriage_view2 = $ja_sum_uriage_progress_pre : $ja_uriage_view2 = number_format((float)$ja_sum_uriage_progress_pre);
                                                                        
                                                                        ($jn_sum_uriage_progress_pre2 == 0 || $jn_sum_uriage_progress_pre2 == "") ? $jn_uriage_view3 = $jn_sum_uriage_progress_pre2 : $jn_uriage_view3 = number_format((float)$jn_sum_uriage_progress_pre2,1);
                                                                        ($ju_sum_uriage_progress_pre2 == 0 || $ju_sum_uriage_progress_pre2 == "") ? $ju_uriage_view3 = $ju_sum_uriage_progress_pre2 : $ju_uriage_view3 = number_format((float)$ju_sum_uriage_progress_pre2,1);
                                                                        ($ja_sum_uriage_progress_pre2 == 0 || $ja_sum_uriage_progress_pre2 == "") ? $ja_uriage_view3 = $ja_sum_uriage_progress_pre2 : $ja_uriage_view3 = number_format((float)$ja_sum_uriage_progress_pre2,1);
                                                                        
                                                                        ($jn_sum_uriage_progress_pre3 == 0 || $jn_sum_uriage_progress_pre3 == "") ? $jn_uriage_view4 = $jn_sum_uriage_progress_pre3 : $jn_uriage_view4 = number_format((float)$jn_sum_uriage_progress_pre3,1);
                                                                        ($ju_sum_uriage_progress_pre3 == 0 || $ju_sum_uriage_progress_pre3 == "") ? $ju_uriage_view4 = $ju_sum_uriage_progress_pre3 : $ju_uriage_view4 = number_format((float)$ju_sum_uriage_progress_pre3,1);
                                                                        ($ja_sum_uriage_progress_pre3 == 0 || $ja_sum_uriage_progress_pre3 == "") ? $ja_uriage_view4 = $ja_sum_uriage_progress_pre3 : $ja_uriage_view4 = number_format((float)$ja_sum_uriage_progress_pre3,1);
                                                                        
                                                                        ($bn_sum_uriage_progress == 0 || $bn_sum_uriage_progress == "") ? $bn_uriage_view1 = $bn_sum_uriage_progress : $bn_uriage_view1 = number_format((float)$bn_sum_uriage_progress);
                                                                        ($bu_sum_uriage_progress == 0 || $bu_sum_uriage_progress == "") ? $bu_uriage_view1 = $bu_sum_uriage_progress : $bu_uriage_view1 = number_format((float)$bu_sum_uriage_progress);
                                                                        ($ba_sum_uriage_progress == 0 || $ba_sum_uriage_progress == "") ? $ba_uriage_view1 = $ba_sum_uriage_progress : $ba_uriage_view1 = number_format((float)$ba_sum_uriage_progress);
                                                                        
                                                                        ($bn_sum_uriage_progress_pre == 0 || $bn_sum_uriage_progress_pre == "") ? $bn_uriage_view2 = $bn_sum_uriage_progress_pre : $bn_uriage_view2 = number_format((float)$bn_sum_uriage_progress_pre);
                                                                        ($bu_sum_uriage_progress_pre == 0 || $bu_sum_uriage_progress_pre == "") ? $bu_uriage_view2 = $bu_sum_uriage_progress_pre : $bu_uriage_view2 = number_format((float)$bu_sum_uriage_progress_pre);
                                                                        ($ba_sum_uriage_progress_pre == 0 || $ba_sum_uriage_progress_pre == "") ? $ba_uriage_view2 = $ba_sum_uriage_progress_pre : $ba_uriage_view2 = number_format((float)$ba_sum_uriage_progress_pre);
                                                                        
                                                                        ($bn_sum_uriage_progress_pre2 == 0 || $bn_sum_uriage_progress_pre2 == "") ? $bn_uriage_view3 = $bn_sum_uriage_progress_pre2 : $bn_uriage_view3 = number_format((float)$bn_sum_uriage_progress_pre2,1);
                                                                        ($bu_sum_uriage_progress_pre2 == 0 || $bu_sum_uriage_progress_pre2 == "") ? $bu_uriage_view3 = $bu_sum_uriage_progress_pre2 : $bu_uriage_view3 = number_format((float)$bu_sum_uriage_progress_pre2,1);
                                                                        ($ba_sum_uriage_progress_pre2 == 0 || $ba_sum_uriage_progress_pre2 == "") ? $ba_uriage_view3 = $ba_sum_uriage_progress_pre2 : $ba_uriage_view3 = number_format((float)$ba_sum_uriage_progress_pre2,1);
                                                                        
                                                                        ($bn_sum_uriage_progress_pre3 == 0 || $bn_sum_uriage_progress_pre3 == "") ? $bn_uriage_view4 = $bn_sum_uriage_progress_pre3 : $bn_uriage_view4 = number_format((float)$bn_sum_uriage_progress_pre3,1);
                                                                        ($bu_sum_uriage_progress_pre3 == 0 || $bu_sum_uriage_progress_pre3 == "") ? $bu_uriage_view4 = $bu_sum_uriage_progress_pre3 : $bu_uriage_view4 = number_format((float)$bu_sum_uriage_progress_pre3,1);
                                                                        ($ba_sum_uriage_progress_pre3 == 0 || $ba_sum_uriage_progress_pre3 == "") ? $ba_uriage_view4 = $ba_sum_uriage_progress_pre3 : $ba_uriage_view4 = number_format((float)$ba_sum_uriage_progress_pre3,1);
                                                                    
                                                                        ($jln_sum_uriage_progress == 0 || $jln_sum_uriage_progress == "") ? $jln_uriage_view1 = $jln_sum_uriage_progress : $jln_uriage_view1 = number_format((float)$jln_sum_uriage_progress);
                                                                        ($jlu_sum_uriage_progress == 0 || $jlu_sum_uriage_progress == "") ? $jlu_uriage_view1 = $jlu_sum_uriage_progress : $jlu_uriage_view1 = number_format((float)$jlu_sum_uriage_progress);
                                                                        
                                                                        ($jln_sum_uriage_progress_pre == 0 || $jln_sum_uriage_progress_pre == "") ? $jln_uriage_view2 = $jln_sum_uriage_progress_pre : $jln_uriage_view2 = number_format((float)$jln_sum_uriage_progress_pre);
                                                                        ($jlu_sum_uriage_progress_pre == 0 || $jlu_sum_uriage_progress_pre == "") ? $jlu_uriage_view2 = $jlu_sum_uriage_progress_pre : $jlu_uriage_view2 = number_format((float)$jlu_sum_uriage_progress_pre);
                                                                        
                                                                        ($jln_sum_uriage_progress_pre2 == 0 || $jln_sum_uriage_progress_pre2 == "") ? $jln_uriage_view3 = $jln_sum_uriage_progress_pre2 : $jln_uriage_view3 = number_format((float)$jln_sum_uriage_progress_pre2,1);
                                                                        ($jlu_sum_uriage_progress_pre2 == 0 || $jlu_sum_uriage_progress_pre2 == "") ? $jlu_uriage_view3 = $jlu_sum_uriage_progress_pre2 : $jlu_uriage_view3 = number_format((float)$jlu_sum_uriage_progress_pre2,1);
                                                                        
                                                                        ($jln_sum_uriage_progress_pre3 == 0 || $jln_sum_uriage_progress_pre3 == "") ? $jln_uriage_view4 = $jln_sum_uriage_progress_pre3 : $jln_uriage_view4 = number_format((float)$jln_sum_uriage_progress_pre3,1);
                                                                        ($jlu_sum_uriage_progress_pre3 == 0 || $jlu_sum_uriage_progress_pre3 == "") ? $jlu_uriage_view4 = $jlu_sum_uriage_progress_pre3 : $jlu_uriage_view4 = number_format((float)$jlu_sum_uriage_progress_pre3,1);
                                                                    
                                                                        ($bgn_sum_uriage_progress == 0 || $bgn_sum_uriage_progress == "") ? $bgn_uriage_view1 = $bgn_sum_uriage_progress : $bgn_uriage_view1 = number_format((float)$bgn_sum_uriage_progress);
                                                                        ($bgu_sum_uriage_progress == 0 || $bgu_sum_uriage_progress == "") ? $bgu_uriage_view1 = $bgu_sum_uriage_progress : $bgu_uriage_view1 = number_format((float)$bgu_sum_uriage_progress);
                                                                    
                                                                        ($bgn_sum_uriage_progress_pre == 0 || $bgn_sum_uriage_progress_pre == "") ? $bgn_uriage_view2 = $bgn_sum_uriage_progress_pre : $bgn_uriage_view2 = number_format((float)$bgn_sum_uriage_progress_pre);
                                                                        ($bgu_sum_uriage_progress_pre == 0 || $bgu_sum_uriage_progress_pre == "") ? $bgu_uriage_view2 = $bgu_sum_uriage_progress_pre : $bgu_uriage_view2 = number_format((float)$bgu_sum_uriage_progress_pre);
                                                                        
                                                                        ($bgn_sum_uriage_progress_pre2 == 0 || $bgn_sum_uriage_progress_pre2 == "") ? $bgn_uriage_view3 = $bgn_sum_uriage_progress_pre2 : $bgn_uriage_view3 = number_format((float)$bgn_sum_uriage_progress_pre2,1);
                                                                        ($bgu_sum_uriage_progress_pre2 == 0 || $bgu_sum_uriage_progress_pre2 == "") ? $bgu_uriage_view3 = $bgu_sum_uriage_progress_pre2 : $bgu_uriage_view3 = number_format((float)$bgu_sum_uriage_progress_pre2,1);
                                                                        
                                                                        ($bgn_sum_uriage_progress_pre3 == 0 || $bgn_sum_uriage_progress_pre3 == "") ? $bgn_uriage_view4 = $bgn_sum_uriage_progress_pre3 : $bgn_uriage_view4 = number_format((float)$bgn_sum_uriage_progress_pre3,1);
                                                                        ($bgu_sum_uriage_progress_pre3 == 0 || $bgu_sum_uriage_progress_pre3 == "") ? $bgu_uriage_view4 = $bgu_sum_uriage_progress_pre3 : $bgu_uriage_view4 = number_format((float)$bgu_sum_uriage_progress_pre3,1);
                                                                        
                                                                        ($all_sum_uriage_progress == 0 || $all_sum_uriage_progress == "") ? $all_uriage_view1 = $all_sum_uriage_progress : $all_uriage_view1 = number_format((float)$all_sum_uriage_progress);
                                                                        
                                                                        ($all_sum_uriage_progress_pre == 0 || $all_sum_uriage_progress_pre == "") ? $all_uriage_view2 = $all_sum_uriage_progress_pre : $all_uriage_view2 = number_format((float)$all_sum_uriage_progress_pre);
                                                                        
                                                                        ($all_sum_uriage_progress2 == 0 || $all_sum_uriage_progress2 == "") ? $all_uriage_view3 = $all_sum_uriage_progress2 : $all_uriage_view3 = number_format((float)$all_sum_uriage_progress2,1);
                                                                        //($all_sum_uriage_progress2_u == 0 || $all_sum_uriage_progress2_u == "") ? $all_uriage_view3_u = $all_sum_uriage_progress2_u : $all_uriage_view3_u = number_format((float)$all_sum_uriage_progress2_u,1);
                                                                        //($all_sum_uriage_progress2_a == 0 || $all_sum_uriage_progress2_a == "") ? $all_uriage_view3_a = $all_sum_uriage_progress2_a : $all_uriage_view3_a = number_format((float)$all_sum_uriage_progress2_a,1);
                                                                        
                                                                        ($all_sum_uriage_progress3 == 0 || $all_sum_uriage_progress3 == "") ? $all_uriage_view4 = $all_sum_uriage_progress3 : $all_uriage_view4 = number_format((float)$all_sum_uriage_progress3,1);
                                                                        //($all_sum_uriage_progress3_u == 0 || $all_sum_uriage_progress3_u == "") ? $all_uriage_view4_u = $all_sum_uriage_progress3_u : $all_uriage_view4_u = number_format((float)$all_sum_uriage_progress3_u,1);
                                                                        //($all_sum_uriage_progress3_a == 0 || $all_sum_uriage_progress3_a == "") ? $all_uriage_view4_a = $all_sum_uriage_progress3_a : $all_uriage_view4_a = number_format((float)$all_sum_uriage_progress3_a,1);
                                                                        
                                                                        ($jn_sum_number_progress == 0 || $jn_sum_number_progress == "") ? $jn_number_view1 = $jn_sum_number_progress : $jn_number_view1 = number_format((float)$jn_sum_number_progress);
                                                                        ($ju_sum_number_progress == 0 || $ju_sum_number_progress == "") ? $ju_number_view1 = $ju_sum_number_progress : $ju_number_view1 = number_format((float)$ju_sum_number_progress);
                                                                        ($ja_sum_number_progress == 0 || $ja_sum_number_progress == "") ? $ja_number_view1 = $ja_sum_number_progress : $ja_number_view1 = number_format((float)$ja_sum_number_progress);
                                                                        
                                                                        ($jn_sum_number_progress_pre == 0 || $jn_sum_number_progress_pre == "") ? $jn_number_view2 = $jn_sum_number_progress_pre : $jn_number_view2 = number_format((float)$jn_sum_number_progress_pre);
                                                                        ($ju_sum_number_progress_pre == 0 || $ju_sum_number_progress_pre == "") ? $ju_number_view2 = $ju_sum_number_progress_pre : $ju_number_view2 = number_format((float)$ju_sum_number_progress_pre);
                                                                        ($ja_sum_number_progress_pre == 0 || $ja_sum_number_progress_pre == "") ? $ja_number_view2 = $ja_sum_number_progress_pre : $ja_number_view2 = number_format((float)$ja_sum_number_progress_pre);
                                                                        
                                                                        ($jn_sum_number_progress_pre2 == 0 || $jn_sum_number_progress_pre2 == "") ? $jn_number_view3 = $jn_sum_number_progress_pre2 : $jn_number_view3 = number_format((float)$jn_sum_number_progress_pre2,1);
                                                                        ($ju_sum_number_progress_pre2 == 0 || $ju_sum_number_progress_pre2 == "") ? $ju_number_view3 = $ju_sum_number_progress_pre2 : $ju_number_view3 = number_format((float)$ju_sum_number_progress_pre2,1);
                                                                        ($ja_sum_number_progress_pre2 == 0 || $ja_sum_number_progress_pre2 == "") ? $ja_number_view3 = $ja_sum_number_progress_pre2 : $ja_number_view3 = number_format((float)$ja_sum_number_progress_pre2,1);
                                                                        
                                                                        ($jn_sum_number_progress_pre3 == 0 || $jn_sum_number_progress_pre3 == "") ? $jn_number_view4 = $jn_sum_number_progress_pre3 : $jn_number_view4 = number_format((float)$jn_sum_number_progress_pre3,1);
                                                                        ($ju_sum_number_progress_pre3 == 0 || $ju_sum_number_progress_pre3 == "") ? $ju_number_view4 = $ju_sum_number_progress_pre3 : $ju_number_view4 = number_format((float)$ju_sum_number_progress_pre3,1);
                                                                        ($ja_sum_number_progress_pre3 == 0 || $ja_sum_number_progress_pre3 == "") ? $ja_number_view4 = $ja_sum_number_progress_pre3 : $ja_number_view4 = number_format((float)$ja_sum_number_progress_pre3,1);
                                                                        
                                                                        ($bn_sum_number_progress == 0 || $bn_sum_number_progress == "") ? $bn_number_view1 = $bn_sum_number_progress : $bn_number_view1 = number_format((float)$bn_sum_number_progress);
                                                                        ($bu_sum_number_progress == 0 || $bu_sum_number_progress == "") ? $bu_number_view1 = $bu_sum_number_progress : $bu_number_view1 = number_format((float)$bu_sum_number_progress);
                                                                        ($ba_sum_number_progress == 0 || $ba_sum_number_progress == "") ? $ba_number_view1 = $ba_sum_number_progress : $ba_number_view1 = number_format((float)$ba_sum_number_progress);
                                                                    
                                                                        ($bn_sum_number_progress_pre == 0 || $bn_sum_number_progress_pre == "") ? $bn_number_view2 = $bn_sum_number_progress_pre : $bn_number_view2 = number_format((float)$bn_sum_number_progress_pre);
                                                                        ($bu_sum_number_progress_pre == 0 || $bu_sum_number_progress_pre == "") ? $bu_number_view2 = $bu_sum_number_progress_pre : $bu_number_view2 = number_format((float)$bu_sum_number_progress_pre);
                                                                        ($ba_sum_number_progress_pre == 0 || $ba_sum_number_progress_pre == "") ? $ba_number_view2 = $ba_sum_number_progress_pre : $ba_number_view2 = number_format((float)$ba_sum_number_progress_pre);
                                                                        
                                                                        ($bn_sum_number_progress_pre2 == 0 || $bn_sum_number_progress_pre2 == "") ? $bn_number_view3 = $bn_sum_number_progress_pre2 : $bn_number_view3 = number_format((float)$bn_sum_number_progress_pre2,1);
                                                                        ($bu_sum_number_progress_pre2 == 0 || $bu_sum_number_progress_pre2 == "") ? $bu_number_view3 = $bu_sum_number_progress_pre2 : $bu_number_view3 = number_format((float)$bu_sum_number_progress_pre2,1);
                                                                        ($ba_sum_number_progress_pre2 == 0 || $ba_sum_number_progress_pre2 == "") ? $ba_number_view3 = $ba_sum_number_progress_pre2 : $ba_number_view3 = number_format((float)$ba_sum_number_progress_pre2,1);
                                                                        
                                                                        ($bn_sum_number_progress_pre3 == 0 || $bn_sum_number_progress_pre3 == "") ? $bn_number_view4 = $bn_sum_number_progress_pre3 : $bn_number_view4 = number_format((float)$bn_sum_number_progress_pre3,1);
                                                                        ($bu_sum_number_progress_pre3 == 0 || $bu_sum_number_progress_pre3 == "") ? $bu_number_view4 = $bn_sum_number_progress_pre3 : $bu_number_view4 = number_format((float)$bu_sum_number_progress_pre3,1);
                                                                        ($ba_sum_number_progress_pre3 == 0 || $ba_sum_number_progress_pre3 == "") ? $ba_number_view4 = $ba_sum_number_progress_pre3 : $ba_number_view4 = number_format((float)$ba_sum_number_progress_pre3,1);
                                                                        
                                                                        ($jln_sum_number_progress == 0 || $jln_sum_number_progress == "") ? $jln_number_view1 = $jln_sum_number_progress : $jln_number_view1 = number_format((float)$jln_sum_number_progress);
                                                                        ($jlu_sum_number_progress == 0 || $jlu_sum_number_progress == "") ? $jlu_number_view1 = $jlu_sum_number_progress : $jlu_number_view1 = number_format((float)$jlu_sum_number_progress);

                                                                        
                                                                        ($jln_sum_number_progress_pre == 0 || $jln_sum_number_progress_pre == "") ? $jln_number_view2 = $jln_sum_number_progress_pre : $jln_number_view2 = number_format((float)$jln_sum_number_progress_pre);
                                                                        ($jlu_sum_number_progress_pre == 0 || $jlu_sum_number_progress_pre == "") ? $jlu_number_view2 = $jlu_sum_number_progress_pre : $jlu_number_view2 = number_format((float)$jlu_sum_number_progress_pre);
                                                                    
                                                                        ($jln_sum_number_progress_pre2 == 0 || $jln_sum_number_progress_pre2 == "") ? $jln_number_view3 = $jln_sum_number_progress_pre2 : $jln_number_view3 = number_format((float)$jln_sum_number_progress_pre2,1);
                                                                        ($jlu_sum_number_progress_pre2 == 0 || $jlu_sum_number_progress_pre2 == "") ? $jlu_number_view3 = $jlu_sum_number_progress_pre2 : $jlu_number_view3 = number_format((float)$jlu_sum_number_progress_pre2,1);
                                                                    
                                                                        ($jln_sum_number_progress_pre3 == 0 || $jln_sum_number_progress_pre3 == "") ? $jln_number_view4 = $jln_sum_number_progress_pre3 : $jln_number_view4 = number_format((float)$jln_sum_number_progress_pre3,1);
                                                                        ($jlu_sum_number_progress_pre3 == 0 || $jlu_sum_number_progress_pre3 == "") ? $jlu_number_view4 = $jlu_sum_number_progress_pre3 : $jlu_number_view4 = number_format((float)$jlu_sum_number_progress_pre3,1);
                                                                        
                                                                        ($bgn_sum_number_progress == 0 || $bgn_sum_number_progress == "") ? $bgn_number_view1 = $bgn_sum_number_progress : $bgn_number_view1 = number_format((float)$bgn_sum_number_progress);
                                                                        ($bgu_sum_number_progress == 0 || $bgu_sum_number_progress == "") ? $bgu_number_view1 = $bgu_sum_number_progress : $bgu_number_view1 = number_format((float)$bgu_sum_number_progress);
                                                                        
                                                                        ($bgn_sum_number_progress_pre == 0 || $bgn_sum_number_progress_pre == "") ? $bgn_number_view2 = $bgn_sum_number_progress_pre : $bgn_number_view2 = number_format((float)$bgn_sum_number_progress_pre);
                                                                        ($bgu_sum_number_progress_pre == 0 || $bgu_sum_number_progress_pre == "") ? $bgu_number_view2 = $bgu_sum_number_progress_pre : $bgu_number_view2 = number_format((float)$bgu_sum_number_progress_pre);
                                                                        
                                                                        ($bgn_sum_number_progress_pre2 == 0 || $bgn_sum_number_progress_pre2 == "") ? $bgn_number_view3 = $bgn_sum_number_progress_pre2 : $bgn_number_view3 = number_format((float)$bgn_sum_number_progress_pre2,1);
                                                                        ($bgu_sum_number_progress_pre2 == 0 || $bgu_sum_number_progress_pre2 == "") ? $bgu_number_view3 = $bgu_sum_number_progress_pre2 : $bgu_number_view3 = number_format((float)$bgu_sum_number_progress_pre2,1);
                                                                        
                                                                        ($bgn_sum_number_progress_pre3 == 0 || $bgn_sum_number_progress_pre3 == "") ? $bgn_number_view4 = $bgn_sum_number_progress_pre3 : $bgn_number_view4 = number_format((float)$bgn_sum_number_progress_pre3,1);
                                                                        ($bgu_sum_number_progress_pre3 == 0 || $bgu_sum_number_progress_pre3 == "") ? $bgu_number_view4 = $bgu_sum_number_progress_pre3 : $bgu_number_view4 = number_format((float)$bgu_sum_number_progress_pre3,1);
                                                                        
                                                                        ($all_sum_number_progress == 0 || $all_sum_number_progress == "") ? $all_number_view1 = $all_sum_number_progress : $all_number_view1 = number_format((float)$all_sum_number_progress);
                                                                        
                                                                        ($all_sum_number_progress_pre == 0 || $all_sum_number_progress_pre == "") ? $all_number_view2 = $all_sum_number_progress_pre : $all_number_view2 = number_format((float)$all_sum_number_progress_pre);
                                                                        
                                                                        ($all_sum_number_progress2 == 0 || $all_sum_number_progress2 == "") ? $all_number_view3 = $all_sum_number_progress2 : $all_number_view3 = number_format((float)$all_sum_number_progress2,1);
                                                                        //($all_sum_number_progress2_u == 0 || $all_sum_number_progress2_u == "") ? $all_number_view3_u = $all_sum_number_progress2_u : $all_number_view3_u = number_format((float)$all_sum_number_progress2_u,1);
                                                                        //($all_sum_number_progress2_a == 0 || $all_sum_number_progress2_a == "") ? $all_number_view3_a = $all_sum_number_progress2_a : $all_number_view3_a = number_format((float)$all_sum_number_progress2_a,1);
                                                                        
                                                                        ($all_sum_number_progress3 == 0 || $all_sum_number_progress3 == "") ? $all_number_view4 = $all_sum_number_progress3 : $all_number_view4 = number_format((float)$all_sum_number_progress3,1);
                                                                        //($all_sum_number_progress3_u == 0 || $all_sum_number_progress3_u == "") ? $all_number_view4_u = $all_sum_number_progress3_u : $all_number_view4_u = number_format((float)$all_sum_number_progress3_u,1);
                                                                        //($all_sum_number_progress3_a == 0 || $all_sum_number_progress3_a == "") ? $all_number_view4_a = $all_sum_number_progress3_a : $all_number_view4_a = number_format((float)$all_sum_number_progress3_a,1);

                                                                        ($jn_sum_arari_progress == 0 || $jn_sum_arari_progress == "") ? $jn_arari_view1 = $jn_sum_arari_progress : $jn_arari_view1 = number_format((float)$jn_sum_arari_progress);
                                                                        ($ju_sum_arari_progress == 0 || $ju_sum_arari_progress == "") ? $ju_arari_view1 = $ju_sum_arari_progress : $ju_arari_view1 = number_format((float)$ju_sum_arari_progress);
                                                                        ($ja_sum_arari_progress == 0 || $ja_sum_arari_progress == "") ? $ja_arari_view1 = $ja_sum_arari_progress : $ja_arari_view1 = number_format((float)$ja_sum_arari_progress);
                                                                        
                                                                        ($jn_sum_arari_progress_pre == 0 || $jn_sum_arari_progress_pre == "") ? $jn_arari_view2 = $jn_sum_arari_progress_pre : $jn_arari_view2 = number_format((float)$jn_sum_arari_progress_pre);
                                                                        ($ju_sum_arari_progress_pre == 0 || $ju_sum_arari_progress_pre == "") ? $ju_arari_view2 = $ju_sum_arari_progress_pre : $ju_arari_view2 = number_format((float)$ju_sum_arari_progress_pre);
                                                                        ($ja_sum_arari_progress_pre == 0 || $ja_sum_arari_progress_pre == "") ? $ja_arari_view2 = $ja_sum_arari_progress_pre : $ja_arari_view2 = number_format((float)$ja_sum_arari_progress_pre);
                                                                    
                                                                        ($jn_sum_arari_progress_pre2 == 0 || $jn_sum_arari_progress_pre2 == "") ? $jn_arari_view3 = $jn_sum_arari_progress_pre2 : $jn_arari_view3 = number_format((float)$jn_sum_arari_progress_pre2,1);
                                                                        ($ju_sum_arari_progress_pre2 == 0 || $ju_sum_arari_progress_pre2 == "") ? $ju_arari_view3 = $ju_sum_arari_progress_pre2 : $ju_arari_view3 = number_format((float)$ju_sum_arari_progress_pre2,1);
                                                                        ($ja_sum_arari_progress_pre2 == 0 || $ja_sum_arari_progress_pre2 == "") ? $ja_arari_view3 = $ja_sum_arari_progress_pre2 : $ja_arari_view3 = number_format((float)$ja_sum_arari_progress_pre2,1);
                                                                        
                                                                        ($jn_sum_arari_progress_pre3 == 0 || $jn_sum_arari_progress_pre3 == "") ? $jn_arari_view4 = $jn_sum_arari_progress_pre3 : $jn_arari_view4 = number_format((float)$jn_sum_arari_progress_pre3,1);
                                                                        ($ju_sum_arari_progress_pre3 == 0 || $ju_sum_arari_progress_pre3 == "") ? $ju_arari_view4 = $ju_sum_arari_progress_pre3 : $ju_arari_view4 = number_format((float)$ju_sum_arari_progress_pre3,1);
                                                                        ($ja_sum_arari_progress_pre3 == 0 || $ja_sum_arari_progress_pre3 == "") ? $ja_arari_view4 = $ja_sum_arari_progress_pre3 : $ja_arari_view4 = number_format((float)$ja_sum_arari_progress_pre3,1);
                                                                        
                                                                        ($bn_sum_arari_progress == 0 || $bn_sum_arari_progress == "") ? $bn_arari_view1 = $bn_sum_arari_progress : $bn_arari_view1 = number_format((float)$bn_sum_arari_progress);
                                                                        ($bu_sum_arari_progress == 0 || $bu_sum_arari_progress == "") ? $bu_arari_view1 = $bu_sum_arari_progress : $bu_arari_view1 = number_format((float)$bu_sum_arari_progress);
                                                                        ($ba_sum_arari_progress == 0 || $ba_sum_arari_progress == "") ? $ba_arari_view1 = $ba_sum_arari_progress : $ba_arari_view1 = number_format((float)$ba_sum_arari_progress);
                                                                        
                                                                        ($bn_sum_arari_progress_pre == 0 || $bn_sum_arari_progress_pre == "") ? $bn_arari_view2 = $bn_sum_arari_progress_pre : $bn_arari_view2 = number_format((float)$bn_sum_arari_progress_pre);
                                                                        ($bu_sum_arari_progress_pre == 0 || $bu_sum_arari_progress_pre == "") ? $bu_arari_view2 = $bu_sum_arari_progress_pre : $bu_arari_view2 = number_format((float)$bu_sum_arari_progress_pre);
                                                                        ($ba_sum_arari_progress_pre == 0 || $ba_sum_arari_progress_pre == "") ? $ba_arari_view2 = $ba_sum_arari_progress_pre : $ba_arari_view2 = number_format((float)$ba_sum_arari_progress_pre);
                                                                        
                                                                        ($bn_sum_arari_progress_pre2 == 0 || $bn_sum_arari_progress_pre2 == "") ? $bn_arari_view3 = $bn_sum_arari_progress_pre2 : $bn_arari_view3 = number_format((float)$bn_sum_arari_progress_pre2,1);
                                                                        ($bu_sum_arari_progress_pre2 == 0 || $bu_sum_arari_progress_pre2 == "") ? $bu_arari_view3 = $bu_sum_arari_progress_pre2 : $bu_arari_view3 = number_format((float)$bu_sum_arari_progress_pre2,1);
                                                                        ($ba_sum_arari_progress_pre2 == 0 || $ba_sum_arari_progress_pre2 == "") ? $ba_arari_view3 = $ba_sum_arari_progress_pre2 : $ba_arari_view3 = number_format((float)$ba_sum_arari_progress_pre2,1);
                                                                        
                                                                        ($bn_sum_arari_progress_pre3 == 0 || $bn_sum_arari_progress_pre3 == "") ? $bn_arari_view4 = $bn_sum_arari_progress_pre3 : $bn_arari_view4 = number_format((float)$bn_sum_arari_progress_pre3,1);
                                                                        ($bu_sum_arari_progress_pre3 == 0 || $bu_sum_arari_progress_pre3 == "") ? $bu_arari_view4 = $bu_sum_arari_progress_pre3 : $bu_arari_view4 = number_format((float)$bu_sum_arari_progress_pre3,1);
                                                                        ($ba_sum_arari_progress_pre3 == 0 || $ba_sum_arari_progress_pre3 == "") ? $ba_arari_view4 = $ba_sum_arari_progress_pre3 : $ba_arari_view4 = number_format((float)$ba_sum_arari_progress_pre3,1);
                                                                        
                                                                        ($jln_sum_arari_progress == 0 || $jln_sum_arari_progress == "") ? $jln_arari_view1 = $jln_sum_arari_progress : $jln_arari_view1 = number_format((float)$jln_sum_arari_progress);
                                                                        ($jlu_sum_arari_progress == 0 || $jlu_sum_arari_progress == "") ? $jlu_arari_view1 = $jlu_sum_arari_progress : $jlu_arari_view1 = number_format((float)$jlu_sum_arari_progress);
                                                                        
                                                                        ($jln_sum_arari_progress_pre == 0 || $jln_sum_arari_progress_pre == "") ? $jln_arari_view2 = $jln_sum_arari_progress_pre : $jln_arari_view2 = number_format((float)$jln_sum_arari_progress_pre);
                                                                        ($jlu_sum_arari_progress_pre == 0 || $jlu_sum_arari_progress_pre == "") ? $jlu_arari_view2 = $jlu_sum_arari_progress_pre : $jlu_arari_view2 = number_format((float)$jlu_sum_arari_progress_pre);
                                                                        
                                                                        ($jln_sum_arari_progress_pre2 == 0 || $jln_sum_arari_progress_pre2 == "") ? $jln_arari_view3 = $jln_sum_arari_progress_pre2 : $jln_arari_view3 = number_format((float)$jln_sum_arari_progress_pre2,1);
                                                                        ($jlu_sum_arari_progress_pre2 == 0 || $jlu_sum_arari_progress_pre2 == "") ? $jlu_arari_view3 = $jlu_sum_arari_progress_pre2 : $jlu_arari_view3 = number_format((float)$jlu_sum_arari_progress_pre2,1);

                                                                        ($jln_sum_arari_progress_pre3 == 0 || $jln_sum_arari_progress_pre3 == "") ? $jln_arari_view4 = $jln_sum_arari_progress_pre3 : $jln_arari_view4 = number_format((float)$jln_sum_arari_progress_pre3,1);
                                                                        ($jlu_sum_arari_progress_pre3 == 0 || $jlu_sum_arari_progress_pre3 == "") ? $jlu_arari_view4 = $jlu_sum_arari_progress_pre3 : $jlu_arari_view4 = number_format((float)$jlu_sum_arari_progress_pre3,1);
                                                                    
                                                                        ($bgn_sum_arari_progress == 0 || $bgn_sum_arari_progress == "") ? $bgn_arari_view1 = $bgn_sum_arari_progress : $bgn_arari_view1 = number_format((float)$bgn_sum_arari_progress);
                                                                        ($bgu_sum_arari_progress == 0 || $bgu_sum_arari_progress == "") ? $bgu_arari_view1 = $bgu_sum_arari_progress : $bgu_arari_view1 = number_format((float)$bgu_sum_arari_progress);
                                                                    
                                                                        ($bgn_sum_arari_progress_pre == 0 || $bgn_sum_arari_progress_pre == "") ? $bgn_arari_view2 = $bgn_sum_arari_progress_pre : $bgn_arari_view2 = number_format((float)$bgn_sum_arari_progress_pre);
                                                                        ($bgu_sum_arari_progress_pre == 0 || $bgu_sum_arari_progress_pre == "") ? $bgu_arari_view2 = $bgu_sum_arari_progress_pre : $bgu_arari_view2 = number_format((float)$bgu_sum_arari_progress_pre);
                                                                        
                                                                        ($bgn_sum_arari_progress_pre2 == 0 || $bgn_sum_arari_progress_pre2 == "") ? $bgn_arari_view3 = $bgn_sum_arari_progress_pre2 : $bgn_arari_view3 = number_format((float)$bgn_sum_arari_progress_pre2,1);
                                                                        ($bgu_sum_arari_progress_pre2 == 0 || $bgu_sum_arari_progress_pre2 == "") ? $bgu_arari_view3 = $bgu_sum_arari_progress_pre2 : $bgu_arari_view3 = number_format((float)$bgu_sum_arari_progress_pre2,1);
                                                                        
                                                                        ($bgn_sum_arari_progress_pre3 == 0 || $bgn_sum_arari_progress_pre3 == "") ? $bgn_arari_view4 = $bgn_sum_arari_progress_pre3 : $bgn_arari_view4 = number_format((float)$bgn_sum_arari_progress_pre3,1);
                                                                        ($bgu_sum_arari_progress_pre3 == 0 || $bgu_sum_arari_progress_pre3 == "") ? $bgu_arari_view4 = $bgu_sum_arari_progress_pre3 : $bgu_arari_view4 = number_format((float)$bgu_sum_arari_progress_pre3,1);
                                                                                
                                                                        ($all_sum_arari_progress == 0 || $all_sum_arari_progress == "") ? $all_arari_view1 = $all_sum_arari_progress : $all_arari_view1 = number_format((float)$all_sum_arari_progress);
                                                                        
                                                                        ($all_sum_arari_progress_pre == 0 || $all_sum_arari_progress_pre == "") ? $all_arari_view2 = $all_sum_arari_progress_pre : $all_arari_view2 = number_format((float)$all_sum_arari_progress_pre);
                                                                        
                                                                        ($all_sum_arari_progress2 == 0 || $all_sum_arari_progress2 == "") ? $all_arari_view3 = $all_sum_arari_progress2 : $all_arari_view3 = number_format((float)$all_sum_arari_progress2,1);
                                                                        //($all_sum_arari_progress2_u == 0 || $all_sum_arari_progress2_u == "") ? $all_arari_view3_u = $all_sum_arari_progress2_u : $all_arari_view3_u = number_format((float)$all_sum_arari_progress2_u,1);
                                                                        //($all_sum_arari_progress2_a == 0 || $all_sum_arari_progress2_a == "") ? $all_arari_view3_a = $all_sum_arari_progress2_a : $all_arari_view3_a = number_format((float)$all_sum_arari_progress2_a,1);
                                                                    
                                                                        ($all_sum_arari_progress3 == 0 || $all_sum_arari_progress3 == "") ? $all_arari_view4 = $all_sum_arari_progress3 : $all_arari_view4 = number_format((float)$all_sum_arari_progress3,1);
                                                                        //($all_sum_arari_progress3_u == 0 || $all_sum_arari_progress3_u == "") ? $all_arari_view4_u = $all_sum_arari_progress3_u : $all_arari_view4_u = number_format((float)$all_sum_arari_progress3_u,1);
                                                                        //($all_sum_arari_progress3_a == 0 || $all_sum_arari_progress3_a == "") ? $all_arari_view4_a = $all_sum_arari_progress3_a : $all_arari_view4_a = number_format((float)$all_sum_arari_progress3_a,1);
                                                                        

                                                                        ($jn_uriage_view3 < 100) ? $jn_uriage_view3 = "<div class='sinchoku fc_blue'>" . $jn_uriage_view3 . "%</div>" : $jn_uriage_view3 = "<div class='sinchoku fc_red'>" . $jn_uriage_view3 . "%</div>";
                                                                        ($ju_uriage_view3 < 100) ? $ju_uriage_view3 = "<div class='sinchoku fc_blue'>" . $ju_uriage_view3 . "%</div>" : $ju_uriage_view3 = "<div class='sinchoku fc_red'>" . $ju_uriage_view3 . "%</div>";
                                                                        ($ja_uriage_view3 < 100) ? $ja_uriage_view3 = "<div class='sinchoku fc_blue'>" . $ja_uriage_view3 . "%</div>" : $ja_uriage_view3 = "<div class='sinchoku fc_red'>" . $ja_uriage_view3 . "%</div>";
                                                                        ($jn_uriage_view4 < 100) ? $jn_uriage_view4 = "<div class='sinchoku fc_blue'>" . $jn_uriage_view4 . "%</div>" : $jn_uriage_view4 = "<div class='sinchoku fc_red'>" . $jn_uriage_view4 . "%</div>";
                                                                        ($ju_uriage_view4 < 100) ? $ju_uriage_view4 = "<div class='sinchoku fc_blue'>" . $ju_uriage_view4 . "%</div>" : $ju_uriage_view4 = "<div class='sinchoku fc_red'>" . $ju_uriage_view4 . "%</div>";
                                                                        ($ja_uriage_view4 < 100) ? $ja_uriage_view4 = "<div class='sinchoku fc_blue'>" . $ja_uriage_view4 . "%</div>" : $ja_uriage_view4 = "<div class='sinchoku fc_red'>" . $ja_uriage_view4 . "%</div>";
                                                                        ($bn_uriage_view3 < 100) ? $bn_uriage_view3 = "<div class='sinchoku fc_blue'>" . $bn_uriage_view3 . "%</div>" : $bn_uriage_view3 = "<div class='sinchoku fc_red'>" . $bn_uriage_view3 . "%</div>";
                                                                        ($bu_uriage_view3 < 100) ? $bu_uriage_view3 = "<div class='sinchoku fc_blue'>" . $bu_uriage_view3 . "%</div>" : $bu_uriage_view3 = "<div class='sinchoku fc_red'>" . $bu_uriage_view3 . "%</div>";
                                                                        ($ba_uriage_view3 < 100) ? $ba_uriage_view3 = "<div class='sinchoku fc_blue'>" . $ba_uriage_view3 . "%</div>" : $ba_uriage_view3 = "<div class='sinchoku fc_red'>" . $ba_uriage_view3 . "%</div>";
                                                                        ($bn_uriage_view4 < 100) ? $bn_uriage_view4 = "<div class='sinchoku fc_blue'>" . $bn_uriage_view4 . "%</div>" : $bn_uriage_view4 = "<div class='sinchoku fc_red'>" . $bn_uriage_view4 . "%</div>";
                                                                        ($bu_uriage_view4 < 100) ? $bu_uriage_view4 = "<div class='sinchoku fc_blue'>" . $bu_uriage_view4 . "%</div>" : $bu_uriage_view4 = "<div class='sinchoku fc_red'>" . $bu_uriage_view4 . "%</div>";
                                                                        ($ba_uriage_view4 < 100) ? $ba_uriage_view4 = "<div class='sinchoku fc_blue'>" . $ba_uriage_view4 . "%</div>" : $ba_uriage_view4 = "<div class='sinchoku fc_red'>" . $ba_uriage_view4 . "%</div>";
                                                                        ($jln_uriage_view3 < 100) ? $jln_uriage_view3 = "<div class='sinchoku fc_blue'>" . $jln_uriage_view3 . "%</div>" : $jln_uriage_view3 = "<div class='sinchoku fc_red'>" . $jln_uriage_view3 . "%</div>";
                                                                        ($jlu_uriage_view3 < 100) ? $jlu_uriage_view3 = "<div class='sinchoku fc_blue'>" . $jlu_uriage_view3 . "%</div>" : $jlu_uriage_view3 = "<div class='sinchoku fc_red'>" . $jlu_uriage_view3 . "%</div>";
                                                                        ($jln_uriage_view4 < 100) ? $jln_uriage_view4 = "<div class='sinchoku fc_blue'>" . $jln_uriage_view4 . "%</div>" : $jln_uriage_view4 = "<div class='sinchoku fc_red'>" . $jln_uriage_view4 . "%</div>";
                                                                        ($jlu_uriage_view4 < 100) ? $jlu_uriage_view4 = "<div class='sinchoku fc_blue'>" . $jlu_uriage_view4 . "%</div>" : $jlu_uriage_view4 = "<div class='sinchoku fc_red'>" . $jlu_uriage_view4 . "%</div>";
                                                                        ($bgn_uriage_view3 < 100) ? $bgn_uriage_view3 = "<div class='sinchoku fc_blue'>" . $bgn_uriage_view3 . "%</div>" : $bgn_uriage_view3 = "<div class='sinchoku fc_red'>" . $bgn_uriage_view3 . "%</div>";
                                                                        ($bgu_uriage_view3 < 100) ? $bgu_uriage_view3 = "<div class='sinchoku fc_blue'>" . $bgu_uriage_view3 . "%</div>" : $bgu_uriage_view3 = "<div class='sinchoku fc_red'>" . $bgu_uriage_view3 . "%</div>";
                                                                        ($bgn_uriage_view4 < 100) ? $bgn_uriage_view4 = "<div class='sinchoku fc_blue'>" . $bgn_uriage_view4 . "%</div>" : $bgn_uriage_view4 = "<div class='sinchoku fc_red'>" . $bgn_uriage_view4 . "%</div>";
                                                                        ($bgu_uriage_view4 < 100) ? $bgu_uriage_view4 = "<div class='sinchoku fc_blue'>" . $bgu_uriage_view4 . "%</div>" : $bgu_uriage_view4 = "<div class='sinchoku fc_red'>" . $bgu_uriage_view4 . "%</div>";
                                                                        ($all_uriage_view3 < 100) ? $all_uriage_view3 = "<div class='sinchoku bg_grey fc_blue'>" . $all_uriage_view3 . "%</div>" : $all_uriage_view3 = "<div class='sinchoku bg_grey fc_red'>" . $all_uriage_view3 . "%</div>";
                                                                        //($all_uriage_view3_u < 100) ? $all_uriage_view3_u = "<div class='sinchoku bg_grey fc_blue'>" . $all_uriage_view3_u . "%</div>" : $all_uriage_view3_u = "<div class='sinchoku bg_grey fc_red'>" . $all_uriage_view3_u . "%</div>";
                                                                        //($all_uriage_view3_a < 100) ? $all_uriage_view3_a = "<div class='sinchoku bg_grey fc_blue'>" . $all_uriage_view3_a . "%</div>" : $all_uriage_view3_a = "<div class='sinchoku bg_grey fc_red'>" . $all_uriage_view3_a . "%</div>";
                                                                        ($all_uriage_view4 < 100) ? $all_uriage_view4 = "<div class='sinchoku bg_grey fc_blue'>" . $all_uriage_view4 . "%</div>" : $all_uriage_view4 = "<div class='sinchoku bg_grey fc_red'>" . $all_uriage_view4 . "%</div>";
                                                                        //($all_uriage_view4_u < 100) ? $all_uriage_view4_u = "<div class='sinchoku bg_grey fc_blue'>" . $all_uriage_view4_u . "%</div>" : $all_uriage_view4_u = "<div class='sinchoku bg_grey fc_red'>" . $all_uriage_view4_u . "%</div>";
                                                                        //($all_uriage_view4_a < 100) ? $all_uriage_view4_a = "<div class='sinchoku bg_grey fc_blue'>" . $all_uriage_view4_a . "%</div>" : $all_uriage_view4_a = "<div class='sinchoku bg_grey fc_red'>" . $all_uriage_view4_a . "%</div>";
                                                                        ($jn_number_view3 < 100) ? $jn_number_view3 = "<div class='sinchoku fc_blue'>" . $jn_number_view3 . "%</div>" : $jn_number_view3 = "<div class='sinchoku fc_red'>" . $jn_number_view3 . "%</div>";
                                                                        ($ju_number_view3 < 100) ? $ju_number_view3 = "<div class='sinchoku fc_blue'>" . $ju_number_view3 . "%</div>" : $ju_number_view3 = "<div class='sinchoku fc_red'>" . $ju_number_view3 . "%</div>";
                                                                        ($ja_number_view3 < 100) ? $ja_number_view3 = "<div class='sinchoku fc_blue'>" . $ja_number_view3 . "%</div>" : $ja_number_view3 = "<div class='sinchoku fc_red'>" . $ja_number_view3 . "%</div>";
                                                                        ($jn_number_view4 < 100) ? $jn_number_view4 = "<div class='sinchoku fc_blue'>" . $jn_number_view4 . "%</div>" : $jn_number_view4 = "<div class='sinchoku fc_red'>" . $jn_number_view4 . "%</div>";
                                                                        ($ju_number_view4 < 100) ? $ju_number_view4 = "<div class='sinchoku fc_blue'>" . $ju_number_view4 . "%</div>" : $ju_number_view4 = "<div class='sinchoku fc_red'>" . $ju_number_view4 . "%</div>";
                                                                        ($ja_number_view4 < 100) ? $ja_number_view4 = "<div class='sinchoku fc_blue'>" . $ja_number_view4 . "%</div>" : $ja_number_view4 = "<div class='sinchoku fc_red'>" . $ja_number_view4 . "%</div>";
                                                                        ($bn_number_view3 < 100) ? $bn_number_view3 = "<div class='sinchoku fc_blue'>" . $bn_number_view3 . "%</div>" : $bn_number_view3 = "<div class='sinchoku fc_red'>" . $bn_number_view3 . "%</div>";
                                                                        ($bu_number_view3 < 100) ? $bu_number_view3 = "<div class='sinchoku fc_blue'>" . $bu_number_view3 . "%</div>" : $bu_number_view3 = "<div class='sinchoku fc_red'>" . $bu_number_view3 . "%</div>";
                                                                        ($ba_number_view3 < 100) ? $ba_number_view3 = "<div class='sinchoku fc_blue'>" . $ba_number_view3 . "%</div>" : $ba_number_view3 = "<div class='sinchoku fc_red'>" . $ba_number_view3 . "%</div>";
                                                                        ($bn_number_view4 < 100) ? $bn_number_view4 = "<div class='sinchoku fc_blue'>" . $bn_number_view4 . "%</div>" : $bn_number_view4 = "<div class='sinchoku fc_red'>" . $bn_number_view4 . "%</div>";
                                                                        ($bu_number_view4 < 100) ? $bu_number_view4 = "<div class='sinchoku fc_blue'>" . $bu_number_view4 . "%</div>" : $bu_number_view4 = "<div class='sinchoku fc_red'>" . $bu_number_view4 . "%</div>";
                                                                        ($ba_number_view4 < 100) ? $ba_number_view4 = "<div class='sinchoku fc_blue'>" . $ba_number_view4 . "%</div>" : $ba_number_view4 = "<div class='sinchoku fc_red'>" . $ba_number_view4 . "%</div>";
                                                                        ($jln_number_view3 < 100) ? $jln_number_view3 = "<div class='sinchoku fc_blue'>" . $jln_number_view3 . "%</div>" : $jln_number_view3 = "<div class='sinchoku fc_red'>" . $jln_number_view3 . "%</div>";
                                                                        ($jlu_number_view3 < 100) ? $jlu_number_view3 = "<div class='sinchoku fc_blue'>" . $jlu_number_view3 . "%</div>" : $jlu_number_view3 = "<div class='sinchoku fc_red'>" . $jlu_number_view3 . "%</div>";
                                                                        ($jln_number_view4 < 100) ? $jln_number_view4 = "<div class='sinchoku fc_blue'>" . $jln_number_view4 . "%</div>" : $jln_number_view4 = "<div class='sinchoku fc_red'>" . $jln_number_view4 . "%</div>";
                                                                        ($jlu_number_view4 < 100) ? $jlu_number_view4 = "<div class='sinchoku fc_blue'>" . $jlu_number_view4 . "%</div>" : $jlu_number_view4 = "<div class='sinchoku fc_red'>" . $jlu_number_view4 . "%</div>";
                                                                        ($bgn_number_view3 < 100) ? $bgn_number_view3 = "<div class='sinchoku fc_blue'>" . $bgn_number_view3 . "%</div>" : $bgn_number_view3 = "<div class='sinchoku fc_red'>" . $bgn_number_view3 . "%</div>";
                                                                        ($bgu_number_view3 < 100) ? $bgu_number_view3 = "<div class='sinchoku fc_blue'>" . $bgu_number_view3 . "%</div>" : $bgu_number_view3 = "<div class='sinchoku fc_red'>" . $bgu_number_view3 . "%</div>";
                                                                        ($bgn_number_view4 < 100) ? $bgn_number_view4 = "<div class='sinchoku fc_blue'>" . $bgn_number_view4 . "%</div>" : $bgn_number_view4 = "<div class='sinchoku fc_red'>" . $bgn_number_view4 . "%</div>";
                                                                        ($bgu_number_view4 < 100) ? $bgu_number_view4 = "<div class='sinchoku fc_blue'>" . $bgu_number_view4 . "%</div>" : $bgu_number_view4 = "<div class='sinchoku fc_red'>" . $bgu_number_view4 . "%</div>";
                                                                        ($all_number_view3 < 100) ? $all_number_view3 = "<div class='sinchoku bg_grey fc_blue'>" . $all_number_view3 . "%</div>" : $all_number_view3 = "<div class='sinchoku bg_grey fc_red'>" . $all_number_view3 . "%</div>";
                                                                        //($all_number_view3_u < 100) ? $all_number_view3_u = "<div class='sinchoku bg_grey fc_blue'>" . $all_number_view3_u . "%</div>" : $all_number_view3_u = "<div class='sinchoku bg_grey fc_red'>" . $all_number_view3_u . "%</div>";
                                                                        //($all_number_view3_a < 100) ? $all_number_view3_a = "<div class='sinchoku bg_grey fc_blue'>" . $all_number_view3_a . "%</div>" : $all_number_view3_a = "<div class='sinchoku bg_grey fc_red'>" . $all_number_view3_a . "%</div>";
                                                                        ($all_number_view4 < 100) ? $all_number_view4 = "<div class='sinchoku bg_grey fc_blue'>" . $all_number_view4 . "%</div>" : $all_number_view4 = "<div class='sinchoku bg_grey fc_red'>" . $all_number_view4 . "%</div>";
                                                                        //($all_number_view4_u < 100) ? $all_number_view4_u = "<div class='sinchoku bg_grey fc_blue'>" . $all_number_view4_u . "%</div>" : $all_number_view4_u = "<div class='sinchoku bg_grey fc_red'>" . $all_number_view4_u . "%</div>";
                                                                        //($all_number_view4_a < 100) ? $all_number_view4_a = "<div class='sinchoku bg_grey fc_blue'>" . $all_number_view4_a . "%</div>" : $all_number_view4_a = "<div class='sinchoku bg_grey fc_red'>" . $all_number_view4_a . "%</div>";
                                                                        ($jn_arari_view3 < 100) ? $jn_arari_view3 = "<div class='sinchoku fc_blue'>" . $jn_arari_view3 . "%</div>" : $jn_arari_view3 = "<div class='sinchoku fc_red'>" . $jn_arari_view3 . "%</div>";
                                                                        ($ju_arari_view3 < 100) ? $ju_arari_view3 = "<div class='sinchoku fc_blue'>" . $ju_arari_view3 . "%</div>" : $ju_arari_view3 = "<div class='sinchoku fc_red'>" . $ju_arari_view3 . "%</div>";
                                                                        ($ja_arari_view3 < 100) ? $ja_arari_view3 = "<div class='sinchoku fc_blue'>" . $ja_arari_view3 . "%</div>" : $ja_arari_view3 = "<div class='sinchoku fc_red'>" . $ja_arari_view3 . "%</div>";
                                                                        ($jn_arari_view4 < 100) ? $jn_arari_view4 = "<div class='sinchoku fc_blue'>" . $jn_arari_view4 . "%</div>" : $jn_arari_view4 = "<div class='sinchoku fc_red'>" . $jn_arari_view4 . "%</div>";
                                                                        ($ju_arari_view4 < 100) ? $ju_arari_view4 = "<div class='sinchoku fc_blue'>" . $ju_arari_view4 . "%</div>" : $ju_arari_view4 = "<div class='sinchoku fc_red'>" . $ju_arari_view4 . "%</div>";
                                                                        ($ja_arari_view4 < 100) ? $ja_arari_view4 = "<div class='sinchoku fc_blue'>" . $ja_arari_view4 . "%</div>" : $ja_arari_view4 = "<div class='sinchoku fc_red'>" . $ja_arari_view4 . "%</div>";
                                                                        ($bn_arari_view3 < 100) ? $bn_arari_view3 = "<div class='sinchoku fc_blue'>" . $bn_arari_view3 . "%</div>" : $bn_arari_view3 = "<div class='sinchoku fc_red'>" . $bn_arari_view3 . "%</div>";
                                                                        ($bu_arari_view3 < 100) ? $bu_arari_view3 = "<div class='sinchoku fc_blue'>" . $bu_arari_view3 . "%</div>" : $bu_arari_view3 = "<div class='sinchoku fc_red'>" . $bu_arari_view3 . "%</div>";
                                                                        ($ba_arari_view3 < 100) ? $ba_arari_view3 = "<div class='sinchoku fc_blue'>" . $ba_arari_view3 . "%</div>" : $ba_arari_view3 = "<div class='sinchoku fc_red'>" . $ba_arari_view3 . "%</div>";
                                                                        ($bn_arari_view4 < 100) ? $bn_arari_view4 = "<div class='sinchoku fc_blue'>" . $bn_arari_view4 . "%</div>" : $bn_arari_view4 = "<div class='sinchoku fc_red'>" . $bn_arari_view4 . "%</div>";
                                                                        ($bu_arari_view4 < 100) ? $bu_arari_view4 = "<div class='sinchoku fc_blue'>" . $bu_arari_view4 . "%</div>" : $bu_arari_view4 = "<div class='sinchoku fc_red'>" . $bu_arari_view4 . "%</div>";
                                                                        ($ba_arari_view4 < 100) ? $ba_arari_view4 = "<div class='sinchoku fc_blue'>" . $ba_arari_view4 . "%</div>" : $ba_arari_view4 = "<div class='sinchoku fc_red'>" . $ba_arari_view4 . "%</div>";
                                                                        ($jln_arari_view3 < 100) ? $jln_arari_view3 = "<div class='sinchoku fc_blue'>" . $jln_arari_view3 . "%</div>" : $jln_arari_view3 = "<div class='sinchoku fc_red'>" . $jln_arari_view3 . "%</div>";
                                                                        ($jlu_arari_view3 < 100) ? $jlu_arari_view3 = "<div class='sinchoku fc_blue'>" . $jlu_arari_view3 . "%</div>" : $jlu_arari_view3 = "<div class='sinchoku fc_red'>" . $jlu_arari_view3 . "%</div>";
                                                                        ($jln_arari_view4 < 100) ? $jln_arari_view4 = "<div class='sinchoku fc_blue'>" . $jln_arari_view4 . "%</div>" : $jln_arari_view4 = "<div class='sinchoku fc_red'>" . $jln_arari_view4 . "%</div>";
                                                                        ($jlu_arari_view4 < 100) ? $jlu_arari_view4 = "<div class='sinchoku fc_blue'>" . $jlu_arari_view4 . "%</div>" : $jlu_arari_view4 = "<div class='sinchoku fc_red'>" . $jlu_arari_view4 . "%</div>";
                                                                        ($bgn_arari_view3 < 100) ? $bgn_arari_view3 = "<div class='sinchoku fc_blue'>" . $bgn_arari_view3 . "%</div>" : $bgn_arari_view3 = "<div class='sinchoku fc_red'>" . $bgn_arari_view3 . "%</div>";
                                                                        ($bgu_arari_view3 < 100) ? $bgu_arari_view3 = "<div class='sinchoku fc_blue'>" . $bgu_arari_view3 . "%</div>" : $bgu_arari_view3 = "<div class='sinchoku fc_red'>" . $bgu_arari_view3 . "%</div>";
                                                                        ($bgn_arari_view4 < 100) ? $bgn_arari_view4 = "<div class='sinchoku fc_blue'>" . $bgn_arari_view4 . "%</div>" : $bgn_arari_view4 = "<div class='sinchoku fc_red'>" . $bgn_arari_view4 . "%</div>";
                                                                        ($bgu_arari_view4 < 100) ? $bgu_arari_view4 = "<div class='sinchoku fc_blue'>" . $bgu_arari_view4 . "%</div>" : $bgu_arari_view4 = "<div class='sinchoku fc_red'>" . $bgu_arari_view4 . "%</div>";
                                                                        ($all_arari_view3 < 100) ? $all_arari_view3 = "<div class='sinchoku bg_grey fc_blue'>" . $all_arari_view3 . "%</div>" : $all_arari_view3 = "<div class='sinchoku bg_grey fc_red'>" . $all_arari_view3 . "%</div>";
                                                                        //($all_arari_view3_u < 100) ? $all_arari_view3_u = "<div class='sinchoku bg_grey fc_blue'>" . $all_arari_view3_u . "%</div>" : $all_arari_view3_u = "<div class='sinchoku bg_grey fc_red'>" . $all_arari_view3_u . "%</div>";
                                                                        //($all_arari_view3_a < 100) ? $all_arari_view3_a = "<div class='sinchoku bg_grey fc_blue'>" . $all_arari_view3_a . "%</div>" : $all_arari_view3_a = "<div class='sinchoku bg_grey fc_red'>" . $all_arari_view3_a . "%</div>";
                                                                        ($all_arari_view4 < 100) ? $all_arari_view4 = "<div class='sinchoku bg_grey fc_blue'>" . $all_arari_view4 . "%</div>" : $all_arari_view4 = "<div class='sinchoku bg_grey fc_red'>" . $all_arari_view4 . "%</div>";
                                                                        //($all_arari_view4_u < 100) ? $all_arari_view4_u = "<div class='sinchoku bg_grey fc_blue'>" . $all_arari_view4_u . "%</div>" : $all_arari_view4_u = "<div class='sinchoku bg_grey fc_red'>" . $all_arari_view4_u . "%</div>";
                                                                        //($all_arari_view4_a < 100) ? $all_arari_view4_a = "<div class='sinchoku bg_grey fc_blue'>" . $all_arari_view4_a . "%</div>" : $all_arari_view4_a = "<div class='sinchoku bg_grey fc_red'>" . $all_arari_view4_a . "%</div>";
                                                    
                                                        
                                                        /************************************************************************************************************************************************************************************************************* */
                                                            // 各月間予測値と過去比を取得 end
                                                        /************************************************************************************************************************************************************************************************************* */


                        /************************************************************************************************************************************************************************************************************* */
                            // 進捗率用ロジック end
                        /************************************************************************************************************************************************************************************************************* */

                    /************************************************************************************************************************************************************************************************************* */
                        // DB情報の受け取り（過去の期間）start
                    /************************************************************************************************************************************************************************************************************* */
                    
                            $past_temp4_title2 = "";
                            $past_i = 0;
    
                            /************************************************************************************************************************************************************************************************************* */
                                // ジャック・N用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */

                                            // DB検索（ジャック・N値）スタート
                                                $past_jn_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS jn_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS jn_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS jn_number"),
                                                        \DB::raw("SUM(ararikingaku) AS jn_arari"),
                                                    ])
                                                    ->groupBy('jn_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {

                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                    
                                                        })

                                                    // 条件（過去の期間））
                                                        ->whereBetween($table_name . '.uriage', [$past_between_start, $past_between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where("shouhinkubunbunruimei","like","%新品%")
                                                    // 条件（通販区分）
                                                        ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');
                            
                                                            // 条件（通販区分が自社）
                                                                if($out3_a == "ON"){
                                                                    $query->orWhere('tsuuhankubun',1);
                                                                }
                                                            // 条件（通販区分が楽天）
                                                                if($out3_b == "ON"){
                                                                    $query->orWhere('tsuuhankubun',2);
                                                                }
                                                            // 条件（通販区分がヤフー）
                                                                if($out3_c == "ON"){
                                                                    $query->orWhere('tsuuhankubun',3);
                                                                }
                                                            // 条件（通販区分が電話・雑誌）
                                                                if($out3_d == "ON"){
                                                                    $query->orWhere('tsuuhankubun',5);
                                                                }
                                                            // 条件（通販区分がYオークション）
                                                                if($out3_e == "ON"){
                                                                    $query->orWhere('tsuuhankubun',4);
                                                                }
                                                            // 条件（通販区分が修理品返送）
                                                                if($out3_f == "ON"){
                                                                    $query->orWhere('tsuuhankubun',9);
                                                                }
                            
                                                        })
                        
                                                    // 条件（免税）
                                                        ->where(function ($query) use ($out4_a,$out4_b) {
                                                                // 条件（免税区分が0:対象外）
                                                                    if($out4_a == "ON"){
                                                                        $query->orwhere("menzei","like","%対象外%");
                                                                    }
                                                                // 条件（免税区分が1:免税）
                                                                    if($out4_b == "ON"){
                                                                        $query->orwhere("menzei","like","%免税%");
                                                                    }
                                                        })
                                                    // 条件（扱い部門）
                                                        ->Where('bumonmei','Jackroad')
                                                        
                                                    // ソート順指定
                                                        ->orderBy('uriage', 'asc')
                                                        ->get();
                                                    // クエリビルダスタート
                                                        $past_i = 0;
                                                        // 変数リセット
                                                            $past_jn_sum_uriage = "";
                                                            $past_jn_sum_number = "";
                                                            $past_jn_sum_arari= "";
                                                            foreach ($past_jn_buys as $past_jn_buy) {
                                                                // 各月名
                                                                    $past_jn_month[$past_i]= $past_jn_buy->jn_month;
                                                                // 各月自社売上
                                                                    $past_jn_uriage[$past_i]= $past_jn_buy->jn_uriage;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_jn_manthly_data, $past_jn_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_jn_manthly_data = str_replace($past_jn_month[$past_i], $past_jn_uriage[$past_i], $past_temp4_jn_manthly_data);
                                                                        }

                                                                // 全期間自社売上合計
                                                                    $past_jn_sum_uriage = (int)$past_jn_sum_uriage + (int)$past_jn_uriage[$past_i];

                                                                // 各月自社点数
                                                                    $past_jn_number[$past_i]= $past_jn_buy->jn_number;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_jn_manthly_data2, $past_jn_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_jn_manthly_data2 = str_replace($past_jn_month[$past_i], $past_jn_number[$past_i], $past_temp4_jn_manthly_data2);
                                                                        }

                                                                // 全期間自社点数合計
                                                                    $past_jn_sum_number = (int)$past_jn_sum_number + (int)$past_jn_number[$past_i];



                                                                // 各月自社粗利
                                                                    $past_jn_arari[$past_i]= $past_jn_buy->jn_arari;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_jn_manthly_data3, $past_jn_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_jn_manthly_data3 = str_replace($past_jn_month[$past_i], $past_jn_arari[$past_i], $past_temp4_jn_manthly_data3);
                                                                        }

                                                                // 全期間自社粗利合計
                                                                    $past_jn_sum_arari = (int)$past_jn_sum_arari + (int)$past_jn_arari[$past_i];
                                                                    
                                                                $past_i++;
                                                            }

                                                        // 全期間自社売上合計とその平均値のHTML作成
                                                            $past_temp4_jn_sum = "";
                                                            if($past_jn_sum_uriage <> 0 && $past_jn_sum_uriage <> ""){
                                                                $past_jn_sum_uriage_c = number_format((int)$past_jn_sum_uriage); 
                                                                $past_jn_sum_uriage_ave = number_format(floor((int)$past_jn_sum_uriage / $past_i));
                                                                $past_jn_sum_uriage_ave2 = floor((int)$past_jn_sum_uriage / $past_i);
                                                            } else {
                                                                $past_jn_sum_uriage_c = $past_jn_sum_uriage; 
                                                                $past_jn_sum_uriage_ave = 0;
                                                                $past_jn_sum_uriage_ave2 = 0;
                                                            }
                                                            $past_temp4_jn_sum = "<div class='title4 ta_r'>" . $past_jn_sum_uriage_c . "</div><div class='title4 ta_r'>" . $past_jn_sum_uriage_ave . "</div></div>";
                                                        // 全期間自社売上点数合計とその平均値のHTML作成
                                                            $past_temp4_jn_sum2 = "";
                                                            if($past_jn_sum_number <> 0 && $past_jn_sum_number <> ""){
                                                                $past_jn_sum_number_c = number_format((int)$past_jn_sum_number); 
                                                                $past_jn_sum_number_ave = number_format(floor((int)$past_jn_sum_number / $past_i));
                                                                $past_jn_sum_number_ave2 = floor((int)$past_jn_sum_number / $past_i);
                                                            } else {
                                                                $past_jn_sum_number_c = $past_jn_sum_number; 
                                                                $past_jn_sum_number_ave = 0;
                                                                $past_jn_sum_number_ave2 = 0;
                                                            }
                                                            $past_temp4_jn_sum2 = "<div class='title4 ta_r'>" . $past_jn_sum_number_c . "</div><div class='title4 ta_r'>" . $past_jn_sum_number_ave . "</div></div>";
                                                        // 全期間自社粗利合計とその平均値のHTML作成
                                                            $past_temp4_jn_sum3 = "";
                                                            if($past_jn_sum_arari <> 0 && $past_jn_sum_arari <> ""){
                                                                $past_jn_sum_arari_c = number_format((int)$past_jn_sum_arari); 
                                                                $past_jn_sum_arari_ave = number_format(floor((int)$past_jn_sum_arari / $past_i));
                                                                $past_jn_sum_arari_ave2 = floor((int)$past_jn_sum_arari / $past_i);
                                                            } else {
                                                                $past_jn_sum_arari_c = $past_jn_sum_arari; 
                                                                $past_jn_sum_arari_ave = 0;
                                                                $past_jn_sum_arari_ave2 = 0;
                                                            }
                                                            $past_temp4_jn_sum3 = "<div class='title4 ta_r'>" . $past_jn_sum_arari_c . "</div><div class='title4 ta_r'>" . $past_jn_sum_arari_ave . "</div></div>";



                            /************************************************************************************************************************************************************************************************************* */
                                // ジャック・U用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */

                                            // DB検索（ジャック・U値）スタート
                                                $past_ju_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS ju_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS ju_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS ju_number"),
                                                        \DB::raw("SUM(ararikingaku) AS ju_arari"),
                                                    ])
                                                    ->groupBy('ju_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {

                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                    
                                                        })

                                                    // 条件（過去の期間））
                                                        ->whereBetween($table_name . '.uriage', [$past_between_start, $past_between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where("shouhinkubunbunruimei","like","%中古%")
                                                    // 条件（通販区分）
                                                        ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');
                            
                                                            // 条件（通販区分が自社）
                                                                if($out3_a == "ON"){
                                                                    $query->orWhere('tsuuhankubun',1);
                                                                }
                                                            // 条件（通販区分が楽天）
                                                                if($out3_b == "ON"){
                                                                    $query->orWhere('tsuuhankubun',2);
                                                                }
                                                            // 条件（通販区分がヤフー）
                                                                if($out3_c == "ON"){
                                                                    $query->orWhere('tsuuhankubun',3);
                                                                }
                                                            // 条件（通販区分が電話・雑誌）
                                                                if($out3_d == "ON"){
                                                                    $query->orWhere('tsuuhankubun',5);
                                                                }
                                                            // 条件（通販区分がYオークション）
                                                                if($out3_e == "ON"){
                                                                    $query->orWhere('tsuuhankubun',4);
                                                                }
                                                            // 条件（通販区分が修理品返送）
                                                                if($out3_f == "ON"){
                                                                    $query->orWhere('tsuuhankubun',9);
                                                                }
                            
                                                        })
                        
                                                    // 条件（免税）
                                                        ->where(function ($query) use ($out4_a,$out4_b) {
                                                                // 条件（免税区分が0:対象外）
                                                                    if($out4_a == "ON"){
                                                                        $query->orwhere("menzei","like","%対象外%");
                                                                    }
                                                                // 条件（免税区分が1:免税）
                                                                    if($out4_b == "ON"){
                                                                        $query->orwhere("menzei","like","%免税%");
                                                                    }
                                                        })
                                                    // 条件（扱い部門）
                                                        ->Where('bumonmei','Jackroad')
                                                        
                                                    // ソート順指定
                                                        ->orderBy('uriage', 'asc')
                                                        ->get();
                                                    // クエリビルダスタート
                                                        $past_i = 0;
                                                        // 変数リセット
                                                            $past_ju_sum_uriage = "";
                                                            $past_ju_sum_number = "";
                                                            $past_ju_sum_arari= "";
                                                            foreach ($past_ju_buys as $past_ju_buy) {
                                                                // 各月名
                                                                    $past_ju_month[$past_i]= $past_ju_buy->ju_month;
                                                                // 各月自社売上
                                                                    $past_ju_uriage[$past_i]= $past_ju_buy->ju_uriage;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_ju_manthly_data, $past_ju_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_ju_manthly_data = str_replace($past_ju_month[$past_i], $past_ju_uriage[$past_i], $past_temp4_ju_manthly_data);
                                                                        }

                                                                // 全期間自社売上合計
                                                                    $past_ju_sum_uriage = (int)$past_ju_sum_uriage + (int)$past_ju_uriage[$past_i];

                                                                // 各月自社点数
                                                                    $past_ju_number[$past_i]= $past_ju_buy->ju_number;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_ju_manthly_data2, $past_ju_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_ju_manthly_data2 = str_replace($past_ju_month[$past_i], $past_ju_number[$past_i], $past_temp4_ju_manthly_data2);
                                                                        }

                                                                // 全期間自社点数合計
                                                                    $past_ju_sum_number = (int)$past_ju_sum_number + (int)$past_ju_number[$past_i];



                                                                // 各月自社粗利
                                                                    $past_ju_arari[$past_i]= $past_ju_buy->ju_arari;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_ju_manthly_data3, $past_ju_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_ju_manthly_data3 = str_replace($past_ju_month[$past_i], $past_ju_arari[$past_i], $past_temp4_ju_manthly_data3);
                                                                        }

                                                                // 全期間自社粗利合計
                                                                    $past_ju_sum_arari = (int)$past_ju_sum_arari + (int)$past_ju_arari[$past_i];
                                                                    
                                                                $past_i++;
                                                            }

                                                        // 全期間自社売上合計とその平均値のHTML作成
                                                            $past_temp4_ju_sum = "";
                                                            if($past_ju_sum_uriage <> 0 && $past_ju_sum_uriage <> ""){
                                                                $past_ju_sum_uriage_c = number_format((int)$past_ju_sum_uriage); 
                                                                $past_ju_sum_uriage_ave = number_format(floor((int)$past_ju_sum_uriage / $past_i));
                                                                $past_ju_sum_uriage_ave2 = floor((int)$past_ju_sum_uriage / $past_i);
                                                            } else {
                                                                $past_ju_sum_uriage_c = $past_ju_sum_uriage; 
                                                                $past_ju_sum_uriage_ave = 0;
                                                                $past_ju_sum_uriage_ave2 = 0;
                                                            }
                                                            $past_temp4_ju_sum = "<div class='title4 ta_r'>" . $past_ju_sum_uriage_c . "</div><div class='title4 ta_r'>" . $past_ju_sum_uriage_ave . "</div></div>";
                                                        // 全期間自社売上点数合計とその平均値のHTML作成
                                                            $past_temp4_ju_sum2 = "";
                                                            if($past_ju_sum_number <> 0 && $past_ju_sum_number <> ""){
                                                                $past_ju_sum_number_c = number_format((int)$past_ju_sum_number); 
                                                                $past_ju_sum_number_ave = number_format(floor((int)$past_ju_sum_number / $past_i));
                                                                $past_ju_sum_number_ave2 = floor((int)$past_ju_sum_number / $past_i);
                                                            } else {
                                                                $past_ju_sum_number_c = $past_ju_sum_number; 
                                                                $past_ju_sum_number_ave = 0;
                                                                $past_ju_sum_number_ave2 = 0;
                                                            }
                                                            $past_temp4_ju_sum2 = "<div class='title4 ta_r'>" . $past_ju_sum_number_c . "</div><div class='title4 ta_r'>" . $past_ju_sum_number_ave . "</div></div>";
                                                        // 全期間自社粗利合計とその平均値のHTML作成
                                                            $past_temp4_ju_sum3 = "";
                                                            if($past_ju_sum_arari <> 0 && $past_ju_sum_arari <> ""){
                                                                $past_ju_sum_arari_c = number_format((int)$past_ju_sum_arari); 
                                                                $past_ju_sum_arari_ave = number_format(floor((int)$past_ju_sum_arari / $past_i));
                                                                $past_ju_sum_arari_ave2 = floor((int)$past_ju_sum_arari / $past_i);
                                                            } else {
                                                                $past_ju_sum_arari_c = $past_ju_sum_arari; 
                                                                $past_ju_sum_arari_ave = 0;
                                                                $past_ju_sum_arari_ave2 = 0;
                                                            }
                                                            $past_temp4_ju_sum3 = "<div class='title4 ta_r'>" . $past_ju_sum_arari_c . "</div><div class='title4 ta_r'>" . $past_ju_sum_arari_ave . "</div></div>";
                                                            


                            /************************************************************************************************************************************************************************************************************* */
                                // ジャック・A用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */

                                            // DB検索（ジャック・A値）スタート
                                                $past_ja_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS ja_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS ja_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS ja_number"),
                                                        \DB::raw("SUM(ararikingaku) AS ja_arari"),
                                                    ])
                                                    ->groupBy('ja_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {

                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                    
                                                        })

                                                    // 条件（過去の期間））
                                                        ->whereBetween($table_name . '.uriage', [$past_between_start, $past_between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where("shouhinkubunbunruimei","like","%アンティーク%")
                                                    // 条件（通販区分）
                                                        ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');
                            
                                                            // 条件（通販区分が自社）
                                                                if($out3_a == "ON"){
                                                                    $query->orWhere('tsuuhankubun',1);
                                                                }
                                                            // 条件（通販区分が楽天）
                                                                if($out3_b == "ON"){
                                                                    $query->orWhere('tsuuhankubun',2);
                                                                }
                                                            // 条件（通販区分がヤフー）
                                                                if($out3_c == "ON"){
                                                                    $query->orWhere('tsuuhankubun',3);
                                                                }
                                                            // 条件（通販区分が電話・雑誌）
                                                                if($out3_d == "ON"){
                                                                    $query->orWhere('tsuuhankubun',5);
                                                                }
                                                            // 条件（通販区分がYオークション）
                                                                if($out3_e == "ON"){
                                                                    $query->orWhere('tsuuhankubun',4);
                                                                }
                                                            // 条件（通販区分が修理品返送）
                                                                if($out3_f == "ON"){
                                                                    $query->orWhere('tsuuhankubun',9);
                                                                }
                            
                                                        })
                        
                                                    // 条件（免税）
                                                        ->where(function ($query) use ($out4_a,$out4_b) {
                                                                // 条件（免税区分が0:対象外）
                                                                    if($out4_a == "ON"){
                                                                        $query->orwhere("menzei","like","%対象外%");
                                                                    }
                                                                // 条件（免税区分が1:免税）
                                                                    if($out4_b == "ON"){
                                                                        $query->orwhere("menzei","like","%免税%");
                                                                    }
                                                        })
                                                    // 条件（扱い部門）
                                                        ->Where('bumonmei','Jackroad')
                                                        
                                                    // ソート順指定
                                                        ->orderBy('uriage', 'asc')
                                                        ->get();
                                                    // クエリビルダスタート
                                                        $past_i = 0;
                                                        // 変数リセット
                                                            $past_ja_sum_uriage = "";
                                                            $past_ja_sum_number = "";
                                                            $past_ja_sum_arari= "";
                                                            foreach ($past_ja_buys as $past_ja_buy) {
                                                                // 各月名
                                                                    $past_ja_month[$past_i]= $past_ja_buy->ja_month;
                                                                // 各月自社売上
                                                                    $past_ja_uriage[$past_i]= $past_ja_buy->ja_uriage;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_ja_manthly_data, $past_ja_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_ja_manthly_data = str_replace($past_ja_month[$past_i], $past_ja_uriage[$past_i], $past_temp4_ja_manthly_data);
                                                                        }

                                                                // 全期間自社売上合計
                                                                    $past_ja_sum_uriage = (int)$past_ja_sum_uriage + (int)$past_ja_uriage[$past_i];

                                                                // 各月自社点数
                                                                    $past_ja_number[$past_i]= $past_ja_buy->ja_number;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_ja_manthly_data2, $past_ja_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_ja_manthly_data2 = str_replace($past_ja_month[$past_i], $past_ja_number[$past_i], $past_temp4_ja_manthly_data2);
                                                                        }

                                                                // 全期間自社点数合計
                                                                    $past_ja_sum_number = (int)$past_ja_sum_number + (int)$past_ja_number[$past_i];



                                                                // 各月自社粗利
                                                                    $past_ja_arari[$past_i]= $past_ja_buy->ja_arari;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_ja_manthly_data3, $past_ja_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_ja_manthly_data3 = str_replace($past_ja_month[$past_i], $past_ja_arari[$past_i], $past_temp4_ja_manthly_data3);
                                                                        }

                                                                // 全期間自社粗利合計
                                                                    $past_ja_sum_arari = (int)$past_ja_sum_arari + (int)$past_ja_arari[$past_i];
                                                                    
                                                                $past_i++;
                                                            }

                                                        // 全期間自社売上合計とその平均値のHTML作成
                                                            $past_temp4_ja_sum = "";
                                                            if($past_ja_sum_uriage <> 0 && $past_ja_sum_uriage <> ""){
                                                                $past_ja_sum_uriage_c = number_format((int)$past_ja_sum_uriage); 
                                                                $past_ja_sum_uriage_ave = number_format(floor((int)$past_ja_sum_uriage / $past_i));
                                                                $past_ja_sum_uriage_ave2 = floor((int)$past_ja_sum_uriage / $past_i);
                                                            } else {
                                                                $past_ja_sum_uriage_c = $past_ja_sum_uriage; 
                                                                $past_ja_sum_uriage_ave = 0;
                                                                $past_ja_sum_uriage_ave2 = 0;
                                                            }
                                                            $past_temp4_ja_sum = "<div class='title4 ta_r'>" . $past_ja_sum_uriage_c . "</div><div class='title4 ta_r'>" . $past_ja_sum_uriage_ave . "</div></div>";
                                                        // 全期間自社売上点数合計とその平均値のHTML作成
                                                            $past_temp4_ja_sum2 = "";
                                                            if($past_ja_sum_number <> 0 && $past_ja_sum_number <> ""){
                                                                $past_ja_sum_number_c = number_format((int)$past_ja_sum_number); 
                                                                $past_ja_sum_number_ave = number_format(floor((int)$past_ja_sum_number / $past_i));
                                                                $past_ja_sum_number_ave2 = floor((int)$past_ja_sum_number / $past_i);
                                                            } else {
                                                                $past_ja_sum_number_c = $past_ja_sum_number; 
                                                                $past_ja_sum_number_ave = 0;
                                                                $past_ja_sum_number_ave2 = 0;
                                                            }
                                                            $past_temp4_ja_sum2 = "<div class='title4 ta_r'>" . $past_ja_sum_number_c . "</div><div class='title4 ta_r'>" . $past_ja_sum_number_ave . "</div></div>";
                                                        // 全期間自社粗利合計とその平均値のHTML作成
                                                            $past_temp4_ja_sum3 = "";
                                                            if($past_ja_sum_arari <> 0 && $past_ja_sum_arari <> ""){
                                                                $past_ja_sum_arari_c = number_format((int)$past_ja_sum_arari); 
                                                                $past_ja_sum_arari_ave = number_format(floor((int)$past_ja_sum_arari / $past_i));
                                                                $past_ja_sum_arari_ave2 = floor((int)$past_ja_sum_arari / $past_i);
                                                            } else {
                                                                $past_ja_sum_arari_c = $past_ja_sum_arari; 
                                                                $past_ja_sum_arari_ave = 0;
                                                                $past_ja_sum_arari_ave2 = 0;
                                                            }
                                                            $past_temp4_ja_sum3 = "<div class='title4 ta_r'>" . $past_ja_sum_arari_c . "</div><div class='title4 ta_r'>" . $past_ja_sum_arari_ave . "</div></div>";



                            /************************************************************************************************************************************************************************************************************* */
                                // ベティー・N用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */

                                            // DB検索（ベティー・N値）スタート
                                                $past_bn_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS bn_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS bn_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS bn_number"),
                                                        \DB::raw("SUM(ararikingaku) AS bn_arari"),
                                                    ])
                                                    ->groupBy('bn_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {

                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                    
                                                        })

                                                    // 条件（過去の期間））
                                                        ->whereBetween($table_name . '.uriage', [$past_between_start, $past_between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where("shouhinkubunbunruimei","like","%新品%")
                                                    // 条件（通販区分）
                                                        ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');
                            
                                                            // 条件（通販区分が自社）
                                                                if($out3_a == "ON"){
                                                                    $query->orWhere('tsuuhankubun',1);
                                                                }
                                                            // 条件（通販区分が楽天）
                                                                if($out3_b == "ON"){
                                                                    $query->orWhere('tsuuhankubun',2);
                                                                }
                                                            // 条件（通販区分がヤフー）
                                                                if($out3_c == "ON"){
                                                                    $query->orWhere('tsuuhankubun',3);
                                                                }
                                                            // 条件（通販区分が電話・雑誌）
                                                                if($out3_d == "ON"){
                                                                    $query->orWhere('tsuuhankubun',5);
                                                                }
                                                            // 条件（通販区分がYオークション）
                                                                if($out3_e == "ON"){
                                                                    $query->orWhere('tsuuhankubun',4);
                                                                }
                                                            // 条件（通販区分が修理品返送）
                                                                if($out3_f == "ON"){
                                                                    $query->orWhere('tsuuhankubun',9);
                                                                }
                            
                                                        })
                        
                                                    // 条件（免税）
                                                        ->where(function ($query) use ($out4_a,$out4_b) {
                                                                // 条件（免税区分が0:対象外）
                                                                    if($out4_a == "ON"){
                                                                        $query->orwhere("menzei","like","%対象外%");
                                                                    }
                                                                // 条件（免税区分が1:免税）
                                                                    if($out4_b == "ON"){
                                                                        $query->orwhere("menzei","like","%免税%");
                                                                    }
                                                        })
                                                    // 条件（扱い部門）
                                                        ->Where('bumonmei','Bettyroad')
                                                        
                                                    // ソート順指定
                                                        ->orderBy('uriage', 'asc')
                                                        ->get();
                                                    // クエリビルダスタート
                                                        $past_i = 0;
                                                        // 変数リセット
                                                            $past_bn_sum_uriage = "";
                                                            $past_bn_sum_number = "";
                                                            $past_bn_sum_arari= "";
                                                            foreach ($past_bn_buys as $past_bn_buy) {
                                                                // 各月名
                                                                    $past_bn_month[$past_i]= $past_bn_buy->bn_month;
                                                                // 各月自社売上
                                                                    $past_bn_uriage[$past_i]= $past_bn_buy->bn_uriage;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_bn_manthly_data, $past_bn_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_bn_manthly_data = str_replace($past_bn_month[$past_i], $past_bn_uriage[$past_i], $past_temp4_bn_manthly_data);
                                                                        }

                                                                // 全期間自社売上合計
                                                                    $past_bn_sum_uriage = (int)$past_bn_sum_uriage + (int)$past_bn_uriage[$past_i];

                                                                // 各月自社点数
                                                                    $past_bn_number[$past_i]= $past_bn_buy->bn_number;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_bn_manthly_data2, $past_bn_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_bn_manthly_data2 = str_replace($past_bn_month[$past_i], $past_bn_number[$past_i], $past_temp4_bn_manthly_data2);
                                                                        }

                                                                // 全期間自社点数合計
                                                                    $past_bn_sum_number = (int)$past_bn_sum_number + (int)$past_bn_number[$past_i];



                                                                // 各月自社粗利
                                                                    $past_bn_arari[$past_i]= $past_bn_buy->bn_arari;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_bn_manthly_data3, $past_bn_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_bn_manthly_data3 = str_replace($past_bn_month[$past_i], $past_bn_arari[$past_i], $past_temp4_bn_manthly_data3);
                                                                        }

                                                                // 全期間自社粗利合計
                                                                    $past_bn_sum_arari = (int)$past_bn_sum_arari + (int)$past_bn_arari[$past_i];
                                                                    
                                                                $past_i++;
                                                            }

                                                        // 全期間自社売上合計とその平均値のHTML作成
                                                            $past_temp4_bn_sum = "";
                                                            if($past_bn_sum_uriage <> 0 && $past_bn_sum_uriage <> ""){
                                                                $past_bn_sum_uriage_c = number_format((int)$past_bn_sum_uriage); 
                                                                $past_bn_sum_uriage_ave = number_format(floor((int)$past_bn_sum_uriage / $past_i));
                                                                $past_bn_sum_uriage_ave2 = floor((int)$past_bn_sum_uriage / $past_i);
                                                            } else {
                                                                $past_bn_sum_uriage_c = $past_bn_sum_uriage; 
                                                                $past_bn_sum_uriage_ave = 0;
                                                                $past_bn_sum_uriage_ave2 = 0;
                                                            }
                                                            $past_temp4_bn_sum = "<div class='title4 ta_r'>" . $past_bn_sum_uriage_c . "</div><div class='title4 ta_r'>" . $past_bn_sum_uriage_ave . "</div></div>";
                                                        // 全期間自社売上点数合計とその平均値のHTML作成
                                                            $past_temp4_bn_sum2 = "";
                                                            if($past_bn_sum_number <> 0 && $past_bn_sum_number <> ""){
                                                                $past_bn_sum_number_c = number_format((int)$past_bn_sum_number); 
                                                                $past_bn_sum_number_ave = number_format(floor((int)$past_bn_sum_number / $past_i));
                                                                $past_bn_sum_number_ave2 = floor((int)$past_bn_sum_number / $past_i);
                                                            } else {
                                                                $past_bn_sum_number_c = $past_bn_sum_number; 
                                                                $past_bn_sum_number_ave = 0;
                                                                $past_bn_sum_number_ave2 = 0;
                                                            }
                                                            $past_temp4_bn_sum2 = "<div class='title4 ta_r'>" . $past_bn_sum_number_c . "</div><div class='title4 ta_r'>" . $past_bn_sum_number_ave . "</div></div>";
                                                        // 全期間自社粗利合計とその平均値のHTML作成
                                                            $past_temp4_bn_sum3 = "";
                                                            if($past_bn_sum_arari <> 0 && $past_bn_sum_arari <> ""){
                                                                $past_bn_sum_arari_c = number_format((int)$past_bn_sum_arari); 
                                                                $past_bn_sum_arari_ave = number_format(floor((int)$past_bn_sum_arari / $past_i));
                                                                $past_bn_sum_arari_ave2 = floor((int)$past_bn_sum_arari / $past_i);
                                                            } else {
                                                                $past_bn_sum_arari_c = $past_bn_sum_arari; 
                                                                $past_bn_sum_arari_ave = 0;
                                                                $past_bn_sum_arari_ave2 = 0;
                                                            }
                                                            $past_temp4_bn_sum3 = "<div class='title4 ta_r'>" . $past_bn_sum_arari_c . "</div><div class='title4 ta_r'>" . $past_bn_sum_arari_ave . "</div></div>";




                            /************************************************************************************************************************************************************************************************************* */
                                // ベティー・U用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */

                                            // DB検索（ベティー・U値）スタート
                                                $past_bu_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS bu_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS bu_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS bu_number"),
                                                        \DB::raw("SUM(ararikingaku) AS bu_arari"),
                                                    ])
                                                    ->groupBy('bu_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {

                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                    
                                                        })

                                                    // 条件（過去の期間））
                                                        ->whereBetween($table_name . '.uriage', [$past_between_start, $past_between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where("shouhinkubunbunruimei","like","%中古%")
                                                    // 条件（通販区分）
                                                        ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');
                            
                                                            // 条件（通販区分が自社）
                                                                if($out3_a == "ON"){
                                                                    $query->orWhere('tsuuhankubun',1);
                                                                }
                                                            // 条件（通販区分が楽天）
                                                                if($out3_b == "ON"){
                                                                    $query->orWhere('tsuuhankubun',2);
                                                                }
                                                            // 条件（通販区分がヤフー）
                                                                if($out3_c == "ON"){
                                                                    $query->orWhere('tsuuhankubun',3);
                                                                }
                                                            // 条件（通販区分が電話・雑誌）
                                                                if($out3_d == "ON"){
                                                                    $query->orWhere('tsuuhankubun',5);
                                                                }
                                                            // 条件（通販区分がYオークション）
                                                                if($out3_e == "ON"){
                                                                    $query->orWhere('tsuuhankubun',4);
                                                                }
                                                            // 条件（通販区分が修理品返送）
                                                                if($out3_f == "ON"){
                                                                    $query->orWhere('tsuuhankubun',9);
                                                                }
                            
                                                        })
                        
                                                    // 条件（免税）
                                                        ->where(function ($query) use ($out4_a,$out4_b) {
                                                                // 条件（免税区分が0:対象外）
                                                                    if($out4_a == "ON"){
                                                                        $query->orwhere("menzei","like","%対象外%");
                                                                    }
                                                                // 条件（免税区分が1:免税）
                                                                    if($out4_b == "ON"){
                                                                        $query->orwhere("menzei","like","%免税%");
                                                                    }
                                                        })
                                                    // 条件（扱い部門）
                                                        ->Where('bumonmei','Bettyroad')
                                                        
                                                    // ソート順指定
                                                        ->orderBy('uriage', 'asc')
                                                        ->get();
                                                    // クエリビルダスタート
                                                        $past_i = 0;
                                                        // 変数リセット
                                                            $past_bu_sum_uriage = "";
                                                            $past_bu_sum_number = "";
                                                            $past_bu_sum_arari= "";
                                                            foreach ($past_bu_buys as $past_bu_buy) {
                                                                // 各月名
                                                                    $past_bu_month[$past_i]= $past_bu_buy->bu_month;
                                                                // 各月自社売上
                                                                    $past_bu_uriage[$past_i]= $past_bu_buy->bu_uriage;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_bu_manthly_data, $past_bu_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_bu_manthly_data = str_replace($past_bu_month[$past_i], $past_bu_uriage[$past_i], $past_temp4_bu_manthly_data);
                                                                        }

                                                                // 全期間自社売上合計
                                                                    $past_bu_sum_uriage = (int)$past_bu_sum_uriage + (int)$past_bu_uriage[$past_i];

                                                                // 各月自社点数
                                                                    $past_bu_number[$past_i]= $past_bu_buy->bu_number;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_bu_manthly_data2, $past_bu_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_bu_manthly_data2 = str_replace($past_bu_month[$past_i], $past_bu_number[$past_i], $past_temp4_bu_manthly_data2);
                                                                        }

                                                                // 全期間自社点数合計
                                                                    $past_bu_sum_number = (int)$past_bu_sum_number + (int)$past_bu_number[$past_i];



                                                                // 各月自社粗利
                                                                    $past_bu_arari[$past_i]= $past_bu_buy->bu_arari;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_bu_manthly_data3, $past_bu_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_bu_manthly_data3 = str_replace($past_bu_month[$past_i], $past_bu_arari[$past_i], $past_temp4_bu_manthly_data3);
                                                                        }

                                                                // 全期間自社粗利合計
                                                                    $past_bu_sum_arari = (int)$past_bu_sum_arari + (int)$past_bu_arari[$past_i];
                                                                    
                                                                $past_i++;
                                                            }

                                                        // 全期間自社売上合計とその平均値のHTML作成
                                                            $past_temp4_bu_sum = "";
                                                            if($past_bu_sum_uriage <> 0 && $past_bu_sum_uriage <> ""){
                                                                $past_bu_sum_uriage_c = number_format((int)$past_bu_sum_uriage); 
                                                                $past_bu_sum_uriage_ave = number_format(floor((int)$past_bu_sum_uriage / $past_i));
                                                                $past_bu_sum_uriage_ave2 = floor((int)$past_bu_sum_uriage / $past_i);
                                                            } else {
                                                                $past_bu_sum_uriage_c = $past_bu_sum_uriage; 
                                                                $past_bu_sum_uriage_ave = 0;
                                                                $past_bu_sum_uriage_ave2 = 0;
                                                            }
                                                            $past_temp4_bu_sum = "<div class='title4 ta_r'>" . $past_bu_sum_uriage_c . "</div><div class='title4 ta_r'>" . $past_bu_sum_uriage_ave . "</div></div>";
                                                        // 全期間自社売上点数合計とその平均値のHTML作成
                                                            $past_temp4_bu_sum2 = "";
                                                            if($past_bu_sum_number <> 0 && $past_bu_sum_number <> ""){
                                                                $past_bu_sum_number_c = number_format((int)$past_bu_sum_number); 
                                                                $past_bu_sum_number_ave = number_format(floor((int)$past_bu_sum_number / $past_i));
                                                                $past_bu_sum_number_ave2 = floor((int)$past_bu_sum_number / $past_i);
                                                            } else {
                                                                $past_bu_sum_number_c = $past_bu_sum_number; 
                                                                $past_bu_sum_number_ave = 0;
                                                                $past_bu_sum_number_ave2 = 0;
                                                            }
                                                            $past_temp4_bu_sum2 = "<div class='title4 ta_r'>" . $past_bu_sum_number_c . "</div><div class='title4 ta_r'>" . $past_bu_sum_number_ave . "</div></div>";
                                                        // 全期間自社粗利合計とその平均値のHTML作成
                                                            $past_temp4_bu_sum3 = "";
                                                            if($past_bu_sum_arari <> 0 && $past_bu_sum_arari <> ""){
                                                                $past_bu_sum_arari_c = number_format((int)$past_bu_sum_arari); 
                                                                $past_bu_sum_arari_ave = number_format(floor((int)$past_bu_sum_arari / $past_i));
                                                                $past_bu_sum_arari_ave2 = floor((int)$past_bu_sum_arari / $past_i);
                                                            } else {
                                                                $past_bu_sum_arari_c = $past_bu_sum_arari; 
                                                                $past_bu_sum_arari_ave = 0;
                                                                $past_bu_sum_arari_ave2 = 0;
                                                            }
                                                            $past_temp4_bu_sum3 = "<div class='title4 ta_r'>" . $past_bu_sum_arari_c . "</div><div class='title4 ta_r'>" . $past_bu_sum_arari_ave . "</div></div>";




                            /************************************************************************************************************************************************************************************************************* */
                                // ベティー・A用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */

                                            // DB検索（ベティー・A値）スタート
                                                $past_ba_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS ba_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS ba_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS ba_number"),
                                                        \DB::raw("SUM(ararikingaku) AS ba_arari"),
                                                    ])
                                                    ->groupBy('ba_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {

                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                    
                                                        })

                                                    // 条件（過去の期間））
                                                        ->whereBetween($table_name . '.uriage', [$past_between_start, $past_between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where("shouhinkubunbunruimei","like","%アンティーク%")
                                                    // 条件（通販区分）
                                                        ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');
                            
                                                            // 条件（通販区分が自社）
                                                                if($out3_a == "ON"){
                                                                    $query->orWhere('tsuuhankubun',1);
                                                                }
                                                            // 条件（通販区分が楽天）
                                                                if($out3_b == "ON"){
                                                                    $query->orWhere('tsuuhankubun',2);
                                                                }
                                                            // 条件（通販区分がヤフー）
                                                                if($out3_c == "ON"){
                                                                    $query->orWhere('tsuuhankubun',3);
                                                                }
                                                            // 条件（通販区分が電話・雑誌）
                                                                if($out3_d == "ON"){
                                                                    $query->orWhere('tsuuhankubun',5);
                                                                }
                                                            // 条件（通販区分がYオークション）
                                                                if($out3_e == "ON"){
                                                                    $query->orWhere('tsuuhankubun',4);
                                                                }
                                                            // 条件（通販区分が修理品返送）
                                                                if($out3_f == "ON"){
                                                                    $query->orWhere('tsuuhankubun',9);
                                                                }
                            
                                                        })
                        
                                                    // 条件（免税）
                                                        ->where(function ($query) use ($out4_a,$out4_b) {
                                                                // 条件（免税区分が0:対象外）
                                                                    if($out4_a == "ON"){
                                                                        $query->orwhere("menzei","like","%対象外%");
                                                                    }
                                                                // 条件（免税区分が1:免税）
                                                                    if($out4_b == "ON"){
                                                                        $query->orwhere("menzei","like","%免税%");
                                                                    }
                                                        })
                                                    // 条件（扱い部門）
                                                        ->Where('bumonmei','Bettyroad')
                                                        
                                                    // ソート順指定
                                                        ->orderBy('uriage', 'asc')
                                                        ->get();
                                                    // クエリビルダスタート
                                                        $past_i = 0;
                                                        // 変数リセット
                                                            $past_ba_sum_uriage = "";
                                                            $past_ba_sum_number = "";
                                                            $past_ba_sum_arari= "";
                                                            foreach ($past_ba_buys as $past_ba_buy) {
                                                                // 各月名
                                                                    $past_ba_month[$past_i]= $past_ba_buy->ba_month;
                                                                // 各月自社売上
                                                                    $past_ba_uriage[$past_i]= $past_ba_buy->ba_uriage;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_ba_manthly_data, $past_ba_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_ba_manthly_data = str_replace($past_ba_month[$past_i], $past_ba_uriage[$past_i], $past_temp4_ba_manthly_data);
                                                                        }

                                                                // 全期間自社売上合計
                                                                    $past_ba_sum_uriage = (int)$past_ba_sum_uriage + (int)$past_ba_uriage[$past_i];

                                                                // 各月自社点数
                                                                    $past_ba_number[$past_i]= $past_ba_buy->ba_number;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_ba_manthly_data2, $past_ba_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_ba_manthly_data2 = str_replace($past_ba_month[$past_i], $past_ba_number[$past_i], $past_temp4_ba_manthly_data2);
                                                                        }

                                                                // 全期間自社点数合計
                                                                    $past_ba_sum_number = (int)$past_ba_sum_number + (int)$past_ba_number[$past_i];



                                                                // 各月自社粗利
                                                                    $past_ba_arari[$past_i]= $past_ba_buy->ba_arari;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_ba_manthly_data3, $past_ba_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_ba_manthly_data3 = str_replace($past_ba_month[$past_i], $past_ba_arari[$past_i], $past_temp4_ba_manthly_data3);
                                                                        }

                                                                // 全期間自社粗利合計
                                                                    $past_ba_sum_arari = (int)$past_ba_sum_arari + (int)$past_ba_arari[$past_i];
                                                                    
                                                                $past_i++;
                                                            }

                                                        // 全期間自社売上合計とその平均値のHTML作成
                                                            $past_temp4_ba_sum = "";
                                                            if($past_ba_sum_uriage <> 0 && $past_ba_sum_uriage <> ""){
                                                                $past_ba_sum_uriage_c = number_format((int)$past_ba_sum_uriage); 
                                                                $past_ba_sum_uriage_ave = number_format(floor((int)$past_ba_sum_uriage / $past_i));
                                                                $past_ba_sum_uriage_ave2 = floor((int)$past_ba_sum_uriage / $past_i);
                                                            } else {
                                                                $past_ba_sum_uriage_c = $past_ba_sum_uriage; 
                                                                $past_ba_sum_uriage_ave = 0;
                                                                $past_ba_sum_uriage_ave2 = 0;
                                                            }
                                                            $past_temp4_ba_sum = "<div class='title4 ta_r'>" . $past_ba_sum_uriage_c . "</div><div class='title4 ta_r'>" . $past_ba_sum_uriage_ave . "</div></div>";
                                                        // 全期間自社売上点数合計とその平均値のHTML作成
                                                            $past_temp4_ba_sum2 = "";
                                                            if($past_ba_sum_number <> 0 && $past_ba_sum_number <> ""){
                                                                $past_ba_sum_number_c = number_format((int)$past_ba_sum_number); 
                                                                $past_ba_sum_number_ave = number_format(floor((int)$past_ba_sum_number / $past_i));
                                                                $past_ba_sum_number_ave2 = floor((int)$past_ba_sum_number / $past_i);
                                                            } else {
                                                                $past_ba_sum_number_c = $past_ba_sum_number; 
                                                                $past_ba_sum_number_ave = 0;
                                                                $past_ba_sum_number_ave2 = 0;
                                                            }
                                                            $past_temp4_ba_sum2 = "<div class='title4 ta_r'>" . $past_ba_sum_number_c . "</div><div class='title4 ta_r'>" . $past_ba_sum_number_ave . "</div></div>";
                                                        // 全期間自社粗利合計とその平均値のHTML作成
                                                            $past_temp4_ba_sum3 = "";
                                                            if($past_ba_sum_arari <> 0 && $past_ba_sum_arari <> ""){
                                                                $past_ba_sum_arari_c = number_format((int)$past_ba_sum_arari); 
                                                                $past_ba_sum_arari_ave = number_format(floor((int)$past_ba_sum_arari / $past_i));
                                                                $past_ba_sum_arari_ave2 = floor((int)$past_ba_sum_arari / $past_i);
                                                            } else {
                                                                $past_ba_sum_arari_c = $past_ba_sum_arari; 
                                                                $past_ba_sum_arari_ave = 0;
                                                                $past_ba_sum_arari_ave2 = 0;
                                                            }
                                                            $past_temp4_ba_sum3 = "<div class='title4 ta_r'>" . $past_ba_sum_arari_c . "</div><div class='title4 ta_r'>" . $past_ba_sum_arari_ave . "</div></div>";




                            /************************************************************************************************************************************************************************************************************* */
                                // ジュエリー・N用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */

                                            // DB検索（ジュエリー・N値）スタート
                                                $past_jln_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS jln_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS jln_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS jln_number"),
                                                        \DB::raw("SUM(ararikingaku) AS jln_arari"),
                                                    ])
                                                    ->groupBy('jln_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {

                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                    
                                                        })

                                                    // 条件（過去の期間））
                                                        ->whereBetween($table_name . '.uriage', [$past_between_start, $past_between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where("shouhinkubunbunruimei","like","%ｼﾞｭｴﾘｰ新品%")
                                                    // 条件（通販区分）
                                                        ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');
                            
                                                            // 条件（通販区分が自社）
                                                                if($out3_a == "ON"){
                                                                    $query->orWhere('tsuuhankubun',1);
                                                                }
                                                            // 条件（通販区分が楽天）
                                                                if($out3_b == "ON"){
                                                                    $query->orWhere('tsuuhankubun',2);
                                                                }
                                                            // 条件（通販区分がヤフー）
                                                                if($out3_c == "ON"){
                                                                    $query->orWhere('tsuuhankubun',3);
                                                                }
                                                            // 条件（通販区分が電話・雑誌）
                                                                if($out3_d == "ON"){
                                                                    $query->orWhere('tsuuhankubun',5);
                                                                }
                                                            // 条件（通販区分がYオークション）
                                                                if($out3_e == "ON"){
                                                                    $query->orWhere('tsuuhankubun',4);
                                                                }
                                                            // 条件（通販区分が修理品返送）
                                                                if($out3_f == "ON"){
                                                                    $query->orWhere('tsuuhankubun',9);
                                                                }
                            
                                                        })
                        
                                                    // 条件（免税）
                                                        ->where(function ($query) use ($out4_a,$out4_b) {
                                                                // 条件（免税区分が0:対象外）
                                                                    if($out4_a == "ON"){
                                                                        $query->orwhere("menzei","like","%対象外%");
                                                                    }
                                                                // 条件（免税区分が1:免税）
                                                                    if($out4_b == "ON"){
                                                                        $query->orwhere("menzei","like","%免税%");
                                                                    }
                                                        })
                                                    // 条件（扱い部門）
                                                        ->Where('bumonmei','Jewelry')
                                                        
                                                    // ソート順指定
                                                        ->orderBy('uriage', 'asc')
                                                        ->get();
                                                    // クエリビルダスタート
                                                        $past_i = 0;
                                                        // 変数リセット
                                                            $past_jln_sum_uriage = "";
                                                            $past_jln_sum_number = "";
                                                            $past_jln_sum_arari= "";
                                                            foreach ($past_jln_buys as $past_jln_buy) {
                                                                // 各月名
                                                                    $past_jln_month[$past_i]= $past_jln_buy->jln_month;
                                                                // 各月自社売上
                                                                    $past_jln_uriage[$past_i]= $past_jln_buy->jln_uriage;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_jln_manthly_data, $past_jln_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_jln_manthly_data = str_replace($past_jln_month[$past_i], $past_jln_uriage[$past_i], $past_temp4_jln_manthly_data);
                                                                        }

                                                                // 全期間自社売上合計
                                                                    $past_jln_sum_uriage = (int)$past_jln_sum_uriage + (int)$past_jln_uriage[$past_i];

                                                                // 各月自社点数
                                                                    $past_jln_number[$past_i]= $past_jln_buy->jln_number;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_jln_manthly_data2, $past_jln_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_jln_manthly_data2 = str_replace($past_jln_month[$past_i], $past_jln_number[$past_i], $past_temp4_jln_manthly_data2);
                                                                        }

                                                                // 全期間自社点数合計
                                                                    $past_jln_sum_number = (int)$past_jln_sum_number + (int)$past_jln_number[$past_i];



                                                                // 各月自社粗利
                                                                    $past_jln_arari[$past_i]= $past_jln_buy->jln_arari;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_jln_manthly_data3, $past_jln_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_jln_manthly_data3 = str_replace($past_jln_month[$past_i], $past_jln_arari[$past_i], $past_temp4_jln_manthly_data3);
                                                                        }

                                                                // 全期間自社粗利合計
                                                                    $past_jln_sum_arari = (int)$past_jln_sum_arari + (int)$past_jln_arari[$past_i];
                                                                    
                                                                $past_i++;
                                                            }

                                                        // 全期間自社売上合計とその平均値のHTML作成
                                                            $past_temp4_jln_sum = "";
                                                            if($past_jln_sum_uriage <> 0 && $past_jln_sum_uriage <> ""){
                                                                $past_jln_sum_uriage_c = number_format((int)$past_jln_sum_uriage); 
                                                                $past_jln_sum_uriage_ave = number_format(floor((int)$past_jln_sum_uriage / $past_i));
                                                                $past_jln_sum_uriage_ave2 = floor((int)$past_jln_sum_uriage / $past_i);
                                                            } else {
                                                                $past_jln_sum_uriage_c = $past_jln_sum_uriage; 
                                                                $past_jln_sum_uriage_ave = 0;
                                                                $past_jln_sum_uriage_ave2 = 0;
                                                            }
                                                            $past_temp4_jln_sum = "<div class='title4 ta_r'>" . $past_jln_sum_uriage_c . "</div><div class='title4 ta_r'>" . $past_jln_sum_uriage_ave . "</div></div>";
                                                        // 全期間自社売上点数合計とその平均値のHTML作成
                                                            $past_temp4_jln_sum2 = "";
                                                            if($past_jln_sum_number <> 0 && $past_jln_sum_number <> ""){
                                                                $past_jln_sum_number_c = number_format((int)$past_jln_sum_number); 
                                                                $past_jln_sum_number_ave = number_format(floor((int)$past_jln_sum_number / $past_i));
                                                                $past_jln_sum_number_ave2 = floor((int)$past_jln_sum_number / $past_i);
                                                            } else {
                                                                $past_jln_sum_number_c = $past_jln_sum_number; 
                                                                $past_jln_sum_number_ave = 0;
                                                                $past_jln_sum_number_ave2 = 0;
                                                            }
                                                            $past_temp4_jln_sum2 = "<div class='title4 ta_r'>" . $past_jln_sum_number_c . "</div><div class='title4 ta_r'>" . $past_jln_sum_number_ave . "</div></div>";
                                                        // 全期間自社粗利合計とその平均値のHTML作成
                                                            $past_temp4_jln_sum3 = "";
                                                            if($past_jln_sum_arari <> 0 && $past_jln_sum_arari <> ""){
                                                                $past_jln_sum_arari_c = number_format((int)$past_jln_sum_arari); 
                                                                $past_jln_sum_arari_ave = number_format(floor((int)$past_jln_sum_arari / $past_i));
                                                                $past_jln_sum_arari_ave2 = floor((int)$past_jln_sum_arari / $past_i);
                                                            } else {
                                                                $past_jln_sum_arari_c = $past_jln_sum_arari; 
                                                                $past_jln_sum_arari_ave = 0;
                                                                $past_jln_sum_arari_ave2 = 0;
                                                            }
                                                            $past_temp4_jln_sum3 = "<div class='title4 ta_r'>" . $past_jln_sum_arari_c . "</div><div class='title4 ta_r'>" . $past_jln_sum_arari_ave . "</div></div>";




                            /************************************************************************************************************************************************************************************************************* */
                                // ジュエリー・U用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */

                                            // DB検索（ジュエリー・U値）スタート
                                                $past_jlu_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS jlu_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS jlu_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS jlu_number"),
                                                        \DB::raw("SUM(ararikingaku) AS jlu_arari"),
                                                    ])
                                                    ->groupBy('jlu_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {

                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                    
                                                        })

                                                    // 条件（過去の期間））
                                                        ->whereBetween($table_name . '.uriage', [$past_between_start, $past_between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where("shouhinkubunbunruimei","like","%ｼﾞｭｴﾘｰ中古%")
                                                    // 条件（通販区分）
                                                        ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');
                            
                                                            // 条件（通販区分が自社）
                                                                if($out3_a == "ON"){
                                                                    $query->orWhere('tsuuhankubun',1);
                                                                }
                                                            // 条件（通販区分が楽天）
                                                                if($out3_b == "ON"){
                                                                    $query->orWhere('tsuuhankubun',2);
                                                                }
                                                            // 条件（通販区分がヤフー）
                                                                if($out3_c == "ON"){
                                                                    $query->orWhere('tsuuhankubun',3);
                                                                }
                                                            // 条件（通販区分が電話・雑誌）
                                                                if($out3_d == "ON"){
                                                                    $query->orWhere('tsuuhankubun',5);
                                                                }
                                                            // 条件（通販区分がYオークション）
                                                                if($out3_e == "ON"){
                                                                    $query->orWhere('tsuuhankubun',4);
                                                                }
                                                            // 条件（通販区分が修理品返送）
                                                                if($out3_f == "ON"){
                                                                    $query->orWhere('tsuuhankubun',9);
                                                                }
                            
                                                        })
                        
                                                    // 条件（免税）
                                                        ->where(function ($query) use ($out4_a,$out4_b) {
                                                                // 条件（免税区分が0:対象外）
                                                                    if($out4_a == "ON"){
                                                                        $query->orwhere("menzei","like","%対象外%");
                                                                    }
                                                                // 条件（免税区分が1:免税）
                                                                    if($out4_b == "ON"){
                                                                        $query->orwhere("menzei","like","%免税%");
                                                                    }
                                                        })
                                                    // 条件（扱い部門）
                                                        ->Where('bumonmei','Jewelry')
                                                        
                                                    // ソート順指定
                                                        ->orderBy('uriage', 'asc')
                                                        ->get();
                                                    // クエリビルダスタート
                                                        $past_i = 0;
                                                        // 変数リセット
                                                            $past_jlu_sum_uriage = "";
                                                            $past_jlu_sum_number = "";
                                                            $past_jlu_sum_arari= "";
                                                            foreach ($past_jlu_buys as $past_jlu_buy) {
                                                                // 各月名
                                                                    $past_jlu_month[$past_i]= $past_jlu_buy->jlu_month;
                                                                // 各月自社売上
                                                                    $past_jlu_uriage[$past_i]= $past_jlu_buy->jlu_uriage;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_jlu_manthly_data, $past_jlu_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_jlu_manthly_data = str_replace($past_jlu_month[$past_i], $past_jlu_uriage[$past_i], $past_temp4_jlu_manthly_data);
                                                                        }

                                                                // 全期間自社売上合計
                                                                    $past_jlu_sum_uriage = (int)$past_jlu_sum_uriage + (int)$past_jlu_uriage[$past_i];

                                                                // 各月自社点数
                                                                    $past_jlu_number[$past_i]= $past_jlu_buy->jlu_number;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_jlu_manthly_data2, $past_jlu_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_jlu_manthly_data2 = str_replace($past_jlu_month[$past_i], $past_jlu_number[$past_i], $past_temp4_jlu_manthly_data2);
                                                                        }

                                                                // 全期間自社点数合計
                                                                    $past_jlu_sum_number = (int)$past_jlu_sum_number + (int)$past_jlu_number[$past_i];



                                                                // 各月自社粗利
                                                                    $past_jlu_arari[$past_i]= $past_jlu_buy->jlu_arari;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_jlu_manthly_data3, $past_jlu_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_jlu_manthly_data3 = str_replace($past_jlu_month[$past_i], $past_jlu_arari[$past_i], $past_temp4_jlu_manthly_data3);
                                                                        }

                                                                // 全期間自社粗利合計
                                                                    $past_jlu_sum_arari = (int)$past_jlu_sum_arari + (int)$past_jlu_arari[$past_i];
                                                                    
                                                                $past_i++;
                                                            }

                                                        // 全期間自社売上合計とその平均値のHTML作成
                                                            $past_temp4_jlu_sum = "";
                                                            if($past_jlu_sum_uriage <> 0 && $past_jlu_sum_uriage <> ""){
                                                                $past_jlu_sum_uriage_c = number_format((int)$past_jlu_sum_uriage); 
                                                                $past_jlu_sum_uriage_ave = number_format(floor((int)$past_jlu_sum_uriage / $past_i));
                                                                $past_jlu_sum_uriage_ave2 = floor((int)$past_jlu_sum_uriage / $past_i);
                                                            } else {
                                                                $past_jlu_sum_uriage_c = $past_jlu_sum_uriage; 
                                                                $past_jlu_sum_uriage_ave = 0;
                                                                $past_jlu_sum_uriage_ave2 = 0;
                                                            }
                                                            $past_temp4_jlu_sum = "<div class='title4 ta_r'>" . $past_jlu_sum_uriage_c . "</div><div class='title4 ta_r'>" . $past_jlu_sum_uriage_ave . "</div></div>";
                                                        // 全期間自社売上点数合計とその平均値のHTML作成
                                                            $past_temp4_jlu_sum2 = "";
                                                            if($past_jlu_sum_number <> 0 && $past_jlu_sum_number <> ""){
                                                                $past_jlu_sum_number_c = number_format((int)$past_jlu_sum_number); 
                                                                $past_jlu_sum_number_ave = number_format(floor((int)$past_jlu_sum_number / $past_i));
                                                                $past_jlu_sum_number_ave2 = floor((int)$past_jlu_sum_number / $past_i);
                                                            } else {
                                                                $past_jlu_sum_number_c = $past_jlu_sum_number; 
                                                                $past_jlu_sum_number_ave = 0;
                                                                $past_jlu_sum_number_ave2 = 0;
                                                            }
                                                            $past_temp4_jlu_sum2 = "<div class='title4 ta_r'>" . $past_jlu_sum_number_c . "</div><div class='title4 ta_r'>" . $past_jlu_sum_number_ave . "</div></div>";
                                                        // 全期間自社粗利合計とその平均値のHTML作成
                                                            $past_temp4_jlu_sum3 = "";
                                                            if($past_jlu_sum_arari <> 0 && $past_jlu_sum_arari <> ""){
                                                                $past_jlu_sum_arari_c = number_format((int)$past_jlu_sum_arari); 
                                                                $past_jlu_sum_arari_ave = number_format(floor((int)$past_jlu_sum_arari / $past_i));
                                                                $past_jlu_sum_arari_ave2 = floor((int)$past_jlu_sum_arari / $past_i);
                                                            } else {
                                                                $past_jlu_sum_arari_c = $past_jlu_sum_arari; 
                                                                $past_jlu_sum_arari_ave = 0;
                                                                $past_jlu_sum_arari_ave2 = 0;
                                                            }
                                                            $past_temp4_jlu_sum3 = "<div class='title4 ta_r'>" . $past_jlu_sum_arari_c . "</div><div class='title4 ta_r'>" . $past_jlu_sum_arari_ave . "</div></div>";




                            /************************************************************************************************************************************************************************************************************* */
                                // バッグ・N用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */

                                            // DB検索（バッグ・N値）スタート
                                                $past_bgn_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS bgn_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS bgn_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS bgn_number"),
                                                        \DB::raw("SUM(ararikingaku) AS bgn_arari"),
                                                    ])
                                                    ->groupBy('bgn_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {

                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                    
                                                        })

                                                    // 条件（過去の期間））
                                                        ->whereBetween($table_name . '.uriage', [$past_between_start, $past_between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where("shouhinkubunbunruimei","like","%ﾊﾞｯｸﾞ新品%")
                                                    // 条件（通販区分）
                                                        ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');
                            
                                                            // 条件（通販区分が自社）
                                                                if($out3_a == "ON"){
                                                                    $query->orWhere('tsuuhankubun',1);
                                                                }
                                                            // 条件（通販区分が楽天）
                                                                if($out3_b == "ON"){
                                                                    $query->orWhere('tsuuhankubun',2);
                                                                }
                                                            // 条件（通販区分がヤフー）
                                                                if($out3_c == "ON"){
                                                                    $query->orWhere('tsuuhankubun',3);
                                                                }
                                                            // 条件（通販区分が電話・雑誌）
                                                                if($out3_d == "ON"){
                                                                    $query->orWhere('tsuuhankubun',5);
                                                                }
                                                            // 条件（通販区分がYオークション）
                                                                if($out3_e == "ON"){
                                                                    $query->orWhere('tsuuhankubun',4);
                                                                }
                                                            // 条件（通販区分が修理品返送）
                                                                if($out3_f == "ON"){
                                                                    $query->orWhere('tsuuhankubun',9);
                                                                }
                            
                                                        })
                        
                                                    // 条件（免税）
                                                        ->where(function ($query) use ($out4_a,$out4_b) {
                                                                // 条件（免税区分が0:対象外）
                                                                    if($out4_a == "ON"){
                                                                        $query->orwhere("menzei","like","%対象外%");
                                                                    }
                                                                // 条件（免税区分が1:免税）
                                                                    if($out4_b == "ON"){
                                                                        $query->orwhere("menzei","like","%免税%");
                                                                    }
                                                        })
                                                    // 条件（扱い部門）
                                                        ->Where('bumonmei','Jewelry')
                                                        
                                                    // ソート順指定
                                                        ->orderBy('uriage', 'asc')
                                                        ->get();
                                                    // クエリビルダスタート
                                                        $past_i = 0;
                                                        // 変数リセット
                                                            $past_bgn_sum_uriage = "";
                                                            $past_bgn_sum_number = "";
                                                            $past_bgn_sum_arari= "";
                                                            foreach ($past_bgn_buys as $past_bgn_buy) {
                                                                // 各月名
                                                                    $past_bgn_month[$past_i]= $past_bgn_buy->bgn_month;
                                                                // 各月自社売上
                                                                    $past_bgn_uriage[$past_i]= $past_bgn_buy->bgn_uriage;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_bgn_manthly_data, $past_bgn_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_bgn_manthly_data = str_replace($past_bgn_month[$past_i], $past_bgn_uriage[$past_i], $past_temp4_bgn_manthly_data);
                                                                        }

                                                                // 全期間自社売上合計
                                                                    $past_bgn_sum_uriage = (int)$past_bgn_sum_uriage + (int)$past_bgn_uriage[$past_i];

                                                                // 各月自社点数
                                                                    $past_bgn_number[$past_i]= $past_bgn_buy->bgn_number;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_bgn_manthly_data2, $past_bgn_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_bgn_manthly_data2 = str_replace($past_bgn_month[$past_i], $past_bgn_number[$past_i], $past_temp4_bgn_manthly_data2);
                                                                        }

                                                                // 全期間自社点数合計
                                                                    $past_bgn_sum_number = (int)$past_bgn_sum_number + (int)$past_bgn_number[$past_i];



                                                                // 各月自社粗利
                                                                    $past_bgn_arari[$past_i]= $past_bgn_buy->bgn_arari;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_bgn_manthly_data3, $past_bgn_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_bgn_manthly_data3 = str_replace($past_bgn_month[$past_i], $past_bgn_arari[$past_i], $past_temp4_bgn_manthly_data3);
                                                                        }

                                                                // 全期間自社粗利合計
                                                                    $past_bgn_sum_arari = (int)$past_bgn_sum_arari + (int)$past_bgn_arari[$past_i];
                                                                    
                                                                $past_i++;
                                                            }

                                                        // 全期間自社売上合計とその平均値のHTML作成
                                                            $past_temp4_bgn_sum = "";
                                                            if($past_bgn_sum_uriage <> 0 && $past_bgn_sum_uriage <> ""){
                                                                $past_bgn_sum_uriage_c = number_format((int)$past_bgn_sum_uriage); 
                                                                $past_bgn_sum_uriage_ave = number_format(floor((int)$past_bgn_sum_uriage / $past_i));
                                                                $past_bgn_sum_uriage_ave2 = floor((int)$past_bgn_sum_uriage / $past_i);
                                                            } else {
                                                                $past_bgn_sum_uriage_c = $past_bgn_sum_uriage; 
                                                                $past_bgn_sum_uriage_ave = 0;
                                                                $past_bgn_sum_uriage_ave2 = 0;
                                                            }
                                                            $past_temp4_bgn_sum = "<div class='title4 ta_r'>" . $past_bgn_sum_uriage_c . "</div><div class='title4 ta_r'>" . $past_bgn_sum_uriage_ave . "</div></div>";
                                                        // 全期間自社売上点数合計とその平均値のHTML作成
                                                            $past_temp4_bgn_sum2 = "";
                                                            if($past_bgn_sum_number <> 0 && $past_bgn_sum_number <> ""){
                                                                $past_bgn_sum_number_c = number_format((int)$past_bgn_sum_number); 
                                                                $past_bgn_sum_number_ave = number_format(floor((int)$past_bgn_sum_number / $past_i));
                                                                $past_bgn_sum_number_ave2 = floor((int)$past_bgn_sum_number / $past_i);
                                                            } else {
                                                                $past_bgn_sum_number_c = $past_bgn_sum_number; 
                                                                $past_bgn_sum_number_ave = 0;
                                                                $past_bgn_sum_number_ave2 = 0;
                                                            }
                                                            $past_temp4_bgn_sum2 = "<div class='title4 ta_r'>" . $past_bgn_sum_number_c . "</div><div class='title4 ta_r'>" . $past_bgn_sum_number_ave . "</div></div>";
                                                        // 全期間自社粗利合計とその平均値のHTML作成
                                                            $past_temp4_bgn_sum3 = "";
                                                            if($past_bgn_sum_arari <> 0 && $past_bgn_sum_arari <> ""){
                                                                $past_bgn_sum_arari_c = number_format((int)$past_bgn_sum_arari); 
                                                                $past_bgn_sum_arari_ave = number_format(floor((int)$past_bgn_sum_arari / $past_i));
                                                                $past_bgn_sum_arari_ave2 = floor((int)$past_bgn_sum_arari / $past_i);
                                                            } else {
                                                                $past_bgn_sum_arari_c = $past_bgn_sum_arari; 
                                                                $past_bgn_sum_arari_ave = 0;
                                                                $past_bgn_sum_arari_ave2 = 0;
                                                            }
                                                            $past_temp4_bgn_sum3 = "<div class='title4 ta_r'>" . $past_bgn_sum_arari_c . "</div><div class='title4 ta_r'>" . $past_bgn_sum_arari_ave . "</div></div>";



                            /************************************************************************************************************************************************************************************************************* */
                                // バッグ・U用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */

                                            // DB検索（バッグ・U値）スタート
                                                $past_bgu_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS bgu_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS bgu_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS bgu_number"),
                                                        \DB::raw("SUM(ararikingaku) AS bgu_arari"),
                                                    ])
                                                    ->groupBy('bgu_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {

                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                    
                                                        })

                                                    // 条件（過去の期間））
                                                        ->whereBetween($table_name . '.uriage', [$past_between_start, $past_between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where("shouhinkubunbunruimei","like","%ﾊﾞｯｸﾞ中古%")
                                                    // 条件（通販区分）
                                                        ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');
                            
                                                            // 条件（通販区分が自社）
                                                                if($out3_a == "ON"){
                                                                    $query->orWhere('tsuuhankubun',1);
                                                                }
                                                            // 条件（通販区分が楽天）
                                                                if($out3_b == "ON"){
                                                                    $query->orWhere('tsuuhankubun',2);
                                                                }
                                                            // 条件（通販区分がヤフー）
                                                                if($out3_c == "ON"){
                                                                    $query->orWhere('tsuuhankubun',3);
                                                                }
                                                            // 条件（通販区分が電話・雑誌）
                                                                if($out3_d == "ON"){
                                                                    $query->orWhere('tsuuhankubun',5);
                                                                }
                                                            // 条件（通販区分がYオークション）
                                                                if($out3_e == "ON"){
                                                                    $query->orWhere('tsuuhankubun',4);
                                                                }
                                                            // 条件（通販区分が修理品返送）
                                                                if($out3_f == "ON"){
                                                                    $query->orWhere('tsuuhankubun',9);
                                                                }
                            
                                                        })
                        
                                                    // 条件（免税）
                                                        ->where(function ($query) use ($out4_a,$out4_b) {
                                                                // 条件（免税区分が0:対象外）
                                                                    if($out4_a == "ON"){
                                                                        $query->orwhere("menzei","like","%対象外%");
                                                                    }
                                                                // 条件（免税区分が1:免税）
                                                                    if($out4_b == "ON"){
                                                                        $query->orwhere("menzei","like","%免税%");
                                                                    }
                                                        })
                                                    // 条件（扱い部門）
                                                        ->Where('bumonmei','Jewelry')
                                                        
                                                    // ソート順指定
                                                        ->orderBy('uriage', 'asc')
                                                        ->get();
                                                    // クエリビルダスタート
                                                        $past_i = 0;
                                                        // 変数リセット
                                                            $past_bgu_sum_uriage = "";
                                                            $past_bgu_sum_number = "";
                                                            $past_bgu_sum_arari= "";
                                                            foreach ($past_bgu_buys as $past_bgu_buy) {
                                                                // 各月名
                                                                    $past_bgu_month[$past_i]= $past_bgu_buy->bgu_month;
                                                                // 各月自社売上
                                                                    $past_bgu_uriage[$past_i]= $past_bgu_buy->bgu_uriage;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_bgu_manthly_data, $past_bgu_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_bgu_manthly_data = str_replace($past_bgu_month[$past_i], $past_bgu_uriage[$past_i], $past_temp4_bgu_manthly_data);
                                                                        }

                                                                // 全期間自社売上合計
                                                                    $past_bgu_sum_uriage = (int)$past_bgu_sum_uriage + (int)$past_bgu_uriage[$past_i];

                                                                // 各月自社点数
                                                                    $past_bgu_number[$past_i]= $past_bgu_buy->bgu_number;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_bgu_manthly_data2, $past_bgu_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_bgu_manthly_data2 = str_replace($past_bgu_month[$past_i], $past_bgu_number[$past_i], $past_temp4_bgu_manthly_data2);
                                                                        }

                                                                // 全期間自社点数合計
                                                                    $past_bgu_sum_number = (int)$past_bgu_sum_number + (int)$past_bgu_number[$past_i];



                                                                // 各月自社粗利
                                                                    $past_bgu_arari[$past_i]= $past_bgu_buy->bgu_arari;
                                                                    // 全過去期間に現在の期間が含まれている場合
                                                                        if(strpos($past_temp4_bgu_manthly_data3, $past_bgu_month[$past_i] ) !== false){
                                                                            // 文字列の同期間名を現在月の売上に書き換え
                                                                                $past_temp4_bgu_manthly_data3 = str_replace($past_bgu_month[$past_i], $past_bgu_arari[$past_i], $past_temp4_bgu_manthly_data3);
                                                                        }

                                                                // 全期間自社粗利合計
                                                                    $past_bgu_sum_arari = (int)$past_bgu_sum_arari + (int)$past_bgu_arari[$past_i];
                                                                    
                                                                $past_i++;
                                                            }

                                                        // 全期間自社売上合計とその平均値のHTML作成
                                                            $past_temp4_bgu_sum = "";
                                                            if($past_bgu_sum_uriage <> 0 && $past_bgu_sum_uriage <> ""){
                                                                $past_bgu_sum_uriage_c = number_format((int)$past_bgu_sum_uriage); 
                                                                $past_bgu_sum_uriage_ave = number_format(floor((int)$past_bgu_sum_uriage / $past_i));
                                                                $past_bgu_sum_uriage_ave2 = floor((int)$past_bgu_sum_uriage / $past_i);
                                                            } else {
                                                                $past_bgu_sum_uriage_c = $past_bgu_sum_uriage; 
                                                                $past_bgu_sum_uriage_ave = 0;
                                                                $past_bgu_sum_uriage_ave2 = 0;
                                                            }
                                                            $past_temp4_bgu_sum = "<div class='title4 ta_r'>" . $past_bgu_sum_uriage_c . "</div><div class='title4 ta_r'>" . $past_bgu_sum_uriage_ave . "</div></div>";
                                                        // 全期間自社売上点数合計とその平均値のHTML作成
                                                            $past_temp4_bgu_sum2 = "";
                                                            if($past_bgu_sum_number <> 0 && $past_bgu_sum_number <> ""){
                                                                $past_bgu_sum_number_c = number_format((int)$past_bgu_sum_number); 
                                                                $past_bgu_sum_number_ave = number_format(floor((int)$past_bgu_sum_number / $past_i));
                                                                $past_bgu_sum_number_ave2 = floor((int)$past_bgu_sum_number / $past_i);
                                                            } else {
                                                                $past_bgu_sum_number_c = $past_bgu_sum_number; 
                                                                $past_bgu_sum_number_ave = 0;
                                                                $past_bgu_sum_number_ave2 = 0;
                                                            }
                                                            $past_temp4_bgu_sum2 = "<div class='title4 ta_r'>" . $past_bgu_sum_number_c . "</div><div class='title4 ta_r'>" . $past_bgu_sum_number_ave . "</div></div>";
                                                        // 全期間自社粗利合計とその平均値のHTML作成
                                                            $past_temp4_bgu_sum3 = "";
                                                            if($past_bgu_sum_arari <> 0 && $past_bgu_sum_arari <> ""){
                                                                $past_bgu_sum_arari_c = number_format((int)$past_bgu_sum_arari); 
                                                                $past_bgu_sum_arari_ave = number_format(floor((int)$past_bgu_sum_arari / $past_i));
                             
                                                                $past_bgu_sum_arari_ave2 = floor((int)$past_bgu_sum_arari / $past_i);
                                                            } else {
                                                                $past_bgu_sum_arari_c = $past_bgu_sum_arari; 
                                                                $past_bgu_sum_arari_ave = 0;
                                                                $past_bgu_sum_arari_ave2 = 0;
                                                            }
                                                            $past_temp4_bgu_sum3 = "<div class='title4 ta_r'>" . $past_bgu_sum_arari_c . "</div><div class='title4 ta_r'>" . $past_bgu_sum_arari_ave . "</div></div>";



                            /************************************************************************************************************************************************************************************************************* */
                                // 全件用
                            /************************************************************************************************************************************************************************************************************* */

                                        // 各月の全部門売上合計の先頭（1列目）部分のタイトルHTML
                                            //$past_all_sum_uriage = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $past_all_sum_number = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                        // 各月のタイトル表示用HTMLを作成
                                            $js_month = "";
                                            foreach($manth_now_array as $val){
                                                // JSグラフ用
                                                    $js_month .= "'" . $val . "(" . date("Y-m", strtotime($val. " -" . ($diff_month + 1) . " month")) . ")'" . ",";
                                            }
                                            $past_temp4_title2 = "";
                                            $past_temp4_title3 = "";
                                            $past_temp4_title4 = "";
                                            $past_temp4_title5 = "";
                                            foreach($manth_past_array as $val){
                                                // 表示用
                                                    $val = mb_substr($val,0,-3);
                                                    $past_temp4_title2 .= "<div class='title2 ta_c'>" . $val . "</div>";
                                                    $past_temp4_title3 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                                    $past_temp4_title4 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                                    $past_temp4_title5 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                            }
                                
                                            $past_temp4_title = "<div class='wid100 ul2'><div class='title5 ta_c'>" . $past_between_start_view. "～<br>" .$past_between_end_view . "</div>" .$past_temp4_title2 ."<div class='title6 ta_c'>累計</div><div class='title6 ta_c'>平均</div></div>";
                                            $past_temp4_title3 = "<div class='wid100 ul2'><div class='title7 ta_c'>" . $past_between_start_view. "～<br>" .$past_between_end_view . "</div>" .$past_temp4_title3 ."<div class='title7 ta_c'>平均</div></div>";
                                            $past_temp4_title4 = "<div class='wid100 ul2 bg_green'><div class='title7 ta_c'>" . $past_between_start_view. "～<br>" .$past_between_end_view . "</div>" .$past_temp4_title4 ."<div class='title7 ta_c'>平均</div></div>";
                                            $past_temp4_title5 = "<div class='wid100 ul2 bg_yellow'><div class='title7 ta_c'>" . $past_between_start_view. "～<br>" .$past_between_end_view . "</div>" .$past_temp4_title5 ."<div class='title7 ta_c'>平均</div></div>";


                                        // 全期間の全部門売上合計用変数リセット
                                            $past_all_sum_uriage_all = 0;
                                            $past_all_sum_number_all = 0;
                                            $past_all_sum_arari_all = 0;
                                            for($past_all_i = 0; $past_all_i < $past_i; $past_all_i++){
                                                // 各月の全部門売上合計用変数リセット
                                                    $past_all_month_uriage = 0;
                                                    $past_all_month_number= 0;
                                                    $past_all_month_arari= 0;
                                                // 各月の全部門売上合計をHTMLへ
                                                        if(isset($past_jn_uriage[$past_all_i])){$past_all_month_uriage = $past_all_month_uriage + (int)$past_jn_uriage[$past_all_i];}
                                                        if(isset($past_jn_number[$past_all_i])){$past_all_month_number = $past_all_month_number + (int)$past_jn_number[$past_all_i]; }
                                                        if(isset($past_jn_arari[$past_all_i])){$past_all_month_arari = $past_all_month_arari + (int)$past_jn_arari[$past_all_i]; }
                                                        if(isset($past_ju_uriage[$past_all_i])){$past_all_month_uriage = $past_all_month_uriage + (int)$past_ju_uriage[$past_all_i]; }
                                                        if(isset($past_ju_number[$past_all_i])){$past_all_month_number = $past_all_month_number + (int)$past_ju_number[$past_all_i];} 
                                                        if(isset($past_ju_arari[$past_all_i])){$past_all_month_arari = $past_all_month_arari + (int)$past_ju_arari[$past_all_i]; }
                                                        if(isset($past_ja_uriage[$past_all_i])){ $past_all_month_uriage = $past_all_month_uriage + (int)$past_ja_uriage[$past_all_i]; }
                                                        if(isset($past_ja_number[$past_all_i])){ $past_all_month_number = $past_all_month_number + (int)$past_ja_number[$past_all_i]; }
                                                        if(isset($past_ja_arari[$past_all_i])){ $past_all_month_arari = $past_all_month_arari + (int)$past_ja_arari[$past_all_i]; }
                                                        if(isset($past_bn_uriage[$past_all_i])){ $past_all_month_uriage = $past_all_month_uriage + (int)$past_bn_uriage[$past_all_i]; }
                                                        if(isset($past_bn_number[$past_all_i])){ $past_all_month_number = $past_all_month_number + (int)$past_bn_number[$past_all_i]; }
                                                        if(isset($past_bn_arari[$past_all_i])){ $past_all_month_arari = $past_all_month_arari + (int)$past_bn_arari[$past_all_i]; }
                                                        if(isset($past_bu_uriage[$past_all_i])){ $past_all_month_uriage = $past_all_month_uriage + (int)$past_bu_uriage[$past_all_i]; }
                                                        if(isset($past_bu_number[$past_all_i])){ $past_all_month_number = $past_all_month_number + (int)$past_bu_number[$past_all_i]; }
                                                        if(isset($past_bu_arari[$past_all_i])){ $past_all_month_arari = $past_all_month_arari + (int)$past_bu_arari[$past_all_i]; }
                                                        if(isset($past_ba_uriage[$past_all_i])){ $past_all_month_uriage = $past_all_month_uriage + (int)$past_ba_uriage[$past_all_i]; }
                                                        if(isset($past_ba_number[$past_all_i])){ $past_all_month_number = $past_all_month_number + (int)$past_ba_number[$past_all_i]; }
                                                        if(isset($past_ba_arari[$past_all_i])){ $past_all_month_arari = $past_all_month_arari + (int)$past_ba_arari[$past_all_i]; }
                                                        if(isset($past_jln_uriage[$past_all_i])){ $past_all_month_uriage = $past_all_month_uriage + (int)$past_jln_uriage[$past_all_i]; }
                                                        if(isset($past_jln_number[$past_all_i])){ $past_all_month_number = $past_all_month_number + (int)$past_jln_number[$past_all_i]; }
                                                        if(isset($past_jln_arari[$past_all_i])){ $past_all_month_arari = $past_all_month_arari + (int)$past_jln_arari[$past_all_i]; }
                                                        if(isset($past_jlu_uriage[$past_all_i])){ $past_all_month_uriage = $past_all_month_uriage + (int)$past_jlu_uriage[$past_all_i]; }
                                                        if(isset($past_jlu_number[$past_all_i])){ $past_all_month_number = $past_all_month_number + (int)$past_jlu_number[$past_all_i]; }
                                                        if(isset($past_jlu_arari[$past_all_i])){ $past_all_month_arari = $past_all_month_arari + (int)$past_jlu_arari[$past_all_i]; }
                                                        if(isset($past_bgn_uriage[$past_all_i])){ $past_all_month_uriage = $past_all_month_uriage + (int)$past_bgn_uriage[$past_all_i]; }
                                                        if(isset($past_bgn_number[$past_all_i])){ $past_all_month_number = $past_all_month_number + (int)$past_bgn_number[$past_all_i]; }
                                                        if(isset($past_bgn_arari[$past_all_i])){ $past_all_month_arari = $past_all_month_arari + (int)$past_bgn_arari[$past_all_i]; }
                                                        if(isset($past_bgu_uriage[$past_all_i])){ $past_all_month_uriage = $past_all_month_uriage + (int)$past_bgu_uriage[$past_all_i]; }
                                                        if(isset($past_bgu_number[$past_all_i])){ $past_all_month_number = $past_all_month_number + (int)$past_bgu_number[$past_all_i]; }
                                                        if(isset($past_bgu_arari[$past_all_i])){ $past_all_month_arari = $past_all_month_arari + (int)$past_bgu_arari[$past_all_i]; }

                                                 // 全期間の全部門売上合計
                                                    $past_all_sum_uriage_all = (int)$past_all_sum_uriage_all + (int)$past_all_month_uriage;
                                                    $past_all_sum_number_all = (int)$past_all_sum_number_all + (int)$past_all_month_number;
                                                    $past_all_sum_arari_all = (int)$past_all_sum_arari_all + (int)$past_all_month_arari;
                                                
                                            }

                            /************************************************************************************************************************************************************************************************************* */
                                // 最終ソース出力
                            /************************************************************************************************************************************************************************************************************* */


                                        // Jack・新品（過去）用HTMLの作成
                                                $past_js_jn_uriage  = "";
                                                $past_js_jn_number  = "";
                                                $past_js_jn_arari  = "";
                                                $past_temp4_jn_manthly_html = "";
                                                $past_temp4_jn_manthly_html2 = "";
                                                $past_temp4_jn_manthly_html3 = "";
                                                // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                    foreach($manth_past_array as $val){
                                                            $val = mb_substr($val,0,-3);
                                                            if(strpos($past_temp4_jn_manthly_data, $val ) !== false){
                                                                $past_temp4_jn_manthly_data = str_replace($val, 0, $past_temp4_jn_manthly_data);
                                                            }
                                                            if(strpos($past_temp4_jn_manthly_data2, $val ) !== false){
                                                                $past_temp4_jn_manthly_data2 = str_replace($val, 0, $past_temp4_jn_manthly_data2);
                                                            }
                                                            if(strpos($past_temp4_jn_manthly_data3, $val ) !== false){
                                                                $past_temp4_jn_manthly_data3 = str_replace($val, 0, $past_temp4_jn_manthly_data3);
                                                            }
                                                    }
                                                // 各月売上が記載された文字列を配列へ変換
                                                    $past_temp4_jn_manthly_array = explode(',',$past_temp4_jn_manthly_data);
                                                    $past_temp4_jn_manthly_array2 = explode(',',$past_temp4_jn_manthly_data2);
                                                    $past_temp4_jn_manthly_array3 = explode(',',$past_temp4_jn_manthly_data3);
                                                // 各月のHTMLを作成
                                                    $past_jn_last_uriage = "";
                                                    foreach($past_temp4_jn_manthly_array as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_jn_uriage  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_jn_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_jn_uriage  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_jn_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp4_jn_manthly_array2 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_jn_number  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_jn_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_jn_number  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_jn_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp4_jn_manthly_array3 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_jn_arari  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_jn_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_jn_arari  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_jn_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    // 全体HTMLの作成
                                                        if(isset($past_temp4_jn_manthly_html) && isset($past_temp4_jn_sum)){
                                                            $past_temp4_jn_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>ジャック・N</div>" . $past_temp4_jn_manthly_html . $past_temp4_jn_sum;
                                                        }
                                                        if(isset($past_temp4_jn_manthly_html2) && isset($past_temp4_jn_sum2)){
                                                            $past_temp4_jn_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>ジャック・N</div>" . $past_temp4_jn_manthly_html2 . $past_temp4_jn_sum2;
                                                        }
                                                        if(isset($past_temp4_jn_manthly_html3) && isset($past_temp4_jn_sum3)){
                                                            $past_temp4_jn_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>ジャック・N</div>" . $past_temp4_jn_manthly_html3 . $past_temp4_jn_sum3;
                                                        }



                                        // Jack・中古（過去）用HTMLの作成
                                                $past_js_ju_uriage  = "";
                                                $past_js_ju_number  = "";
                                                $past_js_ju_arari  = "";
                                                $past_temp4_ju_manthly_html = "";
                                                $past_temp4_ju_manthly_html2 = "";
                                                $past_temp4_ju_manthly_html3 = "";
                                                // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                    foreach($manth_past_array as $val){
                                                            $val = mb_substr($val,0,-3);
                                                            if(strpos($past_temp4_ju_manthly_data, $val ) !== false){
                                                                $past_temp4_ju_manthly_data = str_replace($val, 0, $past_temp4_ju_manthly_data);
                                                            }
                                                            if(strpos($past_temp4_ju_manthly_data2, $val ) !== false){
                                                                $past_temp4_ju_manthly_data2 = str_replace($val, 0, $past_temp4_ju_manthly_data2);
                                                            }
                                                            if(strpos($past_temp4_ju_manthly_data3, $val ) !== false){
                                                                $past_temp4_ju_manthly_data3 = str_replace($val, 0, $past_temp4_ju_manthly_data3);
                                                            }
                                                    }
                                                // 各月売上が記載された文字列を配列へ変換
                                                    $past_temp4_ju_manthly_array = explode(',',$past_temp4_ju_manthly_data);
                                                    $past_temp4_ju_manthly_array2 = explode(',',$past_temp4_ju_manthly_data2);
                                                    $past_temp4_ju_manthly_array3 = explode(',',$past_temp4_ju_manthly_data3);
                                                // 各月のHTMLを作成
                                                    $past_ju_last_uriage = "";
                                                    foreach($past_temp4_ju_manthly_array as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_ju_uriage  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_ju_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_ju_uriage  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_ju_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp4_ju_manthly_array2 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_ju_number  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_ju_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_ju_number  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_ju_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp4_ju_manthly_array3 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_ju_arari  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_ju_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_ju_arari  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_ju_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    // 全体HTMLの作成
                                                        if(isset($past_temp4_ju_manthly_html) && isset($past_temp4_ju_sum)){
                                                            $past_temp4_ju_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>ジャック・U</div>" . $past_temp4_ju_manthly_html . $past_temp4_ju_sum;
                                                        }
                                                        if(isset($past_temp4_ju_manthly_html2) && isset($past_temp4_ju_sum2)){
                                                            $past_temp4_ju_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>ジャック・U</div>" . $past_temp4_ju_manthly_html2 . $past_temp4_ju_sum2;
                                                        }
                                                        if(isset($past_temp4_ju_manthly_html3) && isset($past_temp4_ju_sum3)){
                                                            $past_temp4_ju_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>ジャック・U</div>" . $past_temp4_ju_manthly_html3 . $past_temp4_ju_sum3;
                                                        }


 
 
                                        // Jack・アンティーク（過去）用HTMLの作成
                                                $past_js_ja_uriage  = "";
                                                $past_js_ja_number  = "";
                                                $past_js_ja_arari  = "";
                                                $past_temp4_ja_manthly_html = "";
                                                $past_temp4_ja_manthly_html2 = "";
                                                $past_temp4_ja_manthly_html3 = "";
                                                // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                    foreach($manth_past_array as $val){
                                                            $val = mb_substr($val,0,-3);
                                                            if(strpos($past_temp4_ja_manthly_data, $val ) !== false){
                                                                $past_temp4_ja_manthly_data = str_replace($val, 0, $past_temp4_ja_manthly_data);
                                                            }
                                                            if(strpos($past_temp4_ja_manthly_data2, $val ) !== false){
                                                                $past_temp4_ja_manthly_data2 = str_replace($val, 0, $past_temp4_ja_manthly_data2);
                                                            }
                                                            if(strpos($past_temp4_ja_manthly_data3, $val ) !== false){
                                                                $past_temp4_ja_manthly_data3 = str_replace($val, 0, $past_temp4_ja_manthly_data3);
                                                            }
                                                    }
                                                // 各月売上が記載された文字列を配列へ変換
                                                    $past_temp4_ja_manthly_array = explode(',',$past_temp4_ja_manthly_data);
                                                    $past_temp4_ja_manthly_array2 = explode(',',$past_temp4_ja_manthly_data2);
                                                    $past_temp4_ja_manthly_array3 = explode(',',$past_temp4_ja_manthly_data3);
                                                // 各月のHTMLを作成
                                                    $past_ja_last_uriage = "";
                                                    foreach($past_temp4_ja_manthly_array as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_ja_uriage  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_ja_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_ja_uriage  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_ja_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp4_ja_manthly_array2 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_ja_number  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_ja_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_ja_number  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_ja_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp4_ja_manthly_array3 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_ja_arari  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_ja_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_ja_arari  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_ja_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    // 全体HTMLの作成
                                                        if(isset($past_temp4_ja_manthly_html) && isset($past_temp4_ja_sum)){
                                                            $past_temp4_ja_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>ジャック・A</div>" . $past_temp4_ja_manthly_html . $past_temp4_ja_sum;
                                                        }
                                                        if(isset($past_temp4_ja_manthly_html2) && isset($past_temp4_ja_sum2)){
                                                            $past_temp4_ja_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>ジャック・A</div>" . $past_temp4_ja_manthly_html2 . $past_temp4_ja_sum2;
                                                        }
                                                        if(isset($past_temp4_ja_manthly_html3) && isset($past_temp4_ja_sum3)){
                                                            $past_temp4_ja_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>ジャック・A</div>" . $past_temp4_ja_manthly_html3 . $past_temp4_ja_sum3;
                                                        }

 
 
 
                                        // Betty・新品（過去）用HTMLの作成
                                                $past_js_bn_uriage  = "";
                                                $past_js_bn_number  = "";
                                                $past_js_bn_arari  = "";
                                                $past_temp4_bn_manthly_html = "";
                                                $past_temp4_bn_manthly_html2 = "";
                                                $past_temp4_bn_manthly_html3 = "";
                                                // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                    foreach($manth_past_array as $val){
                                                            $val = mb_substr($val,0,-3);
                                                            if(strpos($past_temp4_bn_manthly_data, $val ) !== false){
                                                                $past_temp4_bn_manthly_data = str_replace($val, 0, $past_temp4_bn_manthly_data);
                                                            }
                                                            if(strpos($past_temp4_bn_manthly_data2, $val ) !== false){
                                                                $past_temp4_bn_manthly_data2 = str_replace($val, 0, $past_temp4_bn_manthly_data2);
                                                            }
                                                            if(strpos($past_temp4_bn_manthly_data3, $val ) !== false){
                                                                $past_temp4_bn_manthly_data3 = str_replace($val, 0, $past_temp4_bn_manthly_data3);
                                                            }
                                                    }
                                                // 各月売上が記載された文字列を配列へ変換
                                                    $past_temp4_bn_manthly_array = explode(',',$past_temp4_bn_manthly_data);
                                                    $past_temp4_bn_manthly_array2 = explode(',',$past_temp4_bn_manthly_data2);
                                                    $past_temp4_bn_manthly_array3 = explode(',',$past_temp4_bn_manthly_data3);
                                                // 各月のHTMLを作成
                                                    $past_bn_last_uriage = "";
                                                    foreach($past_temp4_bn_manthly_array as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_bn_uriage  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_bn_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_bn_uriage  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_bn_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp4_bn_manthly_array2 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_bn_number  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_bn_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_bn_number  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_bn_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp4_bn_manthly_array3 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_bn_arari  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_bn_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_bn_arari  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_bn_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    // 全体HTMLの作成
                                                        if(isset($past_temp4_bn_manthly_html) && isset($past_temp4_bn_sum)){
                                                            $past_temp4_bn_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>ベティー・N</div>" . $past_temp4_bn_manthly_html . $past_temp4_bn_sum;
                                                        }
                                                        if(isset($past_temp4_bn_manthly_html2) && isset($past_temp4_bn_sum2)){
                                                            $past_temp4_bn_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>ベティー・N</div>" . $past_temp4_bn_manthly_html2 . $past_temp4_bn_sum2;
                                                        }
                                                        if(isset($past_temp4_bn_manthly_html3) && isset($past_temp4_bn_sum3)){
                                                            $past_temp4_bn_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>ベティー・N</div>" . $past_temp4_bn_manthly_html3 . $past_temp4_bn_sum3;
                                                        }


 
 
                                        // Betty・中古（過去）用HTMLの作成
                                                $past_js_bu_uriage  = "";
                                                $past_js_bu_number  = "";
                                                $past_js_bu_arari  = "";
                                                $past_temp4_bu_manthly_html = "";
                                                $past_temp4_bu_manthly_html2 = "";
                                                $past_temp4_bu_manthly_html3 = "";
                                                // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                    foreach($manth_past_array as $val){
                                                            $val = mb_substr($val,0,-3);
                                                            if(strpos($past_temp4_bu_manthly_data, $val ) !== false){
                                                                $past_temp4_bu_manthly_data = str_replace($val, 0, $past_temp4_bu_manthly_data);
                                                            }
                                                            if(strpos($past_temp4_bu_manthly_data2, $val ) !== false){
                                                                $past_temp4_bu_manthly_data2 = str_replace($val, 0, $past_temp4_bu_manthly_data2);
                                                            }
                                                            if(strpos($past_temp4_bu_manthly_data3, $val ) !== false){
                                                                $past_temp4_bu_manthly_data3 = str_replace($val, 0, $past_temp4_bu_manthly_data3);
                                                            }
                                                    }
                                                // 各月売上が記載された文字列を配列へ変換
                                                    $past_temp4_bu_manthly_array = explode(',',$past_temp4_bu_manthly_data);
                                                    $past_temp4_bu_manthly_array2 = explode(',',$past_temp4_bu_manthly_data2);
                                                    $past_temp4_bu_manthly_array3 = explode(',',$past_temp4_bu_manthly_data3);
                                                // 各月のHTMLを作成
                                                    $past_bu_last_uriage = "";
                                                    foreach($past_temp4_bu_manthly_array as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_bu_uriage  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_bu_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_bu_uriage  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_bu_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp4_bu_manthly_array2 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_bu_number  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_bu_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_bu_number  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_bu_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp4_bu_manthly_array3 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_bu_arari  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_bu_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_bu_arari  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_bu_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    // 全体HTMLの作成
                                                        if(isset($past_temp4_bu_manthly_html) && isset($past_temp4_bu_sum)){
                                                            $past_temp4_bu_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>ベティー・U</div>" . $past_temp4_bu_manthly_html . $past_temp4_bu_sum;
                                                        }
                                                        if(isset($past_temp4_bu_manthly_html2) && isset($past_temp4_bu_sum2)){
                                                            $past_temp4_bu_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>ベティー・U</div>" . $past_temp4_bu_manthly_html2 . $past_temp4_bu_sum2;
                                                        }
                                                        if(isset($past_temp4_bu_manthly_html3) && isset($past_temp4_bu_sum3)){
                                                            $past_temp4_bu_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>ベティー・U</div>" . $past_temp4_bu_manthly_html3 . $past_temp4_bu_sum3;
                                                        }
 
 
 
                                        // Betty・アンティーク（過去）用HTMLの作成
                                                $past_js_ba_uriage  = "";
                                                $past_js_ba_number  = "";
                                                $past_js_ba_arari  = "";
                                                $past_temp4_ba_manthly_html = "";
                                                $past_temp4_ba_manthly_html2 = "";
                                                $past_temp4_ba_manthly_html3 = "";
                                                // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                    foreach($manth_past_array as $val){
                                                            $val = mb_substr($val,0,-3);
                                                            if(strpos($past_temp4_ba_manthly_data, $val ) !== false){
                                                                $past_temp4_ba_manthly_data = str_replace($val, 0, $past_temp4_ba_manthly_data);
                                                            }
                                                            if(strpos($past_temp4_ba_manthly_data2, $val ) !== false){
                                                                $past_temp4_ba_manthly_data2 = str_replace($val, 0, $past_temp4_ba_manthly_data2);
                                                            }
                                                            if(strpos($past_temp4_ba_manthly_data3, $val ) !== false){
                                                                $past_temp4_ba_manthly_data3 = str_replace($val, 0, $past_temp4_ba_manthly_data3);
                                                            }
                                                    }
                                                // 各月売上が記載された文字列を配列へ変換
                                                    $past_temp4_ba_manthly_array = explode(',',$past_temp4_ba_manthly_data);
                                                    $past_temp4_ba_manthly_array2 = explode(',',$past_temp4_ba_manthly_data2);
                                                    $past_temp4_ba_manthly_array3 = explode(',',$past_temp4_ba_manthly_data3);
                                                // 各月のHTMLを作成
                                                    $past_ba_last_uriage = "";
                                                    foreach($past_temp4_ba_manthly_array as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_ba_uriage  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_ba_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_ba_uriage  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_ba_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp4_ba_manthly_array2 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_ba_number  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_ba_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_ba_number  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_ba_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp4_ba_manthly_array3 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_ba_arari  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_ba_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_ba_arari  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_ba_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    // 全体HTMLの作成
                                                        if(isset($past_temp4_ba_manthly_html) && isset($past_temp4_ba_sum)){
                                                            $past_temp4_ba_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>ベティー・A</div>" . $past_temp4_ba_manthly_html . $past_temp4_ba_sum;
                                                        }
                                                        if(isset($past_temp4_ba_manthly_html2) && isset($past_temp4_ba_sum2)){
                                                            $past_temp4_ba_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>ベティー・A</div>" . $past_temp4_ba_manthly_html2 . $past_temp4_ba_sum2;
                                                        }
                                                        if(isset($past_temp4_ba_manthly_html3) && isset($past_temp4_ba_sum3)){
                                                            $past_temp4_ba_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>ベティー・A</div>" . $past_temp4_ba_manthly_html3 . $past_temp4_ba_sum3;
                                                        }


 
                                        // ジュエリー・N（過去）用HTMLの作成
                                                $past_js_jln_uriage  = "";
                                                $past_js_jln_number  = "";
                                                $past_js_jln_arari  = "";
                                                $past_temp4_jln_manthly_html = "";
                                                $past_temp4_jln_manthly_html2 = "";
                                                $past_temp4_jln_manthly_html3 = "";
                                                // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                    foreach($manth_past_array as $val){
                                                            $val = mb_substr($val,0,-3);
                                                            if(strpos($past_temp4_jln_manthly_data, $val ) !== false){
                                                                $past_temp4_jln_manthly_data = str_replace($val, 0, $past_temp4_jln_manthly_data);
                                                            }
                                                            if(strpos($past_temp4_jln_manthly_data2, $val ) !== false){
                                                                $past_temp4_jln_manthly_data2 = str_replace($val, 0, $past_temp4_jln_manthly_data2);
                                                            }
                                                            if(strpos($past_temp4_jln_manthly_data3, $val ) !== false){
                                                                $past_temp4_jln_manthly_data3 = str_replace($val, 0, $past_temp4_jln_manthly_data3);
                                                            }
                                                    }
                                                // 各月売上が記載された文字列を配列へ変換
                                                    $past_temp4_jln_manthly_array = explode(',',$past_temp4_jln_manthly_data);
                                                    $past_temp4_jln_manthly_array2 = explode(',',$past_temp4_jln_manthly_data2);
                                                    $past_temp4_jln_manthly_array3 = explode(',',$past_temp4_jln_manthly_data3);
                                                // 各月のHTMLを作成
                                                    $past_jln_last_uriage = "";
                                                    foreach($past_temp4_jln_manthly_array as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_jln_uriage  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_jln_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_jln_uriage  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_jln_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp4_jln_manthly_array2 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_jln_number  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_jln_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_jln_number  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_jln_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp4_jln_manthly_array3 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_jln_arari  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_jln_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_jln_arari  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_jln_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    // 全体HTMLの作成
                                                        if(isset($past_temp4_jln_manthly_html) && isset($past_temp4_jln_sum)){
                                                            $past_temp4_jln_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>ジュエリー・N</div>" . $past_temp4_jln_manthly_html . $past_temp4_jln_sum;
                                                        }
                                                        if(isset($past_temp4_jln_manthly_html2) && isset($past_temp4_jln_sum2)){
                                                            $past_temp4_jln_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>ジュエリー・N</div>" . $past_temp4_jln_manthly_html2 . $past_temp4_jln_sum2;
                                                        }
                                                        if(isset($past_temp4_jln_manthly_html3) && isset($past_temp4_jln_sum3)){
                                                            $past_temp4_jln_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>ジュエリー・N</div>" . $past_temp4_jln_manthly_html3 . $past_temp4_jln_sum3;
                                                        }


  
 
                                        // ジュエリー・U（過去）用HTMLの作成
                                                $past_js_jlu_uriage  = "";
                                                $past_js_jlu_number  = "";
                                                $past_js_jlu_arari  = "";
                                                $past_temp4_jlu_manthly_html = "";
                                                $past_temp4_jlu_manthly_html2 = "";
                                                $past_temp4_jlu_manthly_html3 = "";
                                                // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                    foreach($manth_past_array as $val){
                                                            $val = mb_substr($val,0,-3);
                                                            if(strpos($past_temp4_jlu_manthly_data, $val ) !== false){
                                                                $past_temp4_jlu_manthly_data = str_replace($val, 0, $past_temp4_jlu_manthly_data);
                                                            }
                                                            if(strpos($past_temp4_jlu_manthly_data2, $val ) !== false){
                                                                $past_temp4_jlu_manthly_data2 = str_replace($val, 0, $past_temp4_jlu_manthly_data2);
                                                            }
                                                            if(strpos($past_temp4_jlu_manthly_data3, $val ) !== false){
                                                                $past_temp4_jlu_manthly_data3 = str_replace($val, 0, $past_temp4_jlu_manthly_data3);
                                                            }
                                                    }
                                                // 各月売上が記載された文字列を配列へ変換
                                                    $past_temp4_jlu_manthly_array = explode(',',$past_temp4_jlu_manthly_data);
                                                    $past_temp4_jlu_manthly_array2 = explode(',',$past_temp4_jlu_manthly_data2);
                                                    $past_temp4_jlu_manthly_array3 = explode(',',$past_temp4_jlu_manthly_data3);
                                                // 各月のHTMLを作成
                                                    $past_jlu_last_uriage = "";
                                                    foreach($past_temp4_jlu_manthly_array as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_jlu_uriage  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_jlu_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_jlu_uriage  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_jlu_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp4_jlu_manthly_array2 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_jlu_number  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_jlu_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_jlu_number  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_jlu_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp4_jlu_manthly_array3 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_jlu_arari  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_jlu_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_jlu_arari  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_jlu_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    // 全体HTMLの作成
                                                        if(isset($past_temp4_jlu_manthly_html) && isset($past_temp4_jlu_sum)){
                                                            $past_temp4_jlu_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>ジュエリー・U</div>" . $past_temp4_jlu_manthly_html . $past_temp4_jlu_sum;
                                                        }
                                                        if(isset($past_temp4_jlu_manthly_html2) && isset($past_temp4_jlu_sum2)){
                                                            $past_temp4_jlu_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>ジュエリー・U</div>" . $past_temp4_jlu_manthly_html2 . $past_temp4_jlu_sum2;
                                                        }
                                                        if(isset($past_temp4_jlu_manthly_html3) && isset($past_temp4_jlu_sum3)){
                                                            $past_temp4_jlu_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>ジュエリー・U</div>" . $past_temp4_jlu_manthly_html3 . $past_temp4_jlu_sum3;
                                                        }


  
 
                                        // バッグ・N（過去）用HTMLの作成
                                                $past_js_bgn_uriage  = "";
                                                $past_js_bgn_number  = "";
                                                $past_js_bgn_arari  = "";
                                                $past_temp4_bgn_manthly_html = "";
                                                $past_temp4_bgn_manthly_html2 = "";
                                                $past_temp4_bgn_manthly_html3 = "";
                                                // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                    foreach($manth_past_array as $val){
                                                            $val = mb_substr($val,0,-3);
                                                            if(strpos($past_temp4_bgn_manthly_data, $val ) !== false){
                                                                $past_temp4_bgn_manthly_data = str_replace($val, 0, $past_temp4_bgn_manthly_data);
                                                            }
                                                            if(strpos($past_temp4_bgn_manthly_data2, $val ) !== false){
                                                                $past_temp4_bgn_manthly_data2 = str_replace($val, 0, $past_temp4_bgn_manthly_data2);
                                                            }
                                                            if(strpos($past_temp4_bgn_manthly_data3, $val ) !== false){
                                                                $past_temp4_bgn_manthly_data3 = str_replace($val, 0, $past_temp4_bgn_manthly_data3);
                                                            }
                                                    }
                                                // 各月売上が記載された文字列を配列へ変換
                                                    $past_temp4_bgn_manthly_array = explode(',',$past_temp4_bgn_manthly_data);
                                                    $past_temp4_bgn_manthly_array2 = explode(',',$past_temp4_bgn_manthly_data2);
                                                    $past_temp4_bgn_manthly_array3 = explode(',',$past_temp4_bgn_manthly_data3);
                                                // 各月のHTMLを作成
                                                    $past_bgn_last_uriage = "";
                                                    foreach($past_temp4_bgn_manthly_array as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_bgn_uriage  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_bgn_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_bgn_uriage  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_bgn_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp4_bgn_manthly_array2 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_bgn_number  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_bgn_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_bgn_number  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_bgn_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp4_bgn_manthly_array3 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_bgn_arari  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_bgn_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_bgn_arari  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_bgn_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    // 全体HTMLの作成
                                                        if(isset($past_temp4_bgn_manthly_html) && isset($past_temp4_bgn_sum)){
                                                            $past_temp4_bgn_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>バッグ・N</div>" . $past_temp4_bgn_manthly_html . $past_temp4_bgn_sum;
                                                        }
                                                        if(isset($past_temp4_bgn_manthly_html2) && isset($past_temp4_bgn_sum2)){
                                                            $past_temp4_bgn_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>バッグ・N</div>" . $past_temp4_bgn_manthly_html2 . $past_temp4_bgn_sum2;
                                                        }
                                                        if(isset($past_temp4_bgn_manthly_html3) && isset($past_temp4_bgn_sum3)){
                                                            $past_temp4_bgn_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>バッグ・N</div>" . $past_temp4_bgn_manthly_html3 . $past_temp4_bgn_sum3;
                                                        }

  
 
                                        // バッグ・U（過去）用HTMLの作成
                                                $past_js_bgu_uriage  = "";
                                                $past_js_bgu_number  = "";
                                                $past_js_bgu_arari  = "";
                                                $past_temp4_bgu_manthly_html = "";
                                                $past_temp4_bgu_manthly_html2 = "";
                                                $past_temp4_bgu_manthly_html3 = "";
                                                // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                    foreach($manth_past_array as $val){
                                                            $val = mb_substr($val,0,-3);
                                                            if(strpos($past_temp4_bgu_manthly_data, $val ) !== false){
                                                                $past_temp4_bgu_manthly_data = str_replace($val, 0, $past_temp4_bgu_manthly_data);
                                                            }
                                                            if(strpos($past_temp4_bgu_manthly_data2, $val ) !== false){
                                                                $past_temp4_bgu_manthly_data2 = str_replace($val, 0, $past_temp4_bgu_manthly_data2);
                                                            }
                                                            if(strpos($past_temp4_bgu_manthly_data3, $val ) !== false){
                                                                $past_temp4_bgu_manthly_data3 = str_replace($val, 0, $past_temp4_bgu_manthly_data3);
                                                            }
                                                    }
                                                // 各月売上が記載された文字列を配列へ変換
                                                    $past_temp4_bgu_manthly_array = explode(',',$past_temp4_bgu_manthly_data);
                                                    $past_temp4_bgu_manthly_array2 = explode(',',$past_temp4_bgu_manthly_data2);
                                                    $past_temp4_bgu_manthly_array3 = explode(',',$past_temp4_bgu_manthly_data3);
                                                // 各月のHTMLを作成
                                                    $past_bgu_last_uriage = "";
                                                    foreach($past_temp4_bgu_manthly_array as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_bgu_uriage  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_bgu_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_bgu_uriage  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_bgu_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp4_bgu_manthly_array2 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_bgu_number  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_bgu_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_bgu_number  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_bgu_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    foreach($past_temp4_bgu_manthly_array3 as $val){
                                                        
                                                        if($val == ""){
                                                            // JSグラフ用
                                                                $past_js_bgu_arari  .= "0, ";
                                                            // 表示用
                                                                $past_temp4_bgu_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                        } else {
                                                            // JSグラフ用
                                                                $past_js_bgu_arari  .= $val . ", ";
                                                            // 表示用
                                                                if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                $past_temp4_bgu_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                        }

                                                    }
                                                    // 全体HTMLの作成
                                                        if(isset($past_temp4_bgu_manthly_html) && isset($past_temp4_bgu_sum)){
                                                            $past_temp4_bgu_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>バッグ・U</div>" . $past_temp4_bgu_manthly_html . $past_temp4_bgu_sum;
                                                        }
                                                        if(isset($past_temp4_bgu_manthly_html2) && isset($past_temp4_bgu_sum2)){
                                                            $past_temp4_bgu_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>バッグ・U</div>" . $past_temp4_bgu_manthly_html2 . $past_temp4_bgu_sum2;
                                                        }
                                                        if(isset($past_temp4_bgu_manthly_html3) && isset($past_temp4_bgu_sum3)){
                                                            $past_temp4_bgu_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>バッグ・U</div>" . $past_temp4_bgu_manthly_html3 . $past_temp4_bgu_sum3;
                                                        }




                                        // 各月の全部門売上合計のJS表示用
                                                $js_past_all_month_uriage = "";
                                                $js_past_all_month_number = "";
                                                $js_past_all_month_arari = "";
                                                $i = 0;
                                                foreach($manth_past_array as $val){
                                                    $all_js = 0;
                                                    $all_js2 = 0;
                                                    $all_js3 = 0;
                                                    $all_js = (int)$all_js + (int)$past_temp4_jn_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$past_temp4_jn_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$past_temp4_jn_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$past_temp4_ju_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$past_temp4_ju_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$past_temp4_ju_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$past_temp4_ja_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$past_temp4_ja_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$past_temp4_ja_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$past_temp4_bn_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$past_temp4_bn_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$past_temp4_bn_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$past_temp4_bu_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$past_temp4_bu_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$past_temp4_bu_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$past_temp4_ba_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$past_temp4_ba_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$past_temp4_ba_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$past_temp4_jln_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$past_temp4_jln_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$past_temp4_jln_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$past_temp4_jlu_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$past_temp4_jlu_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$past_temp4_jlu_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$past_temp4_bgn_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$past_temp4_bgn_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$past_temp4_bgn_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$past_temp4_bgu_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$past_temp4_bgu_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$past_temp4_bgu_manthly_array3[$i];

                                                    $js_past_all_month_uriage .= $all_js . ", ";
                                                    $js_past_all_month_number .= $all_js2 . ", ";
                                                    $js_past_all_month_arari .= $all_js3 . ", ";
                                                    
                                                    $i++;
                                                }


                                    // 過去・Jack・新品・粗利率
                                        $past_jn_total_js = "";

                                        $i = 0;
                                        $past_jn_ratio = "";
                                        $past_jn_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>ジャック・N</div>";
                                        $past_jn_total = "";
                                        $past_all_total = "";
                                        $past_jn_total_ratio = "";
                                        foreach($past_temp4_jn_manthly_array3 as $var){
                                            if($var == 0){
                                                $past_jn_ratio = "---";
                                                $past_jn_total = $past_jn_total;
                                                if($past_temp4_jn_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp4_jn_manthly_array[$i];
                                                }
                                            } else {
                                                if($var <> 0 && $past_temp4_jn_manthly_array[$i] <> 0 && $var <> "" && $past_temp4_jn_manthly_array[$i] <> ""){
                                                    $past_jn_ratio = number_format((floor(((float)$var / (float)$past_temp4_jn_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $past_jn_ratio = "---";
                                                }
                                                $past_jn_total = (int)$past_jn_total + (int)$var;
                                                if($past_temp4_jn_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp4_jn_manthly_array[$i];
                                                }
                                            }
                                            ${"past_jn_ratio_" .$i} = "";
                                            ${"past_jn_ratio_" .$i} = $past_jn_ratio;
                                                    
                                            $past_jn_total_js  .= (float)$past_jn_ratio . ", ";
                                            $past_jn_sum_arari_per .= "<div class='title6 ta_r'>" . $past_jn_ratio . "%</div>";

                                            $i++;
                                        }
                                        // 過去・自社用粗利率を取得
                                            if($past_jn_total == 0 || $past_jn_total == "" || $past_all_total == 0 || $past_all_total == ""){
                                                $past_jn_total_ratio = "---";
                                            } else {
                                                $past_jn_total_ratio = number_format((floor(((int)$past_jn_total / (int)$past_all_total) * 100 * 10)) / 10 ,1);
                                            }

                                            $past_jn_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_jn_total_ratio . "%</div></div>";


                                    // 過去・Jack・中古・粗利率
                                        $past_ju_total_js = "";

                                        $i = 0;
                                        $past_ju_ratio = "";
                                        $past_ju_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>ジャック・U</div>";
                                        $past_ju_total = "";
                                        $past_all_total = "";
                                        $past_ju_total_ratio = "";
                                        foreach($past_temp4_ju_manthly_array3 as $var){
                                            if($var == 0){
                                                $past_ju_ratio = "---";
                                                $past_ju_total = $past_ju_total;
                                                if($past_temp4_ju_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp4_ju_manthly_array[$i];
                                                }
                                            } else {
                                                if($var <> 0 && $past_temp4_ju_manthly_array[$i] <> 0 && $var <> "" && $past_temp4_ju_manthly_array[$i] <> ""){
                                                    $past_ju_ratio = number_format((floor(((float)$var / (float)$past_temp4_ju_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $past_ju_ratio = "---";
                                                }
                                                $past_ju_total = (int)$past_ju_total + (int)$var;
                                                if($past_temp4_ju_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp4_ju_manthly_array[$i];
                                                }
                                            }
                                            ${"past_ju_ratio_" .$i} = "";
                                            ${"past_ju_ratio_" .$i} = $past_ju_ratio;
                                                    
                                            $past_ju_total_js  .= (float)$past_ju_ratio . ", ";
                                            $past_ju_sum_arari_per .= "<div class='title6 ta_r'>" . $past_ju_ratio . "%</div>";

                                            $i++;
                                        }
                                        // 過去・自社用粗利率を取得
                                            if($past_ju_total == 0 || $past_ju_total == "" || $past_all_total == 0 || $past_all_total == ""){
                                                $past_ju_total_ratio = "---";
                                            } else {
                                                $past_ju_total_ratio = number_format((floor(((int)$past_ju_total / (int)$past_all_total) * 100 * 10)) / 10 ,1);
                                            }

                                            $past_ju_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_ju_total_ratio . "%</div></div>";



                                    // 過去・Jack・アンティーク・粗利率
                                        $past_ja_total_js = "";

                                        $i = 0;
                                        $past_ja_ratio = "";
                                        $past_ja_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>ジャック・A</div>";
                                        $past_ja_total = "";
                                        $past_all_total = "";
                                        $past_ja_total_ratio = "";
                                        foreach($past_temp4_ja_manthly_array3 as $var){
                                            if($var == 0){
                                                $past_ja_ratio = "---";
                                                $past_ja_total = $past_ja_total;
                                                if($past_temp4_ja_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp4_ja_manthly_array[$i];
                                                }
                                            } else {
                                                if($var <> 0 && $past_temp4_ja_manthly_array[$i] <> 0 && $var <> "" && $past_temp4_ja_manthly_array[$i] <> ""){
                                                    $past_ja_ratio = number_format((floor(((float)$var / (float)$past_temp4_ja_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $past_ja_ratio = "---";
                                                }
                                                $past_ja_total = (int)$past_ja_total + (int)$var;
                                                if($past_temp4_ja_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp4_ja_manthly_array[$i];
                                                }
                                            }
                                            ${"past_ja_ratio_" .$i} = "";
                                            ${"past_ja_ratio_" .$i} = $past_ja_ratio;
                                                    
                                            $past_ja_total_js  .= (float)$past_ja_ratio . ", ";
                                            $past_ja_sum_arari_per .= "<div class='title6 ta_r'>" . $past_ja_ratio . "%</div>";

                                            $i++;
                                        }
                                        // 過去・自社用粗利率を取得
                                            if($past_ja_total == 0 || $past_ja_total == "" || $past_all_total == 0 || $past_all_total == ""){
                                                $past_ja_total_ratio = "---";
                                            } else {
                                                $past_ja_total_ratio = number_format((floor(((int)$past_ja_total / (int)$past_all_total) * 100 * 10)) / 10 ,1);
                                            }

                                            $past_ja_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_ja_total_ratio . "%</div></div>";



                                    // 過去・Betty・新品・粗利率
                                        $past_bn_total_js = "";

                                        $i = 0;
                                        $past_bn_ratio = "";
                                        $past_bn_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>ベティー・N</div>";
                                        $past_bn_total = "";
                                        $past_all_total = "";
                                        $past_bn_total_ratio = "";
                                        foreach($past_temp4_bn_manthly_array3 as $var){
                                            if($var == 0){
                                                $past_bn_ratio = "---";
                                                $past_bn_total = $past_bn_total;
                                                if($past_temp4_bn_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp4_bn_manthly_array[$i];
                                                }
                                            } else {
                                                if($var <> 0 && $past_temp4_bn_manthly_array[$i] <> 0 && $var <> "" && $past_temp4_bn_manthly_array[$i] <> ""){
                                                    $past_bn_ratio = number_format((floor(((float)$var / (float)$past_temp4_bn_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $past_bn_ratio = "---";
                                                }
                                                $past_bn_total = (int)$past_bn_total + (int)$var;
                                                if($past_temp4_bn_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp4_bn_manthly_array[$i];
                                                }
                                            }
                                            ${"past_bn_ratio_" .$i} = "";
                                            ${"past_bn_ratio_" .$i} = $past_bn_ratio;
                                                    
                                            $past_bn_total_js  .= (float)$past_bn_ratio . ", ";
                                            $past_bn_sum_arari_per .= "<div class='title6 ta_r'>" . $past_bn_ratio . "%</div>";

                                            $i++;
                                        }
                                        // 過去・自社用粗利率を取得
                                            if($past_bn_total == 0 || $past_bn_total == "" || $past_all_total == 0 || $past_all_total == ""){
                                                $past_bn_total_ratio = "---";
                                            } else {
                                                $past_bn_total_ratio = number_format((floor(((int)$past_bn_total / (int)$past_all_total) * 100 * 10)) / 10 ,1);
                                            }

                                            $past_bn_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_bn_total_ratio . "%</div></div>";


                                    // 過去・Betty・中古・粗利率
                                        $past_bu_total_js = "";

                                        $i = 0;
                                        $past_bu_ratio = "";
                                        $past_bu_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>ベティー・U</div>";
                                        $past_bu_total = "";
                                        $past_all_total = "";
                                        $past_bu_total_ratio = "";
                                        foreach($past_temp4_bu_manthly_array3 as $var){
                                            if($var == 0){
                                                $past_bu_ratio = "---";
                                                $past_bu_total = $past_bu_total;
                                                if($past_temp4_bu_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp4_bu_manthly_array[$i];
                                                }
                                            } else {
                                                if($var <> 0 && $past_temp4_bu_manthly_array[$i] <> 0 && $var <> "" && $past_temp4_bu_manthly_array[$i] <> ""){
                                                    $past_bu_ratio = number_format((floor(((float)$var / (float)$past_temp4_bu_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $past_bu_ratio = "---";
                                                }
                                                $past_bu_total = (int)$past_bu_total + (int)$var;
                                                if($past_temp4_bu_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp4_bu_manthly_array[$i];
                                                }
                                            }
                                            ${"past_bu_ratio_" .$i} = "";
                                            ${"past_bu_ratio_" .$i} = $past_bu_ratio;
                                                    
                                            $past_bu_total_js  .= (float)$past_bu_ratio . ", ";
                                            $past_bu_sum_arari_per .= "<div class='title6 ta_r'>" . $past_bu_ratio . "%</div>";

                                            $i++;
                                        }
                                        // 過去・自社用粗利率を取得
                                            if($past_bu_total == 0 || $past_bu_total == "" || $past_all_total == 0 || $past_all_total == ""){
                                                $past_bu_total_ratio = "---";
                                            } else {
                                                $past_bu_total_ratio = number_format((floor(((int)$past_bu_total / (int)$past_all_total) * 100 * 10)) / 10 ,1);
                                            }

                                            $past_bu_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_bu_total_ratio . "%</div></div>";


                                    // 過去・Betty・アンティーク・粗利率
                                        $past_ba_total_js = "";

                                        $i = 0;
                                        $past_ba_ratio = "";
                                        $past_ba_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>ベティー・A</div>";
                                        $past_ba_total = "";
                                        $past_all_total = "";
                                        $past_ba_total_ratio = "";
                                        foreach($past_temp4_ba_manthly_array3 as $var){
                                            if($var == 0){
                                                $past_ba_ratio = "---";
                                                $past_ba_total = $past_ba_total;
                                                if($past_temp4_ba_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp4_ba_manthly_array[$i];
                                                }
                                            } else {
                                                if($var <> 0 && $past_temp4_ba_manthly_array[$i] <> 0 && $var <> "" && $past_temp4_ba_manthly_array[$i] <> ""){
                                                    $past_ba_ratio = number_format((floor(((float)$var / (float)$past_temp4_ba_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $past_ba_ratio = "---";
                                                }
                                                $past_ba_total = (int)$past_ba_total + (int)$var;
                                                if($past_temp4_ba_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp4_ba_manthly_array[$i];
                                                }
                                            }
                                            ${"past_ba_ratio_" .$i} = "";
                                            ${"past_ba_ratio_" .$i} = $past_ba_ratio;
                                                    
                                            $past_ba_total_js  .= (float)$past_ba_ratio . ", ";
                                            $past_ba_sum_arari_per .= "<div class='title6 ta_r'>" . $past_ba_ratio . "%</div>";

                                            $i++;
                                        }
                                        // 過去・自社用粗利率を取得
                                            if($past_ba_total == 0 || $past_ba_total == "" || $past_all_total == 0 || $past_all_total == ""){
                                                $past_ba_total_ratio = "---";
                                            } else {
                                                $past_ba_total_ratio = number_format((floor(((int)$past_ba_total / (int)$past_all_total) * 100 * 10)) / 10 ,1);
                                            }

                                            $past_ba_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_ba_total_ratio . "%</div></div>";


                                    // 過去・ジュエリー・N・粗利率
                                        $past_jln_total_js = "";

                                        $i = 0;
                                        $past_jln_ratio = "";
                                        $past_jln_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>ジュエリー・N</div>";
                                        $past_jln_total = "";
                                        $past_all_total = "";
                                        $past_jln_total_ratio = "";
                                        foreach($past_temp4_jln_manthly_array3 as $var){
                                            if($var == 0){
                                                $past_jln_ratio = "---";
                                                $past_jln_total = $past_jln_total;
                                                if($past_temp4_jln_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp4_jln_manthly_array[$i];
                                                }
                                            } else {
                                                if($var <> 0 && $past_temp4_jln_manthly_array[$i] <> 0 && $var <> "" && $past_temp4_jln_manthly_array[$i] <> ""){
                                                    $past_jln_ratio = number_format((floor(((float)$var / (float)$past_temp4_jln_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $past_jln_ratio = "---";
                                                }
                                                $past_jln_total = (int)$past_jln_total + (int)$var;
                                                if($past_temp4_jln_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp4_jln_manthly_array[$i];
                                                }
                                            }
                                            ${"past_jln_ratio_" .$i} = "";
                                            ${"past_jln_ratio_" .$i} = $past_jln_ratio;
                                                    
                                            $past_jln_total_js  .= (float)$past_jln_ratio . ", ";
                                            $past_jln_sum_arari_per .= "<div class='title6 ta_r'>" . $past_jln_ratio . "%</div>";

                                            $i++;
                                        }
                                        // 過去・自社用粗利率を取得
                                            if($past_jln_total == 0 || $past_jln_total == "" || $past_all_total == 0 || $past_all_total == ""){
                                                $past_jln_total_ratio = "---";
                                            } else {
                                                $past_jln_total_ratio = number_format((floor(((int)$past_jln_total / (int)$past_all_total) * 100 * 10)) / 10 ,1);
                                            }

                                            $past_jln_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_jln_total_ratio . "%</div></div>";



                                    // 過去・ジュエリー・U・粗利率
                                        $past_jlu_total_js = "";

                                        $i = 0;
                                        $past_jlu_ratio = "";
                                        $past_jlu_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>ジュエリー・U</div>";
                                        $past_jlu_total = "";
                                        $past_all_total = "";
                                        $past_jlu_total_ratio = "";
                                        foreach($past_temp4_jlu_manthly_array3 as $var){
                                            if($var == 0){
                                                $past_jlu_ratio = "---";
                                                $past_jlu_total = $past_jlu_total;
                                                if($past_temp4_jlu_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp4_jlu_manthly_array[$i];
                                                }
                                            } else {
                                                if($var <> 0 && $past_temp4_jlu_manthly_array[$i] <> 0 && $var <> "" && $past_temp4_jlu_manthly_array[$i] <> ""){
                                                    $past_jlu_ratio = number_format((floor(((float)$var / (float)$past_temp4_jlu_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $past_jlu_ratio = "---";
                                                }
                                                $past_jlu_total = (int)$past_jlu_total + (int)$var;
                                                if($past_temp4_jlu_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp4_jlu_manthly_array[$i];
                                                }
                                            }
                                            ${"past_jlu_ratio_" .$i} = "";
                                            ${"past_jlu_ratio_" .$i} = $past_jlu_ratio;
                                                    
                                            $past_jlu_total_js  .= (float)$past_jlu_ratio . ", ";
                                            $past_jlu_sum_arari_per .= "<div class='title6 ta_r'>" . $past_jlu_ratio . "%</div>";

                                            $i++;
                                        }
                                        // 過去・自社用粗利率を取得
                                            if($past_jlu_total == 0 || $past_jlu_total == "" || $past_all_total == 0 || $past_all_total == ""){
                                                $past_jlu_total_ratio = "---";
                                            } else {
                                                $past_jlu_total_ratio = number_format((floor(((int)$past_jlu_total / (int)$past_all_total) * 100 * 10)) / 10 ,1);
                                            }

                                            $past_jlu_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_jlu_total_ratio . "%</div></div>";



                                    // 過去・バッグ・N・粗利率
                                        $past_bgn_total_js = "";

                                        $i = 0;
                                        $past_bgn_ratio = "";
                                        $past_bgn_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>バッグ・N</div>";
                                        $past_bgn_total = "";
                                        $past_all_total = "";
                                        $past_bgn_total_ratio = "";
                                        foreach($past_temp4_bgn_manthly_array3 as $var){
                                            if($var == 0){
                                                $past_bgn_ratio = "---";
                                                $past_bgn_total = $past_bgn_total;
                                                if($past_temp4_bgn_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp4_bgn_manthly_array[$i];
                                                }
                                            } else {
                                                if($var <> 0 && $past_temp4_bgn_manthly_array[$i] <> 0 && $var <> "" && $past_temp4_bgn_manthly_array[$i] <> ""){
                                                    $past_bgn_ratio = number_format((floor(((float)$var / (float)$past_temp4_bgn_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $past_bgn_ratio = "---";
                                                }
                                                $past_bgn_total = (int)$past_bgn_total + (int)$var;
                                                if($past_temp4_bgn_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp4_bgn_manthly_array[$i];
                                                }
                                            }
                                            ${"past_bgn_ratio_" .$i} = "";
                                            ${"past_bgn_ratio_" .$i} = $past_bgn_ratio;
                                                    
                                            $past_bgn_total_js  .= (float)$past_bgn_ratio . ", ";
                                            $past_bgn_sum_arari_per .= "<div class='title6 ta_r'>" . $past_bgn_ratio . "%</div>";

                                            $i++;
                                        }
                                        // 過去・自社用粗利率を取得
                                            if($past_bgn_total == 0 || $past_bgn_total == "" || $past_all_total == 0 || $past_all_total == ""){
                                                $past_bgn_total_ratio = "---";
                                            } else {
                                                $past_bgn_total_ratio = number_format((floor(((int)$past_bgn_total / (int)$past_all_total) * 100 * 10)) / 10 ,1);
                                            }

                                            $past_bgn_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_bgn_total_ratio . "%</div></div>";


                                    // 過去・バッグ・U・粗利率
                                        $past_bgu_total_js = "";

                                        $i = 0;
                                        $past_bgu_ratio = "";
                                        $past_bgu_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>バッグ・U</div>";
                                        $past_bgu_total = "";
                                        $past_all_total = "";
                                        $past_bgu_total_ratio = "";
                                        foreach($past_temp4_bgu_manthly_array3 as $var){
                                            if($var == 0){
                                                $past_bgu_ratio = "---";
                                                $past_bgu_total = $past_bgu_total;
                                                if($past_temp4_bgu_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp4_bgu_manthly_array[$i];
                                                }
                                            } else {
                                                if($var <> 0 && $past_temp4_bgu_manthly_array[$i] <> 0 && $var <> "" && $past_temp4_bgu_manthly_array[$i] <> ""){
                                                    $past_bgu_ratio = number_format((floor(((float)$var / (float)$past_temp4_bgu_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $past_bgu_ratio = "---";
                                                }
                                                $past_bgu_total = (int)$past_bgu_total + (int)$var;
                                                if($past_temp4_bgu_manthly_array[$i] == 0){
                                                    $past_all_total = $past_all_total;
                                                } else {
                                                    $past_all_total = (int)$past_all_total + (int)$past_temp4_bgu_manthly_array[$i];
                                                }
                                            }
                                            ${"past_bgu_ratio_" .$i} = "";
                                            ${"past_bgu_ratio_" .$i} = $past_bgu_ratio;
                                                    
                                            $past_bgu_total_js  .= (float)$past_bgu_ratio . ", ";
                                            $past_bgu_sum_arari_per .= "<div class='title6 ta_r'>" . $past_bgu_ratio . "%</div>";

                                            $i++;
                                        }
                                        // 過去・自社用粗利率を取得
                                            if($past_bgu_total == 0 || $past_bgu_total == "" || $past_all_total == 0 || $past_all_total == ""){
                                                $past_bgu_total_ratio = "---";
                                            } else {
                                                $past_bgu_total_ratio = number_format((floor(((int)$past_bgu_total / (int)$past_all_total) * 100 * 10)) / 10 ,1);
                                            }

                                            $past_bgu_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_bgu_total_ratio . "%</div></div>";


                                        // 各月の全部門売上合計の先頭（1列目）部分のタイトルHTML
                                            $past_all_sum_uriage = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $past_all_sum_number = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $past_all_sum_arari = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $past_all_sum_arari_per = "<div class='wid100 ul3'><div class='title5 ta_c'>粗利率(合計)</div>";

                                        // 各月の全部門売上合計を配列に代入
                                            $past_temp4_all_m_sum_uriage_array = array();
                                            $past_temp4_all_m_sum_number_array = array();
                                            $past_temp4_all_m_sum_arari_array = array();
                                            $i = 0;
                                            foreach($manth_past_array as $val){
                                                $all = "";
                                                $all2 = "";
                                                $all3 = "";
                                                $all = (int)$all + (int)$past_temp4_jn_manthly_array[$i]; $all2 = (int)$all2 + (int)$past_temp4_jn_manthly_array2[$i]; $all3 = (int)$all3 + (int)$past_temp4_jn_manthly_array3[$i];
                                                $all = (int)$all + (int)$past_temp4_ju_manthly_array[$i]; $all2 = (int)$all2 + (int)$past_temp4_ju_manthly_array2[$i]; $all3 = (int)$all3 + (int)$past_temp4_ju_manthly_array3[$i];
                                                $all = (int)$all + (int)$past_temp4_ja_manthly_array[$i]; $all2 = (int)$all2 + (int)$past_temp4_ja_manthly_array2[$i]; $all3 = (int)$all3 + (int)$past_temp4_ja_manthly_array3[$i];
                                                $all = (int)$all + (int)$past_temp4_bn_manthly_array[$i]; $all2 = (int)$all2 + (int)$past_temp4_bn_manthly_array2[$i]; $all3 = (int)$all3 + (int)$past_temp4_bn_manthly_array3[$i];
                                                $all = (int)$all + (int)$past_temp4_bu_manthly_array[$i]; $all2 = (int)$all2 + (int)$past_temp4_bu_manthly_array2[$i]; $all3 = (int)$all3 + (int)$past_temp4_bu_manthly_array3[$i];
                                                $all = (int)$all + (int)$past_temp4_ba_manthly_array[$i]; $all2 = (int)$all2 + (int)$past_temp4_ba_manthly_array2[$i]; $all3 = (int)$all3 + (int)$past_temp4_ba_manthly_array3[$i];
                                                $all = (int)$all + (int)$past_temp4_jln_manthly_array[$i]; $all2 = (int)$all2 + (int)$past_temp4_jln_manthly_array2[$i]; $all3 = (int)$all3 + (int)$past_temp4_jln_manthly_array3[$i];
                                                $all = (int)$all + (int)$past_temp4_jlu_manthly_array[$i]; $all2 = (int)$all2 + (int)$past_temp4_jlu_manthly_array2[$i]; $all3 = (int)$all3 + (int)$past_temp4_jlu_manthly_array3[$i];
                                                $all = (int)$all + (int)$past_temp4_bgn_manthly_array[$i]; $all2 = (int)$all2 + (int)$past_temp4_bgn_manthly_array2[$i]; $all3 = (int)$all3 + (int)$past_temp4_bgn_manthly_array3[$i];
                                                $all = (int)$all + (int)$past_temp4_bgu_manthly_array[$i]; $all2 = (int)$all2 + (int)$past_temp4_bgu_manthly_array2[$i]; $all3 = (int)$all3 + (int)$past_temp4_bgu_manthly_array3[$i];
                                                array_push($past_temp4_all_m_sum_uriage_array,$all);
                                                array_push($past_temp4_all_m_sum_number_array,$all2);
                                                array_push($past_temp4_all_m_sum_arari_array,$all3);

                                                $i++;
                                            }
                                        // 各月の全部門売上合計部分のHTML作成
                                            foreach($past_temp4_all_m_sum_uriage_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $past_all_sum_uriage .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $past_all_sum_uriage .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                            }
                                        // 各月の全部門売上点数合計部分のHTML作成
                                            foreach($past_temp4_all_m_sum_number_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $past_all_sum_number .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $past_all_sum_number .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                            }
                                        // 各月の全部門粗利合計部分のHTML作成
                                            $i = 0;
                                            $past_arari_ratio = "";
                                            $past_all_arari_total = "";
                                            foreach($past_temp4_all_m_sum_arari_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $past_all_sum_arari .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $past_all_sum_arari .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                                // 各月の粗利率を取得
                                                    if($past_temp4_all_m_sum_uriage_array[$i] == 0){
                                                        $past_arari_ratio = "---";
                                                    } else {
                                                        $past_arari_ratio = number_format((floor(((int)$var / (int)$past_temp4_all_m_sum_uriage_array[$i]) * 100 * 10)) / 10 ,1);
                                                    }
                                                    // 過去・粗利・縦軸合計
                                                        $past_all_sum_arari_per .= "<div class='title6 ta_r'>" . $past_arari_ratio . "%</div>";
                                                    // 過去・ジャック・N・ジャック・U・ジャック・A・ベティー・N・ベティー・U・ベティー・A・ジュエリー・N・ジュエリー・U・バッグ・N・バッグ・U・合計粗利率（JSグラフ用） 
                                                        $past_all_arari_total .= (float)$past_arari_ratio . ", ";
                                                    // 過去・現在の粗利率合計差の計算に使用
                                                        ${"past_arari_ratio_" . $i} = $past_arari_ratio;
                                                        
                                                $i++;
                                            }


                                        // 全期間全部門売上合計とその平均値のHTML作成
                                            if($past_all_sum_uriage_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更
                                                    //$past_all_average = floor((int)$past_all_sum_uriage_all / $past_i);
                                                        $past_all_average = (int)$past_jn_sum_uriage_ave2 + (int)$past_ju_sum_uriage_ave2 + (int)$past_ja_sum_uriage_ave2 + (int)$past_bn_sum_uriage_ave2 + (int)$past_bu_sum_uriage_ave2 + (int)$past_ba_sum_uriage_ave2 + (int)$past_jln_sum_uriage_ave2 + (int)$past_jlu_sum_uriage_ave2 + (int)$past_bgn_sum_uriage_ave2 + (int)$past_bgu_sum_uriage_ave2;
                                            } else {
                                                $past_all_average = 0;
                                            }
                                            $past_all_sum_uriage .= "<div class='title6 ta_r'>" . number_format((int)$past_all_sum_uriage_all) . "</div><div class='title6 ta_r'>" . number_format((int)$past_all_average) . "</div></div>";
                                        // 全HTMLを合体（検索対象外は除く）
                                            $view = "";
                                            $view .= $past_temp4_jn_manthly_html;
                                            $view .= $past_temp4_ju_manthly_html;
                                            $view .= $past_temp4_ja_manthly_html;
                                            $view .= $past_temp4_bn_manthly_html;
                                            $view .= $past_temp4_bu_manthly_html;
                                            $view .= $past_temp4_ba_manthly_html;
                                            $view .= $past_temp4_jln_manthly_html;
                                            $view .= $past_temp4_jlu_manthly_html;
                                            $view .= $past_temp4_bgn_manthly_html;
                                            $view .= $past_temp4_bgu_manthly_html;
                                            if($out4_a == "ON" && $out4_b <> "ON"){ $view_title1 = "（免税以外）";} else if($out4_a <> "ON" && $out4_b == "ON"){$view_title1 = "（免税のみ）";} else {$view_title1 = "";}
                                            $past_temp4_all_sorce = "<p class='title_a'>金額（過去）" . $view_title1 . "</p><div class='box1'>" . $past_temp4_title . $view . $past_all_sum_uriage . "</div>";

                                        // 全期間全部門売上点数合計とその平均値のHTML作成
                                            if($past_all_sum_number_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更
                                                        $past_all_average2 = (int)$past_jn_sum_number_ave2 + (int)$past_ju_sum_number_ave2 + (int)$past_ja_sum_number_ave2 + (int)$past_bn_sum_number_ave2 + (int)$past_bu_sum_number_ave2 + (int)$past_ba_sum_number_ave2 + (int)$past_jln_sum_number_ave2 + (int)$past_jlu_sum_number_ave2 + (int)$past_bgn_sum_number_ave2 + (int)$past_bgu_sum_number_ave2;
                                            } else {
                                                $past_all_average2 = 0;
                                            }
                                            $past_all_sum_number .= "<div class='title6 ta_r'>" . number_format((int)$past_all_sum_number_all) . "</div><div class='title6 ta_r'>" . number_format((int)$past_all_average2) . "</div></div>";
                                        // 全HTMLを合体（検索対象外は除く）
                                            $view2 = "";
                                            $view2 .= $past_temp4_jn_manthly_html2;
                                            $view2 .= $past_temp4_ju_manthly_html2;
                                            $view2 .= $past_temp4_ja_manthly_html2;
                                            $view2 .= $past_temp4_bn_manthly_html2;
                                            $view2 .= $past_temp4_bu_manthly_html2;
                                            $view2 .= $past_temp4_ba_manthly_html2;
                                            $view2 .= $past_temp4_jln_manthly_html2;
                                            $view2 .= $past_temp4_jlu_manthly_html2;
                                            $view2 .= $past_temp4_bgn_manthly_html2;
                                            $view2 .= $past_temp4_bgu_manthly_html2;
                                            
                                            
                                            $past_temp4_all_sorce2 = "<p class='title_a'>点数（過去）" . $view_title1 . "</p><div class='box1'>" . $past_temp4_title . $view2 . $past_all_sum_number . "</div>";

                                        // 全期間全部門粗利合計とその平均値のHTML作成
                                            if($past_all_sum_arari_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更
                                                    $past_all_average3 = (int)$past_jn_sum_arari_ave2 + (int)$past_ju_sum_arari_ave2 + (int)$past_ja_sum_arari_ave2 + (int)$past_bn_sum_arari_ave2 + (int)$past_bu_sum_arari_ave2 + (int)$past_ba_sum_arari_ave2 + (int)$past_jln_sum_arari_ave2 + (int)$past_jlu_sum_arari_ave2 + (int)$past_bgn_sum_arari_ave2 + (int)$past_bgu_sum_arari_ave2;
                                            } else {
                                                $past_all_average3 = 0;
                                            }
                                            $past_all_sum_arari .= "<div class='title6 ta_r'>" . number_format((int)$past_all_sum_arari_all) . "</div><div class='title6 ta_r'>" . number_format((int)$past_all_average3) . "</div></div>";
                                            // 粗利率の平均
                                                if($past_all_sum_arari_all <> 0){ $past_all_average4 = number_format(floor(((int)$past_all_sum_arari_all / (int)$past_all_sum_uriage_all) * 100 * 10) / 10 ,1);} else {$past_all_average4 = 0;}
                                                $past_all_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_all_average4 . "%</div></div>";
                                        
                                        // 全HTMLを合体（検索対象外は除く）
                                            $view3 = "";
                                            $view3 .= $past_temp4_jn_manthly_html3;
                                            $view3 .= $past_temp4_ju_manthly_html3;
                                            $view3 .= $past_temp4_ja_manthly_html3;
                                            $view3 .= $past_temp4_bn_manthly_html3;
                                            $view3 .= $past_temp4_bu_manthly_html3;
                                            $view3 .= $past_temp4_ba_manthly_html3;
                                            $view3 .= $past_temp4_jln_manthly_html3;
                                            $view3 .= $past_temp4_jlu_manthly_html3;
                                            $view3 .= $past_temp4_bgn_manthly_html3;
                                            $view3 .= $past_temp4_bgu_manthly_html3;
                                            
                                            $past_temp4_all_sorce3 = "<p class='title_a'>粗利（過去）" . $view_title1 . "</p><div class='box1'>" . $past_temp4_title . $view3 . $past_all_sum_arari . $past_jn_sum_arari_per . $past_ju_sum_arari_per;
                                            $past_temp4_all_sorce3 .= $past_ja_sum_arari_per;
                                            $past_temp4_all_sorce3 .= $past_bn_sum_arari_per;
                                            $past_temp4_all_sorce3 .= $past_bu_sum_arari_per;
                                            $past_temp4_all_sorce3 .= $past_ba_sum_arari_per;
                                            $past_temp4_all_sorce3 .= $past_jln_sum_arari_per;
                                            $past_temp4_all_sorce3 .= $past_jlu_sum_arari_per;
                                            $past_temp4_all_sorce3 .= $past_bgn_sum_arari_per;
                                            $past_temp4_all_sorce3 .= $past_bgu_sum_arari_per;
                                            $past_temp4_all_sorce3 .= $past_all_sum_arari_per  . "</div>";
                    
                    /************************************************************************************************************************************************************************************************************* */
                        // DB情報の受け取り（過去の期間）end
                    /************************************************************************************************************************************************************************************************************* */


                    /************************************************************************************************************************************************************************************************************* */
                        // DB情報の受け取り（過去の期間）start
                    /************************************************************************************************************************************************************************************************************* */
                    
                            $temp4_title2 = "";
                            $i = 0;
    
                            /************************************************************************************************************************************************************************************************************* */
                                // ジャック・N用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */

                                            // DB検索（ジャック・N値）スタート
                                                $jn_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS jn_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS jn_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS jn_number"),
                                                        \DB::raw("SUM(ararikingaku) AS jn_arari"),
                                                    ])
                                                    ->groupBy('jn_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {

                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                    
                                                        })

                                                    // 条件（期間の指定）
                                                       ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where("shouhinkubunbunruimei","like","%新品%")
                                                    // 条件（通販区分）
                                                        ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');
                            
                                                            // 条件（通販区分が自社）
                                                                if($out3_a == "ON"){
                                                                    $query->orWhere('tsuuhankubun',1);
                                                                }
                                                            // 条件（通販区分が楽天）
                                                                if($out3_b == "ON"){
                                                                    $query->orWhere('tsuuhankubun',2);
                                                                }
                                                            // 条件（通販区分がヤフー）
                                                                if($out3_c == "ON"){
                                                                    $query->orWhere('tsuuhankubun',3);
                                                                }
                                                            // 条件（通販区分が電話・雑誌）
                                                                if($out3_d == "ON"){
                                                                    $query->orWhere('tsuuhankubun',5);
                                                                }
                                                            // 条件（通販区分がYオークション）
                                                                if($out3_e == "ON"){
                                                                    $query->orWhere('tsuuhankubun',4);
                                                                }
                                                            // 条件（通販区分が修理品返送）
                                                                if($out3_f == "ON"){
                                                                    $query->orWhere('tsuuhankubun',9);
                                                                }
                            
                                                        })
                        
                                                    // 条件（免税）
                                                        ->where(function ($query) use ($out4_a,$out4_b) {
                                                                // 条件（免税区分が0:対象外）
                                                                    if($out4_a == "ON"){
                                                                        $query->orwhere("menzei","like","%対象外%");
                                                                    }
                                                                // 条件（免税区分が1:免税）
                                                                    if($out4_b == "ON"){
                                                                        $query->orwhere("menzei","like","%免税%");
                                                                    }
                                                        })
                                                    // 条件（扱い部門）
                                                        ->Where('bumonmei','Jackroad')
                                                        
                                                    // ソート順指定
                                                        ->orderBy('uriage', 'asc')
                                                        ->get();
                                            // クエリビルダスタート
                                                $i = 0;
                                                // 変数リセット
                                                    $jn_sum_uriage = "";
                                                    $jn_sum_number = "";
                                                    $jn_sum_arari = "";
                                                foreach ($jn_buys as $jn_buy) {
                                                    // 各月名
                                                        $jn_month[$i]= $jn_buy->jn_month;
                                                    // 各月通販売上
                                                        $jn_uriage[$i]= $jn_buy->jn_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp4_jn_manthly_data, $jn_month[$i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp4_jn_manthly_data = str_replace($jn_month[$i], $jn_uriage[$i], $temp4_jn_manthly_data);
                                                                }
                                                    // 全期間通販売上合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $jn_sum_uriage_average = (int)$jn_sum_uriage;
                                                            } else {
                                                                $jn_sum_uriage_average = (int)$jn_sum_uriage + (int)$jn_uriage[$i];
                                                            }

                                                        $jn_sum_uriage = (int)$jn_sum_uriage + (int)$jn_uriage[$i];
                                                    // 各月通販点数
                                                        $jn_number[$i]= $jn_buy->jn_number;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp4_jn_manthly_data2, $jn_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp4_jn_manthly_data2 = str_replace($jn_month[$i], $jn_number[$i], $temp4_jn_manthly_data2);
                                                            }

                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $jn_sum_number_average = (int)$jn_sum_number;
                                                            } else {
                                                                $jn_sum_number_average = (int)$jn_sum_number + (int)$jn_number[$i];
                                                            }
                                                        $jn_sum_number = (int)$jn_sum_number + (int)$jn_number[$i];

                                                    // 各月通販粗利
                                                        $jn_arari[$i]= $jn_buy->jn_arari;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp4_jn_manthly_data3, $jn_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp4_jn_manthly_data3 = str_replace($jn_month[$i], $jn_arari[$i], $temp4_jn_manthly_data3);
                                                            }
                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $jn_sum_arari_average = (int)$jn_sum_arari;
                                                            } else {
                                                                $jn_sum_arari_average = (int)$jn_sum_arari + (int)$jn_arari[$i];
                                                            }
                                                        $jn_sum_arari = (int)$jn_sum_arari + (int)$jn_arari[$i];

                                                    $i++;
                                                }

                                                // 全期間通販売上合計とその平均値のHTML作成
                                                    $temp4_jn_sum = "";
                                                    if($jn_sum_uriage <> 0 && $jn_sum_uriage <> ""){
                                                        $jn_sum_uriage_c = number_format((int)$jn_sum_uriage);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象                                                        
                                                        if($last_nodata_flag == "ON"){
                                                            if($jn_sum_uriage_average <> "" && $jn_sum_uriage_average <> 0){$jn_sum_uriage_ave = number_format(floor((int)$jn_sum_uriage_average / ((int)$i -1)));} else {$jn_sum_uriage_ave = "---";}
                                                            if($jn_sum_uriage_average <> "" && $jn_sum_uriage_average <> 0){$jn_sum_uriage_ave2 = floor((int)$jn_sum_uriage_average / ((int)$i -1));} else {$jn_sum_uriage_ave2 = "---";}
                                                        } else {
                                                            $jn_sum_uriage_ave = number_format(floor((int)$jn_sum_uriage / $i));
                                                            $jn_sum_uriage_ave2 = floor((int)$jn_sum_uriage / $i);
                                                        }
                                                    } else {
                                                        $jn_sum_uriage_c = $jn_sum_uriage;
                                                        $jn_sum_uriage_ave = 0;
                                                        $jn_sum_uriage_ave2 = 0;
                                                    }
                                                    $temp4_jn_sum = "<div class='title4 ta_r'>" . $jn_sum_uriage_c . "</div><div class='title4 ta_r'>" . $jn_sum_uriage_ave . "</div></div>";
                                                // 全期間通販売上点数合計とその平均値のHTML作成
                                                    $temp4_jn_sum2 = "";
                                                    if($jn_sum_number <> 0 && $jn_sum_number <> ""){
                                                        $jn_sum_number_c = number_format((int)$jn_sum_number);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($jn_sum_number_average <> "" && $jn_sum_number_average <> 0){$jn_sum_number_ave = number_format(floor((int)$jn_sum_number_average / ((int)$i -1)));} else {$jn_sum_number_ave = "---";}
                                                            if($jn_sum_number_average <> "" && $jn_sum_number_average <> 0){$jn_sum_number_ave2 = floor((int)$jn_sum_number_average / ((int)$i -1));} else {$jn_sum_number_ave2 = "---";}
                                                        } else {
                                                            $jn_sum_number_ave = number_format(floor((int)$jn_sum_number / $i));
                                                            $jn_sum_number_ave2 = floor((int)$jn_sum_number / $i);
                                                        }
                                                    } else {
                                                        $jn_sum_number_c = $jn_sum_number;
                                                        $jn_sum_number_ave = 0;
                                                        $jn_sum_number_ave2 = 0;
                                                    }
                                                    $temp4_jn_sum2 = "<div class='title4 ta_r'>" . $jn_sum_number_c . "</div><div class='title4 ta_r'>" . $jn_sum_number_ave . "</div></div>";
                                                // 全期間通販粗利合計とその平均値のHTML作成
                                                    $temp4_jn_sum3 = "";
                                                    if($jn_sum_arari <> 0 && $jn_sum_arari <> ""){
                                                        $jn_sum_arari_c = number_format((int)$jn_sum_arari);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($jn_sum_arari_average <> "" && $jn_sum_arari_average <> 0){$jn_sum_arari_ave = number_format(floor((int)$jn_sum_arari_average / ((int)$i -1)));} else {$jn_sum_arari_ave = "---";}
                                                            if($jn_sum_arari_average <> "" && $jn_sum_arari_average <> 0){$jn_sum_arari_ave2 = floor((int)$jn_sum_arari_average / ((int)$i -1));} else {$jn_sum_arari_ave2 = "---";}
                                                        } else {
                                                            $jn_sum_arari_ave = number_format(floor((int)$jn_sum_arari / $i));
                                                            $jn_sum_arari_ave2 = floor((int)$jn_sum_arari / $i);
                                                        }
                                                    } else {
                                                        $jn_sum_arari_c = $jn_sum_arari;
                                                        $jn_sum_arari_ave = 0;
                                                        $jn_sum_arari_ave2 = 0;
                                                    }
                                                    $temp4_jn_sum3 = "<div class='title4 ta_r'>" . $jn_sum_arari_c . "</div><div class='title4 ta_r'>" . $jn_sum_arari_ave . "</div></div>";




                            /************************************************************************************************************************************************************************************************************* */
                                // ジャック・U用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */

                                            // DB検索（ジャック・U値）スタート
                                                $ju_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS ju_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS ju_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS ju_number"),
                                                        \DB::raw("SUM(ararikingaku) AS ju_arari"),
                                                    ])
                                                    ->groupBy('ju_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {

                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                    
                                                        })

                                                    // 条件（期間の指定）
                                                       ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where("shouhinkubunbunruimei","like","%中古%")
                                                    // 条件（通販区分）
                                                        ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');
                            
                                                            // 条件（通販区分が自社）
                                                                if($out3_a == "ON"){
                                                                    $query->orWhere('tsuuhankubun',1);
                                                                }
                                                            // 条件（通販区分が楽天）
                                                                if($out3_b == "ON"){
                                                                    $query->orWhere('tsuuhankubun',2);
                                                                }
                                                            // 条件（通販区分がヤフー）
                                                                if($out3_c == "ON"){
                                                                    $query->orWhere('tsuuhankubun',3);
                                                                }
                                                            // 条件（通販区分が電話・雑誌）
                                                                if($out3_d == "ON"){
                                                                    $query->orWhere('tsuuhankubun',5);
                                                                }
                                                            // 条件（通販区分がYオークション）
                                                                if($out3_e == "ON"){
                                                                    $query->orWhere('tsuuhankubun',4);
                                                                }
                                                            // 条件（通販区分が修理品返送）
                                                                if($out3_f == "ON"){
                                                                    $query->orWhere('tsuuhankubun',9);
                                                                }
                            
                                                        })
                        
                                                    // 条件（免税）
                                                        ->where(function ($query) use ($out4_a,$out4_b) {
                                                                // 条件（免税区分が0:対象外）
                                                                    if($out4_a == "ON"){
                                                                        $query->orwhere("menzei","like","%対象外%");
                                                                    }
                                                                // 条件（免税区分が1:免税）
                                                                    if($out4_b == "ON"){
                                                                        $query->orwhere("menzei","like","%免税%");
                                                                    }
                                                        })
                                                    // 条件（扱い部門）
                                                        ->Where('bumonmei','Jackroad')
                                                        
                                                    // ソート順指定
                                                        ->orderBy('uriage', 'asc')
                                                        ->get();
                                            // クエリビルダスタート
                                                $i = 0;
                                                // 変数リセット
                                                    $ju_sum_uriage = "";
                                                    $ju_sum_number = "";
                                                    $ju_sum_arari = "";
                                                foreach ($ju_buys as $ju_buy) {
                                                    // 各月名
                                                        $ju_month[$i]= $ju_buy->ju_month;
                                                    // 各月通販売上
                                                        $ju_uriage[$i]= $ju_buy->ju_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp4_ju_manthly_data, $ju_month[$i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp4_ju_manthly_data = str_replace($ju_month[$i], $ju_uriage[$i], $temp4_ju_manthly_data);
                                                                }
                                                    // 全期間通販売上合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $ju_sum_uriage_average = (int)$ju_sum_uriage;
                                                            } else {
                                                                $ju_sum_uriage_average = (int)$ju_sum_uriage + (int)$ju_uriage[$i];
                                                            }

                                                        $ju_sum_uriage = (int)$ju_sum_uriage + (int)$ju_uriage[$i];
                                                    // 各月通販点数
                                                        $ju_number[$i]= $ju_buy->ju_number;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp4_ju_manthly_data2, $ju_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp4_ju_manthly_data2 = str_replace($ju_month[$i], $ju_number[$i], $temp4_ju_manthly_data2);
                                                            }

                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $ju_sum_number_average = (int)$ju_sum_number;
                                                            } else {
                                                                $ju_sum_number_average = (int)$ju_sum_number + (int)$ju_number[$i];
                                                            }
                                                        $ju_sum_number = (int)$ju_sum_number + (int)$ju_number[$i];

                                                    // 各月通販粗利
                                                        $ju_arari[$i]= $ju_buy->ju_arari;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp4_ju_manthly_data3, $ju_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp4_ju_manthly_data3 = str_replace($ju_month[$i], $ju_arari[$i], $temp4_ju_manthly_data3);
                                                            }
                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $ju_sum_arari_average = (int)$ju_sum_arari;
                                                            } else {
                                                                $ju_sum_arari_average = (int)$ju_sum_arari + (int)$ju_arari[$i];
                                                            }
                                                        $ju_sum_arari = (int)$ju_sum_arari + (int)$ju_arari[$i];

                                                    $i++;
                                                }

                                                // 全期間通販売上合計とその平均値のHTML作成
                                                    $temp4_ju_sum = "";
                                                    if($ju_sum_uriage <> 0 && $ju_sum_uriage <> ""){
                                                        $ju_sum_uriage_c = number_format((int)$ju_sum_uriage);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象                                                        
                                                        if($last_nodata_flag == "ON"){
                                                            if($ju_sum_uriage_average <> "" && $ju_sum_uriage_average <> 0){$ju_sum_uriage_ave = number_format(floor((int)$ju_sum_uriage_average / ((int)$i -1)));} else {$ju_sum_uriage_ave = "---";}
                                                            if($ju_sum_uriage_average <> "" && $ju_sum_uriage_average <> 0){$ju_sum_uriage_ave2 = floor((int)$ju_sum_uriage_average / ((int)$i -1));} else {$ju_sum_uriage_ave2 = "---";}
                                                        } else {
                                                            $ju_sum_uriage_ave = number_format(floor((int)$ju_sum_uriage / $i));
                                                            $ju_sum_uriage_ave2 = floor((int)$ju_sum_uriage / $i);
                                                        }
                                                    } else {
                                                        $ju_sum_uriage_c = $ju_sum_uriage;
                                                        $ju_sum_uriage_ave = 0;
                                                        $ju_sum_uriage_ave2 = 0;
                                                    }
                                                    $temp4_ju_sum = "<div class='title4 ta_r'>" . $ju_sum_uriage_c . "</div><div class='title4 ta_r'>" . $ju_sum_uriage_ave . "</div></div>";
                                                // 全期間通販売上点数合計とその平均値のHTML作成
                                                    $temp4_ju_sum2 = "";
                                                    if($ju_sum_number <> 0 && $ju_sum_number <> ""){
                                                        $ju_sum_number_c = number_format((int)$ju_sum_number);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($ju_sum_number_average <> "" && $ju_sum_number_average <> 0){$ju_sum_number_ave = number_format(floor((int)$ju_sum_number_average / ((int)$i -1)));} else {$ju_sum_number_ave = "---";}
                                                            if($ju_sum_number_average <> "" && $ju_sum_number_average <> 0){$ju_sum_number_ave2 = floor((int)$ju_sum_number_average / ((int)$i -1));} else {$ju_sum_number_ave2 = "---";}
                                                        } else {
                                                            $ju_sum_number_ave = number_format(floor((int)$ju_sum_number / $i));
                                                            $ju_sum_number_ave2 = floor((int)$ju_sum_number / $i);
                                                        }
                                                    } else {
                                                        $ju_sum_number_c = $ju_sum_number;
                                                        $ju_sum_number_ave = 0;
                                                        $ju_sum_number_ave2 = 0;
                                                    }
                                                    $temp4_ju_sum2 = "<div class='title4 ta_r'>" . $ju_sum_number_c . "</div><div class='title4 ta_r'>" . $ju_sum_number_ave . "</div></div>";
                                                // 全期間通販粗利合計とその平均値のHTML作成
                                                    $temp4_ju_sum3 = "";
                                                    if($ju_sum_arari <> 0 && $ju_sum_arari <> ""){
                                                        $ju_sum_arari_c = number_format((int)$ju_sum_arari);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($ju_sum_arari_average <> "" && $ju_sum_arari_average <> 0){$ju_sum_arari_ave = number_format(floor((int)$ju_sum_arari_average / ((int)$i -1)));} else {$ju_sum_arari_ave = "---";}
                                                            if($ju_sum_arari_average <> "" && $ju_sum_arari_average <> 0){$ju_sum_arari_ave2 = floor((int)$ju_sum_arari_average / ((int)$i -1));} else {$ju_sum_arari_ave2 = "---";}
                                                        } else {
                                                            $ju_sum_arari_ave = number_format(floor((int)$ju_sum_arari / $i));
                                                            $ju_sum_arari_ave2 = floor((int)$ju_sum_arari / $i);
                                                        }
                                                    } else {
                                                        $ju_sum_arari_c = $ju_sum_arari;
                                                        $ju_sum_arari_ave = 0;
                                                        $ju_sum_arari_ave2 = 0;
                                                    }
                                                    $temp4_ju_sum3 = "<div class='title4 ta_r'>" . $ju_sum_arari_c . "</div><div class='title4 ta_r'>" . $ju_sum_arari_ave . "</div></div>";


                            /************************************************************************************************************************************************************************************************************* */
                                // ジャック・A用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */

                                            // DB検索（ジャック・A値）スタート
                                                $ja_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS ja_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS ja_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS ja_number"),
                                                        \DB::raw("SUM(ararikingaku) AS ja_arari"),
                                                    ])
                                                    ->groupBy('ja_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {

                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                    
                                                        })

                                                    // 条件（期間の指定）
                                                       ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where("shouhinkubunbunruimei","like","%アンティーク%")
                                                    // 条件（通販区分）
                                                        ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');
                            
                                                            // 条件（通販区分が自社）
                                                                if($out3_a == "ON"){
                                                                    $query->orWhere('tsuuhankubun',1);
                                                                }
                                                            // 条件（通販区分が楽天）
                                                                if($out3_b == "ON"){
                                                                    $query->orWhere('tsuuhankubun',2);
                                                                }
                                                            // 条件（通販区分がヤフー）
                                                                if($out3_c == "ON"){
                                                                    $query->orWhere('tsuuhankubun',3);
                                                                }
                                                            // 条件（通販区分が電話・雑誌）
                                                                if($out3_d == "ON"){
                                                                    $query->orWhere('tsuuhankubun',5);
                                                                }
                                                            // 条件（通販区分がYオークション）
                                                                if($out3_e == "ON"){
                                                                    $query->orWhere('tsuuhankubun',4);
                                                                }
                                                            // 条件（通販区分が修理品返送）
                                                                if($out3_f == "ON"){
                                                                    $query->orWhere('tsuuhankubun',9);
                                                                }
                            
                                                        })
                        
                                                    // 条件（免税）
                                                        ->where(function ($query) use ($out4_a,$out4_b) {
                                                                // 条件（免税区分が0:対象外）
                                                                    if($out4_a == "ON"){
                                                                        $query->orwhere("menzei","like","%対象外%");
                                                                    }
                                                                // 条件（免税区分が1:免税）
                                                                    if($out4_b == "ON"){
                                                                        $query->orwhere("menzei","like","%免税%");
                                                                    }
                                                        })
                                                    // 条件（扱い部門）
                                                        ->Where('bumonmei','Jackroad')
                                                        
                                                    // ソート順指定
                                                        ->orderBy('uriage', 'asc')
                                                        ->get();
                                            // クエリビルダスタート
                                                $i = 0;
                                                // 変数リセット
                                                    $ja_sum_uriage = "";
                                                    $ja_sum_number = "";
                                                    $ja_sum_arari = "";
                                                foreach ($ja_buys as $ja_buy) {
                                                    // 各月名
                                                        $ja_month[$i]= $ja_buy->ja_month;
                                                    // 各月通販売上
                                                        $ja_uriage[$i]= $ja_buy->ja_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp4_ja_manthly_data, $ja_month[$i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp4_ja_manthly_data = str_replace($ja_month[$i], $ja_uriage[$i], $temp4_ja_manthly_data);
                                                                }
                                                    // 全期間通販売上合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $ja_sum_uriage_average = (int)$ja_sum_uriage;
                                                            } else {
                                                                $ja_sum_uriage_average = (int)$ja_sum_uriage + (int)$ja_uriage[$i];
                                                            }

                                                        $ja_sum_uriage = (int)$ja_sum_uriage + (int)$ja_uriage[$i];
                                                    // 各月通販点数
                                                        $ja_number[$i]= $ja_buy->ja_number;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp4_ja_manthly_data2, $ja_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp4_ja_manthly_data2 = str_replace($ja_month[$i], $ja_number[$i], $temp4_ja_manthly_data2);
                                                            }

                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $ja_sum_number_average = (int)$ja_sum_number;
                                                            } else {
                                                                $ja_sum_number_average = (int)$ja_sum_number + (int)$ja_number[$i];
                                                            }
                                                        $ja_sum_number = (int)$ja_sum_number + (int)$ja_number[$i];

                                                    // 各月通販粗利
                                                        $ja_arari[$i]= $ja_buy->ja_arari;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp4_ja_manthly_data3, $ja_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp4_ja_manthly_data3 = str_replace($ja_month[$i], $ja_arari[$i], $temp4_ja_manthly_data3);
                                                            }
                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $ja_sum_arari_average = (int)$ja_sum_arari;
                                                            } else {
                                                                $ja_sum_arari_average = (int)$ja_sum_arari + (int)$ja_arari[$i];
                                                            }
                                                        $ja_sum_arari = (int)$ja_sum_arari + (int)$ja_arari[$i];

                                                    $i++;
                                                }

                                                // 全期間通販売上合計とその平均値のHTML作成
                                                    $temp4_ja_sum = "";
                                                    if($ja_sum_uriage <> 0 && $ja_sum_uriage <> ""){
                                                        $ja_sum_uriage_c = number_format((int)$ja_sum_uriage);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象                                                        
                                                        if($last_nodata_flag == "ON"){
                                                            if($ja_sum_uriage_average <> "" && $ja_sum_uriage_average <> 0){$ja_sum_uriage_ave = number_format(floor((int)$ja_sum_uriage_average / ((int)$i -1)));} else {$ja_sum_uriage_ave = "---";}
                                                            if($ja_sum_uriage_average <> "" && $ja_sum_uriage_average <> 0){$ja_sum_uriage_ave2 = floor((int)$ja_sum_uriage_average / ((int)$i -1));} else {$ja_sum_uriage_ave2 = "---";}
                                                        } else {
                                                            $ja_sum_uriage_ave = number_format(floor((int)$ja_sum_uriage / $i));
                                                            $ja_sum_uriage_ave2 = floor((int)$ja_sum_uriage / $i);
                                                        }
                                                    } else {
                                                        $ja_sum_uriage_c = $ja_sum_uriage;
                                                        $ja_sum_uriage_ave = 0;
                                                        $ja_sum_uriage_ave2 = 0;
                                                    }
                                                    $temp4_ja_sum = "<div class='title4 ta_r'>" . $ja_sum_uriage_c . "</div><div class='title4 ta_r'>" . $ja_sum_uriage_ave . "</div></div>";
                                                // 全期間通販売上点数合計とその平均値のHTML作成
                                                    $temp4_ja_sum2 = "";
                                                    if($ja_sum_number <> 0 && $ja_sum_number <> ""){
                                                        $ja_sum_number_c = number_format((int)$ja_sum_number);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($ja_sum_number_average <> "" && $ja_sum_number_average <> 0){$ja_sum_number_ave = number_format(floor((int)$ja_sum_number_average / ((int)$i -1)));} else {$ja_sum_number_ave = "---";}
                                                            if($ja_sum_number_average <> "" && $ja_sum_number_average <> 0){$ja_sum_number_ave2 = floor((int)$ja_sum_number_average / ((int)$i -1));} else {$ja_sum_number_ave2 = "---";}
                                                        } else {
                                                            $ja_sum_number_ave = number_format(floor((int)$ja_sum_number / $i));
                                                            $ja_sum_number_ave2 = floor((int)$ja_sum_number / $i);
                                                        }
                                                    } else {
                                                        $ja_sum_number_c = $ja_sum_number;
                                                        $ja_sum_number_ave = 0;
                                                        $ja_sum_number_ave2 = 0;
                                                    }
                                                    $temp4_ja_sum2 = "<div class='title4 ta_r'>" . $ja_sum_number_c . "</div><div class='title4 ta_r'>" . $ja_sum_number_ave . "</div></div>";
                                                // 全期間通販粗利合計とその平均値のHTML作成
                                                    $temp4_ja_sum3 = "";
                                                    if($ja_sum_arari <> 0 && $ja_sum_arari <> ""){
                                                        $ja_sum_arari_c = number_format((int)$ja_sum_arari);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($ja_sum_arari_average <> "" && $ja_sum_arari_average <> 0){$ja_sum_arari_ave = number_format(floor((int)$ja_sum_arari_average / ((int)$i -1)));} else {$ja_sum_arari_ave = "---";}
                                                            if($ja_sum_arari_average <> "" && $ja_sum_arari_average <> 0){$ja_sum_arari_ave2 = floor((int)$ja_sum_arari_average / ((int)$i -1));} else {$ja_sum_arari_ave2 = "---";}
                                                        } else {
                                                            $ja_sum_arari_ave = number_format(floor((int)$ja_sum_arari / $i));
                                                            $ja_sum_arari_ave2 = floor((int)$ja_sum_arari / $i);
                                                        }
                                                    } else {
                                                        $ja_sum_arari_c = $ja_sum_arari;
                                                        $ja_sum_arari_ave = 0;
                                                        $ja_sum_arari_ave2 = 0;
                                                    }
                                                    $temp4_ja_sum3 = "<div class='title4 ta_r'>" . $ja_sum_arari_c . "</div><div class='title4 ta_r'>" . $ja_sum_arari_ave . "</div></div>";



                            /************************************************************************************************************************************************************************************************************* */
                                // Betty・新品用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */

                                            // DB検索（Betty・新品値）スタート
                                                $bn_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS bn_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS bn_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS bn_number"),
                                                        \DB::raw("SUM(ararikingaku) AS bn_arari"),
                                                    ])
                                                    ->groupBy('bn_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {

                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                    
                                                        })

                                                    // 条件（期間の指定）
                                                       ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where("shouhinkubunbunruimei","like","%新品%")
                                                    // 条件（通販区分）
                                                        ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');
                            
                                                            // 条件（通販区分が自社）
                                                                if($out3_a == "ON"){
                                                                    $query->orWhere('tsuuhankubun',1);
                                                                }
                                                            // 条件（通販区分が楽天）
                                                                if($out3_b == "ON"){
                                                                    $query->orWhere('tsuuhankubun',2);
                                                                }
                                                            // 条件（通販区分がヤフー）
                                                                if($out3_c == "ON"){
                                                                    $query->orWhere('tsuuhankubun',3);
                                                                }
                                                            // 条件（通販区分が電話・雑誌）
                                                                if($out3_d == "ON"){
                                                                    $query->orWhere('tsuuhankubun',5);
                                                                }
                                                            // 条件（通販区分がYオークション）
                                                                if($out3_e == "ON"){
                                                                    $query->orWhere('tsuuhankubun',4);
                                                                }
                                                            // 条件（通販区分が修理品返送）
                                                                if($out3_f == "ON"){
                                                                    $query->orWhere('tsuuhankubun',9);
                                                                }
                            
                                                        })
                        
                                                    // 条件（免税）
                                                        ->where(function ($query) use ($out4_a,$out4_b) {
                                                                // 条件（免税区分が0:対象外）
                                                                    if($out4_a == "ON"){
                                                                        $query->orwhere("menzei","like","%対象外%");
                                                                    }
                                                                // 条件（免税区分が1:免税）
                                                                    if($out4_b == "ON"){
                                                                        $query->orwhere("menzei","like","%免税%");
                                                                    }
                                                        })
                                                    // 条件（扱い部門）
                                                        ->Where('bumonmei','Bettyroad')
                                                        
                                                    // ソート順指定
                                                        ->orderBy('uriage', 'asc')
                                                        ->get();
                                            // クエリビルダスタート
                                                $i = 0;
                                                // 変数リセット
                                                    $bn_sum_uriage = "";
                                                    $bn_sum_number = "";
                                                    $bn_sum_arari = "";
                                                foreach ($bn_buys as $bn_buy) {
                                                    // 各月名
                                                        $bn_month[$i]= $bn_buy->bn_month;
                                                    // 各月通販売上
                                                        $bn_uriage[$i]= $bn_buy->bn_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp4_bn_manthly_data, $bn_month[$i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp4_bn_manthly_data = str_replace($bn_month[$i], $bn_uriage[$i], $temp4_bn_manthly_data);
                                                                }
                                                    // 全期間通販売上合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $bn_sum_uriage_average = (int)$bn_sum_uriage;
                                                            } else {
                                                                $bn_sum_uriage_average = (int)$bn_sum_uriage + (int)$bn_uriage[$i];
                                                            }

                                                        $bn_sum_uriage = (int)$bn_sum_uriage + (int)$bn_uriage[$i];
                                                    // 各月通販点数
                                                        $bn_number[$i]= $bn_buy->bn_number;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp4_bn_manthly_data2, $bn_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp4_bn_manthly_data2 = str_replace($bn_month[$i], $bn_number[$i], $temp4_bn_manthly_data2);
                                                            }

                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $bn_sum_number_average = (int)$bn_sum_number;
                                                            } else {
                                                                $bn_sum_number_average = (int)$bn_sum_number + (int)$bn_number[$i];
                                                            }
                                                        $bn_sum_number = (int)$bn_sum_number + (int)$bn_number[$i];

                                                    // 各月通販粗利
                                                        $bn_arari[$i]= $bn_buy->bn_arari;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp4_bn_manthly_data3, $bn_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp4_bn_manthly_data3 = str_replace($bn_month[$i], $bn_arari[$i], $temp4_bn_manthly_data3);
                                                            }
                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $bn_sum_arari_average = (int)$bn_sum_arari;
                                                            } else {
                                                                $bn_sum_arari_average = (int)$bn_sum_arari + (int)$bn_arari[$i];
                                                            }
                                                        $bn_sum_arari = (int)$bn_sum_arari + (int)$bn_arari[$i];

                                                    $i++;
                                                }

                                                // 全期間通販売上合計とその平均値のHTML作成
                                                    $temp4_bn_sum = "";
                                                    if($bn_sum_uriage <> 0 && $bn_sum_uriage <> ""){
                                                        $bn_sum_uriage_c = number_format((int)$bn_sum_uriage);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象                                                        
                                                        if($last_nodata_flag == "ON"){
                                                            if($bn_sum_uriage_average <> "" && $bn_sum_uriage_average <> 0){$bn_sum_uriage_ave = number_format(floor((int)$bn_sum_uriage_average / ((int)$i -1)));} else {$bn_sum_uriage_ave = "---";}
                                                            if($bn_sum_uriage_average <> "" && $bn_sum_uriage_average <> 0){$bn_sum_uriage_ave2 = floor((int)$bn_sum_uriage_average / ((int)$i -1));} else {$bn_sum_uriage_ave2 = "---";}
                                                        } else {
                                                            $bn_sum_uriage_ave = number_format(floor((int)$bn_sum_uriage / $i));
                                                            $bn_sum_uriage_ave2 = floor((int)$bn_sum_uriage / $i);
                                                        }
                                                    } else {
                                                        $bn_sum_uriage_c = $bn_sum_uriage;
                                                        $bn_sum_uriage_ave = 0;
                                                        $bn_sum_uriage_ave2 = 0;
                                                    }
                                                    $temp4_bn_sum = "<div class='title4 ta_r'>" . $bn_sum_uriage_c . "</div><div class='title4 ta_r'>" . $bn_sum_uriage_ave . "</div></div>";
                                                // 全期間通販売上点数合計とその平均値のHTML作成
                                                    $temp4_bn_sum2 = "";
                                                    if($bn_sum_number <> 0 && $bn_sum_number <> ""){
                                                        $bn_sum_number_c = number_format((int)$bn_sum_number);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($bn_sum_number_average <> "" && $bn_sum_number_average <> 0){$bn_sum_number_ave = number_format(floor((int)$bn_sum_number_average / ((int)$i -1)));} else {$bn_sum_number_ave = "---";}
                                                            if($bn_sum_number_average <> "" && $bn_sum_number_average <> 0){$bn_sum_number_ave2 = floor((int)$bn_sum_number_average / ((int)$i -1));} else {$bn_sum_number_ave2 = "---";}
                                                        } else {
                                                            $bn_sum_number_ave = number_format(floor((int)$bn_sum_number / $i));
                                                            $bn_sum_number_ave2 = floor((int)$bn_sum_number / $i);
                                                        }
                                                    } else {
                                                        $bn_sum_number_c = $bn_sum_number;
                                                        $bn_sum_number_ave = 0;
                                                        $bn_sum_number_ave2 = 0;
                                                    }
                                                    $temp4_bn_sum2 = "<div class='title4 ta_r'>" . $bn_sum_number_c . "</div><div class='title4 ta_r'>" . $bn_sum_number_ave . "</div></div>";
                                                // 全期間通販粗利合計とその平均値のHTML作成
                                                    $temp4_bn_sum3 = "";
                                                    if($bn_sum_arari <> 0 && $bn_sum_arari <> ""){
                                                        $bn_sum_arari_c = number_format((int)$bn_sum_arari);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($bn_sum_arari_average <> "" && $bn_sum_arari_average <> 0){$bn_sum_arari_ave = number_format(floor((int)$bn_sum_arari_average / ((int)$i -1)));} else {$bn_sum_arari_ave = "---";}
                                                            if($bn_sum_arari_average <> "" && $bn_sum_arari_average <> 0){$bn_sum_arari_ave2 = floor((int)$bn_sum_arari_average / ((int)$i -1));} else {$bn_sum_arari_ave2 = "---";}
                                                        } else {
                                                            $bn_sum_arari_ave = number_format(floor((int)$bn_sum_arari / $i));
                                                            $bn_sum_arari_ave2 = floor((int)$bn_sum_arari / $i);
                                                        }
                                                    } else {
                                                        $bn_sum_arari_c = $bn_sum_arari;
                                                        $bn_sum_arari_ave = 0;
                                                        $bn_sum_arari_ave2 = 0;
                                                    }
                                                    $temp4_bn_sum3 = "<div class='title4 ta_r'>" . $bn_sum_arari_c . "</div><div class='title4 ta_r'>" . $bn_sum_arari_ave . "</div></div>";


                            /************************************************************************************************************************************************************************************************************* */
                                // Betty・中古用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */

                                            // DB検索（Betty・中古値）スタート
                                                $bu_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS bu_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS bu_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS bu_number"),
                                                        \DB::raw("SUM(ararikingaku) AS bu_arari"),
                                                    ])
                                                    ->groupBy('bu_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {

                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                    
                                                        })

                                                    // 条件（期間の指定）
                                                       ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where("shouhinkubunbunruimei","like","%中古%")
                                                    // 条件（通販区分）
                                                        ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');
                            
                                                            // 条件（通販区分が自社）
                                                                if($out3_a == "ON"){
                                                                    $query->orWhere('tsuuhankubun',1);
                                                                }
                                                            // 条件（通販区分が楽天）
                                                                if($out3_b == "ON"){
                                                                    $query->orWhere('tsuuhankubun',2);
                                                                }
                                                            // 条件（通販区分がヤフー）
                                                                if($out3_c == "ON"){
                                                                    $query->orWhere('tsuuhankubun',3);
                                                                }
                                                            // 条件（通販区分が電話・雑誌）
                                                                if($out3_d == "ON"){
                                                                    $query->orWhere('tsuuhankubun',5);
                                                                }
                                                            // 条件（通販区分がYオークション）
                                                                if($out3_e == "ON"){
                                                                    $query->orWhere('tsuuhankubun',4);
                                                                }
                                                            // 条件（通販区分が修理品返送）
                                                                if($out3_f == "ON"){
                                                                    $query->orWhere('tsuuhankubun',9);
                                                                }
                            
                                                        })
                        
                                                    // 条件（免税）
                                                        ->where(function ($query) use ($out4_a,$out4_b) {
                                                                // 条件（免税区分が0:対象外）
                                                                    if($out4_a == "ON"){
                                                                        $query->orwhere("menzei","like","%対象外%");
                                                                    }
                                                                // 条件（免税区分が1:免税）
                                                                    if($out4_b == "ON"){
                                                                        $query->orwhere("menzei","like","%免税%");
                                                                    }
                                                        })
                                                    // 条件（扱い部門）
                                                        ->Where('bumonmei','Bettyroad')
                                                        
                                                    // ソート順指定
                                                        ->orderBy('uriage', 'asc')
                                                        ->get();
                                            // クエリビルダスタート
                                                $i = 0;
                                                // 変数リセット
                                                    $bu_sum_uriage = "";
                                                    $bu_sum_number = "";
                                                    $bu_sum_arari = "";
                                                foreach ($bu_buys as $bu_buy) {
                                                    // 各月名
                                                        $bu_month[$i]= $bu_buy->bu_month;
                                                    // 各月通販売上
                                                        $bu_uriage[$i]= $bu_buy->bu_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp4_bu_manthly_data, $bu_month[$i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp4_bu_manthly_data = str_replace($bu_month[$i], $bu_uriage[$i], $temp4_bu_manthly_data);
                                                                }
                                                    // 全期間通販売上合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $bu_sum_uriage_average = (int)$bu_sum_uriage;
                                                            } else {
                                                                $bu_sum_uriage_average = (int)$bu_sum_uriage + (int)$bu_uriage[$i];
                                                            }

                                                        $bu_sum_uriage = (int)$bu_sum_uriage + (int)$bu_uriage[$i];
                                                    // 各月通販点数
                                                        $bu_number[$i]= $bu_buy->bu_number;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp4_bu_manthly_data2, $bu_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp4_bu_manthly_data2 = str_replace($bu_month[$i], $bu_number[$i], $temp4_bu_manthly_data2);
                                                            }

                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $bu_sum_number_average = (int)$bu_sum_number;
                                                            } else {
                                                                $bu_sum_number_average = (int)$bu_sum_number + (int)$bu_number[$i];
                                                            }
                                                        $bu_sum_number = (int)$bu_sum_number + (int)$bu_number[$i];

                                                    // 各月通販粗利
                                                        $bu_arari[$i]= $bu_buy->bu_arari;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp4_bu_manthly_data3, $bu_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp4_bu_manthly_data3 = str_replace($bu_month[$i], $bu_arari[$i], $temp4_bu_manthly_data3);
                                                            }
                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $bu_sum_arari_average = (int)$bu_sum_arari;
                                                            } else {
                                                                $bu_sum_arari_average = (int)$bu_sum_arari + (int)$bu_arari[$i];
                                                            }
                                                        $bu_sum_arari = (int)$bu_sum_arari + (int)$bu_arari[$i];

                                                    $i++;
                                                }

                                                // 全期間通販売上合計とその平均値のHTML作成
                                                    $temp4_bu_sum = "";
                                                    if($bu_sum_uriage <> 0 && $bu_sum_uriage <> ""){
                                                        $bu_sum_uriage_c = number_format((int)$bu_sum_uriage);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象                                                        
                                                        if($last_nodata_flag == "ON"){
                                                            if($bu_sum_uriage_average <> "" && $bu_sum_uriage_average <> 0){$bu_sum_uriage_ave = number_format(floor((int)$bu_sum_uriage_average / ((int)$i -1)));} else {$bu_sum_uriage_ave = "---";}
                                                            if($bu_sum_uriage_average <> "" && $bu_sum_uriage_average <> 0){$bu_sum_uriage_ave2 = floor((int)$bu_sum_uriage_average / ((int)$i -1));} else {$bu_sum_uriage_ave2 = "---";}
                                                        } else {
                                                            $bu_sum_uriage_ave = number_format(floor((int)$bu_sum_uriage / $i));
                                                            $bu_sum_uriage_ave2 = floor((int)$bu_sum_uriage / $i);
                                                        }
                                                    } else {
                                                        $bu_sum_uriage_c = $bu_sum_uriage;
                                                        $bu_sum_uriage_ave = 0;
                                                        $bu_sum_uriage_ave2 = 0;
                                                    }
                                                    $temp4_bu_sum = "<div class='title4 ta_r'>" . $bu_sum_uriage_c . "</div><div class='title4 ta_r'>" . $bu_sum_uriage_ave . "</div></div>";
                                                // 全期間通販売上点数合計とその平均値のHTML作成
                                                    $temp4_bu_sum2 = "";
                                                    if($bu_sum_number <> 0 && $bu_sum_number <> ""){
                                                        $bu_sum_number_c = number_format((int)$bu_sum_number);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($bu_sum_number_average <> "" && $bu_sum_number_average <> 0){$bu_sum_number_ave = number_format(floor((int)$bu_sum_number_average / ((int)$i -1)));} else {$bu_sum_number_ave = "---";}
                                                            if($bu_sum_number_average <> "" && $bu_sum_number_average <> 0){$bu_sum_number_ave2 = floor((int)$bu_sum_number_average / ((int)$i -1));} else {$bu_sum_number_ave2 = "---";}
                                                        } else {
                                                            $bu_sum_number_ave = number_format(floor((int)$bu_sum_number / $i));
                                                            $bu_sum_number_ave2 = floor((int)$bu_sum_number / $i);
                                                        }
                                                    } else {
                                                        $bu_sum_number_c = $bu_sum_number;
                                                        $bu_sum_number_ave = 0;
                                                        $bu_sum_number_ave2 = 0;
                                                    }
                                                    $temp4_bu_sum2 = "<div class='title4 ta_r'>" . $bu_sum_number_c . "</div><div class='title4 ta_r'>" . $bu_sum_number_ave . "</div></div>";
                                                // 全期間通販粗利合計とその平均値のHTML作成
                                                    $temp4_bu_sum3 = "";
                                                    if($bu_sum_arari <> 0 && $bu_sum_arari <> ""){
                                                        $bu_sum_arari_c = number_format((int)$bu_sum_arari);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($bu_sum_arari_average <> "" && $bu_sum_arari_average <> 0){$bu_sum_arari_ave = number_format(floor((int)$bu_sum_arari_average / ((int)$i -1)));} else {$bu_sum_arari_ave = "---";}
                                                            if($bu_sum_arari_average <> "" && $bu_sum_arari_average <> 0){$bu_sum_arari_ave2 = floor((int)$bu_sum_arari_average / ((int)$i -1));} else {$bu_sum_arari_ave2 = "---";}
                                                        } else {
                                                            $bu_sum_arari_ave = number_format(floor((int)$bu_sum_arari / $i));
                                                            $bu_sum_arari_ave2 = floor((int)$bu_sum_arari / $i);
                                                        }
                                                    } else {
                                                        $bu_sum_arari_c = $bu_sum_arari;
                                                        $bu_sum_arari_ave = 0;
                                                        $bu_sum_arari_ave2 = 0;
                                                    }
                                                    $temp4_bu_sum3 = "<div class='title4 ta_r'>" . $bu_sum_arari_c . "</div><div class='title4 ta_r'>" . $bu_sum_arari_ave . "</div></div>";




                            /************************************************************************************************************************************************************************************************************* */
                                // Betty・アンティーク用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */

                                            // DB検索（Betty・アンティーク値）スタート
                                                $ba_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS ba_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS ba_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS ba_number"),
                                                        \DB::raw("SUM(ararikingaku) AS ba_arari"),
                                                    ])
                                                    ->groupBy('ba_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {

                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                    
                                                        })

                                                    // 条件（期間の指定）
                                                       ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where("shouhinkubunbunruimei","like","%アンティーク%")
                                                    // 条件（通販区分）
                                                        ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');
                            
                                                            // 条件（通販区分が自社）
                                                                if($out3_a == "ON"){
                                                                    $query->orWhere('tsuuhankubun',1);
                                                                }
                                                            // 条件（通販区分が楽天）
                                                                if($out3_b == "ON"){
                                                                    $query->orWhere('tsuuhankubun',2);
                                                                }
                                                            // 条件（通販区分がヤフー）
                                                                if($out3_c == "ON"){
                                                                    $query->orWhere('tsuuhankubun',3);
                                                                }
                                                            // 条件（通販区分が電話・雑誌）
                                                                if($out3_d == "ON"){
                                                                    $query->orWhere('tsuuhankubun',5);
                                                                }
                                                            // 条件（通販区分がYオークション）
                                                                if($out3_e == "ON"){
                                                                    $query->orWhere('tsuuhankubun',4);
                                                                }
                                                            // 条件（通販区分が修理品返送）
                                                                if($out3_f == "ON"){
                                                                    $query->orWhere('tsuuhankubun',9);
                                                                }
                            
                                                        })
                        
                                                    // 条件（免税）
                                                        ->where(function ($query) use ($out4_a,$out4_b) {
                                                                // 条件（免税区分が0:対象外）
                                                                    if($out4_a == "ON"){
                                                                        $query->orwhere("menzei","like","%対象外%");
                                                                    }
                                                                // 条件（免税区分が1:免税）
                                                                    if($out4_b == "ON"){
                                                                        $query->orwhere("menzei","like","%免税%");
                                                                    }
                                                        })
                                                    // 条件（扱い部門）
                                                        ->Where('bumonmei','Bettyroad')
                                                        
                                                    // ソート順指定
                                                        ->orderBy('uriage', 'asc')
                                                        ->get();
                                            // クエリビルダスタート
                                                $i = 0;
                                                // 変数リセット
                                                    $ba_sum_uriage = "";
                                                    $ba_sum_number = "";
                                                    $ba_sum_arari = "";
                                                foreach ($ba_buys as $ba_buy) {
                                                    // 各月名
                                                        $ba_month[$i]= $ba_buy->ba_month;
                                                    // 各月通販売上
                                                        $ba_uriage[$i]= $ba_buy->ba_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp4_ba_manthly_data, $ba_month[$i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp4_ba_manthly_data = str_replace($ba_month[$i], $ba_uriage[$i], $temp4_ba_manthly_data);
                                                                }
                                                    // 全期間通販売上合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $ba_sum_uriage_average = (int)$ba_sum_uriage;
                                                            } else {
                                                                $ba_sum_uriage_average = (int)$ba_sum_uriage + (int)$ba_uriage[$i];
                                                            }

                                                        $ba_sum_uriage = (int)$ba_sum_uriage + (int)$ba_uriage[$i];
                                                    // 各月通販点数
                                                        $ba_number[$i]= $ba_buy->ba_number;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp4_ba_manthly_data2, $ba_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp4_ba_manthly_data2 = str_replace($ba_month[$i], $ba_number[$i], $temp4_ba_manthly_data2);
                                                            }

                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $ba_sum_number_average = (int)$ba_sum_number;
                                                            } else {
                                                                $ba_sum_number_average = (int)$ba_sum_number + (int)$ba_number[$i];
                                                            }
                                                        $ba_sum_number = (int)$ba_sum_number + (int)$ba_number[$i];

                                                    // 各月通販粗利
                                                        $ba_arari[$i]= $ba_buy->ba_arari;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp4_ba_manthly_data3, $ba_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp4_ba_manthly_data3 = str_replace($ba_month[$i], $ba_arari[$i], $temp4_ba_manthly_data3);
                                                            }
                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $ba_sum_arari_average = (int)$ba_sum_arari;
                                                            } else {
                                                                $ba_sum_arari_average = (int)$ba_sum_arari + (int)$ba_arari[$i];
                                                            }
                                                        $ba_sum_arari = (int)$ba_sum_arari + (int)$ba_arari[$i];

                                                    $i++;
                                                }

                                                // 全期間通販売上合計とその平均値のHTML作成
                                                    $temp4_ba_sum = "";
                                                    if($ba_sum_uriage <> 0 && $ba_sum_uriage <> ""){
                                                        $ba_sum_uriage_c = number_format((int)$ba_sum_uriage);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象                                                        
                                                        if($last_nodata_flag == "ON"){
                                                            if($ba_sum_uriage_average <> "" && $ba_sum_uriage_average <> 0){$ba_sum_uriage_ave = number_format(floor((int)$ba_sum_uriage_average / ((int)$i -1)));} else {$ba_sum_uriage_ave = "---";}
                                                            if($ba_sum_uriage_average <> "" && $ba_sum_uriage_average <> 0){$ba_sum_uriage_ave2 = floor((int)$ba_sum_uriage_average / ((int)$i -1));} else {$ba_sum_uriage_ave2 = "---";}
                                                        } else {
                                                            $ba_sum_uriage_ave = number_format(floor((int)$ba_sum_uriage / $i));
                                                            $ba_sum_uriage_ave2 = floor((int)$ba_sum_uriage / $i);
                                                        }
                                                    } else {
                                                        $ba_sum_uriage_c = $ba_sum_uriage;
                                                        $ba_sum_uriage_ave = 0;
                                                        $ba_sum_uriage_ave2 = 0;
                                                    }
                                                    $temp4_ba_sum = "<div class='title4 ta_r'>" . $ba_sum_uriage_c . "</div><div class='title4 ta_r'>" . $ba_sum_uriage_ave . "</div></div>";
                                                // 全期間通販売上点数合計とその平均値のHTML作成
                                                    $temp4_ba_sum2 = "";
                                                    if($ba_sum_number <> 0 && $ba_sum_number <> ""){
                                                        $ba_sum_number_c = number_format((int)$ba_sum_number);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($ba_sum_number_average <> "" && $ba_sum_number_average <> 0){$ba_sum_number_ave = number_format(floor((int)$ba_sum_number_average / ((int)$i -1)));} else {$ba_sum_number_ave = "---";}
                                                            if($ba_sum_number_average <> "" && $ba_sum_number_average <> 0){$ba_sum_number_ave2 = floor((int)$ba_sum_number_average / ((int)$i -1));} else {$ba_sum_number_ave2 = "---";}
                                                        } else {
                                                            $ba_sum_number_ave = number_format(floor((int)$ba_sum_number / $i));
                                                            $ba_sum_number_ave2 = floor((int)$ba_sum_number / $i);
                                                        }
                                                    } else {
                                                        $ba_sum_number_c = $ba_sum_number;
                                                        $ba_sum_number_ave = 0;
                                                        $ba_sum_number_ave2 = 0;
                                                    }
                                                    $temp4_ba_sum2 = "<div class='title4 ta_r'>" . $ba_sum_number_c . "</div><div class='title4 ta_r'>" . $ba_sum_number_ave . "</div></div>";
                                                // 全期間通販粗利合計とその平均値のHTML作成
                                                    $temp4_ba_sum3 = "";
                                                    if($ba_sum_arari <> 0 && $ba_sum_arari <> ""){
                                                        $ba_sum_arari_c = number_format((int)$ba_sum_arari);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($ba_sum_arari_average <> "" && $ba_sum_arari_average <> 0){$ba_sum_arari_ave = number_format(floor((int)$ba_sum_arari_average / ((int)$i -1)));} else {$ba_sum_arari_ave = "---";}
                                                            if($ba_sum_arari_average <> "" && $ba_sum_arari_average <> 0){$ba_sum_arari_ave2 = floor((int)$ba_sum_arari_average / ((int)$i -1));} else {$ba_sum_arari_ave2 = "---";}
                                                        } else {
                                                            $ba_sum_arari_ave = number_format(floor((int)$ba_sum_arari / $i));
                                                            $ba_sum_arari_ave2 = floor((int)$ba_sum_arari / $i);
                                                        }
                                                    } else {
                                                        $ba_sum_arari_c = $ba_sum_arari;
                                                        $ba_sum_arari_ave = 0;
                                                        $ba_sum_arari_ave2 = 0;
                                                    }
                                                    $temp4_ba_sum3 = "<div class='title4 ta_r'>" . $ba_sum_arari_c . "</div><div class='title4 ta_r'>" . $ba_sum_arari_ave . "</div></div>";



                            /************************************************************************************************************************************************************************************************************* */
                                // ジュエリー・N用
                            /************************************************************************************************************************************************************************************************************* */

                                            // DB検索（ジュエリー・N値）スタート
                                                $jln_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS jln_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS jln_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS jln_number"),
                                                        \DB::raw("SUM(ararikingaku) AS jln_arari"),
                                                    ])
                                                    ->groupBy('jln_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {

                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                    
                                                        })

                                                    // 条件（期間の指定）
                                                       ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where("shouhinkubunbunruimei","like","%ｼﾞｭｴﾘｰ新品%")
                                                    // 条件（通販区分）
                                                        ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');
                            
                                                            // 条件（通販区分が自社）
                                                                if($out3_a == "ON"){
                                                                    $query->orWhere('tsuuhankubun',1);
                                                                }
                                                            // 条件（通販区分が楽天）
                                                                if($out3_b == "ON"){
                                                                    $query->orWhere('tsuuhankubun',2);
                                                                }
                                                            // 条件（通販区分がヤフー）
                                                                if($out3_c == "ON"){
                                                                    $query->orWhere('tsuuhankubun',3);
                                                                }
                                                            // 条件（通販区分が電話・雑誌）
                                                                if($out3_d == "ON"){
                                                                    $query->orWhere('tsuuhankubun',5);
                                                                }
                                                            // 条件（通販区分がYオークション）
                                                                if($out3_e == "ON"){
                                                                    $query->orWhere('tsuuhankubun',4);
                                                                }
                                                            // 条件（通販区分が修理品返送）
                                                                if($out3_f == "ON"){
                                                                    $query->orWhere('tsuuhankubun',9);
                                                                }
                            
                                                        })
                        
                                                    // 条件（免税）
                                                        ->where(function ($query) use ($out4_a,$out4_b) {
                                                                // 条件（免税区分が0:対象外）
                                                                    if($out4_a == "ON"){
                                                                        $query->orwhere("menzei","like","%対象外%");
                                                                    }
                                                                // 条件（免税区分が1:免税）
                                                                    if($out4_b == "ON"){
                                                                        $query->orwhere("menzei","like","%免税%");
                                                                    }
                                                        })
                                                    // 条件（扱い部門）
                                                        ->Where('bumonmei','Jewelry')
                                                        
                                                    // ソート順指定
                                                        ->orderBy('uriage', 'asc')
                                                        ->get();
                                            // クエリビルダスタート
                                                $i = 0;
                                                // 変数リセット
                                                    $jln_sum_uriage = "";
                                                    $jln_sum_number = "";
                                                    $jln_sum_arari = "";
                                                foreach ($jln_buys as $jln_buy) {
                                                    // 各月名
                                                        $jln_month[$i]= $jln_buy->jln_month;
                                                    // 各月通販売上
                                                        $jln_uriage[$i]= $jln_buy->jln_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp4_jln_manthly_data, $jln_month[$i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp4_jln_manthly_data = str_replace($jln_month[$i], $jln_uriage[$i], $temp4_jln_manthly_data);
                                                                }
                                                    // 全期間通販売上合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $jln_sum_uriage_average = (int)$jln_sum_uriage;
                                                            } else {
                                                                $jln_sum_uriage_average = (int)$jln_sum_uriage + (int)$jln_uriage[$i];
                                                            }

                                                        $jln_sum_uriage = (int)$jln_sum_uriage + (int)$jln_uriage[$i];
                                                    // 各月通販点数
                                                        $jln_number[$i]= $jln_buy->jln_number;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp4_jln_manthly_data2, $jln_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp4_jln_manthly_data2 = str_replace($jln_month[$i], $jln_number[$i], $temp4_jln_manthly_data2);
                                                            }

                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $jln_sum_number_average = (int)$jln_sum_number;
                                                            } else {
                                                                $jln_sum_number_average = (int)$jln_sum_number + (int)$jln_number[$i];
                                                            }
                                                        $jln_sum_number = (int)$jln_sum_number + (int)$jln_number[$i];

                                                    // 各月通販粗利
                                                        $jln_arari[$i]= $jln_buy->jln_arari;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp4_jln_manthly_data3, $jln_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp4_jln_manthly_data3 = str_replace($jln_month[$i], $jln_arari[$i], $temp4_jln_manthly_data3);
                                                            }
                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $jln_sum_arari_average = (int)$jln_sum_arari;
                                                            } else {
                                                                $jln_sum_arari_average = (int)$jln_sum_arari + (int)$jln_arari[$i];
                                                            }
                                                        $jln_sum_arari = (int)$jln_sum_arari + (int)$jln_arari[$i];

                                                    $i++;
                                                }

                                                // 全期間通販売上合計とその平均値のHTML作成
                                                    $temp4_jln_sum = "";
                                                    if($jln_sum_uriage <> 0 && $jln_sum_uriage <> ""){
                                                        $jln_sum_uriage_c = number_format((int)$jln_sum_uriage);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象                                                        
                                                        if($last_nodata_flag == "ON"){
                                                            if($jln_sum_uriage_average <> "" && $jln_sum_uriage_average <> 0){$jln_sum_uriage_ave = number_format(floor((int)$jln_sum_uriage_average / ((int)$i -1)));} else {$jln_sum_uriage_ave = "---";}
                                                            if($jln_sum_uriage_average <> "" && $jln_sum_uriage_average <> 0){$jln_sum_uriage_ave2 = floor((int)$jln_sum_uriage_average / ((int)$i -1));} else {$jln_sum_uriage_ave2 = "---";}
                                                        } else {
                                                            $jln_sum_uriage_ave = number_format(floor((int)$jln_sum_uriage / $i));
                                                            $jln_sum_uriage_ave2 = floor((int)$jln_sum_uriage / $i);
                                                        }
                                                    } else {
                                                        $jln_sum_uriage_c = $jln_sum_uriage;
                                                        $jln_sum_uriage_ave = 0;
                                                        $jln_sum_uriage_ave2 = 0;
                                                    }
                                                    $temp4_jln_sum = "<div class='title4 ta_r'>" . $jln_sum_uriage_c . "</div><div class='title4 ta_r'>" . $jln_sum_uriage_ave . "</div></div>";
                                                // 全期間通販売上点数合計とその平均値のHTML作成
                                                    $temp4_jln_sum2 = "";
                                                    if($jln_sum_number <> 0 && $jln_sum_number <> ""){
                                                        $jln_sum_number_c = number_format((int)$jln_sum_number);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($jln_sum_number_average <> "" && $jln_sum_number_average <> 0){$jln_sum_number_ave = number_format(floor((int)$jln_sum_number_average / ((int)$i -1)));} else {$jln_sum_number_ave = "---";}
                                                            if($jln_sum_number_average <> "" && $jln_sum_number_average <> 0){$jln_sum_number_ave2 = floor((int)$jln_sum_number_average / ((int)$i -1));} else {$jln_sum_number_ave2 = "---";}
                                                        } else {
                                                            $jln_sum_number_ave = number_format(floor((int)$jln_sum_number / $i));
                                                            $jln_sum_number_ave2 = floor((int)$jln_sum_number / $i);
                                                        }
                                                    } else {
                                                        $jln_sum_number_c = $jln_sum_number;
                                                        $jln_sum_number_ave = 0;
                                                        $jln_sum_number_ave2 = 0;
                                                    }
                                                    $temp4_jln_sum2 = "<div class='title4 ta_r'>" . $jln_sum_number_c . "</div><div class='title4 ta_r'>" . $jln_sum_number_ave . "</div></div>";
                                                // 全期間通販粗利合計とその平均値のHTML作成
                                                    $temp4_jln_sum3 = "";
                                                    if($jln_sum_arari <> 0 && $jln_sum_arari <> ""){
                                                        $jln_sum_arari_c = number_format((int)$jln_sum_arari);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($jln_sum_arari_average <> "" && $jln_sum_arari_average <> 0){$jln_sum_arari_ave = number_format(floor((int)$jln_sum_arari_average / ((int)$i -1)));} else {$jln_sum_arari_ave = "---";}
                                                            if($jln_sum_arari_average <> "" && $jln_sum_arari_average <> 0){$jln_sum_arari_ave2 = floor((int)$jln_sum_arari_average / ((int)$i -1));} else {$jln_sum_arari_ave2 = "---";}
                                                        } else {
                                                            $jln_sum_arari_ave = number_format(floor((int)$jln_sum_arari / $i));
                                                            $jln_sum_arari_ave2 = floor((int)$jln_sum_arari / $i);
                                                        }
                                                    } else {
                                                        $jln_sum_arari_c = $jln_sum_arari;
                                                        $jln_sum_arari_ave = 0;
                                                        $jln_sum_arari_ave2 = 0;
                                                    }
                                                    $temp4_jln_sum3 = "<div class='title4 ta_r'>" . $jln_sum_arari_c . "</div><div class='title4 ta_r'>" . $jln_sum_arari_ave . "</div></div>";


                            /************************************************************************************************************************************************************************************************************* */
                                // ジュエリー・U用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */

                                            // DB検索（ジュエリー・U値）スタート
                                                $jlu_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS jlu_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS jlu_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS jlu_number"),
                                                        \DB::raw("SUM(ararikingaku) AS jlu_arari"),
                                                    ])
                                                    ->groupBy('jlu_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {

                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                    
                                                        })

                                                    // 条件（期間の指定）
                                                       ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where("shouhinkubunbunruimei","like","%ｼﾞｭｴﾘｰ中古%")
                                                    // 条件（通販区分）
                                                        ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');
                            
                                                            // 条件（通販区分が自社）
                                                                if($out3_a == "ON"){
                                                                    $query->orWhere('tsuuhankubun',1);
                                                                }
                                                            // 条件（通販区分が楽天）
                                                                if($out3_b == "ON"){
                                                                    $query->orWhere('tsuuhankubun',2);
                                                                }
                                                            // 条件（通販区分がヤフー）
                                                                if($out3_c == "ON"){
                                                                    $query->orWhere('tsuuhankubun',3);
                                                                }
                                                            // 条件（通販区分が電話・雑誌）
                                                                if($out3_d == "ON"){
                                                                    $query->orWhere('tsuuhankubun',5);
                                                                }
                                                            // 条件（通販区分がYオークション）
                                                                if($out3_e == "ON"){
                                                                    $query->orWhere('tsuuhankubun',4);
                                                                }
                                                            // 条件（通販区分が修理品返送）
                                                                if($out3_f == "ON"){
                                                                    $query->orWhere('tsuuhankubun',9);
                                                                }
                            
                                                        })
                        
                                                    // 条件（免税）
                                                        ->where(function ($query) use ($out4_a,$out4_b) {
                                                                // 条件（免税区分が0:対象外）
                                                                    if($out4_a == "ON"){
                                                                        $query->orwhere("menzei","like","%対象外%");
                                                                    }
                                                                // 条件（免税区分が1:免税）
                                                                    if($out4_b == "ON"){
                                                                        $query->orwhere("menzei","like","%免税%");
                                                                    }
                                                        })
                                                    // 条件（扱い部門）
                                                        ->Where('bumonmei','Jewelry')
                                                        
                                                    // ソート順指定
                                                        ->orderBy('uriage', 'asc')
                                                        ->get();
                                            // クエリビルダスタート
                                                $i = 0;
                                                // 変数リセット
                                                    $jlu_sum_uriage = "";
                                                    $jlu_sum_number = "";
                                                    $jlu_sum_arari = "";
                                                foreach ($jlu_buys as $jlu_buy) {
                                                    // 各月名
                                                        $jlu_month[$i]= $jlu_buy->jlu_month;
                                                    // 各月通販売上
                                                        $jlu_uriage[$i]= $jlu_buy->jlu_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp4_jlu_manthly_data, $jlu_month[$i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp4_jlu_manthly_data = str_replace($jlu_month[$i], $jlu_uriage[$i], $temp4_jlu_manthly_data);
                                                                }
                                                    // 全期間通販売上合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $jlu_sum_uriage_average = (int)$jlu_sum_uriage;
                                                            } else {
                                                                $jlu_sum_uriage_average = (int)$jlu_sum_uriage + (int)$jlu_uriage[$i];
                                                            }

                                                        $jlu_sum_uriage = (int)$jlu_sum_uriage + (int)$jlu_uriage[$i];
                                                    // 各月通販点数
                                                        $jlu_number[$i]= $jlu_buy->jlu_number;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp4_jlu_manthly_data2, $jlu_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp4_jlu_manthly_data2 = str_replace($jlu_month[$i], $jlu_number[$i], $temp4_jlu_manthly_data2);
                                                            }

                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $jlu_sum_number_average = (int)$jlu_sum_number;
                                                            } else {
                                                                $jlu_sum_number_average = (int)$jlu_sum_number + (int)$jlu_number[$i];
                                                            }
                                                        $jlu_sum_number = (int)$jlu_sum_number + (int)$jlu_number[$i];

                                                    // 各月通販粗利
                                                        $jlu_arari[$i]= $jlu_buy->jlu_arari;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp4_jlu_manthly_data3, $jlu_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp4_jlu_manthly_data3 = str_replace($jlu_month[$i], $jlu_arari[$i], $temp4_jlu_manthly_data3);
                                                            }
                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $jlu_sum_arari_average = (int)$jlu_sum_arari;
                                                            } else {
                                                                $jlu_sum_arari_average = (int)$jlu_sum_arari + (int)$jlu_arari[$i];
                                                            }
                                                        $jlu_sum_arari = (int)$jlu_sum_arari + (int)$jlu_arari[$i];

                                                    $i++;
                                                }

                                                // 全期間通販売上合計とその平均値のHTML作成
                                                    $temp4_jlu_sum = "";
                                                    if($jlu_sum_uriage <> 0 && $jlu_sum_uriage <> ""){
                                                        $jlu_sum_uriage_c = number_format((int)$jlu_sum_uriage);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象                                                        
                                                        if($last_nodata_flag == "ON"){
                                                            if($jlu_sum_uriage_average <> "" && $jlu_sum_uriage_average <> 0){$jlu_sum_uriage_ave = number_format(floor((int)$jlu_sum_uriage_average / ((int)$i -1)));} else {$jlu_sum_uriage_ave = "---";}
                                                            if($jlu_sum_uriage_average <> "" && $jlu_sum_uriage_average <> 0){$jlu_sum_uriage_ave2 = floor((int)$jlu_sum_uriage_average / ((int)$i -1));} else {$jlu_sum_uriage_ave2 = "---";}
                                                        } else {
                                                            $jlu_sum_uriage_ave = number_format(floor((int)$jlu_sum_uriage / $i));
                                                            $jlu_sum_uriage_ave2 = floor((int)$jlu_sum_uriage / $i);
                                                        }
                                                    } else {
                                                        $jlu_sum_uriage_c = $jlu_sum_uriage;
                                                        $jlu_sum_uriage_ave = 0;
                                                        $jlu_sum_uriage_ave2 = 0;
                                                    }
                                                    $temp4_jlu_sum = "<div class='title4 ta_r'>" . $jlu_sum_uriage_c . "</div><div class='title4 ta_r'>" . $jlu_sum_uriage_ave . "</div></div>";
                                                // 全期間通販売上点数合計とその平均値のHTML作成
                                                    $temp4_jlu_sum2 = "";
                                                    if($jlu_sum_number <> 0 && $jlu_sum_number <> ""){
                                                        $jlu_sum_number_c = number_format((int)$jlu_sum_number);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($jlu_sum_number_average <> "" && $jlu_sum_number_average <> 0){$jlu_sum_number_ave = number_format(floor((int)$jlu_sum_number_average / ((int)$i -1)));} else {$jlu_sum_number_ave = "---";}
                                                            if($jlu_sum_number_average <> "" && $jlu_sum_number_average <> 0){$jlu_sum_number_ave2 = floor((int)$jlu_sum_number_average / ((int)$i -1));} else {$jlu_sum_number_ave2 = "---";}
                                                        } else {
                                                            $jlu_sum_number_ave = number_format(floor((int)$jlu_sum_number / $i));
                                                            $jlu_sum_number_ave2 = floor((int)$jlu_sum_number / $i);
                                                        }
                                                    } else {
                                                        $jlu_sum_number_c = $jlu_sum_number;
                                                        $jlu_sum_number_ave = 0;
                                                        $jlu_sum_number_ave2 = 0;
                                                    }
                                                    $temp4_jlu_sum2 = "<div class='title4 ta_r'>" . $jlu_sum_number_c . "</div><div class='title4 ta_r'>" . $jlu_sum_number_ave . "</div></div>";
                                                // 全期間通販粗利合計とその平均値のHTML作成
                                                    $temp4_jlu_sum3 = "";
                                                    if($jlu_sum_arari <> 0 && $jlu_sum_arari <> ""){
                                                        $jlu_sum_arari_c = number_format((int)$jlu_sum_arari);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($jlu_sum_arari_average <> "" && $jlu_sum_arari_average <> 0){$jlu_sum_arari_ave = number_format(floor((int)$jlu_sum_arari_average / ((int)$i -1)));} else {$jlu_sum_arari_ave = "---";}
                                                            if($jlu_sum_arari_average <> "" && $jlu_sum_arari_average <> 0){$jlu_sum_arari_ave2 = floor((int)$jlu_sum_arari_average / ((int)$i -1));} else {$jlu_sum_arari_ave2 = "---";}
                                                        } else {
                                                            $jlu_sum_arari_ave = number_format(floor((int)$jlu_sum_arari / $i));
                                                            $jlu_sum_arari_ave2 = floor((int)$jlu_sum_arari / $i);
                                                        }
                                                    } else {
                                                        $jlu_sum_arari_c = $jlu_sum_arari;
                                                        $jlu_sum_arari_ave = 0;
                                                        $jlu_sum_arari_ave2 = 0;
                                                    }
                                                    $temp4_jlu_sum3 = "<div class='title4 ta_r'>" . $jlu_sum_arari_c . "</div><div class='title4 ta_r'>" . $jlu_sum_arari_ave . "</div></div>";



                            /************************************************************************************************************************************************************************************************************* */
                                // バッグ・N用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */

                                            // DB検索（バッグ・N値）スタート
                                                $bgn_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS bgn_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS bgn_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS bgn_number"),
                                                        \DB::raw("SUM(ararikingaku) AS bgn_arari"),
                                                    ])
                                                    ->groupBy('bgn_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {

                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                    
                                                        })

                                                    // 条件（期間の指定）
                                                       ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where("shouhinkubunbunruimei","like","%ﾊﾞｯｸﾞ新品%")
                                                    // 条件（通販区分）
                                                        ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');
                            
                                                            // 条件（通販区分が自社）
                                                                if($out3_a == "ON"){
                                                                    $query->orWhere('tsuuhankubun',1);
                                                                }
                                                            // 条件（通販区分が楽天）
                                                                if($out3_b == "ON"){
                                                                    $query->orWhere('tsuuhankubun',2);
                                                                }
                                                            // 条件（通販区分がヤフー）
                                                                if($out3_c == "ON"){
                                                                    $query->orWhere('tsuuhankubun',3);
                                                                }
                                                            // 条件（通販区分が電話・雑誌）
                                                                if($out3_d == "ON"){
                                                                    $query->orWhere('tsuuhankubun',5);
                                                                }
                                                            // 条件（通販区分がYオークション）
                                                                if($out3_e == "ON"){
                                                                    $query->orWhere('tsuuhankubun',4);
                                                                }
                                                            // 条件（通販区分が修理品返送）
                                                                if($out3_f == "ON"){
                                                                    $query->orWhere('tsuuhankubun',9);
                                                                }
                            
                                                        })
                        
                                                    // 条件（免税）
                                                        ->where(function ($query) use ($out4_a,$out4_b) {
                                                                // 条件（免税区分が0:対象外）
                                                                    if($out4_a == "ON"){
                                                                        $query->orwhere("menzei","like","%対象外%");
                                                                    }
                                                                // 条件（免税区分が1:免税）
                                                                    if($out4_b == "ON"){
                                                                        $query->orwhere("menzei","like","%免税%");
                                                                    }
                                                        })
                                                    // 条件（扱い部門）
                                                        ->Where('bumonmei','Jewelry')
                                                        
                                                    // ソート順指定
                                                        ->orderBy('uriage', 'asc')
                                                        ->get();
                                            // クエリビルダスタート
                                                $i = 0;
                                                // 変数リセット
                                                    $bgn_sum_uriage = "";
                                                    $bgn_sum_number = "";
                                                    $bgn_sum_arari = "";
                                                foreach ($bgn_buys as $bgn_buy) {
                                                    // 各月名
                                                        $bgn_month[$i]= $bgn_buy->bgn_month;
                                                    // 各月通販売上
                                                        $bgn_uriage[$i]= $bgn_buy->bgn_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp4_bgn_manthly_data, $bgn_month[$i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp4_bgn_manthly_data = str_replace($bgn_month[$i], $bgn_uriage[$i], $temp4_bgn_manthly_data);
                                                                }
                                                    // 全期間通販売上合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $bgn_sum_uriage_average = (int)$bgn_sum_uriage;
                                                            } else {
                                                                $bgn_sum_uriage_average = (int)$bgn_sum_uriage + (int)$bgn_uriage[$i];
                                                            }

                                                        $bgn_sum_uriage = (int)$bgn_sum_uriage + (int)$bgn_uriage[$i];
                                                    // 各月通販点数
                                                        $bgn_number[$i]= $bgn_buy->bgn_number;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp4_bgn_manthly_data2, $bgn_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp4_bgn_manthly_data2 = str_replace($bgn_month[$i], $bgn_number[$i], $temp4_bgn_manthly_data2);
                                                            }

                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $bgn_sum_number_average = (int)$bgn_sum_number;
                                                            } else {
                                                                $bgn_sum_number_average = (int)$bgn_sum_number + (int)$bgn_number[$i];
                                                            }
                                                        $bgn_sum_number = (int)$bgn_sum_number + (int)$bgn_number[$i];

                                                    // 各月通販粗利
                                                        $bgn_arari[$i]= $bgn_buy->bgn_arari;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp4_bgn_manthly_data3, $bgn_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp4_bgn_manthly_data3 = str_replace($bgn_month[$i], $bgn_arari[$i], $temp4_bgn_manthly_data3);
                                                            }
                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $bgn_sum_arari_average = (int)$bgn_sum_arari;
                                                            } else {
                                                                $bgn_sum_arari_average = (int)$bgn_sum_arari + (int)$bgn_arari[$i];
                                                            }
                                                        $bgn_sum_arari = (int)$bgn_sum_arari + (int)$bgn_arari[$i];

                                                    $i++;
                                                }

                                                // 全期間通販売上合計とその平均値のHTML作成
                                                    $temp4_bgn_sum = "";
                                                    if($bgn_sum_uriage <> 0 && $bgn_sum_uriage <> ""){
                                                        $bgn_sum_uriage_c = number_format((int)$bgn_sum_uriage);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象                                                        
                                                        if($last_nodata_flag == "ON"){
                                                            if($bgn_sum_uriage_average <> "" && $bgn_sum_uriage_average <> 0){$bgn_sum_uriage_ave = number_format(floor((int)$bgn_sum_uriage_average / ((int)$i -1)));} else {$bgn_sum_uriage_ave = "---";}
                                                            if($bgn_sum_uriage_average <> "" && $bgn_sum_uriage_average <> 0){$bgn_sum_uriage_ave2 = floor((int)$bgn_sum_uriage_average / ((int)$i -1));} else {$bgn_sum_uriage_ave2 = "---";}
                                                        } else {
                                                            $bgn_sum_uriage_ave = number_format(floor((int)$bgn_sum_uriage / $i));
                                                            $bgn_sum_uriage_ave2 = floor((int)$bgn_sum_uriage / $i);
                                                        }
                                                    } else {
                                                        $bgn_sum_uriage_c = $bgn_sum_uriage;
                                                        $bgn_sum_uriage_ave = 0;
                                                        $bgn_sum_uriage_ave2 = 0;
                                                    }
                                                    $temp4_bgn_sum = "<div class='title4 ta_r'>" . $bgn_sum_uriage_c . "</div><div class='title4 ta_r'>" . $bgn_sum_uriage_ave . "</div></div>";
                                                // 全期間通販売上点数合計とその平均値のHTML作成
                                                    $temp4_bgn_sum2 = "";
                                                    if($bgn_sum_number <> 0 && $bgn_sum_number <> ""){
                                                        $bgn_sum_number_c = number_format((int)$bgn_sum_number);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($bgn_sum_number_average <> "" && $bgn_sum_number_average <> 0){$bgn_sum_number_ave = number_format(floor((int)$bgn_sum_number_average / ((int)$i -1)));} else {$bgn_sum_number_ave = "---";}
                                                            if($bgn_sum_number_average <> "" && $bgn_sum_number_average <> 0){$bgn_sum_number_ave2 = floor((int)$bgn_sum_number_average / ((int)$i -1));} else {$bgn_sum_number_ave2 = "---";}
                                                        } else {
                                                            $bgn_sum_number_ave = number_format(floor((int)$bgn_sum_number / $i));
                                                            $bgn_sum_number_ave2 = floor((int)$bgn_sum_number / $i);
                                                        }
                                                    } else {
                                                        $bgn_sum_number_c = $bgn_sum_number;
                                                        $bgn_sum_number_ave = 0;
                                                        $bgn_sum_number_ave2 = 0;
                                                    }
                                                    $temp4_bgn_sum2 = "<div class='title4 ta_r'>" . $bgn_sum_number_c . "</div><div class='title4 ta_r'>" . $bgn_sum_number_ave . "</div></div>";
                                                // 全期間通販粗利合計とその平均値のHTML作成
                                                    $temp4_bgn_sum3 = "";
                                                    if($bgn_sum_arari <> 0 && $bgn_sum_arari <> ""){
                                                        $bgn_sum_arari_c = number_format((int)$bgn_sum_arari);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($bgn_sum_arari_average <> "" && $bgn_sum_arari_average <> 0){$bgn_sum_arari_ave = number_format(floor((int)$bgn_sum_arari_average / ((int)$i -1)));} else {$bgn_sum_arari_ave = "---";}
                                                            if($bgn_sum_arari_average <> "" && $bgn_sum_arari_average <> 0){$bgn_sum_arari_ave2 = floor((int)$bgn_sum_arari_average / ((int)$i -1));} else {$bgn_sum_arari_ave2 = "---";}
                                                        } else {
                                                            $bgn_sum_arari_ave = number_format(floor((int)$bgn_sum_arari / $i));
                                                            $bgn_sum_arari_ave2 = floor((int)$bgn_sum_arari / $i);
                                                        }
                                                    } else {
                                                        $bgn_sum_arari_c = $bgn_sum_arari;
                                                        $bgn_sum_arari_ave = 0;
                                                        $bgn_sum_arari_ave2 = 0;
                                                    }
                                                    $temp4_bgn_sum3 = "<div class='title4 ta_r'>" . $bgn_sum_arari_c . "</div><div class='title4 ta_r'>" . $bgn_sum_arari_ave . "</div></div>";


                            /************************************************************************************************************************************************************************************************************* */
                                // バッグ・U用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */

                                            // DB検索（バッグ・U値）スタート
                                                $bgu_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS bgu_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS bgu_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS bgu_number"),
                                                        \DB::raw("SUM(ararikingaku) AS bgu_arari"),
                                                    ])
                                                    ->groupBy('bgu_month')
                                                    // 条件（売上部門の指定）
                                                        ->where(function ($query) use ($out1_a,$out1_b,$out1_c,$out1_d) {

                                                            // 条件（売上部門が店舗）
                                                                if($out1_a == "ON"){
                                                                    $query->orWhere('baikyakukubun', 1);
                                                                }
                                                            // 条件（売上部門が通販）
                                                                if($out1_b == "ON"){
                                                                    $query->orWhere('baikyakukubun',2);
                                                                }
                                                            // 条件（売上部門が卸）
                                                                if($out1_c == "ON"){
                                                                    $query->orWhere('baikyakukubun',3);
                                                                }
                                                            // 条件（売上部門が「店舗」「通販」「卸」以外（おそらく入力間違い分））
                                                                if($out1_d == "ON"){
                                                                    $query->orWhere([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2], ['baikyakukubun', '<>', 3]]);
                                                                }
                                                    
                                                        })

                                                    // 条件（期間の指定）
                                                       ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                        
                                                    // 条件（分類名）
                                                        ->where("shouhinkubunbunruimei","like","%ﾊﾞｯｸﾞ中古%")
                                                    // 条件（通販区分）
                                                        ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                            $query->orWhere('tsuuhankubun','');
                            
                                                            // 条件（通販区分が自社）
                                                                if($out3_a == "ON"){
                                                                    $query->orWhere('tsuuhankubun',1);
                                                                }
                                                            // 条件（通販区分が楽天）
                                                                if($out3_b == "ON"){
                                                                    $query->orWhere('tsuuhankubun',2);
                                                                }
                                                            // 条件（通販区分がヤフー）
                                                                if($out3_c == "ON"){
                                                                    $query->orWhere('tsuuhankubun',3);
                                                                }
                                                            // 条件（通販区分が電話・雑誌）
                                                                if($out3_d == "ON"){
                                                                    $query->orWhere('tsuuhankubun',5);
                                                                }
                                                            // 条件（通販区分がYオークション）
                                                                if($out3_e == "ON"){
                                                                    $query->orWhere('tsuuhankubun',4);
                                                                }
                                                            // 条件（通販区分が修理品返送）
                                                                if($out3_f == "ON"){
                                                                    $query->orWhere('tsuuhankubun',9);
                                                                }
                            
                                                        })
                        
                                                    // 条件（免税）
                                                        ->where(function ($query) use ($out4_a,$out4_b) {
                                                                // 条件（免税区分が0:対象外）
                                                                    if($out4_a == "ON"){
                                                                        $query->orwhere("menzei","like","%対象外%");
                                                                    }
                                                                // 条件（免税区分が1:免税）
                                                                    if($out4_b == "ON"){
                                                                        $query->orwhere("menzei","like","%免税%");
                                                                    }
                                                        })
                                                    // 条件（扱い部門）
                                                        ->Where('bumonmei','Jewelry')
                                                        
                                                    // ソート順指定
                                                        ->orderBy('uriage', 'asc')
                                                        ->get();
                                            // クエリビルダスタート
                                                $i = 0;
                                                // 変数リセット
                                                    $bgu_sum_uriage = "";
                                                    $bgu_sum_number = "";
                                                    $bgu_sum_arari = "";
                                                foreach ($bgu_buys as $bgu_buy) {
                                                    // 各月名
                                                        $bgu_month[$i]= $bgu_buy->bgu_month;
                                                    // 各月通販売上
                                                        $bgu_uriage[$i]= $bgu_buy->bgu_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp4_bgu_manthly_data, $bgu_month[$i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp4_bgu_manthly_data = str_replace($bgu_month[$i], $bgu_uriage[$i], $temp4_bgu_manthly_data);
                                                                }
                                                    // 全期間通販売上合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $bgu_sum_uriage_average = (int)$bgu_sum_uriage;
                                                            } else {
                                                                $bgu_sum_uriage_average = (int)$bgu_sum_uriage + (int)$bgu_uriage[$i];
                                                            }

                                                        $bgu_sum_uriage = (int)$bgu_sum_uriage + (int)$bgu_uriage[$i];
                                                    // 各月通販点数
                                                        $bgu_number[$i]= $bgu_buy->bgu_number;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp4_bgu_manthly_data2, $bgu_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp4_bgu_manthly_data2 = str_replace($bgu_month[$i], $bgu_number[$i], $temp4_bgu_manthly_data2);
                                                            }

                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $bgu_sum_number_average = (int)$bgu_sum_number;
                                                            } else {
                                                                $bgu_sum_number_average = (int)$bgu_sum_number + (int)$bgu_number[$i];
                                                            }
                                                        $bgu_sum_number = (int)$bgu_sum_number + (int)$bgu_number[$i];

                                                    // 各月通販粗利
                                                        $bgu_arari[$i]= $bgu_buy->bgu_arari;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp4_bgu_manthly_data3, $bgu_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp4_bgu_manthly_data3 = str_replace($bgu_month[$i], $bgu_arari[$i], $temp4_bgu_manthly_data3);
                                                            }
                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $bgu_sum_arari_average = (int)$bgu_sum_arari;
                                                            } else {
                                                                $bgu_sum_arari_average = (int)$bgu_sum_arari + (int)$bgu_arari[$i];
                                                            }
                                                        $bgu_sum_arari = (int)$bgu_sum_arari + (int)$bgu_arari[$i];

                                                    $i++;
                                                }

                                                // 全期間通販売上合計とその平均値のHTML作成
                                                    $temp4_bgu_sum = "";
                                                    if($bgu_sum_uriage <> 0 && $bgu_sum_uriage <> ""){
                                                        $bgu_sum_uriage_c = number_format((int)$bgu_sum_uriage);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象                                                        
                                                        if($last_nodata_flag == "ON"){
                                                            if($bgu_sum_uriage_average <> "" && $bgu_sum_uriage_average <> 0){$bgu_sum_uriage_ave = number_format(floor((int)$bgu_sum_uriage_average / ((int)$i -1)));} else {$bgu_sum_uriage_ave = "---";}
                                                            if($bgu_sum_uriage_average <> "" && $bgu_sum_uriage_average <> 0){$bgu_sum_uriage_ave2 = floor((int)$bgu_sum_uriage_average / ((int)$i -1));} else {$bgu_sum_uriage_ave2 = "---";}
                                                        } else {
                                                            $bgu_sum_uriage_ave = number_format(floor((int)$bgu_sum_uriage / $i));
                                                            $bgu_sum_uriage_ave2 = floor((int)$bgu_sum_uriage / $i);
                                                        }
                                                    } else {
                                                        $bgu_sum_uriage_c = $bgu_sum_uriage;
                                                        $bgu_sum_uriage_ave = 0;
                                                        $bgu_sum_uriage_ave2 = 0;
                                                    }
                                                    $temp4_bgu_sum = "<div class='title4 ta_r'>" . $bgu_sum_uriage_c . "</div><div class='title4 ta_r'>" . $bgu_sum_uriage_ave . "</div></div>";
                                                // 全期間通販売上点数合計とその平均値のHTML作成
                                                    $temp4_bgu_sum2 = "";
                                                    if($bgu_sum_number <> 0 && $bgu_sum_number <> ""){
                                                        $bgu_sum_number_c = number_format((int)$bgu_sum_number);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($bgu_sum_number_average <> "" && $bgu_sum_number_average <> 0){$bgu_sum_number_ave = number_format(floor((int)$bgu_sum_number_average / ((int)$i -1)));} else {$bgu_sum_number_ave = "---";}
                                                            if($bgu_sum_number_average <> "" && $bgu_sum_number_average <> 0){$bgu_sum_number_ave2 = floor((int)$bgu_sum_number_average / ((int)$i -1));} else {$bgu_sum_number_ave2 = "---";}
                                                        } else {
                                                            $bgu_sum_number_ave = number_format(floor((int)$bgu_sum_number / $i));
                                                            $bgu_sum_number_ave2 = floor((int)$bgu_sum_number / $i);
                                                        }
                                                    } else {
                                                        $bgu_sum_number_c = $bgu_sum_number;
                                                        $bgu_sum_number_ave = 0;
                                                        $bgu_sum_number_ave2 = 0;
                                                    }
                                                    $temp4_bgu_sum2 = "<div class='title4 ta_r'>" . $bgu_sum_number_c . "</div><div class='title4 ta_r'>" . $bgu_sum_number_ave . "</div></div>";
                                                // 全期間通販粗利合計とその平均値のHTML作成
                                                    $temp4_bgu_sum3 = "";
                                                    if($bgu_sum_arari <> 0 && $bgu_sum_arari <> ""){
                                                        $bgu_sum_arari_c = number_format((int)$bgu_sum_arari);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        if($last_nodata_flag == "ON"){
                                                            if($bgu_sum_arari_average <> "" && $bgu_sum_arari_average <> 0){$bgu_sum_arari_ave = number_format(floor((int)$bgu_sum_arari_average / ((int)$i -1)));} else {$bgu_sum_arari_ave = "---";}
                                                            if($bgu_sum_arari_average <> "" && $bgu_sum_arari_average <> 0){$bgu_sum_arari_ave2 = floor((int)$bgu_sum_arari_average / ((int)$i -1));} else {$bgu_sum_arari_ave2 = "---";}
                                                        } else {
                                                            $bgu_sum_arari_ave = number_format(floor((int)$bgu_sum_arari / $i));
                                                            $bgu_sum_arari_ave2 = floor((int)$bgu_sum_arari / $i);
                                                        }
                                                    } else {
                                                        $bgu_sum_arari_c = $bgu_sum_arari;
                                                        $bgu_sum_arari_ave = 0;
                                                        $bgu_sum_arari_ave2 = 0;
                                                    }
                                                    $temp4_bgu_sum3 = "<div class='title4 ta_r'>" . $bgu_sum_arari_c . "</div><div class='title4 ta_r'>" . $bgu_sum_arari_ave . "</div></div>";




                            /************************************************************************************************************************************************************************************************************* */
                                // 全件用
                            /************************************************************************************************************************************************************************************************************* */


                                    // 各月のタイトル表示用HTMLを作成
                                        $temp4_title2 = "";
                                        $temp4_title3 = "";
                                        $temp4_title4 = "";
                                        $temp4_title5 = "";
                                        foreach($manth_now_array as $val){
                                                // 表示用
                                                $temp4_title2 .= "<div class='title2 ta_c'>" . $val . "</div>";
                                                $temp4_title3 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                                $temp4_title4 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                                $temp4_title5 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                            }
                                
                                            $temp4_title = "<div class='wid100 ul2'><div class='title5 ta_c'>" . $between_start_view. "～<br>" .$between_end_view . "</div>" .$temp4_title2 ."<div class='title6 ta_c'>累計</div><!--<div class='title6 ta_c'>過去比</div>--><div class='title6 ta_c'>平均</div></div>";
                                            $temp4_title3 = "<div class='wid100 ul2'><div class='title7 ta_c'>" . $between_start_view. "～<br>" .$between_end_view . "</div>" .$temp4_title3 ."<div class='title7 ta_c'>平均</div></div>";
                                            $temp4_title4 = "<div class='wid100 ul2 bg_green'><div class='title7 ta_c'>" . $between_start_view. "～<br>" .$between_end_view . "</div>" .$temp4_title4 ."<div class='title7 ta_c'>平均</div></div>";
                                            $temp4_title5 = "<div class='wid100 ul2 bg_yellow'><div class='title7 ta_c'>" . $between_start_view. "～<br>" .$between_end_view . "</div>" .$temp4_title5 ."<div class='title7 ta_c'>平均</div></div>";
                                        
                                        
                                    // 全期間の全部門売上合計用変数リセット
                                        $all_sum_uriage_all = 0;
                                        $all_sum_number_all = 0;
                                        $all_sum_arari_all = 0;
                                        for($all_i = 0; $all_i < $i; $all_i++){
                                            // 各月の全部門売上合計用変数リセット
                                                $all_month_uriage = 0;
                                                $all_month_number= 0;
                                                $all_month_arari= 0;
                                            // 各月の全部門売上合計をHTMLへ
                                                    if(isset($jn_uriage[$all_i])){$all_month_uriage = $all_month_uriage + (int)$jn_uriage[$all_i]; }
                                                    if(isset($jn_number[$all_i])){$all_month_number = $all_month_number + (int)$jn_number[$all_i]; }
                                                    if(isset($jn_arari[$all_i])){$all_month_arari = $all_month_arari+ (int)$jn_arari[$all_i]; }
                                                    if(isset($ju_uriage[$all_i])){$all_month_uriage = $all_month_uriage + (int)$ju_uriage[$all_i]; }
                                                    if(isset($ju_number[$all_i])){$all_month_number = $all_month_number + (int)$ju_number[$all_i]; }
                                                    if(isset($ju_arari[$all_i])){$all_month_arari = $all_month_arari+ (int)$ju_arari[$all_i]; }
                                                    if(isset($ja_uriage[$all_i])){$all_month_uriage = $all_month_uriage + (int)$ja_uriage[$all_i]; }
                                                    if(isset($ja_number[$all_i])){$all_month_number = $all_month_number + (int)$ja_number[$all_i]; }
                                                    if(isset($ja_arari[$all_i])){$all_month_arari = $all_month_arari+ (int)$ja_arari[$all_i]; }
                                                    if(isset($bn_uriage[$all_i])){$all_month_uriage = $all_month_uriage + (int)$bn_uriage[$all_i]; }
                                                    if(isset($bn_number[$all_i])){$all_month_number = $all_month_number + (int)$bn_number[$all_i]; }
                                                    if(isset($bn_arari[$all_i])){$all_month_arari = $all_month_arari + (int)$bn_arari[$all_i]; }
                                                    if(isset($bu_uriage[$all_i])){$all_month_uriage = $all_month_uriage + (int)$bu_uriage[$all_i]; }
                                                    if(isset($bu_number[$all_i])){$all_month_number = $all_month_number + (int)$bu_number[$all_i]; }
                                                    if(isset($bu_arari[$all_i])){$all_month_arari = $all_month_arari + (int)$bu_arari[$all_i]; }
                                                    if(isset($ba_uriage[$all_i])){$all_month_uriage = $all_month_uriage + (int)$ba_uriage[$all_i]; }
                                                    if(isset($ba_number[$all_i])){$all_month_number = $all_month_number + (int)$ba_number[$all_i]; }
                                                    if(isset($ba_arari[$all_i])){$all_month_arari = $all_month_arari + (int)$ba_arari[$all_i]; }
                                                    if(isset($jln_uriage[$all_i])){ $all_month_uriage = $all_month_uriage + (int)$jln_uriage[$all_i]; }
                                                    if(isset($jln_number[$all_i])){ $all_month_number = $all_month_number + (int)$jln_number[$all_i]; }
                                                    if(isset($jln_arari[$all_i])){ $all_month_arari = $all_month_arari + (int)$jln_arari[$all_i]; }
                                                    if(isset($jlu_uriage[$all_i])){ $all_month_uriage = $all_month_uriage + (int)$jlu_uriage[$all_i]; }
                                                    if(isset($jlu_number[$all_i])){ $all_month_number = $all_month_number + (int)$jlu_number[$all_i]; }
                                                    if(isset($jlu_arari[$all_i])){ $all_month_arari = $all_month_arari + (int)$jlu_arari[$all_i]; }
                                                    if(isset($bgn_uriage[$all_i])){ $all_month_uriage = $all_month_uriage + (int)$bgn_uriage[$all_i]; }
                                                    if(isset($bgn_number[$all_i])){ $all_month_number = $all_month_number + (int)$bgn_number[$all_i]; }
                                                    if(isset($bgn_arari[$all_i])){ $all_month_arari = $all_month_arari + (int)$bgn_arari[$all_i]; }
                                                    if(isset($bgu_uriage[$all_i])){ $all_month_uriage = $all_month_uriage + (int)$bgu_uriage[$all_i]; }
                                                    if(isset($bgu_number[$all_i])){ $all_month_number = $all_month_number + (int)$bgu_number[$all_i]; }
                                                    if(isset($bgu_arari[$all_i])){ $all_month_arari = $all_month_arari + (int)$bgu_arari[$all_i]; }

                                            // 全期間の全部門売上合計
                                                $all_sum_uriage_all = (int)$all_sum_uriage_all + (int)$all_month_uriage;
                                                $all_sum_number_all = (int)$all_sum_number_all + (int)$all_month_number;
                                                $all_sum_arari_all = (int)$all_sum_arari_all + (int)$all_month_arari;
                                            
                                        }



									// 【進捗率の取得】
                                        

											// 検索スタート日からデータが格納されている最終日までの日数
											    $search_start = strtotime($start_now);
											    $data_end = strtotime($last_day);
											    $data_in_days = ($data_end - $search_start) / (60 * 60 * 24);

											// 検索期間
											    $search_start = strtotime($start_now);
											    $search_end = strtotime($end_now);
											    $search_days = ($search_end - $search_start) / (60 * 60 * 24);

											// 検索期間・着地予測（期間合計 / データ格納期間 * 検索期間）
											    ($jn_sum_uriage <> 0 && $jn_sum_uriage <> "") ? $jn_term_progress = $jn_sum_uriage / $data_in_days * $search_days : $jn_term_progress = "---";
											    ($jn_sum_number <> 0 && $jn_sum_number <> "") ? $jn_term_progress_n = $jn_sum_number / $data_in_days * $search_days : $jn_term_progress_n = "---";
											    ($jn_sum_arari <> 0 && $jn_sum_arari <> "") ? $jn_term_progress_a = $jn_sum_arari / $data_in_days * $search_days : $jn_term_progress_a = "---";
											    ($ju_sum_uriage <> 0 && $ju_sum_uriage <> "") ? $ju_term_progress = $ju_sum_uriage / $data_in_days * $search_days : $ju_term_progress = "---";
											    ($ju_sum_number <> 0 && $ju_sum_number <> "") ? $ju_term_progress_n = $ju_sum_number / $data_in_days * $search_days : $ju_term_progress_n = "---";
											    ($ju_sum_arari <> 0 && $ju_sum_arari <> "") ? $ju_term_progress_a = $ju_sum_arari / $data_in_days * $search_days : $ju_term_progress_a = "---";
											    ($ja_sum_uriage <> 0 && $ja_sum_uriage <> "") ? $ja_term_progress = $ja_sum_uriage / $data_in_days * $search_days : $ja_term_progress = "---";
											    ($ja_sum_number <> 0 && $ja_sum_number <> "") ? $ja_term_progress_n = $ja_sum_number / $data_in_days * $search_days : $ja_term_progress_n = "---";
											    ($ja_sum_arari <> 0 && $ja_sum_arari <> "") ? $ja_term_progress_a = $ja_sum_arari / $data_in_days * $search_days : $ja_term_progress_a = "---";
											    ($bn_sum_uriage <> 0 && $bn_sum_uriage <> "") ? $bn_term_progress = $bn_sum_uriage / $data_in_days * $search_days : $bn_term_progress = "---";
											    ($bn_sum_number <> 0 && $bn_sum_number <> "") ? $bn_term_progress_n = $bn_sum_number / $data_in_days * $search_days : $bn_term_progress_n = "---";
											    ($bn_sum_arari <> 0 && $bn_sum_arari <> "") ? $bn_term_progress_a = $bn_sum_arari / $data_in_days * $search_days : $bn_term_progress_a = "---";
											    ($bu_sum_uriage <> 0 && $bu_sum_uriage <> "") ? $bu_term_progress = $bu_sum_uriage / $data_in_days * $search_days : $bu_term_progress = "---";
											    ($bu_sum_number <> 0 && $bu_sum_number <> "") ? $bu_term_progress_n = $bu_sum_number / $data_in_days * $search_days : $bu_term_progress_n = "---";
											    ($bu_sum_arari <> 0 && $bu_sum_arari <> "") ? $bu_term_progress_a = $bu_sum_arari / $data_in_days * $search_days : $bu_term_progress_a = "---";
											    ($ba_sum_uriage <> 0 && $ba_sum_uriage <> "") ? $ba_term_progress = $ba_sum_uriage / $data_in_days * $search_days : $ba_term_progress = "---";
											    ($ba_sum_number <> 0 && $ba_sum_number <> "") ? $ba_term_progress_n = $ba_sum_number / $data_in_days * $search_days : $ba_term_progress_n = "---";
											    ($ba_sum_arari <> 0 && $ba_sum_arari <> "") ? $ba_term_progress_a = $ba_sum_arari / $data_in_days * $search_days : $ba_term_progress_a = "---";
											    ($jln_sum_uriage <> 0 && $jln_sum_uriage <> "") ? $jln_term_progress = $jln_sum_uriage / $data_in_days * $search_days : $jln_term_progress = "---";
											    ($jln_sum_number <> 0 && $jln_sum_number <> "") ? $jln_term_progress_n = $jln_sum_number / $data_in_days * $search_days : $jln_term_progress_n = "---";
											    ($jln_sum_arari <> 0 && $jln_sum_arari <> "") ? $jln_term_progress_a = $jln_sum_arari / $data_in_days * $search_days : $jln_term_progress_a = "---";
											    ($jlu_sum_uriage <> 0 && $jlu_sum_uriage <> "") ? $jlu_term_progress = $jlu_sum_uriage / $data_in_days * $search_days : $jlu_term_progress = "---";
											    ($jlu_sum_number <> 0 && $jlu_sum_number <> "") ? $jlu_term_progress_n = $jlu_sum_number / $data_in_days * $search_days : $jlu_term_progress_n = "---";
											    ($jlu_sum_arari <> 0 && $jlu_sum_arari <> "") ? $jlu_term_progress_a = $jlu_sum_arari / $data_in_days * $search_days : $jlu_term_progress_a = "---";
											    ($bgn_sum_uriage <> 0 && $bgn_sum_uriage <> "") ? $bgn_term_progress = $bgn_sum_uriage / $data_in_days * $search_days : $bgn_term_progress = "---";
											    ($bgn_sum_number <> 0 && $bgn_sum_number <> "") ? $bgn_term_progress_n = $bgn_sum_number / $data_in_days * $search_days : $bgn_term_progress_n = "---";
											    ($bgn_sum_arari <> 0 && $bgn_sum_arari <> "") ? $bgn_term_progress_a = $bgn_sum_arari / $data_in_days * $search_days : $bgn_term_progress_a = "---";
											    ($bgu_sum_uriage <> 0 && $bgu_sum_uriage <> "") ? $bgu_term_progress = $bgu_sum_uriage / $data_in_days * $search_days : $bgu_term_progress = "---";
											    ($bgu_sum_number <> 0 && $bgu_sum_number <> "") ? $bgu_term_progress_n = $bgu_sum_number / $data_in_days * $search_days : $bgu_term_progress_n = "---";
											    ($bgu_sum_arari <> 0 && $bgu_sum_arari <> "") ? $bgu_term_progress_a = $bgu_sum_arari / $data_in_days * $search_days : $bgu_term_progress_a = "---";


											// 合計
											    $all_term_progress = (int)$jn_term_progress + (int)$ju_term_progress + (int)$ja_term_progress + (int)$bn_term_progress + (int)$bu_term_progress + (int)$ba_term_progress + (int)$jln_term_progress + (int)$jlu_term_progress + (int)$bgn_term_progress + (int)$bgu_term_progress;
											    $all_term_progress_n = (int)$jn_term_progress_n + (int)$ju_term_progress_n + (int)$ja_term_progress_n + (int)$bn_term_progress_n + (int)$bu_term_progress_n + (int)$ba_term_progress_n + (int)$jln_term_progress_n + (int)$jlu_term_progress_n + (int)$bgn_term_progress_n + (int)$bgu_term_progress_n;
											    $all_term_progress_a = (int)$jn_term_progress_a + (int)$ju_term_progress_a + (int)$ja_term_progress_a + (int)$bn_term_progress_a + (int)$bu_term_progress_a + (int)$ba_term_progress_a + (int)$jln_term_progress_a + (int)$jlu_term_progress_a + (int)$bgn_term_progress_a + (int)$bgu_term_progress_a;
											// 検索期間・過去との着地予測比（検索期間・着地予測 / 過去合計）
											    ($jn_term_progress <> 0 && $jn_term_progress <> "" && $past_jn_sum_uriage <> 0 && $past_jn_sum_uriage <> "") ? $jn_term_progress2 = number_format((floor(((int)$jn_term_progress / (int)$past_jn_sum_uriage) * 100 * 10)) / 10,1) : $jn_term_progress2 = 0;
											    ($jn_term_progress_n <> 0 && $jn_term_progress_n <> "" && $past_jn_sum_number <> 0 && $past_jn_sum_number <> "") ? $jn_term_progress2_n = number_format((floor(((int)$jn_term_progress_n / (int)$past_jn_sum_number) * 100 * 10)) / 10,1) : $jn_term_progress2_n = 0;
											    ($jn_term_progress_a <> 0 && $jn_term_progress_a <> "" && $past_jn_sum_arari <> 0 && $past_jn_sum_arari <> "") ? $jn_term_progress2_a = number_format((floor(((int)$jn_term_progress_a / (int)$past_jn_sum_arari) * 100 * 10)) / 10,1) : $jn_term_progress2_a = 0;
											    ($ju_term_progress <> 0 && $ju_term_progress <> "" && $past_ju_sum_uriage <> 0 && $past_ju_sum_uriage <> "") ? $ju_term_progress2 = number_format((floor(((int)$ju_term_progress / (int)$past_ju_sum_uriage) * 100 * 10)) / 10,1) : $ju_term_progress2 = 0;
											    ($ju_term_progress_n <> 0 && $ju_term_progress_n <> "" && $past_ju_sum_number <> 0 && $past_ju_sum_number <> "") ? $ju_term_progress2_n = number_format((floor(((int)$ju_term_progress_n / (int)$past_ju_sum_number) * 100 * 10)) / 10,1) : $ju_term_progress2_n = 0;
											    ($ju_term_progress_a <> 0 && $ju_term_progress_a <> "" && $past_ju_sum_arari <> 0 && $past_ju_sum_arari <> "") ? $ju_term_progress2_a = number_format((floor(((int)$ju_term_progress_a / (int)$past_ju_sum_arari) * 100 * 10)) / 10,1) : $ju_term_progress2_a = 0;
											    ($ja_term_progress <> 0 && $ja_term_progress <> "" && $past_ja_sum_uriage <> 0 && $past_ja_sum_uriage <> "") ? $ja_term_progress2 = number_format((floor(((int)$ja_term_progress / (int)$past_ja_sum_uriage) * 100 * 10)) / 10,1) : $ja_term_progress2 = 0;
											    ($ja_term_progress_n <> 0 && $ja_term_progress_n <> "" && $past_ja_sum_number <> 0 && $past_ja_sum_number <> "") ? $ja_term_progress2_n = number_format((floor(((int)$ja_term_progress_n / (int)$past_ja_sum_number) * 100 * 10)) / 10,1) : $ja_term_progress2_n = 0;
											    ($ja_term_progress_a <> 0 && $ja_term_progress_a <> "" && $past_ja_sum_arari <> 0 && $past_ja_sum_arari <> "") ? $ja_term_progress2_a = number_format((floor(((int)$ja_term_progress_a / (int)$past_ja_sum_arari) * 100 * 10)) / 10,1) : $ja_term_progress2_a = 0;
											    ($bn_term_progress <> 0 && $bn_term_progress <> "" && $past_bn_sum_uriage <> 0 && $past_bn_sum_uriage <> "") ? $bn_term_progress2 = number_format((floor(((int)$bn_term_progress / (int)$past_bn_sum_uriage) * 100 * 10)) / 10,1) : $bn_term_progress2 = 0;
											    ($bn_term_progress_n <> 0 && $bn_term_progress_n <> "" && $past_bn_sum_number <> 0 && $past_bn_sum_number <> "") ? $bn_term_progress2_n = number_format((floor(((int)$bn_term_progress_n / (int)$past_bn_sum_number) * 100 * 10)) / 10,1) : $bn_term_progress2_n = 0;
											    ($bn_term_progress_a <> 0 && $bn_term_progress_a <> "" && $past_bn_sum_arari <> 0 && $past_bn_sum_arari <> "") ? $bn_term_progress2_a = number_format((floor(((int)$bn_term_progress_a / (int)$past_bn_sum_arari) * 100 * 10)) / 10,1) : $bn_term_progress2_a = 0;
											    ($bu_term_progress <> 0 && $bu_term_progress <> "" && $past_bu_sum_uriage <> 0 && $past_bu_sum_uriage <> "") ? $bu_term_progress2 = number_format((floor(((int)$bu_term_progress / (int)$past_bu_sum_uriage) * 100 * 10)) / 10,1) : $bu_term_progress2 = 0;
											    ($bu_term_progress_n <> 0 && $bu_term_progress_n <> "" && $past_bu_sum_number <> 0 && $past_bu_sum_number <> "") ? $bu_term_progress2_n = number_format((floor(((int)$bu_term_progress_n / (int)$past_bu_sum_number) * 100 * 10)) / 10,1) : $bu_term_progress2_n = 0;
											    ($bu_term_progress_a <> 0 && $bu_term_progress_a <> "" && $past_bu_sum_arari <> 0 && $past_bu_sum_arari <> "") ? $bu_term_progress2_a = number_format((floor(((int)$bu_term_progress_a / (int)$past_bu_sum_arari) * 100 * 10)) / 10,1) : $bu_term_progress2_a = 0;
											    ($ba_term_progress <> 0 && $ba_term_progress <> "" && $past_ba_sum_uriage <> 0 && $past_ba_sum_uriage <> "") ? $ba_term_progress2 = number_format((floor(((int)$ba_term_progress / (int)$past_ba_sum_uriage) * 100 * 10)) / 10,1) : $ba_term_progress2 = 0;
											    ($ba_term_progress_n <> 0 && $ba_term_progress_n <> "" && $past_ba_sum_number <> 0 && $past_ba_sum_number <> "") ? $ba_term_progress2_n = number_format((floor(((int)$ba_term_progress_n / (int)$past_ba_sum_number) * 100 * 10)) / 10,1) : $ba_term_progress2_n = 0;
											    ($ba_term_progress_a <> 0 && $ba_term_progress_a <> "" && $past_ba_sum_arari <> 0 && $past_ba_sum_arari <> "") ? $ba_term_progress2_a = number_format((floor(((int)$ba_term_progress_a / (int)$past_ba_sum_arari) * 100 * 10)) / 10,1) : $ba_term_progress2_a = 0;
											    
											    
											    if($jln_term_progress <> "" && $jln_term_progress <> 0 && $past_jln_sum_uriage <> "" && $past_jln_sum_uriage <> 0){
											        $jln_term_progress2 = number_format((floor(((int)$jln_term_progress / (int)$past_jln_sum_uriage) * 100 * 10)) / 10,1);
											    } else {
											        $jln_term_progress2 = "---";
											    }
											    if($jln_term_progress_n <> "" && $jln_term_progress_n <> 0 && $past_jln_sum_number <> "" && $past_jln_sum_number <> 0){
											        $jln_term_progress2_n = number_format((floor(((int)$jln_term_progress_n / (int)$past_jln_sum_number) * 100 * 10)) / 10,1);
											    } else {
											        $jln_term_progress2_n = "---"; 
											    }
											    if($jln_term_progress_a <> "" && $jln_term_progress_a <> 0 && $past_jln_sum_arari <> "" && $past_jln_sum_arari <> 0){
											        $jln_term_progress2_a = number_format((floor(((int)$jln_term_progress_a / (int)$past_jln_sum_arari) * 100 * 10)) / 10,1);
											    } else {
											        $jln_term_progress2_a = "---"; 
											    }
											    if($jlu_term_progress <> "" && $jlu_term_progress <> 0 && $past_jlu_sum_uriage <> "" && $past_jlu_sum_uriage <> 0){
											        $jlu_term_progress2 = number_format((floor(((int)$jlu_term_progress / (int)$past_jlu_sum_uriage) * 100 * 10)) / 10,1);
											    } else {
											        $jlu_term_progress2 = "---";
											    }
											    if($jlu_term_progress_n <> "" && $jlu_term_progress_n <> 0 && $past_jlu_sum_number <> "" && $past_jlu_sum_number <> 0){
											        $jlu_term_progress2_n = number_format((floor(((int)$jlu_term_progress_n / (int)$past_jlu_sum_number) * 100 * 10)) / 10,1);
											    } else {
											        $jlu_term_progress2_n = "---"; 
											    }
											    if($jlu_term_progress_a <> "" && $jlu_term_progress_a <> 0 && $past_jlu_sum_arari <> "" && $past_jlu_sum_arari <> 0){
											        $jlu_term_progress2_a = number_format((floor(((int)$jlu_term_progress_a / (int)$past_jlu_sum_arari) * 100 * 10)) / 10,1);
											    } else {
											        $jlu_term_progress2_a = "---"; 
											    }
											    if($bgn_term_progress <> "" && $bgn_term_progress <> 0 && $past_bgn_sum_uriage <> "" && $past_bgn_sum_uriage <> 0){
											        $bgn_term_progress2 = number_format((floor(((int)$bgn_term_progress / (int)$past_bgn_sum_uriage) * 100 * 10)) / 10,1);
											    } else {
											        $bgn_term_progress2 = "---";
											    }
											    if($bgn_term_progress_n <> "" && $bgn_term_progress_n <> 0 && $past_bgn_sum_number <> "" && $past_bgn_sum_number <> 0){
											        $bgn_term_progress2_n = number_format((floor(((int)$bgn_term_progress_n / (int)$past_bgn_sum_number) * 100 * 10)) / 10,1);
											    } else {
											        $bgn_term_progress2_n = "---"; 
											    }
											    if($bgn_term_progress_a <> "" && $bgn_term_progress_a <> 0 && $past_bgn_sum_arari <> "" && $past_bgn_sum_arari <> 0){
											        $bgn_term_progress2_a = number_format((floor(((int)$bgn_term_progress_a / (int)$past_bgn_sum_arari) * 100 * 10)) / 10,1);
											    } else {
											        $bgn_term_progress2_a = "---"; 
											    }

											    if($bgu_term_progress <> "" && $bgu_term_progress <> 0 && $past_bgu_sum_uriage <> "" && $past_bgu_sum_uriage <> 0){
											        $bgu_term_progress2 = number_format((floor(((int)$bgu_term_progress / (int)$past_bgu_sum_uriage) * 100 * 10)) / 10,1);
											    } else {
											        $bgu_term_progress2 = "---";
											    }
											    if($bgu_term_progress_n <> "" && $bgu_term_progress_n <> 0 && $past_bgu_sum_number <> "" && $past_bgu_sum_number <> 0){
											        $bgu_term_progress2_n = number_format((floor(((int)$bgu_term_progress_n / (int)$past_bgu_sum_number) * 100 * 10)) / 10,1);
											    } else {
											        $bgu_term_progress2_n = "---"; 
											    }
											    if($bgu_term_progress_a <> "" && $bgu_term_progress_a <> 0 && $past_bgu_sum_arari <> "" && $past_bgu_sum_arari <> 0){
											        $bgu_term_progress2_a = number_format((floor(((int)$bgu_term_progress_a / (int)$past_bgu_sum_arari) * 100 * 10)) / 10,1);
											    } else {
											        $bgu_term_progress2_a = "---"; 
											    }


											// 合計
											    ($all_term_progress <> 0 && $all_term_progress <> "" && $past_all_sum_uriage_all <> 0 && $past_all_sum_uriage_all <> "") ? $all_term_progress2 = number_format((floor(((int)$all_term_progress / (int)$past_all_sum_uriage_all) * 100 * 10)) / 10,1) : $all_term_progress2 = "---";
											    ($all_term_progress_n <> 0 && $all_term_progress_n <> "" && $past_all_sum_number_all <> 0 && $past_all_sum_number_all <> "") ? $all_term_progress2_n = number_format((floor(((int)$all_term_progress_n / (int)$past_all_sum_number_all) * 100 * 10)) / 10,1) : $all_term_progress2_n = "---";
											    ($all_term_progress_a <> 0 && $all_term_progress_a <> "" && $past_all_sum_arari_all <> 0 && $past_all_sum_arari_all <> "") ? $all_term_progress2_a = number_format((floor(((int)$all_term_progress_a / (int)$past_all_sum_arari_all) * 100 * 10)) / 10,1) : $all_term_progress2_a = "---";

											// HTML追記
											    ($jn_term_progress <> 0 && $jn_term_progress <> "") ? $jn_term_progress_view = "<div class='sinchoku'>" . number_format((int)$jn_term_progress) . "</div>" : $jn_term_progress_view = "<div class='sinchoku'>---</div>";
											    ($jn_sum_uriage <> 0 && $jn_sum_uriage <> "") ? $jn_sum_uriage_view = "<div class='sinchoku'>" . number_format($jn_sum_uriage) . "</div>" : $jn_sum_uriage_view = "<div class='sinchoku'>---</div>";
											    ($jn_term_progress2 < 100) ? $jn_term_progress2_view = "<div class='sinchoku fc_blue'>" . $jn_term_progress2 . "%</div>" : $jn_term_progress2_view = "<div class='sinchoku fc_red'>" . $jn_term_progress2 . "%</div>";
											    ($jn_term_progress_n <> 0 && $jn_term_progress_n <> "") ? $jn_term_progress_n_view = "<div class='sinchoku'>" . number_format((int)$jn_term_progress_n) . "</div>" : $jn_term_progress_n_view = "<div class='sinchoku'>---</div>";
											    ($jn_sum_number <> 0 && $jn_sum_number <> "") ? $jn_sum_number_view = "<div class='sinchoku'>" . number_format($jn_sum_number) . "</div>" : $jn_sum_number_view = "<div class='sinchoku'>---</div>";
											    ($jn_term_progress2_n < 100) ? $jn_term_progress2_n_view = "<div class='sinchoku fc_blue'>" . $jn_term_progress2_n . "%</div>" : $jn_term_progress2_n_view = "<div class='sinchoku fc_red'>" . $jn_term_progress2_n . "%</div>";
											    ($jn_term_progress_a <> 0 && $jn_term_progress_a <> "") ? $jn_term_progress_a_view = "<div class='sinchoku'>" . number_format((int)$jn_term_progress_a) . "</div>" : $jn_term_progress_a_view = "<div class='sinchoku'>---</div>";
											    ($jn_sum_arari <> 0 && $jn_sum_arari <> "") ? $jn_sum_arari_view = "<div class='sinchoku'>" . number_format($jn_sum_arari) . "</div>" : $jn_sum_arari_view = "<div class='sinchoku'>---</div>";
											    ($jn_term_progress2_a < 100) ? $jn_term_progress2_a_view = "<div class='sinchoku fc_blue'>" . $jn_term_progress2_a . "%</div>" : $jn_term_progress2_a_view = "<div class='sinchoku fc_red'>" . $jn_term_progress2_a . "%</div>";
											    ($ju_term_progress <> 0 && $ju_term_progress <> "") ? $ju_term_progress_view = "<div class='sinchoku'>" . number_format((int)$ju_term_progress) . "</div>" : $ju_term_progress_view = "<div class='sinchoku'>---</div>";
											    ($ju_sum_uriage <> 0 && $ju_sum_uriage <> "") ? $ju_sum_uriage_view = "<div class='sinchoku'>" . number_format($ju_sum_uriage) . "</div>" : $ju_sum_uriage_view = "<div class='sinchoku'>---</div>";
											    ($ju_term_progress2 < 100) ? $ju_term_progress2_view = "<div class='sinchoku fc_blue'>" . $ju_term_progress2 . "%</div>" : $ju_term_progress2_view = "<div class='sinchoku fc_red'>" . $ju_term_progress2 . "%</div>";
											    ($ju_term_progress_n <> 0 && $ju_term_progress_n <> "") ? $ju_term_progress_n_view = "<div class='sinchoku'>" . number_format((int)$ju_term_progress_n) . "</div>" : $ju_term_progress_n_view = "<div class='sinchoku'>---</div>";
											    ($ju_sum_number <> 0 && $ju_sum_number <> "") ? $ju_sum_number_view = "<div class='sinchoku'>" . number_format($ju_sum_number) . "</div>" : $ju_sum_number_view = "<div class='sinchoku'>---</div>";
											    ($ju_term_progress2_n < 100) ? $ju_term_progress2_n_view = "<div class='sinchoku fc_blue'>" . $ju_term_progress2_n . "%</div>" : $ju_term_progress2_n_view = "<div class='sinchoku fc_red'>" . $ju_term_progress2_n . "%</div>";
											    ($ju_term_progress_a <> 0 && $ju_term_progress_a <> "") ? $ju_term_progress_a_view = "<div class='sinchoku'>" . number_format((int)$ju_term_progress_a) . "</div>" : $ju_term_progress_a_view = "<div class='sinchoku'>---</div>";
											    ($ju_sum_arari <> 0 && $ju_sum_arari <> "") ? $ju_sum_arari_view = "<div class='sinchoku'>" . number_format($ju_sum_arari) . "</div>" : $ju_sum_arari_view = "<div class='sinchoku'>---</div>";
											    ($ju_term_progress2_a < 100) ? $ju_term_progress2_a_view = "<div class='sinchoku fc_blue'>" . $ju_term_progress2_a . "%</div>" : $ju_term_progress2_a_view = "<div class='sinchoku fc_red'>" . $ju_term_progress2_a . "%</div>";
											    ($ja_term_progress <> 0 && $ja_term_progress <> "") ? $ja_term_progress_view = "<div class='sinchoku'>" . number_format((int)$ja_term_progress) . "</div>" : $ja_term_progress_view = "<div class='sinchoku'>---</div>";
											    ($ja_sum_uriage <> 0 && $ja_sum_uriage <> "") ? $ja_sum_uriage_view = "<div class='sinchoku'>" . number_format($ja_sum_uriage) . "</div>" : $ja_sum_uriage_view = "<div class='sinchoku'>---</div>";
											    ($ja_term_progress2 < 100) ? $ja_term_progress2_view = "<div class='sinchoku fc_blue'>" . $ja_term_progress2 . "%</div>" : $ja_term_progress2_view = "<div class='sinchoku fc_red'>" . $ja_term_progress2 . "%</div>";
											    ($ja_term_progress_n <> 0 && $ja_term_progress_n <> "") ? $ja_term_progress_n_view = "<div class='sinchoku'>" . number_format((int)$ja_term_progress_n) . "</div>" : $ja_term_progress_n_view = "<div class='sinchoku'>---</div>";
											    ($ja_sum_number <> 0 && $ja_sum_number <> "") ? $ja_sum_number_view = "<div class='sinchoku'>" . number_format($ja_sum_number) . "</div>" : $ja_sum_number_view = "<div class='sinchoku'>---</div>";
											    ($ja_term_progress2_n < 100) ? $ja_term_progress2_n_view = "<div class='sinchoku fc_blue'>" . $ja_term_progress2_n . "%</div>" : $ja_term_progress2_n_view = "<div class='sinchoku fc_red'>" . $ja_term_progress2_n . "%</div>";
											    ($ja_term_progress_a <> 0 && $ja_term_progress_a <> "") ? $ja_term_progress_a_view = "<div class='sinchoku'>" . number_format((int)$ja_term_progress_a) . "</div>" : $ja_term_progress_a_view = "<div class='sinchoku'>---</div>";
											    ($ja_sum_arari <> 0 && $ja_sum_arari <> "") ? $ja_sum_arari_view = "<div class='sinchoku'>" . number_format($ja_sum_arari) . "</div>" : $ja_sum_arari_view = "<div class='sinchoku'>---</div>";
											    ($ja_term_progress2_a < 100) ? $ja_term_progress2_a_view = "<div class='sinchoku fc_blue'>" . $ja_term_progress2_a . "%</div>" : $ja_term_progress2_a_view = "<div class='sinchoku fc_red'>" . $ja_term_progress2_a . "%</div>";
											    
											    ($bn_term_progress <> 0 && $bn_term_progress <> "") ? $bn_term_progress_view = "<div class='sinchoku'>" . number_format((int)$bn_term_progress) . "</div>" : $bn_term_progress_view = "<div class='sinchoku'>---</div>";
											    ($bn_sum_uriage <> 0 && $bn_sum_uriage <> "") ? $bn_sum_uriage_view = "<div class='sinchoku'>" . number_format((int)$bn_sum_uriage) . "</div>" : $bn_sum_uriage_view = "<div class='sinchoku'>---</div>";
											    ($bn_term_progress2 < 100) ? $bn_term_progress2_view = "<div class='sinchoku fc_blue'>" . $bn_term_progress2 . "%</div>" : $bn_term_progress2_view = "<div class='sinchoku fc_red'>" . $bn_term_progress2 . "%</div>";
											    ($bn_term_progress_n <> 0 && $bn_term_progress_n <> "") ? $bn_term_progress_n_view = "<div class='sinchoku'>" . number_format((int)$bn_term_progress_n) . "</div>" : $bn_term_progress_n_view = "<div class='sinchoku'>---</div>";
											    ($bn_sum_number <> 0 && $bn_sum_number <> "") ? $bn_sum_number_view = "<div class='sinchoku'>" . number_format((int)$bn_sum_number) . "</div>" : $bn_sum_number_view = "<div class='sinchoku'>---</div>";
											    ($bn_term_progress2_n < 100) ? $bn_term_progress2_n_view = "<div class='sinchoku fc_blue'>" . $bn_term_progress2_n . "%</div>" : $bn_term_progress2_n_view = "<div class='sinchoku fc_red'>" . $bn_term_progress2_n . "%</div>";
											    ($bn_term_progress_a <> 0 && $bn_term_progress_a <> "") ? $bn_term_progress_a_view = "<div class='sinchoku'>" . number_format((int)$bn_term_progress_a) . "</div>" : $bn_term_progress_a_view = "<div class='sinchoku'>---</div>";
											    ($bn_sum_arari <> 0 && $bn_sum_arari <> "") ? $bn_sum_arari_view = "<div class='sinchoku'>" . number_format((int)$bn_sum_arari) . "</div>" : $bn_sum_arari_view = "<div class='sinchoku'>---</div>";
											    ($bn_term_progress2_a < 100) ? $bn_term_progress2_a_view = "<div class='sinchoku fc_blue'>" . $bn_term_progress2_a . "%</div>" : $bn_term_progress2_a_view = "<div class='sinchoku fc_red'>" . $bn_term_progress2_a . "%</div>";
											    ($bu_term_progress <> 0 && $bu_term_progress <> "") ? $bu_term_progress_view = "<div class='sinchoku'>" . number_format((int)$bu_term_progress) . "</div>" : $bu_term_progress_view = "<div class='sinchoku'>---</div>";
											    ($bu_sum_uriage <> 0 && $bu_sum_uriage <> "") ? $bu_sum_uriage_view = "<div class='sinchoku'>" . number_format((int)$bu_sum_uriage) . "</div>" : $bu_sum_uriage_view = "<div class='sinchoku'>---</div>";
											    ($bu_term_progress2 < 100) ? $bu_term_progress2_view = "<div class='sinchoku fc_blue'>" . $bu_term_progress2 . "%</div>" : $bu_term_progress2_view = "<div class='sinchoku fc_red'>" . $bu_term_progress2 . "%</div>";
											    ($bu_term_progress_n <> 0 && $bu_term_progress_n <> "") ? $bu_term_progress_n_view = "<div class='sinchoku'>" . number_format((int)$bu_term_progress_n) . "</div>" : $bu_term_progress_n_view = "<div class='sinchoku'>---</div>";
											    ($bu_sum_number <> 0 && $bu_sum_number <> "") ? $bu_sum_number_view = "<div class='sinchoku'>" . number_format((int)$bu_sum_number) . "</div>" : $bu_sum_number_view = "<div class='sinchoku'>---</div>";
											    ($bu_term_progress2_n < 100) ? $bu_term_progress2_n_view = "<div class='sinchoku fc_blue'>" . $bu_term_progress2_n . "%</div>" : $bu_term_progress2_n_view = "<div class='sinchoku fc_red'>" . $bu_term_progress2_n . "%</div>";
											    ($bu_term_progress_a <> 0 && $bu_term_progress_a <> "") ? $bu_term_progress_a_view = "<div class='sinchoku'>" . number_format((int)$bu_term_progress_a) . "</div>" : $bu_term_progress_a_view = "<div class='sinchoku'>---</div>";
											    ($bu_sum_arari <> 0 && $bu_sum_arari <> "") ? $bu_sum_arari_view = "<div class='sinchoku'>" . number_format((int)$bu_sum_arari) . "</div>" : $bu_sum_arari_view = "<div class='sinchoku'>---</div>";
											    ($bu_term_progress2_a < 100) ? $bu_term_progress2_a_view = "<div class='sinchoku fc_blue'>" . $bu_term_progress2_a . "%</div>" : $bu_term_progress2_a_view = "<div class='sinchoku fc_red'>" . $bu_term_progress2_a . "%</div>";
											    ($ba_term_progress <> 0 && $ba_term_progress <> "") ? $ba_term_progress_view = "<div class='sinchoku'>" . number_format((int)$ba_term_progress) . "</div>" : $ba_term_progress_view = "<div class='sinchoku'>---</div>";
											    ($ba_sum_uriage <> 0 && $ba_sum_uriage <> "") ? $ba_sum_uriage_view = "<div class='sinchoku'>" . number_format((int)$ba_sum_uriage) . "</div>" : $ba_sum_uriage_view = "<div class='sinchoku'>---</div>";
											    ($ba_term_progress2 < 100) ? $ba_term_progress2_view = "<div class='sinchoku fc_blue'>" . $ba_term_progress2 . "%</div>" : $ba_term_progress2_view = "<div class='sinchoku fc_red'>" . $ba_term_progress2 . "%</div>";
											    ($ba_term_progress_n <> 0 && $ba_term_progress_n <> "") ? $ba_term_progress_n_view = "<div class='sinchoku'>" . number_format((int)$ba_term_progress_n) . "</div>" : $ba_term_progress_n_view = "<div class='sinchoku'>---</div>";
											    ($ba_sum_number <> 0 && $ba_sum_number <> "") ? $ba_sum_number_view = "<div class='sinchoku'>" . number_format((int)$ba_sum_number) . "</div>" : $ba_sum_number_view = "<div class='sinchoku'>---</div>";
											    ($ba_term_progress2_n < 100) ? $ba_term_progress2_n_view = "<div class='sinchoku fc_blue'>" . $ba_term_progress2_n . "%</div>" : $ba_term_progress2_n_view = "<div class='sinchoku fc_red'>" . $ba_term_progress2_n . "%</div>";
											    ($ba_term_progress_a <> 0 && $ba_term_progress_a <> "") ? $ba_term_progress_a_view = "<div class='sinchoku'>" . number_format((int)$ba_term_progress_a) . "</div>" : $ba_term_progress_a_view = "<div class='sinchoku'>---</div>";
											    ($ba_sum_arari <> 0 && $ba_sum_arari <> "") ? $ba_sum_arari_view = "<div class='sinchoku'>" . number_format((int)$ba_sum_arari) . "</div>" : $ba_sum_arari_view = "<div class='sinchoku'>---</div>";
											    ($ba_term_progress2_a < 100) ? $ba_term_progress2_a_view = "<div class='sinchoku fc_blue'>" . $ba_term_progress2_a . "%</div>" : $ba_term_progress2_a_view = "<div class='sinchoku fc_red'>" . $ba_term_progress2_a . "%</div>";
											    
											    ($jln_term_progress <> 0 && $jln_term_progress <> "") ? $jln_term_progress_view = "<div class='sinchoku'>" . number_format((int)$jln_term_progress) . "</div>" : $jln_term_progress_view = "<div class='sinchoku'>---</div>";
											    ($jln_sum_uriage <> 0 && $jln_sum_uriage <> "") ? $jln_sum_uriage_view = "<div class='sinchoku'>" . number_format((int)$jln_sum_uriage) . "</div>" : $jln_sum_uriage_view = "<div class='sinchoku'>---</div>";
											    ($jln_term_progress2 < 100) ? $jln_term_progress2_view = "<div class='sinchoku fc_blue'>" . $jln_term_progress2 . "%</div>" : $jln_term_progress2_view = "<div class='sinchoku fc_red'>" . $jln_term_progress2 . "%</div>";
											    ($jln_term_progress_n <> 0 && $jln_term_progress_n <> "") ? $jln_term_progress_n_view = "<div class='sinchoku'>" . number_format((int)$jln_term_progress_n) . "</div>" : $jln_term_progress_n_view = "<div class='sinchoku'>---</div>";
											    ($jln_sum_number <> 0 && $jln_sum_number <> "") ? $jln_sum_number_view = "<div class='sinchoku'>" . number_format((int)$jln_sum_number) . "</div>" : $jln_sum_number_view = "<div class='sinchoku'>---</div>";
											    ($jln_term_progress2_n < 100) ? $jln_term_progress2_n_view = "<div class='sinchoku fc_blue'>" . $jln_term_progress2_n . "%</div>" : $jln_term_progress2_n_view = "<div class='sinchoku fc_red'>" . $jln_term_progress2_n . "%</div>";
											    ($jln_term_progress_a <> 0 && $jln_term_progress_a <> "") ? $jln_term_progress_a_view = "<div class='sinchoku'>" . number_format((int)$jln_term_progress_a) . "</div>" : $jln_term_progress_a_view = "<div class='sinchoku'>---</div>";
											    ($jln_sum_arari <> 0 && $jln_sum_arari <> "") ? $jln_sum_arari_view = "<div class='sinchoku'>" . number_format((int)$jln_sum_arari) . "</div>" : $jln_sum_arari_view = "<div class='sinchoku'>---</div>";
											    ($jln_term_progress2_a < 100) ? $jln_term_progress2_a_view = "<div class='sinchoku fc_blue'>" . $jln_term_progress2_a . "%</div>" : $jln_term_progress2_a_view = "<div class='sinchoku fc_red'>" . $jln_term_progress2_a . "%</div>";
											    ($jlu_term_progress <> 0 && $jlu_term_progress <> "") ? $jlu_term_progress_view = "<div class='sinchoku'>" . number_format((int)$jlu_term_progress) . "</div>" : $jlu_term_progress_view = "<div class='sinchoku'>---</div>";
											    ($jlu_sum_uriage <> 0 && $jlu_sum_uriage <> "") ? $jlu_sum_uriage_view = "<div class='sinchoku'>" . number_format((int)$jlu_sum_uriage) . "</div>" : $jlu_sum_uriage_view = "<div class='sinchoku'>---</div>";
											    ($jlu_term_progress2 < 100) ? $jlu_term_progress2_view = "<div class='sinchoku fc_blue'>" . $jlu_term_progress2 . "%</div>" : $jlu_term_progress2_view = "<div class='sinchoku fc_red'>" . $jlu_term_progress2 . "%</div>";
											    ($jlu_term_progress_n <> 0 && $jlu_term_progress_n <> "") ? $jlu_term_progress_n_view = "<div class='sinchoku'>" . number_format((int)$jlu_term_progress_n) . "</div>" : $jlu_term_progress_n_view = "<div class='sinchoku'>---</div>";
											    ($jlu_sum_number <> 0 && $jlu_sum_number <> "") ? $jlu_sum_number_view = "<div class='sinchoku'>" . number_format((int)$jlu_sum_number) . "</div>" : $jlu_sum_number_view = "<div class='sinchoku'>---</div>";
											    ($jlu_term_progress2_n < 100) ? $jlu_term_progress2_n_view = "<div class='sinchoku fc_blue'>" . $jlu_term_progress2_n . "%</div>" : $jlu_term_progress2_n_view = "<div class='sinchoku fc_red'>" . $jlu_term_progress2_n . "%</div>";
											    ($jlu_term_progress_a <> 0 && $jlu_term_progress_a <> "") ? $jlu_term_progress_a_view = "<div class='sinchoku'>" . number_format((int)$jlu_term_progress_a) . "</div>" : $jlu_term_progress_a_view = "<div class='sinchoku'>---</div>";
											    ($jlu_sum_arari <> 0 && $jlu_sum_arari <> "") ? $jlu_sum_arari_view = "<div class='sinchoku'>" . number_format((int)$jlu_sum_arari) . "</div>" : $jlu_sum_arari_view = "<div class='sinchoku'>---</div>";
											    ($jlu_term_progress2_a < 100) ? $jlu_term_progress2_a_view = "<div class='sinchoku fc_blue'>" . $jlu_term_progress2_a . "%</div>" : $jlu_term_progress2_a_view = "<div class='sinchoku fc_red'>" . $jlu_term_progress2_a . "%</div>";
											    
                                                ($bgn_term_progress <> 0 && $bgn_term_progress <> "") ? $bgn_term_progress_view = "<div class='sinchoku'>" . number_format((int)$bgn_term_progress) . "</div>" : $bgn_term_progress_view = "<div class='sinchoku'>---</div>";
											    ($bgn_sum_uriage <> 0 && $bgn_sum_uriage <> "") ? $bgn_sum_uriage_view = "<div class='sinchoku'>" . number_format((int)$bgn_sum_uriage) . "</div>" : $bgn_sum_uriage_view = "<div class='sinchoku'>---</div>";
											    ($bgn_term_progress2 < 100) ? $bgn_term_progress2_view = "<div class='sinchoku fc_blue'>" . $bgn_term_progress2 . "%</div>" : $bgn_term_progress2_view = "<div class='sinchoku fc_red'>" . $bgn_term_progress2 . "%</div>";
											    ($bgn_term_progress_n <> 0 && $bgn_term_progress_n <> "") ? $bgn_term_progress_n_view = "<div class='sinchoku'>" . number_format((int)$bgn_term_progress_n) . "</div>" : $bgn_term_progress_n_view = "<div class='sinchoku'>---</div>";
											    ($bgn_sum_number <> 0 && $bgn_sum_number <> "") ? $bgn_sum_number_view = "<div class='sinchoku'>" . number_format((int)$bgn_sum_number) . "</div>" : $bgn_sum_number_view = "<div class='sinchoku'>---</div>";
											    ($bgn_term_progress2_n < 100) ? $bgn_term_progress2_n_view = "<div class='sinchoku fc_blue'>" . $bgn_term_progress2_n . "%</div>" : $bgn_term_progress2_n_view = "<div class='sinchoku fc_red'>" . $bgn_term_progress2_n . "%</div>";
											    ($bgn_term_progress_a <> 0 && $bgn_term_progress_a <> "") ? $bgn_term_progress_a_view = "<div class='sinchoku'>" . number_format((int)$bgn_term_progress_a) . "</div>" : $bgn_term_progress_a_view = "<div class='sinchoku'>---</div>";
											    ($bgn_sum_arari <> 0 && $bgn_sum_arari <> "") ? $bgn_sum_arari_view = "<div class='sinchoku'>" . number_format((int)$bgn_sum_arari) . "</div>" : $bgn_sum_arari_view = "<div class='sinchoku'>---</div>";
											    ($bgn_term_progress2_a < 100) ? $bgn_term_progress2_a_view = "<div class='sinchoku fc_blue'>" . $bgn_term_progress2_a . "%</div>" : $bgn_term_progress2_a_view = "<div class='sinchoku fc_red'>" . $bgn_term_progress2_a . "%</div>";
                                                ($bgu_term_progress <> 0 && $bgu_term_progress <> "") ? $bgu_term_progress_view = "<div class='sinchoku'>" . number_format((int)$bgu_term_progress) . "</div>" : $bgu_term_progress_view = "<div class='sinchoku'>---</div>";
											    ($bgu_sum_uriage <> 0 && $bgu_sum_uriage <> "") ? $bgu_sum_uriage_view = "<div class='sinchoku'>" . number_format((int)$bgu_sum_uriage) . "</div>" : $bgu_sum_uriage_view = "<div class='sinchoku'>---</div>";
											    ($bgu_term_progress2 < 100) ? $bgu_term_progress2_view = "<div class='sinchoku fc_blue'>" . $bgu_term_progress2 . "%</div>" : $bgu_term_progress2_view = "<div class='sinchoku fc_red'>" . $bgu_term_progress2 . "%</div>";
											    ($bgu_term_progress_n <> 0 && $bgu_term_progress_n <> "") ? $bgu_term_progress_n_view = "<div class='sinchoku'>" . number_format((int)$bgu_term_progress_n) . "</div>" : $bgu_term_progress_n_view = "<div class='sinchoku'>---</div>";
											    ($bgu_sum_number <> 0 && $bgu_sum_number <> "") ? $bgu_sum_number_view = "<div class='sinchoku'>" . number_format((int)$bgu_sum_number) . "</div>" : $bgu_sum_number_view = "<div class='sinchoku'>---</div>";
											    ($bgu_term_progress2_n < 100) ? $bgu_term_progress2_n_view = "<div class='sinchoku fc_blue'>" . $bgu_term_progress2_n . "%</div>" : $bgu_term_progress2_n_view = "<div class='sinchoku fc_red'>" . $bgu_term_progress2_n . "%</div>";
											    ($bgu_term_progress_a <> 0 && $bgu_term_progress_a <> "") ? $bgu_term_progress_a_view = "<div class='sinchoku'>" . number_format((int)$bgu_term_progress_a) . "</div>" : $bgu_term_progress_a_view = "<div class='sinchoku'>---</div>";
											    ($bgu_sum_arari <> 0 && $bgu_sum_arari <> "") ? $bgu_sum_arari_view = "<div class='sinchoku'>" . number_format((int)$bgu_sum_arari) . "</div>" : $bgu_sum_arari_view = "<div class='sinchoku'>---</div>";
											    ($bgu_term_progress2_a < 100) ? $bgu_term_progress2_a_view = "<div class='sinchoku fc_blue'>" . $bgu_term_progress2_a . "%</div>" : $bgu_term_progress2_a_view = "<div class='sinchoku fc_red'>" . $bgu_term_progress2_a . "%</div>";
                                                
											    ($all_term_progress <> 0 && $all_term_progress <> "") ? $all_term_progress_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_term_progress) . "</div>" : $all_term_progress_view = "<div class='sinchoku bg_grey'>---</div>";
											    ($all_sum_uriage_all <> 0 && $all_sum_uriage_all <> "") ? $all_sum_uriage_all_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_sum_uriage_all) . "</div>" : $all_sum_uriage_all_view = "<div class='sinchoku bg_grey'>---</div>";
											    ($all_term_progress2 < 100) ? $all_term_progress2_view = "<div class='sinchoku fc_blue bg_grey'>" . $all_term_progress2 . "%</div>" : $all_term_progress2_view = "<div class='sinchoku fc_red bg_grey'>" . $all_term_progress2 . "%</div>";
											    ($all_term_progress_n <> 0 && $all_term_progress_n <> "") ? $all_term_progress_n_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_term_progress_n) . "</div>" : $all_term_progress_n_view = "<div class='sinchoku bg_grey'>---</div>";
											    ($all_sum_number_all <> 0 && $all_sum_number_all <> "") ? $all_sum_number_all_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_sum_number_all) . "</div>" : $all_sum_number_all_view = "<div class='sinchoku bg_grey'>---</div>";
											    ($all_term_progress2_n < 100) ? $all_term_progress2_n_view = "<div class='sinchoku fc_blue bg_grey'>" . $all_term_progress2_n . "%</div>" : $all_term_progress2_n_view = "<div class='sinchoku fc_red bg_grey'>" . $all_term_progress2_n . "%</div>";
											    ($all_term_progress_a <> 0 && $all_term_progress_a <> "") ? $all_term_progress_a_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_term_progress_a) . "</div>" : $all_term_progress_a_view = "<div class='sinchoku bg_grey'>---</div>";
											    ($all_sum_arari_all <> 0 && $all_sum_arari_all <> "") ? $all_sum_arari_all_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_sum_arari_all) . "</div>" : $all_sum_arari_all_view = "<div class='sinchoku bg_grey'>---</div>";
											    ($all_term_progress2_a < 100) ? $all_term_progress2_a_view = "<div class='sinchoku fc_blue bg_grey'>" . $all_term_progress2_a . "%</div>" : $all_term_progress2_a_view = "<div class='sinchoku fc_red bg_grey'>" . $all_term_progress2_a . "%</div>";



   									 // 売上額進捗
                                                 	$uriage_progress_html = 
	                                                 "<div class='btn_bulldown_  pt2'><span class='view'>＋</span> 予測数値について</div>
	                                                 <div class='down'>
	                                                     <p class='text'>▼月間着地予測：データを有する最終月の数値 / 月初からデータを有する最終日までの日数 x 該当月の最終日の数字</p>
	                                                     <p class='text'>▼月間着地予測比（対過去・同月）：データを有する最終月を検索期間遡った過去月との対比（1～12月までの検索で、8月までのデータが存在するのなら、昨年の8月との対比）</p>
	                                                     <p class='text'>▼全期間着地予測：検索期間の累計 / 検索スタート日からデータを有する最終日までの日数 x 検索期間の総日数</p>
	                                                 </div>
	                                                 <div class='ul_p mt1'>
	                                                     <div class='sinchoku_t'>" . $last_year_last . "年" . $last_month_last. "月</div>
	                                                     <div class='sinchoku_t'>月間売上進捗</div>
	                                                     <div class='sinchoku_t'>月間着地予測</div>
	                                                     <div class='sinchoku_t'>月間着地予測比（対前月）</div>
	                                                     <div class='sinchoku_t'>月間着地予測比（対過去・同月）</div>
	                                                     <div class='sinchoku_t'>全期間売上進捗</div>
	                                                     <div class='sinchoku_t'>全期間着地予測</div>
	                                                     <div class='sinchoku_t'>全期間着地予測比（対過去・全期間）</div>
	                                                 </div>
	                                                 <div class='ul_p'>
	                                                     <div class='sinchoku ta_c'>ジャック・N</div>
	                                                     <div class='sinchoku'>" . $jn_uriage_view1. "</div>
	                                                     <div class='sinchoku'>" . $jn_uriage_view2. "</div>
	                                                     " . $jn_uriage_view3 . "
	                                                     " . $jn_uriage_view4 . "
	                                                     " . $jn_sum_uriage_view . "
	                                                     " . $jn_term_progress_view. "
	                                                     " . $jn_term_progress2_view. "
	                                                 </div>
	                                                 <div class='ul_p'>
	                                                     <div class='sinchoku ta_c'>ジャック・U</div>
	                                                     <div class='sinchoku'>" . $ju_uriage_view1. "</div>
	                                                     <div class='sinchoku'>" . $ju_uriage_view2. "</div>
	                                                     " . $ju_uriage_view3 . "
	                                                     " . $ju_uriage_view4 . "
	                                                     " . $ju_sum_uriage_view . "
	                                                     " . $ju_term_progress_view. "
	                                                     " . $ju_term_progress2_view. "
	                                                 </div>
	                                                 <div class='ul_p'>
	                                                     <div class='sinchoku ta_c'>ジャック・A</div>
	                                                     <div class='sinchoku'>" . $ja_uriage_view1. "</div>
	                                                     <div class='sinchoku'>" . $ja_uriage_view2. "</div>
	                                                     " . $ja_uriage_view3 . "
	                                                     " . $ja_uriage_view4 . "
	                                                     " . $ja_sum_uriage_view . "
	                                                     " . $ja_term_progress_view. "
	                                                     " . $ja_term_progress2_view. "
	                                                 </div>
	                                                 <div class='ul_p'>
	                                                     <div class='sinchoku ta_c'>ベティー・N</div>
	                                                     <div class='sinchoku'>" . $bn_uriage_view1 . "</div>
	                                                     <div class='sinchoku'>" . $bn_uriage_view2. "</div>
	                                                     " . $bn_uriage_view3 . "
	                                                     " . $bn_uriage_view4 . "
	                                                     " . $bn_sum_uriage_view . "
	                                                     " . $bn_term_progress_view. "
	                                                     " . $bn_term_progress2_view. "
	                                                 </div>
	                                                 <div class='ul_p'>
	                                                     <div class='sinchoku ta_c'>ベティー・U</div>
	                                                     <div class='sinchoku'>" . $bu_uriage_view1 . "</div>
	                                                     <div class='sinchoku'>" . $bu_uriage_view2. "</div>
	                                                     " . $bu_uriage_view3 . "
	                                                     " . $bu_uriage_view4 . "
	                                                     " . $bu_sum_uriage_view . "
	                                                     " . $bu_term_progress_view. "
	                                                     " . $bu_term_progress2_view. "
	                                                 </div>
	                                                 <div class='ul_p'>
	                                                     <div class='sinchoku ta_c'>ベティー・A</div>
	                                                     <div class='sinchoku'>" . $ba_uriage_view1 . "</div>
	                                                     <div class='sinchoku'>" . $ba_uriage_view2. "</div>
	                                                     " . $ba_uriage_view3 . "
	                                                     " . $ba_uriage_view4 . "
	                                                     " . $ba_sum_uriage_view . "
	                                                     " . $ba_term_progress_view. "
	                                                     " . $ba_term_progress2_view. "
	                                                 </div>
	                                                 <div class='ul_p'>
	                                                     <div class='sinchoku ta_c'>ジュエリー・N</div>
	                                                     <div class='sinchoku'>" . $jln_uriage_view1 . "</div>
	                                                     <div class='sinchoku'>" . $jln_uriage_view2. "</div>
	                                                     " . $jln_uriage_view3 . "
	                                                     " . $jln_uriage_view4 . "
	                                                     " . $jln_sum_uriage_view . "
	                                                     " . $jln_term_progress_view. "
	                                                     " . $jln_term_progress2_view. "
	                                                 </div>
	                                                 <div class='ul_p'>
	                                                     <div class='sinchoku ta_c'>ジュエリー・U</div>
	                                                     <div class='sinchoku'>" . $jlu_uriage_view1 . "</div>
	                                                     <div class='sinchoku'>" . $jlu_uriage_view2. "</div>
	                                                     " . $jlu_uriage_view3 . "
	                                                     " . $jlu_uriage_view4 . "
	                                                     " . $jlu_sum_uriage_view . "
	                                                     " . $jlu_term_progress_view. "
	                                                     " . $jlu_term_progress2_view. "
	                                                 </div>
	                                                 <div class='ul_p'>
	                                                     <div class='sinchoku ta_c'>バッグ・N</div>
	                                                     <div class='sinchoku'>" . $bgn_uriage_view1 . "</div>
	                                                     <div class='sinchoku'>" . $bgn_uriage_view2. "</div>
	                                                     " . $bgn_uriage_view3 . "
	                                                     " . $bgn_uriage_view4 . "
	                                                     " . $bgn_sum_uriage_view . "
	                                                     " . $bgn_term_progress_view. "
	                                                     " . $bgn_term_progress2_view. "
	                                                 </div>
	                                                 <div class='ul_p'>
	                                                     <div class='sinchoku ta_c'>バッグ・U</div>
	                                                     <div class='sinchoku'>" . $bgu_uriage_view1 . "</div>
	                                                     <div class='sinchoku'>" . $bgu_uriage_view2. "</div>
	                                                     " . $bgu_uriage_view3 . "
	                                                     " . $bgu_uriage_view4 . "
	                                                     " . $bgu_sum_uriage_view . "
	                                                     " . $bgu_term_progress_view. "
	                                                     " . $bgu_term_progress2_view. "
	                                                 </div>
	                                                 <div class='ul_p'>
	                                                     <div class='sinchoku bg_grey ta_c'>合計</div>
	                                                     <div class='sinchoku bg_grey'>" . $all_uriage_view1 . "</div>
	                                                     <div class='sinchoku bg_grey'>" . $all_uriage_view2 . "</div>
	                                                     " . $all_uriage_view3 . "
	                                                     " . $all_uriage_view4 . "
	                                                     " . $all_sum_uriage_all_view . "
	                                                     " . $all_term_progress_view. "
	                                                     " . $all_term_progress2_view. "
	                                                 </div>";
                                     // 売上点数進捗
                                                    $number_progress_html = 
                                                    "<div class='btn_bulldown_  pt2'><span class='view2'>＋</span> 予測数値について</div>
                                                    <div class='down'>
                                                    <p class='text'>▼月間着地予測：データを有する最終月の数値 / 月初からデータを有する最終日までの日数 x 該当月の最終日の数字</p>
                                                    <p class='text'>▼月間着地予測比（対過去・同月）：データを有する最終月を検索期間遡った過去月との対比（1～12月までの検索で、8月までのデータが存在するのなら、昨年の8月との対比）</p>
                                                    <p class='text'>▼全期間着地予測：検索期間の累計 / 検索スタート日からデータを有する最終日までの日数 x 検索期間の総日数</p>
                                                    </div>
                                                    <div class='ul_p mt1'>
                                                        <div class='sinchoku_t'>" . $last_year_last . "年" . $last_month_last. "月</div>
                                                        <div class='sinchoku_t'>月間売上進捗</div>
                                                        <div class='sinchoku_t'>月間着地予測</div>
                                                        <div class='sinchoku_t'>月間着地予測比（対前月）</div>
                                                        <div class='sinchoku_t'>月間着地予測比（対過去・同月）</div>
                                                        <div class='sinchoku_t'>全期間売上進捗</div>
                                                        <div class='sinchoku_t'>全期間着地予測</div>
                                                        <div class='sinchoku_t'>全期間着地予測比（対過去・全期間）</div>
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>ジャック・N</div>
                                                        <div class='sinchoku'>" . $jn_number_view1. "</div>
                                                        <div class='sinchoku'>" . $jn_number_view2. "</div>
                                                        " . $jn_number_view3 . "
                                                        " . $jn_number_view4 . "
                                                        " . $jn_sum_number_view . "
                                                        " . $jn_term_progress_n_view. "
                                                        " . $jn_term_progress2_n_view. "
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>ジャック・U</div>
                                                        <div class='sinchoku'>" . $ju_number_view1. "</div>
                                                        <div class='sinchoku'>" . $ju_number_view2. "</div>
                                                        " . $ju_number_view3 . "
                                                        " . $ju_number_view4 . "
                                                        " . $ju_sum_number_view . "
                                                        " . $ju_term_progress_n_view. "
                                                        " . $ju_term_progress2_n_view. "
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>ジャック・A</div>
                                                        <div class='sinchoku'>" . $ja_number_view1. "</div>
                                                        <div class='sinchoku'>" . $ja_number_view2. "</div>
                                                        " . $ja_number_view3 . "
                                                        " . $ja_number_view4 . "
                                                        " . $ja_sum_number_view . "
                                                        " . $ja_term_progress_n_view. "
                                                        " . $ja_term_progress2_n_view. "
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>ベティー・N</div>
                                                        <div class='sinchoku'>" . $bn_number_view1 . "</div>
                                                        <div class='sinchoku'>" . $bn_number_view2. "</div>
                                                        " . $bn_number_view3 . "
                                                        " . $bn_number_view4 . "
                                                        " . $bn_sum_number_view . "
                                                        " . $bn_term_progress_n_view. "
                                                        " . $bn_term_progress2_n_view. "
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>ベティー・U</div>
                                                        <div class='sinchoku'>" . $bu_number_view1 . "</div>
                                                        <div class='sinchoku'>" . $bu_number_view2. "</div>
                                                        " . $bu_number_view3 . "
                                                        " . $bu_number_view4 . "
                                                        " . $bu_sum_number_view . "
                                                        " . $bu_term_progress_n_view. "
                                                        " . $bu_term_progress2_n_view. "
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>ベティー・A</div>
                                                        <div class='sinchoku'>" . $ba_number_view1 . "</div>
                                                        <div class='sinchoku'>" . $ba_number_view2. "</div>
                                                        " . $ba_number_view3 . "
                                                        " . $ba_number_view4 . "
                                                        " . $ba_sum_number_view . "
                                                        " . $ba_term_progress_n_view. "
                                                        " . $ba_term_progress2_n_view. "
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>ジュエリー・N</div>
                                                        <div class='sinchoku'>" . $jln_number_view1 . "</div>
                                                        <div class='sinchoku'>" . $jln_number_view2. "</div>
                                                        " . $jln_number_view3 . "
                                                        " . $jln_number_view4 . "
                                                        " . $jln_sum_number_view . "
                                                        " . $jln_term_progress_n_view. "
                                                        " . $jln_term_progress2_n_view. "
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>ジュエリー・U</div>
                                                        <div class='sinchoku'>" . $jlu_number_view1 . "</div>
                                                        <div class='sinchoku'>" . $jlu_number_view2. "</div>
                                                        " . $jlu_number_view3 . "
                                                        " . $jlu_number_view4 . "
                                                        " . $jlu_sum_number_view . "
                                                        " . $jlu_term_progress_n_view. "
                                                        " . $jlu_term_progress2_n_view. "
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>バッグ・N</div>
                                                        <div class='sinchoku'>" . $bgn_number_view1 . "</div>
                                                        <div class='sinchoku'>" . $bgn_number_view2. "</div>
                                                        " . $bgn_number_view3 . "
                                                        " . $bgn_number_view4 . "
                                                        " . $bgn_sum_number_view . "
                                                        " . $bgn_term_progress_n_view. "
                                                        " . $bgn_term_progress2_n_view. "
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>バッグ・U</div>
                                                        <div class='sinchoku'>" . $bgu_number_view1 . "</div>
                                                        <div class='sinchoku'>" . $bgu_number_view2. "</div>
                                                        " . $bgu_number_view3 . "
                                                        " . $bgu_number_view4 . "
                                                        " . $bgu_sum_number_view . "
                                                        " . $bgu_term_progress_n_view. "
                                                        " . $bgu_term_progress2_n_view. "
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku bg_grey ta_c'>合計</div>
                                                        <div class='sinchoku bg_grey'>" . $all_number_view1 . "</div>
                                                        <div class='sinchoku bg_grey'>" . $all_number_view2 . "</div>
                                                        " . $all_number_view3 . "
                                                        " . $all_number_view4 . "
                                                        " . $all_sum_number_all_view . "
                                                        " . $all_term_progress_n_view. "
                                                        " . $all_term_progress2_n_view. "
                                                    </div>";
                                     // 売上粗利進捗
                                                    $arari_progress_html = 
                                                    "<div class='btn_bulldown_  pt2'><span class='view3'>＋</span> 予測数値について</div>
                                                    <div class='down'>
                                                    <p class='text'>▼月間着地予測：データを有する最終月の数値 / 月初からデータを有する最終日までの日数 x 該当月の最終日の数字</p>
                                                    <p class='text'>▼月間着地予測比（対過去・同月）：データを有する最終月を検索期間遡った過去月との対比（1～12月までの検索で、8月までのデータが存在するのなら、昨年の8月との対比）</p>
                                                    <p class='text'>▼全期間着地予測：検索期間の累計 / 検索スタート日からデータを有する最終日までの日数 x 検索期間の総日数</p>
                                                    </div>
                                                    <div class='ul_p mt1'>
                                                        <div class='sinchoku_t'>" . $last_year_last . "年" . $last_month_last. "月</div>
                                                        <div class='sinchoku_t'>月間売上進捗</div>
                                                        <div class='sinchoku_t'>月間着地予測</div>
                                                        <div class='sinchoku_t'>月間着地予測比（対前月）</div>
                                                        <div class='sinchoku_t'>月間着地予測比（対過去・同月）</div>
                                                        <div class='sinchoku_t'>全期間売上進捗</div>
                                                        <div class='sinchoku_t'>全期間着地予測</div>
                                                        <div class='sinchoku_t'>全期間着地予測比（対過去・全期間）</div>
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>ジャック・N</div>
                                                        <div class='sinchoku'>" . $jn_arari_view1. "</div>
                                                        <div class='sinchoku'>" . $jn_arari_view2. "</div>
                                                        " . $jn_arari_view3 . "
                                                        " . $jn_arari_view4 . "
                                                        " . $jn_sum_arari_view . "
                                                        " . $jn_term_progress_a_view. "
                                                        " . $jn_term_progress2_a_view. "
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>ジャック・U</div>
                                                        <div class='sinchoku'>" . $ju_arari_view1. "</div>
                                                        <div class='sinchoku'>" . $ju_arari_view2. "</div>
                                                        " . $ju_arari_view3 . "
                                                        " . $ju_arari_view4 . "
                                                        " . $ju_sum_arari_view . "
                                                        " . $ju_term_progress_a_view. "
                                                        " . $ju_term_progress2_a_view. "
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>ジャック・A</div>
                                                        <div class='sinchoku'>" . $ja_arari_view1. "</div>
                                                        <div class='sinchoku'>" . $ja_arari_view2. "</div>
                                                        " . $ja_arari_view3 . "
                                                        " . $ja_arari_view4 . "
                                                        " . $ja_sum_arari_view . "
                                                        " . $ja_term_progress_a_view. "
                                                        " . $ja_term_progress2_a_view. "
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>ベティー・N</div>
                                                        <div class='sinchoku'>" . $bn_arari_view1 . "</div>
                                                        <div class='sinchoku'>" . $bn_arari_view2. "</div>
                                                        " . $bn_arari_view3 . "
                                                        " . $bn_arari_view4 . "
                                                        " . $bn_sum_arari_view . "
                                                        " . $bn_term_progress_a_view. "
                                                        " . $bn_term_progress2_a_view. "
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>ベティー・U</div>
                                                        <div class='sinchoku'>" . $bu_arari_view1 . "</div>
                                                        <div class='sinchoku'>" . $bu_arari_view2. "</div>
                                                        " . $bu_arari_view3 . "
                                                        " . $bu_arari_view4 . "
                                                        " . $bu_sum_arari_view . "
                                                        " . $bu_term_progress_a_view. "
                                                        " . $bu_term_progress2_a_view. "
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>ベティー・A</div>
                                                        <div class='sinchoku'>" . $ba_arari_view1 . "</div>
                                                        <div class='sinchoku'>" . $ba_arari_view2. "</div>
                                                        " . $ba_arari_view3 . "
                                                        " . $ba_arari_view4 . "
                                                        " . $ba_sum_arari_view . "
                                                        " . $ba_term_progress_a_view. "
                                                        " . $ba_term_progress2_a_view. "
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>ジュエリー・N</div>
                                                        <div class='sinchoku'>" . $jln_arari_view1 . "</div>
                                                        <div class='sinchoku'>" . $jln_arari_view2. "</div>
                                                        " . $jln_arari_view3 . "
                                                        " . $jln_arari_view4 . "
                                                        " . $jln_sum_arari_view . "
                                                        " . $jln_term_progress_a_view. "
                                                        " . $jln_term_progress2_a_view. "
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>ジュエリー・U</div>
                                                        <div class='sinchoku'>" . $jlu_arari_view1 . "</div>
                                                        <div class='sinchoku'>" . $jlu_arari_view2. "</div>
                                                        " . $jlu_arari_view3 . "
                                                        " . $jlu_arari_view4 . "
                                                        " . $jlu_sum_arari_view . "
                                                        " . $jlu_term_progress_a_view. "
                                                        " . $jlu_term_progress2_a_view. "
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>バッグ・N</div>
                                                        <div class='sinchoku'>" . $bgn_arari_view1 . "</div>
                                                        <div class='sinchoku'>" . $bgn_arari_view2. "</div>
                                                        " . $bgn_arari_view3 . "
                                                        " . $bgn_arari_view4 . "
                                                        " . $bgn_sum_arari_view . "
                                                        " . $bgn_term_progress_a_view. "
                                                        " . $bgn_term_progress2_a_view. "
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku ta_c'>バッグ・U</div>
                                                        <div class='sinchoku'>" . $bgu_arari_view1 . "</div>
                                                        <div class='sinchoku'>" . $bgu_arari_view2. "</div>
                                                        " . $bgu_arari_view3 . "
                                                        " . $bgu_arari_view4 . "
                                                        " . $bgu_sum_arari_view . "
                                                        " . $bgu_term_progress_a_view. "
                                                        " . $bgu_term_progress2_a_view. "
                                                    </div>
                                                    <div class='ul_p'>
                                                        <div class='sinchoku bg_grey ta_c'>合計</div>
                                                        <div class='sinchoku bg_grey'>" . $all_arari_view1 . "</div>
                                                        <div class='sinchoku bg_grey'>" . $all_arari_view2 . "</div>
                                                        " . $all_arari_view3 . "
                                                        " . $all_arari_view4 . "
                                                        " . $all_sum_arari_all_view . "
                                                        " . $all_term_progress_a_view. "
                                                        " . $all_term_progress2_a_view. "
                                                    </div>";

                                                    if($out6 <> "ON"){
                                                        $uriage_progress_html = "";
                                                        $number_progress_html = "";
                                                        $arari_progress_html = "";
                                                    }


                            /************************************************************************************************************************************************************************************************************* */
                                // 最終ソース出力
                            /************************************************************************************************************************************************************************************************************* */

                                        // 【進捗率の取得】検索最終月の日数を取得
                           
                            
                                        // ジャック・N用HTMLの作成
                                                $js_jn_uriage  = "";
                                                $js_jn_number  = "";
                                                $js_jn_arari  = "";
                                                $temp4_jn_manthly_html = "";
                                                $temp4_jn_manthly_html2 = "";
                                                $temp4_jn_manthly_html3 = "";
                                                $progress_uriage_html = "";
                                                $progress_number_html = "";
                                                $progress_arari_html = "";
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_now_array as $val){
                                                                //$val = mb_substr($val,0,-3);
                                                                if(strpos($temp4_jn_manthly_data, $val ) !== false){
                                                                    $temp4_jn_manthly_data = str_replace($val, 0, $temp4_jn_manthly_data);
                                                                }
                                                                if(strpos($temp4_jn_manthly_data2, $val ) !== false){
                                                                    $temp4_jn_manthly_data2 = str_replace($val, 0, $temp4_jn_manthly_data2);
                                                                }
                                                                if(strpos($temp4_jn_manthly_data3, $val ) !== false){
                                                                    $temp4_jn_manthly_data3 = str_replace($val, 0, $temp4_jn_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $temp4_jn_manthly_array = explode(',',$temp4_jn_manthly_data);
                                                        $temp4_jn_manthly_array2 = explode(',',$temp4_jn_manthly_data2);
                                                        $temp4_jn_manthly_array3 = explode(',',$temp4_jn_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        $jn_last_uriage = "";
                                                        $i = 0;
                                                        foreach($temp4_jn_manthly_array as $val){
                                                            // 【進捗率の取得】最終月の「現在・自社・売上」を取得
                                                                //$jn_last_uriage = $val;

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_jn_uriage  .= "0, ";
                                                                // 表示用
                                                                    $temp4_jn_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_jn_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_jn_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }

                                                        $i = 0;
                                                        foreach($temp4_jn_manthly_array2 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_jn_number  .= "0, ";
                                                                // 表示用
                                                                    $temp4_jn_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_jn_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_jn_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp4_jn_manthly_array3 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_jn_arari  .= "0, ";
                                                                // 表示用
                                                                    $temp4_jn_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_jn_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_jn_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                            
                                                        // 全体HTMLの作成
                                                            // 金額
                                                            if(isset($temp4_jn_manthly_html) && isset($temp4_jn_sum)){
                                                                $temp4_jn_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>ジャック・N</div>" . $temp4_jn_manthly_html . $temp4_jn_sum;
                                                            }
                                                            // 本数
                                                            if(isset($temp4_jn_manthly_html2) && isset($temp4_jn_sum2)){
                                                                $temp4_jn_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>ジャック・N</div>" . $temp4_jn_manthly_html2 . $temp4_jn_sum2;
                                                            }
                                                            // 粗利
                                                            if(isset($temp4_jn_manthly_html3) && isset($temp4_jn_sum3)){
                                                                $temp4_jn_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>ジャック・N</div>" . $temp4_jn_manthly_html3 . $temp4_jn_sum3;
                                                            }

                            
                                        // ジャック・U用HTMLの作成
                                                $js_ju_uriage  = "";
                                                $js_ju_number  = "";
                                                $js_ju_arari  = "";
                                                $temp4_ju_manthly_html = "";
                                                $temp4_ju_manthly_html2 = "";
                                                $temp4_ju_manthly_html3 = "";
                                                $progress_uriage_html = "";
                                                $progress_number_html = "";
                                                $progress_arari_html = "";
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_now_array as $val){
                                                                //$val = mb_substr($val,0,-3);
                                                                if(strpos($temp4_ju_manthly_data, $val ) !== false){
                                                                    $temp4_ju_manthly_data = str_replace($val, 0, $temp4_ju_manthly_data);
                                                                }
                                                                if(strpos($temp4_ju_manthly_data2, $val ) !== false){
                                                                    $temp4_ju_manthly_data2 = str_replace($val, 0, $temp4_ju_manthly_data2);
                                                                }
                                                                if(strpos($temp4_ju_manthly_data3, $val ) !== false){
                                                                    $temp4_ju_manthly_data3 = str_replace($val, 0, $temp4_ju_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $temp4_ju_manthly_array = explode(',',$temp4_ju_manthly_data);
                                                        $temp4_ju_manthly_array2 = explode(',',$temp4_ju_manthly_data2);
                                                        $temp4_ju_manthly_array3 = explode(',',$temp4_ju_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        $ju_last_uriage = "";
                                                        $i = 0;
                                                        foreach($temp4_ju_manthly_array as $val){
                                                            // 【進捗率の取得】最終月の「現在・自社・売上」を取得
                                                                //$ju_last_uriage = $val;

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_ju_uriage  .= "0, ";
                                                                // 表示用
                                                                    $temp4_ju_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_ju_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_ju_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }

                                                        $i = 0;
                                                        foreach($temp4_ju_manthly_array2 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_ju_number  .= "0, ";
                                                                // 表示用
                                                                    $temp4_ju_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_ju_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_ju_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp4_ju_manthly_array3 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_ju_arari  .= "0, ";
                                                                // 表示用
                                                                    $temp4_ju_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_ju_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_ju_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                            
                                                        // 全体HTMLの作成
                                                            if(isset($temp4_ju_manthly_html) && isset($temp4_ju_sum)){
                                                                $temp4_ju_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>ジャック・U</div>" . $temp4_ju_manthly_html . $temp4_ju_sum;
                                                            }
                                                            if(isset($temp4_ju_manthly_html2) && isset($temp4_ju_sum2)){
                                                                $temp4_ju_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>ジャック・U</div>" . $temp4_ju_manthly_html2 . $temp4_ju_sum2;
                                                            }
                                                            if(isset($temp4_ju_manthly_html3) && isset($temp4_ju_sum3)){
                                                                $temp4_ju_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>ジャック・U</div>" . $temp4_ju_manthly_html3 . $temp4_ju_sum3;
                                                            }

                            
                                        // ジャック・A用HTMLの作成
                                                $js_ja_uriage  = "";
                                                $js_ja_number  = "";
                                                $js_ja_arari  = "";
                                                $temp4_ja_manthly_html = "";
                                                $temp4_ja_manthly_html2 = "";
                                                $temp4_ja_manthly_html3 = "";
                                                $progress_uriage_html = "";
                                                $progress_number_html = "";
                                                $progress_arari_html = "";
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_now_array as $val){
                                                                //$val = mb_substr($val,0,-3);
                                                                if(strpos($temp4_ja_manthly_data, $val ) !== false){
                                                                    $temp4_ja_manthly_data = str_replace($val, 0, $temp4_ja_manthly_data);
                                                                }
                                                                if(strpos($temp4_ja_manthly_data2, $val ) !== false){
                                                                    $temp4_ja_manthly_data2 = str_replace($val, 0, $temp4_ja_manthly_data2);
                                                                }
                                                                if(strpos($temp4_ja_manthly_data3, $val ) !== false){
                                                                    $temp4_ja_manthly_data3 = str_replace($val, 0, $temp4_ja_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $temp4_ja_manthly_array = explode(',',$temp4_ja_manthly_data);
                                                        $temp4_ja_manthly_array2 = explode(',',$temp4_ja_manthly_data2);
                                                        $temp4_ja_manthly_array3 = explode(',',$temp4_ja_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        $ja_last_uriage = "";
                                                        $i = 0;
                                                        foreach($temp4_ja_manthly_array as $val){
                                                            // 【進捗率の取得】最終月の「現在・自社・売上」を取得
                                                                //$ja_last_uriage = $val;

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_ja_uriage  .= "0, ";
                                                                // 表示用
                                                                    $temp4_ja_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_ja_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_ja_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }

                                                        $i = 0;
                                                        foreach($temp4_ja_manthly_array2 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_ja_number  .= "0, ";
                                                                // 表示用
                                                                    $temp4_ja_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_ja_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_ja_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp4_ja_manthly_array3 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_ja_arari  .= "0, ";
                                                                // 表示用
                                                                    $temp4_ja_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_ja_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_ja_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                            
                                                        // 全体HTMLの作成
                                                            if(isset($temp4_ja_manthly_html) && isset($temp4_ja_sum)){
                                                                $temp4_ja_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>ジャック・A</div>" . $temp4_ja_manthly_html . $temp4_ja_sum;
                                                            }
                                                            if(isset($temp4_ja_manthly_html2) && isset($temp4_ja_sum2)){
                                                                $temp4_ja_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>ジャック・A</div>" . $temp4_ja_manthly_html2 . $temp4_ja_sum2;
                                                            }
                                                            if(isset($temp4_ja_manthly_html3) && isset($temp4_ja_sum3)){
                                                                $temp4_ja_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>ジャック・A</div>" . $temp4_ja_manthly_html3 . $temp4_ja_sum3;
                                                            }


                            
                                        // ベティー・N用HTMLの作成
                                                $js_bn_uriage  = "";
                                                $js_bn_number  = "";
                                                $js_bn_arari  = "";
                                                $temp4_bn_manthly_html = "";
                                                $temp4_bn_manthly_html2 = "";
                                                $temp4_bn_manthly_html3 = "";
                                                $progress_uriage_html = "";
                                                $progress_number_html = "";
                                                $progress_arari_html = "";
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_now_array as $val){
                                                                //$val = mb_substr($val,0,-3);
                                                                if(strpos($temp4_bn_manthly_data, $val ) !== false){
                                                                    $temp4_bn_manthly_data = str_replace($val, 0, $temp4_bn_manthly_data);
                                                                }
                                                                if(strpos($temp4_bn_manthly_data2, $val ) !== false){
                                                                    $temp4_bn_manthly_data2 = str_replace($val, 0, $temp4_bn_manthly_data2);
                                                                }
                                                                if(strpos($temp4_bn_manthly_data3, $val ) !== false){
                                                                    $temp4_bn_manthly_data3 = str_replace($val, 0, $temp4_bn_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $temp4_bn_manthly_array = explode(',',$temp4_bn_manthly_data);
                                                        $temp4_bn_manthly_array2 = explode(',',$temp4_bn_manthly_data2);
                                                        $temp4_bn_manthly_array3 = explode(',',$temp4_bn_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        $bn_last_uriage = "";
                                                        $i = 0;
                                                        foreach($temp4_bn_manthly_array as $val){
                                                            // 【進捗率の取得】最終月の「現在・自社・売上」を取得
                                                                //$bn_last_uriage = $val;

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_bn_uriage  .= "0, ";
                                                                // 表示用
                                                                    $temp4_bn_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_bn_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_bn_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }

                                                        $i = 0;
                                                        foreach($temp4_bn_manthly_array2 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_bn_number  .= "0, ";
                                                                // 表示用
                                                                    $temp4_bn_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_bn_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_bn_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp4_bn_manthly_array3 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_bn_arari  .= "0, ";
                                                                // 表示用
                                                                    $temp4_bn_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_bn_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_bn_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                            
                                                        // 全体HTMLの作成
                                                            if(isset($temp4_bn_manthly_html) && isset($temp4_bn_sum)){
                                                                $temp4_bn_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>ベティー・N</div>" . $temp4_bn_manthly_html . $temp4_bn_sum;
                                                            }
                                                            if(isset($temp4_bn_manthly_html2) && isset($temp4_bn_sum2)){
                                                                $temp4_bn_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>ベティー・N</div>" . $temp4_bn_manthly_html2 . $temp4_bn_sum2;
                                                            }
                                                            if(isset($temp4_bn_manthly_html3) && isset($temp4_bn_sum3)){
                                                                $temp4_bn_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>ベティー・N</div>" . $temp4_bn_manthly_html3 . $temp4_bn_sum3;
                                                            }





                            
                                        // ベティー・U用HTMLの作成
                                                $js_bu_uriage  = "";
                                                $js_bu_number  = "";
                                                $js_bu_arari  = "";
                                                $temp4_bu_manthly_html = "";
                                                $temp4_bu_manthly_html2 = "";
                                                $temp4_bu_manthly_html3 = "";
                                                $progress_uriage_html = "";
                                                $progress_number_html = "";
                                                $progress_arari_html = "";
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_now_array as $val){
                                                                //$val = mb_substr($val,0,-3);
                                                                if(strpos($temp4_bu_manthly_data, $val ) !== false){
                                                                    $temp4_bu_manthly_data = str_replace($val, 0, $temp4_bu_manthly_data);
                                                                }
                                                                if(strpos($temp4_bu_manthly_data2, $val ) !== false){
                                                                    $temp4_bu_manthly_data2 = str_replace($val, 0, $temp4_bu_manthly_data2);
                                                                }
                                                                if(strpos($temp4_bu_manthly_data3, $val ) !== false){
                                                                    $temp4_bu_manthly_data3 = str_replace($val, 0, $temp4_bu_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $temp4_bu_manthly_array = explode(',',$temp4_bu_manthly_data);
                                                        $temp4_bu_manthly_array2 = explode(',',$temp4_bu_manthly_data2);
                                                        $temp4_bu_manthly_array3 = explode(',',$temp4_bu_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        $bu_last_uriage = "";
                                                        $i = 0;
                                                        foreach($temp4_bu_manthly_array as $val){
                                                            // 【進捗率の取得】最終月の「現在・自社・売上」を取得
                                                                //$bu_last_uriage = $val;

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_bu_uriage  .= "0, ";
                                                                // 表示用
                                                                    $temp4_bu_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_bu_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_bu_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }

                                                        $i = 0;
                                                        foreach($temp4_bu_manthly_array2 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_bu_number  .= "0, ";
                                                                // 表示用
                                                                    $temp4_bu_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_bu_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_bu_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp4_bu_manthly_array3 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_bu_arari  .= "0, ";
                                                                // 表示用
                                                                    $temp4_bu_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_bu_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_bu_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                            
                                                        // 全体HTMLの作成
                                                            if(isset($temp4_bu_manthly_html) && isset($temp4_bu_sum)){
                                                                $temp4_bu_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>ベティー・U</div>" . $temp4_bu_manthly_html . $temp4_bu_sum;
                                                            }
                                                            if(isset($temp4_bu_manthly_html2) && isset($temp4_bu_sum2)){
                                                                $temp4_bu_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>ベティー・U</div>" . $temp4_bu_manthly_html2 . $temp4_bu_sum2;
                                                            }
                                                            if(isset($temp4_bu_manthly_html3) && isset($temp4_bu_sum3)){
                                                                $temp4_bu_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>ベティー・U</div>" . $temp4_bu_manthly_html3 . $temp4_bu_sum3;
                                                            }


                            
                                        // ベティー・A用HTMLの作成
                                                $js_ba_uriage  = "";
                                                $js_ba_number  = "";
                                                $js_ba_arari  = "";
                                                $temp4_ba_manthly_html = "";
                                                $temp4_ba_manthly_html2 = "";
                                                $temp4_ba_manthly_html3 = "";
                                                $progress_uriage_html = "";
                                                $progress_number_html = "";
                                                $progress_arari_html = "";
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_now_array as $val){
                                                                //$val = mb_substr($val,0,-3);
                                                                if(strpos($temp4_ba_manthly_data, $val ) !== false){
                                                                    $temp4_ba_manthly_data = str_replace($val, 0, $temp4_ba_manthly_data);
                                                                }
                                                                if(strpos($temp4_ba_manthly_data2, $val ) !== false){
                                                                    $temp4_ba_manthly_data2 = str_replace($val, 0, $temp4_ba_manthly_data2);
                                                                }
                                                                if(strpos($temp4_ba_manthly_data3, $val ) !== false){
                                                                    $temp4_ba_manthly_data3 = str_replace($val, 0, $temp4_ba_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $temp4_ba_manthly_array = explode(',',$temp4_ba_manthly_data);
                                                        $temp4_ba_manthly_array2 = explode(',',$temp4_ba_manthly_data2);
                                                        $temp4_ba_manthly_array3 = explode(',',$temp4_ba_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        $ba_last_uriage = "";
                                                        $i = 0;
                                                        foreach($temp4_ba_manthly_array as $val){
                                                            // 【進捗率の取得】最終月の「現在・自社・売上」を取得
                                                                //$ba_last_uriage = $val;

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_ba_uriage  .= "0, ";
                                                                // 表示用
                                                                    $temp4_ba_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_ba_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_ba_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }

                                                        $i = 0;
                                                        foreach($temp4_ba_manthly_array2 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_ba_number  .= "0, ";
                                                                // 表示用
                                                                    $temp4_ba_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_ba_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_ba_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp4_ba_manthly_array3 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_ba_arari  .= "0, ";
                                                                // 表示用
                                                                    $temp4_ba_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_ba_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_ba_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                            
                                                        // 全体HTMLの作成
                                                            if(isset($temp4_ba_manthly_html) && isset($temp4_ba_sum)){
                                                                $temp4_ba_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>ベティー・A</div>" . $temp4_ba_manthly_html . $temp4_ba_sum;
                                                            }
                                                            if(isset($temp4_ba_manthly_html2) && isset($temp4_ba_sum2)){
                                                                $temp4_ba_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>ベティー・A</div>" . $temp4_ba_manthly_html2 . $temp4_ba_sum2;
                                                            }
                                                            if(isset($temp4_ba_manthly_html3) && isset($temp4_ba_sum3)){
                                                                $temp4_ba_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>ベティー・A</div>" . $temp4_ba_manthly_html3 . $temp4_ba_sum3;
                                                            }


                            
                                        // ジュエリー・N用HTMLの作成
                                                $js_jln_uriage  = "";
                                                $js_jln_number  = "";
                                                $js_jln_arari  = "";
                                                $temp4_jln_manthly_html = "";
                                                $temp4_jln_manthly_html2 = "";
                                                $temp4_jln_manthly_html3 = "";
                                                $progress_uriage_html = "";
                                                $progress_number_html = "";
                                                $progress_arari_html = "";
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_now_array as $val){
                                                                //$val = mb_substr($val,0,-3);
                                                                if(strpos($temp4_jln_manthly_data, $val ) !== false){
                                                                    $temp4_jln_manthly_data = str_replace($val, 0, $temp4_jln_manthly_data);
                                                                }
                                                                if(strpos($temp4_jln_manthly_data2, $val ) !== false){
                                                                    $temp4_jln_manthly_data2 = str_replace($val, 0, $temp4_jln_manthly_data2);
                                                                }
                                                                if(strpos($temp4_jln_manthly_data3, $val ) !== false){
                                                                    $temp4_jln_manthly_data3 = str_replace($val, 0, $temp4_jln_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $temp4_jln_manthly_array = explode(',',$temp4_jln_manthly_data);
                                                        $temp4_jln_manthly_array2 = explode(',',$temp4_jln_manthly_data2);
                                                        $temp4_jln_manthly_array3 = explode(',',$temp4_jln_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        $jln_last_uriage = "";
                                                        $i = 0;
                                                        foreach($temp4_jln_manthly_array as $val){
                                                            // 【進捗率の取得】最終月の「現在・自社・売上」を取得
                                                                //$jln_last_uriage = $val;

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_jln_uriage  .= "0, ";
                                                                // 表示用
                                                                    $temp4_jln_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_jln_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_jln_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }

                                                        $i = 0;
                                                        foreach($temp4_jln_manthly_array2 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_jln_number  .= "0, ";
                                                                // 表示用
                                                                    $temp4_jln_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_jln_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_jln_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp4_jln_manthly_array3 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_jln_arari  .= "0, ";
                                                                // 表示用
                                                                    $temp4_jln_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_jln_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_jln_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                            
                                                        // 全体HTMLの作成
                                                            if(isset($temp4_jln_manthly_html) && isset($temp4_jln_sum)){
                                                                $temp4_jln_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>ジュエリー・N</div>" . $temp4_jln_manthly_html . $temp4_jln_sum;
                                                            }
                                                            if(isset($temp4_jln_manthly_html2) && isset($temp4_jln_sum2)){
                                                                $temp4_jln_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>ジュエリー・N</div>" . $temp4_jln_manthly_html2 . $temp4_jln_sum2;
                                                            }
                                                            if(isset($temp4_jln_manthly_html3) && isset($temp4_jln_sum3)){
                                                                $temp4_jln_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>ジュエリー・N</div>" . $temp4_jln_manthly_html3 . $temp4_jln_sum3;
                                                            }


                            
                                        // ジュエリー・U用HTMLの作成
                                                $js_jlu_uriage  = "";
                                                $js_jlu_number  = "";
                                                $js_jlu_arari  = "";
                                                $temp4_jlu_manthly_html = "";
                                                $temp4_jlu_manthly_html2 = "";
                                                $temp4_jlu_manthly_html3 = "";
                                                $progress_uriage_html = "";
                                                $progress_number_html = "";
                                                $progress_arari_html = "";
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_now_array as $val){
                                                                //$val = mb_substr($val,0,-3);
                                                                if(strpos($temp4_jlu_manthly_data, $val ) !== false){
                                                                    $temp4_jlu_manthly_data = str_replace($val, 0, $temp4_jlu_manthly_data);
                                                                }
                                                                if(strpos($temp4_jlu_manthly_data2, $val ) !== false){
                                                                    $temp4_jlu_manthly_data2 = str_replace($val, 0, $temp4_jlu_manthly_data2);
                                                                }
                                                                if(strpos($temp4_jlu_manthly_data3, $val ) !== false){
                                                                    $temp4_jlu_manthly_data3 = str_replace($val, 0, $temp4_jlu_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $temp4_jlu_manthly_array = explode(',',$temp4_jlu_manthly_data);
                                                        $temp4_jlu_manthly_array2 = explode(',',$temp4_jlu_manthly_data2);
                                                        $temp4_jlu_manthly_array3 = explode(',',$temp4_jlu_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        $jlu_last_uriage = "";
                                                        $i = 0;
                                                        foreach($temp4_jlu_manthly_array as $val){
                                                            // 【進捗率の取得】最終月の「現在・自社・売上」を取得
                                                                //$jlu_last_uriage = $val;

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_jlu_uriage  .= "0, ";
                                                                // 表示用
                                                                    $temp4_jlu_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_jlu_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_jlu_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }

                                                        $i = 0;
                                                        foreach($temp4_jlu_manthly_array2 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_jlu_number  .= "0, ";
                                                                // 表示用
                                                                    $temp4_jlu_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_jlu_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_jlu_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp4_jlu_manthly_array3 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_jlu_arari  .= "0, ";
                                                                // 表示用
                                                                    $temp4_jlu_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_jlu_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_jlu_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                            
                                                        // 全体HTMLの作成
                                                            if(isset($temp4_jlu_manthly_html) && isset($temp4_jlu_sum)){
                                                                $temp4_jlu_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>ジュエリー・U</div>" . $temp4_jlu_manthly_html . $temp4_jlu_sum;
                                                            }
                                                            if(isset($temp4_jlu_manthly_html2) && isset($temp4_jlu_sum2)){
                                                                $temp4_jlu_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>ジュエリー・U</div>" . $temp4_jlu_manthly_html2 . $temp4_jlu_sum2;
                                                            }
                                                            if(isset($temp4_jlu_manthly_html3) && isset($temp4_jlu_sum3)){
                                                                $temp4_jlu_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>ジュエリー・U</div>" . $temp4_jlu_manthly_html3 . $temp4_jlu_sum3;
                                                            }


                            
                                        // バッグ・N用HTMLの作成
                                                $js_bgn_uriage  = "";
                                                $js_bgn_number  = "";
                                                $js_bgn_arari  = "";
                                                $temp4_bgn_manthly_html = "";
                                                $temp4_bgn_manthly_html2 = "";
                                                $temp4_bgn_manthly_html3 = "";
                                                $progress_uriage_html = "";
                                                $progress_number_html = "";
                                                $progress_arari_html = "";
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_now_array as $val){
                                                                //$val = mb_substr($val,0,-3);
                                                                if(strpos($temp4_bgn_manthly_data, $val ) !== false){
                                                                    $temp4_bgn_manthly_data = str_replace($val, 0, $temp4_bgn_manthly_data);
                                                                }
                                                                if(strpos($temp4_bgn_manthly_data2, $val ) !== false){
                                                                    $temp4_bgn_manthly_data2 = str_replace($val, 0, $temp4_bgn_manthly_data2);
                                                                }
                                                                if(strpos($temp4_bgn_manthly_data3, $val ) !== false){
                                                                    $temp4_bgn_manthly_data3 = str_replace($val, 0, $temp4_bgn_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $temp4_bgn_manthly_array = explode(',',$temp4_bgn_manthly_data);
                                                        $temp4_bgn_manthly_array2 = explode(',',$temp4_bgn_manthly_data2);
                                                        $temp4_bgn_manthly_array3 = explode(',',$temp4_bgn_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        $bgn_last_uriage = "";
                                                        $i = 0;
                                                        foreach($temp4_bgn_manthly_array as $val){
                                                            // 【進捗率の取得】最終月の「現在・自社・売上」を取得
                                                                //$bgn_last_uriage = $val;

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_bgn_uriage  .= "0, ";
                                                                // 表示用
                                                                    $temp4_bgn_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_bgn_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_bgn_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }

                                                        $i = 0;
                                                        foreach($temp4_bgn_manthly_array2 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_bgn_number  .= "0, ";
                                                                // 表示用
                                                                    $temp4_bgn_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_bgn_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_bgn_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp4_bgn_manthly_array3 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_bgn_arari  .= "0, ";
                                                                // 表示用
                                                                    $temp4_bgn_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_bgn_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_bgn_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                            
                                                        // 全体HTMLの作成
                                                            if(isset($temp4_bgn_manthly_html) && isset($temp4_bgn_sum)){
                                                                $temp4_bgn_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>バッグ・N</div>" . $temp4_bgn_manthly_html . $temp4_bgn_sum;
                                                            }
                                                            if(isset($temp4_bgn_manthly_html2) && isset($temp4_bgn_sum2)){
                                                                $temp4_bgn_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>バッグ・N</div>" . $temp4_bgn_manthly_html2 . $temp4_bgn_sum2;
                                                            }
                                                            if(isset($temp4_bgn_manthly_html3) && isset($temp4_bgn_sum3)){
                                                                $temp4_bgn_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>バッグ・N</div>" . $temp4_bgn_manthly_html3 . $temp4_bgn_sum3;
                                                            }


                            
                                        // バッグ・U用HTMLの作成
                                                $js_bgu_uriage  = "";
                                                $js_bgu_number  = "";
                                                $js_bgu_arari  = "";
                                                $temp4_bgu_manthly_html = "";
                                                $temp4_bgu_manthly_html2 = "";
                                                $temp4_bgu_manthly_html3 = "";
                                                $progress_uriage_html = "";
                                                $progress_number_html = "";
                                                $progress_arari_html = "";
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_now_array as $val){
                                                                //$val = mb_substr($val,0,-3);
                                                                if(strpos($temp4_bgu_manthly_data, $val ) !== false){
                                                                    $temp4_bgu_manthly_data = str_replace($val, 0, $temp4_bgu_manthly_data);
                                                                }
                                                                if(strpos($temp4_bgu_manthly_data2, $val ) !== false){
                                                                    $temp4_bgu_manthly_data2 = str_replace($val, 0, $temp4_bgu_manthly_data2);
                                                                }
                                                                if(strpos($temp4_bgu_manthly_data3, $val ) !== false){
                                                                    $temp4_bgu_manthly_data3 = str_replace($val, 0, $temp4_bgu_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $temp4_bgu_manthly_array = explode(',',$temp4_bgu_manthly_data);
                                                        $temp4_bgu_manthly_array2 = explode(',',$temp4_bgu_manthly_data2);
                                                        $temp4_bgu_manthly_array3 = explode(',',$temp4_bgu_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        $bgu_last_uriage = "";
                                                        $i = 0;
                                                        foreach($temp4_bgu_manthly_array as $val){
                                                            // 【進捗率の取得】最終月の「現在・自社・売上」を取得
                                                                //$bgu_last_uriage = $val;

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_bgu_uriage  .= "0, ";
                                                                // 表示用
                                                                    $temp4_bgu_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_bgu_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_bgu_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }

                                                        $i = 0;
                                                        foreach($temp4_bgu_manthly_array2 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_bgu_number  .= "0, ";
                                                                // 表示用
                                                                    $temp4_bgu_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_bgu_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_bgu_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp4_bgu_manthly_array3 as $val){
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_bgu_arari  .= "0, ";
                                                                // 表示用
                                                                    $temp4_bgu_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_bgu_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp4_bgu_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                            
                                                        // 全体HTMLの作成
                                                            if(isset($temp4_bgu_manthly_html) && isset($temp4_bgu_sum)){
                                                                $temp4_bgu_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>バッグ・U</div>" . $temp4_bgu_manthly_html . $temp4_bgu_sum;
                                                            }
                                                            if(isset($temp4_bgu_manthly_html2) && isset($temp4_bgu_sum2)){
                                                                $temp4_bgu_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>バッグ・U</div>" . $temp4_bgu_manthly_html2 . $temp4_bgu_sum2;
                                                            }
                                                            if(isset($temp4_bgu_manthly_html3) && isset($temp4_bgu_sum3)){
                                                                $temp4_bgu_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>バッグ・U</div>" . $temp4_bgu_manthly_html3 . $temp4_bgu_sum3;
                                                            }



                                        // 各月の全部門売上合計のJS表示用
                                                $js_all_month_uriage = "";
                                                $js_all_month_number = "";
                                                $js_all_month_arari = "";
                                                $i = 0;
                                                foreach($manth_now_array as $val){
                                                    $all_js = 0;
                                                    $all_js2 = 0;
                                                    $all_js3 = 0;
                                                    $all_js = (int)$all_js + (int)$temp4_jn_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$temp4_jn_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$temp4_jn_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$temp4_ju_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$temp4_ju_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$temp4_ju_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$temp4_ja_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$temp4_ja_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$temp4_ja_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$temp4_bn_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$temp4_bn_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$temp4_bn_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$temp4_bu_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$temp4_bu_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$temp4_bu_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$temp4_ba_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$temp4_ba_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$temp4_ba_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$temp4_jln_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$temp4_jln_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$temp4_jln_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$temp4_jlu_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$temp4_jlu_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$temp4_jlu_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$temp4_bgn_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$temp4_bgn_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$temp4_bgn_manthly_array3[$i];
                                                    $all_js = (int)$all_js + (int)$temp4_bgu_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$temp4_bgu_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$temp4_bgu_manthly_array3[$i];

                                                    $js_all_month_uriage .= $all_js . ", ";
                                                    $js_all_month_number .= $all_js2 . ", ";
                                                    $js_all_month_arari .= $all_js3 . ", ";
                                                    
                                                    $i++;
                                                }



                /************************************************************************************************************************************************************************************************************* */
                    // 現在・粗利率
                /************************************************************************************************************************************************************************************************************* */



                                        // 現在・Jack・新品・粗利率

                                                $i = 0;
                                                $jn_ratio = "";
                                                $jn_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>ジャック・N</div>";
                                                $jn_total = "";
                                                $jn_total_js = "";
                                                $all_total = "";
                                                $jn_total_ratio = "";
                                                $jn_ratio_cutting = "";
                                                $jn_ratio_cutting_ave = "";
                                                $jn_ratio_cutting_html = "";
                                                foreach($temp4_jn_manthly_array3 as $var){
                                                    if($var == 0){
                                                        $jn_ratio = "---";
                                                        $jn_total = $jn_total;
                                                        if($temp4_jn_manthly_array[$i] == 0){
                                                            $all_total = $all_total;
                                                        } else {
                                                            $all_total = (int)$all_total + (int)$temp4_jn_manthly_array[$i];
                                                        }
                                                    } else {
                                                        $jn_ratio = number_format((floor(($var / $temp4_jn_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                        $jn_total = (int)$jn_total + (int)$var;
                                                        if($temp4_jn_manthly_array[$i] == 0){
                                                            $all_total = $all_total;
                                                        } else {
                                                            $all_total = (int)$all_total + (int)$temp4_jn_manthly_array[$i];
                                                        }
                                                    }
                                                    $jn_total_js  .= (float)$jn_ratio . ", ";
                                                    $jn_sum_arari_per .= "<div class='title6 ta_r'>" . $jn_ratio . "%</div>";

                                                    // 粗利率の過去比
                                                        if($jn_ratio <> "" && $jn_ratio <> "---" && ${"past_jn_ratio_" .$i} <> "" && ${"past_jn_ratio_" .$i} <> "---"){
                                                            $jn_ratio_cutting = (float)$jn_ratio - (float)${"past_jn_ratio_" .$i};
                                                            $jn_ratio_cutting = number_format($jn_ratio_cutting, 1);
                                                            // Jack・新品・全期間合計
                                                                $jn_ratio_cutting_ave = (float)$jn_ratio_cutting_ave + (float)$jn_ratio_cutting;
                                                            
                                                        }
                                                        if($jn_ratio_cutting < 0){
                                                            $jn_ratio_cutting_html .= "<div class='title7 ta_r fc_blue'>" . $jn_ratio_cutting . "%</div>";
                                                        } else {
                                                            $jn_ratio_cutting_html .= "<div class='title7 ta_r fc_red'>" . $jn_ratio_cutting . "%</div>";
                                                        }
                                                
                                                    $i++;
                                                }
                                                // Jack・新品・全期間合計の平均
                                                    $jn_ratio_cutting_ave = number_format((float)$jn_ratio_cutting_ave / $i, 2);
                                                // 粗利率の過去比(トータル値追加)
                                                    //$jn_ratio_cutting_ave_html = "<div class='title7 ta_r'>" . (float)$jn_ratio_cutting_ave . "</div>";
                                                    if($jn_ratio_cutting_ave < 0){
                                                        $jn_ratio_cutting_ave_html = "<div class='title7 ta_r fc_blue'>" . $jn_ratio_cutting_ave . "%</div>";
                                                    } else {
                                                        $jn_ratio_cutting_ave_html = "<div class='title7 ta_r fc_red'>" . $jn_ratio_cutting_ave . "%</div>";
                                                    }
                                                    $jn_ratio_cutting_html = $jn_ratio_cutting_html . $jn_ratio_cutting_ave_html;
                                                    
                                                // 現在・Jack・新品用粗利率を取得
                                                    if($jn_total <> 0 && $all_total <> 0 && $jn_total <> "" && $all_total <> ""){
                                                        $jn_total_ratio = number_format((floor(((float)$jn_total / (float)$all_total) * 100 * 10)) / 10 ,1);
                                                    } else {
                                                        $jn_total_ratio = "---";
                                                    }

                                                    $jn_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $jn_total_ratio . "%</div></div>";



                                        // 現在・Jack・中古・粗利率

                                                $i = 0;
                                                $ju_ratio = "";
                                                $ju_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>ジャック・U</div>";
                                                $ju_total = "";
                                                $ju_total_js = "";
                                                $all_total = "";
                                                $ju_total_ratio = "";
                                                $ju_ratio_cutting = "";
                                                $ju_ratio_cutting_ave = "";
                                                $ju_ratio_cutting_html = "";
                                                foreach($temp4_ju_manthly_array3 as $var){
                                                    if($var == 0){
                                                        $ju_ratio = "---";
                                                        $ju_total = $ju_total;
                                                        if($temp4_ju_manthly_array[$i] == 0){
                                                            $all_total = $all_total;
                                                        } else {
                                                            $all_total = (int)$all_total + (int)$temp4_ju_manthly_array[$i];
                                                        }
                                                    } else {
                                                        $ju_ratio = number_format((floor(($var / $temp4_ju_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                        $ju_total = (int)$ju_total + (int)$var;
                                                        if($temp4_ju_manthly_array[$i] == 0){
                                                            $all_total = $all_total;
                                                        } else {
                                                            $all_total = (int)$all_total + (int)$temp4_ju_manthly_array[$i];
                                                        }
                                                    }
                                                    $ju_total_js  .= (float)$ju_ratio . ", ";
                                                    $ju_sum_arari_per .= "<div class='title6 ta_r'>" . $ju_ratio . "%</div>";

                                                    // 粗利率の過去比
                                                        if($ju_ratio <> "" && $ju_ratio <> "---" && ${"past_ju_ratio_" .$i} <> "" && ${"past_ju_ratio_" .$i} <> "---"){
                                                            $ju_ratio_cutting = (float)$ju_ratio - (float)${"past_ju_ratio_" .$i};
                                                            $ju_ratio_cutting = number_format($ju_ratio_cutting, 1);
                                                            // Jack・中古・全期間合計
                                                                $ju_ratio_cutting_ave = (float)$ju_ratio_cutting_ave + (float)$ju_ratio_cutting;
                                                            
                                                        }
                                                        if($ju_ratio_cutting < 0){
                                                            $ju_ratio_cutting_html .= "<div class='title7 ta_r fc_blue'>" . $ju_ratio_cutting . "%</div>";
                                                        } else {
                                                            $ju_ratio_cutting_html .= "<div class='title7 ta_r fc_red'>" . $ju_ratio_cutting . "%</div>";
                                                        }
                                                
                                                    $i++;
                                                }
                                                // Jack・中古・全期間合計の平均
                                                    $ju_ratio_cutting_ave = number_format((float)$ju_ratio_cutting_ave / $i, 2);
                                                // 粗利率の過去比(トータル値追加)
                                                    //$ju_ratio_cutting_ave_html = "<div class='title7 ta_r'>" . (float)$ju_ratio_cutting_ave . "</div>";
                                                    if($ju_ratio_cutting_ave < 0){
                                                        $ju_ratio_cutting_ave_html = "<div class='title7 ta_r fc_blue'>" . $ju_ratio_cutting_ave . "%</div>";
                                                    } else {
                                                        $ju_ratio_cutting_ave_html = "<div class='title7 ta_r fc_red'>" . $ju_ratio_cutting_ave . "%</div>";
                                                    }
                                                    $ju_ratio_cutting_html = $ju_ratio_cutting_html . $ju_ratio_cutting_ave_html;
                                                    
                                                // 現在・Jack・中古用粗利率を取得
                                                    if($ju_total <> 0 && $all_total <> 0 && $ju_total <> "" && $all_total <> ""){
                                                        $ju_total_ratio = number_format((floor(((float)$ju_total / (float)$all_total) * 100 * 10)) / 10 ,1);
                                                    } else {
                                                        $ju_total_ratio = "---";
                                                    }

                                                    $ju_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $ju_total_ratio . "%</div></div>";


                                        // 現在・Jack・アンティーク・粗利率

                                                $i = 0;
                                                $ja_ratio = "";
                                                $ja_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>ジャック・A</div>";
                                                $ja_total = "";
                                                $ja_total_js = "";
                                                $all_total = "";
                                                $ja_total_ratio = "";
                                                $ja_ratio_cutting = "";
                                                $ja_ratio_cutting_ave = "";
                                                $ja_ratio_cutting_html = "";
                                                foreach($temp4_ja_manthly_array3 as $var){
                                                    if($var == 0){
                                                        $ja_ratio = "---";
                                                        $ja_total = $ja_total;
                                                        if($temp4_ja_manthly_array[$i] == 0){
                                                            $all_total = $all_total;
                                                        } else {
                                                            $all_total = (int)$all_total + (int)$temp4_ja_manthly_array[$i];
                                                        }
                                                    } else {
                                                        $ja_ratio = number_format((floor(($var / $temp4_ja_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                        $ja_total = (int)$ja_total + (int)$var;
                                                        if($temp4_ja_manthly_array[$i] == 0){
                                                            $all_total = $all_total;
                                                        } else {
                                                            $all_total = (int)$all_total + (int)$temp4_ja_manthly_array[$i];
                                                        }
                                                    }
                                                    $ja_total_js  .= (float)$ja_ratio . ", ";
                                                    $ja_sum_arari_per .= "<div class='title6 ta_r'>" . $ja_ratio . "%</div>";

                                                    // 粗利率の過去比
                                                        if($ja_ratio <> "" && $ja_ratio <> "---" && ${"past_ja_ratio_" .$i} <> "" && ${"past_ja_ratio_" .$i} <> "---"){
                                                            $ja_ratio_cutting = (float)$ja_ratio - (float)${"past_ja_ratio_" .$i};
                                                            $ja_ratio_cutting = number_format($ja_ratio_cutting, 1);
                                                            // Jack・アンティーク・全期間合計
                                                                $ja_ratio_cutting_ave = (float)$ja_ratio_cutting_ave + (float)$ja_ratio_cutting;
                                                            
                                                        }
                                                        if($ja_ratio_cutting < 0){
                                                            $ja_ratio_cutting_html .= "<div class='title7 ta_r fc_blue'>" . $ja_ratio_cutting . "%</div>";
                                                        } else {
                                                            $ja_ratio_cutting_html .= "<div class='title7 ta_r fc_red'>" . $ja_ratio_cutting . "%</div>";
                                                        }
                                                
                                                    $i++;
                                                }
                                                // Jack・アンティーク・全期間合計の平均
                                                    $ja_ratio_cutting_ave = number_format((float)$ja_ratio_cutting_ave / $i, 2);
                                                // 粗利率の過去比(トータル値追加)
                                                    //$ja_ratio_cutting_ave_html = "<div class='title7 ta_r'>" . (float)$ja_ratio_cutting_ave . "</div>";
                                                    if($ja_ratio_cutting_ave < 0){
                                                        $ja_ratio_cutting_ave_html = "<div class='title7 ta_r fc_blue'>" . $ja_ratio_cutting_ave . "%</div>";
                                                    } else {
                                                        $ja_ratio_cutting_ave_html = "<div class='title7 ta_r fc_red'>" . $ja_ratio_cutting_ave . "%</div>";
                                                    }
                                                    $ja_ratio_cutting_html = $ja_ratio_cutting_html . $ja_ratio_cutting_ave_html;
                                                    
                                                // 現在・Jack・アンティーク用粗利率を取得
                                                    if($ja_total <> 0 && $all_total <> 0 && $ja_total <> "" && $all_total <> ""){
                                                        $ja_total_ratio = number_format((floor(((float)$ja_total / (float)$all_total) * 100 * 10)) / 10 ,1);
                                                    } else {
                                                        $ja_total_ratio = "---";
                                                    }

                                                    $ja_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $ja_total_ratio . "%</div></div>";



                                        // 現在・Betty・新品・粗利率

                                                $i = 0;
                                                $bn_ratio = "";
                                                $bn_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>ベティー・N</div>";
                                                $bn_total = "";
                                                $bn_total_js = "";
                                                $all_total = "";
                                                $bn_total_ratio = "";
                                                $bn_ratio_cutting = "";
                                                $bn_ratio_cutting_ave = "";
                                                $bn_ratio_cutting_html = "";
                                                foreach($temp4_bn_manthly_array3 as $var){
                                                    if($var == 0){
                                                        $bn_ratio = "---";
                                                        $bn_total = $bn_total;
                                                        if($temp4_bn_manthly_array[$i] == 0){
                                                            $all_total = $all_total;
                                                        } else {
                                                            $all_total = (int)$all_total + (int)$temp4_bn_manthly_array[$i];
                                                        }
                                                    } else {
                                                        $bn_ratio = number_format((floor(($var / $temp4_bn_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                        $bn_total = (int)$bn_total + (int)$var;
                                                        if($temp4_bn_manthly_array[$i] == 0){
                                                            $all_total = $all_total;
                                                        } else {
                                                            $all_total = (int)$all_total + (int)$temp4_bn_manthly_array[$i];
                                                        }
                                                    }
                                                    $bn_total_js  .= (float)$bn_ratio . ", ";
                                                    $bn_sum_arari_per .= "<div class='title6 ta_r'>" . $bn_ratio . "%</div>";

                                                    // 粗利率の過去比
                                                        if($bn_ratio <> "" && $bn_ratio <> "---" && ${"past_bn_ratio_" .$i} <> "" && ${"past_bn_ratio_" .$i} <> "---"){
                                                            $bn_ratio_cutting = (float)$bn_ratio - (float)${"past_bn_ratio_" .$i};
                                                            $bn_ratio_cutting = number_format($bn_ratio_cutting, 1);
                                                            // Betty・新品・全期間合計
                                                                $bn_ratio_cutting_ave = (float)$bn_ratio_cutting_ave + (float)$bn_ratio_cutting;
                                                            
                                                        }
                                                        if($bn_ratio_cutting < 0){
                                                            $bn_ratio_cutting_html .= "<div class='title7 ta_r fc_blue'>" . $bn_ratio_cutting . "%</div>";
                                                        } else {
                                                            $bn_ratio_cutting_html .= "<div class='title7 ta_r fc_red'>" . $bn_ratio_cutting . "%</div>";
                                                        }
                                                
                                                    $i++;
                                                }
                                                // Betty・新品・全期間合計の平均
                                                    $bn_ratio_cutting_ave = number_format((float)$bn_ratio_cutting_ave / $i, 2);
                                                // 粗利率の過去比(トータル値追加)
                                                    //$bn_ratio_cutting_ave_html = "<div class='title7 ta_r'>" . (float)$bn_ratio_cutting_ave . "</div>";
                                                    if($bn_ratio_cutting_ave < 0){
                                                        $bn_ratio_cutting_ave_html = "<div class='title7 ta_r fc_blue'>" . $bn_ratio_cutting_ave . "%</div>";
                                                    } else {
                                                        $bn_ratio_cutting_ave_html = "<div class='title7 ta_r fc_red'>" . $bn_ratio_cutting_ave . "%</div>";
                                                    }
                                                    $bn_ratio_cutting_html = $bn_ratio_cutting_html . $bn_ratio_cutting_ave_html;
                                                    
                                                // 現在・Betty・新品用粗利率を取得
                                                    if($bn_total <> 0 && $all_total <> 0 && $bn_total <> "" && $all_total <> ""){
                                                        $bn_total_ratio = number_format((floor(((float)$bn_total / (float)$all_total) * 100 * 10)) / 10 ,1);
                                                    } else {
                                                        $bn_total_ratio = "---";
                                                    }

                                                    $bn_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $bn_total_ratio . "%</div></div>";


                                        // 現在・Betty・中古・粗利率

                                                $i = 0;
                                                $bu_ratio = "";
                                                $bu_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>ベティー・U</div>";
                                                $bu_total = "";
                                                $bu_total_js = "";
                                                $all_total = "";
                                                $bu_total_ratio = "";
                                                $bu_ratio_cutting = "";
                                                $bu_ratio_cutting_ave = "";
                                                $bu_ratio_cutting_html = "";
                                                foreach($temp4_bu_manthly_array3 as $var){
                                                    if($var == 0){
                                                        $bu_ratio = "---";
                                                        $bu_total = $bu_total;
                                                        if($temp4_bu_manthly_array[$i] == 0){
                                                            $all_total = $all_total;
                                                        } else {
                                                            $all_total = (int)$all_total + (int)$temp4_bu_manthly_array[$i];
                                                        }
                                                    } else {
                                                        $bu_ratio = number_format((floor(($var / $temp4_bu_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                        $bu_total = (int)$bu_total + (int)$var;
                                                        if($temp4_bu_manthly_array[$i] == 0){
                                                            $all_total = $all_total;
                                                        } else {
                                                            $all_total = (int)$all_total + (int)$temp4_bu_manthly_array[$i];
                                                        }
                                                    }
                                                    $bu_total_js  .= (float)$bu_ratio . ", ";
                                                    $bu_sum_arari_per .= "<div class='title6 ta_r'>" . $bu_ratio . "%</div>";

                                                    // 粗利率の過去比
                                                        if($bu_ratio <> "" && $bu_ratio <> "---" && ${"past_bu_ratio_" .$i} <> "" && ${"past_bu_ratio_" .$i} <> "---"){
                                                            $bu_ratio_cutting = (float)$bu_ratio - (float)${"past_bu_ratio_" .$i};
                                                            $bu_ratio_cutting = number_format($bu_ratio_cutting, 1);
                                                            // Betty・中古・全期間合計
                                                                $bu_ratio_cutting_ave = (float)$bu_ratio_cutting_ave + (float)$bu_ratio_cutting;
                                                            
                                                        }
                                                        if($bu_ratio_cutting < 0){
                                                            $bu_ratio_cutting_html .= "<div class='title7 ta_r fc_blue'>" . $bu_ratio_cutting . "%</div>";
                                                        } else {
                                                            $bu_ratio_cutting_html .= "<div class='title7 ta_r fc_red'>" . $bu_ratio_cutting . "%</div>";
                                                        }
                                                
                                                    $i++;
                                                }
                                                // Betty・中古・全期間合計の平均
                                                    $bu_ratio_cutting_ave = number_format((float)$bu_ratio_cutting_ave / $i, 2);
                                                // 粗利率の過去比(トータル値追加)
                                                    //$bu_ratio_cutting_ave_html = "<div class='title7 ta_r'>" . (float)$bu_ratio_cutting_ave . "</div>";
                                                    if($bu_ratio_cutting_ave < 0){
                                                        $bu_ratio_cutting_ave_html = "<div class='title7 ta_r fc_blue'>" . $bu_ratio_cutting_ave . "%</div>";
                                                    } else {
                                                        $bu_ratio_cutting_ave_html = "<div class='title7 ta_r fc_red'>" . $bu_ratio_cutting_ave . "%</div>";
                                                    }
                                                    $bu_ratio_cutting_html = $bu_ratio_cutting_html . $bu_ratio_cutting_ave_html;
                                                    
                                                // 現在・Betty・中古用粗利率を取得
                                                    if($bu_total <> 0 && $all_total <> 0 && $bu_total <> "" && $all_total <> ""){
                                                        $bu_total_ratio = number_format((floor(((float)$bu_total / (float)$all_total) * 100 * 10)) / 10 ,1);
                                                    } else {
                                                        $bu_total_ratio = "---";
                                                    }

                                                    $bu_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $bu_total_ratio . "%</div></div>";



                                        // 現在・Betty・アンティーク・粗利率

                                                $i = 0;
                                                $ba_ratio = "";
                                                $ba_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>ベティー・A</div>";
                                                $ba_total = "";
                                                $ba_total_js = "";
                                                $all_total = "";
                                                $ba_total_ratio = "";
                                                $ba_ratio_cutting = "";
                                                $ba_ratio_cutting_ave = "";
                                                $ba_ratio_cutting_html = "";
                                                foreach($temp4_ba_manthly_array3 as $var){
                                                    if($var == 0){
                                                        $ba_ratio = "---";
                                                        $ba_total = $ba_total;
                                                        if($temp4_ba_manthly_array[$i] == 0){
                                                            $all_total = $all_total;
                                                        } else {
                                                            $all_total = (int)$all_total + (int)$temp4_ba_manthly_array[$i];
                                                        }
                                                    } else {
                                                        if(isset($temp4_ba_manthly_array[$i])){
                                                            $ba_ratio = number_format((floor(($var / $temp4_ba_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                            $ba_total = (int)$ba_total + (int)$var;
                                                            if($temp4_ba_manthly_array[$i] == 0){
                                                                $all_total = $all_total;
                                                            } else {
                                                                $all_total = (int)$all_total + (int)$temp4_ba_manthly_array[$i];
                                                            }
                                                        } else {
                                                            $all_total = 0;
                                                        }
                                                    }
                                                    $ba_total_js  .= (float)$ba_ratio . ", ";
                                                    $ba_sum_arari_per .= "<div class='title6 ta_r'>" . $ba_ratio . "%</div>";

                                                    // 粗利率の過去比
                                                        if($ba_ratio <> "" && $ba_ratio <> "---" && ${"past_ba_ratio_" .$i} <> "" && ${"past_ba_ratio_" .$i} <> "---"){
                                                            $ba_ratio_cutting = (float)$ba_ratio - (float)${"past_ba_ratio_" .$i};
                                                            $ba_ratio_cutting = number_format($ba_ratio_cutting, 1);
                                                            // Betty・アンティーク・全期間合計
                                                                $ba_ratio_cutting_ave = (float)$ba_ratio_cutting_ave + (float)$ba_ratio_cutting;
                                                            
                                                        }
                                                        if($ba_ratio_cutting < 0){
                                                            $ba_ratio_cutting_html .= "<div class='title7 ta_r fc_blue'>" . $ba_ratio_cutting . "%</div>";
                                                        } else {
                                                            $ba_ratio_cutting_html .= "<div class='title7 ta_r fc_red'>" . $ba_ratio_cutting . "%</div>";
                                                        }
                                                
                                                    $i++;
                                                }
                                                // Betty・アンティーク・全期間合計の平均
                                                    $ba_ratio_cutting_ave = number_format((float)$ba_ratio_cutting_ave / $i, 2);
                                                // 粗利率の過去比(トータル値追加)
                                                    //$ba_ratio_cutting_ave_html = "<div class='title7 ta_r'>" . (float)$ba_ratio_cutting_ave . "</div>";
                                                    if($ba_ratio_cutting_ave < 0){
                                                        $ba_ratio_cutting_ave_html = "<div class='title7 ta_r fc_blue'>" . $ba_ratio_cutting_ave . "%</div>";
                                                    } else {
                                                        $ba_ratio_cutting_ave_html = "<div class='title7 ta_r fc_red'>" . $ba_ratio_cutting_ave . "%</div>";
                                                    }
                                                    $ba_ratio_cutting_html = $ba_ratio_cutting_html . $ba_ratio_cutting_ave_html;
                                                    
                                                // 現在・Betty・アンティーク用粗利率を取得
                                                    if($ba_total <> 0 && $all_total <> 0 && $ba_total <> "" && $all_total <> ""){
                                                        $ba_total_ratio = number_format((floor(((float)$ba_total / (float)$all_total) * 100 * 10)) / 10 ,1);
                                                    } else {
                                                        $ba_total_ratio = "---";
                                                    }

                                                    $ba_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $ba_total_ratio . "%</div></div>";

                                        // 現在・ジュエリー・N・粗利率

                                                $i = 0;
                                                $jln_ratio = "";
                                                $jln_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>ジュエリー・N</div>";
                                                $jln_total = "";
                                                $jln_total_js = "";
                                                $all_total = "";
                                                $jln_total_ratio = "";
                                                $jln_ratio_cutting = "";
                                                $jln_ratio_cutting_ave = "";
                                                $jln_ratio_cutting_html = "";
                                                foreach($temp4_jln_manthly_array3 as $var){
                                                    if($var == 0){
                                                        $jln_ratio = "---";
                                                        $jln_total = $jln_total;
                                                        if($temp4_jln_manthly_array[$i] == 0){
                                                            $all_total = $all_total;
                                                        } else {
                                                            $all_total = (int)$all_total + (int)$temp4_jln_manthly_array[$i];
                                                        }
                                                    } else {
                                                        $jln_ratio = number_format((floor(($var / $temp4_jln_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                        $jln_total = (int)$jln_total + (int)$var;
                                                        if($temp4_jln_manthly_array[$i] == 0){
                                                            $all_total = $all_total;
                                                        } else {
                                                            $all_total = (int)$all_total + (int)$temp4_jln_manthly_array[$i];
                                                        }
                                                    }
                                                    $jln_total_js  .= (float)$jln_ratio . ", ";
                                                    $jln_sum_arari_per .= "<div class='title6 ta_r'>" . $jln_ratio . "%</div>";

                                                    // 粗利率の過去比
                                                        if($jln_ratio <> "" && $jln_ratio <> "---" && ${"past_jln_ratio_" .$i} <> "" && ${"past_jln_ratio_" .$i} <> "---"){
                                                            $jln_ratio_cutting = (float)$jln_ratio - (float)${"past_jln_ratio_" .$i};
                                                            $jln_ratio_cutting = number_format($jln_ratio_cutting, 1);
                                                            // ジュエリー・N・全期間合計
                                                                $jln_ratio_cutting_ave = (float)$jln_ratio_cutting_ave + (float)$jln_ratio_cutting;
                                                            
                                                        }
                                                        if($jln_ratio_cutting < 0){
                                                            $jln_ratio_cutting_html .= "<div class='title7 ta_r fc_blue'>" . $jln_ratio_cutting . "%</div>";
                                                        } else {
                                                            $jln_ratio_cutting_html .= "<div class='title7 ta_r fc_red'>" . $jln_ratio_cutting . "%</div>";
                                                        }
                                                
                                                    $i++;
                                                }
                                                // ジュエリー・N・全期間合計の平均
                                                    $jln_ratio_cutting_ave = number_format((float)$jln_ratio_cutting_ave / $i, 2);
                                                // 粗利率の過去比(トータル値追加)
                                                    //$jln_ratio_cutting_ave_html = "<div class='title7 ta_r'>" . (float)$jln_ratio_cutting_ave . "</div>";
                                                    if($jln_ratio_cutting_ave < 0){
                                                        $jln_ratio_cutting_ave_html = "<div class='title7 ta_r fc_blue'>" . $jln_ratio_cutting_ave . "%</div>";
                                                    } else {
                                                        $jln_ratio_cutting_ave_html = "<div class='title7 ta_r fc_red'>" . $jln_ratio_cutting_ave . "%</div>";
                                                    }
                                                    $jln_ratio_cutting_html = $jln_ratio_cutting_html . $jln_ratio_cutting_ave_html;
                                                    
                                                // 現在・ジュエリー・N用粗利率を取得
                                                    if($jln_total <> 0 && $all_total <> 0 && $jln_total <> "" && $all_total <> ""){
                                                        $jln_total_ratio = number_format((floor(((float)$jln_total / (float)$all_total) * 100 * 10)) / 10 ,1);
                                                    } else {
                                                        $jln_total_ratio = "---";
                                                    }

                                                    $jln_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $jln_total_ratio . "%</div></div>";


                                        // 現在・ジュエリー・U・粗利率

                                                $i = 0;
                                                $jlu_ratio = "";
                                                $jlu_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>ジュエリー・U</div>";
                                                $jlu_total = "";
                                                $jlu_total_js = "";
                                                $all_total = "";
                                                $jlu_total_ratio = "";
                                                $jlu_ratio_cutting = "";
                                                $jlu_ratio_cutting_ave = "";
                                                $jlu_ratio_cutting_html = "";
                                                foreach($temp4_jlu_manthly_array3 as $var){
                                                    if($var == 0){
                                                        $jlu_ratio = "---";
                                                        $jlu_total = $jlu_total;
                                                        if($temp4_jlu_manthly_array[$i] == 0){
                                                            $all_total = $all_total;
                                                        } else {
                                                            $all_total = (int)$all_total + (int)$temp4_jlu_manthly_array[$i];
                                                        }
                                                    } else {
                                                        $jlu_ratio = number_format((floor(($var / $temp4_jlu_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                        $jlu_total = (int)$jlu_total + (int)$var;
                                                        if($temp4_jlu_manthly_array[$i] == 0){
                                                            $all_total = $all_total;
                                                        } else {
                                                            $all_total = (int)$all_total + (int)$temp4_jlu_manthly_array[$i];
                                                        }
                                                    }
                                                    $jlu_total_js  .= (float)$jlu_ratio . ", ";
                                                    $jlu_sum_arari_per .= "<div class='title6 ta_r'>" . $jlu_ratio . "%</div>";

                                                    // 粗利率の過去比
                                                        if($jlu_ratio <> "" && $jlu_ratio <> "---" && ${"past_jlu_ratio_" .$i} <> "" && ${"past_jlu_ratio_" .$i} <> "---"){
                                                            $jlu_ratio_cutting = (float)$jlu_ratio - (float)${"past_jlu_ratio_" .$i};
                                                            $jlu_ratio_cutting = number_format($jlu_ratio_cutting, 1);
                                                            // ジュエリー・U・全期間合計
                                                                $jlu_ratio_cutting_ave = (float)$jlu_ratio_cutting_ave + (float)$jlu_ratio_cutting;
                                                            
                                                        }
                                                        if($jlu_ratio_cutting < 0){
                                                            $jlu_ratio_cutting_html .= "<div class='title7 ta_r fc_blue'>" . $jlu_ratio_cutting . "%</div>";
                                                        } else {
                                                            $jlu_ratio_cutting_html .= "<div class='title7 ta_r fc_red'>" . $jlu_ratio_cutting . "%</div>";
                                                        }
                                                
                                                    $i++;
                                                }
                                                // ジュエリー・U・全期間合計の平均
                                                    $jlu_ratio_cutting_ave = number_format((float)$jlu_ratio_cutting_ave / $i, 2);
                                                // 粗利率の過去比(トータル値追加)
                                                    //$jlu_ratio_cutting_ave_html = "<div class='title7 ta_r'>" . (float)$jlu_ratio_cutting_ave . "</div>";
                                                    if($jlu_ratio_cutting_ave < 0){
                                                        $jlu_ratio_cutting_ave_html = "<div class='title7 ta_r fc_blue'>" . $jlu_ratio_cutting_ave . "%</div>";
                                                    } else {
                                                        $jlu_ratio_cutting_ave_html = "<div class='title7 ta_r fc_red'>" . $jlu_ratio_cutting_ave . "%</div>";
                                                    }
                                                    $jlu_ratio_cutting_html = $jlu_ratio_cutting_html . $jlu_ratio_cutting_ave_html;
                                                    
                                                // 現在・ジュエリー・U用粗利率を取得
                                                    if($jlu_total <> 0 && $all_total <> 0 && $jlu_total <> "" && $all_total <> ""){
                                                        $jlu_total_ratio = number_format((floor(((float)$jlu_total / (float)$all_total) * 100 * 10)) / 10 ,1);
                                                    } else {
                                                        $jlu_total_ratio = "---";
                                                    }

                                                    $jlu_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $jlu_total_ratio . "%</div></div>";


                                        // 現在・バッグ・N・粗利率

                                                $i = 0;
                                                $bgn_ratio = "";
                                                $bgn_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>バッグ・N</div>";
                                                $bgn_total = "";
                                                $bgn_total_js = "";
                                                $all_total = "";
                                                $bgn_total_ratio = "";
                                                $bgn_ratio_cutting = "";
                                                $bgn_ratio_cutting_ave = "";
                                                $bgn_ratio_cutting_html = "";
                                                foreach($temp4_bgn_manthly_array3 as $var){
                                                    if($var == 0){
                                                        $bgn_ratio = "---";
                                                        $bgn_total = $bgn_total;
                                                        if($temp4_bgn_manthly_array[$i] == 0){
                                                            $all_total = $all_total;
                                                        } else {
                                                            $all_total = (int)$all_total + (int)$temp4_bgn_manthly_array[$i];
                                                        }
                                                    } else {
                                                        $bgn_ratio = number_format((floor(($var / $temp4_bgn_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                        $bgn_total = (int)$bgn_total + (int)$var;
                                                        if($temp4_bgn_manthly_array[$i] == 0){
                                                            $all_total = $all_total;
                                                        } else {
                                                            $all_total = (int)$all_total + (int)$temp4_bgn_manthly_array[$i];
                                                        }
                                                    }
                                                    $bgn_total_js  .= (float)$bgn_ratio . ", ";
                                                    $bgn_sum_arari_per .= "<div class='title6 ta_r'>" . $bgn_ratio . "%</div>";

                                                    // 粗利率の過去比
                                                        if($bgn_ratio <> "" && $bgn_ratio <> "---" && ${"past_bgn_ratio_" .$i} <> "" && ${"past_bgn_ratio_" .$i} <> "---"){
                                                            $bgn_ratio_cutting = (float)$bgn_ratio - (float)${"past_bgn_ratio_" .$i};
                                                            $bgn_ratio_cutting = number_format($bgn_ratio_cutting, 1);
                                                            // バッグ・N・全期間合計
                                                                $bgn_ratio_cutting_ave = (float)$bgn_ratio_cutting_ave + (float)$bgn_ratio_cutting;
                                                            
                                                        }
                                                        if($bgn_ratio_cutting < 0){
                                                            $bgn_ratio_cutting_html .= "<div class='title7 ta_r fc_blue'>" . $bgn_ratio_cutting . "%</div>";
                                                        } else {
                                                            $bgn_ratio_cutting_html .= "<div class='title7 ta_r fc_red'>" . $bgn_ratio_cutting . "%</div>";
                                                        }
                                                
                                                    $i++;
                                                }
                                                // バッグ・N・全期間合計の平均
                                                    $bgn_ratio_cutting_ave = number_format((float)$bgn_ratio_cutting_ave / $i, 2);
                                                // 粗利率の過去比(トータル値追加)
                                                    //$bgn_ratio_cutting_ave_html = "<div class='title7 ta_r'>" . (float)$bgn_ratio_cutting_ave . "</div>";
                                                    if($bgn_ratio_cutting_ave < 0){
                                                        $bgn_ratio_cutting_ave_html = "<div class='title7 ta_r fc_blue'>" . $bgn_ratio_cutting_ave . "%</div>";
                                                    } else {
                                                        $bgn_ratio_cutting_ave_html = "<div class='title7 ta_r fc_red'>" . $bgn_ratio_cutting_ave . "%</div>";
                                                    }
                                                    $bgn_ratio_cutting_html = $bgn_ratio_cutting_html . $bgn_ratio_cutting_ave_html;
                                                    
                                                // 現在・バッグ・N用粗利率を取得
                                                    if($bgn_total <> 0 && $all_total <> 0 && $bgn_total <> "" && $all_total <> ""){
                                                        $bgn_total_ratio = number_format((floor(((float)$bgn_total / (float)$all_total) * 100 * 10)) / 10 ,1);
                                                    } else {
                                                        $bgn_total_ratio = "---";
                                                    }

                                                    $bgn_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $bgn_total_ratio . "%</div></div>";



                                        // 現在・バッグ・U・粗利率

                                                $i = 0;
                                                $bgu_ratio = "";
                                                $bgu_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>バッグ・U</div>";
                                                $bgu_total = "";
                                                $bgu_total_js = "";
                                                $all_total = "";
                                                $bgu_total_ratio = "";
                                                $bgu_ratio_cutting = "";
                                                $bgu_ratio_cutting_ave = "";
                                                $bgu_ratio_cutting_html = "";
                                                foreach($temp4_bgu_manthly_array3 as $var){
                                                    if($var == 0){
                                                        $bgu_ratio = "---";
                                                        $bgu_total = $bgu_total;
                                                        if($temp4_bgu_manthly_array[$i] == 0){
                                                            $all_total = $all_total;
                                                        } else {
                                                            $all_total = (int)$all_total + (int)$temp4_bgu_manthly_array[$i];
                                                        }
                                                    } else {
                                                        $bgu_ratio = number_format((floor(($var / $temp4_bgu_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                        $bgu_total = (int)$bgu_total + (int)$var;
                                                        if($temp4_bgu_manthly_array[$i] == 0){
                                                            $all_total = $all_total;
                                                        } else {
                                                            $all_total = (int)$all_total + (int)$temp4_bgu_manthly_array[$i];
                                                        }
                                                    }
                                                    $bgu_total_js  .= (float)$bgu_ratio . ", ";
                                                    $bgu_sum_arari_per .= "<div class='title6 ta_r'>" . $bgu_ratio . "%</div>";

                                                    // 粗利率の過去比
                                                        if($bgu_ratio <> "" && $bgu_ratio <> "---" && ${"past_bgu_ratio_" .$i} <> "" && ${"past_bgu_ratio_" .$i} <> "---"){
                                                            $bgu_ratio_cutting = (float)$bgu_ratio - (float)${"past_bgu_ratio_" .$i};
                                                            $bgu_ratio_cutting = number_format($bgu_ratio_cutting, 1);
                                                            // バッグ・U・全期間合計
                                                                $bgu_ratio_cutting_ave = (float)$bgu_ratio_cutting_ave + (float)$bgu_ratio_cutting;
                                                            
                                                        }
                                                        if($bgu_ratio_cutting < 0){
                                                            $bgu_ratio_cutting_html .= "<div class='title7 ta_r fc_blue'>" . $bgu_ratio_cutting . "%</div>";
                                                        } else {
                                                            $bgu_ratio_cutting_html .= "<div class='title7 ta_r fc_red'>" . $bgu_ratio_cutting . "%</div>";
                                                        }
                                                
                                                    $i++;
                                                }
                                                // バッグ・U・全期間合計の平均
                                                    $bgu_ratio_cutting_ave = number_format((float)$bgu_ratio_cutting_ave / $i, 2);
                                                // 粗利率の過去比(トータル値追加)
                                                    //$bgu_ratio_cutting_ave_html = "<div class='title7 ta_r'>" . (float)$bgu_ratio_cutting_ave . "</div>";
                                                    if($bgu_ratio_cutting_ave < 0){
                                                        $bgu_ratio_cutting_ave_html = "<div class='title7 ta_r fc_blue'>" . $bgu_ratio_cutting_ave . "%</div>";
                                                    } else {
                                                        $bgu_ratio_cutting_ave_html = "<div class='title7 ta_r fc_red'>" . $bgu_ratio_cutting_ave . "%</div>";
                                                    }
                                                    $bgu_ratio_cutting_html = $bgu_ratio_cutting_html . $bgu_ratio_cutting_ave_html;
                                                    
                                                // 現在・バッグ・U用粗利率を取得
                                                    if($bgu_total <> 0 && $all_total <> 0 && $bgu_total <> "" && $all_total <> ""){
                                                        $bgu_total_ratio = number_format((floor(((float)$bgu_total / (float)$all_total) * 100 * 10)) / 10 ,1);
                                                    } else {
                                                        $bgu_total_ratio = "---";
                                                    }

                                                    $bgu_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $bgu_total_ratio . "%</div></div>";



                /************************************************************************************************************************************************************************************************************* */
                    // 現在・Jack金額構成比
                /************************************************************************************************************************************************************************************************************* */
                
                                $i = 0;
                                $total = "";
                                $total2 = 0;
                                $jn_per = "";
                                $ju_per = "";
                                $ja_per = "";
                                $jn_total = "";
                                $ju_total = "";
                                $ja_total = "";
                                $jn_per_html = "";
                                $ju_per_html = "";
                                $ja_per_html = "";
                                $jn_total_js2 = "";
                                $ju_total_js2 = "";
                                $ja_total_js2 = "";
                                foreach($temp4_ju_manthly_array as $var){
                                    //$total = (int)$var + (int)$temp4_jn_manthly_array[$i] + (int)$temp4_ja_manthly_array[$i];
                                    $total = (int)$var + (int)$temp4_jn_manthly_array[$i] + (int)$temp4_ja_manthly_array[$i] + (int)$temp4_bn_manthly_array[$i] + (int)$temp4_bu_manthly_array[$i] + (int)$temp4_ba_manthly_array[$i] + (int)$temp4_jln_manthly_array[$i] + (int)$temp4_jlu_manthly_array[$i] + (int)$temp4_bgn_manthly_array[$i] + (int)$temp4_bgu_manthly_array[$i];
                                    $total2 = (int)$total2 + (int)$total;
                                    $ju_total = (int)$ju_total + (int)$var;
                                    $jn_total = (int)$jn_total + (int)$temp4_jn_manthly_array[$i];
                                    $ja_total = (int)$ja_total + (int)$temp4_ja_manthly_array[$i];
                                    if($var == 0){
                                        $ju_per = "---";
                                        if($temp4_jn_manthly_array[$i] == 0){
                                            $jn_per = "---";
                                        } else {
                                                if($temp4_jn_manthly_array[$i] <> 0 && $total <> 0 && $temp4_jn_manthly_array[$i] <> "" && $total <> ""){
                                                    $jn_per = number_format((floor(($temp4_jn_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
                                                } else {
                                                    $jn_per = "---"; 
                                                }
                                        }
                                        if($temp4_ja_manthly_array[$i] == 0){
                                            $ja_per = "---";
                                        } else {
                                                if($temp4_ja_manthly_array[$i] <> 0 && $total <> 0 && $temp4_ja_manthly_array[$i] <> "" && $total <> ""){
                                                    $ja_per = number_format((floor(($temp4_ja_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
                                                } else {
                                                    $ja_per = "---"; 
                                                }
                                        }
                                        
                                    } else {
                                        $ju_per = number_format((floor(($var / $total) * 100 * 10)) / 10 ,1);
                                        if($temp4_jn_manthly_array[$i] == 0){
                                            $jn_per = "---";
                                        } else {
                                            $jn_per = number_format((floor(($temp4_jn_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1);;
                                        }
                                        if($temp4_ja_manthly_array[$i] == 0){
                                            $ja_per = "---";
                                        } else {
                                            $ja_per = number_format((floor(($temp4_ja_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1);;
                                        }

                                    }
                                    $ju_per_html .= "<div class='title7 ta_r'>" . $ju_per . "%</div>";
                                    $jn_per_html .= "<div class='title7 ta_r'>" . $jn_per . "%</div>";
                                    $ju_total_js2  .= (float)$ju_per . ", ";
                                    $jn_total_js2  .= (float)$jn_per . ", ";
                                    $ja_per_html .= "<div class='title7 ta_r'>" . $ja_per . "%</div>";
                                    $ja_total_js2  .= (float)$ja_per . ", ";

                                    $i++;
                                }
                                // 期間中の売上合計金額に対するパーセンテージを取得
                                    if($ju_total <> 0 && $total2 <> 0 && $ju_total <> "" && $total2 <> ""){
                                        $ju_total_per = number_format((floor(((float)$ju_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                    } else {
                                        $ju_total_per = "---";
                                    }
                                    if($jn_total <> 0 && $total2 <> 0 && $jn_total <> "" && $total2 <> ""){
                                        $jn_total_per = number_format((floor(((float)$jn_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                    } else {
                                        $jn_total_per = "---";
                                    }
                                    if($ja_total <> 0 && $total2 <> 0 && $ja_total <> "" && $total2 <> ""){
                                        $ja_total_per = number_format((floor(((float)$ja_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                    } else {
                                        $ja_total_per = "---";
                                    }
                                    //$ja_total_per = number_format(bcsub('100', ((float)$jn_total_per + (float)$ju_total_per + (float)$ja_total_per), 1) ,1);


                                    $ju_per_html .= "<div class='title7 ta_r'>" . $ju_total_per . "%</div>";
                                    $jn_per_html .= "<div class='title7 ta_r'>" . $jn_total_per . "%</div>";
                                    $ja_per_html .= "<div class='title7 ta_r'>" . $ja_total_per . "%</div>";


                                /*$temp4_all_sorce16 = "<p class='title_a'>金額・構成比</p><div class='box1'>" . $temp4_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・N</div>" . $jn_per_html . "</div>";
                                $temp4_all_sorce16 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・U</div>" . $ju_per_html . "</div>";
                                $temp4_all_sorce16 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・A</div>" . $ja_per_html . "</div>";
                                $temp4_all_sorce16 .= "</div>";*/
                                $temp4_all_sorce16 = "<p class='title_a'>金額・構成比</p><div class='box1'>" . $temp4_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・N</div>" . $jn_per_html . "</div>";
                                $temp4_all_sorce16 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・U</div>" . $ju_per_html . "</div>";
                                $temp4_all_sorce16 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・A</div>" . $ja_per_html . "</div>";
                
                
                /************************************************************************************************************************************************************************************************************* */
                    // 現在・Betty金額構成比
                /************************************************************************************************************************************************************************************************************* */
                
                                $i = 0;
                                $total = "";
                                $total2 = 0;
                                $bn_per = "";
                                $bu_per = "";
                                $ba_per = "";
                                $bn_total = "";
                                $bu_total = "";
                                $ba_total = "";
                                $bn_per_html = "";
                                $bu_per_html = "";
                                $ba_per_html = "";
                                $bn_total_js2 = "";
                                $bu_total_js2 = "";
                                $ba_total_js2 = "";
                                foreach($temp4_bu_manthly_array as $var){
                                    //$total = (int)$var + (int)$temp4_bn_manthly_array[$i] + (int)$temp4_ba_manthly_array[$i];
                                    $total = (int)$var + (int)$temp4_bn_manthly_array[$i] + (int)$temp4_ba_manthly_array[$i] + (int)$temp4_jn_manthly_array[$i] + (int)$temp4_ju_manthly_array[$i] + (int)$temp4_ja_manthly_array[$i] + (int)$temp4_jln_manthly_array[$i] + (int)$temp4_jlu_manthly_array[$i] + (int)$temp4_bgn_manthly_array[$i] + (int)$temp4_bgu_manthly_array[$i];
                                    $total2 = (int)$total2 + (int)$total;
                                    $bu_total = (int)$bu_total + (int)$var;
                                    $bn_total = (int)$bn_total + (int)$temp4_bn_manthly_array[$i];
                                    $ba_total = (int)$ba_total + (int)$temp4_ba_manthly_array[$i];
                                    if($var == 0){
                                        $bu_per = "---";
                                        if($temp4_bn_manthly_array[$i] == 0){
                                            $bn_per = "---";
                                        } else {
                                                if($temp4_bn_manthly_array[$i] <> 0 && $total <> 0 && $temp4_bn_manthly_array[$i] <> "" && $total <> ""){
                                                    $bn_per = number_format((floor(($temp4_bn_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
                                                } else {
                                                    $bn_per = "---"; 
                                                }
                                        }
                                        if($temp4_ba_manthly_array[$i] == 0){
                                            $ba_per = "---";
                                        } else {
                                                if($temp4_ba_manthly_array[$i] <> 0 && $total <> 0 && $temp4_ba_manthly_array[$i] <> "" && $total <> ""){
                                                    $ba_per = number_format((floor(($temp4_ba_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
                                                } else {
                                                    $ba_per = "---"; 
                                                }
                                        }
                                        
                                    } else {
                                        $bu_per = number_format((floor(($var / $total) * 100 * 10)) / 10 ,1);
                                        if($temp4_bn_manthly_array[$i] == 0){
                                            $bn_per = "---";
                                        } else {
                                            $bn_per = number_format((floor(($temp4_bn_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1);;
                                        }
                                        if($temp4_ba_manthly_array[$i] == 0){
                                            $ba_per = "---";
                                        } else {
                                            $ba_per = number_format((floor(($temp4_ba_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1);;
                                        }

                                    }
                                    $bu_per_html .= "<div class='title7 ta_r'>" . $bu_per . "%</div>";
                                    $bn_per_html .= "<div class='title7 ta_r'>" . $bn_per . "%</div>";
                                    $bu_total_js2  .= (float)$bu_per . ", ";
                                    $bn_total_js2  .= (float)$bn_per . ", ";
                                    $ba_per_html .= "<div class='title7 ta_r'>" . $ba_per . "%</div>";
                                    $ba_total_js2  .= (float)$ba_per . ", ";

                                    $i++;
                                }
                                // 期間中の売上合計金額に対するパーセンテージを取得
                                    if($bu_total <> 0 && $total2 <> 0 && $bu_total <> "" && $total2 <> ""){
                                        $bu_total_per = number_format((floor(((float)$bu_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                    } else {
                                        $bu_total_per = "---";
                                    }
                                    if($bn_total <> 0 && $total2 <> 0 && $bn_total <> "" && $total2 <> ""){
                                        $bn_total_per = number_format((floor(((float)$bn_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                    } else {
                                        $bn_total_per = "---";
                                    }
                                    if($ba_total <> 0 && $total2 <> 0 && $ba_total <> "" && $total2 <> ""){
                                        $ba_total_per = number_format((floor(((float)$ba_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                    } else {
                                        $ba_total_per = "---";
                                    }
                                    //$ba_total_per = number_format(bcsub('100', ((float)$bn_total_per + (float)$bu_total_per + (float)$ba_total_per), 1) ,1);


                                    $bu_per_html .= "<div class='title7 ta_r'>" . $bu_total_per . "%</div>";
                                    $bn_per_html .= "<div class='title7 ta_r'>" . $bn_total_per . "%</div>";
                                    $ba_per_html .= "<div class='title7 ta_r'>" . $ba_total_per . "%</div>";


                               /*$temp4_all_sorce13 = "<p class='title_a'>金額・構成比[ベティー]</p><div class='box1'>" . $temp4_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・N</div>" . $bn_per_html . "</div>";
                                $temp4_all_sorce13 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・U</div>" . $bu_per_html . "</div>";
                                $temp4_all_sorce13 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・A</div>" . $ba_per_html . "</div>";
                                $temp4_all_sorce13 .= "</div>";*/

                                $temp4_all_sorce16 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・N</div>" . $bn_per_html . "</div>";
                                $temp4_all_sorce16 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・U</div>" . $bu_per_html . "</div>";
                                $temp4_all_sorce16 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・A</div>" . $ba_per_html . "</div>";
                
                /************************************************************************************************************************************************************************************************************* */
                    // 現在・ジュエリー金額構成比
                /************************************************************************************************************************************************************************************************************* */
                                $i = 0;
                                $total = "";
                                $total2 = 0;
                                $jln_per = "";
                                $jlu_per = "";
                                $jln_total = "";
                                $jlu_total = "";
                                $jln_per_html = "";
                                $jlu_per_html = "";
                                $jln_total_js2 = "";
                                $jlu_total_js2 = "";
                                foreach($temp4_jlu_manthly_array as $var){
                                    //$total = (int)$var + (int)$temp4_jln_manthly_array[$i];
                                    $total = (int)$var + (int)$temp4_jln_manthly_array[$i] + (int)$temp4_jn_manthly_array[$i] + (int)$temp4_ju_manthly_array[$i] + (int)$temp4_ja_manthly_array[$i] + (int)$temp4_bn_manthly_array[$i] + (int)$temp4_bu_manthly_array[$i] + (int)$temp4_ba_manthly_array[$i] + (int)$temp4_bgn_manthly_array[$i] + (int)$temp4_bgu_manthly_array[$i];
                                    $total2 = (int)$total2 + (int)$total;
                                    $jlu_total = (int)$jlu_total + (int)$var;
                                    $jln_total = (int)$jln_total + (int)$temp4_jln_manthly_array[$i];
                                    if($var == 0){
                                        $jlu_per = "---";
                                        if($temp4_jln_manthly_array[$i] == 0){
                                            $jln_per = "---";
                                        } else {
                                                if($temp4_jln_manthly_array[$i] <> 0 && $total <> 0 && $temp4_jln_manthly_array[$i] <> "" && $total <> ""){
                                                    $jln_per = number_format((floor(($temp4_jln_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
                                                } else {
                                                    $jln_per = "---"; 
                                                }
                                        }
                                        
                                    } else {
                                        $jlu_per = number_format((floor(($var / $total) * 100 * 10)) / 10 ,1);
                                        if($temp4_jln_manthly_array[$i] == 0){
                                            $jln_per = "---";
                                        } else {
                                            $jln_per = number_format((floor(($temp4_jln_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1);;
                                        }

                                    }
                                    $jlu_per_html .= "<div class='title7 ta_r'>" . $jlu_per . "%</div>";
                                    $jln_per_html .= "<div class='title7 ta_r'>" . $jln_per . "%</div>";
                                    $jlu_total_js2  .= (float)$jlu_per . ", ";
                                    $jln_total_js2  .= (float)$jln_per . ", ";

                                    $i++;
                                }
                                // 期間中の売上合計金額に対するパーセンテージを取得
                                    if($jlu_total <> 0 && $total2 <> 0 && $jlu_total <> "" && $total2 <> ""){
                                        $jlu_total_per = number_format((floor(((float)$jlu_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                    } else {
                                        $jlu_total_per = "---";
                                    }
                                    if($jln_total <> 0 && $total2 <> 0 && $jln_total <> "" && $total2 <> ""){
                                        $jln_total_per = number_format((floor(((float)$jln_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                    } else {
                                        $jln_total_per = "---";
                                    }

                                    $jlu_per_html .= "<div class='title7 ta_r'>" . $jlu_total_per . "%</div>";
                                    $jln_per_html .= "<div class='title7 ta_r'>" . $jln_total_per . "%</div>";


                                /*$temp4_all_sorce14 = "<p class='title_a'>金額・構成比</p><div class='box1'>" . $temp4_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・N</div>" . $jln_per_html . "</div>";
                                $temp4_all_sorce14 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・U</div>" . $jlu_per_html . "</div>";
                                $temp4_all_sorce14 .= "</div>";*/
                                $temp4_all_sorce16 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・N</div>" . $jln_per_html . "</div>";
                                $temp4_all_sorce16 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・U</div>" . $jlu_per_html . "</div>";
                
                /************************************************************************************************************************************************************************************************************* */
                    // 現在・バッグ金額構成比
                /************************************************************************************************************************************************************************************************************* */

                                $i = 0;
                                $total = "";
                                $total2 = 0;
                                $bgn_per = "";
                                $bgu_per = "";
                                $bgn_total = "";
                                $bgu_total = "";
                                $bgn_per_html = "";
                                $bgu_per_html = "";
                                $bgn_total_js2 = "";
                                $bgu_total_js2 = "";
                                foreach($temp4_bgu_manthly_array as $var){
                                    //$total = (int)$var + (int)$temp4_bgn_manthly_array[$i];
                                    $total = (int)$var + (int)$temp4_bgn_manthly_array[$i] + (int)$temp4_jn_manthly_array[$i] + (int)$temp4_ju_manthly_array[$i] + (int)$temp4_ja_manthly_array[$i] + (int)$temp4_bn_manthly_array[$i] + (int)$temp4_bu_manthly_array[$i] + (int)$temp4_ba_manthly_array[$i] + (int)$temp4_jln_manthly_array[$i] + (int)$temp4_jlu_manthly_array[$i];
                                    $total2 = (int)$total2 + (int)$total;
                                    $bgu_total = (int)$bgu_total + (int)$var;
                                    $bgn_total = (int)$bgn_total + (int)$temp4_bgn_manthly_array[$i];
                                    if($var == 0){
                                        $bgu_per = "---";
                                        if($temp4_bgn_manthly_array[$i] == 0){
                                            $bgn_per = "---";
                                        } else {
                                                if($temp4_bgn_manthly_array[$i] <> 0 && $total <> 0 && $temp4_bgn_manthly_array[$i] <> "" && $total <> ""){
                                                    $bgn_per = number_format((floor(($temp4_bgn_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
                                                } else {
                                                    $bgn_per = "---"; 
                                                }
                                        }
                                        
                                    } else {
                                        $bgu_per = number_format((floor(($var / $total) * 100 * 10)) / 10 ,1);
                                        if($temp4_bgn_manthly_array[$i] == 0){
                                            $bgn_per = "---";
                                        } else {
                                            $bgn_per = number_format((floor(($temp4_bgn_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1);;
                                        }

                                    }
                                    $bgu_per_html .= "<div class='title7 ta_r'>" . $bgu_per . "%</div>";
                                    $bgn_per_html .= "<div class='title7 ta_r'>" . $bgn_per . "%</div>";
                                    $bgu_total_js2  .= (float)$bgu_per . ", ";
                                    $bgn_total_js2  .= (float)$bgn_per . ", ";

                                    $i++;
                                }
                                // 期間中の売上合計金額に対するパーセンテージを取得
                                    if($bgu_total <> 0 && $total2 <> 0 && $bgu_total <> "" && $total2 <> ""){
                                        $bgu_total_per = number_format((floor(((float)$bgu_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                    } else {
                                        $bgu_total_per = "---";
                                    }
                                    if($bgn_total <> 0 && $total2 <> 0 && $bgn_total <> "" && $total2 <> ""){
                                        $bgn_total_per = number_format((floor(((float)$bgn_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                    } else {
                                        $bgn_total_per = "---";
                                    }

                                    $bgu_per_html .= "<div class='title7 ta_r'>" . $bgu_total_per . "%</div>";
                                    $bgn_per_html .= "<div class='title7 ta_r'>" . $bgn_total_per . "%</div>";


                                    /*$temp4_all_sorce15 = "<p class='title_a'>金額・構成比[バッグ]</p><div class='box1'>" . $temp4_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・N</div>" . $bgn_per_html . "</div>";
                                    $temp4_all_sorce15 .= "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・U</div>" . $bgu_per_html . "</div>";
                                    $temp4_all_sorce15 .= "</div>";*/
                                    $temp4_all_sorce16 .= "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・N</div>" . $bgn_per_html . "</div>";
                                    $temp4_all_sorce16 .= "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・U</div>" . $bgu_per_html . "</div>";
                                    $temp4_all_sorce16 .= "</div>";
        
                /************************************************************************************************************************************************************************************************************* */
                    // 現在・Jack点数構成比
                /************************************************************************************************************************************************************************************************************* */

                                $i = 0;
                                $total = "";
                                $total2 = 0;
                                $jn_per = "";
                                $ju_per = "";
                                $ja_per = "";
                                $jn_total = "";
                                $ju_total = "";
                                $ja_total = "";
                                $jn_per_html = "";
                                $ju_per_html = "";
                                $ja_per_html = "";
                                $jn_total_js3 = "";
                                $ju_total_js3 = "";
                                $ja_total_js3 = "";
                                foreach($temp4_ju_manthly_array2 as $var){
                                    //$total = (int)$var + (int)$temp4_jn_manthly_array2[$i] + (int)$temp4_ja_manthly_array2[$i];
                                    $total = (int)$var + (int)$temp4_jn_manthly_array2[$i] + (int)$temp4_ja_manthly_array2[$i] + (int)$temp4_bn_manthly_array2[$i] + (int)$temp4_bu_manthly_array2[$i] + (int)$temp4_ba_manthly_array2[$i] + (int)$temp4_jln_manthly_array2[$i] + (int)$temp4_jlu_manthly_array2[$i] + (int)$temp4_bgn_manthly_array2[$i] + (int)$temp4_bgu_manthly_array2[$i];
                                    $total2 = (int)$total2 + (int)$total;
                                    $ju_total = (int)$ju_total + (int)$var;
                                    $jn_total = (int)$jn_total + (int)$temp4_jn_manthly_array2[$i];
                                    $ja_total = (int)$ja_total + (int)$temp4_ja_manthly_array2[$i];
                                    if($var == 0){
                                        $ju_per = "---";
                                        if($temp4_jn_manthly_array2[$i] == 0){
                                            $jn_per = "---";
                                        } else {
                                                if($temp4_jn_manthly_array2[$i] <> 0 && $total <> 0 && $temp4_jn_manthly_array2[$i] <> "" && $total <> ""){
                                                    $jn_per = number_format((floor(($temp4_jn_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
                                                } else {
                                                    $jn_per = "---"; 
                                                }
                                        }
                                        if($temp4_ja_manthly_array2[$i] == 0){
                                            $ja_per = "---";
                                        } else {
                                                if($temp4_ja_manthly_array2[$i] <> 0 && $total <> 0 && $temp4_ja_manthly_array2[$i] <> "" && $total <> ""){
                                                    $ja_per = number_format((floor(($temp4_ja_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
                                                } else {
                                                    $ja_per = "---"; 
                                                }
                                        }
                                        
                                    } else {
                                        $ju_per = number_format((floor(($var / $total) * 100 * 10)) / 10 ,1);
                                        if($temp4_jn_manthly_array2[$i] == 0){
                                            $jn_per = "---";
                                        } else {
                                            $jn_per = number_format((floor(($temp4_jn_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1);;
                                        }
                                        if($temp4_ja_manthly_array2[$i] == 0){
                                            $ja_per = "---";
                                        } else {
                                            $ja_per = number_format((floor(($temp4_ja_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1);;
                                        }

                                    }
                                    $ju_per_html .= "<div class='title7 ta_r'>" . $ju_per . "%</div>";
                                    $jn_per_html .= "<div class='title7 ta_r'>" . $jn_per . "%</div>";
                                    $ju_total_js3  .= (float)$ju_per . ", ";
                                    $jn_total_js3  .= (float)$jn_per . ", ";
                                    $ja_per_html .= "<div class='title7 ta_r'>" . $ja_per . "%</div>";
                                    $ja_total_js3  .= (float)$ja_per . ", ";

                                    $i++;
                                }
                                // 期間中の売上合計点数に対するパーセンテージを取得
                                    if($ju_total <> 0 && $total2 <> 0 && $ju_total <> "" && $total2 <> ""){
                                        $ju_total_per = number_format((floor(((float)$ju_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                    } else {
                                        $ju_total_per = "---";
                                    }
                                    if($jn_total <> 0 && $total2 <> 0 && $jn_total <> "" && $total2 <> ""){
                                        $jn_total_per = number_format((floor(((float)$jn_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                    } else {
                                        $jn_total_per = "---";
                                    }
                                    if($ja_total <> 0 && $total2 <> 0 && $ja_total <> "" && $total2 <> ""){
                                        $ja_total_per = number_format((floor(((float)$ja_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                    } else {
                                        $ja_total_per = "---";
                                    }
                                    //$ja_total_per = number_format(bcsub('100', ((float)$jn_total_per + (float)$ju_total_per + (float)$ja_total_per), 1) ,1);


                                    $ju_per_html .= "<div class='title7 ta_r'>" . $ju_total_per . "%</div>";
                                    $jn_per_html .= "<div class='title7 ta_r'>" . $jn_total_per . "%</div>";
                                    $ja_per_html .= "<div class='title7 ta_r'>" . $ja_total_per . "%</div>";


                                $temp4_all_sorce5 = "<p class='title_a'>点数・構成比</p><div class='box1'>" . $temp4_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・N</div>" . $jn_per_html . "</div>";
                                $temp4_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・U</div>" . $ju_per_html . "</div>";
                                $temp4_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・A</div>" . $ja_per_html . "</div>";
                                //$temp4_all_sorce5 .= "</div>";


                /************************************************************************************************************************************************************************************************************* */
                    // 現在・Betty点数構成比
                /************************************************************************************************************************************************************************************************************* */
                
                                $i = 0;
                                $total = "";
                                $total2 = 0;
                                $bn_per = "";
                                $bu_per = "";
                                $ba_per = "";
                                $bn_total = "";
                                $bu_total = "";
                                $ba_total = "";
                                $bn_per_html = "";
                                $bu_per_html = "";
                                $ba_per_html = "";
                                $bn_total_js3 = "";
                                $bu_total_js3 = "";
                                $ba_total_js3 = "";
                                foreach($temp4_bu_manthly_array2 as $var){
                                    //$total = (int)$var + (int)$temp4_bn_manthly_array2[$i] + (int)$temp4_ba_manthly_array2[$i];
                                    $total = (int)$var + (int)$temp4_bn_manthly_array2[$i] + (int)$temp4_ba_manthly_array2[$i] + (int)$temp4_jn_manthly_array2[$i] + (int)$temp4_ju_manthly_array2[$i] + (int)$temp4_ja_manthly_array2[$i] + (int)$temp4_jln_manthly_array2[$i] + (int)$temp4_jlu_manthly_array2[$i] + (int)$temp4_bgn_manthly_array2[$i] + (int)$temp4_bgu_manthly_array2[$i];
                                    $total2 = (int)$total2 + (int)$total;
                                    $bu_total = (int)$bu_total + (int)$var;
                                    $bn_total = (int)$bn_total + (int)$temp4_bn_manthly_array2[$i];
                                    $ba_total = (int)$ba_total + (int)$temp4_ba_manthly_array2[$i];
                                    if($var == 0){
                                        $bu_per = "---";
                                        if($temp4_bn_manthly_array2[$i] == 0){
                                            $bn_per = "---";
                                        } else {
                                                if($temp4_bn_manthly_array2[$i] <> 0 && $total <> 0 && $temp4_bn_manthly_array2[$i] <> "" && $total <> ""){
                                                    $bn_per = number_format((floor(($temp4_bn_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
                                                } else {
                                                    $bn_per = "---"; 
                                                }
                                        }
                                        if($temp4_ba_manthly_array2[$i] == 0){
                                            $ba_per = "---";
                                        } else {
                                                if($temp4_ba_manthly_array2[$i] <> 0 && $total <> 0 && $temp4_ba_manthly_array2[$i] <> "" && $total <> ""){
                                                    $ba_per = number_format((floor(($temp4_ba_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
                                                } else {
                                                    $ba_per = "---"; 
                                                }
                                        }
                                        
                                    } else {
                                        $bu_per = number_format((floor(($var / $total) * 100 * 10)) / 10 ,1);
                                        if($temp4_bn_manthly_array2[$i] == 0){
                                            $bn_per = "---";
                                        } else {
                                            $bn_per = number_format((floor(($temp4_bn_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1);;
                                        }
                                        if($temp4_ba_manthly_array2[$i] == 0){
                                            $ba_per = "---";
                                        } else {
                                            $ba_per = number_format((floor(($temp4_ba_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1);;
                                        }

                                    }
                                    $bu_per_html .= "<div class='title7 ta_r'>" . $bu_per . "%</div>";
                                    $bn_per_html .= "<div class='title7 ta_r'>" . $bn_per . "%</div>";
                                    $bu_total_js3  .= (float)$bu_per . ", ";
                                    $bn_total_js3  .= (float)$bn_per . ", ";
                                    $ba_per_html .= "<div class='title7 ta_r'>" . $ba_per . "%</div>";
                                    $ba_total_js3  .= (float)$ba_per . ", ";

                                    $i++;
                                }
                                // 期間中の売上合計点数に対するパーセンテージを取得
                                    if($bu_total <> 0 && $total2 <> 0 && $bu_total <> "" && $total2 <> ""){
                                        $bu_total_per = number_format((floor(((float)$bu_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                    } else {
                                        $bu_total_per = "---";
                                    }
                                    if($bn_total <> 0 && $total2 <> 0 && $bn_total <> "" && $total2 <> ""){
                                        $bn_total_per = number_format((floor(((float)$bn_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                    } else {
                                        $bn_total_per = "---";
                                    }
                                    if($ba_total <> 0 && $total2 <> 0 && $ba_total <> "" && $total2 <> ""){
                                        $ba_total_per = number_format((floor(((float)$ba_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                    } else {
                                        $ba_total_per = "---";
                                    }
                                    //$ba_total_per = number_format(bcsub('100', ((float)$bn_total_per + (float)$bu_total_per + (float)$ba_total_per), 1) ,1);


                                    $bu_per_html .= "<div class='title7 ta_r'>" . $bu_total_per . "%</div>";
                                    $bn_per_html .= "<div class='title7 ta_r'>" . $bn_total_per . "%</div>";
                                    $ba_per_html .= "<div class='title7 ta_r'>" . $ba_total_per . "%</div>";


                                /*$temp4_all_sorce6 = "<p class='title_a'>点数・構成比</p><div class='box1'>" . $temp4_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・N</div>" . $bn_per_html . "</div>";
                                $temp4_all_sorce6 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・U</div>" . $bu_per_html . "</div>";
                                $temp4_all_sorce6 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・A</div>" . $ba_per_html . "</div>";
                                $temp4_all_sorce6 .= "</div>";*/
                                $temp4_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・N</div>" . $bn_per_html . "</div>";
                                $temp4_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・U</div>" . $bu_per_html . "</div>";
                                $temp4_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・A</div>" . $ba_per_html . "</div>";
                                
                
               
                /************************************************************************************************************************************************************************************************************* */
                    // 現在・ジュエリー点数構成比
                /************************************************************************************************************************************************************************************************************* */
                
                                $i = 0;
                                $total = "";
                                $total2 = 0;
                                $jln_per = "";
                                $jlu_per = "";
                                $jln_total = "";
                                $jlu_total = "";
                                $jln_per_html = "";
                                $jlu_per_html = "";
                                $jln_total_js3 = "";
                                $jlu_total_js3 = "";
                                foreach($temp4_jlu_manthly_array2 as $var){
                                    //$total = (int)$var + (int)$temp4_jln_manthly_array2[$i];
                                    $total = (int)$var + (int)$temp4_jln_manthly_array2[$i] + (int)$temp4_jn_manthly_array2[$i] + (int)$temp4_ju_manthly_array2[$i] + (int)$temp4_ja_manthly_array2[$i] + (int)$temp4_bn_manthly_array2[$i] + (int)$temp4_bu_manthly_array2[$i] + (int)$temp4_ba_manthly_array2[$i] + (int)$temp4_bgn_manthly_array2[$i] + (int)$temp4_bgu_manthly_array2[$i];
                                    $total2 = (int)$total2 + (int)$total;
                                    $jlu_total = (int)$jlu_total + (int)$var;
                                    $jln_total = (int)$jln_total + (int)$temp4_jln_manthly_array2[$i];
                                    if($var == 0){
                                        $jlu_per = "---";
                                        if($temp4_jln_manthly_array2[$i] == 0){
                                            $jln_per = "---";
                                        } else {
                                                if($temp4_jln_manthly_array2[$i] <> 0 && $total <> 0 && $temp4_jln_manthly_array2[$i] <> "" && $total <> ""){
                                                    $jln_per = number_format((floor(($temp4_jln_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
                                                } else {
                                                    $jln_per = "---"; 
                                                }
                                        }
                                        
                                    } else {
                                        $jlu_per = number_format((floor(($var / $total) * 100 * 10)) / 10 ,1);
                                        if($temp4_jln_manthly_array2[$i] == 0){
                                            $jln_per = "---";
                                        } else {
                                            $jln_per = number_format((floor(($temp4_jln_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1);;
                                        }

                                    }
                                    $jlu_per_html .= "<div class='title7 ta_r'>" . $jlu_per . "%</div>";
                                    $jln_per_html .= "<div class='title7 ta_r'>" . $jln_per . "%</div>";
                                    $jlu_total_js3  .= (float)$jlu_per . ", ";
                                    $jln_total_js3  .= (float)$jln_per . ", ";

                                    $i++;
                                }
                                // 期間中の売上合計点数に対するパーセンテージを取得
                                    if($jlu_total <> 0 && $total2 <> 0 && $jlu_total <> "" && $total2 <> ""){
                                        $jlu_total_per = number_format((floor(((float)$jlu_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                    } else {
                                        $jlu_total_per = "---";
                                    }
                                    if($jln_total <> 0 && $total2 <> 0 && $jln_total <> "" && $total2 <> ""){
                                        $jln_total_per = number_format((floor(((float)$jln_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                    } else {
                                        $jln_total_per = "---";
                                    }

                                    $jlu_per_html .= "<div class='title7 ta_r'>" . $jlu_total_per . "%</div>";
                                    $jln_per_html .= "<div class='title7 ta_r'>" . $jln_total_per . "%</div>";


                                    /*$temp4_all_sorce7 = "<p class='title_a'>点数・構成比</p><div class='box1'>" . $temp4_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・N</div>" . $jln_per_html . "</div>";
                                    $temp4_all_sorce7 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・U</div>" . $jlu_per_html . "</div>";
                                    $temp4_all_sorce7 .= "</div>";*/
                                    $temp4_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・N</div>" . $jln_per_html . "</div>";
                                    $temp4_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・U</div>" . $jlu_per_html . "</div>";
                        
                /************************************************************************************************************************************************************************************************************* */
                    // 現在・バッグ点数構成比
                /************************************************************************************************************************************************************************************************************* */

                                $i = 0;
                                $total = "";
                                $total2 = 0;
                                $bgn_per = "";
                                $bgu_per = "";
                                $bgn_total = "";
                                $bgu_total = "";
                                $bgn_per_html = "";
                                $bgu_per_html = "";
                                $bgn_total_js3 = "";
                                $bgu_total_js3 = "";
                                foreach($temp4_bgu_manthly_array2 as $var){
                                    //$total = (int)$var + (int)$temp4_bgn_manthly_array2[$i];
                                    $total = (int)$var + (int)$temp4_bgn_manthly_array2[$i] + (int)$temp4_bn_manthly_array2[$i] + (int)$temp4_bu_manthly_array2[$i] + (int)$temp4_ba_manthly_array2[$i] + (int)$temp4_jn_manthly_array2[$i] + (int)$temp4_ju_manthly_array2[$i] + (int)$temp4_ja_manthly_array2[$i] + (int)$temp4_jln_manthly_array2[$i] + (int)$temp4_jlu_manthly_array2[$i];
                                    $total2 = (int)$total2 + (int)$total;
                                    $bgu_total = (int)$bgu_total + (int)$var;
                                    $bgn_total = (int)$bgn_total + (int)$temp4_bgn_manthly_array2[$i];
                                    if($var == 0){
                                        $bgu_per = "---";
                                        if($temp4_bgn_manthly_array2[$i] == 0){
                                            $bgn_per = "---";
                                        } else {
                                                if($temp4_bgn_manthly_array2[$i] <> 0 && $total <> 0 && $temp4_bgn_manthly_array2[$i] <> "" && $total <> ""){
                                                    $bgn_per = number_format((floor(($temp4_bgn_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
                                                } else {
                                                    $bgn_per = "---"; 
                                                }
                                        }
                                        
                                    } else {
                                        $bgu_per = number_format((floor(($var / $total) * 100 * 10)) / 10 ,1);
                                        if($temp4_bgn_manthly_array2[$i] == 0){
                                            $bgn_per = "---";
                                        } else {
                                            $bgn_per = number_format((floor(($temp4_bgn_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1);;
                                        }

                                    }
                                    $bgu_per_html .= "<div class='title7 ta_r'>" . $bgu_per . "%</div>";
                                    $bgn_per_html .= "<div class='title7 ta_r'>" . $bgn_per . "%</div>";
                                    $bgu_total_js3  .= (float)$bgu_per . ", ";
                                    $bgn_total_js3  .= (float)$bgn_per . ", ";

                                    $i++;
                                }
                                // 期間中の売上合計点数に対するパーセンテージを取得
                                    if($bgu_total <> 0 && $total2 <> 0 && $bgu_total <> "" && $total2 <> ""){
                                        $bgu_total_per = number_format((floor(((float)$bgu_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                    } else {
                                        $bgu_total_per = "---";
                                    }
                                    if($bgn_total <> 0 && $total2 <> 0 && $bgn_total <> "" && $total2 <> ""){
                                        $bgn_total_per = number_format((floor(((float)$bgn_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                    } else {
                                        $bgn_total_per = "---";
                                    }

                                    $bgu_per_html .= "<div class='title7 ta_r'>" . $bgu_total_per . "%</div>";
                                    $bgn_per_html .= "<div class='title7 ta_r'>" . $bgn_total_per . "%</div>";


                                    /*$temp4_all_sorce8 = "<p class='title_a'>点数・構成比</p><div class='box1'>" . $temp4_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・N</div>" . $bgn_per_html . "</div>";
                                    $temp4_all_sorce8 .= "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・U</div>" . $bgu_per_html . "</div>";
                                    $temp4_all_sorce8 .= "</div>";*/
                                    $temp4_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・N</div>" . $bgn_per_html . "</div>";
                                    $temp4_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・U</div>" . $bgu_per_html . "</div>";
                                    $temp4_all_sorce5 .= "</div>";
        



                /************************************************************************************************************************************************************************************************************* */
                    // 現在・Jack新品平均単価
                /************************************************************************************************************************************************************************************************************* */

                    $i = 0;
                    $jn_average = "";
                    $jn_ave_html = "";
                    $jn_total = "";
                    $jn_total2 = "";
                    $jn_total_ave = "";
                    foreach($temp4_jn_manthly_array as $var){
                
                        if($var == 0){
                            $jn_average = 0;
                            $jn_total = (int)$jn_total + (int)$var;
                            if($temp4_jn_manthly_array2[$i] == 0){
                                $jn_total2 = $jn_total2;
                            } else {
                                $jn_total2 = (int)$jn_total2 + (int)$temp4_jn_manthly_array2[$i];
                            }
                        } else {
                            $jn_average = (floor(((int)$var / (int)$temp4_jn_manthly_array2[$i])) * 10) / 10;
                            $jn_total = (int)$jn_total + (int)$var;
                            if($temp4_jn_manthly_array2[$i] == 0){
                                $jn_total2 = $jn_total2;
                            } else {
                                $jn_total2 = (int)$jn_total2 + (int)$temp4_jn_manthly_array2[$i];
                            }
                        }
                        if($jn_average <> 0 && $jn_average <> ""){$jn_average = number_format((int)$jn_average);}
                        $jn_ave_html .= "<div class='title7 ta_r'>" . $jn_average . "</div>";
                
                        $i++;
                    }
                    // 期間中の売上合計に対する平均単価を取得
                        if($jn_total <> 0 && $jn_total2 <> 0 && $jn_total <> "" && $jn_total2 <> ""){
                            $jn_total_ave = (floor(((int)$jn_total / (int)$jn_total2) * 10)) / 10;
                        } else {
                            $jn_total_ave = "---";
                        }
                        if($jn_total_ave <> 0 && $jn_total_ave <> ""){$jn_total_ave = number_format((int)$jn_total_ave);}
                        $jn_ave_html .= "<div class='title7 ta_r'>" . $jn_total_ave . "</div>";
                


                /************************************************************************************************************************************************************************************************************* */
                    // 現在・Jack中古平均単価
                /************************************************************************************************************************************************************************************************************* */

                    $i = 0;
                    $ju_average = "";
                    $ju_ave_html = "";
                    $ju_total = "";
                    $ju_total2 = "";
                    $ju_total_ave = "";
                    foreach($temp4_ju_manthly_array as $var){
                
                        if($var == 0){
                            $ju_average = 0;
                            $ju_total = (int)$ju_total + (int)$var;
                            if($temp4_ju_manthly_array2[$i] == 0){
                                $ju_total2 = $ju_total2;
                            } else {
                                $ju_total2 = (int)$ju_total2 + (int)$temp4_ju_manthly_array2[$i];
                            }
                        } else {
                            $ju_average = (floor(((int)$var / (int)$temp4_ju_manthly_array2[$i])) * 10) / 10;
                            $ju_total = (int)$ju_total + (int)$var;
                            if($temp4_ju_manthly_array2[$i] == 0){
                                $ju_total2 = $ju_total2;
                            } else {
                                $ju_total2 = (int)$ju_total2 + (int)$temp4_ju_manthly_array2[$i];
                            }
                        }
                        if($ju_average <> 0 && $ju_average <> ""){$ju_average = number_format((int)$ju_average);}
                        $ju_ave_html .= "<div class='title7 ta_r'>" . $ju_average . "</div>";
                
                        $i++;
                    }
                    // 期間中の売上合計に対する平均単価を取得
                        if($ju_total <> 0 && $ju_total2 <> 0 && $ju_total <> "" && $ju_total2 <> ""){
                            $ju_total_ave = (floor(((int)$ju_total / (int)$ju_total2) * 10)) / 10;
                        } else {
                            $ju_total_ave = "---";
                        }
                        if($ju_total_ave <> 0 && $ju_total_ave <> ""){$ju_total_ave = number_format((int)$ju_total_ave);}
                        $ju_ave_html .= "<div class='title7 ta_r'>" . $ju_total_ave . "</div>";


                /************************************************************************************************************************************************************************************************************* */
                    // 現在・Jackアンティーク平均単価
                /************************************************************************************************************************************************************************************************************* */

                    $i = 0;
                    $ja_average = "";
                    $ja_ave_html = "";
                    $ja_total = "";
                    $ja_total2 = "";
                    $ja_total_ave = "";
                    foreach($temp4_ja_manthly_array as $var){
                
                        if($var == 0){
                            $ja_average = 0;
                            $ja_total = (int)$ja_total + (int)$var;
                            if($temp4_ja_manthly_array2[$i] == 0){
                                $ja_total2 = $ja_total2;
                            } else {
                                $ja_total2 = (int)$ja_total2 + (int)$temp4_ja_manthly_array2[$i];
                            }
                        } else {
                            $ja_average = (floor(((int)$var / (int)$temp4_ja_manthly_array2[$i])) * 10) / 10;
                            $ja_total = (int)$ja_total + (int)$var;
                            if($temp4_ja_manthly_array2[$i] == 0){
                                $ja_total2 = $ja_total2;
                            } else {
                                $ja_total2 = (int)$ja_total2 + (int)$temp4_ja_manthly_array2[$i];
                            }
                        }
                        if($ja_average <> 0 && $ja_average <> ""){$ja_average = number_format((int)$ja_average);}
                        $ja_ave_html .= "<div class='title7 ta_r'>" . $ja_average . "</div>";
                
                        $i++;
                    }
                    // 期間中の売上合計に対する平均単価を取得
                        if($ja_total <> 0 && $ja_total2 <> 0 && $ja_total <> "" && $ja_total2 <> ""){
                            $ja_total_ave = (floor(((int)$ja_total / (int)$ja_total2) * 10)) / 10;
                        } else {
                            $ja_total_ave = "---";
                        }
                        if($ja_total_ave <> 0 && $ja_total_ave <> ""){$ja_total_ave = number_format((int)$ja_total_ave);}
                        $ja_ave_html .= "<div class='title7 ta_r'>" . $ja_total_ave . "</div>";


                /************************************************************************************************************************************************************************************************************* */
                    // 現在・Betty新品平均単価
                /************************************************************************************************************************************************************************************************************* */

                    $i = 0;
                    $bn_average = "";
                    $bn_ave_html = "";
                    $bn_total = "";
                    $bn_total2 = "";
                    $bn_total_ave = "";
                    foreach($temp4_bn_manthly_array as $var){
                
                        if($var == 0){
                            $bn_average = 0;
                            $bn_total = (int)$bn_total + (int)$var;
                            if($temp4_bn_manthly_array2[$i] == 0){
                                $bn_total2 = $bn_total2;
                            } else {
                                $bn_total2 = (int)$bn_total2 + (int)$temp4_bn_manthly_array2[$i];
                            }
                        } else {
                            $bn_average = (floor(((int)$var / (int)$temp4_bn_manthly_array2[$i])) * 10) / 10;
                            $bn_total = (int)$bn_total + (int)$var;
                            if($temp4_bn_manthly_array2[$i] == 0){
                                $bn_total2 = $bn_total2;
                            } else {
                                $bn_total2 = (int)$bn_total2 + (int)$temp4_bn_manthly_array2[$i];
                            }
                        }
                        if($bn_average <> 0 && $bn_average <> ""){$bn_average = number_format((int)$bn_average);}
                        $bn_ave_html .= "<div class='title7 ta_r'>" . $bn_average . "</div>";
                
                        $i++;
                    }
                    // 期間中の売上合計に対する平均単価を取得
                        if($bn_total <> 0 && $bn_total2 <> 0 && $bn_total <> "" && $bn_total2 <> ""){
                            $bn_total_ave = (floor(((int)$bn_total / (int)$bn_total2) * 10)) / 10;
                        } else {
                            $bn_total_ave = "---";
                        }
                        if($bn_total_ave <> 0 && $bn_total_ave <> ""){$bn_total_ave = number_format((int)$bn_total_ave);}
                        $bn_ave_html .= "<div class='title7 ta_r'>" . $bn_total_ave . "</div>";



                /************************************************************************************************************************************************************************************************************* */
                    // 現在・Betty中古平均単価
                /************************************************************************************************************************************************************************************************************* */

                    $i = 0;
                    $bu_average = "";
                    $bu_ave_html = "";
                    $bu_total = "";
                    $bu_total2 = "";
                    $bu_total_ave = "";
                    foreach($temp4_bu_manthly_array as $var){
                
                        if($var == 0){
                            $bu_average = 0;
                            $bu_total = (int)$bu_total + (int)$var;
                            if($temp4_bu_manthly_array2[$i] == 0){
                                $bu_total2 = $bu_total2;
                            } else {
                                $bu_total2 = (int)$bu_total2 + (int)$temp4_bu_manthly_array2[$i];
                            }
                        } else {
                            $bu_average = (floor(((int)$var / (int)$temp4_bu_manthly_array2[$i])) * 10) / 10;
                            $bu_total = (int)$bu_total + (int)$var;
                            if($temp4_bu_manthly_array2[$i] == 0){
                                $bu_total2 = $bu_total2;
                            } else {
                                $bu_total2 = (int)$bu_total2 + (int)$temp4_bu_manthly_array2[$i];
                            }
                        }
                        if($bu_average <> 0 && $bu_average <> ""){$bu_average = number_format((int)$bu_average);}
                        $bu_ave_html .= "<div class='title7 ta_r'>" . $bu_average . "</div>";
                
                        $i++;
                    }
                    // 期間中の売上合計に対する平均単価を取得
                        if($bu_total <> 0 && $bu_total2 <> 0 && $bu_total <> "" && $bu_total2 <> ""){
                            $bu_total_ave = (floor(((int)$bu_total / (int)$bu_total2) * 10)) / 10;
                        } else {
                            $bu_total_ave = "---";
                        }
                        if($bu_total_ave <> 0 && $bu_total_ave <> ""){$bu_total_ave = number_format((int)$bu_total_ave);}
                        $bu_ave_html .= "<div class='title7 ta_r'>" . $bu_total_ave . "</div>";


                /************************************************************************************************************************************************************************************************************* */
                    // 現在・Bettyアンティーク平均単価
                /************************************************************************************************************************************************************************************************************* */

                    $i = 0;
                    $ba_average = "";
                    $ba_ave_html = "";
                    $ba_total = "";
                    $ba_total2 = "";
                    $ba_total_ave = "";
                    foreach($temp4_ba_manthly_array as $var){
                
                        if($var == 0){
                            $ba_average = 0;
                            $ba_total = (int)$ba_total + (int)$var;
                            if($temp4_ba_manthly_array2[$i] == 0){
                                $ba_total2 = $ba_total2;
                            } else {
                                $ba_total2 = (int)$ba_total2 + (int)$temp4_ba_manthly_array2[$i];
                            }
                        } else {
                            $ba_average = (floor(((int)$var / (int)$temp4_ba_manthly_array2[$i])) * 10) / 10;
                            $ba_total = (int)$ba_total + (int)$var;
                            if($temp4_ba_manthly_array2[$i] == 0){
                                $ba_total2 = $ba_total2;
                            } else {
                                $ba_total2 = (int)$ba_total2 + (int)$temp4_ba_manthly_array2[$i];
                            }
                        }
                        if($ba_average <> 0 && $ba_average <> ""){$ba_average = number_format((int)$ba_average);}
                        $ba_ave_html .= "<div class='title7 ta_r'>" . $ba_average . "</div>";
                
                        $i++;
                    }
                    // 期間中の売上合計に対する平均単価を取得
                        if($ba_total <> 0 && $ba_total2 <> 0 && $ba_total <> "" && $ba_total2 <> ""){
                            $ba_total_ave = (floor(((int)$ba_total / (int)$ba_total2) * 10)) / 10;
                        } else {
                            $ba_total_ave = "---";
                        }
                        if($ba_total_ave <> 0 && $ba_total_ave <> ""){$ba_total_ave = number_format((int)$ba_total_ave);}
                        $ba_ave_html .= "<div class='title7 ta_r'>" . $ba_total_ave . "</div>";



                /************************************************************************************************************************************************************************************************************* */
                    // 現在・ジュエリー新品平均単価
                /************************************************************************************************************************************************************************************************************* */

                    $i = 0;
                    $jln_average = "";
                    $jln_ave_html = "";
                    $jln_total = "";
                    $jln_total2 = "";
                    foreach($temp4_jln_manthly_array as $var){
                
                        if($var == 0){
                            $jln_average = 0;
                            $jln_total = (int)$jln_total + (int)$var;
                            if($temp4_jln_manthly_array2[$i] == 0){
                                $jln_total2 = $jln_total2;
                            } else {
                                $jln_total2 = (int)$jln_total2 + (int)$temp4_jln_manthly_array2[$i];
                            }
                        } else {
                            $jln_average = (floor(((int)$var / (int)$temp4_jln_manthly_array2[$i])) * 10) / 10;
                            $jln_total = (int)$jln_total + (int)$var;
                            if($temp4_jln_manthly_array2[$i] == 0){
                                $jln_total2 = $jln_total2;
                            } else {
                                $jln_total2 = (int)$jln_total2 + (int)$temp4_jln_manthly_array2[$i];
                            }
                        }
                        if($jln_average <> 0 && $jln_average <> ""){$jln_average = number_format((int)$jln_average);}
                        $jln_ave_html .= "<div class='title7 ta_r'>" . $jln_average . "</div>";
                
                        $i++;
                    }
                    // 期間中の売上合計に対する平均単価を取得
                        if($jln_total <> 0 && $jln_total2 <> 0 && $jln_total <> "" && $jln_total2 <> ""){
                            $jln_total_ave = (floor(((int)$jln_total / (int)$jln_total2) * 10)) / 10;
                        } else {
                            $jln_total_ave = "---";
                        }
                        if($jln_total_ave <> 0 && $jln_total_ave <> ""){$jln_total_ave = number_format((int)$jln_total_ave);}
                        $jln_ave_html .= "<div class='title7 ta_r'>" . $jln_total_ave . "</div>";


                /************************************************************************************************************************************************************************************************************* */
                    // 現在・ジュエリー中古平均単価
                /************************************************************************************************************************************************************************************************************* */

                    $i = 0;
                    $jlu_average = "";
                    $jlu_ave_html = "";
                    $jlu_total = "";
                    $jlu_total2 = "";
                    foreach($temp4_jlu_manthly_array as $var){
                
                        if($var == 0){
                            $jlu_average = 0;
                            $jlu_total = (int)$jlu_total + (int)$var;
                            if($temp4_jlu_manthly_array2[$i] == 0){
                                $jlu_total2 = $jlu_total2;
                            } else {
                                $jlu_total2 = (int)$jlu_total2 + (int)$temp4_jlu_manthly_array2[$i];
                            }
                        } else {
                            $jlu_average = (floor(((int)$var / (int)$temp4_jlu_manthly_array2[$i])) * 10) / 10;
                            $jlu_total = (int)$jlu_total + (int)$var;
                            if($temp4_jlu_manthly_array2[$i] == 0){
                                $jlu_total2 = $jlu_total2;
                            } else {
                                $jlu_total2 = (int)$jlu_total2 + (int)$temp4_jlu_manthly_array2[$i];
                            }
                        }
                        if($jlu_average <> 0 && $jlu_average <> ""){$jlu_average = number_format((int)$jlu_average);}
                        $jlu_ave_html .= "<div class='title7 ta_r'>" . $jlu_average . "</div>";
                
                        $i++;
                    }
                    // 期間中の売上合計に対する平均単価を取得
                        if($jlu_total <> 0 && $jlu_total2 <> 0 && $jlu_total <> "" && $jlu_total2 <> ""){
                            $jlu_total_ave = (floor(((int)$jlu_total / (int)$jlu_total2) * 10)) / 10;
                        } else {
                            $jlu_total_ave = "---";
                        }
                        if($jlu_total_ave <> 0 && $jlu_total_ave <> ""){$jlu_total_ave = number_format((int)$jlu_total_ave);}
                        $jlu_ave_html .= "<div class='title7 ta_r'>" . $jlu_total_ave . "</div>";


                /************************************************************************************************************************************************************************************************************* */
                    // 現在・バッグ新品平均単価
                /************************************************************************************************************************************************************************************************************* */

                    $i = 0;
                    $bgn_average = "";
                    $bgn_ave_html = "";
                    $bgn_total = "";
                    $bgn_total2 = "";
                    foreach($temp4_bgn_manthly_array as $var){
                
                        if($var == 0){
                            $bgn_average = 0;
                            $bgn_total = (int)$bgn_total + (int)$var;
                            if($temp4_bgn_manthly_array2[$i] == 0){
                                $bgn_total2 = $bgn_total2;
                            } else {
                                $bgn_total2 = (int)$bgn_total2 + (int)$temp4_bgn_manthly_array2[$i];
                            }
                        } else {
                            $bgn_average = (floor(((int)$var / (int)$temp4_bgn_manthly_array2[$i])) * 10) / 10;
                            $bgn_total = (int)$bgn_total + (int)$var;
                            if($temp4_bgn_manthly_array2[$i] == 0){
                                $bgn_total2 = $bgn_total2;
                            } else {
                                $bgn_total2 = (int)$bgn_total2 + (int)$temp4_bgn_manthly_array2[$i];
                            }
                        }
                        if($bgn_average <> 0 && $bgn_average <> ""){$bgn_average = number_format((int)$bgn_average);}
                        $bgn_ave_html .= "<div class='title7 ta_r'>" . $bgn_average . "</div>";
                
                        $i++;
                    }
                    // 期間中の売上合計に対する平均単価を取得
                        if($bgn_total <> 0 && $bgn_total2 <> 0 && $bgn_total <> "" && $bgn_total2 <> ""){
                            $bgn_total_ave = (floor(((int)$bgn_total / (int)$bgn_total2) * 10)) / 10;
                        } else {
                            $bgn_total_ave = "---";
                        }
                        if($bgn_total_ave <> 0 && $bgn_total_ave <> ""){$bgn_total_ave = number_format((int)$bgn_total_ave);}
                        $bgn_ave_html .= "<div class='title7 ta_r'>" . $bgn_total_ave . "</div>";

                /************************************************************************************************************************************************************************************************************* */
                    // 現在・バッグ中古平均単価
                /************************************************************************************************************************************************************************************************************* */

                    $i = 0;
                    $bgu_average = "";
                    $bgu_ave_html = "";
                    $bgu_total = "";
                    $bgu_total2 = "";
                    foreach($temp4_bgu_manthly_array as $var){
                
                        if($var == 0){
                            $bgu_average = 0;
                            $bgu_total = (int)$bgu_total + (int)$var;
                            if($temp4_bgu_manthly_array2[$i] == 0){
                                $bgu_total2 = $bgu_total2;
                            } else {
                                $bgu_total2 = (int)$bgu_total2 + (int)$temp4_bgu_manthly_array2[$i];
                            }
                        } else {
                            $bgu_average = (floor(((int)$var / (int)$temp4_bgu_manthly_array2[$i])) * 10) / 10;
                            $bgu_total = (int)$bgu_total + (int)$var;
                            if($temp4_bgu_manthly_array2[$i] == 0){
                                $bgu_total2 = $bgu_total2;
                            } else {
                                $bgu_total2 = (int)$bgu_total2 + (int)$temp4_bgu_manthly_array2[$i];
                            }
                        }
                        if($bgu_average <> 0 && $bgu_average <> ""){$bgu_average = number_format((int)$bgu_average);}
                        $bgu_ave_html .= "<div class='title7 ta_r'>" . $bgu_average . "</div>";
                
                        $i++;
                    }
                    // 期間中の売上合計に対する平均単価を取得
                        if($bgu_total <> 0 && $bgu_total2 <> 0 && $bgu_total <> "" && $bgu_total2 <> ""){
                            $bgu_total_ave = (floor(((int)$bgu_total / (int)$bgu_total2) * 10)) / 10;
                        } else {
                            $bgu_total_ave = "---";
                        }
                        if($bgu_total_ave <> 0 && $bgu_total_ave <> ""){$bgu_total_ave = number_format((int)$bgu_total_ave);}
                        $bgu_ave_html .= "<div class='title7 ta_r'>" . $bgu_total_ave . "</div>";


                        $temp4_all_sorce9 = "<p class='title_a'>平均単価</p><div class='box1'>" . $temp4_title4;
                        $temp4_all_sorce9 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・N</div>" . $jn_ave_html . "</div>";
                        $temp4_all_sorce9 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・U</div>" . $ju_ave_html . "</div>";
                        $temp4_all_sorce9 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・A</div>" . $ja_ave_html . "</div>";
                        $temp4_all_sorce9 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・N</div>" . $bn_ave_html . "</div>";
                        $temp4_all_sorce9 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・U</div>" . $bu_ave_html . "</div>";
                        $temp4_all_sorce9 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・A</div>" . $ba_ave_html . "</div>";
                        $temp4_all_sorce9 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・N</div>" . $jln_ave_html . "</div>";
                        $temp4_all_sorce9 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・U</div>" . $jlu_ave_html . "</div>";
                        $temp4_all_sorce9 .= "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・N</div>" . $bgn_ave_html . "</div>";
                        $temp4_all_sorce9 .= "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・U</div>" . $bgu_ave_html . "</div>";
                        $temp4_all_sorce9 .= "</div>";
                    

                /************************************************************************************************************************************************************************************************************* */
                    // jack新品・金額・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $jn_ratio = "";
					    $jn_ratio_html = "";
					    $jn_total = "";
					    $jn_total_past = "";
					    $jn_total_ratio = "";
					    foreach($temp4_jn_manthly_array as $var){
					        if($var == 0){
					            $jn_ratio = "---";
					            $jn_total = $jn_total;
					            if($past_temp4_jn_manthly_array[$i] == 0){
					                $jn_total_past = $jn_total_past;
					            } else {
					                $jn_total_past = (int)$jn_total_past + (int)$past_temp4_jn_manthly_array[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_jn_manthly_array[$i] == 0 || $var == "" || $past_temp4_jn_manthly_array[$i] == ""){
					                $jn_ratio = "---";
					            } else {
					                $jn_ratio = number_format((floor(($var / $past_temp4_jn_manthly_array[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $jn_total = (int)$jn_total + (int)$var;
					            if($past_temp4_jn_manthly_array[$i] == 0){
					                $jn_total_past = $jn_total_past;
					            } else {
					                $jn_total_past = (int)$jn_total_past + (int)$past_temp4_jn_manthly_array[$i];
					            }
					        }
					        if($jn_ratio < 100){
					            $jn_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $jn_ratio . "%</div>";
					        } else {
					            $jn_ratio_html .= "<div class='title7 ta_r fc_red'>" . $jn_ratio . "%</div>";
					        }
					        

					        $i++;
					    }
					    // 過去の同期間売上金額に対する比率を取得
					        if($jn_total <> 0 && $jn_total_past <> 0 && $jn_total <> "" && $jn_total_past <> ""){
					            $jn_total_ratio = number_format((floor(((float)$jn_total / (float)$jn_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $jn_total_ratio = "---";
					        }

					        if($jn_total_ratio < 100){
					            $jn_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $jn_total_ratio . "%</div>";
					        } else {
					            $jn_ratio_html .= "<div class='title7 ta_r fc_red'>" . $jn_total_ratio . "%</div>";
					        }


                /************************************************************************************************************************************************************************************************************* */
                    // jack中古・金額・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $ju_ratio = "";
					    $ju_ratio_html = "";
					    $ju_total = "";
					    $ju_total_past = "";
					    $ju_total_ratio = "";
					    foreach($temp4_ju_manthly_array as $var){
					        if($var == 0){
					            $ju_ratio = "---";
					            $ju_total = $ju_total;
					            if($past_temp4_ju_manthly_array[$i] == 0){
					                $ju_total_past = $ju_total_past;
					            } else {
					                $ju_total_past = (int)$ju_total_past + (int)$past_temp4_ju_manthly_array[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_ju_manthly_array[$i] == 0 || $var == "" || $past_temp4_ju_manthly_array[$i] == ""){
					                $ju_ratio = "---";
					            } else {
					                $ju_ratio = number_format((floor(($var / $past_temp4_ju_manthly_array[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $ju_total = (int)$ju_total + (int)$var;
					            if($past_temp4_ju_manthly_array[$i] == 0){
					                $ju_total_past = $ju_total_past;
					            } else {
					                $ju_total_past = (int)$ju_total_past + (int)$past_temp4_ju_manthly_array[$i];
					            }
					        }
					        if($ju_ratio < 100){
					            $ju_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ju_ratio . "%</div>";
					        } else {
					            $ju_ratio_html .= "<div class='title7 ta_r fc_red'>" . $ju_ratio . "%</div>";
					        }
					        

					        $i++;
					    }
					    // 過去の同期間売上金額に対する比率を取得
					        if($ju_total <> 0 && $ju_total_past <> 0 && $ju_total <> "" && $ju_total_past <> ""){
					            $ju_total_ratio = number_format((floor(((float)$ju_total / (float)$ju_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $ju_total_ratio = "---";
					        }

					        if($ju_total_ratio < 100){
					            $ju_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ju_total_ratio . "%</div>";
					        } else {
					            $ju_ratio_html .= "<div class='title7 ta_r fc_red'>" . $ju_total_ratio . "%</div>";
					        }


                /************************************************************************************************************************************************************************************************************* */
                    // jackアンティーク・金額・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $ja_ratio = "";
					    $ja_ratio_html = "";
					    $ja_total = "";
					    $ja_total_past = "";
					    $ja_total_ratio = "";
					    foreach($temp4_ja_manthly_array as $var){
					        if($var == 0){
					            $ja_ratio = "---";
					            $ja_total = $ja_total;
					            if($past_temp4_ja_manthly_array[$i] == 0){
					                $ja_total_past = $ja_total_past;
					            } else {
					                $ja_total_past = (int)$ja_total_past + (int)$past_temp4_ja_manthly_array[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_ja_manthly_array[$i] == 0 || $var == "" || $past_temp4_ja_manthly_array[$i] == ""){
					                $ja_ratio = "---";
					            } else {
					                $ja_ratio = number_format((floor(($var / $past_temp4_ja_manthly_array[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $ja_total = (int)$ja_total + (int)$var;
					            if($past_temp4_ja_manthly_array[$i] == 0){
					                $ja_total_past = $ja_total_past;
					            } else {
					                $ja_total_past = (int)$ja_total_past + (int)$past_temp4_ja_manthly_array[$i];
					            }
					        }
					        if($ja_ratio < 100){
					            $ja_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ja_ratio . "%</div>";
					        } else {
					            $ja_ratio_html .= "<div class='title7 ta_r fc_red'>" . $ja_ratio . "%</div>";
					        }
					        

					        $i++;
					    }
					    // 過去の同期間売上金額に対する比率を取得
					        if($ja_total <> 0 && $ja_total_past <> 0 && $ja_total <> "" && $ja_total_past <> ""){
					            $ja_total_ratio = number_format((floor(((float)$ja_total / (float)$ja_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $ja_total_ratio = "---";
					        }

					        if($ja_total_ratio < 100){
					            $ja_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ja_total_ratio . "%</div>";
					        } else {
					            $ja_ratio_html .= "<div class='title7 ta_r fc_red'>" . $ja_total_ratio . "%</div>";
					        }


                /************************************************************************************************************************************************************************************************************* */
                    // Betty新品・金額・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $bn_ratio = "";
					    $bn_ratio_html = "";
					    $bn_total = "";
					    $bn_total_past = "";
					    $bn_total_ratio = "";
					    foreach($temp4_bn_manthly_array as $var){
					        if($var == 0){
					            $bn_ratio = "---";
					            $bn_total = $bn_total;
					            if($past_temp4_bn_manthly_array[$i] == 0){
					                $bn_total_past = $bn_total_past;
					            } else {
					                $bn_total_past = (int)$bn_total_past + (int)$past_temp4_bn_manthly_array[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_bn_manthly_array[$i] == 0 || $var == "" || $past_temp4_bn_manthly_array[$i] == ""){
					                $bn_ratio = "---";
					            } else {
					                $bn_ratio = number_format((floor(($var / $past_temp4_bn_manthly_array[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $bn_total = (int)$bn_total + (int)$var;
					            if($past_temp4_bn_manthly_array[$i] == 0){
					                $bn_total_past = $bn_total_past;
					            } else {
					                $bn_total_past = (int)$bn_total_past + (int)$past_temp4_bn_manthly_array[$i];
					            }
					        }
					        if($bn_ratio < 100){
					            $bn_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bn_ratio . "%</div>";
					        } else {
					            $bn_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bn_ratio . "%</div>";
					        }
					        

					        $i++;
					    }
					    // 過去の同期間売上金額に対する比率を取得
					        if($bn_total <> 0 && $bn_total_past <> 0 && $bn_total <> "" && $bn_total_past <> ""){
					            $bn_total_ratio = number_format((floor(((float)$bn_total / (float)$bn_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $bn_total_ratio = "---";
					        }

					        if($bn_total_ratio < 100){
					            $bn_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bn_total_ratio . "%</div>";
					        } else {
					            $bn_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bn_total_ratio . "%</div>";
					        }


                /************************************************************************************************************************************************************************************************************* */
                    // Betty中古・金額・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $bu_ratio = "";
					    $bu_ratio_html = "";
					    $bu_total = "";
					    $bu_total_past = "";
					    $bu_total_ratio = "";
					    foreach($temp4_bu_manthly_array as $var){
					        if($var == 0){
					            $bu_ratio = "---";
					            $bu_total = $bu_total;
					            if($past_temp4_bu_manthly_array[$i] == 0){
					                $bu_total_past = $bu_total_past;
					            } else {
					                $bu_total_past = (int)$bu_total_past + (int)$past_temp4_bu_manthly_array[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_bu_manthly_array[$i] == 0 || $var == "" || $past_temp4_bu_manthly_array[$i] == ""){
					                $bu_ratio = "---";
					            } else {
					                $bu_ratio = number_format((floor(($var / $past_temp4_bu_manthly_array[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $bu_total = (int)$bu_total + (int)$var;
					            if($past_temp4_bu_manthly_array[$i] == 0){
					                $bu_total_past = $bu_total_past;
					            } else {
					                $bu_total_past = (int)$bu_total_past + (int)$past_temp4_bu_manthly_array[$i];
					            }
					        }
					        if($bu_ratio < 100){
					            $bu_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bu_ratio . "%</div>";
					        } else {
					            $bu_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bu_ratio . "%</div>";
					        }
					        

					        $i++;
					    }
					    // 過去の同期間売上金額に対する比率を取得
					        if($bu_total <> 0 && $bu_total_past <> 0 && $bu_total <> "" && $bu_total_past <> ""){
					            $bu_total_ratio = number_format((floor(((float)$bu_total / (float)$bu_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $bu_total_ratio = "---";
					        }

					        if($bu_total_ratio < 100){
					            $bu_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bu_total_ratio . "%</div>";
					        } else {
					            $bu_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bu_total_ratio . "%</div>";
					        }



                /************************************************************************************************************************************************************************************************************* */
                    // Bettyアンティーク・金額・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $ba_ratio = "";
					    $ba_ratio_html = "";
					    $ba_total = "";
					    $ba_total_past = "";
					    $ba_total_ratio = "";
					    foreach($temp4_ba_manthly_array as $var){
					        if($var == 0){
					            $ba_ratio = "---";
					            $ba_total = $ba_total;
					            if($past_temp4_ba_manthly_array[$i] == 0){
					                $ba_total_past = $ba_total_past;
					            } else {
					                $ba_total_past = (int)$ba_total_past + (int)$past_temp4_ba_manthly_array[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_ba_manthly_array[$i] == 0 || $var == "" || $past_temp4_ba_manthly_array[$i] == ""){
					                $ba_ratio = "---";
					            } else {
					                $ba_ratio = number_format((floor(($var / $past_temp4_ba_manthly_array[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $ba_total = (int)$ba_total + (int)$var;
					            if($past_temp4_ba_manthly_array[$i] == 0){
					                $ba_total_past = $ba_total_past;
					            } else {
					                $ba_total_past = (int)$ba_total_past + (int)$past_temp4_ba_manthly_array[$i];
					            }
					        }
					        if($ba_ratio < 100){
					            $ba_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ba_ratio . "%</div>";
					        } else {
					            $ba_ratio_html .= "<div class='title7 ta_r fc_red'>" . $ba_ratio . "%</div>";
					        }
					        

					        $i++;
					    }
					    // 過去の同期間売上金額に対する比率を取得
					        if($ba_total <> 0 && $ba_total_past <> 0 && $ba_total <> "" && $ba_total_past <> ""){
					            $ba_total_ratio = number_format((floor(((float)$ba_total / (float)$ba_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $ba_total_ratio = "---";
					        }

					        if($ba_total_ratio < 100){
					            $ba_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ba_total_ratio . "%</div>";
					        } else {
					            $ba_ratio_html .= "<div class='title7 ta_r fc_red'>" . $ba_total_ratio . "%</div>";
					        }


                /************************************************************************************************************************************************************************************************************* */
                    // ジュエリー新品・金額・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $jln_ratio = "";
					    $jln_ratio_html = "";
					    $jln_total = "";
					    $jln_total_past = "";
					    $jln_total_ratio = "";
					    foreach($temp4_jln_manthly_array as $var){
					        if($var == 0){
					            $jln_ratio = "---";
					            $jln_total = $jln_total;
					            if($past_temp4_jln_manthly_array[$i] == 0){
					                $jln_total_past = $jln_total_past;
					            } else {
					                $jln_total_past = (int)$jln_total_past + (int)$past_temp4_jln_manthly_array[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_jln_manthly_array[$i] == 0 || $var == "" || $past_temp4_jln_manthly_array[$i] == ""){
					                $jln_ratio = "---";
					            } else {
					                $jln_ratio = number_format((floor(($var / $past_temp4_jln_manthly_array[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $jln_total = (int)$jln_total + (int)$var;
					            if($past_temp4_jln_manthly_array[$i] == 0){
					                $jln_total_past = $jln_total_past;
					            } else {
					                $jln_total_past = (int)$jln_total_past + (int)$past_temp4_jln_manthly_array[$i];
					            }
					        }
					        if($jln_ratio < 100){
					            $jln_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $jln_ratio . "%</div>";
					        } else {
					            $jln_ratio_html .= "<div class='title7 ta_r fc_red'>" . $jln_ratio . "%</div>";
					        }
					        

					        $i++;
					    }
					    // 過去の同期間売上金額に対する比率を取得
					        if($jln_total <> 0 && $jln_total_past <> 0 && $jln_total <> "" && $jln_total_past <> ""){
					            $jln_total_ratio = number_format((floor(((float)$jln_total / (float)$jln_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $jln_total_ratio = "---";
					        }

					        if($jln_total_ratio < 100){
					            $jln_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $jln_total_ratio . "%</div>";
					        } else {
					            $jln_ratio_html .= "<div class='title7 ta_r fc_red'>" . $jln_total_ratio . "%</div>";
					        }

                /************************************************************************************************************************************************************************************************************* */
                    // ジュエリー中古・金額・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $jlu_ratio = "";
					    $jlu_ratio_html = "";
					    $jlu_total = "";
					    $jlu_total_past = "";
					    $jlu_total_ratio = "";
					    foreach($temp4_jlu_manthly_array as $var){
					        if($var == 0){
					            $jlu_ratio = "---";
					            $jlu_total = $jlu_total;
					            if($past_temp4_jlu_manthly_array[$i] == 0){
					                $jlu_total_past = $jlu_total_past;
					            } else {
					                $jlu_total_past = (int)$jlu_total_past + (int)$past_temp4_jlu_manthly_array[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_jlu_manthly_array[$i] == 0 || $var == "" || $past_temp4_jlu_manthly_array[$i] == ""){
					                $jlu_ratio = "---";
					            } else {
					                $jlu_ratio = number_format((floor(($var / $past_temp4_jlu_manthly_array[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $jlu_total = (int)$jlu_total + (int)$var;
					            if($past_temp4_jlu_manthly_array[$i] == 0){
					                $jlu_total_past = $jlu_total_past;
					            } else {
					                $jlu_total_past = (int)$jlu_total_past + (int)$past_temp4_jlu_manthly_array[$i];
					            }
					        }
					        if($jlu_ratio < 100){
					            $jlu_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $jlu_ratio . "%</div>";
					        } else {
					            $jlu_ratio_html .= "<div class='title7 ta_r fc_red'>" . $jlu_ratio . "%</div>";
					        }
					        

					        $i++;
					    }
					    // 過去の同期間売上金額に対する比率を取得
					        if($jlu_total <> 0 && $jlu_total_past <> 0 && $jlu_total <> "" && $jlu_total_past <> ""){
					            $jlu_total_ratio = number_format((floor(((float)$jlu_total / (float)$jlu_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $jlu_total_ratio = "---";
					        }

					        if($jlu_total_ratio < 100){
					            $jlu_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $jlu_total_ratio . "%</div>";
					        } else {
					            $jlu_ratio_html .= "<div class='title7 ta_r fc_red'>" . $jlu_total_ratio . "%</div>";
					        }



                /************************************************************************************************************************************************************************************************************* */
                    // バッグ新品・金額・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $bgn_ratio = "";
					    $bgn_ratio_html = "";
					    $bgn_total = "";
					    $bgn_total_past = "";
					    $bgn_total_ratio = "";
					    foreach($temp4_bgn_manthly_array as $var){
					        if($var == 0){
					            $bgn_ratio = "---";
					            $bgn_total = $bgn_total;
					            if($past_temp4_bgn_manthly_array[$i] == 0){
					                $bgn_total_past = $bgn_total_past;
					            } else {
					                $bgn_total_past = (int)$bgn_total_past + (int)$past_temp4_bgn_manthly_array[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_bgn_manthly_array[$i] == 0 || $var == "" || $past_temp4_bgn_manthly_array[$i] == ""){
					                $bgn_ratio = "---";
					            } else {
					                $bgn_ratio = number_format((floor(($var / $past_temp4_bgn_manthly_array[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $bgn_total = (int)$bgn_total + (int)$var;
					            if($past_temp4_bgn_manthly_array[$i] == 0){
					                $bgn_total_past = $bgn_total_past;
					            } else {
					                $bgn_total_past = (int)$bgn_total_past + (int)$past_temp4_bgn_manthly_array[$i];
					            }
					        }
					        if($bgn_ratio < 100){
					            $bgn_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bgn_ratio . "%</div>";
					        } else {
					            $bgn_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bgn_ratio . "%</div>";
					        }
					        

					        $i++;
					    }
					    // 過去の同期間売上金額に対する比率を取得
					        if($bgn_total <> 0 && $bgn_total_past <> 0 && $bgn_total <> "" && $bgn_total_past <> ""){
					            $bgn_total_ratio = number_format((floor(((float)$bgn_total / (float)$bgn_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $bgn_total_ratio = "---";
					        }

					        if($bgn_total_ratio < 100){
					            $bgn_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bgn_total_ratio . "%</div>";
					        } else {
					            $bgn_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bgn_total_ratio . "%</div>";
					        }


                /************************************************************************************************************************************************************************************************************* */
                    // バッグ中古・金額・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $bgu_ratio = "";
					    $bgu_ratio_html = "";
					    $bgu_total = "";
					    $bgu_total_past = "";
					    $bgu_total_ratio = "";
					    foreach($temp4_bgu_manthly_array as $var){
					        if($var == 0){
					            $bgu_ratio = "---";
					            $bgu_total = $bgu_total;
					            if($past_temp4_bgu_manthly_array[$i] == 0){
					                $bgu_total_past = $bgu_total_past;
					            } else {
					                $bgu_total_past = (int)$bgu_total_past + (int)$past_temp4_bgu_manthly_array[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_bgu_manthly_array[$i] == 0 || $var == "" || $past_temp4_bgu_manthly_array[$i] == ""){
					                $bgu_ratio = "---";
					            } else {
					                $bgu_ratio = number_format((floor(($var / $past_temp4_bgu_manthly_array[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $bgu_total = (int)$bgu_total + (int)$var;
					            if($past_temp4_bgu_manthly_array[$i] == 0){
					                $bgu_total_past = $bgu_total_past;
					            } else {
					                $bgu_total_past = (int)$bgu_total_past + (int)$past_temp4_bgu_manthly_array[$i];
					            }
					        }
					        if($bgu_ratio < 100){
					            $bgu_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bgu_ratio . "%</div>";
					        } else {
					            $bgu_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bgu_ratio . "%</div>";
					        }
					        

					        $i++;
					    }
					    // 過去の同期間売上金額に対する比率を取得
					        if($bgu_total <> 0 && $bgu_total_past <> 0 && $bgu_total <> "" && $bgu_total_past <> ""){
					            $bgu_total_ratio = number_format((floor(((float)$bgu_total / (float)$bgu_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $bgu_total_ratio = "---";
					        }

					        if($bgu_total_ratio < 100){
					            $bgu_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bgu_total_ratio . "%</div>";
					        } else {
					            $bgu_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bgu_total_ratio . "%</div>";
					        }




                /************************************************************************************************************************************************************************************************************* */
                    // 合計金額・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $ratio = "";
					    $ratio_html = "";
					    $total = "";
					    $total_past = "";
					    $total_ratio = "";
					    foreach($temp4_jn_manthly_array as $var){
					        if($var == 0 && $temp4_jn_manthly_array[$i] == 0){
					            $ratio = 0;
					            $total = $total;
					            if($past_temp4_jn_manthly_array[$i] == 0 && $past_temp4_ju_manthly_array[$i] == 0 && $past_temp4_ja_manthly_array[$i] == 0 && $past_temp4_bn_manthly_array[$i] == 0 && $past_temp4_bu_manthly_array[$i] == 0 && $past_temp4_ba_manthly_array[$i] == 0){
					                $total_past = $total_past;
					            } else {
					                    $total_past = (int)$total_past + (int)$past_temp4_jn_manthly_array[$i] + (int)$past_temp4_ju_manthly_array[$i] + (int)$past_temp4_ja_manthly_array[$i] + (int)$past_temp4_bn_manthly_array[$i] + (int)$past_temp4_bu_manthly_array[$i] + (int)$past_temp4_ba_manthly_array[$i] + (int)$past_temp4_jln_manthly_array[$i] + (int)$past_temp4_jlu_manthly_array[$i] + (int)$past_temp4_bgn_manthly_array[$i] + (int)$past_temp4_bgu_manthly_array[$i];
					            }
					        } else {
					                if((int)$total_past + (int)$temp4_jn_manthly_array[$i] + (int)$temp4_ju_manthly_array[$i] + (int)$temp4_ja_manthly_array[$i] + (int)$temp4_bn_manthly_array[$i] + (int)$temp4_bu_manthly_array[$i] + (int)$temp4_ba_manthly_array[$i] + (int)$temp4_jln_manthly_array[$i] + (int)$temp4_jlu_manthly_array[$i] + (int)$temp4_bgn_manthly_array[$i] + (int)$temp4_bgu_manthly_array[$i] == 0 || (int)$total_past + (int)$past_temp4_jn_manthly_array[$i] + (int)$past_temp4_ju_manthly_array[$i] + (int)$past_temp4_ja_manthly_array[$i] + (int)$past_temp4_bn_manthly_array[$i] + (int)$past_temp4_bu_manthly_array[$i] + (int)$past_temp4_ba_manthly_array[$i] + (int)$past_temp4_jln_manthly_array[$i] + (int)$past_temp4_jlu_manthly_array[$i] + (int)$past_temp4_bgn_manthly_array[$i] + (int)$past_temp4_bgu_manthly_array[$i] == 0){
					                    $ratio = "---";
					                } else {
					                    //$ratio = number_format((floor((((int)$var + (int)$temp4_jn_manthly_array[$i] + (int)$temp4_ju_manthly_array[$i] + (int)$temp4_ja_manthly_array[$i] + (int)$temp4_bn_manthly_array[$i] + (int)$temp4_bu_manthly_array[$i] + (int)$temp4_ba_manthly_array[$i] + (int)$temp4_jln_manthly_array[$i] + (int)$temp4_jlu_manthly_array[$i] + (int)$temp4_bgn_manthly_array[$i] + (int)$temp4_bgu_manthly_array[$i]) / ((int)$total_past + (int)$past_temp4_jn_manthly_array[$i] + (int)$past_temp4_ju_manthly_array[$i] + (int)$past_temp4_ja_manthly_array[$i] + (int)$past_temp4_bn_manthly_array[$i] + (int)$past_temp4_bu_manthly_array[$i] + (int)$past_temp4_ba_manthly_array[$i] + (int)$past_temp4_jln_manthly_array[$i] + (int)$past_temp4_jlu_manthly_array[$i] + (int)$past_temp4_bgn_manthly_array[$i] + (int)$past_temp4_bgu_manthly_array[$i])) * 100 * 10)) / 10 ,1);
					                    $ratio = number_format((floor((((int)$var /*+ (int)$temp4_jn_manthly_array[$i]*/ + (int)$temp4_ju_manthly_array[$i] + (int)$temp4_ja_manthly_array[$i] + (int)$temp4_bn_manthly_array[$i] + (int)$temp4_bu_manthly_array[$i] + (int)$temp4_ba_manthly_array[$i] + (int)$temp4_jln_manthly_array[$i] + (int)$temp4_jlu_manthly_array[$i] + (int)$temp4_bgn_manthly_array[$i] + (int)$temp4_bgu_manthly_array[$i]) / (/*(int)$total_past + */(int)$past_temp4_jn_manthly_array[$i] + (int)$past_temp4_ju_manthly_array[$i] + (int)$past_temp4_ja_manthly_array[$i] + (int)$past_temp4_bn_manthly_array[$i] + (int)$past_temp4_bu_manthly_array[$i] + (int)$past_temp4_ba_manthly_array[$i] + (int)$past_temp4_jln_manthly_array[$i] + (int)$past_temp4_jlu_manthly_array[$i] + (int)$past_temp4_bgn_manthly_array[$i] + (int)$past_temp4_bgu_manthly_array[$i])) * 100 * 10)) / 10 ,1);
					                }
					                $total = (int)$total + (int)$var /*+ (int)$total_past + (int)$temp4_jn_manthly_array[$i]*/ + (int)$temp4_ju_manthly_array[$i] + (int)$temp4_ja_manthly_array[$i] + (int)$temp4_bn_manthly_array[$i] + (int)$temp4_bu_manthly_array[$i] + (int)$temp4_ba_manthly_array[$i] + (int)$temp4_jln_manthly_array[$i] + (int)$temp4_jlu_manthly_array[$i] + (int)$temp4_bgn_manthly_array[$i] + (int)$temp4_bgu_manthly_array[$i];
					                if($past_temp4_jn_manthly_array[$i] == 0 && $past_temp4_ju_manthly_array[$i] == 0 && $past_temp4_ja_manthly_array[$i] == 0 && $past_temp4_bn_manthly_array[$i] == 0 && $past_temp4_bu_manthly_array[$i] == 0 && $past_temp4_ba_manthly_array[$i] == 0){
					                    $total_past = $total_past;
					                } else {
					                    $total_past = (int)$total_past + /*(int)$total_past + */(int)$past_temp4_jn_manthly_array[$i] + (int)$past_temp4_ju_manthly_array[$i] + (int)$past_temp4_ja_manthly_array[$i] + (int)$past_temp4_bn_manthly_array[$i] + (int)$past_temp4_bu_manthly_array[$i] + (int)$past_temp4_ba_manthly_array[$i] + (int)$past_temp4_jln_manthly_array[$i] + (int)$past_temp4_jlu_manthly_array[$i] + (int)$past_temp4_bgn_manthly_array[$i] + (int)$past_temp4_bgu_manthly_array[$i];
					                }
					        }

					        if($ratio < 100){
					            $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ratio . "%</div>";
					        } else {
					            $ratio_html .= "<div class='title7 ta_r fc_red'>" . $ratio . "%</div>";
					        }

					        $i++;
					    }
					    // 過去の同期間売上金額に対する比率を取得
					        if($total <> 0 && $total_past <> 0 && $total <> "" && $total_past <> ""){
					            $total_ratio = number_format((floor(((float)$total / (float)$total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $total_ratio = "---";
					        }

					        //$ratio_html .= "<div class='title7 ta_r bg_grey'>" . $total_ratio . "%</div>";

					        if($total_ratio < 100){
					            $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $total_ratio . "%</div>";
					        } else {
					            $ratio_html .= "<div class='title7 ta_r fc_red'>" . $total_ratio . "%</div>";
					        }


					    $temp4_all_sorce10 = "<p class='title_a'>金額・過去比</p><div class='box1'>" . $temp4_title5;
					    $temp4_all_sorce10 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・N</div>" . $jn_ratio_html . "</div>";
					    $temp4_all_sorce10 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・U</div>" . $ju_ratio_html . "</div>";
					    $temp4_all_sorce10 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・A</div>" . $ja_ratio_html . "</div>";
					    $temp4_all_sorce10 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・N</div>" . $bn_ratio_html . "</div>";
					    $temp4_all_sorce10 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・U</div>" . $bu_ratio_html . "</div>";
					    $temp4_all_sorce10 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・A</div>" . $ba_ratio_html . "</div>";
					    $temp4_all_sorce10 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・N</div>" . $jln_ratio_html . "</div>";
					    $temp4_all_sorce10 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・U</div>" . $jlu_ratio_html . "</div>";
					    $temp4_all_sorce10 .= "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・N</div>" . $bgn_ratio_html . "</div>";
					    $temp4_all_sorce10 .= "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・U</div>" . $bgu_ratio_html . "</div>";
					    $temp4_all_sorce10 .= "<div class='wid100 ul4 bg_grey'><div class='title7 ta_c'>合計</div>" . $ratio_html . "</div></div>";



                /************************************************************************************************************************************************************************************************************* */
                    // jack新品・点数・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $jn_ratio = "";
					    $jn_ratio_html = "";
					    $jn_total = "";
					    $jn_total_past = "";
					    $jn_total_ratio = "";
					    foreach($temp4_jn_manthly_array2 as $var){
					        if($var == 0){
					            $jn_ratio = "---";
					            $jn_total = $jn_total;
					            if($past_temp4_jn_manthly_array2[$i] == 0){
					                $jn_total_past = $jn_total_past;
					            } else {
					                $jn_total_past = (int)$jn_total_past + (int)$past_temp4_jn_manthly_array2[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_jn_manthly_array2[$i] == 0 || $var == "" || $past_temp4_jn_manthly_array2[$i] == ""){
					                $jn_ratio = "---";
					            } else {
					                $jn_ratio = number_format((floor(($var / $past_temp4_jn_manthly_array2[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $jn_total = (int)$jn_total + (int)$var;
					            if($past_temp4_jn_manthly_array2[$i] == 0){
					                $jn_total_past = $jn_total_past;
					            } else {
					                $jn_total_past = (int)$jn_total_past + (int)$past_temp4_jn_manthly_array2[$i];
					            }
					        }

					        if($jn_ratio < 100){
					            $jn_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $jn_ratio . "%</div>";
					        } else {
					            $jn_ratio_html .= "<div class='title7 ta_r fc_red'>" . $jn_ratio . "%</div>";
					        }

					        $i++;
					    }
					    // 過去の同期間売上点数に対する比率を取得
					        if($jn_total <> 0 && $jn_total_past <> 0 && $jn_total <> "" && $jn_total_past <> ""){
					            $jn_total_ratio = number_format((floor(((float)$jn_total / (float)$jn_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $jn_total_ratio = "---";
					        }

					        //$jn_ratio_html .= "<div class='title7 ta_r'>" . $jn_total_ratio . "%</div>";

					        if($jn_total_ratio < 100){
					            $jn_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $jn_total_ratio . "%</div>";
					        } else {
					            $jn_ratio_html .= "<div class='title7 ta_r fc_red'>" . $jn_total_ratio . "%</div>";
					        }


                /************************************************************************************************************************************************************************************************************* */
                    // jack中古・点数・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $ju_ratio = "";
					    $ju_ratio_html = "";
					    $ju_total = "";
					    $ju_total_past = "";
					    $ju_total_ratio = "";
					    foreach($temp4_ju_manthly_array2 as $var){
					        if($var == 0){
					            $ju_ratio = "---";
					            $ju_total = $ju_total;
					            if($past_temp4_ju_manthly_array2[$i] == 0){
					                $ju_total_past = $ju_total_past;
					            } else {
					                $ju_total_past = (int)$ju_total_past + (int)$past_temp4_ju_manthly_array2[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_ju_manthly_array2[$i] == 0 || $var == "" || $past_temp4_ju_manthly_array2[$i] == ""){
					                $ju_ratio = "---";
					            } else {
					                $ju_ratio = number_format((floor(($var / $past_temp4_ju_manthly_array2[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $ju_total = (int)$ju_total + (int)$var;
					            if($past_temp4_ju_manthly_array2[$i] == 0){
					                $ju_total_past = $ju_total_past;
					            } else {
					                $ju_total_past = (int)$ju_total_past + (int)$past_temp4_ju_manthly_array2[$i];
					            }
					        }

					        if($ju_ratio < 100){
					            $ju_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ju_ratio . "%</div>";
					        } else {
					            $ju_ratio_html .= "<div class='title7 ta_r fc_red'>" . $ju_ratio . "%</div>";
					        }

					        $i++;
					    }
					    // 過去の同期間売上点数に対する比率を取得
					        if($ju_total <> 0 && $ju_total_past <> 0 && $ju_total <> "" && $ju_total_past <> ""){
					            $ju_total_ratio = number_format((floor(((float)$ju_total / (float)$ju_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $ju_total_ratio = "---";
					        }

					        //$ju_ratio_html .= "<div class='title7 ta_r'>" . $ju_total_ratio . "%</div>";

					        if($ju_total_ratio < 100){
					            $ju_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ju_total_ratio . "%</div>";
					        } else {
					            $ju_ratio_html .= "<div class='title7 ta_r fc_red'>" . $ju_total_ratio . "%</div>";
					        }


                /************************************************************************************************************************************************************************************************************* */
                    // jackアンティーク・点数・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $ja_ratio = "";
					    $ja_ratio_html = "";
					    $ja_total = "";
					    $ja_total_past = "";
					    $ja_total_ratio = "";
					    foreach($temp4_ja_manthly_array2 as $var){
					        if($var == 0){
					            $ja_ratio = "---";
					            $ja_total = $ja_total;
					            if($past_temp4_ja_manthly_array2[$i] == 0){
					                $ja_total_past = $ja_total_past;
					            } else {
					                $ja_total_past = (int)$ja_total_past + (int)$past_temp4_ja_manthly_array2[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_ja_manthly_array2[$i] == 0 || $var == "" || $past_temp4_ja_manthly_array2[$i] == ""){
					                $ja_ratio = "---";
					            } else {
					                $ja_ratio = number_format((floor(($var / $past_temp4_ja_manthly_array2[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $ja_total = (int)$ja_total + (int)$var;
					            if($past_temp4_ja_manthly_array2[$i] == 0){
					                $ja_total_past = $ja_total_past;
					            } else {
					                $ja_total_past = (int)$ja_total_past + (int)$past_temp4_ja_manthly_array2[$i];
					            }
					        }

					        if($ja_ratio < 100){
					            $ja_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ja_ratio . "%</div>";
					        } else {
					            $ja_ratio_html .= "<div class='title7 ta_r fc_red'>" . $ja_ratio . "%</div>";
					        }

					        $i++;
					    }
					    // 過去の同期間売上点数に対する比率を取得
					        if($ja_total <> 0 && $ja_total_past <> 0 && $ja_total <> "" && $ja_total_past <> ""){
					            $ja_total_ratio = number_format((floor(((float)$ja_total / (float)$ja_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $ja_total_ratio = "---";
					        }

					        //$ja_ratio_html .= "<div class='title7 ta_r'>" . $ja_total_ratio . "%</div>";

					        if($ja_total_ratio < 100){
					            $ja_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ja_total_ratio . "%</div>";
					        } else {
					            $ja_ratio_html .= "<div class='title7 ta_r fc_red'>" . $ja_total_ratio . "%</div>";
					        }


                /************************************************************************************************************************************************************************************************************* */
                    // Betty新品・点数・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $bn_ratio = "";
					    $bn_ratio_html = "";
					    $bn_total = "";
					    $bn_total_past = "";
					    $bn_total_ratio = "";
					    foreach($temp4_bn_manthly_array2 as $var){
					        if($var == 0){
					            $bn_ratio = "---";
					            $bn_total = $bn_total;
					            if($past_temp4_bn_manthly_array2[$i] == 0){
					                $bn_total_past = $bn_total_past;
					            } else {
					                $bn_total_past = (int)$bn_total_past + (int)$past_temp4_bn_manthly_array2[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_bn_manthly_array2[$i] == 0 || $var == "" || $past_temp4_bn_manthly_array2[$i] == ""){
					                $bn_ratio = "---";
					            } else {
					                $bn_ratio = number_format((floor(($var / $past_temp4_bn_manthly_array2[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $bn_total = (int)$bn_total + (int)$var;
					            if($past_temp4_bn_manthly_array2[$i] == 0){
					                $bn_total_past = $bn_total_past;
					            } else {
					                $bn_total_past = (int)$bn_total_past + (int)$past_temp4_bn_manthly_array2[$i];
					            }
					        }

					        if($bn_ratio < 100){
					            $bn_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bn_ratio . "%</div>";
					        } else {
					            $bn_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bn_ratio . "%</div>";
					        }

					        $i++;
					    }
					    // 過去の同期間売上点数に対する比率を取得
					        if($bn_total <> 0 && $bn_total_past <> 0 && $bn_total <> "" && $bn_total_past <> ""){
					            $bn_total_ratio = number_format((floor(((float)$bn_total / (float)$bn_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $bn_total_ratio = "---";
					        }

					        if($bn_total_ratio < 100){
					            $bn_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bn_total_ratio . "%</div>";
					        } else {
					            $bn_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bn_total_ratio . "%</div>";
					        }

                /************************************************************************************************************************************************************************************************************* */
                    // Betty中古・点数・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $bu_ratio = "";
					    $bu_ratio_html = "";
					    $bu_total = "";
					    $bu_total_past = "";
					    $bu_total_ratio = "";
					    foreach($temp4_bu_manthly_array2 as $var){
					        if($var == 0){
					            $bu_ratio = "---";
					            $bu_total = $bu_total;
					            if($past_temp4_bu_manthly_array2[$i] == 0){
					                $bu_total_past = $bu_total_past;
					            } else {
					                $bu_total_past = (int)$bu_total_past + (int)$past_temp4_bu_manthly_array2[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_bu_manthly_array2[$i] == 0 || $var == "" || $past_temp4_bu_manthly_array2[$i] == ""){
					                $bu_ratio = "---";
					            } else {
					                $bu_ratio = number_format((floor(($var / $past_temp4_bu_manthly_array2[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $bu_total = (int)$bu_total + (int)$var;
					            if($past_temp4_bu_manthly_array2[$i] == 0){
					                $bu_total_past = $bu_total_past;
					            } else {
					                $bu_total_past = (int)$bu_total_past + (int)$past_temp4_bu_manthly_array2[$i];
					            }
					        }

					        if($bu_ratio < 100){
					            $bu_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bu_ratio . "%</div>";
					        } else {
					            $bu_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bu_ratio . "%</div>";
					        }

					        $i++;
					    }
					    // 過去の同期間売上点数に対する比率を取得
					        if($bu_total <> 0 && $bu_total_past <> 0 && $bu_total <> "" && $bu_total_past <> ""){
					            $bu_total_ratio = number_format((floor(((float)$bu_total / (float)$bu_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $bu_total_ratio = "---";
					        }

					        if($bu_total_ratio < 100){
					            $bu_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bu_total_ratio . "%</div>";
					        } else {
					            $bu_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bu_total_ratio . "%</div>";
					        }



                /************************************************************************************************************************************************************************************************************* */
                    // Bettyアンティーク・点数・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $ba_ratio = "";
					    $ba_ratio_html = "";
					    $ba_total = "";
					    $ba_total_past = "";
					    $ba_total_ratio = "";
					    foreach($temp4_ba_manthly_array2 as $var){
					        if($var == 0){
					            $ba_ratio = "---";
					            $ba_total = $ba_total;
					            if($past_temp4_ba_manthly_array2[$i] == 0){
					                $ba_total_past = $ba_total_past;
					            } else {
					                $ba_total_past = (int)$ba_total_past + (int)$past_temp4_ba_manthly_array2[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_ba_manthly_array2[$i] == 0 || $var == "" || $past_temp4_ba_manthly_array2[$i] == ""){
					                $ba_ratio = "---";
					            } else {
					                $ba_ratio = number_format((floor(($var / $past_temp4_ba_manthly_array2[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $ba_total = (int)$ba_total + (int)$var;
					            if($past_temp4_ba_manthly_array2[$i] == 0){
					                $ba_total_past = $ba_total_past;
					            } else {
					                $ba_total_past = (int)$ba_total_past + (int)$past_temp4_ba_manthly_array2[$i];
					            }
					        }

					        if($ba_ratio < 100){
					            $ba_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ba_ratio . "%</div>";
					        } else {
					            $ba_ratio_html .= "<div class='title7 ta_r fc_red'>" . $ba_ratio . "%</div>";
					        }

					        $i++;
					    }
					    // 過去の同期間売上点数に対する比率を取得
					        if($ba_total <> 0 && $ba_total_past <> 0 && $ba_total <> "" && $ba_total_past <> ""){
					            $ba_total_ratio = number_format((floor(((float)$ba_total / (float)$ba_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $ba_total_ratio = "---";
					        }

					        if($ba_total_ratio < 100){
					            $ba_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ba_total_ratio . "%</div>";
					        } else {
					            $ba_ratio_html .= "<div class='title7 ta_r fc_red'>" . $ba_total_ratio . "%</div>";
					        }


                /************************************************************************************************************************************************************************************************************* */
                    // ジュエリー新品・点数・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $jln_ratio = "";
					    $jln_ratio_html = "";
					    $jln_total = "";
					    $jln_total_past = "";
					    $jln_total_ratio = "";
					    foreach($temp4_jln_manthly_array2 as $var){
					        if($var == 0){
					            $jln_ratio = "---";
					            $jln_total = $jln_total;
					            if($past_temp4_jln_manthly_array2[$i] == 0){
					                $jln_total_past = $jln_total_past;
					            } else {
					                $jln_total_past = (int)$jln_total_past + (int)$past_temp4_jln_manthly_array2[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_jln_manthly_array2[$i] == 0 || $var == "" || $past_temp4_jln_manthly_array2[$i] == ""){
					                $jln_ratio = "---";
					            } else {
					                $jln_ratio = number_format((floor(($var / $past_temp4_jln_manthly_array2[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $jln_total = (int)$jln_total + (int)$var;
					            if($past_temp4_jln_manthly_array2[$i] == 0){
					                $jln_total_past = $jln_total_past;
					            } else {
					                $jln_total_past = (int)$jln_total_past + (int)$past_temp4_jln_manthly_array2[$i];
					            }
					        }

					        if($jln_ratio < 100){
					            $jln_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $jln_ratio . "%</div>";
					        } else {
					            $jln_ratio_html .= "<div class='title7 ta_r fc_red'>" . $jln_ratio . "%</div>";
					        }

					        $i++;
					    }
					    // 過去の同期間売上点数に対する比率を取得
					        if($jln_total <> 0 && $jln_total_past <> 0 && $jln_total <> "" && $jln_total_past <> ""){
					            $jln_total_ratio = number_format((floor(((float)$jln_total / (float)$jln_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $jln_total_ratio = "---";
					        }

					        if($jln_total_ratio < 100){
					            $jln_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $jln_total_ratio . "%</div>";
					        } else {
					            $jln_ratio_html .= "<div class='title7 ta_r fc_red'>" . $jln_total_ratio . "%</div>";
					        }


                /************************************************************************************************************************************************************************************************************* */
                    // ジュエリー中古・点数・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $jlu_ratio = "";
					    $jlu_ratio_html = "";
					    $jlu_total = "";
					    $jlu_total_past = "";
					    $jlu_total_ratio = "";
					    foreach($temp4_jlu_manthly_array2 as $var){
					        if($var == 0){
					            $jlu_ratio = "---";
					            $jlu_total = $jlu_total;
					            if($past_temp4_jlu_manthly_array2[$i] == 0){
					                $jlu_total_past = $jlu_total_past;
					            } else {
					                $jlu_total_past = (int)$jlu_total_past + (int)$past_temp4_jlu_manthly_array2[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_jlu_manthly_array2[$i] == 0 || $var == "" || $past_temp4_jlu_manthly_array2[$i] == ""){
					                $jlu_ratio = "---";
					            } else {
					                $jlu_ratio = number_format((floor(($var / $past_temp4_jlu_manthly_array2[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $jlu_total = (int)$jlu_total + (int)$var;
					            if($past_temp4_jlu_manthly_array2[$i] == 0){
					                $jlu_total_past = $jlu_total_past;
					            } else {
					                $jlu_total_past = (int)$jlu_total_past + (int)$past_temp4_jlu_manthly_array2[$i];
					            }
					        }

					        if($jlu_ratio < 100){
					            $jlu_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $jlu_ratio . "%</div>";
					        } else {
					            $jlu_ratio_html .= "<div class='title7 ta_r fc_red'>" . $jlu_ratio . "%</div>";
					        }

					        $i++;
					    }
					    // 過去の同期間売上点数に対する比率を取得
					        if($jlu_total <> 0 && $jlu_total_past <> 0 && $jlu_total <> "" && $jlu_total_past <> ""){
					            $jlu_total_ratio = number_format((floor(((float)$jlu_total / (float)$jlu_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $jlu_total_ratio = "---";
					        }

					        if($jlu_total_ratio < 100){
					            $jlu_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $jlu_total_ratio . "%</div>";
					        } else {
					            $jlu_ratio_html .= "<div class='title7 ta_r fc_red'>" . $jlu_total_ratio . "%</div>";
					        }


                /************************************************************************************************************************************************************************************************************* */
                    // バッグ新品・点数・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $bgn_ratio = "";
					    $bgn_ratio_html = "";
					    $bgn_total = "";
					    $bgn_total_past = "";
					    $bgn_total_ratio = "";
					    foreach($temp4_bgn_manthly_array2 as $var){
					        if($var == 0){
					            $bgn_ratio = "---";
					            $bgn_total = $bgn_total;
					            if($past_temp4_bgn_manthly_array2[$i] == 0){
					                $bgn_total_past = $bgn_total_past;
					            } else {
					                $bgn_total_past = (int)$bgn_total_past + (int)$past_temp4_bgn_manthly_array2[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_bgn_manthly_array2[$i] == 0 || $var == "" || $past_temp4_bgn_manthly_array2[$i] == ""){
					                $bgn_ratio = "---";
					            } else {
					                $bgn_ratio = number_format((floor(($var / $past_temp4_bgn_manthly_array2[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $bgn_total = (int)$bgn_total + (int)$var;
					            if($past_temp4_bgn_manthly_array2[$i] == 0){
					                $bgn_total_past = $bgn_total_past;
					            } else {
					                $bgn_total_past = (int)$bgn_total_past + (int)$past_temp4_bgn_manthly_array2[$i];
					            }
					        }

					        if($bgn_ratio < 100){
					            $bgn_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bgn_ratio . "%</div>";
					        } else {
					            $bgn_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bgn_ratio . "%</div>";
					        }

					        $i++;
					    }
					    // 過去の同期間売上点数に対する比率を取得
					        if($bgn_total <> 0 && $bgn_total_past <> 0 && $bgn_total <> "" && $bgn_total_past <> ""){
					            $bgn_total_ratio = number_format((floor(((float)$bgn_total / (float)$bgn_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $bgn_total_ratio = "---";
					        }

					        if($bgn_total_ratio < 100){
					            $bgn_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bgn_total_ratio . "%</div>";
					        } else {
					            $bgn_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bgn_total_ratio . "%</div>";
					        }


                /************************************************************************************************************************************************************************************************************* */
                    // バッグ中古・点数・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $bgu_ratio = "";
					    $bgu_ratio_html = "";
					    $bgu_total = "";
					    $bgu_total_past = "";
					    $bgu_total_ratio = "";
					    foreach($temp4_bgu_manthly_array2 as $var){
					        if($var == 0){
					            $bgu_ratio = "---";
					            $bgu_total = $bgu_total;
					            if($past_temp4_bgu_manthly_array2[$i] == 0){
					                $bgu_total_past = $bgu_total_past;
					            } else {
					                $bgu_total_past = (int)$bgu_total_past + (int)$past_temp4_bgu_manthly_array2[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_bgu_manthly_array2[$i] == 0 || $var == "" || $past_temp4_bgu_manthly_array2[$i] == ""){
					                $bgu_ratio = "---";
					            } else {
					                $bgu_ratio = number_format((floor(($var / $past_temp4_bgu_manthly_array2[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $bgu_total = (int)$bgu_total + (int)$var;
					            if($past_temp4_bgu_manthly_array2[$i] == 0){
					                $bgu_total_past = $bgu_total_past;
					            } else {
					                $bgu_total_past = (int)$bgu_total_past + (int)$past_temp4_bgu_manthly_array2[$i];
					            }
					        }

					        if($bgu_ratio < 100){
					            $bgu_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bgu_ratio . "%</div>";
					        } else {
					            $bgu_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bgu_ratio . "%</div>";
					        }

					        $i++;
					    }
					    // 過去の同期間売上点数に対する比率を取得
					        if($bgu_total <> 0 && $bgu_total_past <> 0 && $bgu_total <> "" && $bgu_total_past <> ""){
					            $bgu_total_ratio = number_format((floor(((float)$bgu_total / (float)$bgu_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $bgu_total_ratio = "---";
					        }

					        if($bgu_total_ratio < 100){
					            $bgu_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bgu_total_ratio . "%</div>";
					        } else {
					            $bgu_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bgu_total_ratio . "%</div>";
					        }


                /************************************************************************************************************************************************************************************************************* */
                    // 合計点数・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $ratio = "";
					    $ratio_html = "";
					    $total = "";
					    $total_past = "";
					    $total_ratio = "";
					    foreach($temp4_jn_manthly_array2 as $var){
					        if($var == 0 && $temp4_jn_manthly_array2[$i] == 0){
					            $ratio = 0;
					            $total = $total;
					            if($past_temp4_jn_manthly_array2[$i] == 0 && $past_temp4_ju_manthly_array2[$i] == 0 && $past_temp4_ja_manthly_array2[$i] == 0 && $past_temp4_bn_manthly_array2[$i] == 0 && $past_temp4_bu_manthly_array2[$i] == 0 && $past_temp4_ba_manthly_array2[$i] == 0){
					                $total_past = $total_past;
					            } else {
					                    $total_past = (int)$total_past + (int)$past_temp4_jn_manthly_array2[$i] + (int)$past_temp4_ju_manthly_array2[$i] + (int)$past_temp4_ja_manthly_array2[$i] + (int)$past_temp4_bn_manthly_array2[$i] + (int)$past_temp4_bu_manthly_array2[$i] + (int)$past_temp4_ba_manthly_array2[$i] + (int)$past_temp4_jln_manthly_array2[$i] + (int)$past_temp4_jlu_manthly_array2[$i] + (int)$past_temp4_bgn_manthly_array2[$i] + (int)$past_temp4_bgu_manthly_array2[$i];
					            }
					        } else {
					                if((int)$total_past + (int)$temp4_jn_manthly_array2[$i] + (int)$temp4_ju_manthly_array2[$i] + (int)$temp4_ja_manthly_array2[$i] + (int)$temp4_bn_manthly_array2[$i] + (int)$temp4_bu_manthly_array2[$i] + (int)$temp4_ba_manthly_array2[$i] + (int)$temp4_jln_manthly_array2[$i] + (int)$temp4_jlu_manthly_array2[$i] + (int)$temp4_bgn_manthly_array2[$i] + (int)$temp4_bgu_manthly_array2[$i] == 0 || (int)$total_past + (int)$past_temp4_jn_manthly_array2[$i] + (int)$past_temp4_ju_manthly_array2[$i] + (int)$past_temp4_ja_manthly_array2[$i] + (int)$past_temp4_bn_manthly_array2[$i] + (int)$past_temp4_bu_manthly_array2[$i] + (int)$past_temp4_ba_manthly_array2[$i] + (int)$past_temp4_jln_manthly_array2[$i] + (int)$past_temp4_jlu_manthly_array2[$i] + (int)$past_temp4_bgn_manthly_array2[$i] + (int)$past_temp4_bgu_manthly_array2[$i] == 0){
					                    $ratio = "---";
					                } else {
					                    //$ratio = number_format((floor((((int)$var + (int)$temp4_jn_manthly_array2[$i] + (int)$temp4_ju_manthly_array2[$i] + (int)$temp4_ja_manthly_array2[$i] + (int)$temp4_bn_manthly_array2[$i] + (int)$temp4_bu_manthly_array2[$i] + (int)$temp4_ba_manthly_array2[$i] + (int)$temp4_jln_manthly_array2[$i] + (int)$temp4_jlu_manthly_array2[$i] + (int)$temp4_bgn_manthly_array2[$i] + (int)$temp4_bgu_manthly_array2[$i]) / ((int)$total_past + (int)$past_temp4_jn_manthly_array2[$i] + (int)$past_temp4_ju_manthly_array2[$i] + (int)$past_temp4_ja_manthly_array2[$i] + (int)$past_temp4_bn_manthly_array2[$i] + (int)$past_temp4_bu_manthly_array2[$i] + (int)$past_temp4_ba_manthly_array2[$i] + (int)$past_temp4_jln_manthly_array2[$i] + (int)$past_temp4_jlu_manthly_array2[$i] + (int)$past_temp4_bgn_manthly_array2[$i] + (int)$past_temp4_bgu_manthly_array2[$i])) * 100 * 10)) / 10 ,1);
					                    $ratio = number_format((floor((((int)$var /*+ (int)$temp4_jn_manthly_array2[$i]*/ + (int)$temp4_ju_manthly_array2[$i] + (int)$temp4_ja_manthly_array2[$i] + (int)$temp4_bn_manthly_array2[$i] + (int)$temp4_bu_manthly_array2[$i] + (int)$temp4_ba_manthly_array2[$i] + (int)$temp4_jln_manthly_array2[$i] + (int)$temp4_jlu_manthly_array2[$i] + (int)$temp4_bgn_manthly_array2[$i] + (int)$temp4_bgu_manthly_array2[$i]) / (/*(int)$total_past + */(int)$past_temp4_jn_manthly_array2[$i] + (int)$past_temp4_ju_manthly_array2[$i] + (int)$past_temp4_ja_manthly_array2[$i] + (int)$past_temp4_bn_manthly_array2[$i] + (int)$past_temp4_bu_manthly_array2[$i] + (int)$past_temp4_ba_manthly_array2[$i] + (int)$past_temp4_jln_manthly_array2[$i] + (int)$past_temp4_jlu_manthly_array2[$i] + (int)$past_temp4_bgn_manthly_array2[$i] + (int)$past_temp4_bgu_manthly_array2[$i])) * 100 * 10)) / 10 ,1);
					                }
					                $total = (int)$total + (int)$var /*+ (int)$total_past + (int)$temp4_jn_manthly_array2[$i]*/ + (int)$temp4_ju_manthly_array2[$i] + (int)$temp4_ja_manthly_array2[$i] + (int)$temp4_bn_manthly_array2[$i] + (int)$temp4_bu_manthly_array2[$i] + (int)$temp4_ba_manthly_array2[$i] + (int)$temp4_jln_manthly_array2[$i] + (int)$temp4_jlu_manthly_array2[$i] + (int)$temp4_bgn_manthly_array2[$i] + (int)$temp4_bgu_manthly_array2[$i];
					                if($past_temp4_jn_manthly_array2[$i] == 0 && $past_temp4_ju_manthly_array2[$i] == 0 && $past_temp4_ja_manthly_array2[$i] == 0 && $past_temp4_bn_manthly_array2[$i] == 0 && $past_temp4_bu_manthly_array2[$i] == 0 && $past_temp4_ba_manthly_array2[$i] == 0){
					                    $total_past = $total_past;
					                } else {
					                    $total_past = (int)$total_past /*+ (int)$total_past*/ + (int)$past_temp4_jn_manthly_array2[$i] + (int)$past_temp4_ju_manthly_array2[$i] + (int)$past_temp4_ja_manthly_array2[$i] + (int)$past_temp4_bn_manthly_array2[$i] + (int)$past_temp4_bu_manthly_array2[$i] + (int)$past_temp4_ba_manthly_array2[$i] + (int)$past_temp4_jln_manthly_array2[$i] + (int)$past_temp4_jlu_manthly_array2[$i] + (int)$past_temp4_bgn_manthly_array2[$i] + (int)$past_temp4_bgu_manthly_array2[$i]
;
					                }
					        }

					        if($ratio < 100){
					            $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ratio . "%</div>";
					        } else {
					            $ratio_html .= "<div class='title7 ta_r fc_red'>" . $ratio . "%</div>";
					        }

					        $i++;
					    }
					    // 過去の同期間売上点数に対する比率を取得
					        if($total <> 0 && $total_past <> 0 && $total <> "" && $total_past <> ""){
					            $total_ratio = number_format((floor(((float)$total / (float)$total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $total_ratio = "---";
					        }

					        //$ratio_html .= "<div class='title7 ta_r bg_grey'>" . $total_ratio . "%</div>";

					        if($total_ratio < 100){
					            $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $total_ratio . "%</div>";
					        } else {
					            $ratio_html .= "<div class='title7 ta_r fc_red'>" . $total_ratio . "%</div>";
					        }


					    $temp4_all_sorce11 = "<p class='title_a'>点数・過去比</p><div class='box1'>" . $temp4_title5;
					    $temp4_all_sorce11 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・N</div>" . $jn_ratio_html . "</div>";
					    $temp4_all_sorce11 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・U</div>" . $ju_ratio_html . "</div>";
					    $temp4_all_sorce11 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・A</div>" . $ja_ratio_html . "</div>";
					    $temp4_all_sorce11 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・N</div>" . $bn_ratio_html . "</div>";
					    $temp4_all_sorce11 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・U</div>" . $bu_ratio_html . "</div>";
					    $temp4_all_sorce11 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・A</div>" . $ba_ratio_html . "</div>";
					    $temp4_all_sorce11 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・N</div>" . $jln_ratio_html . "</div>";
					    $temp4_all_sorce11 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・U</div>" . $jlu_ratio_html . "</div>";
					    $temp4_all_sorce11 .= "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・N</div>" . $bgn_ratio_html . "</div>";
					    $temp4_all_sorce11 .= "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・U</div>" . $bgu_ratio_html . "</div>";
					    $temp4_all_sorce11 .= "<div class='wid100 ul4 bg_grey'><div class='title7 ta_c'>合計</div>" . $ratio_html . "</div></div>";



                /************************************************************************************************************************************************************************************************************* */
                    // Jack新品・粗利・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $jn_ratio = "";
					    $jn_ratio_html = "";
					    $jn_total = "";
					    $jn_total_past = "";
					    $jn_total_ratio = "";
					    foreach($temp4_jn_manthly_array3 as $var){
					        if($var == 0){
					            $jn_ratio = "---";
					            $jn_total = $jn_total;
					            if($past_temp4_jn_manthly_array3[$i] == 0){
					                $jn_total_past = $jn_total_past;
					            } else {
					                $jn_total_past = (int)$jn_total_past + (int)$past_temp4_jn_manthly_array3[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_jn_manthly_array3[$i] == 0 || $var == "" || $past_temp4_jn_manthly_array3[$i] == ""){
					                $jn_ratio = "---";
					            } else {
					                $jn_ratio = number_format((floor(($var / $past_temp4_jn_manthly_array3[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $jn_total = (int)$jn_total + (int)$var;
					            if($past_temp4_jn_manthly_array3[$i] == 0){
					                $jn_total_past = $jn_total_past;
					            } else {
					                $jn_total_past = (int)$jn_total_past + (int)$past_temp4_jn_manthly_array3[$i];
					            }
					        }
					        if($jn_ratio < 100){
					            $jn_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $jn_ratio . "%</div>";
					        } else {
					            $jn_ratio_html .= "<div class='title7 ta_r fc_red'>" . $jn_ratio . "%</div>";
					        }

					        $i++;
					    }
					    // 過去の同期間売上粗利に対する比率を取得
					        if($jn_total <> 0 && $jn_total_past <> 0 && $jn_total <> "" && $jn_total_past <> ""){
					            $jn_total_ratio = number_format((floor(((float)$jn_total / (float)$jn_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $jn_total_ratio = "---";
					        }
					        if($jn_total_ratio < 100){
					            $jn_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $jn_total_ratio . "%</div>";
					        } else {
					            $jn_ratio_html .= "<div class='title7 ta_r fc_red'>" . $jn_total_ratio . "%</div>";
					        }

                /************************************************************************************************************************************************************************************************************* */
                    // Jack中古・粗利・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $ju_ratio = "";
					    $ju_ratio_html = "";
					    $ju_total = "";
					    $ju_total_past = "";
					    $ju_total_ratio = "";
					    foreach($temp4_ju_manthly_array3 as $var){
					        if($var == 0){
					            $ju_ratio = "---";
					            $ju_total = $ju_total;
					            if($past_temp4_ju_manthly_array3[$i] == 0){
					                $ju_total_past = $ju_total_past;
					            } else {
					                $ju_total_past = (int)$ju_total_past + (int)$past_temp4_ju_manthly_array3[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_ju_manthly_array3[$i] == 0 || $var == "" || $past_temp4_ju_manthly_array3[$i] == ""){
					                $ju_ratio = "---";
					            } else {
					                $ju_ratio = number_format((floor(($var / $past_temp4_ju_manthly_array3[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $ju_total = (int)$ju_total + (int)$var;
					            if($past_temp4_ju_manthly_array3[$i] == 0){
					                $ju_total_past = $ju_total_past;
					            } else {
					                $ju_total_past = (int)$ju_total_past + (int)$past_temp4_ju_manthly_array3[$i];
					            }
					        }
					        if($ju_ratio < 100){
					            $ju_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ju_ratio . "%</div>";
					        } else {
					            $ju_ratio_html .= "<div class='title7 ta_r fc_red'>" . $ju_ratio . "%</div>";
					        }

					        $i++;
					    }
					    // 過去の同期間売上粗利に対する比率を取得
					        if($ju_total <> 0 && $ju_total_past <> 0 && $ju_total <> "" && $ju_total_past <> ""){
					            $ju_total_ratio = number_format((floor(((float)$ju_total / (float)$ju_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $ju_total_ratio = "---";
					        }
					        if($ju_total_ratio < 100){
					            $ju_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ju_total_ratio . "%</div>";
					        } else {
					            $ju_ratio_html .= "<div class='title7 ta_r fc_red'>" . $ju_total_ratio . "%</div>";
					        }

                /************************************************************************************************************************************************************************************************************* */
                    // Jackアンティーク・粗利・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $ja_ratio = "";
					    $ja_ratio_html = "";
					    $ja_total = "";
					    $ja_total_past = "";
					    $ja_total_ratio = "";
					    foreach($temp4_ja_manthly_array3 as $var){
					        if($var == 0){
					            $ja_ratio = "---";
					            $ja_total = $ja_total;
					            if($past_temp4_ja_manthly_array3[$i] == 0){
					                $ja_total_past = $ja_total_past;
					            } else {
					                $ja_total_past = (int)$ja_total_past + (int)$past_temp4_ja_manthly_array3[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_ja_manthly_array3[$i] == 0 || $var == "" || $past_temp4_ja_manthly_array3[$i] == ""){
					                $ja_ratio = "---";
					            } else {
					                $ja_ratio = number_format((floor(($var / $past_temp4_ja_manthly_array3[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $ja_total = (int)$ja_total + (int)$var;
					            if($past_temp4_ja_manthly_array3[$i] == 0){
					                $ja_total_past = $ja_total_past;
					            } else {
					                $ja_total_past = (int)$ja_total_past + (int)$past_temp4_ja_manthly_array3[$i];
					            }
					        }
					        if($ja_ratio < 100){
					            $ja_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ja_ratio . "%</div>";
					        } else {
					            $ja_ratio_html .= "<div class='title7 ta_r fc_red'>" . $ja_ratio . "%</div>";
					        }

					        $i++;
					    }
					    // 過去の同期間売上粗利に対する比率を取得
					        if($ja_total <> 0 && $ja_total_past <> 0 && $ja_total <> "" && $ja_total_past <> ""){
					            $ja_total_ratio = number_format((floor(((float)$ja_total / (float)$ja_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $ja_total_ratio = "---";
					        }
					        if($ja_total_ratio < 100){
					            $ja_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ja_total_ratio . "%</div>";
					        } else {
					            $ja_ratio_html .= "<div class='title7 ta_r fc_red'>" . $ja_total_ratio . "%</div>";
					        }


                /************************************************************************************************************************************************************************************************************* */
                    // Betty新品・粗利・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $bn_ratio = "";
					    $bn_ratio_html = "";
					    $bn_total = "";
					    $bn_total_past = "";
					    $bn_total_ratio = "";
					    foreach($temp4_bn_manthly_array3 as $var){
					        if($var == 0){
					            $bn_ratio = "---";
					            $bn_total = $bn_total;
					            if($past_temp4_bn_manthly_array3[$i] == 0){
					                $bn_total_past = $bn_total_past;
					            } else {
					                $bn_total_past = (int)$bn_total_past + (int)$past_temp4_bn_manthly_array3[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_bn_manthly_array3[$i] == 0 || $var == "" || $past_temp4_bn_manthly_array3[$i] == ""){
					                $bn_ratio = "---";
					            } else {
					                $bn_ratio = number_format((floor(($var / $past_temp4_bn_manthly_array3[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $bn_total = (int)$bn_total + (int)$var;
					            if($past_temp4_bn_manthly_array3[$i] == 0){
					                $bn_total_past = $bn_total_past;
					            } else {
					                $bn_total_past = (int)$bn_total_past + (int)$past_temp4_bn_manthly_array3[$i];
					            }
					        }
					        if($bn_ratio < 100){
					            $bn_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bn_ratio . "%</div>";
					        } else {
					            $bn_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bn_ratio . "%</div>";
					        }

					        $i++;
					    }
					    // 過去の同期間売上粗利に対する比率を取得
					        if($bn_total <> 0 && $bn_total_past <> 0 && $bn_total <> "" && $bn_total_past <> ""){
					            $bn_total_ratio = number_format((floor(((float)$bn_total / (float)$bn_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $bn_total_ratio = "---";
					        }
					        if($bn_total_ratio < 100){
					            $bn_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bn_total_ratio . "%</div>";
					        } else {
					            $bn_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bn_total_ratio . "%</div>";
					        }


                /************************************************************************************************************************************************************************************************************* */
                    // Betty中古・粗利・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $bu_ratio = "";
					    $bu_ratio_html = "";
					    $bu_total = "";
					    $bu_total_past = "";
					    $bu_total_ratio = "";
					    foreach($temp4_bu_manthly_array3 as $var){
					        if($var == 0){
					            $bu_ratio = "---";
					            $bu_total = $bu_total;
					            if($past_temp4_bu_manthly_array3[$i] == 0){
					                $bu_total_past = $bu_total_past;
					            } else {
					                $bu_total_past = (int)$bu_total_past + (int)$past_temp4_bu_manthly_array3[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_bu_manthly_array3[$i] == 0 || $var == "" || $past_temp4_bu_manthly_array3[$i] == ""){
					                $bu_ratio = "---";
					            } else {
					                $bu_ratio = number_format((floor(($var / $past_temp4_bu_manthly_array3[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $bu_total = (int)$bu_total + (int)$var;
					            if($past_temp4_bu_manthly_array3[$i] == 0){
					                $bu_total_past = $bu_total_past;
					            } else {
					                $bu_total_past = (int)$bu_total_past + (int)$past_temp4_bu_manthly_array3[$i];
					            }
					        }
					        if($bu_ratio < 100){
					            $bu_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bu_ratio . "%</div>";
					        } else {
					            $bu_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bu_ratio . "%</div>";
					        }

					        $i++;
					    }
					    // 過去の同期間売上粗利に対する比率を取得
					        if($bu_total <> 0 && $bu_total_past <> 0 && $bu_total <> "" && $bu_total_past <> ""){
					            $bu_total_ratio = number_format((floor(((float)$bu_total / (float)$bu_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $bu_total_ratio = "---";
					        }
					        if($bu_total_ratio < 100){
					            $bu_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bu_total_ratio . "%</div>";
					        } else {
					            $bu_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bu_total_ratio . "%</div>";
					        }


                /************************************************************************************************************************************************************************************************************* */
                    // Bettyアンティーク・粗利・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $ba_ratio = "";
					    $ba_ratio_html = "";
					    $ba_total = "";
					    $ba_total_past = "";
					    $ba_total_ratio = "";
					    foreach($temp4_ba_manthly_array3 as $var){
					        if($var == 0){
					            $ba_ratio = "---";
					            $ba_total = $ba_total;
					            if($past_temp4_ba_manthly_array3[$i] == 0){
					                $ba_total_past = $ba_total_past;
					            } else {
					                $ba_total_past = (int)$ba_total_past + (int)$past_temp4_ba_manthly_array3[$i];
					            }
					        } else {
                                if(isset($past_temp4_ba_manthly_array3[$i])){
                                    if($var == 0 || $past_temp4_ba_manthly_array3[$i] == 0 || $var == "" || $past_temp4_ba_manthly_array3[$i] == ""){
                                        $ba_ratio = "---";
                                    } else {
                                        $ba_ratio = number_format((floor(($var / $past_temp4_ba_manthly_array3[$i]) * 100 * 10)) / 10 ,1);
                                    }
                                    $ba_total = (int)$ba_total + (int)$var;
                                    if($past_temp4_ba_manthly_array3[$i] == 0){
                                        $ba_total_past = $ba_total_past;
                                    } else {
                                        $ba_total_past = (int)$ba_total_past + (int)$past_temp4_ba_manthly_array3[$i];
                                    }
                                } else {
                                    $ba_ratio = "---";
                                    $ba_total_past = 0;
                                }
					        }
					        if($ba_ratio < 100){
					            $ba_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ba_ratio . "%</div>";
					        } else {
					            $ba_ratio_html .= "<div class='title7 ta_r fc_red'>" . $ba_ratio . "%</div>";
					        }

					        $i++;
					    }
					    // 過去の同期間売上粗利に対する比率を取得
					        if($ba_total <> 0 && $ba_total_past <> 0 && $ba_total <> "" && $ba_total_past <> ""){
					            $ba_total_ratio = number_format((floor(((float)$ba_total / (float)$ba_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $ba_total_ratio = "---";
					        }
					        if($ba_total_ratio < 100){
					            $ba_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ba_total_ratio . "%</div>";
					        } else {
					            $ba_ratio_html .= "<div class='title7 ta_r fc_red'>" . $ba_total_ratio . "%</div>";
					        }

                /************************************************************************************************************************************************************************************************************* */
                    // ジュエリー新品・粗利・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $jln_ratio = "";
					    $jln_ratio_html = "";
					    $jln_total = "";
					    $jln_total_past = "";
					    $jln_total_ratio = "";
					    foreach($temp4_jln_manthly_array3 as $var){
					        if($var == 0){
					            $jln_ratio = "---";
					            $jln_total = $jln_total;
					            if($past_temp4_jln_manthly_array3[$i] == 0){
					                $jln_total_past = $jln_total_past;
					            } else {
					                $jln_total_past = (int)$jln_total_past + (int)$past_temp4_jln_manthly_array3[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_jln_manthly_array3[$i] == 0 || $var == "" || $past_temp4_jln_manthly_array3[$i] == ""){
					                $jln_ratio = "---";
					            } else {
					                $jln_ratio = number_format((floor(($var / $past_temp4_jln_manthly_array3[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $jln_total = (int)$jln_total + (int)$var;
					            if($past_temp4_jln_manthly_array3[$i] == 0){
					                $jln_total_past = $jln_total_past;
					            } else {
					                $jln_total_past = (int)$jln_total_past + (int)$past_temp4_jln_manthly_array3[$i];
					            }
					        }
					        if($jln_ratio < 100){
					            $jln_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $jln_ratio . "%</div>";
					        } else {
					            $jln_ratio_html .= "<div class='title7 ta_r fc_red'>" . $jln_ratio . "%</div>";
					        }

					        $i++;
					    }
					    // 過去の同期間売上粗利に対する比率を取得
					        if($jln_total <> 0 && $jln_total_past <> 0 && $jln_total <> "" && $jln_total_past <> ""){
					            $jln_total_ratio = number_format((floor(((float)$jln_total / (float)$jln_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $jln_total_ratio = "---";
					        }
					        if($jln_total_ratio < 100){
					            $jln_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $jln_total_ratio . "%</div>";
					        } else {
					            $jln_ratio_html .= "<div class='title7 ta_r fc_red'>" . $jln_total_ratio . "%</div>";
					        }

                /************************************************************************************************************************************************************************************************************* */
                    // ジュエリー中古・粗利・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $jlu_ratio = "";
					    $jlu_ratio_html = "";
					    $jlu_total = "";
					    $jlu_total_past = "";
					    $jlu_total_ratio = "";
					    foreach($temp4_jlu_manthly_array3 as $var){
					        if($var == 0){
					            $jlu_ratio = "---";
					            $jlu_total = $jlu_total;
					            if($past_temp4_jlu_manthly_array3[$i] == 0){
					                $jlu_total_past = $jlu_total_past;
					            } else {
					                $jlu_total_past = (int)$jlu_total_past + (int)$past_temp4_jlu_manthly_array3[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_jlu_manthly_array3[$i] == 0 || $var == "" || $past_temp4_jlu_manthly_array3[$i] == ""){
					                $jlu_ratio = "---";
					            } else {
					                $jlu_ratio = number_format((floor(($var / $past_temp4_jlu_manthly_array3[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $jlu_total = (int)$jlu_total + (int)$var;
					            if($past_temp4_jlu_manthly_array3[$i] == 0){
					                $jlu_total_past = $jlu_total_past;
					            } else {
					                $jlu_total_past = (int)$jlu_total_past + (int)$past_temp4_jlu_manthly_array3[$i];
					            }
					        }
					        if($jlu_ratio < 100){
					            $jlu_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $jlu_ratio . "%</div>";
					        } else {
					            $jlu_ratio_html .= "<div class='title7 ta_r fc_red'>" . $jlu_ratio . "%</div>";
					        }

					        $i++;
					    }
					    // 過去の同期間売上粗利に対する比率を取得
					        if($jlu_total <> 0 && $jlu_total_past <> 0 && $jlu_total <> "" && $jlu_total_past <> ""){
					            $jlu_total_ratio = number_format((floor(((float)$jlu_total / (float)$jlu_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $jlu_total_ratio = "---";
					        }
					        if($jlu_total_ratio < 100){
					            $jlu_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $jlu_total_ratio . "%</div>";
					        } else {
					            $jlu_ratio_html .= "<div class='title7 ta_r fc_red'>" . $jlu_total_ratio . "%</div>";
					        }

                /************************************************************************************************************************************************************************************************************* */
                    // バッグ新品・粗利・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $bgn_ratio = "";
					    $bgn_ratio_html = "";
					    $bgn_total = "";
					    $bgn_total_past = "";
					    $bgn_total_ratio = "";
					    foreach($temp4_bgn_manthly_array3 as $var){
					        if($var == 0){
					            $bgn_ratio = "---";
					            $bgn_total = $bgn_total;
					            if($past_temp4_bgn_manthly_array3[$i] == 0){
					                $bgn_total_past = $bgn_total_past;
					            } else {
					                $bgn_total_past = (int)$bgn_total_past + (int)$past_temp4_bgn_manthly_array3[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_bgn_manthly_array3[$i] == 0 || $var == "" || $past_temp4_bgn_manthly_array3[$i] == ""){
					                $bgn_ratio = "---";
					            } else {
					                $bgn_ratio = number_format((floor(($var / $past_temp4_bgn_manthly_array3[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $bgn_total = (int)$bgn_total + (int)$var;
					            if($past_temp4_bgn_manthly_array3[$i] == 0){
					                $bgn_total_past = $bgn_total_past;
					            } else {
					                $bgn_total_past = (int)$bgn_total_past + (int)$past_temp4_bgn_manthly_array3[$i];
					            }
					        }
					        if($bgn_ratio < 100){
					            $bgn_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bgn_ratio . "%</div>";
					        } else {
					            $bgn_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bgn_ratio . "%</div>";
					        }

					        $i++;
					    }
					    // 過去の同期間売上粗利に対する比率を取得
					        if($bgn_total <> 0 && $bgn_total_past <> 0 && $bgn_total <> "" && $bgn_total_past <> ""){
					            $bgn_total_ratio = number_format((floor(((float)$bgn_total / (float)$bgn_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $bgn_total_ratio = "---";
					        }
					        if($bgn_total_ratio < 100){
					            $bgn_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bgn_total_ratio . "%</div>";
					        } else {
					            $bgn_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bgn_total_ratio . "%</div>";
					        }


                /************************************************************************************************************************************************************************************************************* */
                    // バッグ中古・粗利・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $bgu_ratio = "";
					    $bgu_ratio_html = "";
					    $bgu_total = "";
					    $bgu_total_past = "";
					    $bgu_total_ratio = "";
					    foreach($temp4_bgu_manthly_array3 as $var){
					        if($var == 0){
					            $bgu_ratio = "---";
					            $bgu_total = $bgu_total;
					            if($past_temp4_bgu_manthly_array3[$i] == 0){
					                $bgu_total_past = $bgu_total_past;
					            } else {
					                $bgu_total_past = (int)$bgu_total_past + (int)$past_temp4_bgu_manthly_array3[$i];
					            }
					        } else {
					            if($var == 0 || $past_temp4_bgu_manthly_array3[$i] == 0 || $var == "" || $past_temp4_bgu_manthly_array3[$i] == ""){
					                $bgu_ratio = "---";
					            } else {
					                $bgu_ratio = number_format((floor(($var / $past_temp4_bgu_manthly_array3[$i]) * 100 * 10)) / 10 ,1);
					            }
					            $bgu_total = (int)$bgu_total + (int)$var;
					            if($past_temp4_bgu_manthly_array3[$i] == 0){
					                $bgu_total_past = $bgu_total_past;
					            } else {
					                $bgu_total_past = (int)$bgu_total_past + (int)$past_temp4_bgu_manthly_array3[$i];
					            }
					        }
					        if($bgu_ratio < 100){
					            $bgu_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bgu_ratio . "%</div>";
					        } else {
					            $bgu_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bgu_ratio . "%</div>";
					        }

					        $i++;
					    }
					    // 過去の同期間売上粗利に対する比率を取得
					        if($bgu_total <> 0 && $bgu_total_past <> 0 && $bgu_total <> "" && $bgu_total_past <> ""){
					            $bgu_total_ratio = number_format((floor(((float)$bgu_total / (float)$bgu_total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $bgu_total_ratio = "---";
					        }
					        if($bgu_total_ratio < 100){
					            $bgu_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $bgu_total_ratio . "%</div>";
					        } else {
					            $bgu_ratio_html .= "<div class='title7 ta_r fc_red'>" . $bgu_total_ratio . "%</div>";
					        }

                /************************************************************************************************************************************************************************************************************* */
                    // 合計粗利・過去比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $ratio = "";
					    $ratio_html = "";
					    $total = "";
					    $total_past = "";
					    $total_ratio = "";
					    foreach($temp4_jn_manthly_array3 as $var){
					        if($var == 0 && $temp4_jn_manthly_array3[$i] == 0){
					            $ratio = 0;
					            $total = $total;
					            if($past_temp4_jn_manthly_array3[$i] == 0 && $past_temp4_ju_manthly_array3[$i] == 0 && $past_temp4_ja_manthly_array3[$i] == 0 && $past_temp4_bn_manthly_array3[$i] == 0 && $past_temp4_bu_manthly_array3[$i] == 0 && $past_temp4_ba_manthly_array3[$i] == 0){
					                $total_past = $total_past;
					            } else {
					                    $total_past = (int)$total_past + (int)$past_temp4_jn_manthly_array3[$i] + (int)$past_temp4_ju_manthly_array3[$i] + (int)$past_temp4_ja_manthly_array3[$i] + (int)$past_temp4_bn_manthly_array3[$i] + (int)$past_temp4_bu_manthly_array3[$i] + (int)$past_temp4_ba_manthly_array3[$i] + (int)$past_temp4_jln_manthly_array3[$i] + (int)$past_temp4_jlu_manthly_array3[$i] + (int)$past_temp4_bgn_manthly_array3[$i] + (int)$past_temp4_bgu_manthly_array3[$i];
					            }
					        } else {
					                if((int)$total_past + (int)$temp4_jn_manthly_array3[$i] + (int)$temp4_ju_manthly_array3[$i] + (int)$temp4_ja_manthly_array3[$i] + (int)$temp4_bn_manthly_array3[$i] + (int)$temp4_bu_manthly_array3[$i] + (int)$temp4_ba_manthly_array3[$i] + (int)$temp4_jln_manthly_array3[$i] + (int)$temp4_jlu_manthly_array3[$i] + (int)$temp4_bgn_manthly_array3[$i] + (int)$temp4_bgu_manthly_array3[$i] == 0 || (int)$total_past + (int)$past_temp4_jn_manthly_array3[$i] + (int)$past_temp4_ju_manthly_array3[$i] + (int)$past_temp4_ja_manthly_array3[$i] + (int)$past_temp4_bn_manthly_array3[$i] + (int)$past_temp4_bu_manthly_array3[$i] + (int)$past_temp4_ba_manthly_array3[$i] + (int)$past_temp4_jln_manthly_array3[$i] + (int)$past_temp4_jlu_manthly_array3[$i] + (int)$past_temp4_bgn_manthly_array3[$i] + (int)$past_temp4_bgu_manthly_array3[$i] == 0){
					                    $ratio = "---";
					                } else {
					                    //$ratio = number_format((floor((((int)$var + (int)$temp4_jn_manthly_array3[$i] + (int)$temp4_ju_manthly_array3[$i] + (int)$temp4_ja_manthly_array3[$i] + (int)$temp4_bn_manthly_array3[$i] + (int)$temp4_bu_manthly_array3[$i] + (int)$temp4_ba_manthly_array3[$i] + (int)$temp4_jln_manthly_array3[$i] + (int)$temp4_jlu_manthly_array3[$i] + (int)$temp4_bgn_manthly_array3[$i] + (int)$temp4_bgu_manthly_array3[$i]) / ((int)$total_past + (int)$past_temp4_jn_manthly_array3[$i] + (int)$past_temp4_ju_manthly_array3[$i] + (int)$past_temp4_ja_manthly_array3[$i] + (int)$past_temp4_bn_manthly_array3[$i] + (int)$past_temp4_bu_manthly_array3[$i] + (int)$past_temp4_ba_manthly_array3[$i] + (int)$past_temp4_jln_manthly_array3[$i] + (int)$past_temp4_jlu_manthly_array3[$i] + (int)$past_temp4_bgn_manthly_array3[$i] + (int)$past_temp4_bgu_manthly_array3[$i])) * 100 * 10)) / 10 ,1);
					                    $ratio = number_format((floor((((int)$var + /*(int)$temp4_jn_manthly_array3[$i] +*/ (int)$temp4_ju_manthly_array3[$i] + (int)$temp4_ja_manthly_array3[$i] + (int)$temp4_bn_manthly_array3[$i] + (int)$temp4_bu_manthly_array3[$i] + (int)$temp4_ba_manthly_array3[$i] + (int)$temp4_jln_manthly_array3[$i] + (int)$temp4_jlu_manthly_array3[$i] + (int)$temp4_bgn_manthly_array3[$i] + (int)$temp4_bgu_manthly_array3[$i]) / (/*(int)$total_past + */(int)$past_temp4_jn_manthly_array3[$i] + (int)$past_temp4_ju_manthly_array3[$i] + (int)$past_temp4_ja_manthly_array3[$i] + (int)$past_temp4_bn_manthly_array3[$i] + (int)$past_temp4_bu_manthly_array3[$i] + (int)$past_temp4_ba_manthly_array3[$i] + (int)$past_temp4_jln_manthly_array3[$i] + (int)$past_temp4_jlu_manthly_array3[$i] + (int)$past_temp4_bgn_manthly_array3[$i] + (int)$past_temp4_bgu_manthly_array3[$i])) * 100 * 10)) / 10 ,1);
					                }
					                $total = (int)$total + (int)$var /*+ (int)$total_past + (int)$temp4_jn_manthly_array3[$i]*/ + (int)$temp4_ju_manthly_array3[$i] + (int)$temp4_ja_manthly_array3[$i] + (int)$temp4_bn_manthly_array3[$i] + (int)$temp4_bu_manthly_array3[$i] + (int)$temp4_ba_manthly_array3[$i] + (int)$temp4_jln_manthly_array3[$i] + (int)$temp4_jlu_manthly_array3[$i] + (int)$temp4_bgn_manthly_array3[$i] + (int)$temp4_bgu_manthly_array3[$i];
					                if($past_temp4_jn_manthly_array3[$i] == 0 && $past_temp4_ju_manthly_array3[$i] == 0 && $past_temp4_ja_manthly_array3[$i] == 0 && $past_temp4_bn_manthly_array3[$i] == 0 && $past_temp4_bu_manthly_array3[$i] == 0 && $past_temp4_ba_manthly_array3[$i] == 0){
					                    $total_past = $total_past;
					                } else {
					                    $total_past = (int)$total_past /*+ (int)$total_past*/ + (int)$past_temp4_jn_manthly_array3[$i] + (int)$past_temp4_ju_manthly_array3[$i] + (int)$past_temp4_ja_manthly_array3[$i] + (int)$past_temp4_bn_manthly_array3[$i] + (int)$past_temp4_bu_manthly_array3[$i] + (int)$past_temp4_ba_manthly_array3[$i] + (int)$past_temp4_jln_manthly_array3[$i] + (int)$past_temp4_jlu_manthly_array3[$i] + (int)$past_temp4_bgn_manthly_array3[$i] + (int)$past_temp4_bgu_manthly_array3[$i];
					                }
					        }

					        if($ratio < 100){
					            $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ratio . "%</div>";
					        } else {
					            $ratio_html .= "<div class='title7 ta_r fc_red'>" . $ratio . "%</div>";
					        }


					        $i++;
					    }
					    // 過去の同期間売上粗利に対する比率を取得
					        if($total <> 0 && $total_past <> 0 && $total <> "" && $total_past <> ""){
					            $total_ratio = number_format((floor(((float)$total / (float)$total_past) * 100 * 10)) / 10 ,1);
					        } else {
					            $total_ratio = "---";
					        }

					        if($total_ratio < 100){
					            $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $total_ratio . "%</div>";
					        } else {
					            $ratio_html .= "<div class='title7 ta_r fc_red'>" . $total_ratio . "%</div>";
					        }


					    $temp4_all_sorce12 = "<p class='title_a'>粗利・過去比</p><div class='box1'>" . $temp4_title5;
					    $temp4_all_sorce12 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・N</div>" . $jn_ratio_html . "</div>";
					    $temp4_all_sorce12 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・U</div>" . $ju_ratio_html . "</div>";
					    $temp4_all_sorce12 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・A</div>" . $ja_ratio_html . "</div>";
					    $temp4_all_sorce12 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・N</div>" . $bn_ratio_html . "</div>";
					    $temp4_all_sorce12 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・U</div>" . $bu_ratio_html . "</div>";
					    $temp4_all_sorce12 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・A</div>" . $ba_ratio_html . "</div>";
					    $temp4_all_sorce12 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・N</div>" . $jln_ratio_html . "</div>";
					    $temp4_all_sorce12 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・U</div>" . $jlu_ratio_html . "</div>";
					    $temp4_all_sorce12 .= "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・N</div>" . $bgn_ratio_html . "</div>";
					    $temp4_all_sorce12 .= "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・U</div>" . $bgu_ratio_html . "</div>";
					    $temp4_all_sorce12 .= "<div class='wid100 ul4 bg_grey'><div class='title7 ta_c'>合計</div>" . $ratio_html . "</div></div>";


                /************************************************************************************************************************************************************************************************************* */
                    // 過去・金額構成比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $total = "";
					    $total2 = 0;
					    $jn_per = "";
					    $ju_per = "";
					    $ja_per = "";
					    $bn_per = "";
					    $bu_per = "";
					    $ba_per = "";
					    $jln_per = "";
					    $jlu_per = "";
					    $bgn_per = "";
					    $bgu_per = "";
					    $jn_total = "";
					    $ju_total = "";
					    $ja_total = "";
					    $bn_total = "";
					    $bu_total = "";
					    $ba_total = "";
					    $jln_total = "";
					    $jlu_total = "";
					    $bgn_total = "";
					    $bgu_total = "";
					    $jn_per_html = "";
					    $ju_per_html = "";
					    $ja_per_html = "";
					    $bn_per_html = "";
					    $bu_per_html = "";
					    $ba_per_html = "";
					    $jln_per_html = "";
					    $jlu_per_html = "";
					    $bgn_per_html = "";
					    $bgu_per_html = "";
					    $past_jn_total_js2 = "";
					    $past_ju_total_js2 = "";
					    $past_ja_total_js2 = "";
					    $past_bn_total_js2 = "";
					    $past_bu_total_js2 = "";
					    $past_ba_total_js2 = "";
					    $past_jln_total_js2 = "";
					    $past_jlu_total_js2 = "";
					    $past_bgn_total_js2 = "";
					    $past_bgu_total_js2 = "";
					    foreach($past_temp4_jn_manthly_array as $var){
					            $total = (int)$var + (int)$past_temp4_ju_manthly_array[$i] + (int)$past_temp4_ja_manthly_array[$i] + (int)$past_temp4_bn_manthly_array[$i] + (int)$past_temp4_bu_manthly_array[$i] + (int)$past_temp4_ba_manthly_array[$i] + (int)$past_temp4_jln_manthly_array[$i] + (int)$past_temp4_jlu_manthly_array[$i] + (int)$past_temp4_bgn_manthly_array[$i] + (int)$past_temp4_bgu_manthly_array[$i];
					        $total2 = (int)$total2 + (int)$total;
					        $jn_total = (int)$jn_total + (int)$var;
					        $ju_total = (int)$ju_total + (int)$past_temp4_ju_manthly_array[$i];
					        $ja_total = (int)$ja_total + (int)$past_temp4_ja_manthly_array[$i];
					        $bn_total = (int)$bn_total + (int)$past_temp4_bn_manthly_array[$i];
					        $bu_total = (int)$bu_total + (int)$past_temp4_bu_manthly_array[$i];
					        $ba_total = (int)$ba_total + (int)$past_temp4_ba_manthly_array[$i];
					        $jln_total = (int)$jln_total + (int)$past_temp4_jln_manthly_array[$i];
					        $jlu_total = (int)$jlu_total + (int)$past_temp4_jlu_manthly_array[$i];
					        $bgn_total = (int)$bgn_total + (int)$past_temp4_bgn_manthly_array[$i];
					        $bgu_total = (int)$bgu_total + (int)$past_temp4_bgu_manthly_array[$i];
					        if($var == 0){
					            $ju_per = "---";
					            if($past_temp4_ju_manthly_array[$i] == 0){
					                $ju_per = "---";
					            } else {
					                    if($past_temp4_ju_manthly_array[$i] <> 0 && $total <> 0 && $past_temp4_ju_manthly_array[$i] <> "" && $total <> ""){
					                        $ju_per = number_format((floor(($past_temp4_ju_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $ju_per = "---"; 
					                    }
					            }
					            if($past_temp4_ju_manthly_array[$i] == 0){
					                $ju_per = "---";
					            } else {
					                    if($past_temp4_ju_manthly_array[$i] <> 0 && $total <> 0 && $past_temp4_ju_manthly_array[$i] <> "" && $total <> ""){
					                        $ju_per = number_format((floor(($past_temp4_ju_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $ju_per = "---"; 
					                    }
					            }
					            
					            if($past_temp4_ja_manthly_array[$i] == 0){
					                $ja_per = "---";
					            } else {
					                    if($past_temp4_ja_manthly_array[$i] <> 0 && $total <> 0 && $past_temp4_ja_manthly_array[$i] <> "" && $total <> ""){
					                        $ja_per = number_format((floor(($past_temp4_ja_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $ja_per = "---"; 
					                    }
					            }
					            if($past_temp4_bn_manthly_array[$i] == 0){
					                $bn_per = "---";
					            } else {
					                    if($past_temp4_bn_manthly_array[$i] <> 0 && $total <> 0 && $past_temp4_bn_manthly_array[$i] <> "" && $total <> ""){
					                        $bn_per = number_format((floor(($past_temp4_bn_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $bn_per = "---"; 
					                    }
					            }
					            if($past_temp4_bu_manthly_array[$i] == 0){
					                $bu_per = "---";
					            } else {
					                    if($past_temp4_bu_manthly_array[$i] <> 0 && $total <> 0 && $past_temp4_bu_manthly_array[$i] <> "" && $total <> ""){
					                        $bu_per = number_format((floor(($past_temp4_bu_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $bu_per = "---"; 
					                    }
					            }
					            if($past_temp4_ba_manthly_array[$i] == 0){
					                $ba_per = "---";
					            } else {
					                    if($past_temp4_ba_manthly_array[$i] <> 0 && $total <> 0 && $past_temp4_ba_manthly_array[$i] <> "" && $total <> ""){
					                        $ba_per = number_format((floor(($past_temp4_ba_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $ba_per = "---"; 
					                    }
					            }
					            if($past_temp4_jln_manthly_array[$i] == 0){
					                $jln_per = "---";
					            } else {
					                    if($past_temp4_jln_manthly_array[$i] <> 0 && $total <> 0 && $past_temp4_jln_manthly_array[$i] <> "" && $total <> ""){
					                        $jln_per = number_format((floor(($past_temp4_jln_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $jln_per = "---"; 
					                    }
					            }
					            if($past_temp4_jlu_manthly_array[$i] == 0){
					                $jlu_per = "---";
					            } else {
					                    if($past_temp4_jlu_manthly_array[$i] <> 0 && $total <> 0 && $past_temp4_jlu_manthly_array[$i] <> "" && $total <> ""){
					                        $jlu_per = number_format((floor(($past_temp4_jlu_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $jlu_per = "---"; 
					                    }
					            }
					            if($past_temp4_bgn_manthly_array[$i] == 0){
					                $bgn_per = "---";
					            } else {
					                    if($past_temp4_bgn_manthly_array[$i] <> 0 && $total <> 0 && $past_temp4_bgn_manthly_array[$i] <> "" && $total <> ""){
					                        $bgn_per = number_format((floor(($past_temp4_bgn_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $bgn_per = "---"; 
					                    }
					            }
					            if($past_temp4_bgu_manthly_array[$i] == 0){
					                $bgu_per = "---";
					            } else {
					                    if($past_temp4_bgu_manthly_array[$i] <> 0 && $total <> 0 && $past_temp4_bgu_manthly_array[$i] <> "" && $total <> ""){
					                        $bgu_per = number_format((floor(($past_temp4_bgu_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $bgu_per = "---"; 
					                    }
					            }
					        } else {
					            if($var <> 0 && $total <> 0 && $var <> "" && $total <> ""){
					                $jn_per = number_format((floor(($var / $total) * 100 * 10)) / 10 ,1);
					            } else {
					                $jn_per = "---";
					            }
					            if($past_temp4_ju_manthly_array[$i] == 0){
					                $ju_per = "---";
					            } else {
					                    if($past_temp4_ju_manthly_array[$i] <> 0 && $total <> 0 && $past_temp4_ju_manthly_array[$i] <> "" && $total <> ""){
					                        $ju_per = number_format((floor(($past_temp4_ju_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $ju_per = "---";
					                    }
					            }
					            if($past_temp4_ja_manthly_array[$i] == 0){
					                $ja_per = "---";
					            } else {
					                    if($past_temp4_ja_manthly_array[$i] <> 0 && $total <> 0 && $past_temp4_ja_manthly_array[$i] <> "" && $total <> ""){
					                        $ja_per = number_format((floor(($past_temp4_ja_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $ja_per = "---";
					                    }
					            }
					            if($past_temp4_bn_manthly_array[$i] == 0){
					                $bn_per = "---";
					            } else {
					                    if($past_temp4_bn_manthly_array[$i] <> 0 && $total <> 0 && $past_temp4_bn_manthly_array[$i] <> "" && $total <> ""){
					                        $bn_per = number_format((floor(($past_temp4_bn_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $bn_per = "---";
					                    }
					            }
					            if($past_temp4_bu_manthly_array[$i] == 0){
					                $bu_per = "---";
					            } else {
					                    if($past_temp4_bu_manthly_array[$i] <> 0 && $total <> 0 && $past_temp4_bu_manthly_array[$i] <> "" && $total <> ""){
					                        $bu_per = number_format((floor(($past_temp4_bu_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $bu_per = "---";
					                    }
					            }
					            if($past_temp4_ba_manthly_array[$i] == 0){
					                $ba_per = "---";
					            } else {
					                    if($past_temp4_ba_manthly_array[$i] <> 0 && $total <> 0 && $past_temp4_ba_manthly_array[$i] <> "" && $total <> ""){
					                        $ba_per = number_format((floor(($past_temp4_ba_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $ba_per = "---";
					                    }
					            }
					            if($past_temp4_jln_manthly_array[$i] == 0){
					                $jln_per = "---";
					            } else {
					                    if($past_temp4_jln_manthly_array[$i] <> 0 && $total <> 0 && $past_temp4_jln_manthly_array[$i] <> "" && $total <> ""){
					                        $jln_per = number_format((floor(($past_temp4_jln_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $jln_per = "---";
					                    }
					            }
					            if($past_temp4_jlu_manthly_array[$i] == 0){
					                $jlu_per = "---";
					            } else {
					                    if($past_temp4_jlu_manthly_array[$i] <> 0 && $total <> 0 && $past_temp4_jlu_manthly_array[$i] <> "" && $total <> ""){
					                        $jlu_per = number_format((floor(($past_temp4_jlu_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $jlu_per = "---";
					                    }
					            }
					            if($past_temp4_bgn_manthly_array[$i] == 0){
					                $bgn_per = "---";
					            } else {
					                    if($past_temp4_bgn_manthly_array[$i] <> 0 && $total <> 0 && $past_temp4_bgn_manthly_array[$i] <> "" && $total <> ""){
					                        $bgn_per = number_format((floor(($past_temp4_bgn_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $bgn_per = "---";
					                    }
					            }
					            if($past_temp4_bgu_manthly_array[$i] == 0){
					                $bgu_per = "---";
					            } else {
					                    if($past_temp4_bgu_manthly_array[$i] <> 0 && $total <> 0 && $past_temp4_bgu_manthly_array[$i] <> "" && $total <> ""){
					                        $bgu_per = number_format((floor(($past_temp4_bgu_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $bgu_per = "---";
					                    }
					            }
					            
					            
					        }
					        $jn_per_html .= "<div class='title7 ta_r'>" . $jn_per . "%</div>";
					        $past_jn_total_js2  .= (float)$jn_per . ", ";
					        $ju_per_html .= "<div class='title7 ta_r'>" . $ju_per . "%</div>";
					        $past_ju_total_js2  .= (float)$ju_per . ", ";
					        $ja_per_html .= "<div class='title7 ta_r'>" . $ja_per . "%</div>";
					        $past_ja_total_js2  .= (float)$ja_per . ", ";
					        $bn_per_html .= "<div class='title7 ta_r'>" . $bn_per . "%</div>";
					        $past_bn_total_js2  .= (float)$bn_per . ", ";
					        $bu_per_html .= "<div class='title7 ta_r'>" . $bu_per . "%</div>";
					        $past_bu_total_js2  .= (float)$bu_per . ", ";
					        $ba_per_html .= "<div class='title7 ta_r'>" . $ba_per . "%</div>";
					        $past_ba_total_js2  .= (float)$ba_per . ", ";
					        $jln_per_html .= "<div class='title7 ta_r'>" . $jln_per . "%</div>";
					        $past_jln_total_js2  .= (float)$jln_per . ", ";
					        $jlu_per_html .= "<div class='title7 ta_r'>" . $jlu_per . "%</div>";
					        $past_jlu_total_js2  .= (float)$jlu_per . ", ";
					        $bgn_per_html .= "<div class='title7 ta_r'>" . $bgn_per . "%</div>";
					        $past_bgn_total_js2  .= (float)$bgn_per . ", ";
					        $bgu_per_html .= "<div class='title7 ta_r'>" . $bgu_per . "%</div>";
					        $past_bgu_total_js2  .= (float)$bgu_per . ", ";

					        $i++;
					    }
					    // 期間中の売上合計に対するパーセンテージを取得
					        if($jn_total <> 0 && $total2 <> 0 && $jn_total <> "" && $total2 <> ""){
					            $jn_total_per = number_format((floor(($jn_total / $total2) * 100 * 10)) / 10 ,1);
					        } else {
					            $jn_total_per = "---";
					        }
					        if($ju_total <> 0 && $total2 <> 0 && $ju_total <> "" && $total2 <> ""){
					            $ju_total_per = number_format((floor(($ju_total / $total2) * 100 * 10)) / 10 ,1);
					        } else {
					            $ju_total_per = "---";
					        }
					        if($ja_total <> 0 && $total2 <> 0 && $ja_total <> "" && $total2 <> ""){
					            $ja_total_per = number_format((floor(($ja_total / $total2) * 100 * 10)) / 10 ,1);
					        } else {
					            $ja_total_per = "---";
					        }
					        if($bn_total <> 0 && $total2 <> 0 && $bn_total <> "" && $total2 <> ""){
					            $bn_total_per = number_format((floor(($bn_total / $total2) * 100 * 10)) / 10 ,1);
					        } else {
					            $bn_total_per = "---";
					        }
					        if($bu_total <> 0 && $total2 <> 0 && $bu_total <> "" && $total2 <> ""){
					            $bu_total_per = number_format((floor(($bu_total / $total2) * 100 * 10)) / 10 ,1);
					        } else {
					            $bu_total_per = "---";
					        }
					        if($ba_total <> 0 && $total2 <> 0 && $ba_total <> "" && $total2 <> ""){
					            $ba_total_per = number_format((floor(($ba_total / $total2) * 100 * 10)) / 10 ,1);
					        } else {
					            $ba_total_per = "---";
					        }
					        if($jln_total <> 0 && $total2 <> 0 && $jln_total <> "" && $total2 <> ""){
					            $jln_total_per = number_format((floor(($jln_total / $total2) * 100 * 10)) / 10 ,1);
					        } else {
					            $jln_total_per = "---";
					        }
					        if($jlu_total <> 0 && $total2 <> 0 && $jlu_total <> "" && $total2 <> ""){
					            $jlu_total_per = number_format((floor(($jlu_total / $total2) * 100 * 10)) / 10 ,1);
					        } else {
					            $jlu_total_per = "---";
					        }
					        if($bgn_total <> 0 && $total2 <> 0 && $bgn_total <> "" && $total2 <> ""){
					            $bgn_total_per = number_format((floor(($bgn_total / $total2) * 100 * 10)) / 10 ,1);
					        } else {
					            $bgn_total_per = "---";
					        }
					        if($bgu_total <> 0 && $total2 <> 0 && $bgu_total <> "" && $total2 <> ""){
					            $bgu_total_per = number_format((floor(($bgu_total / $total2) * 100 * 10)) / 10 ,1);
					        } else {
					            $bgu_total_per = "---";
					        }
					        $jn_per_html .= "<div class='title7 ta_r'>" . $jn_total_per . "%</div>";
					        $ju_per_html .= "<div class='title7 ta_r'>" . $ju_total_per . "%</div>";
					        $ja_per_html .= "<div class='title7 ta_r'>" . $ja_total_per . "%</div>";
					        $bn_per_html .= "<div class='title7 ta_r'>" . $bn_total_per . "%</div>";
					        $bu_per_html .= "<div class='title7 ta_r'>" . $bu_total_per . "%</div>";
					        $ba_per_html .= "<div class='title7 ta_r'>" . $ba_total_per . "%</div>";
					        $jln_per_html .= "<div class='title7 ta_r'>" . $jln_total_per . "%</div>";
					        $jlu_per_html .= "<div class='title7 ta_r'>" . $jlu_total_per . "%</div>";
					        $bgn_per_html .= "<div class='title7 ta_r'>" . $bgn_total_per . "%</div>";
					        $bgu_per_html .= "<div class='title7 ta_r'>" . $bgu_total_per . "%</div>";

					    $past_temp4_all_sorce4 = "<p class='title_a'>金額・構成比（過去）</p><div class='box1'>" . $past_temp4_title4;
					    $past_temp4_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・N</div>" . $jn_per_html . "</div>";
					    $past_temp4_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・U</div>" . $ju_per_html . "</div>";
					    $past_temp4_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・A</div>" . $ja_per_html . "</div>";
					    $past_temp4_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・N</div>" . $bn_per_html . "</div>";
					    $past_temp4_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・U</div>" . $bu_per_html . "</div>";
					    $past_temp4_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・A</div>" . $ba_per_html . "</div>";
					    $past_temp4_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・N</div>" . $jln_per_html . "</div>";
					    $past_temp4_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・U</div>" . $jlu_per_html . "</div>";
					    $past_temp4_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・N</div>" . $bgn_per_html . "</div>";
					    $past_temp4_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・U</div>" . $bgu_per_html . "</div>";
					    $past_temp4_all_sorce4 .= "</div>";



                /************************************************************************************************************************************************************************************************************* */
                    // 過去・点数構成比
                /************************************************************************************************************************************************************************************************************* */

					    $i = 0;
					    $total = "";
					    $total2 = 0;
					    $jn_per = "";
					    $ju_per = "";
					    $ja_per = "";
					    $bn_per = "";
					    $bu_per = "";
					    $ba_per = "";
					    $jln_per = "";
					    $jlu_per = "";
					    $bgn_per = "";
					    $bgu_per = "";
					    $jn_total = "";
					    $ju_total = "";
					    $ja_total = "";
					    $bn_total = "";
					    $bu_total = "";
					    $ba_total = "";
					    $jln_total = "";
					    $jlu_total = "";
					    $bgn_total = "";
					    $bgu_total = "";
					    $jn_per_html = "";
					    $ju_per_html = "";
					    $ja_per_html = "";
					    $bn_per_html = "";
					    $bu_per_html = "";
					    $ba_per_html = "";
					    $jln_per_html = "";
					    $jlu_per_html = "";
					    $bgn_per_html = "";
					    $bgu_per_html = "";
					    $past_jn_total_js3 = "";
					    $past_ju_total_js3 = "";
					    $past_ja_total_js3 = "";
					    $past_bn_total_js3 = "";
					    $past_bu_total_js3 = "";
					    $past_ba_total_js3 = "";
					    $past_jln_total_js3 = "";
					    $past_jlu_total_js3 = "";
					    $past_bgn_total_js3 = "";
					    $past_bgu_total_js3 = "";
					    foreach($past_temp4_jn_manthly_array2 as $var){
					            $total = (int)$var + (int)$past_temp4_ju_manthly_array2[$i] + (int)$past_temp4_ja_manthly_array2[$i] + (int)$past_temp4_bn_manthly_array2[$i] + (int)$past_temp4_bu_manthly_array2[$i] + (int)$past_temp4_ba_manthly_array2[$i] + (int)$past_temp4_jln_manthly_array2[$i] + (int)$past_temp4_jlu_manthly_array2[$i] + (int)$past_temp4_bgn_manthly_array2[$i] + (int)$past_temp4_bgu_manthly_array2[$i];
					        $total2 = (int)$total2 + (int)$total;
					        $jn_total = (int)$jn_total + (int)$var;
					        $ju_total = (int)$ju_total + (int)$past_temp4_ju_manthly_array2[$i];
					        $ja_total = (int)$ja_total + (int)$past_temp4_ja_manthly_array2[$i];
					        $bn_total = (int)$bn_total + (int)$past_temp4_bn_manthly_array2[$i];
					        $bu_total = (int)$bu_total + (int)$past_temp4_bu_manthly_array2[$i];
					        $ba_total = (int)$ba_total + (int)$past_temp4_ba_manthly_array2[$i];
					        $jln_total = (int)$jln_total + (int)$past_temp4_jln_manthly_array2[$i];
					        $jlu_total = (int)$jlu_total + (int)$past_temp4_jlu_manthly_array2[$i];
					        $bgn_total = (int)$bgn_total + (int)$past_temp4_bgn_manthly_array2[$i];
					        $bgu_total = (int)$bgu_total + (int)$past_temp4_bgu_manthly_array2[$i];
					        if($var == 0){
					            $ju_per = "---";
					            if($past_temp4_ju_manthly_array2[$i] == 0){
					                $ju_per = "---";
					            } else {
					                    if($past_temp4_ju_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp4_ju_manthly_array2[$i] <> "" && $total <> ""){
					                        $ju_per = number_format((floor(($past_temp4_ju_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $ju_per = "---"; 
					                    }
					            }
					            if($past_temp4_ju_manthly_array2[$i] == 0){
					                $ju_per = "---";
					            } else {
					                    if($past_temp4_ju_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp4_ju_manthly_array2[$i] <> "" && $total <> ""){
					                        $ju_per = number_format((floor(($past_temp4_ju_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $ju_per = "---"; 
					                    }
					            }
					            
					            if($past_temp4_ja_manthly_array2[$i] == 0){
					                $ja_per = "---";
					            } else {
					                    if($past_temp4_ja_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp4_ja_manthly_array2[$i] <> "" && $total <> ""){
					                        $ja_per = number_format((floor(($past_temp4_ja_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $ja_per = "---"; 
					                    }
					            }
					            if($past_temp4_bn_manthly_array2[$i] == 0){
					                $bn_per = "---";
					            } else {
					                    if($past_temp4_bn_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp4_bn_manthly_array2[$i] <> "" && $total <> ""){
					                        $bn_per = number_format((floor(($past_temp4_bn_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $bn_per = "---"; 
					                    }
					            }
					            if($past_temp4_bu_manthly_array2[$i] == 0){
					                $bu_per = "---";
					            } else {
					                    if($past_temp4_bu_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp4_bu_manthly_array2[$i] <> "" && $total <> ""){
					                        $bu_per = number_format((floor(($past_temp4_bu_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $bu_per = "---"; 
					                    }
					            }
					            if($past_temp4_ba_manthly_array2[$i] == 0){
					                $ba_per = "---";
					            } else {
					                    if($past_temp4_ba_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp4_ba_manthly_array2[$i] <> "" && $total <> ""){
					                        $ba_per = number_format((floor(($past_temp4_ba_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $ba_per = "---"; 
					                    }
					            }
					            if($past_temp4_jln_manthly_array2[$i] == 0){
					                $jln_per = "---";
					            } else {
					                    if($past_temp4_jln_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp4_jln_manthly_array2[$i] <> "" && $total <> ""){
					                        $jln_per = number_format((floor(($past_temp4_jln_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $jln_per = "---"; 
					                    }
					            }
					            if($past_temp4_jlu_manthly_array2[$i] == 0){
					                $jlu_per = "---";
					            } else {
					                    if($past_temp4_jlu_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp4_jlu_manthly_array2[$i] <> "" && $total <> ""){
					                        $jlu_per = number_format((floor(($past_temp4_jlu_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $jlu_per = "---"; 
					                    }
					            }
					            if($past_temp4_bgn_manthly_array2[$i] == 0){
					                $bgn_per = "---";
					            } else {
					                    if($past_temp4_bgn_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp4_bgn_manthly_array2[$i] <> "" && $total <> ""){
					                        $bgn_per = number_format((floor(($past_temp4_bgn_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $bgn_per = "---"; 
					                    }
					            }
					            if($past_temp4_bgu_manthly_array2[$i] == 0){
					                $bgu_per = "---";
					            } else {
					                    if($past_temp4_bgu_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp4_bgu_manthly_array2[$i] <> "" && $total <> ""){
					                        $bgu_per = number_format((floor(($past_temp4_bgu_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $bgu_per = "---"; 
					                    }
					            }
					        } else {
					            if($var <> 0 && $total <> 0 && $var <> "" && $total <> ""){
					                $jn_per = number_format((floor(($var / $total) * 100 * 10)) / 10 ,1);
					            } else {
					                $jn_per = "---";
					            }
					            if($past_temp4_ju_manthly_array2[$i] == 0){
					                $ju_per = "---";
					            } else {
					                    if($past_temp4_ju_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp4_ju_manthly_array2[$i] <> "" && $total <> ""){
					                        $ju_per = number_format((floor(($past_temp4_ju_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $ju_per = "---";
					                    }
					            }
					            if($past_temp4_ja_manthly_array2[$i] == 0){
					                $ja_per = "---";
					            } else {
					                    if($past_temp4_ja_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp4_ja_manthly_array2[$i] <> "" && $total <> ""){
					                        $ja_per = number_format((floor(($past_temp4_ja_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $ja_per = "---";
					                    }
					            }
					            if($past_temp4_bn_manthly_array2[$i] == 0){
					                $bn_per = "---";
					            } else {
					                    if($past_temp4_bn_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp4_bn_manthly_array2[$i] <> "" && $total <> ""){
					                        $bn_per = number_format((floor(($past_temp4_bn_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $bn_per = "---";
					                    }
					            }
					            if($past_temp4_bu_manthly_array2[$i] == 0){
					                $bu_per = "---";
					            } else {
					                    if($past_temp4_bu_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp4_bu_manthly_array2[$i] <> "" && $total <> ""){
					                        $bu_per = number_format((floor(($past_temp4_bu_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $bu_per = "---";
					                    }
					            }
					            if($past_temp4_ba_manthly_array2[$i] == 0){
					                $ba_per = "---";
					            } else {
					                    if($past_temp4_ba_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp4_ba_manthly_array2[$i] <> "" && $total <> ""){
					                        $ba_per = number_format((floor(($past_temp4_ba_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $ba_per = "---";
					                    }
					            }
					            if($past_temp4_jln_manthly_array2[$i] == 0){
					                $jln_per = "---";
					            } else {
					                    if($past_temp4_jln_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp4_jln_manthly_array2[$i] <> "" && $total <> ""){
					                        $jln_per = number_format((floor(($past_temp4_jln_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $jln_per = "---";
					                    }
					            }
					            if($past_temp4_jlu_manthly_array2[$i] == 0){
					                $jlu_per = "---";
					            } else {
					                    if($past_temp4_jlu_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp4_jlu_manthly_array2[$i] <> "" && $total <> ""){
					                        $jlu_per = number_format((floor(($past_temp4_jlu_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $jlu_per = "---";
					                    }
					            }
					            if($past_temp4_bgn_manthly_array2[$i] == 0){
					                $bgn_per = "---";
					            } else {
					                    if($past_temp4_bgn_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp4_bgn_manthly_array2[$i] <> "" && $total <> ""){
					                        $bgn_per = number_format((floor(($past_temp4_bgn_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $bgn_per = "---";
					                    }
					            }
					            if($past_temp4_bgu_manthly_array2[$i] == 0){
					                $bgu_per = "---";
					            } else {
					                    if($past_temp4_bgu_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp4_bgu_manthly_array2[$i] <> "" && $total <> ""){
					                        $bgu_per = number_format((floor(($past_temp4_bgu_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
					                    } else {
					                        $bgu_per = "---";
					                    }
					            }
					            
					            
					        }
					        $jn_per_html .= "<div class='title7 ta_r'>" . $jn_per . "%</div>";
					        $past_jn_total_js3  .= (float)$jn_per . ", ";
					        $ju_per_html .= "<div class='title7 ta_r'>" . $ju_per . "%</div>";
					        $past_ju_total_js3  .= (float)$ju_per . ", ";
					        $ja_per_html .= "<div class='title7 ta_r'>" . $ja_per . "%</div>";
					        $past_ja_total_js3  .= (float)$ja_per . ", ";
					        $bn_per_html .= "<div class='title7 ta_r'>" . $bn_per . "%</div>";
					        $past_bn_total_js3  .= (float)$bn_per . ", ";
					        $bu_per_html .= "<div class='title7 ta_r'>" . $bu_per . "%</div>";
					        $past_bu_total_js3  .= (float)$bu_per . ", ";
					        $ba_per_html .= "<div class='title7 ta_r'>" . $ba_per . "%</div>";
					        $past_ba_total_js3  .= (float)$ba_per . ", ";
					        $jln_per_html .= "<div class='title7 ta_r'>" . $jln_per . "%</div>";
					        $past_jln_total_js3  .= (float)$jln_per . ", ";
					        $jlu_per_html .= "<div class='title7 ta_r'>" . $jlu_per . "%</div>";
					        $past_jlu_total_js3  .= (float)$jlu_per . ", ";
					        $bgn_per_html .= "<div class='title7 ta_r'>" . $bgn_per . "%</div>";
					        $past_bgn_total_js3  .= (float)$bgn_per . ", ";
					        $bgu_per_html .= "<div class='title7 ta_r'>" . $bgu_per . "%</div>";
					        $past_bgu_total_js3  .= (float)$bgu_per . ", ";

					        $i++;
					    }
					    // 期間中の売上合計に対するパーセンテージを取得
					        if($jn_total <> 0 && $total2 <> 0 && $jn_total <> "" && $total2 <> ""){
					            $jn_total_per = number_format((floor(($jn_total / $total2) * 100 * 10)) / 10 ,1);
					        } else {
					            $jn_total_per = "---";
					        }
					        if($ju_total <> 0 && $total2 <> 0 && $ju_total <> "" && $total2 <> ""){
					            $ju_total_per = number_format((floor(($ju_total / $total2) * 100 * 10)) / 10 ,1);
					        } else {
					            $ju_total_per = "---";
					        }
					        if($ja_total <> 0 && $total2 <> 0 && $ja_total <> "" && $total2 <> ""){
					            $ja_total_per = number_format((floor(($ja_total / $total2) * 100 * 10)) / 10 ,1);
					        } else {
					            $ja_total_per = "---";
					        }
					        if($bn_total <> 0 && $total2 <> 0 && $bn_total <> "" && $total2 <> ""){
					            $bn_total_per = number_format((floor(($bn_total / $total2) * 100 * 10)) / 10 ,1);
					        } else {
					            $bn_total_per = "---";
					        }
					        if($bu_total <> 0 && $total2 <> 0 && $bu_total <> "" && $total2 <> ""){
					            $bu_total_per = number_format((floor(($bu_total / $total2) * 100 * 10)) / 10 ,1);
					        } else {
					            $bu_total_per = "---";
					        }
					        if($ba_total <> 0 && $total2 <> 0 && $ba_total <> "" && $total2 <> ""){
					            $ba_total_per = number_format((floor(($ba_total / $total2) * 100 * 10)) / 10 ,1);
					        } else {
					            $ba_total_per = "---";
					        }
					        if($jln_total <> 0 && $total2 <> 0 && $jln_total <> "" && $total2 <> ""){
					            $jln_total_per = number_format((floor(($jln_total / $total2) * 100 * 10)) / 10 ,1);
					        } else {
					            $jln_total_per = "---";
					        }
					        if($jlu_total <> 0 && $total2 <> 0 && $jlu_total <> "" && $total2 <> ""){
					            $jlu_total_per = number_format((floor(($jlu_total / $total2) * 100 * 10)) / 10 ,1);
					        } else {
					            $jlu_total_per = "---";
					        }
					        if($bgn_total <> 0 && $total2 <> 0 && $bgn_total <> "" && $total2 <> ""){
					            $bgn_total_per = number_format((floor(($bgn_total / $total2) * 100 * 10)) / 10 ,1);
					        } else {
					            $bgn_total_per = "---";
					        }
					        if($bgu_total <> 0 && $total2 <> 0 && $bgu_total <> "" && $total2 <> ""){
					            $bgu_total_per = number_format((floor(($bgu_total / $total2) * 100 * 10)) / 10 ,1);
					        } else {
					            $bgu_total_per = "---";
					        }
					        $jn_per_html .= "<div class='title7 ta_r'>" . $jn_total_per . "%</div>";
					        $ju_per_html .= "<div class='title7 ta_r'>" . $ju_total_per . "%</div>";
					        $ja_per_html .= "<div class='title7 ta_r'>" . $ja_total_per . "%</div>";
					        $bn_per_html .= "<div class='title7 ta_r'>" . $bn_total_per . "%</div>";
					        $bu_per_html .= "<div class='title7 ta_r'>" . $bu_total_per . "%</div>";
					        $ba_per_html .= "<div class='title7 ta_r'>" . $ba_total_per . "%</div>";
					        $jln_per_html .= "<div class='title7 ta_r'>" . $jln_total_per . "%</div>";
					        $jlu_per_html .= "<div class='title7 ta_r'>" . $jlu_total_per . "%</div>";
					        $bgn_per_html .= "<div class='title7 ta_r'>" . $bgn_total_per . "%</div>";
					        $bgu_per_html .= "<div class='title7 ta_r'>" . $bgu_total_per . "%</div>";

					    $past_temp4_all_sorce4 .= "<p class='title_a'>点数・構成比（過去）</p><div class='box1'>" . $past_temp4_title4;
					    $past_temp4_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・N</div>" . $jn_per_html . "</div>";
					    $past_temp4_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・U</div>" . $ju_per_html . "</div>";
					    $past_temp4_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・A</div>" . $ja_per_html . "</div>";
					    $past_temp4_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・N</div>" . $bn_per_html . "</div>";
					    $past_temp4_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・U</div>" . $bu_per_html . "</div>";
					    $past_temp4_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・A</div>" . $ba_per_html . "</div>";
					    $past_temp4_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・N</div>" . $jln_per_html . "</div>";
					    $past_temp4_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・U</div>" . $jlu_per_html . "</div>";
					    $past_temp4_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・N</div>" . $bgn_per_html . "</div>";
					    $past_temp4_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・U</div>" . $bgu_per_html . "</div>";
					    $past_temp4_all_sorce4 .= "</div>";



                /************************************************************************************************************************************************************************************************************* */
                    // 過去・平均単価
                /************************************************************************************************************************************************************************************************************* */


					    $i = 0;
					    $jn_average = "";
					    $jn_ave_html = "";
					    $jn_total = "";
					    $jn_total2 = "";
					    $jn_total_ave = "";
					    foreach($past_temp4_jn_manthly_array as $var){

					        if($var == 0){
					            $jn_average = 0;
					            $jn_total = (int)$jn_total + (int)$var;
					            if($past_temp4_jn_manthly_array2[$i] == 0){
					                $jn_total2 = $jn_total2;
					            } else {
					                $jn_total2 = (int)$jn_total2 + (int)$past_temp4_jn_manthly_array2[$i];
					            }
					        } else {
					            if($var <> 0 && $past_temp4_jn_manthly_array2[$i] <> 0 && $var <> "" && $past_temp4_jn_manthly_array2[$i] <> ""){
					                $jn_average = (floor(((int)$var / (int)$past_temp4_jn_manthly_array2[$i])) * 10) / 10;
					            } else {
					                $jn_average = "---";
					            }
					            $jn_total = (int)$jn_total + (int)$var;
					            if($past_temp4_jn_manthly_array2[$i] == 0){
					                $jn_total2 = $jn_total2;
					            } else {
					                $jn_total2 = (int)$jn_total2 + (int)$past_temp4_jn_manthly_array2[$i];
					            }
					        }
					        if($jn_average <> 0 && $jn_average <> ""){$jn_average = number_format((int)$jn_average);}
					        $jn_ave_html .= "<div class='title7 ta_r'>" . $jn_average . "</div>";

					        $i++;
					    }
					    // 期間中の売上合計に対する平均単価を取得
					        if($jn_total <> 0 && $jn_total2 <> 0 && $jn_total <> "" && $jn_total2 <> ""){
					            $jn_total_ave = (floor(($jn_total / $jn_total2) * 10)) / 10;
					        } else {
					            $jn_total_ave = "---";
					        }
					        if($jn_total_ave <> 0 && $jn_total_ave <> ""){$jn_total_ave = number_format((int)$jn_total_ave);}
					        $jn_ave_html .= "<div class='title7 ta_r'>" . $jn_total_ave . "</div>";

					    $i = 0;
					    $ju_average = "";
					    $ju_ave_html = "";
					    $ju_total = "";
					    $ju_total2 = "";
					    $ju_total_ave = "";
					    foreach($past_temp4_ju_manthly_array as $var){

					        if($var == 0){
					            $ju_average = 0;
					            $ju_total = (int)$ju_total + (int)$var;
					            if($past_temp4_ju_manthly_array2[$i] == 0){
					                $ju_total2 = $ju_total2;
					            } else {
					                $ju_total2 = (int)$ju_total2 + (int)$past_temp4_ju_manthly_array2[$i];
					            }
					        } else {
					            if($var <> 0 && $past_temp4_ju_manthly_array2[$i] <> 0 && $var <> "" && $past_temp4_ju_manthly_array2[$i] <> ""){
					                $ju_average = (floor(((int)$var / (int)$past_temp4_ju_manthly_array2[$i])));
					            } else {
					                $ju_average = "---";
					            }
					            $ju_total = (int)$ju_total + (int)$var;
					            if($past_temp4_ju_manthly_array2[$i] == 0){
					                $ju_total2 = $ju_total2;
					            } else {
					                $ju_total2 = (int)$ju_total2 + (int)$past_temp4_ju_manthly_array2[$i];
					            }
					        }
					        if($ju_average <> 0 && $ju_average <> ""){$ju_average = number_format((int)$ju_average);}
					        $ju_ave_html .= "<div class='title7 ta_r'>" . $ju_average . "</div>";

					        $i++;
					    }
					    // 期間中の売上合計に対する平均単価を取得
					        if($ju_total <> 0 && $ju_total2 <> 0 && $ju_total <> "" && $ju_total2 <> ""){
					            $ju_total_ave = (floor(((float)$ju_total / (float)$ju_total2)));
					        } else {
					            $ju_total_ave = "---";
					        }
					        if($ju_total_ave <> 0 && $ju_total_ave <> ""){$ju_total_ave = number_format((int)$ju_total_ave);}
					        $ju_ave_html .= "<div class='title7 ta_r'>" . $ju_total_ave . "</div>";

					            $i = 0;
					            $ja_average = "";
					            $ja_ave_html = "";
					            $ja_total = "";
					            $ja_total2 = "";
					            $ja_total_ave = "";
					            foreach($past_temp4_ja_manthly_array as $var){

					                if($var == 0){
					                    $ja_average = 0;
					                    $ja_total = (int)$ja_total + (int)$var;
					                    if($past_temp4_ja_manthly_array2[$i] == 0){
					                        $ja_total2 = $ja_total2;
					                    } else {
					                        $ja_total2 = (int)$ja_total2 + (int)$past_temp4_ja_manthly_array2[$i];
					                    }
					                } else {
					                    if($var <> 0 && $past_temp4_ja_manthly_array2[$i] <> 0 && $var <> "" && $past_temp4_ja_manthly_array2[$i] <> ""){
					                        $ja_average = (floor(((int)$var / (int)$past_temp4_ja_manthly_array2[$i])) * 10) / 10;
					                    } else {
					                        $ja_average = "---";
					                    }
					                    $ja_total = (int)$ja_total + (int)$var;
					                    if($past_temp4_ja_manthly_array2[$i] == 0){
					                        $ja_total2 = $ja_total2;
					                    } else {
					                        $ja_total2 = (int)$ja_total2 + (int)$past_temp4_ja_manthly_array2[$i];
					                    }
					                }
					                if($ja_average <> 0 && $ja_average <> ""){$ja_average = number_format((int)$ja_average);}
					                $ja_ave_html .= "<div class='title7 ta_r'>" . $ja_average . "</div>";

					                $i++;
					            }
					            // 期間中の売上合計に対する平均単価を取得
					                if($ja_total == 0 || $ja_total2 == 0 || $ja_total == "" || $ja_total2 == ""){
					                    $ja_total_ave = "---";
					                } else {
					                    $ja_total_ave = (floor(((int)$ja_total / (int)$ja_total2) * 10)) / 10;
					                }

					                if($ja_total_ave <> 0 && $ja_total_ave <> ""){$ja_total_ave = number_format((int)$ja_total_ave);}
					                $ja_ave_html .= "<div class='title7 ta_r'>" . $ja_total_ave . "</div>";



					            $i = 0;
					            $bn_average = "";
					            $bn_ave_html = "";
					            $bn_total = "";
					            $bn_total2 = "";
					            $bn_total_ave = "";
					            foreach($past_temp4_bn_manthly_array as $var){

					                if($var == 0){
					                    $bn_average = 0;
					                    $bn_total = (int)$bn_total + (int)$var;
					                    if($past_temp4_bn_manthly_array2[$i] == 0){
					                        $bn_total2 = $bn_total2;
					                    } else {
					                        $bn_total2 = (int)$bn_total2 + (int)$past_temp4_bn_manthly_array2[$i];
					                    }
					                } else {
					                    if($var <> 0 && $past_temp4_bn_manthly_array2[$i] <> 0 && $var <> "" && $past_temp4_bn_manthly_array2[$i] <> ""){
					                        $bn_average = (floor(((int)$var / (int)$past_temp4_bn_manthly_array2[$i])) * 10) / 10;
					                    } else {
					                        $bn_average = "---";
					                    }
					                    $bn_total = (int)$bn_total + (int)$var;
					                    if($past_temp4_bn_manthly_array2[$i] == 0){
					                        $bn_total2 = $bn_total2;
					                    } else {
					                        $bn_total2 = (int)$bn_total2 + (int)$past_temp4_bn_manthly_array2[$i];
					                    }
					                }
					                if($bn_average <> 0 && $bn_average <> ""){$bn_average = number_format((int)$bn_average);}
					                $bn_ave_html .= "<div class='title7 ta_r'>" . $bn_average . "</div>";

					                $i++;
					            }
					            // 期間中の売上合計に対する平均単価を取得
					                if($bn_total == 0 || $bn_total2 == 0 || $bn_total == "" || $bn_total2 == ""){
					                    $obn_total_ave = "---";
					                } else {
					                    $bn_total_ave = (floor(((int)$bn_total / (int)$bn_total2) * 10)) / 10;
					                }

					                if($bn_total_ave <> 0 && $bn_total_ave <> ""){$bn_total_ave = number_format((int)$bn_total_ave);}
					                $bn_ave_html .= "<div class='title7 ta_r'>" . $bn_total_ave . "</div>";



					    $i = 0;
					    $bu_average = "";
					    $bu_ave_html = "";
					    $bu_total = "";
					    $bu_total2 = "";
					    $bu_total_ave = "";
					    foreach($past_temp4_bu_manthly_array as $var){

					        if($var == 0){
					            $bu_average = 0;
					            $bu_total = (int)$bu_total + (int)$var;
					            if($past_temp4_bu_manthly_array2[$i] == 0){
					                $bu_total2 = $bu_total2;
					            } else {
					                $bu_total2 = (int)$bu_total2 + (int)$past_temp4_bu_manthly_array2[$i];
					            }
					        } else {
					            if($var <> 0 && $past_temp4_bu_manthly_array2[$i] <> 0 && $var <> "" && $past_temp4_bu_manthly_array2[$i] <> ""){
					                $bu_average = (floor(((int)$var / (int)$past_temp4_bu_manthly_array2[$i])));
					            } else {
					                $bu_average = "---";
					            }
					            $bu_total = (int)$bu_total + (int)$var;
					            if($past_temp4_bu_manthly_array2[$i] == 0){
					                $bu_total2 = $bu_total2;
					            } else {
					                $bu_total2 = (int)$bu_total2 + (int)$past_temp4_bu_manthly_array2[$i];
					            }
					        }
					        if($bu_average <> 0 && $bu_average <> ""){$bu_average = number_format((int)$bu_average);}
					        $bu_ave_html .= "<div class='title7 ta_r'>" . $bu_average . "</div>";

					        $i++;
					    }
					    // 期間中の売上合計に対する平均単価を取得
					        if($bu_total <> 0 && $bu_total2 <> 0 && $bu_total <> "" && $bu_total2 <> ""){
					            $bu_total_ave = (floor(((float)$bu_total / (float)$bu_total2)));
					        } else {
					            $bu_total_ave = "---";
					        }
					        if($bu_total_ave <> 0 && $bu_total_ave <> ""){$bu_total_ave = number_format((int)$bu_total_ave);}
					        $bu_ave_html .= "<div class='title7 ta_r'>" . $bu_total_ave . "</div>";




					    $i = 0;
					    $ba_average = "";
					    $ba_ave_html = "";
					    $ba_total = "";
					    $ba_total2 = "";
					    $ba_total_ave = "";
					    foreach($past_temp4_ba_manthly_array as $var){

					        if($var == 0){
					            $ba_average = 0;
					            $ba_total = (int)$ba_total + (int)$var;
					            if($past_temp4_ba_manthly_array2[$i] == 0){
					                $ba_total2 = $ba_total2;
					            } else {
					                $ba_total2 = (int)$ba_total2 + (int)$past_temp4_ba_manthly_array2[$i];
					            }
					        } else {
					            if($var <> 0 && $past_temp4_ba_manthly_array2[$i] <> 0 && $var <> "" && $past_temp4_ba_manthly_array2[$i] <> ""){
					                $ba_average = (floor(((int)$var / (int)$past_temp4_ba_manthly_array2[$i])));
					            } else {
					                $ba_average = "---";
					            }
					            $ba_total = (int)$ba_total + (int)$var;
					            if($past_temp4_ba_manthly_array2[$i] == 0){
					                $ba_total2 = $ba_total2;
					            } else {
					                $ba_total2 = (int)$ba_total2 + (int)$past_temp4_ba_manthly_array2[$i];
					            }
					        }
					        if($ba_average <> 0 && $ba_average <> ""){$ba_average = number_format((int)$ba_average);}
					        $ba_ave_html .= "<div class='title7 ta_r'>" . $ba_average . "</div>";

					        $i++;
					    }
					    // 期間中の売上合計に対する平均単価を取得
					        if($ba_total <> 0 && $ba_total2 <> 0 && $ba_total <> "" && $ba_total2 <> ""){
					            $ba_total_ave = (floor(((float)$ba_total / (float)$ba_total2)));
					        } else {
					            $ba_total_ave = "---";
					        }
					        if($ba_total_ave <> 0 && $ba_total_ave <> ""){$ba_total_ave = number_format((int)$ba_total_ave);}
					        $ba_ave_html .= "<div class='title7 ta_r'>" . $ba_total_ave . "</div>";




					    $i = 0;
					    $ba_average = "";
					    $ba_ave_html = "";
					    $ba_total = "";
					    $ba_total2 = "";
					    $ba_total_ave = "";
					    foreach($past_temp4_ba_manthly_array as $var){

					        if($var == 0){
					            $ba_average = 0;
					            $ba_total = (int)$ba_total + (int)$var;
					            if($past_temp4_ba_manthly_array2[$i] == 0){
					                $ba_total2 = $ba_total2;
					            } else {
					                $ba_total2 = (int)$ba_total2 + (int)$past_temp4_ba_manthly_array2[$i];
					            }
					        } else {
					            if($var <> 0 && $past_temp4_ba_manthly_array2[$i] <> 0 && $var <> "" && $past_temp4_ba_manthly_array2[$i] <> ""){
					                $ba_average = (floor(((int)$var / (int)$past_temp4_ba_manthly_array2[$i])));
					            } else {
					                $ba_average = "---";
					            }
					            $ba_total = (int)$ba_total + (int)$var;
					            if($past_temp4_ba_manthly_array2[$i] == 0){
					                $ba_total2 = $ba_total2;
					            } else {
					                $ba_total2 = (int)$ba_total2 + (int)$past_temp4_ba_manthly_array2[$i];
					            }
					        }
					        if($ba_average <> 0 && $ba_average <> ""){$ba_average = number_format((int)$ba_average);}
					        $ba_ave_html .= "<div class='title7 ta_r'>" . $ba_average . "</div>";

					        $i++;
					    }
					    // 期間中の売上合計に対する平均単価を取得
					        if($ba_total <> 0 && $ba_total2 <> 0 && $ba_total <> "" && $ba_total2 <> ""){
					            $ba_total_ave = (floor(((float)$ba_total / (float)$ba_total2)));
					        } else {
					            $ba_total_ave = "---";
					        }
					        if($ba_total_ave <> 0 && $ba_total_ave <> ""){$ba_total_ave = number_format((int)$ba_total_ave);}
					        $ba_ave_html .= "<div class='title7 ta_r'>" . $ba_total_ave . "</div>";



					    $i = 0;
					    $jln_average = "";
					    $jln_ave_html = "";
					    $jln_total = "";
					    $jln_total2 = "";
					    $jln_total_ave = "";
					    foreach($past_temp4_jln_manthly_array as $var){

					        if($var == 0){
					            $jln_average = 0;
					            $jln_total = (int)$jln_total + (int)$var;
					            if($past_temp4_jln_manthly_array2[$i] == 0){
					                $jln_total2 = $jln_total2;
					            } else {
					                $jln_total2 = (int)$jln_total2 + (int)$past_temp4_jln_manthly_array2[$i];
					            }
					        } else {
					            if($var <> 0 && $past_temp4_jln_manthly_array2[$i] <> 0 && $var <> "" && $past_temp4_jln_manthly_array2[$i] <> ""){
					                $jln_average = (floor(((int)$var / (int)$past_temp4_jln_manthly_array2[$i])));
					            } else {
					                $jln_average = "---";
					            }
					            $jln_total = (int)$jln_total + (int)$var;
					            if($past_temp4_jln_manthly_array2[$i] == 0){
					                $jln_total2 = $jln_total2;
					            } else {
					                $jln_total2 = (int)$jln_total2 + (int)$past_temp4_jln_manthly_array2[$i];
					            }
					        }
					        if($jln_average <> 0 && $jln_average <> ""){$jln_average = number_format((int)$jln_average);}
					        $jln_ave_html .= "<div class='title7 ta_r'>" . $jln_average . "</div>";

					        $i++;
					    }
					    // 期間中の売上合計に対する平均単価を取得
					        if($jln_total <> 0 && $jln_total2 <> 0 && $jln_total <> "" && $jln_total2 <> ""){
					            $jln_total_ave = (floor(((float)$jln_total / (float)$jln_total2)));
					        } else {
					            $jln_total_ave = "---";
					        }
					        if($jln_total_ave <> 0 && $jln_total_ave <> ""){$jln_total_ave = number_format((int)$jln_total_ave);}
					        $jln_ave_html .= "<div class='title7 ta_r'>" . $jln_total_ave . "</div>";




					    $i = 0;
					    $jlu_average = "";
					    $jlu_ave_html = "";
					    $jlu_total = "";
					    $jlu_total2 = "";
					    $jlu_total_ave = "";
					    foreach($past_temp4_jlu_manthly_array as $var){

					        if($var == 0){
					            $jlu_average = 0;
					            $jlu_total = (int)$jlu_total + (int)$var;
					            if($past_temp4_jlu_manthly_array2[$i] == 0){
					                $jlu_total2 = $jlu_total2;
					            } else {
					                $jlu_total2 = (int)$jlu_total2 + (int)$past_temp4_jlu_manthly_array2[$i];
					            }
					        } else {
					            if($var <> 0 && $past_temp4_jlu_manthly_array2[$i] <> 0 && $var <> "" && $past_temp4_jlu_manthly_array2[$i] <> ""){
					                $jlu_average = (floor(((int)$var / (int)$past_temp4_jlu_manthly_array2[$i])));
					            } else {
					                $jlu_average = "---";
					            }
					            $jlu_total = (int)$jlu_total + (int)$var;
					            if($past_temp4_jlu_manthly_array2[$i] == 0){
					                $jlu_total2 = $jlu_total2;
					            } else {
					                $jlu_total2 = (int)$jlu_total2 + (int)$past_temp4_jlu_manthly_array2[$i];
					            }
					        }
					        if($jlu_average <> 0 && $jlu_average <> ""){$jlu_average = number_format((int)$jlu_average);}
					        $jlu_ave_html .= "<div class='title7 ta_r'>" . $jlu_average . "</div>";

					        $i++;
					    }
					    // 期間中の売上合計に対する平均単価を取得
					        if($jlu_total <> 0 && $jlu_total2 <> 0 && $jlu_total <> "" && $jlu_total2 <> ""){
					            $jlu_total_ave = (floor(((float)$jlu_total / (float)$jlu_total2)));
					        } else {
					            $jlu_total_ave = "---";
					        }
					        if($jlu_total_ave <> 0 && $jlu_total_ave <> ""){$jlu_total_ave = number_format((int)$jlu_total_ave);}
					        $jlu_ave_html .= "<div class='title7 ta_r'>" . $jlu_total_ave . "</div>";




					    $i = 0;
					    $bgn_average = "";
					    $bgn_ave_html = "";
					    $bgn_total = "";
					    $bgn_total2 = "";
					    $bgn_total_ave = "";
					    foreach($past_temp4_bgn_manthly_array as $var){

					        if($var == 0){
					            $bgn_average = 0;
					            $bgn_total = (int)$bgn_total + (int)$var;
					            if($past_temp4_bgn_manthly_array2[$i] == 0){
					                $bgn_total2 = $bgn_total2;
					            } else {
					                $bgn_total2 = (int)$bgn_total2 + (int)$past_temp4_bgn_manthly_array2[$i];
					            }
					        } else {
					            if($var <> 0 && $past_temp4_bgn_manthly_array2[$i] <> 0 && $var <> "" && $past_temp4_bgn_manthly_array2[$i] <> ""){
					                $bgn_average = (floor(((int)$var / (int)$past_temp4_bgn_manthly_array2[$i])));
					            } else {
					                $bgn_average = "---";
					            }
					            $bgn_total = (int)$bgn_total + (int)$var;
					            if($past_temp4_bgn_manthly_array2[$i] == 0){
					                $bgn_total2 = $bgn_total2;
					            } else {
					                $bgn_total2 = (int)$bgn_total2 + (int)$past_temp4_bgn_manthly_array2[$i];
					            }
					        }
					        if($bgn_average <> 0 && $bgn_average <> ""){$bgn_average = number_format((int)$bgn_average);}
					        $bgn_ave_html .= "<div class='title7 ta_r'>" . $bgn_average . "</div>";

					        $i++;
					    }
					    // 期間中の売上合計に対する平均単価を取得
					        if($bgn_total <> 0 && $bgn_total2 <> 0 && $bgn_total <> "" && $bgn_total2 <> ""){
					            $bgn_total_ave = (floor(((float)$bgn_total / (float)$bgn_total2)));
					        } else {
					            $bgn_total_ave = "---";
					        }
					        if($bgn_total_ave <> 0 && $bgn_total_ave <> ""){$bgn_total_ave = number_format((int)$bgn_total_ave);}
					        $bgn_ave_html .= "<div class='title7 ta_r'>" . $bgn_total_ave . "</div>";


					    $i = 0;
					    $bgu_average = "";
					    $bgu_ave_html = "";
					    $bgu_total = "";
					    $bgu_total2 = "";
					    $bgu_total_ave = "";
					    foreach($past_temp4_bgu_manthly_array as $var){

					        if($var == 0){
					            $bgu_average = 0;
					            $bgu_total = (int)$bgu_total + (int)$var;
					            if($past_temp4_bgu_manthly_array2[$i] == 0){
					                $bgu_total2 = $bgu_total2;
					            } else {
					                $bgu_total2 = (int)$bgu_total2 + (int)$past_temp4_bgu_manthly_array2[$i];
					            }
					        } else {
					            if($var <> 0 && $past_temp4_bgu_manthly_array2[$i] <> 0 && $var <> "" && $past_temp4_bgu_manthly_array2[$i] <> ""){
					                $bgu_average = (floor(((int)$var / (int)$past_temp4_bgu_manthly_array2[$i])));
					            } else {
					                $bgu_average = "---";
					            }
					            $bgu_total = (int)$bgu_total + (int)$var;
					            if($past_temp4_bgu_manthly_array2[$i] == 0){
					                $bgu_total2 = $bgu_total2;
					            } else {
					                $bgu_total2 = (int)$bgu_total2 + (int)$past_temp4_bgu_manthly_array2[$i];
					            }
					        }
					        if($bgu_average <> 0 && $bgu_average <> ""){$bgu_average = number_format((int)$bgu_average);}
					        $bgu_ave_html .= "<div class='title7 ta_r'>" . $bgu_average . "</div>";

					        $i++;
					    }
					    // 期間中の売上合計に対する平均単価を取得
					        if($bgu_total <> 0 && $bgu_total2 <> 0 && $bgu_total <> "" && $bgu_total2 <> ""){
					            $bgu_total_ave = (floor(((float)$bgu_total / (float)$bgu_total2)));
					        } else {
					            $bgu_total_ave = "---";
					        }
					        if($bgu_total_ave <> 0 && $bgu_total_ave <> ""){$bgu_total_ave = number_format((int)$bgu_total_ave);}
					        $bgu_ave_html .= "<div class='title7 ta_r'>" . $bgu_total_ave . "</div>";


					        $past_temp4_all_sorce5 = "<p class='title_a'>平均単価（過去）</p><div class='box1'>" . $past_temp4_title4;
					        $past_temp4_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・N</div>" . $jn_ave_html . "</div>";
					        $past_temp4_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・U</div>" . $ju_ave_html . "</div>";
					        $past_temp4_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・A</div>" . $ja_ave_html . "</div>";
					        $past_temp4_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・N</div>" . $bn_ave_html . "</div>";
					        $past_temp4_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・U</div>" . $bu_ave_html . "</div>";
					        $past_temp4_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・A</div>" . $ba_ave_html . "</div>";
					        $past_temp4_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・N</div>" . $jln_ave_html . "</div>";
					        $past_temp4_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・U</div>" . $jlu_ave_html . "</div>";
					        $past_temp4_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・N</div>" . $bgn_ave_html . "</div>";
					        $past_temp4_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・U</div>" . $bgu_ave_html . "</div>";
					        $past_temp4_all_sorce5 .= "</div>";



                                        // 各月の全部門売上合計の先頭（1列目）部分のタイトルHTML
                                            $all_sum_uriage = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $all_sum_number = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $all_sum_arari = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $all_sum_arari_per = "<div class='wid100 ul3'><div class='title5 ta_c'>粗利率(合計)</div>";

                                        // 各月の全部門売上合計を配列に代入
                                            $temp4_all_m_sum_uriage_array = array();
                                            $temp4_all_m_sum_number_array = array();
                                            $temp4_all_m_sum_arari_array = array();
                                            $i = 0;
                                            foreach($manth_now_array as $val){
                                                $all = "";
                                                $all2 = "";
                                                $all3 = "";
                                                $all = (int)$all + (int)$temp4_jn_manthly_array[$i]; $all2 = (int)$all2 + (int)$temp4_jn_manthly_array2[$i]; $all3 = (int)$all3 + (int)$temp4_jn_manthly_array3[$i];
                                                $all = (int)$all + (int)$temp4_ju_manthly_array[$i]; $all2 = (int)$all2 + (int)$temp4_ju_manthly_array2[$i]; $all3 = (int)$all3 + (int)$temp4_ju_manthly_array3[$i];
                                                $all = (int)$all + (int)$temp4_ja_manthly_array[$i]; $all2 = (int)$all2 + (int)$temp4_ja_manthly_array2[$i]; $all3 = (int)$all3 + (int)$temp4_ja_manthly_array3[$i];
                                                $all = (int)$all + (int)$temp4_bn_manthly_array[$i]; $all2 = (int)$all2 + (int)$temp4_bn_manthly_array2[$i]; $all3 = (int)$all3 + (int)$temp4_bn_manthly_array3[$i];
                                                $all = (int)$all + (int)$temp4_bu_manthly_array[$i]; $all2 = (int)$all2 + (int)$temp4_bu_manthly_array2[$i]; $all3 = (int)$all3 + (int)$temp4_bu_manthly_array3[$i];
                                                $all = (int)$all + (int)$temp4_ba_manthly_array[$i]; $all2 = (int)$all2 + (int)$temp4_ba_manthly_array2[$i]; $all3 = (int)$all3 + (int)$temp4_ba_manthly_array3[$i];
                                                $all = (int)$all + (int)$temp4_jln_manthly_array[$i]; $all2 = (int)$all2 + (int)$temp4_jln_manthly_array2[$i]; $all3 = (int)$all3 + (int)$temp4_jln_manthly_array3[$i];
                                                $all = (int)$all + (int)$temp4_jlu_manthly_array[$i]; $all2 = (int)$all2 + (int)$temp4_jlu_manthly_array2[$i]; $all3 = (int)$all3 + (int)$temp4_jlu_manthly_array3[$i];
                                                $all = (int)$all + (int)$temp4_bgn_manthly_array[$i]; $all2 = (int)$all2 + (int)$temp4_bgn_manthly_array2[$i]; $all3 = (int)$all3 + (int)$temp4_bgn_manthly_array3[$i];
                                                $all = (int)$all + (int)$temp4_bgu_manthly_array[$i]; $all2 = (int)$all2 + (int)$temp4_bgu_manthly_array2[$i]; $all3 = (int)$all3 + (int)$temp4_bgu_manthly_array3[$i];

                                                array_push($temp4_all_m_sum_uriage_array,$all);
                                                array_push($temp4_all_m_sum_number_array,$all2);
                                                array_push($temp4_all_m_sum_arari_array,$all3);

                                                $i++;
                                            }
                                        // 各月の全部門売上合計部分のHTML作成
                                            foreach($temp4_all_m_sum_uriage_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $all_sum_uriage .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $all_sum_uriage .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                            }
                                            
                                        // 各月の全部門売上点数合計部分のHTML作成
                                            foreach($temp4_all_m_sum_number_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $all_sum_number .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $all_sum_number .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                            }
                                            
                                        // 各月の全部門粗利合計部分のHTML作成
                                            $i = 0;
                                            $arari_ratio = "";
                                            $all_arari_total = "";
                                            foreach($temp4_all_m_sum_arari_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $all_sum_arari .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $all_sum_arari .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                                // 各月の粗利率を取得
                                                    if($temp4_all_m_sum_uriage_array[$i] == 0){
                                                        $arari_ratio = "---";
                                                    } else {
                                                        $arari_ratio = number_format((floor(((int)$var / (int)$temp4_all_m_sum_uriage_array[$i]) * 100 * 10)) / 10 ,1);
                                                    }
                                                    // 現在・粗利・縦軸合計
                                                        $all_sum_arari_per .= "<div class='title6 ta_r'>" . $arari_ratio . "%</div>";
                                                    // 現在・合計粗利率（JSグラフ用） 
                                                        $all_arari_total .= (float)$arari_ratio . ", ";

                                                    // 過去・現在の粗利率合計差の計算に使用
                                                        ${"arari_ratio_" . $i} = $arari_ratio;


                                                $i++;
                                            }


                                        // 各月・粗利率合計を取得
                                            $arati_cutting_total_html = "";
                                            $arari_ratio_cutting = "";
                                            for($a = 0; $a < $i; $a++){
                                                $arati_cutting_total = "";
                                                $arari_ratio_cutting = (float)${"arari_ratio_" . $a} - (float)${"past_arari_ratio_" . $a};
                                                //$arati_cutting_total_html .= "<div class='title7 ta_r'>" . $arari_ratio_cutting . "</div>";
                                                if($arari_ratio_cutting < 0){
                                                    $arati_cutting_total_html .= "<div class='title7 ta_r fc_blue'>" . $arari_ratio_cutting . "%</div>";
                                                } else {
                                                    $arati_cutting_total_html .= "<div class='title7 ta_r fc_red'>" . $arari_ratio_cutting . "%</div>";
                                                }
                                            }
                                        // 各月合計・粗利率合計を取得
                                                $all_ratio_cutting_ave = (float)$jn_ratio_cutting_ave + (float)$ju_ratio_cutting_ave + (float)$ja_ratio_cutting_ave + (float)$bn_ratio_cutting_ave + (float)$bu_ratio_cutting_ave + (float)$ba_ratio_cutting_ave + (float)$jln_ratio_cutting_ave + (float)$jlu_ratio_cutting_ave + (float)$bgn_ratio_cutting_ave + (float)$bgu_ratio_cutting_ave;
                                                //$arati_cutting_total_html .= "<div class='title7 ta_r bg_grey'>" . $all_ratio_cutting_ave . "</div>";
                                                if($all_ratio_cutting_ave < 0){
                                                    $arati_cutting_total_html .= "<div class='title7 ta_r bg_grey fc_blue'>" . $all_ratio_cutting_ave . "%</div>";
                                                } else {
                                                    $arati_cutting_total_html .= "<div class='title7 ta_r bg_grey fc_red'>" . $all_ratio_cutting_ave . "%</div>";
                                                }



                                        $temp4_all_sorce13 = "<p class='title_a'>粗利率・過去比</p><div class='box1'>" . $temp4_title5;
                                        $temp4_all_sorce13 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・N</div>" . $jn_ratio_cutting_html . "</div>";
                                        $temp4_all_sorce13 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・U</div>" . $ju_ratio_cutting_html . "</div>";
                                        $temp4_all_sorce13 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジャック・A</div>" . $ja_ratio_cutting_html . "</div>";
                                        $temp4_all_sorce13 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・N</div>" . $bn_ratio_cutting_html . "</div>";
                                        $temp4_all_sorce13 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・U</div>" . $bu_ratio_cutting_html . "</div>";
                                        $temp4_all_sorce13 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ベティー・A</div>" . $ba_ratio_cutting_html . "</div>";
                                        $temp4_all_sorce13 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・N</div>" . $jln_ratio_cutting_html . "</div>";
                                        $temp4_all_sorce13 .= "<div class='wid100 ul4'><div class='title7 ta_c'>ジュエリー・U</div>" . $jlu_ratio_cutting_html . "</div>";
                                        $temp4_all_sorce13 .= "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・N</div>" . $bgn_ratio_cutting_html . "</div>";
                                        $temp4_all_sorce13 .= "<div class='wid100 ul4'><div class='title7 ta_c'>バッグ・U</div>" . $bgu_ratio_cutting_html . "</div>";
                                        $temp4_all_sorce13 .= "<div class='wid100 ul4 bg_grey'><div class='title7 ta_c'>合計</div>" . $arati_cutting_total_html . "</div></div>";

                            
                                        // 全期間全部門売上合計とその平均値のHTML作成
                                            if($all_sum_uriage_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更
                                                            $all_average = (int)$jn_sum_uriage_ave2 + (int)$ju_sum_uriage_ave2 + (int)$ja_sum_uriage_ave2 + (int)$bn_sum_uriage_ave2 + (int)$bu_sum_uriage_ave2 + (int)$ba_sum_uriage_ave2 + (int)$jln_sum_uriage_ave2 + (int)$jlu_sum_uriage_ave2 + (int)$bgn_sum_uriage_ave2 + (int)$bgu_sum_uriage_ave2;

                                            } else {
                                                $all_average = 0;            
                                            }
                                            $all_sum_uriage .= "<div class='title6 ta_r'>" . number_format((int)$all_sum_uriage_all) . "</div><div class='title6 ta_r'>" . number_format((int)$all_average) . "</div></div>";
                                        // 全HTMLを合体（検索対象外は除く）

                                            $view = "";
                                            $view .= $temp4_jn_manthly_html;
                                            $view .= $temp4_ju_manthly_html;
                                            $view .= $temp4_ja_manthly_html;
                                            $view .= $temp4_bn_manthly_html;
                                            $view .= $temp4_bu_manthly_html;
                                            $view .= $temp4_ba_manthly_html;
                                            $view .= $temp4_jln_manthly_html;
                                            $view .= $temp4_jlu_manthly_html;
                                            $view .= $temp4_bgn_manthly_html;
                                            $view .= $temp4_bgu_manthly_html;
                                            if($out4_a == "ON" && $out4_b <> "ON"){ $view_title1 = "（免税以外）";} else if($out4_a <> "ON" && $out4_b == "ON"){$view_title1 = "（免税のみ）";} else {$view_title1 = "";}
                                            $temp4_all_sorce = "<p class='title_a'>金額" . $view_title1 . "</p><div class='box1'>" . $temp4_title . $view . $all_sum_uriage . "</div>"/* . $uriage_progress*/;

                                        // 全期間全部門売上点数合計とその平均値のHTML作成
                                            if($all_sum_number_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更

                                                            $all_average2 = (int)$jn_sum_number_ave2 + (int)$ju_sum_number_ave2 + (int)$ja_sum_number_ave2 + (int)$bn_sum_number_ave2 + (int)$bu_sum_number_ave2 + (int)$ba_sum_number_ave2 + (int)$jln_sum_number_ave2 + (int)$jlu_sum_number_ave2 + (int)$bgn_sum_number_ave2 + (int)$bgu_sum_number_ave2;
                                            } else {
                                                $all_average2 = 0;
                                            }
                                            $all_sum_number .= "<div class='title6 ta_r'>" . number_format((int)$all_sum_number_all) . "</div><div class='title6 ta_r'>" . number_format((int)$all_average2) . "</div></div>";
                                        // 全HTMLを合体（検索対象外は除く）
                                        
                                            $view2 = "";
                                            $view2 .= $temp4_jn_manthly_html2;
                                            $view2 .= $temp4_ju_manthly_html2;
                                            $view2 .= $temp4_ja_manthly_html2;
                                            $view2 .= $temp4_bn_manthly_html2;
                                            $view2 .= $temp4_bu_manthly_html2;
                                            $view2 .= $temp4_ba_manthly_html2;
                                            $view2 .= $temp4_jln_manthly_html2;
                                            $view2 .= $temp4_jlu_manthly_html2;
                                            $view2 .= $temp4_bgn_manthly_html2;
                                            $view2 .= $temp4_bgu_manthly_html2;
                                            $temp4_all_sorce2 = "<p class='title_a'>点数" . $view_title1 . "</p><div class='box1'>" . $temp4_title . $view2 . $all_sum_number . "</div>"/* . $number_progress*/;
                                        // 全期間全部門粗利合計とその平均値のHTML作成
                                            if($all_sum_arari_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更
                                                            $all_average3 = (int)$jn_sum_arari_ave2 + (int)$ju_sum_arari_ave2 + (int)$ja_sum_arari_ave2 + (int)$bn_sum_arari_ave2 + (int)$bu_sum_arari_ave2 + (int)$ba_sum_arari_ave2 + (int)$jln_sum_arari_ave2 + (int)$jlu_sum_arari_ave2 + (int)$bgn_sum_arari_ave2 + (int)$bgu_sum_arari_ave2;
                                            } else {
                                                
                                                $all_average3 = 0;
                                            }
                                            $all_sum_arari .= "<div class='title6 ta_r'>" . number_format((int)$all_sum_arari_all) . "</div><div class='title6 ta_r'>" . number_format((int)$all_average3) . "</div></div>";
                                            // 粗利率の平均
                                                if($all_sum_arari_all <> 0){ $all_average4 = number_format(floor(((int)$all_sum_arari_all / (int)$all_sum_uriage_all) * 100 * 10) / 10 ,1);} else {$all_average4 = 0;}
                                                $all_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $all_average4 . "%</div></div>";
                                        // 全HTMLを合体（検索対象外は除く）
                                        
                                            $view3 = "";
                                            $view3 .= $temp4_jn_manthly_html3;
                                            $view3 .= $temp4_ju_manthly_html3;
                                            $view3 .= $temp4_ja_manthly_html3;
                                            $view3 .= $temp4_bn_manthly_html3;
                                            $view3 .= $temp4_bu_manthly_html3;
                                            $view3 .= $temp4_ba_manthly_html3;
                                            $view3 .= $temp4_jln_manthly_html3;
                                            $view3 .= $temp4_jlu_manthly_html3;
                                            $view3 .= $temp4_bgn_manthly_html3;
                                            $view3 .= $temp4_bgu_manthly_html3;
                                            $temp4_all_sorce3 = "<p class='title_a'>粗利" . $view_title1 . "</p><div class='box1'>" . $temp4_title . $view3 . $all_sum_arari . $jn_sum_arari_per . $ju_sum_arari_per . $ja_sum_arari_per . $bn_sum_arari_per . $bu_sum_arari_per . $ba_sum_arari_per . $jln_sum_arari_per . $jlu_sum_arari_per . $bgn_sum_arari_per . $bgu_sum_arari_per;
                                            $temp4_all_sorce3 .= $all_sum_arari_per  . "</div>"/* . $arari_progress*/;


                    /************************************************************************************************************************************************************************************************************* */
                        // DB情報の受け取り（検索期間） end
                    /************************************************************************************************************************************************************************************************************* */

                        // JSで表示させるための、期間売上などのデータを作成                    
                            $js_jn_uriage = substr($js_jn_uriage, 0, -2);
                            $js_ju_uriage = substr($js_ju_uriage, 0, -2);
                            $js_ja_uriage = substr($js_ja_uriage, 0, -2);
                            $js_bn_uriage = substr($js_bn_uriage, 0, -2);
                            $js_bu_uriage = substr($js_bu_uriage, 0, -2);
                            $js_ba_uriage = substr($js_ba_uriage, 0, -2);
                            $js_jln_uriage = substr($js_jln_uriage, 0, -2);
                            $js_jlu_uriage = substr($js_jlu_uriage, 0, -2);
                            $js_bgn_uriage = substr($js_bgn_uriage, 0, -2);
                            $js_bgu_uriage = substr($js_bgu_uriage, 0, -2);
                        // 列の横幅を列数によって可変させる
                            $line_width = 100 / ($diff_month + 4);
                            // 20230803
                            $line_width2 = 100 / ($diff_month + 1);

                            
                            if (PostRequest::has('brand_bumon_select')){ $brand_bumon_select = PostRequest::input('brand_bumon_select');} else {$brand_bumon_select = "";}
                            if (PostRequest::has('view_select')){ $view_select = PostRequest::input('view_select');} else {$view_select = "";}
                            return view($bladename,['view_select' => $view_select,'brand_bumon_select' => $brand_bumon_select,'first_day' => $first_day,'last_day' => $last_day,'next_year' => $next_year,'this_year' => $this_year,'last_year' => $last_year,'two_years_ago' => $two_years_ago,'three_years_ago' => $three_years_ago,'start_year' => $start_year,'start_month' => $start_month,'start_day' => $start_day,'end_year' => $end_year,'end_month' => $end_month,'end_day' => $end_day,'output' => $output,'form_view' => $form_view,'out1' => $out1,'out1_a' => $out1_a,'out1_b' => $out1_b,'out1_c' => $out1_c,'out1_d' => $out1_d,'out2_a' => $out2_a,'out2_b' => $out2_b,'out2_c' => $out2_c,'out2_d' => $out2_d,'out2_e' => $out2_e,'out3_a' => $out3_a,'out3_b' => $out3_b,'out3_c' => $out3_c,'out3_d' => $out3_d,'out3_e' => $out3_e,'out3_f' => $out3_f,'out4_a' => $out4_a,'out4_b' => $out4_b,'temp4_all_sorce' => $temp4_all_sorce,'temp4_all_sorce2' => $temp4_all_sorce2,'js_jn_uriage' => $js_jn_uriage,'js_ju_uriage' => $js_ju_uriage,'js_ja_uriage' => $js_ja_uriage,'js_bn_uriage' => $js_bn_uriage,'js_bu_uriage' => $js_bu_uriage,'js_ba_uriage' => $js_ba_uriage,'js_jln_uriage' => $js_jln_uriage,'js_jlu_uriage' => $js_jlu_uriage,'js_bgn_uriage' => $js_bgn_uriage,'js_bgu_uriage' => $js_bgu_uriage,'js_month' => $js_month,'past_between_start' => $past_between_start,'past_between_end' => $past_between_end,'past_temp4_all_sorce' => $past_temp4_all_sorce,'past_temp4_all_sorce2' => $past_temp4_all_sorce2,'past_js_jn_uriage' => $past_js_jn_uriage,'past_js_ju_uriage' => $past_js_ju_uriage,'past_js_ja_uriage' => $past_js_ja_uriage,'past_js_bn_uriage' => $past_js_bn_uriage,'past_js_bu_uriage' => $past_js_bu_uriage,'past_js_ba_uriage' => $past_js_ba_uriage,'past_js_jln_uriage' => $past_js_jln_uriage,'past_js_jlu_uriage' => $past_js_jlu_uriage,'past_js_bgn_uriage' => $past_js_bgn_uriage,'past_js_bgu_uriage' => $past_js_bgu_uriage,'past_js_jn_number' => $past_js_jn_number,'past_js_ju_number' => $past_js_ju_number,'past_js_ja_number' => $past_js_ja_number,'past_js_bn_number' => $past_js_bn_number,'past_js_bu_number' => $past_js_bu_number,'past_js_ba_number' => $past_js_ba_number,'past_js_jln_number' => $past_js_jln_number,'past_js_jlu_number' => $past_js_jlu_number,'past_js_bgn_number' => $past_js_bgn_number,'past_js_bgu_number' => $past_js_bgu_number,'js_jn_number' => $js_jn_number,'js_ju_number' => $js_ju_number,'js_ja_number' => $js_ja_number,'js_bn_number' => $js_bn_number,'js_bu_number' => $js_bu_number,'js_ba_number' => $js_ba_number,'js_jln_number' => $js_jln_number,'js_jlu_number' => $js_jlu_number,'js_bgn_number' => $js_bgn_number,'js_bgu_number' => $js_bgu_number,'js_all_month_uriage' => $js_all_month_uriage,'js_past_all_month_uriage' => $js_past_all_month_uriage,'js_all_month_number' => $js_all_month_number,'js_past_all_month_number' => $js_past_all_month_number,'js_jn_arari' => $js_jn_arari,'js_ju_arari' => $js_ju_arari,'js_ja_arari' => $js_ja_arari,'js_bn_arari' => $js_bn_arari,'js_bu_arari' => $js_bu_arari,'js_ba_arari' => $js_ba_arari,'js_jln_arari' => $js_jln_arari,'js_jlu_arari' => $js_jlu_arari,'js_bgn_arari' => $js_bgn_arari,'js_bgu_arari' => $js_bgu_arari,'js_all_month_arari' => $js_all_month_arari,'past_js_jn_arari' => $past_js_jn_arari,'past_js_ju_arari' => $past_js_ju_arari,'past_js_ja_arari' => $past_js_ja_arari,'past_js_bn_arari' => $past_js_bn_arari,'past_js_bu_arari' => $past_js_bu_arari,'past_js_ba_arari' => $past_js_ba_arari,'past_js_jln_arari' => $past_js_jln_arari,'past_js_jlu_arari' => $past_js_jlu_arari,'past_js_bgn_arari' => $past_js_bgn_arari,'past_js_bgu_arari' => $past_js_bgu_arari,'js_past_all_month_arari' => $js_past_all_month_arari,'temp4_all_sorce3' => $temp4_all_sorce3,'past_temp4_all_sorce3' => $past_temp4_all_sorce3,'search' => $search,'line_width' => $line_width,'line_width2' => $line_width2,'out5' => $out5,'out5_a' => $out5_a,'out5_b' => $out5_b,'out5_c' => $out5_c,/*'temp4_all_sorce4' => $temp4_all_sorce4,*/'temp4_all_sorce5' => $temp4_all_sorce5/*,'temp4_all_sorce6' => $temp4_all_sorce6,'temp4_all_sorce7' => $temp4_all_sorce7,'temp4_all_sorce8' => $temp4_all_sorce8*/,'temp4_all_sorce9' => $temp4_all_sorce9,'temp4_all_sorce10' => $temp4_all_sorce10,'temp4_all_sorce11' => $temp4_all_sorce11,'temp4_all_sorce12' => $temp4_all_sorce12,'temp4_all_sorce13' => $temp4_all_sorce13,/*'temp4_all_sorce14' => $temp4_all_sorce14,'temp4_all_sorce15' => $temp4_all_sorce15,*/'temp4_all_sorce16' => $temp4_all_sorce16,'past_temp4_all_sorce4' => $past_temp4_all_sorce4,'past_temp4_all_sorce5' => $past_temp4_all_sorce5,'jn_total_js' => $jn_total_js,'ju_total_js' => $ju_total_js,'ja_total_js' => $ja_total_js,'bn_total_js' => $bn_total_js,'bu_total_js' => $bu_total_js,'ba_total_js' => $ba_total_js,'ja_total_js' => $ja_total_js,'jln_total_js' => $jln_total_js,'jlu_total_js' => $jlu_total_js,'bgn_total_js' => $bgn_total_js,'bgu_total_js' => $bgu_total_js,'all_arari_total' => $all_arari_total,'past_jn_total_js' => $past_jn_total_js,'past_ju_total_js' => $past_ju_total_js,'past_ja_total_js' => $past_ja_total_js,'past_bn_total_js' => $past_bn_total_js,'past_bu_total_js' => $past_bu_total_js,'past_ba_total_js' => $past_ba_total_js,'past_ja_total_js' => $past_ja_total_js,'past_jln_total_js' => $past_jln_total_js,'past_jlu_total_js' => $past_jlu_total_js,'past_bgn_total_js' => $past_bgn_total_js,'past_bgu_total_js' => $past_bgu_total_js,'past_all_arari_total' => $past_all_arari_total,'jn_total_js2' => $jn_total_js2,'ju_total_js2' => $ju_total_js2,'ja_total_js2' => $ja_total_js2,'bn_total_js2' => $bn_total_js2,'bu_total_js2' => $bu_total_js2,'ba_total_js2' => $ba_total_js2,'ja_total_js2' => $ja_total_js2,'jln_total_js2' => $jln_total_js2,'jlu_total_js2' => $jlu_total_js2,'bgn_total_js2' => $bgn_total_js2,'bgu_total_js2' => $bgu_total_js2,'past_jn_total_js2' => $past_jn_total_js2,'past_ju_total_js2' => $past_ju_total_js2,'past_ja_total_js2' => $past_ja_total_js2,'past_bn_total_js2' => $past_bn_total_js2,'past_bu_total_js2' => $past_bu_total_js2,'past_ba_total_js2' => $past_ba_total_js2,'past_ja_total_js2' => $past_ja_total_js2,'past_jln_total_js2' => $past_jln_total_js2,'past_jlu_total_js2' => $past_jlu_total_js2,'past_bgn_total_js2' => $past_bgn_total_js2,'past_bgu_total_js2' => $past_bgu_total_js2,'jn_total_js3' => $jn_total_js3,'ju_total_js3' => $ju_total_js3,'ja_total_js3' => $ja_total_js3,'bn_total_js3' => $bn_total_js3,'bu_total_js3' => $bu_total_js3,'ba_total_js3' => $ba_total_js3,'ja_total_js3' => $ja_total_js3,'jln_total_js3' => $jln_total_js3,'jlu_total_js3' => $jlu_total_js3,'bgn_total_js3' => $bgn_total_js3,'bgu_total_js3' => $bgu_total_js3,'past_jn_total_js3' => $past_jn_total_js3,'past_ju_total_js3' => $past_ju_total_js3,'past_ja_total_js3' => $past_ja_total_js3,'past_bn_total_js3' => $past_bn_total_js3,'past_bu_total_js3' => $past_bu_total_js3,'past_ba_total_js3' => $past_ba_total_js3,'past_ja_total_js3' => $past_ja_total_js3,'past_jln_total_js3' => $past_jln_total_js3,'past_jlu_total_js3' => $past_jlu_total_js3,'past_bgn_total_js3' => $past_bgn_total_js3,'past_bgu_total_js3' => $past_bgu_total_js3,'out6' => $out6,'out7' => $out7,'uriage_progress_html' => $uriage_progress_html,'number_progress_html' => $number_progress_html,'arari_progress_html' => $arari_progress_html]);




        }












/************************************************************************************************************************************************************************************************************* */
    // DB情報取得（[売上]免税区分別用）
/************************************************************************************************************************************************************************************************************* */


    public function db_info_get6($a,$b,$c,$d,$e,$f,$g,$h,$j,$k,$l,$m,$n,$o,$p,$q,$r,$s,$t,$u,$v,$w){

        // 「groupBy」にロジックで作成した名称を指定した際のエラー対応（本番だとDB上のカラムに無い名称を「groupBy」するとエラーとなる。このエラーの場合selectに名称指定すると解決するらしいが、恐らくDBに無い名称だと別のエラーとなる。以下の二行を追記する事で対応）
                config(['database.connections.mysql.strict' => false]);
                DB::reconnect();


        $start_year = $a;
        $start_month = $b;
        $start_day = $c;
        $end_year = $d;
        $end_month = $e;
        $end_day = $f;
        $this_year = $g;
        $last_year = $h;
        $two_years_ago = $j;
        $output = $k;
        $out1 = $l;
        $out2 = $m;
        $out3 = $n;
        $out4 = $o;
        $out5 = $p;
        $search = $q;
        $three_years_ago = $r;
        $next_year = $s;
        $first_day = $t;
        $last_day = $u;
        $out6 = $v;
        $out7 = $w;


            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            // DB登録ロジックを実施
            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                

                    /************************************************************************************************************************************************************************************************************* */
                        // 定数管理用（メソッドの呼び出し）start
                    /************************************************************************************************************************************************************************************************************* */
                            $define = $this->define();
                            $def_i = 0;
                            // 各変数にパスやファイル名を代入
                                foreach($define as $def){
                                    if($def_i == 0){ $bladename = $def; }
                                    if($def_i == 1){ $file_pass = $def; }
                                    if($def_i == 2){ $file_pass2 = $def; }
                                    if($def_i == 3){ $file_name = $def; }
                                    if($def_i == 4){ $table_name = $def; }

                                    $def_i++;
                                }
                    /************************************************************************************************************************************************************************************************************* */
                        // 定数管理用（メソッドの呼び出し）end
                    /************************************************************************************************************************************************************************************************************* */
                
                    /************************************************************************************************************************************************************************************************************* */
                        // フォームボタン押下時情報の受け取り start
                    /************************************************************************************************************************************************************************************************************* */

                            // 検索期間を変数に代入
                                $between_start = $start_year . "/" . $start_month . "/" . $start_day ." 00-00:00";
                                $between_end = $end_year . "/" . $end_month . "/" . $end_day ." 23-59:59";
                                $between_start_view = $start_year . "/" . $start_month . "/" . $start_day;
                                $between_end_view = $end_year . "/" . $end_month . "/" . $end_day;


                                $diff_start1 = new DateTime($between_start_view);
                                $diff_end1 = new DateTime($between_end_view);

                                $interval1 = $diff_end1 -> diff($diff_start1);

                                $diff_year1= $interval1 -> y;
                                $diff_month1 = $interval1 -> m;
                                $diff_month1 = $diff_year1 * 12 + $diff_month1;

                            // 「フォーム表示ボタン」フラグ
                                if (PostRequest::has('form_view')) {
                                    $form_view = PostRequest::input('form_view');
                                } else {$form_view = "OFF";}
                            

                            // 「売却区分」フラグ
                                $out1_a = "OFF";
                                $out1_b = "OFF";
                                $out1_c = "OFF";
                                $out1_d = "OFF";
                                if($out1 <> "" && in_array('2',$out1)){ $out1_a = "ON";}
                                if($out1 <> "" && in_array('3',$out1)){ $out1_b = "ON";}
                                if($out1 <> "" && in_array('4',$out1)){ $out1_c = "ON";}
                                if($out1 <> "" && in_array('5',$out1)){ $out1_d = "ON";}
                                
                                // 免税は必ず表示
                                $out1_c = "ON";

                                
                            // 新中アンフラグ
                                $out2_a = "OFF";
                                $out2_b = "OFF";
                                $out2_c = "OFF";
                                $out2_d = "OFF";
                                $out2_e = "OFF";
                                if($out2 <> "" && in_array('1',$out2)){ $out2_a = "ON";}
                                if($out2 <> "" && in_array('2',$out2)){ $out2_b = "ON";}
                                if($out2 <> "" && in_array('3',$out2)){ $out2_c = "ON";}
                                if($out2 <> "" && in_array('4',$out2)){ $out2_d = "ON";}
                                if($out2 <> "" && in_array('5',$out2)){ $out2_e = "ON";}
                                
                            // 免税フラグ
                                $out4_a = "OFF";
                                $out4_b = "OFF";
                                if($out4 <> "" && in_array('1',$out4)){ $out4_a = "ON";}
                                if($out4 <> "" && in_array('2',$out4)){ $out4_b = "ON";}
                                

                            // 通販サイトフラグ
                                $out3_a = "OFF";
                                $out3_b = "OFF";
                                $out3_c = "OFF";
                                $out3_d = "OFF";
                                $out3_e = "OFF";
                                $out3_f = "OFF";
                                if($out3 <> "" && in_array('1',$out3)){ $out3_a = "ON";}
                                if($out3 <> "" && in_array('2',$out3)){ $out3_b = "ON";}
                                if($out3 <> "" && in_array('3',$out3)){ $out3_c = "ON";}
                                if($out3 <> "" && in_array('4',$out3)){ $out3_d = "ON";}
                                if($out3 <> "" && in_array('5',$out3)){ $out3_e = "ON";}
                                if($out3 <> "" && in_array('6',$out3)){ $out3_f = "ON";}
                                
                            // ブランドフラグ
                                $out5_a = "OFF";
                                $out5_b = "OFF";
                                $out5_c = "OFF";
                                if($out5 <> "" && in_array('2',$out5)){ $out5_a = "ON";}
                                if($out5 <> "" && in_array('3',$out5)){ $out5_b = "ON";}
                                if($out5 <> "" && in_array('4',$out5)){ $out5_c = "ON";}


                    /************************************************************************************************************************************************************************************************************* */
                        // フォームボタン押下時情報の受け取り end
                    /************************************************************************************************************************************************************************************************************* */


                    /************************************************************************************************************************************************************************************************************* */
                        // 検索期間の月数だけ遡った過去の期間を取得 start
                    /************************************************************************************************************************************************************************************************************* */


                            // 開始と終了期間の差分（～カ月）を取得                        
                                $start = $start_year . "-" . $start_month . "-" . $start_day;
                                $end = $end_year . "-" . $end_month . "-" . $end_day;
                                $diff_start = new DateTime($start);
                                $diff_end = new DateTime($end);

                                $interval = $diff_end -> diff($diff_start);

                                $diff_year = $interval -> y;
                                $diff_month = $interval -> m;
                                $diff_month = $diff_year * 12 + $diff_month;
                                //echo $diff_month . "カ月<br>";
                            // 差分の月だけ遡った過去の期間を取得
                                // 検索開始日                
                                    $start_now = date($start_year. "-" . $start_month. "-" . $start_day);
                                // 過去開始日
                                    //$start_past = date("Y-m-d", strtotime($start_now . " -" . $diff_month . " month"));
                                    $past_between_start = date("Y-m-d", strtotime($start_now . " -" . ($diff_month + 1) . " month"));
                                    $past_between_start_view = date("Y-m", strtotime($start_now . " -" . ($diff_month +1) . " month"));
                                // 検索終了日
                                    $end_now = date($end_year. "-" . $end_month. "-" . $end_day);
                                // 過去終了日
                                    //$end_past = date("Y-m-d", strtotime($end_now . " -" . $diff_month . " month"));
                                    $past_between_end = date("Y-m-d", strtotime($start_now . " -1 day"));
                                    $past_between_end_view = date("Y-m", strtotime($start_now . " -1 month"));

                                // 過去期間の月初日を配列へ代入（該当月のデータ登録が無い場合、JS代入値が空になってグラフがズレてしまう事を回避するため0代入ロジックに使う）
                                    // 配列版
                                        $manth_now_array = array();
                                        $manth_past_array = array();
                                    // カンマ区切りの文字列版
                                        $temp1_web_manthly_data = "";
                                        $temp1_web_manthly_data2 = "";
                                        $temp1_web_manthly_data3 = "";
                                        $past_temp1_web_manthly_data = "";
                                        $past_temp1_web_manthly_data2 = "";
                                        $past_temp1_web_manthly_data3 = "";
                                        $temp1_shop_manthly_data = "";
                                        $temp1_shop_manthly_data2 = "";
                                        $temp1_shop_manthly_data3 = "";
                                        $past_temp1_shop_manthly_data = "";
                                        $past_temp1_shop_manthly_data2 = "";
                                        $past_temp1_shop_manthly_data3 = "";
                                        $temp1_oroshi_manthly_data = "";
                                        $temp1_oroshi_manthly_data2 = "";
                                        $temp1_oroshi_manthly_data3 = "";
                                        $past_temp1_oroshi_manthly_data = "";
                                        $past_temp1_oroshi_manthly_data2 = "";
                                        $past_temp1_oroshi_manthly_data3 = "";
                                    for($past_ii = 0;  $past_ii <= $diff_month; $past_ii++){
                                        if($past_ii == 0){
                                            // 現在用
                                                $manth_now = date("Y-m", strtotime($start_now));
                                            // 過去用
                                                $past_manth = $past_between_start;
                                                $past_manth2 = mb_substr($past_between_start,0,-3);
                                        } else {
                                            // 現在用
                                                $manth_now = date("Y-m", strtotime($manth_now . " 1 month"));
                                            // 過去用
                                                $past_manth = date("Y-m-d", strtotime($past_manth . " 1 month"));
                                                $past_manth2 = date("Y-m", strtotime($past_manth2 . " 1 month"));
                                        }
                                        // 現在用
                                            array_push($manth_now_array,$manth_now);
                                        // 過去用
                                            array_push($manth_past_array,$past_manth);
                                            $temp1_web_manthly_data .= $manth_now . ",";
                                            $temp1_web_manthly_data2 .= $manth_now . ",";
                                            $temp1_web_manthly_data3 .= $manth_now . ",";
                                            $past_temp1_web_manthly_data .= $past_manth2 . ",";
                                            $past_temp1_web_manthly_data2 .= $past_manth2 . ",";
                                            $past_temp1_web_manthly_data3 .= $past_manth2 . ",";
                                            $temp1_shop_manthly_data .= $manth_now . ",";
                                            $temp1_shop_manthly_data2 .= $manth_now . ",";
                                            $temp1_shop_manthly_data3 .= $manth_now . ",";
                                            $past_temp1_shop_manthly_data .= $past_manth2 . ",";
                                            $past_temp1_shop_manthly_data2 .= $past_manth2 . ",";
                                            $past_temp1_shop_manthly_data3 .= $past_manth2 . ",";
                                            $temp1_oroshi_manthly_data .= $manth_now . ",";
                                            $temp1_oroshi_manthly_data2 .= $manth_now . ",";
                                            $temp1_oroshi_manthly_data3 .= $manth_now . ",";
                                            $past_temp1_oroshi_manthly_data .= $past_manth2 . ",";
                                            $past_temp1_oroshi_manthly_data2 .= $past_manth2 . ",";
                                            $past_temp1_oroshi_manthly_data3 .= $past_manth2 . ",";

                                    }
                                    $temp1_web_manthly_data = trim($temp1_web_manthly_data ,",");
                                    $temp1_web_manthly_data2 = trim($temp1_web_manthly_data2 ,",");
                                    $temp1_web_manthly_data3 = trim($temp1_web_manthly_data3 ,",");
                                    $past_temp1_web_manthly_data = trim($past_temp1_web_manthly_data ,",");
                                    $past_temp1_web_manthly_data2 = trim($past_temp1_web_manthly_data2 ,",");
                                    $past_temp1_web_manthly_data3 = trim($past_temp1_web_manthly_data3 ,",");
                                    $temp1_shop_manthly_data = trim($temp1_shop_manthly_data ,",");
                                    $temp1_shop_manthly_data2 = trim($temp1_shop_manthly_data2 ,",");
                                    $temp1_shop_manthly_data3 = trim($temp1_shop_manthly_data3 ,",");
                                    $past_temp1_shop_manthly_data = trim($past_temp1_shop_manthly_data ,",");
                                    $past_temp1_shop_manthly_data2 = trim($past_temp1_shop_manthly_data2 ,",");
                                    $past_temp1_shop_manthly_data3 = trim($past_temp1_shop_manthly_data3 ,",");
                                    $temp1_oroshi_manthly_data = trim($temp1_oroshi_manthly_data ,",");
                                    $temp1_oroshi_manthly_data2 = trim($temp1_oroshi_manthly_data2 ,",");
                                    $temp1_oroshi_manthly_data3 = trim($temp1_oroshi_manthly_data3 ,",");
                                    $past_temp1_oroshi_manthly_data = trim($past_temp1_oroshi_manthly_data ,",");
                                    $past_temp1_oroshi_manthly_data2 = trim($past_temp1_oroshi_manthly_data2 ,",");
                                    $past_temp1_oroshi_manthly_data3 = trim($past_temp1_oroshi_manthly_data3 ,",");


                    /************************************************************************************************************************************************************************************************************* */
                        // 検索期間の月数だけ遡った過去の期間を取得 end
                    /************************************************************************************************************************************************************************************************************* */


// 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
    // 当月の最終日
        $last_day2 = date('Y-m-d', strtotime('last day of' . $last_day));
    // データ格納最終日がその月の最終日と一致するか否かでフラグを作成（一致しない場合は平均の計算に含めないようにするため）
        if($last_day2 <> $last_day){ $last_nodata_flag = "ON"; } else { $last_nodata_flag = "OFF"; }


// 【進捗率の取得】
                                        

                                        /************************************************************************************************************************************************************************************************************* */
                                            // 検索期間の最初の日を求める（最終データ格納月の月初日）start
                                        /************************************************************************************************************************************************************************************************************* */
                                                    $last_day_array = explode('-',$last_day);
                                                    $i = 0;
                                                    $last_day_top = "";
                                                    foreach($last_day_array as $var){
                                                        // 年月
                                                            if($i <> 2){
                                                                $last_day_top .= $var . "-";
                                                            }
                                                        // 年
                                                            if($i == 0){
                                                                $last_year_last = $var;
                                                            }
                                                        // 月
                                                            if($i == 1){
                                                                $last_month_last = $var;
                                                            }
                                                        // 日
                                                            if($i == 2){
                                                                $last_day_last = $var;
                                                            }
                                                        $i++;
                                                    }
                                                    // 年月に月初日を加える
                                                        $last_day_top .= "01";
                                                    // 当月の最終日
                                                        $last_day_last2 = date("d", strtotime($last_day_top . " +1 month -1day"));

                                        /************************************************************************************************************************************************************************************************************* */
                                            // 検索期間の最初の日を求める（最終データ格納月の月初日）end
                                        /************************************************************************************************************************************************************************************************************* */

                                        /************************************************************************************************************************************************************************************************************* */
                                            // 比較年月取得（最終データ格納年月の先月） start
                                        /************************************************************************************************************************************************************************************************************* */
                                                // 先月初日
                                                    $last_month_top = date("Y-m-d", strtotime($last_day_top . " -1 month"));
                                                // 先月最終日
                                                    $last_month = date("Y-m-d", strtotime($last_day_top . " -1day"));
                                        
                                        /************************************************************************************************************************************************************************************************************* */
                                            // 比較年月取得（最終データ格納年月の先月） end
                                        /************************************************************************************************************************************************************************************************************* */

                                        /************************************************************************************************************************************************************************************************************* */
                                            // 比較年月取得（最終データ格納年月から検索期間の月数だけ遡った年月） start
                                        /************************************************************************************************************************************************************************************************************* */

                                                // 差分の月だけ遡った過去の期間を取得
                                                    // 過去開始日（最終データ格納年月から検索期間を遡った年月日を取得）
                                                        $past_between_start_progress = date("Y-m-d", strtotime($last_day_top . " -" . ($diff_month + 1) . " month"));
                                                    // 過去終了日（上記年月日の月末日を取得）
                                                        $past_between_end_progress = date("Y-m-d", strtotime($past_between_start_progress . " +1 month -1day"));
                                        
                                        /************************************************************************************************************************************************************************************************************* */
                                            // 比較年月取得（最終データ格納年月から検索期間の月数だけ遡った年月） end
                                        /************************************************************************************************************************************************************************************************************* */


                                       
                                        
                                        /************************************************************************************************************************************************************************************************************* */
                                            // 最終データ格納月のデータ取得　start
                                        /************************************************************************************************************************************************************************************************************* */


                                                            // DB検索（店舗(免税外)値）スタート
                                                                $shop_progress = DB::table($table_name) 
                                                                // 月毎にグループ化して値を分けるための処理
                                                                    ->select([
                                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS shop_month'),
                                                                        \DB::raw("SUM(uriagekingaku) AS shop_uriage"),
                                                                        \DB::raw("SUM(uriagesuu) AS shop_number"),
                                                                        \DB::raw("SUM(ararikingaku) AS shop_arari"),
                                                                    ])
                                                                    // 条件（売上部門が店舗(免税外)）
                                                                        ->where('baikyakukubun',1)
                                                                    // 条件（期間の指定）
                                                                        ->whereBetween($table_name . '.uriage', [$last_day_top, $last_day])
                                                                        
                                                                    // 条件（分類名）
                                                                        ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                            // 条件（商品区分分類名が新品）
                                                                                if($out2_a == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                }
                                                                            // 条件（商品区分分類名が中古）
                                                                                if($out2_b == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                }
                                                                            // 条件（商品区分分類名がアンティーク）
                                                                                if($out2_c == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                }
                                                                            // 条件（商品区分分類名がその他）
                                                                                if($out2_d == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                }
                                                                            // 条件（商品区分分類名が修理）
                                                                                if($out2_e == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（通販区分）
                                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                                            $query->orWhere('tsuuhankubun','');

                                                                            // 条件（通販区分が自社）
                                                                                if($out3_a == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',1);
                                                                                }
                                                                            // 条件（通販区分が楽天）
                                                                                if($out3_b == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',2);
                                                                                }
                                                                            // 条件（通販区分がヤフー）
                                                                                if($out3_c == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',3);
                                                                                }
                                                                            // 条件（通販区分が電話・雑誌）
                                                                                if($out3_d == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',5);
                                                                                }
                                                                            // 条件（通販区分がYオークション）
                                                                                if($out3_e == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',4);
                                                                                }
                                                                            // 条件（通販区分が修理品返送）
                                                                                if($out3_f == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',9);
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（免税）
                                                                    ->where("menzei","like","%対象外%")
                                                                        
                                                                // 条件（扱い部門）
                                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                            $query->orWhere('bumonmei','');

                                                                            // 条件（扱い部門がジャック）
                                                                                if($out5_a == "ON"){
                                                                                    $query->orWhere('bumonmei','Jackroad');
                                                                                }
                                                                            // 条件（扱い部門がベティー）
                                                                                if($out5_b == "ON"){
                                                                                    $query->orWhere('bumonmei','BettyRoad');
                                                                                }
                                                                            // 条件（扱い部門がジュエリー）
                                                                                if($out5_c == "ON"){
                                                                                    $query->orWhere('bumonmei','Jewelry');
                                                                                }
                                                                
                                                                    })
                                                                // ソート順指定
                                                                    ->orderBy('uriage', 'asc')
                                                                    ->get();
                                                                // クエリビルダスタート
                                                                    // 変数リセット
                                                                        $shop_sum_uriage_progress = "";
                                                                        $i2 = 0;
                                                                        foreach ($shop_progress as $shop_buy_progress) {
                                                                            // 各月店舗・通販(免税)売上
                                                                            $shop_sum_uriage_progress = $shop_buy_progress -> shop_uriage;
                                                                            $shop_sum_number_progress = $shop_buy_progress -> shop_number;
                                                                            $shop_sum_arari_progress  = $shop_buy_progress -> shop_arari;
                                                                            $i2++;
                                                                        }

                                                            // DB検索（店舗(免税外)値）スタート
                                                                $web_progress = DB::table($table_name) 
                                                                // 月毎にグループ化して値を分けるための処理
                                                                    ->select([
                                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS web_month'),
                                                                        \DB::raw("SUM(uriagekingaku) AS web_uriage"),
                                                                        \DB::raw("SUM(uriagesuu) AS web_number"),
                                                                        \DB::raw("SUM(ararikingaku) AS web_arari"),
                                                                ])
                                                                    // 条件（売上部門がWEB）
                                                                        ->where('baikyakukubun',2)
                                                                    // 条件（期間の指定）
                                                                        ->whereBetween($table_name
                                                                        
                                                                        . '.uriage', [$last_day_top, $last_day])
                                                                        
                                                                    // 条件（分類名）
                                                                        ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                            // 条件（商品区分分類名が新品）
                                                                                if($out2_a == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                }
                                                                            // 条件（商品区分分類名が中古）
                                                                                if($out2_b == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                }
                                                                            // 条件（商品区分分類名がアンティーク）
                                                                                if($out2_c == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                }
                                                                            // 条件（商品区分分類名がその他）
                                                                                if($out2_d == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                }
                                                                            // 条件（商品区分分類名が修理）
                                                                                if($out2_e == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（通販区分）
                                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                                            $query->orWhere('tsuuhankubun','');

                                                                            // 条件（通販区分が自社）
                                                                                if($out3_a == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',1);
                                                                                }
                                                                            // 条件（通販区分が楽天）
                                                                                if($out3_b == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',2);
                                                                                }
                                                                            // 条件（通販区分がヤフー）
                                                                                if($out3_c == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',3);
                                                                                }
                                                                            // 条件（通販区分が電話・雑誌）
                                                                                if($out3_d == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',5);
                                                                                }
                                                                            // 条件（通販区分がYオークション）
                                                                                if($out3_e == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',4);
                                                                                }
                                                                            // 条件（通販区分が修理品返送）
                                                                                if($out3_f == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',9);
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（免税）
                                                                    ->where("menzei","like","%対象外%")
                                                                    
                                                                // 条件（扱い部門）
                                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                            $query->orWhere('bumonmei','');

                                                                            // 条件（扱い部門がジャック）
                                                                                if($out5_a == "ON"){
                                                                                    $query->orWhere('bumonmei','Jackroad');
                                                                                }
                                                                            // 条件（扱い部門がベティー）
                                                                                if($out5_b == "ON"){
                                                                                    $query->orWhere('bumonmei','BettyRoad');
                                                                                }
                                                                            // 条件（扱い部門がジュエリー）
                                                                                if($out5_c == "ON"){
                                                                                    $query->orWhere('bumonmei','Jewelry');
                                                                                }
                                                                
                                                                    })
                                                                // ソート順指定
                                                                    ->orderBy('uriage', 'asc')
                                                                    ->get();
                                                                // クエリビルダスタート
                                                                    // 変数リセット
                                                                        $web_sum_uriage_progress = "";
                                                                        $i2 = 0;
                                                                        foreach ($web_progress as $web_buy_progress) {
                                                                            // 各月店舗・通販(免税)売上
                                                                            $web_sum_uriage_progress = $web_buy_progress -> web_uriage;
                                                                            $web_sum_number_progress = $web_buy_progress -> web_number;
                                                                            $web_sum_arari_progress  = $web_buy_progress -> web_arari;
                                                                            $i2++;
                                                                        }




                                            // DB検索（店舗・通販(免税)値）スタート
                                                $oroshi_sum_uriage_progress = "";
                                                $oroshi_sum_number_progress = "";
                                                $oroshi_sum_arari_progress = "";
                                                
                                                if($out1_c == "ON"){
                                                        $oroshi_progress = DB::table($table_name) 
                                                        // 月毎にグループ化して値を分けるための処理
                                                            ->select([
                                                                \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS oroshi_month'),
                                                                \DB::raw("SUM(uriagekingaku) AS oroshi_uriage"),
                                                                \DB::raw("SUM(uriagesuu) AS oroshi_number"),
                                                                \DB::raw("SUM(ararikingaku) AS oroshi_arari"),
                                                        ])
                                                        // 条件（売上部門が店舗・通販(免税)）
                                                                /*->where(function ($query) use ($out1_d) {
                                                                        if($out1_d == "ON"){
                                                                            // 「店舗・通販(免税)」と空白（おそらく入力間違い分）を含む場合を取得（条件：「店舗」「通販」以外）
                                                                                $query->Where([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2]]);
                                                                        } else {
                                                                            // 「店舗・通販(免税)」のみを取得
                                                                                $query->where('baikyakukubun',3);
                                                                        }
                                                                })*/
                                                                // 店舗と通販を取得
                                                                // 「baikyakukubun」が「1」or「2」の場合
                                                                ->where(function ($query){
                                                                    $query->orwhere('baikyakukubun', 1)->orwhere('baikyakukubun', 2);
                                                                })
                                                                
                                                                
                                                                
                                                                
                                            
                                                                //->orwhere("baikyakukubun",1)
                                                                //->orwhere("baikyakukubun",2)
                                                        // 条件（期間の指定）
                                                            ->whereBetween($table_name . '.uriage', [$last_day_top, $last_day])
                                                                
                                                            // 条件（分類名）
                                                                ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                    // 条件（商品区分分類名が新品）
                                                                        if($out2_a == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                        }
                                                                    // 条件（商品区分分類名が中古）
                                                                        if($out2_b == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                        }
                                                                    // 条件（商品区分分類名がアンティーク）
                                                                        if($out2_c == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                        }
                                                                    // 条件（商品区分分類名がその他）
                                                                        if($out2_d == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                        }
                                                                    // 条件（商品区分分類名が修理）
                                                                        if($out2_e == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                        }
                                                            
                                                            })
                                                        // 条件（通販区分）
                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                
                                                                    $query->orWhere('tsuuhankubun','');
                                                
                                                                    // 条件（通販区分が自社）
                                                                        if($out3_a == "ON"){
                                                                            $query->orWhere('tsuuhankubun',1);
                                                                        }
                                                                    // 条件（通販区分が楽天）
                                                                        if($out3_b == "ON"){
                                                                            $query->orWhere('tsuuhankubun',2);
                                                                        }
                                                                    // 条件（通販区分がヤフー）
                                                                        if($out3_c == "ON"){
                                                                            $query->orWhere('tsuuhankubun',3);
                                                                        }
                                                                    // 条件（通販区分が電話・雑誌）
                                                                        if($out3_d == "ON"){
                                                                            $query->orWhere('tsuuhankubun',5);
                                                                        }
                                                                    // 条件（通販区分がYオークション）
                                                                        if($out3_e == "ON"){
                                                                            $query->orWhere('tsuuhankubun',4);
                                                                        }
                                                                    // 条件（通販区分が修理品返送）
                                                                        if($out3_f == "ON"){
                                                                            $query->orWhere('tsuuhankubun',9);
                                                                        }
                                                            
                                                            })
                                                        // 条件（免税）
                                                            ->where("menzei","like","%免税%")
                                                    
                                                        // 条件（扱い部門）
                                                            ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {
                                                
                                                                    $query->orWhere('bumonmei','');
                                                
                                                                    // 条件（扱い部門がジャック）
                                                                        if($out5_a == "ON"){
                                                                            $query->orWhere('bumonmei','Jackroad');
                                                                        }
                                                                    // 条件（扱い部門がベティー）
                                                                        if($out5_b == "ON"){
                                                                            $query->orWhere('bumonmei','BettyRoad');
                                                                        }
                                                                    // 条件（扱い部門がジュエリー）
                                                                        if($out5_c == "ON"){
                                                                            $query->orWhere('bumonmei','Jewelry');
                                                                        }
                                                        
                                                            })
                                                        // ソート順指定
                                                            ->orderBy('uriage', 'asc')
                                                            ->get();
                                                        // クエリビルダスタート
                                                            // 変数リセット
                                                                $oroshi_sum_uriage_progress = "";
                                                                $i2 = 0;
                                                                foreach ($oroshi_progress as $oroshi_buy_progress) {
                                                                    // 各月店舗・通販(免税)売上
                                                                    $oroshi_sum_uriage_progress = $oroshi_buy_progress -> oroshi_uriage;
                                                                    $oroshi_sum_number_progress = $oroshi_buy_progress -> oroshi_number;
                                                                    $oroshi_sum_arari_progress  = $oroshi_buy_progress -> oroshi_arari;
                                                                    $i2++;
                                                                }
                                            }


                                        /************************************************************************************************************************************************************************************************************* */
                                            // 最終データ格納月のデータ取得　end
                                        /************************************************************************************************************************************************************************************************************* */
                                                    
                                        
                                        /************************************************************************************************************************************************************************************************************* */
                                            // 先月のデータ取得（最終データ格納年月比) start
                                        /************************************************************************************************************************************************************************************************************* */
                                        
                                                            // DB検索（店舗(免税外)値）スタート
                                                                $shop_progress2 = DB::table($table_name) 
                                                                // 月毎にグループ化して値を分けるための処理
                                                                    ->select([
                                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS shop_month2'),
                                                                        \DB::raw("SUM(uriagekingaku) AS shop_uriage2"),
                                                                        \DB::raw("SUM(uriagesuu) AS shop_number2"),
                                                                        \DB::raw("SUM(ararikingaku) AS shop_arari2"),
                                                                    ])
                                                                    // 条件（売上部門が店舗）
                                                                        ->where('baikyakukubun',1)
                                                                    // 条件（期間の指定）
                                                                        ->whereBetween($table_name . '.uriage', [$last_month_top, $last_month])
                                                                        
                                                                    // 条件（分類名）
                                                                        ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                            // 条件（商品区分分類名が新品）
                                                                                if($out2_a == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                }
                                                                            // 条件（商品区分分類名が中古）
                                                                                if($out2_b == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                }
                                                                            // 条件（商品区分分類名がアンティーク）
                                                                                if($out2_c == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                }
                                                                            // 条件（商品区分分類名がその他）
                                                                                if($out2_d == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                }
                                                                            // 条件（商品区分分類名が修理）
                                                                                if($out2_e == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（通販区分）
                                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                                            $query->orWhere('tsuuhankubun','');

                                                                            // 条件（通販区分が自社）
                                                                                if($out3_a == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',1);
                                                                                }
                                                                            // 条件（通販区分が楽天）
                                                                                if($out3_b == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',2);
                                                                                }
                                                                            // 条件（通販区分がヤフー）
                                                                                if($out3_c == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',3);
                                                                                }
                                                                            // 条件（通販区分が電話・雑誌）
                                                                                if($out3_d == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',5);
                                                                                }
                                                                            // 条件（通販区分がYオークション）
                                                                                if($out3_e == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',4);
                                                                                }
                                                                            // 条件（通販区分が修理品返送）
                                                                                if($out3_f == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',9);
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（免税）
                                                                    ->where("menzei","like","%対象外%")
                                                                    
                                                                // 条件（扱い部門）
                                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                            $query->orWhere('bumonmei','');

                                                                            // 条件（扱い部門がジャック）
                                                                                if($out5_a == "ON"){
                                                                                    $query->orWhere('bumonmei','Jackroad');
                                                                                }
                                                                            // 条件（扱い部門がベティー）
                                                                                if($out5_b == "ON"){
                                                                                    $query->orWhere('bumonmei','BettyRoad');
                                                                                }
                                                                            // 条件（扱い部門がジュエリー）
                                                                                if($out5_c == "ON"){
                                                                                    $query->orWhere('bumonmei','Jewelry');
                                                                                }
                                                                
                                                                    })
                                                                // ソート順指定
                                                                    ->orderBy('uriage', 'asc')
                                                                    ->get();
                                                                // クエリビルダスタート
                                                                    // 変数リセット
                                                                        $shop_sum_uriage_progress2 = "";
                                                                        $i2 = 0;
                                                                        foreach ($shop_progress2 as $shop_buy_progress2) {
                                                                            // 各月店舗・通販(免税)売上
                                                                            $shop_sum_uriage_progress2 = $shop_buy_progress2 -> shop_uriage2;
                                                                            $shop_sum_number_progress2 = $shop_buy_progress2 -> shop_number2;
                                                                            $shop_sum_arari_progress2  = $shop_buy_progress2 -> shop_arari2;
                                                                            $i2++;
                                                                        }

                                                            // DB検索（店舗(免税外)値）スタート
                                                                $web_progress2 = DB::table($table_name) 
                                                                // 月毎にグループ化して値を分けるための処理
                                                                    ->select([
                                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS web_month2'),
                                                                        \DB::raw("SUM(uriagekingaku) AS web_uriage2"),
                                                                        \DB::raw("SUM(uriagesuu) AS web_number2"),
                                                                        \DB::raw("SUM(ararikingaku) AS web_arari2"),
                                                                ])
                                                                    // 条件（売上部門がWEB）
                                                                        ->where('baikyakukubun',2)
                                                                    // 条件（期間の指定）
                                                                        ->whereBetween($table_name . '.uriage', [$last_month_top, $last_month])
                                                                        
                                                                    // 条件（分類名）
                                                                        ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                            // 条件（商品区分分類名が新品）
                                                                                if($out2_a == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                }
                                                                            // 条件（商品区分分類名が中古）
                                                                                if($out2_b == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                }
                                                                            // 条件（商品区分分類名がアンティーク）
                                                                                if($out2_c == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                }
                                                                            // 条件（商品区分分類名がその他）
                                                                                if($out2_d == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                }
                                                                            // 条件（商品区分分類名が修理）
                                                                                if($out2_e == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（通販区分）
                                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                                            $query->orWhere('tsuuhankubun','');

                                                                            // 条件（通販区分が自社）
                                                                                if($out3_a == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',1);
                                                                                }
                                                                            // 条件（通販区分が楽天）
                                                                                if($out3_b == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',2);
                                                                                }
                                                                            // 条件（通販区分がヤフー）
                                                                                if($out3_c == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',3);
                                                                                }
                                                                            // 条件（通販区分が電話・雑誌）
                                                                                if($out3_d == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',5);
                                                                                }
                                                                            // 条件（通販区分がYオークション）
                                                                                if($out3_e == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',4);
                                                                                }
                                                                            // 条件（通販区分が修理品返送）
                                                                                if($out3_f == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',9);
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（免税）
                                                                    ->where("menzei","like","%対象外%")
                                                                    
                                                                // 条件（扱い部門）
                                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                            $query->orWhere('bumonmei','');

                                                                            // 条件（扱い部門がジャック）
                                                                                if($out5_a == "ON"){
                                                                                    $query->orWhere('bumonmei','Jackroad');
                                                                                }
                                                                            // 条件（扱い部門がベティー）
                                                                                if($out5_b == "ON"){
                                                                                    $query->orWhere('bumonmei','BettyRoad');
                                                                                }
                                                                            // 条件（扱い部門がジュエリー）
                                                                                if($out5_c == "ON"){
                                                                                    $query->orWhere('bumonmei','Jewelry');
                                                                                }
                                                                
                                                                    })
                                                                // ソート順指定
                                                                    ->orderBy('uriage', 'asc')
                                                                    ->get();
                                                                // クエリビルダスタート
                                                                    // 変数リセット
                                                                        $web_sum_uriage_progress2 = "";
                                                                        $i2 = 0;
                                                                        foreach ($web_progress2 as $web_buy_progress2) {
                                                                            // 各月店舗・通販(免税)売上
                                                                            $web_sum_uriage_progress2 = $web_buy_progress2 -> web_uriage2;
                                                                            $web_sum_number_progress2 = $web_buy_progress2 -> web_number2;
                                                                            $web_sum_arari_progress2  = $web_buy_progress2 -> web_arari2;
                                                                            $i2++;
                                                                        }




                                            // DB検索（店舗・通販(免税)値）スタート
                                            $oroshi_sum_uriage_progress2 = "";
                                            $oroshi_sum_number_progress2 = "";
                                            $oroshi_sum_arari_progress2 = "";
                                            if($out1_c == "ON"){                                                                
                                                    $oroshi_progress2 = DB::table($table_name) 
                                                    // 月毎にグループ化して値を分けるための処理
                                                        ->select([
                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS oroshi_month2'),
                                                            \DB::raw("SUM(uriagekingaku) AS oroshi_uriage2"),
                                                            \DB::raw("SUM(uriagesuu) AS oroshi_number2"),
                                                            \DB::raw("SUM(ararikingaku) AS oroshi_arari2"),
                                                    ])
                                                    // 条件（売上部門が店舗・通販(免税)）
                                                            /*->where(function ($query) use ($out1_d) {
                                                                    if($out1_d == "ON"){
                                                                        // 「店舗・通販(免税)」と空白（おそらく入力間違い分）を含む場合を取得（条件：「店舗」「通販」以外）
                                                                            $query->Where([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2]]);
                                                                    } else {
                                                                        // 「店舗・通販(免税)」のみを取得
                                                                            $query->where('baikyakukubun',3);
                                                                    }
                                                            })*/
                                                                // 店舗と通販を取得
                                                                // 「baikyakukubun」が「1」or「2」の場合
                                                                ->where(function ($query){
                                                                    $query->orwhere('baikyakukubun', 1)->orwhere('baikyakukubun', 2);
                                                                })
                                                            
                                                    // 条件（期間の指定）
                                                        ->whereBetween($table_name . '.uriage', [$last_month_top, $last_month])
                                                            
                                                        // 条件（分類名）
                                                            ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                // 条件（商品区分分類名が新品）
                                                                    if($out2_a == "ON"){
                                                                        $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                    }
                                                                // 条件（商品区分分類名が中古）
                                                                    if($out2_b == "ON"){
                                                                        $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                    }
                                                                // 条件（商品区分分類名がアンティーク）
                                                                    if($out2_c == "ON"){
                                                                        $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                    }
                                                                // 条件（商品区分分類名がその他）
                                                                    if($out2_d == "ON"){
                                                                        $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                    }
                                                                // 条件（商品区分分類名が修理）
                                                                    if($out2_e == "ON"){
                                                                        $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                    }
                                                        
                                                        })
                                                    // 条件（通販区分）
                                                        ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                            
                                                                $query->orWhere('tsuuhankubun','');
                                            
                                                                // 条件（通販区分が自社）
                                                                    if($out3_a == "ON"){
                                                                        $query->orWhere('tsuuhankubun',1);
                                                                    }
                                                                // 条件（通販区分が楽天）
                                                                    if($out3_b == "ON"){
                                                                        $query->orWhere('tsuuhankubun',2);
                                                                    }
                                                                // 条件（通販区分がヤフー）
                                                                    if($out3_c == "ON"){
                                                                        $query->orWhere('tsuuhankubun',3);
                                                                    }
                                                                // 条件（通販区分が電話・雑誌）
                                                                    if($out3_d == "ON"){
                                                                        $query->orWhere('tsuuhankubun',5);
                                                                    }
                                                                // 条件（通販区分がYオークション）
                                                                    if($out3_e == "ON"){
                                                                        $query->orWhere('tsuuhankubun',4);
                                                                    }
                                                                // 条件（通販区分が修理品返送）
                                                                    if($out3_f == "ON"){
                                                                        $query->orWhere('tsuuhankubun',9);
                                                                    }
                                                        
                                                        })
                                                    // 条件（免税）
                                                            ->where("menzei","like","%免税%")
                                                
                                                    // 条件（扱い部門）
                                                        ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {
                                            
                                                                $query->orWhere('bumonmei','');
                                            
                                                                // 条件（扱い部門がジャック）
                                                                    if($out5_a == "ON"){
                                                                        $query->orWhere('bumonmei','Jackroad');
                                                                    }
                                                                // 条件（扱い部門がベティー）
                                                                    if($out5_b == "ON"){
                                                                        $query->orWhere('bumonmei','BettyRoad');
                                                                    }
                                                                // 条件（扱い部門がジュエリー）
                                                                    if($out5_c == "ON"){
                                                                        $query->orWhere('bumonmei','Jewelry');
                                                                    }
                                                    
                                                        })
                                                    // ソート順指定
                                                        ->orderBy('uriage', 'asc')
                                                        ->get();
                                                    // クエリビルダスタート
                                                        // 変数リセット
                                                            $oroshi_sum_uriage_progress2 = "";
                                                            $i2 = 0;
                                                            foreach ($oroshi_progress2 as $oroshi_buy_progress2) {
                                                                // 各月店舗・通販(免税)売上
                                                                $oroshi_sum_uriage_progress2 = $oroshi_buy_progress2 -> oroshi_uriage2;
                                                                $oroshi_sum_number_progress2 = $oroshi_buy_progress2 -> oroshi_number2;
                                                                $oroshi_sum_arari_progress2  = $oroshi_buy_progress2 -> oroshi_arari2;
                                                                $i2++;
                                                            }
                                            }
                                        
                                        
                                        /************************************************************************************************************************************************************************************************************* */
                                            // 先月のデータ取得（最終データ格納年月比) 　end
                                        /************************************************************************************************************************************************************************************************************* */
                                        



                                        /************************************************************************************************************************************************************************************************************* */
                                            // 検索期間の月数だけ遡った年月のデータ取得（最終データ格納年月比) start
                                        /************************************************************************************************************************************************************************************************************* */
                                        
                                                            // DB検索（店舗(免税外)値）スタート
                                                                $shop_progress3 = DB::table($table_name) 
                                                                // 月毎にグループ化して値を分けるための処理
                                                                    ->select([
                                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS shop_month3'),
                                                                        \DB::raw("SUM(uriagekingaku) AS shop_uriage3"),
                                                                        \DB::raw("SUM(uriagesuu) AS shop_number3"),
                                                                        \DB::raw("SUM(ararikingaku) AS shop_arari3"),
                                                                    ])
                                                                    // 条件（売上部門が店舗）
                                                                        ->where('baikyakukubun',1)
                                                                    // 条件（期間の指定）
                                                                        ->whereBetween($table_name . '.uriage', [$past_between_start_progress, $past_between_end_progress])
                                                                        
                                                                    // 条件（分類名）
                                                                        ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                            // 条件（商品区分分類名が新品）
                                                                                if($out2_a == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                }
                                                                            // 条件（商品区分分類名が中古）
                                                                                if($out2_b == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                }
                                                                            // 条件（商品区分分類名がアンティーク）
                                                                                if($out2_c == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                }
                                                                            // 条件（商品区分分類名がその他）
                                                                                if($out2_d == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                }
                                                                            // 条件（商品区分分類名が修理）
                                                                                if($out2_e == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（通販区分）
                                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                                            $query->orWhere('tsuuhankubun','');

                                                                            // 条件（通販区分が自社）
                                                                                if($out3_a == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',1);
                                                                                }
                                                                            // 条件（通販区分が楽天）
                                                                                if($out3_b == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',2);
                                                                                }
                                                                            // 条件（通販区分がヤフー）
                                                                                if($out3_c == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',3);
                                                                                }
                                                                            // 条件（通販区分が電話・雑誌）
                                                                                if($out3_d == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',5);
                                                                                }
                                                                            // 条件（通販区分がYオークション）
                                                                                if($out3_e == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',4);
                                                                                }
                                                                            // 条件（通販区分が修理品返送）
                                                                                if($out3_f == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',9);
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（免税）
                                                                    ->where("menzei","like","%対象外%")
                                                                    
                                                                // 条件（扱い部門）
                                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                            $query->orWhere('bumonmei','');

                                                                            // 条件（扱い部門がジャック）
                                                                                if($out5_a == "ON"){
                                                                                    $query->orWhere('bumonmei','Jackroad');
                                                                                }
                                                                            // 条件（扱い部門がベティー）
                                                                                if($out5_b == "ON"){
                                                                                    $query->orWhere('bumonmei','BettyRoad');
                                                                                }
                                                                            // 条件（扱い部門がジュエリー）
                                                                                if($out5_c == "ON"){
                                                                                    $query->orWhere('bumonmei','Jewelry');
                                                                                }
                                                                
                                                                    })
                                                                // ソート順指定
                                                                    ->orderBy('uriage', 'asc')
                                                                    ->get();
                                                                // クエリビルダスタート
                                                                    // 変数リセット
                                                                        $shop_sum_uriage_progress3 = "";
                                                                        $i2 = 0;
                                                                        foreach ($shop_progress3 as $shop_buy_progress3) {
                                                                            // 各月店舗・通販(免税)売上
                                                                            $shop_sum_uriage_progress3 = $shop_buy_progress3 -> shop_uriage3;
                                                                            $shop_sum_number_progress3 = $shop_buy_progress3 -> shop_number3;
                                                                            $shop_sum_arari_progress3  = $shop_buy_progress3 -> shop_arari3;
                                                                            $i2++;
                                                                        }

                                                            // DB検索（店舗(免税外)値）スタート
                                                                $web_progress3 = DB::table($table_name) 
                                                                // 月毎にグループ化して値を分けるための処理
                                                                    ->select([
                                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS web_month3'),
                                                                        \DB::raw("SUM(uriagekingaku) AS web_uriage3"),
                                                                        \DB::raw("SUM(uriagesuu) AS web_number3"),
                                                                        \DB::raw("SUM(ararikingaku) AS web_arari3"),
                                                                ])
                                                                    // 条件（売上部門がWEB）
                                                                        ->where('baikyakukubun',2)
                                                                    // 条件（期間の指定）
                                                                        ->whereBetween($table_name . '.uriage', [$past_between_start_progress, $past_between_end_progress])
                                                                        
                                                                    // 条件（分類名）
                                                                        ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                            // 条件（商品区分分類名が新品）
                                                                                if($out2_a == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                                }
                                                                            // 条件（商品区分分類名が中古）
                                                                                if($out2_b == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                                }
                                                                            // 条件（商品区分分類名がアンティーク）
                                                                                if($out2_c == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                                }
                                                                            // 条件（商品区分分類名がその他）
                                                                                if($out2_d == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                                }
                                                                            // 条件（商品区分分類名が修理）
                                                                                if($out2_e == "ON"){
                                                                                    $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（通販区分）
                                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                                            $query->orWhere('tsuuhankubun','');

                                                                            // 条件（通販区分が自社）
                                                                                if($out3_a == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',1);
                                                                                }
                                                                            // 条件（通販区分が楽天）
                                                                                if($out3_b == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',2);
                                                                                }
                                                                            // 条件（通販区分がヤフー）
                                                                                if($out3_c == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',3);
                                                                                }
                                                                            // 条件（通販区分が電話・雑誌）
                                                                                if($out3_d == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',5);
                                                                                }
                                                                            // 条件（通販区分がYオークション）
                                                                                if($out3_e == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',4);
                                                                                }
                                                                            // 条件（通販区分が修理品返送）
                                                                                if($out3_f == "ON"){
                                                                                    $query->orWhere('tsuuhankubun',9);
                                                                                }
                                                                    
                                                                    })
                                                                // 条件（免税）
                                                                    ->where("menzei","like","%対象外%")
                                                                    
                                                                // 条件（扱い部門）
                                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                                            $query->orWhere('bumonmei','');

                                                                            // 条件（扱い部門がジャック）
                                                                                if($out5_a == "ON"){
                                                                                    $query->orWhere('bumonmei','Jackroad');
                                                                                }
                                                                            // 条件（扱い部門がベティー）
                                                                                if($out5_b == "ON"){
                                                                                    $query->orWhere('bumonmei','BettyRoad');
                                                                                }
                                                                            // 条件（扱い部門がジュエリー）
                                                                                if($out5_c == "ON"){
                                                                                    $query->orWhere('bumonmei','Jewelry');
                                                                                }
                                                                
                                                                    })
                                                                // ソート順指定
                                                                    ->orderBy('uriage', 'asc')
                                                                    ->get();
                                                                // クエリビルダスタート
                                                                    // 変数リセット
                                                                        $web_sum_uriage_progress3 = "";
                                                                        $i2 = 0;
                                                                        foreach ($web_progress3 as $web_buy_progress3) {
                                                                            // 各月店舗・通販(免税)売上
                                                                            $web_sum_uriage_progress3 = $web_buy_progress3 -> web_uriage3;
                                                                            $web_sum_number_progress3 = $web_buy_progress3 -> web_number3;
                                                                            $web_sum_arari_progress3  = $web_buy_progress3 -> web_arari3;
                                                                            $i2++;
                                                                        }




                                                // DB検索（店舗・通販(免税)値）スタート
                                                $oroshi_sum_uriage_progress3 = "";
                                                $oroshi_sum_number_progress3 = "";
                                                $oroshi_sum_arari_progress3 = "";
                                                if($out1_c == "ON"){                                                                
                                                        $oroshi_progress3 = DB::table($table_name) 
                                                        // 月毎にグループ化して値を分けるための処理
                                                            ->select([
                                                                \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS oroshi_month3'),
                                                                \DB::raw("SUM(uriagekingaku) AS oroshi_uriage3"),
                                                                \DB::raw("SUM(uriagesuu) AS oroshi_number3"),
                                                                \DB::raw("SUM(ararikingaku) AS oroshi_arari3"),
                                                        ])
                                                        // 条件（売上部門が店舗・通販(免税)）
                                                                /*->where(function ($query) use ($out1_d) {
                                                                        if($out1_d == "ON"){
                                                                            // 「店舗・通販(免税)」と空白（おそらく入力間違い分）を含む場合を取得（条件：「店舗」「通販」以外）
                                                                                $query->Where([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2]]);
                                                                        } else {
                                                                            // 「店舗・通販(免税)」のみを取得
                                                                                $query->where('baikyakukubun',3);
                                                                        }
                                                                })*/
                                                                    // 店舗と通販を取得
                                                                    // 「baikyakukubun」が「1」or「2」の場合
                                                                    ->where(function ($query){
                                                                        $query->orwhere('baikyakukubun', 1)->orwhere('baikyakukubun', 2);
                                                                    })
                                                                
                                                                
                                                        // 条件（期間の指定）
                                                            ->whereBetween($table_name . '.uriage', [$past_between_start_progress, $past_between_end_progress])
                                                                
                                                            // 条件（分類名）
                                                                ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                                    // 条件（商品区分分類名が新品）
                                                                        if($out2_a == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                                        }
                                                                    // 条件（商品区分分類名が中古）
                                                                        if($out2_b == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                                        }
                                                                    // 条件（商品区分分類名がアンティーク）
                                                                        if($out2_c == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                                        }
                                                                    // 条件（商品区分分類名がその他）
                                                                        if($out2_d == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                                        }
                                                                    // 条件（商品区分分類名が修理）
                                                                        if($out2_e == "ON"){
                                                                            $query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                                        }
                                                            
                                                            })
                                                        // 条件（通販区分）
                                                            ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                
                                                                    $query->orWhere('tsuuhankubun','');
                                                
                                                                    // 条件（通販区分が自社）
                                                                        if($out3_a == "ON"){
                                                                            $query->orWhere('tsuuhankubun',1);
                                                                        }
                                                                    // 条件（通販区分が楽天）
                                                                        if($out3_b == "ON"){
                                                                            $query->orWhere('tsuuhankubun',2);
                                                                        }
                                                                    // 条件（通販区分がヤフー）
                                                                        if($out3_c == "ON"){
                                                                            $query->orWhere('tsuuhankubun',3);
                                                                        }
                                                                    // 条件（通販区分が電話・雑誌）
                                                                        if($out3_d == "ON"){
                                                                            $query->orWhere('tsuuhankubun',5);
                                                                        }
                                                                    // 条件（通販区分がYオークション）
                                                                        if($out3_e == "ON"){
                                                                            $query->orWhere('tsuuhankubun',4);
                                                                        }
                                                                    // 条件（通販区分が修理品返送）
                                                                        if($out3_f == "ON"){
                                                                            $query->orWhere('tsuuhankubun',9);
                                                                        }
                                                            
                                                            })
                                                        // 条件（免税）
                                                                ->where("menzei","like","%免税%")
                                                    
                                                        // 条件（扱い部門）
                                                            ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {
                                                
                                                                    $query->orWhere('bumonmei','');
                                                
                                                                    // 条件（扱い部門がジャック）
                                                                        if($out5_a == "ON"){
                                                                            $query->orWhere('bumonmei','Jackroad');
                                                                        }
                                                                    // 条件（扱い部門がベティー）
                                                                        if($out5_b == "ON"){
                                                                            $query->orWhere('bumonmei','BettyRoad');
                                                                        }
                                                                    // 条件（扱い部門がジュエリー）
                                                                        if($out5_c == "ON"){
                                                                            $query->orWhere('bumonmei','Jewelry');
                                                                        }
                                                        
                                                            })
                                                        // ソート順指定
                                                            ->orderBy('uriage', 'asc')
                                                            ->get();
                                                        // クエリビルダスタート
                                                            // 変数リセット
                                                                $oroshi_sum_uriage_progress3 = "";
                                                                $i2 = 0;
                                                                foreach ($oroshi_progress3 as $oroshi_buy_progress3) {
                                                                    // 各月店舗・通販(免税)売上
                                                                    $oroshi_sum_uriage_progress3 = $oroshi_buy_progress3 -> oroshi_uriage3;
                                                                    $oroshi_sum_number_progress3 = $oroshi_buy_progress3 -> oroshi_number3;
                                                                    $oroshi_sum_arari_progress3  = $oroshi_buy_progress3 -> oroshi_arari3;
                                                                    $i2++;
                                                                }
                                                
                                                }
                                      
                                        
                                        
                                        /************************************************************************************************************************************************************************************************************* */
                                            // 検索期間の月数だけ遡った年月のデータ取得（最終データ格納年月比) 　end
                                        /************************************************************************************************************************************************************************************************************* */
                                        

                                        /************************************************************************************************************************************************************************************************************* */
                                            // 各月間予測値と過去比を取得 start
                                        /************************************************************************************************************************************************************************************************************* */

                                                // 予測値
                                                        // 店舗(免税外)・月間売上額予測
                                                            if($shop_sum_uriage_progress <> "" && $shop_sum_uriage_progress <> 0){
                                                                $shop_sum_uriage_progress_pre = (float)((int)$shop_sum_uriage_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                            } else {
                                                                $shop_sum_uriage_progress_pre = "";
                                                            }
                                                        // 店舗(免税外)・月間売上点数予測
                                                            if($shop_sum_number_progress <> "" && $shop_sum_number_progress <> 0){
                                                                $shop_sum_number_progress_pre = (float)((int)$shop_sum_number_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                            } else {
                                                                $shop_sum_number_progress_pre = "";
                                                            }
                                                        // 店舗(免税外)・月間売上粗利予測
                                                            if($shop_sum_arari_progress <> "" && $shop_sum_arari_progress <> 0){
                                                                $shop_sum_arari_progress_pre = (float)((int)$shop_sum_arari_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                            } else {
                                                                $shop_sum_arari_progress_pre = "";
                                                            }


                                                        // WEB・月間売上額予測
                                                            if($web_sum_uriage_progress <> "" && $web_sum_uriage_progress <> 0){
                                                                $web_sum_uriage_progress_pre = (float)((int)$web_sum_uriage_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                            } else {
                                                                $web_sum_uriage_progress_pre = "";
                                                            }
                                                        // WEB・月間売上点数予測
                                                            if($web_sum_number_progress <> "" && $web_sum_number_progress <> 0){
                                                                $web_sum_number_progress_pre = (float)((int)$web_sum_number_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                            } else {
                                                                $web_sum_number_progress_pre = "";
                                                            }
                                                        // WEB・月間売上粗利予測
                                                            if($web_sum_arari_progress <> "" && $web_sum_arari_progress <> 0){
                                                                $web_sum_arari_progress_pre = (float)((int)$web_sum_arari_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                            } else {
                                                                $web_sum_arari_progress_pre = "";
                                                            }
                                                            
                                                            
                                                            
                                                $oroshi_sum_uriage_progress_pre = "";
                                                $oroshi_sum_number_progress_pre = "";
                                                $oroshi_sum_arari_progress_pre = "";
                                                if($out1_c == "ON"){ 
                                                    // 店舗・通販(免税)・月間売上額予測
                                                        if($oroshi_sum_uriage_progress <> "" && $oroshi_sum_uriage_progress <> 0){
                                                            $oroshi_sum_uriage_progress_pre = (float)((int)$oroshi_sum_uriage_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                        } else {
                                                            $oroshi_sum_uriage_progress_pre = "";
                                                        }
                                                    // 店舗・通販(免税)・月間売上点数予測
                                                        if($oroshi_sum_number_progress <> "" && $oroshi_sum_number_progress <> 0){
                                                            $oroshi_sum_number_progress_pre = (float)((int)$oroshi_sum_number_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                        } else {
                                                            $oroshi_sum_number_progress_pre = "";
                                                        }
                                                    // 店舗・通販(免税)・月間売上粗利予測
                                                        if($oroshi_sum_arari_progress <> "" && $oroshi_sum_arari_progress <> 0){
                                                            $oroshi_sum_arari_progress_pre = (float)((int)$oroshi_sum_arari_progress / (int)$last_day_last) * (int)$last_day_last2;
                                                        } else {
                                                            $oroshi_sum_arari_progress_pre = "";
                                                        }
                                                }

                                                    
                                                // 先月比
                                                        // 店舗(免税外)・売上額予測・先月比
                                                            if($shop_sum_uriage_progress_pre <> "" && $shop_sum_uriage_progress_pre <> 0 && $shop_sum_uriage_progress2 <> "" && $shop_sum_uriage_progress2 <> 0){
                                                                $shop_sum_uriage_progress_pre2 = (floor(((float)$shop_sum_uriage_progress_pre / (float)$shop_sum_uriage_progress2) * 100 * 10)) / 10;
                                                            } else {
                                                                $shop_sum_uriage_progress_pre2 = "---";
                                                            }

                                                        // 店舗(免税外)・売上点数予測・先月比
                                                            if($shop_sum_number_progress_pre <> "" && $shop_sum_number_progress_pre <> 0 && $shop_sum_number_progress2 <> "" && $shop_sum_number_progress2 <> 0){
                                                                $shop_sum_number_progress_pre2 = (floor(((float)$shop_sum_number_progress_pre / (float)$shop_sum_number_progress2) * 100 * 10)) / 10;
                                                            } else {
                                                                $shop_sum_number_progress_pre2 = "---";
                                                            }

                                                        // 店舗(免税外)・売上粗利予測・先月比
                                                            if($shop_sum_arari_progress_pre <> "" && $shop_sum_arari_progress_pre <> 0 && $shop_sum_arari_progress2 <> "" && $shop_sum_arari_progress2 <> 0){
                                                                $shop_sum_arari_progress_pre2 = (floor(((float)$shop_sum_arari_progress_pre / (float)$shop_sum_arari_progress2) * 100 * 10)) / 10;
                                                            } else {
                                                                $shop_sum_arari_progress_pre2 = "---";
                                                            }

                                                        // WEB・売上額予測・先月比
                                                            if($web_sum_uriage_progress_pre <> "" && $web_sum_uriage_progress_pre <> 0 && $web_sum_uriage_progress2 <> "" && $web_sum_uriage_progress2 <> 0){
                                                                $web_sum_uriage_progress_pre2 = (floor(((float)$web_sum_uriage_progress_pre / (float)$web_sum_uriage_progress2) * 100 * 10)) / 10;
                                                            } else {
                                                                $web_sum_uriage_progress_pre2 = "---";
                                                            }

                                                        // WEB・売上点数予測・先月比
                                                            if($web_sum_number_progress_pre <> "" && $web_sum_number_progress_pre <> 0 && $web_sum_number_progress2 <> "" && $web_sum_number_progress2 <> 0){
                                                                $web_sum_number_progress_pre2 = (floor(((float)$web_sum_number_progress_pre / (float)$web_sum_number_progress2) * 100 * 10)) / 10;
                                                            } else {
                                                                $web_sum_number_progress_pre2 = "---";
                                                            }

                                                        // WEB・売上粗利予測・先月比
                                                            if($web_sum_arari_progress_pre <> "" && $web_sum_arari_progress_pre <> 0 && $web_sum_arari_progress2 <> "" && $web_sum_arari_progress2 <> 0){
                                                                $web_sum_arari_progress_pre2 = (floor(((float)$web_sum_arari_progress_pre / (float)$web_sum_arari_progress2) * 100 * 10)) / 10;
                                                            } else {
                                                                $web_sum_arari_progress_pre2 = "---";
                                                            }
                                                            
                                                            
                                                            
                                                    $oroshi_sum_uriage_progress_pre2 = "";
                                                    $oroshi_sum_number_progress_pre2 = "";
                                                    $oroshi_sum_arari_progress_pre2 = "";
                                                    if($out1_c == "ON"){ 
                                                        // 店舗・通販(免税)・売上額予測・先月比
                                                            if($oroshi_sum_uriage_progress_pre <> "" && $oroshi_sum_uriage_progress_pre <> 0 && $oroshi_sum_uriage_progress2 <> "" && $oroshi_sum_uriage_progress2 <> 0){
                                                                $oroshi_sum_uriage_progress_pre2 = (floor(((float)$oroshi_sum_uriage_progress_pre / (float)$oroshi_sum_uriage_progress2) * 100 * 10)) / 10;
                                                            } else {
                                                                $oroshi_sum_uriage_progress_pre2 = "---";
                                                            }
                                                    
                                                        // 店舗・通販(免税)・売上点数予測・先月比
                                                            if($oroshi_sum_number_progress_pre <> "" && $oroshi_sum_number_progress_pre <> 0 && $oroshi_sum_number_progress2 <> "" && $oroshi_sum_number_progress2 <> 0){
                                                                $oroshi_sum_number_progress_pre2 = (floor(((float)$oroshi_sum_number_progress_pre / (float)$oroshi_sum_number_progress2) * 100 * 10)) / 10;
                                                            } else {
                                                                $oroshi_sum_number_progress_pre2 = "---";
                                                            }
                                                    
                                                        // 店舗・通販(免税)・売上粗利予測・先月比
                                                            if($oroshi_sum_arari_progress_pre <> "" && $oroshi_sum_arari_progress_pre <> 0 && $oroshi_sum_arari_progress2 <> "" && $oroshi_sum_arari_progress2 <> 0){
                                                                $oroshi_sum_arari_progress_pre2 = (floor(((float)$oroshi_sum_arari_progress_pre / (float)$oroshi_sum_arari_progress2) * 100 * 10)) / 10;
                                                            } else {
                                                                $oroshi_sum_arari_progress_pre2 = "---";
                                                            }
                                                    }
                                                // 過去比
                                                        // 店舗(免税外)・売上額予測・過去比
                                                            if($shop_sum_uriage_progress_pre <> "" && $shop_sum_uriage_progress_pre <> 0 && $shop_sum_uriage_progress3 <> "" && $shop_sum_uriage_progress3 <> 0){
                                                                $shop_sum_uriage_progress_pre3 = (floor(((float)$shop_sum_uriage_progress_pre / (float)$shop_sum_uriage_progress3) * 100 * 10)) / 10;
                                                            } else {
                                                                $shop_sum_uriage_progress_pre3 = "---";
                                                            }
                                                        // 店舗(免税外)・売上点数予測・過去比
                                                            if($shop_sum_number_progress_pre <> "" && $shop_sum_number_progress_pre <> 0 && $shop_sum_number_progress3 <> "" && $shop_sum_number_progress3 <> 0){
                                                                $shop_sum_number_progress_pre3 = (floor(((float)$shop_sum_number_progress_pre / (float)$shop_sum_number_progress3) * 100 * 10)) / 10;
                                                            } else {
                                                                $shop_sum_number_progress_pre3 = "---";
                                                            }
                                                        // 店舗(免税外)・売上粗利予測・過去比
                                                            if($shop_sum_arari_progress_pre <> "" && $shop_sum_arari_progress_pre <> 0 && $shop_sum_arari_progress3 <> "" && $shop_sum_arari_progress3 <> 0){
                                                                $shop_sum_arari_progress_pre3 = (floor(((float)$shop_sum_arari_progress_pre / (float)$shop_sum_arari_progress3) * 100 * 10)) / 10;
                                                            } else {
                                                                $shop_sum_arari_progress_pre3 = "---";
                                                            }
                                                            
                                                        // WEB(免税外)・売上額予測・過去比
                                                            if($web_sum_uriage_progress_pre <> "" && $web_sum_uriage_progress_pre <> 0 && $web_sum_uriage_progress3 <> "" && $web_sum_uriage_progress3 <> 0){
                                                                $web_sum_uriage_progress_pre3 = (floor(((float)$web_sum_uriage_progress_pre / (float)$web_sum_uriage_progress3) * 100 * 10)) / 10;
                                                            } else {
                                                                $web_sum_uriage_progress_pre3 = "---";
                                                            }
                                                        // WEB(免税外)・売上点数予測・過去比
                                                            if($web_sum_number_progress_pre <> "" && $web_sum_number_progress_pre <> 0 && $web_sum_number_progress3 <> "" && $web_sum_number_progress3 <> 0){
                                                                $web_sum_number_progress_pre3 = (floor(((float)$web_sum_number_progress_pre / (float)$web_sum_number_progress3) * 100 * 10)) / 10;
                                                            } else {
                                                                $web_sum_number_progress_pre3 = "---";
                                                            }
                                                        // WEB(免税外)・売上粗利予測・過去比
                                                            if($web_sum_arari_progress_pre <> "" && $web_sum_arari_progress_pre <> 0 && $web_sum_arari_progress3 <> "" && $web_sum_arari_progress3 <> 0){
                                                                $web_sum_arari_progress_pre3 = (floor(((float)$web_sum_arari_progress_pre / (float)$web_sum_arari_progress3) * 100 * 10)) / 10;
                                                            } else {
                                                                $web_sum_arari_progress_pre3 = "---";
                                                            }
                                                            
                                                            
                                                            
                                                    $oroshi_sum_uriage_progress_pre3 = "";
                                                    $oroshi_sum_number_progress_pre3 = "";
                                                    $oroshi_sum_arari_progress_pre3 = "";
                                                    if($out1_c == "ON"){ 
                                                        // 店舗・通販(免税)・売上額予測・過去比
                                                            if($oroshi_sum_uriage_progress_pre <> "" && $oroshi_sum_uriage_progress_pre <> 0 && $oroshi_sum_uriage_progress3 <> "" && $oroshi_sum_uriage_progress3 <> 0){
                                                                $oroshi_sum_uriage_progress_pre3 = (floor(((float)$oroshi_sum_uriage_progress_pre / (float)$oroshi_sum_uriage_progress3) * 100 * 10)) / 10;
                                                            } else {
                                                                $oroshi_sum_uriage_progress_pre3 = "---";
                                                            }
                                                        // 店舗・通販(免税)・売上点数予測・過去比
                                                            if($oroshi_sum_number_progress_pre <> "" && $oroshi_sum_number_progress_pre <> 0 && $oroshi_sum_number_progress3 <> "" && $oroshi_sum_number_progress3 <> 0){
                                                                $oroshi_sum_number_progress_pre3 = (floor(((float)$oroshi_sum_number_progress_pre / (float)$oroshi_sum_number_progress3) * 100 * 10)) / 10;
                                                            } else {
                                                                $oroshi_sum_number_progress_pre3 = "---";
                                                            }
                                                        // 店舗・通販(免税)・売上粗利予測・過去比
                                                            if($oroshi_sum_arari_progress_pre <> "" && $oroshi_sum_arari_progress_pre <> 0 && $oroshi_sum_arari_progress3 <> "" && $oroshi_sum_arari_progress3 <> 0){
                                                                $oroshi_sum_arari_progress_pre3 = (floor(((float)$oroshi_sum_arari_progress_pre / (float)$oroshi_sum_arari_progress3) * 100 * 10)) / 10;
                                                            } else {
                                                                $oroshi_sum_arari_progress_pre3 = "---";
                                                            }
                                                    }

                                                // 合計値
                                                        // データ格納最終月・売上額進捗合計
                                                            $all_sum_uriage_progress = (int)$shop_sum_uriage_progress + (int)$web_sum_uriage_progress + (int)$oroshi_sum_uriage_progress;
                                                        // データ格納最終月・売上点数進捗合計
                                                            $all_sum_number_progress = (int)$shop_sum_number_progress + (int)$web_sum_number_progress + (int)$oroshi_sum_number_progress;
                                                        // データ格納最終月・売上粗利進捗合計
                                                            $all_sum_arari_progress = (int)$shop_sum_arari_progress + (int)$web_sum_arari_progress + (int)$oroshi_sum_arari_progress;

                                                        // データ格納最終月・売上額・着地予測合計
                                                            $all_sum_uriage_progress_pre = (int)$shop_sum_uriage_progress_pre + (int)$web_sum_uriage_progress_pre + (int)$oroshi_sum_uriage_progress_pre;
                                                        // データ格納最終月・売上点数・着地予測合計
                                                            $all_sum_number_progress_pre = (int)$shop_sum_number_progress_pre + (int)$web_sum_number_progress_pre + (int)$oroshi_sum_number_progress_pre;
                                                        // データ格納最終月・売上粗利・着地予測合計
                                                            $all_sum_arari_progress_pre = (int)$shop_sum_arari_progress_pre + (int)$web_sum_arari_progress_pre + (int)$oroshi_sum_arari_progress_pre;

                                                        // 進捗合計に対する先月比
                                                            //20240519 if($all_sum_uriage_progress_pre <> "" && $all_sum_uriage_progress_pre <> "" && ((int)$shop_sum_uriage_progress2 + (int)$web_sum_uriage_progress2 + (int)$oroshi_sum_uriage_progress2) <> "" && ((int)$shop_sum_uriage_progress2 + (int)$web_sum_uriage_progress2 + (int)$oroshi_sum_uriage_progress2) <> ""){
                                                            if($all_sum_uriage_progress_pre <> "" && $all_sum_uriage_progress_pre <> 0 && ((int)$shop_sum_uriage_progress2 + (int)$web_sum_uriage_progress2 + (int)$oroshi_sum_uriage_progress2) <> "" && ((int)$shop_sum_uriage_progress2 + (int)$web_sum_uriage_progress2 + (int)$oroshi_sum_uriage_progress2) <> 0){
                                                                $all_sum_uriage_progress2 = (floor(((int)$all_sum_uriage_progress_pre / ((int)$shop_sum_uriage_progress2 + (int)$web_sum_uriage_progress2 + (int)$oroshi_sum_uriage_progress2)) * 100 * 10)) / 10;
                                                            } else {
                                                                $all_sum_uriage_progress2 = "---";
                                                            }
                                                            // 20240519 if($all_sum_number_progress_pre <> "" && $all_sum_number_progress_pre <> "" && ((int)$shop_sum_number_progress2 + (int)$web_sum_number_progress2 + (int)$oroshi_sum_number_progress2) <> "" && ((int)$shop_sum_number_progress2 + (int)$web_sum_number_progress2 + (int)$oroshi_sum_number_progress2) <> ""){
                                                            if($all_sum_number_progress_pre <> "" && $all_sum_number_progress_pre <> 0 && ((int)$shop_sum_number_progress2 + (int)$web_sum_number_progress2 + (int)$oroshi_sum_number_progress2) <> "" && ((int)$shop_sum_number_progress2 + (int)$web_sum_number_progress2 + (int)$oroshi_sum_number_progress2) <> 0){
                                                                $all_sum_number_progress2 = (floor(((int)$all_sum_number_progress_pre / ((int)$shop_sum_number_progress2 + (int)$web_sum_number_progress2 + (int)$oroshi_sum_number_progress2)) * 100 * 10)) / 10;
                                                            } else {
                                                                $all_sum_number_progress2 = "---";
                                                            }
                                                            //20240519 if($all_sum_arari_progress_pre <> "" && $all_sum_arari_progress_pre <> "" && ((int)$shop_sum_arari_progress2 + (int)$web_sum_arari_progress2 + (int)$oroshi_sum_arari_progress2) <> "" && ((int)$shop_sum_arari_progress2 + (int)$web_sum_arari_progress2 + (int)$oroshi_sum_arari_progress2) <> ""){
                                                            if($all_sum_arari_progress_pre <> "" && $all_sum_arari_progress_pre <> 0 && ((int)$shop_sum_arari_progress2 + (int)$web_sum_arari_progress2 + (int)$oroshi_sum_arari_progress2) <> "" && ((int)$shop_sum_arari_progress2 + (int)$web_sum_arari_progress2 + (int)$oroshi_sum_arari_progress2) <> 0){
                                                                $all_sum_arari_progress2 = (floor(((int)$all_sum_arari_progress_pre / ((int)$shop_sum_arari_progress2 + (int)$web_sum_arari_progress2 + (int)$oroshi_sum_arari_progress2)) * 100 * 10)) / 10;
                                                            } else {
                                                                $all_sum_arari_progress2 = "---";
                                                            }
                                                        // 進捗合計に対する過去比
                                                            //20240519 if($all_sum_uriage_progress_pre <> "" && $all_sum_uriage_progress_pre <> "" && ((int)$shop_sum_uriage_progress3 + (int)$web_sum_uriage_progress3 + (int)$oroshi_sum_uriage_progress3) <> "" && ((int)$shop_sum_uriage_progress3 + (int)$web_sum_uriage_progress3 + (int)$oroshi_sum_uriage_progress3) <> ""){
                                                            if($all_sum_uriage_progress_pre <> "" && $all_sum_uriage_progress_pre <> 0 && ((int)$shop_sum_uriage_progress3 + (int)$web_sum_uriage_progress3 + (int)$oroshi_sum_uriage_progress3) <> "" && ((int)$shop_sum_uriage_progress3 + (int)$web_sum_uriage_progress3 + (int)$oroshi_sum_uriage_progress3) <> 0){
                                                                $all_sum_uriage_progress3 = (floor(((int)$all_sum_uriage_progress_pre / ((int)$shop_sum_uriage_progress3 + (int)$web_sum_uriage_progress3 + (int)$oroshi_sum_uriage_progress3)) * 100 * 10)) / 10;
                                                            } else {
                                                                $all_sum_uriage_progress3 = "---";
                                                            }
                                                            //20240519 if($all_sum_number_progress_pre <> "" && $all_sum_number_progress_pre <> "" && ((int)$shop_sum_number_progress3 + (int)$web_sum_number_progress3 + (int)$oroshi_sum_number_progress3) <> "" && ((int)$shop_sum_number_progress3 + (int)$web_sum_number_progress3 + (int)$oroshi_sum_number_progress3) <> ""){
                                                            if($all_sum_number_progress_pre <> "" && $all_sum_number_progress_pre <> 0 && ((int)$shop_sum_number_progress3 + (int)$web_sum_number_progress3 + (int)$oroshi_sum_number_progress3) <> "" && ((int)$shop_sum_number_progress3 + (int)$web_sum_number_progress3 + (int)$oroshi_sum_number_progress3) <> 0){
                                                                $all_sum_number_progress3 = (floor(((int)$all_sum_number_progress_pre / ((int)$shop_sum_number_progress3 + (int)$web_sum_number_progress3 + (int)$oroshi_sum_number_progress3)) * 100 * 10)) / 10;
                                                            } else {
                                                                $all_sum_number_progress3 = "---";
                                                            }
                                                            //20240519 if($all_sum_arari_progress_pre <> "" && $all_sum_arari_progress_pre <> "" && ((int)$shop_sum_arari_progress3 + (int)$web_sum_arari_progress3 + (int)$oroshi_sum_arari_progress3) <> "" && ((int)$shop_sum_arari_progress3 + (int)$web_sum_arari_progress3 + (int)$oroshi_sum_arari_progress3) <> ""){
                                                            if($all_sum_arari_progress_pre <> "" && $all_sum_arari_progress_pre <> 0 && ((int)$shop_sum_arari_progress3 + (int)$web_sum_arari_progress3 + (int)$oroshi_sum_arari_progress3) <> "" && ((int)$shop_sum_arari_progress3 + (int)$web_sum_arari_progress3 + (int)$oroshi_sum_arari_progress3) <> 0){
                                                                $all_sum_arari_progress3 = (floor(((int)$all_sum_arari_progress_pre / ((int)$shop_sum_arari_progress3 + (int)$web_sum_arari_progress3 + (int)$oroshi_sum_arari_progress3)) * 100 * 10)) / 10;
                                                            } else {
                                                                $all_sum_arari_progress3 = "---";
                                                            }
                                                        // HTML作成
                                                            ($shop_sum_uriage_progress == 0 || $shop_sum_uriage_progress == "" || $shop_sum_uriage_progress == "---") ? $shop_uriage_view1 = $shop_sum_uriage_progress : $shop_uriage_view1 = number_format($shop_sum_uriage_progress);
                                                            ($shop_sum_uriage_progress_pre == 0 || $shop_sum_uriage_progress_pre == "" || $shop_sum_uriage_progress_pre == "---") ? $shop_uriage_view2 = $shop_sum_uriage_progress_pre : $shop_uriage_view2 = number_format($shop_sum_uriage_progress_pre);
                                                            ($shop_sum_uriage_progress_pre2 == 0 || $shop_sum_uriage_progress_pre2 == "" || $shop_sum_uriage_progress_pre2 == "---") ? $shop_uriage_view3 = $shop_sum_uriage_progress_pre2 : $shop_uriage_view3 = number_format($shop_sum_uriage_progress_pre2,1);
                                                            ($shop_sum_uriage_progress_pre3 == 0 || $shop_sum_uriage_progress_pre3 == "" || $shop_sum_uriage_progress_pre3 == "---") ? $shop_uriage_view4 = $shop_sum_uriage_progress_pre3 : $shop_uriage_view4 = number_format($shop_sum_uriage_progress_pre3,1);
                                                            ($web_sum_uriage_progress == 0 || $web_sum_uriage_progress == "" || $web_sum_uriage_progress == "---") ? $web_uriage_view1 = $web_sum_uriage_progress : $web_uriage_view1 = number_format($web_sum_uriage_progress);
                                                            ($web_sum_uriage_progress_pre == 0 || $web_sum_uriage_progress_pre == "" || $web_sum_uriage_progress_pre == "---") ? $web_uriage_view2 = $web_sum_uriage_progress_pre : $web_uriage_view2 = number_format($web_sum_uriage_progress_pre);
                                                            ($web_sum_uriage_progress_pre2 == 0 || $web_sum_uriage_progress_pre2 == "" || $web_sum_uriage_progress_pre2 == "---") ? $web_uriage_view3 = $web_sum_uriage_progress_pre2 : $web_uriage_view3 = number_format($web_sum_uriage_progress_pre2,1);
                                                            ($web_sum_uriage_progress_pre3 == 0 || $web_sum_uriage_progress_pre3 == "" || $web_sum_uriage_progress_pre3 == "---") ? $web_uriage_view4 = $web_sum_uriage_progress_pre3 : $web_uriage_view4 = number_format($web_sum_uriage_progress_pre3,1);
                                                            ($oroshi_sum_uriage_progress == 0 || $oroshi_sum_uriage_progress == "" || $oroshi_sum_uriage_progress == "---") ? $oroshi_uriage_view1 = $oroshi_sum_uriage_progress : $oroshi_uriage_view1 = number_format($oroshi_sum_uriage_progress);
                                                            ($oroshi_sum_uriage_progress_pre == 0 || $oroshi_sum_uriage_progress_pre == "" || $oroshi_sum_uriage_progress_pre == "---") ? $oroshi_uriage_view2 = $oroshi_sum_uriage_progress_pre : $oroshi_uriage_view2 = number_format($oroshi_sum_uriage_progress_pre);
                                                            ($oroshi_sum_uriage_progress_pre2 == 0 || $oroshi_sum_uriage_progress_pre2 == "" || $oroshi_sum_uriage_progress_pre2 == "---") ? $oroshi_uriage_view3 = $oroshi_sum_uriage_progress_pre2 : $oroshi_uriage_view3 = number_format($oroshi_sum_uriage_progress_pre2,1);
                                                            ($oroshi_sum_uriage_progress_pre3 == 0 || $oroshi_sum_uriage_progress_pre3 == "" || $oroshi_sum_uriage_progress_pre3 == "---") ? $oroshi_uriage_view4 = $oroshi_sum_uriage_progress_pre3 : $oroshi_uriage_view4 = number_format($oroshi_sum_uriage_progress_pre3,1);
                                                            ($all_sum_uriage_progress == 0 || $all_sum_uriage_progress == "" || $all_sum_uriage_progress == "---") ? $all_uriage_view1 = $all_sum_uriage_progress : $all_uriage_view1 = number_format($all_sum_uriage_progress);
                                                            ($all_sum_uriage_progress_pre == 0 || $all_sum_uriage_progress_pre == "" || $all_sum_uriage_progress_pre == "---") ? $all_uriage_view2 = $all_sum_uriage_progress_pre : $all_uriage_view2 = number_format($all_sum_uriage_progress_pre);
                                                            ($all_sum_uriage_progress2 == 0 || $all_sum_uriage_progress2 == "" || $all_sum_uriage_progress2 == "---") ? $all_uriage_view3 = $all_sum_uriage_progress2 : $all_uriage_view3 = number_format($all_sum_uriage_progress2,1);
                                                            ($all_sum_uriage_progress3 == 0 || $all_sum_uriage_progress3 == "" || $all_sum_uriage_progress3 == "---") ? $all_uriage_view4 = $all_sum_uriage_progress3 : $all_uriage_view4 = number_format($all_sum_uriage_progress3,1);
                                                            
                                                            
                                                            ($shop_sum_number_progress == 0 || $shop_sum_number_progress == "" || $shop_sum_number_progress == "---") ? $shop_number_view1 = $shop_sum_number_progress : $shop_number_view1 = number_format($shop_sum_number_progress);
                                                            ($shop_sum_number_progress_pre == 0 || $shop_sum_number_progress_pre == "" || $shop_sum_number_progress_pre == "---") ? $shop_number_view2 = $shop_sum_number_progress_pre : $shop_number_view2 = number_format($shop_sum_number_progress_pre);
                                                            ($shop_sum_number_progress_pre2 == 0 || $shop_sum_number_progress_pre2 == "" || $shop_sum_number_progress_pre2 == "---") ? $shop_number_view3 = $shop_sum_number_progress_pre2 : $shop_number_view3 = number_format($shop_sum_number_progress_pre2,1);
                                                            ($shop_sum_number_progress_pre3 == 0 || $shop_sum_number_progress_pre3 == "" || $shop_sum_number_progress_pre3 == "---") ? $shop_number_view4 = $shop_sum_number_progress_pre3 : $shop_number_view4 = number_format($shop_sum_number_progress_pre3,1);
                                                            ($web_sum_number_progress == 0 || $web_sum_number_progress == "" || $web_sum_number_progress == "---") ? $web_number_view1 = $web_sum_number_progress : $web_number_view1 = number_format($web_sum_number_progress);
                                                            ($web_sum_number_progress_pre == 0 || $web_sum_number_progress_pre == "" || $web_sum_number_progress_pre == "---") ? $web_number_view2 = $web_sum_number_progress_pre : $web_number_view2 = number_format($web_sum_number_progress_pre);
                                                            ($web_sum_number_progress_pre2 == 0 || $web_sum_number_progress_pre2 == "" || $web_sum_number_progress_pre2 == "---") ? $web_number_view3 = $web_sum_number_progress_pre2 : $web_number_view3 = number_format($web_sum_number_progress_pre2,1);
                                                            ($web_sum_number_progress_pre3 == 0 || $web_sum_number_progress_pre3 == "" || $web_sum_number_progress_pre3 == "---") ? $web_number_view4 = $web_sum_number_progress_pre3 : $web_number_view4 = number_format($web_sum_number_progress_pre3,1);
                                                            ($oroshi_sum_number_progress == 0 || $oroshi_sum_number_progress == "" || $oroshi_sum_number_progress == "---") ? $oroshi_number_view1 = $oroshi_sum_number_progress : $oroshi_number_view1 = number_format($oroshi_sum_number_progress);
                                                            ($oroshi_sum_number_progress_pre == 0 || $oroshi_sum_number_progress_pre == "" || $oroshi_sum_number_progress_pre == "---") ? $oroshi_number_view2 = $oroshi_sum_number_progress_pre : $oroshi_number_view2 = number_format($oroshi_sum_number_progress_pre);
                                                            ($oroshi_sum_number_progress_pre2 == 0 || $oroshi_sum_number_progress_pre2 == "" || $oroshi_sum_number_progress_pre2 == "---") ? $oroshi_number_view3 = $oroshi_sum_number_progress_pre2 : $oroshi_number_view3 = number_format($oroshi_sum_number_progress_pre2,1);
                                                            ($oroshi_sum_number_progress_pre3 == 0 || $oroshi_sum_number_progress_pre3 == "" || $oroshi_sum_number_progress_pre3 == "---") ? $oroshi_number_view4 = $oroshi_sum_number_progress_pre3 : $oroshi_number_view4 = number_format($oroshi_sum_number_progress_pre3,1);
                                                            ($all_sum_number_progress == 0 || $all_sum_number_progress == "" || $all_sum_number_progress == "---") ? $all_number_view1 = $all_sum_number_progress : $all_number_view1 = number_format($all_sum_number_progress);
                                                            ($all_sum_number_progress_pre == 0 || $all_sum_number_progress_pre == "" || $all_sum_number_progress_pre == "---") ? $all_number_view2 = $all_sum_number_progress_pre : $all_number_view2 = number_format($all_sum_number_progress_pre);
                                                            ($all_sum_number_progress2 == 0 || $all_sum_number_progress2 == "" || $all_sum_number_progress2 == "---") ? $all_number_view3 = $all_sum_number_progress2 : $all_number_view3 = number_format($all_sum_number_progress2,1);
                                                            ($all_sum_number_progress3 == 0 || $all_sum_number_progress3 == "" || $all_sum_number_progress3 == "---") ? $all_number_view4 = $all_sum_number_progress3 : $all_number_view4 = number_format($all_sum_number_progress3,1);
                                                            
                                                            ($shop_sum_arari_progress == 0 || $shop_sum_arari_progress == "" || $shop_sum_arari_progress == "---") ? $shop_arari_view1 = $shop_sum_arari_progress : $shop_arari_view1 = number_format($shop_sum_arari_progress);
                                                            ($shop_sum_arari_progress_pre == 0 || $shop_sum_arari_progress_pre == "" || $shop_sum_arari_progress_pre == "---") ? $shop_arari_view2 = $shop_sum_arari_progress_pre : $shop_arari_view2 = number_format($shop_sum_arari_progress_pre);
                                                            ($shop_sum_arari_progress_pre2 == 0 || $shop_sum_arari_progress_pre2 == "" || $shop_sum_arari_progress_pre2 == "---") ? $shop_arari_view3 = $shop_sum_arari_progress_pre2 : $shop_arari_view3 = number_format($shop_sum_arari_progress_pre2,1);
                                                            ($shop_sum_arari_progress_pre3 == 0 || $shop_sum_arari_progress_pre3 == "" || $shop_sum_arari_progress_pre3 == "---") ? $shop_arari_view4 = $shop_sum_arari_progress_pre3 : $shop_arari_view4 = number_format($shop_sum_arari_progress_pre3,1);
                                                            ($web_sum_arari_progress == 0 || $web_sum_arari_progress == "" || $web_sum_arari_progress == "---") ? $web_arari_view1 = $web_sum_arari_progress : $web_arari_view1 = number_format($web_sum_arari_progress);
                                                            ($web_sum_arari_progress_pre == 0 || $web_sum_arari_progress_pre == "" || $web_sum_arari_progress_pre == "---") ? $web_arari_view2 = $web_sum_arari_progress_pre : $web_arari_view2 = number_format($web_sum_arari_progress_pre);
                                                            ($web_sum_arari_progress_pre2 == 0 || $web_sum_arari_progress_pre2 == "" || $web_sum_arari_progress_pre2 == "---") ? $web_arari_view3 = $web_sum_arari_progress_pre2 : $web_arari_view3 = number_format($web_sum_arari_progress_pre2,1);
                                                            ($web_sum_arari_progress_pre3 == 0 || $web_sum_arari_progress_pre3 == ""|| $web_sum_arari_progress_pre3 == "---") ? $web_arari_view4 = $web_sum_arari_progress_pre3 : $web_arari_view4 = number_format($web_sum_arari_progress_pre3,1);
                                                            ($oroshi_sum_arari_progress == 0 || $oroshi_sum_arari_progress == "" || $oroshi_sum_arari_progress == "---") ? $oroshi_arari_view1 = $oroshi_sum_arari_progress : $oroshi_arari_view1 = number_format($oroshi_sum_arari_progress);
                                                            ($oroshi_sum_arari_progress_pre == 0 || $oroshi_sum_arari_progress_pre == "" || $oroshi_sum_arari_progress_pre == "---") ? $oroshi_arari_view2 = $oroshi_sum_arari_progress_pre : $oroshi_arari_view2 = number_format($oroshi_sum_arari_progress_pre);
                                                            ($oroshi_sum_arari_progress_pre2 == 0 || $oroshi_sum_arari_progress_pre2 == "" || $oroshi_sum_arari_progress_pre2 == "---") ? $oroshi_arari_view3 = $oroshi_sum_arari_progress_pre2 : $oroshi_arari_view3 = number_format($oroshi_sum_arari_progress_pre2,1);
                                                            ($oroshi_sum_arari_progress_pre3 == 0 || $oroshi_sum_arari_progress_pre3 == "" || $oroshi_sum_arari_progress_pre3 == "---") ? $oroshi_arari_view4 = $oroshi_sum_arari_progress_pre3 : $oroshi_arari_view4 = number_format($oroshi_sum_arari_progress_pre3,1);
                                                            ($all_sum_arari_progress == 0 || $all_sum_arari_progress == "" || $all_sum_arari_progress == "---") ? $all_arari_view1 = $all_sum_arari_progress : $all_arari_view1 = number_format($all_sum_arari_progress);
                                                            ($all_sum_arari_progress_pre == 0 || $all_sum_arari_progress_pre == "" || $all_sum_arari_progress_pre == "---") ? $all_arari_view2 = $all_sum_arari_progress_pre : $all_arari_view2 = number_format($all_sum_arari_progress_pre);
                                                            ($all_sum_arari_progress2 == 0 || $all_sum_arari_progress2 == "" || $all_sum_arari_progress2 == "---") ? $all_arari_view3 = $all_sum_arari_progress2 : $all_arari_view3 = number_format($all_sum_arari_progress2,1);
                                                            ($all_sum_arari_progress3 == 0 || $all_sum_arari_progress3 == "" || $all_sum_arari_progress3 == "---") ? $all_arari_view4 = $all_sum_arari_progress3 : $all_arari_view4 = number_format($all_sum_arari_progress3,1);
                                                            

                                                            ($shop_uriage_view3 < 100) ? $shop_uriage_view3 = "<div class='sinchoku fc_blue'>" . $shop_uriage_view3 . "%</div>" : $shop_uriage_view3 = "<div class='sinchoku fc_red'>" . $shop_uriage_view3 . "%</div>";
                                                            ($shop_uriage_view4 < 100) ? $shop_uriage_view4 = "<div class='sinchoku fc_blue'>" . $shop_uriage_view4 . "%</div>" : $shop_uriage_view4 = "<div class='sinchoku fc_red'>" . $shop_uriage_view4 . "%</div>";
                                                            ($web_uriage_view3 < 100) ? $web_uriage_view3 = "<div class='sinchoku fc_blue'>" . $web_uriage_view3 . "%</div>" : $web_uriage_view3 = "<div class='sinchoku fc_red'>" . $web_uriage_view3 . "%</div>";
                                                            ($web_uriage_view4 < 100) ? $web_uriage_view4 = "<div class='sinchoku fc_blue'>" . $web_uriage_view4 . "%</div>" : $web_uriage_view4 = "<div class='sinchoku fc_red'>" . $web_uriage_view4 . "%</div>";
                                                            ($oroshi_uriage_view3 < 100) ? $oroshi_uriage_view3 = "<div class='sinchoku fc_blue'>" . $oroshi_uriage_view3 . "%</div>" : $oroshi_uriage_view3 = "<div class='sinchoku fc_red'>" . $oroshi_uriage_view3 . "%</div>";
                                                            ($oroshi_uriage_view4 < 100) ? $oroshi_uriage_view4 = "<div class='sinchoku fc_blue'>" . $oroshi_uriage_view4 . "%</div>" : $oroshi_uriage_view4 = "<div class='sinchoku fc_red'>" . $oroshi_uriage_view4 . "%</div>";
                                                            ($all_uriage_view3 < 100) ? $all_uriage_view3 = "<div class='sinchoku bg_grey fc_blue'>" . $all_uriage_view3 . "%</div>" : $all_uriage_view3 = "<div class='sinchoku bg_grey fc_red'>" . $all_uriage_view3 . "%</div>";
                                                            ($all_uriage_view4 < 100) ? $all_uriage_view4 = "<div class='sinchoku bg_grey fc_blue'>" . $all_uriage_view4 . "%</div>" : $all_uriage_view4 = "<div class='sinchoku bg_grey fc_red'>" . $all_uriage_view4 . "%</div>";
                                                            ($shop_number_view3 < 100) ? $shop_number_view3 = "<div class='sinchoku fc_blue'>" . $shop_number_view3 . "%</div>" : $shop_number_view3 = "<div class='sinchoku fc_red'>" . $shop_number_view3 . "%</div>";
                                                            ($shop_number_view4 < 100) ? $shop_number_view4 = "<div class='sinchoku fc_blue'>" . $shop_number_view4 . "%</div>" : $shop_number_view4 = "<div class='sinchoku fc_red'>" . $shop_number_view4 . "%</div>";
                                                            ($web_number_view3 < 100) ? $web_number_view3 = "<div class='sinchoku fc_blue'>" . $web_number_view3 . "%</div>" : $web_number_view3 = "<div class='sinchoku fc_red'>" . $web_number_view3 . "%</div>";
                                                            ($web_number_view4 < 100) ? $web_number_view4 = "<div class='sinchoku fc_blue'>" . $web_number_view4 . "%</div>" : $web_number_view4 = "<div class='sinchoku fc_red'>" . $web_number_view4 . "%</div>";
                                                            ($oroshi_number_view3 < 100) ? $oroshi_number_view3 = "<div class='sinchoku fc_blue'>" . $oroshi_number_view3 . "%</div>" : $oroshi_number_view3 = "<div class='sinchoku fc_red'>" . $oroshi_number_view3 . "%</div>";
                                                            ($oroshi_number_view4 < 100) ? $oroshi_number_view4 = "<div class='sinchoku fc_blue'>" . $oroshi_number_view4 . "%</div>" : $oroshi_number_view4 = "<div class='sinchoku fc_red'>" . $oroshi_number_view4 . "%</div>";
                                                            ($all_number_view3 < 100) ? $all_number_view3 = "<div class='sinchoku bg_grey fc_blue'>" . $all_number_view3 . "%</div>" : $all_number_view3 = "<div class='sinchoku bg_grey fc_red'>" . $all_number_view3 . "%</div>";
                                                            ($all_number_view4 < 100) ? $all_number_view4 = "<div class='sinchoku bg_grey fc_blue'>" . $all_number_view4 . "%</div>" : $all_number_view4 = "<div class='sinchoku bg_grey fc_red'>" . $all_number_view4 . "%</div>";
                                                            ($shop_arari_view3 < 100) ? $shop_arari_view3 = "<div class='sinchoku fc_blue'>" . $shop_arari_view3 . "%</div>" : $shop_arari_view3 = "<div class='sinchoku fc_red'>" . $shop_arari_view3 . "%</div>";
                                                            ($shop_arari_view4 < 100) ? $shop_arari_view4 = "<div class='sinchoku fc_blue'>" . $shop_arari_view4 . "%</div>" : $shop_arari_view4 = "<div class='sinchoku fc_red'>" . $shop_arari_view4 . "%</div>";
                                                            ($web_arari_view3 < 100) ? $web_arari_view3 = "<div class='sinchoku fc_blue'>" . $web_arari_view3 . "%</div>" : $web_arari_view3 = "<div class='sinchoku fc_red'>" . $web_arari_view3 . "%</div>";
                                                            ($web_arari_view4 < 100) ? $web_arari_view4 = "<div class='sinchoku fc_blue'>" . $web_arari_view4 . "%</div>" : $web_arari_view4 = "<div class='sinchoku fc_red'>" . $web_arari_view4 . "%</div>";
                                                            ($oroshi_arari_view3 < 100) ? $oroshi_arari_view3 = "<div class='sinchoku fc_blue'>" . $oroshi_arari_view3 . "%</div>" : $oroshi_arari_view3 = "<div class='sinchoku fc_red'>" . $oroshi_arari_view3 . "%</div>";
                                                            ($oroshi_arari_view4 < 100) ? $oroshi_arari_view4 = "<div class='sinchoku fc_blue'>" . $oroshi_arari_view4 . "%</div>" : $oroshi_arari_view4 = "<div class='sinchoku fc_red'>" . $oroshi_arari_view4 . "%</div>";
                                                            ($all_arari_view3 < 100) ? $all_arari_view3 = "<div class='sinchoku bg_grey fc_blue'>" . $all_arari_view3 . "%</div>" : $all_arari_view3 = "<div class='sinchoku bg_grey fc_red'>" . $all_arari_view3 . "%</div>";
                                                            ($all_arari_view4 < 100) ? $all_arari_view4 = "<div class='sinchoku bg_grey fc_blue'>" . $all_arari_view4 . "%</div>" : $all_arari_view4 = "<div class='sinchoku bg_grey fc_red'>" . $all_arari_view4 . "%</div>";



                                        /************************************************************************************************************************************************************************************************************* */
                                            // 各予測値と過去比を取得 end
                                        /************************************************************************************************************************************************************************************************************* */
                                        



                    /************************************************************************************************************************************************************************************************************* */
                        // DB情報の受け取り（過去の期間）start
                    /************************************************************************************************************************************************************************************************************* */
                    
                            $past_temp1_title2 = "";
                            //$past_js_month = "";
                            $past_i = 0;

                            /************************************************************************************************************************************************************************************************************* */
                                // 通販用(免税外)（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */
                                    
                                    if($out1_b == "ON"){
                                            // DB検索（通販値）スタート
                                                $past_web_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS web_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS web_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS web_number"),
                                                        \DB::raw("SUM(ararikingaku) AS web_arari"),
                                                    ])
                                                    ->groupBy('web_month')
                                                // 条件（売上部門が通販）
                                                    ->where('baikyakukubun',2)
                                                // 条件（期間の指定）
                                                    ->whereBetween($table_name . '.uriage', [$past_between_start, $past_between_end])
                                                // 条件（分類名）
                                                    ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
															// 条件（商品区分分類名が新品）
																if($out2_a == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%新品%");
																}
															// 条件（商品区分分類名が中古）
																if($out2_b == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%中古%");
																}
															// 条件（商品区分分類名がアンティーク）
																if($out2_c == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
																}
															// 条件（商品区分分類名がその他）
																if($out2_d == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%その他%");
																}
															// 条件（商品区分分類名が修理）
																if($out2_e == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%修理%");
																}
                                                    
                                                    })
                                                // 条件（通販区分）
                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                            $query->orWhere('tsuuhankubun','');

															// 条件（通販区分が自社）
																if($out3_a == "ON"){
																	$query->orWhere('tsuuhankubun',1);
																}
															// 条件（通販区分が楽天）
																if($out3_b == "ON"){
																	$query->orWhere('tsuuhankubun',2);
																}
															// 条件（通販区分がヤフー）
																if($out3_c == "ON"){
																	$query->orWhere('tsuuhankubun',3);
																}
															// 条件（通販区分が電話・雑誌）
																if($out3_d == "ON"){
																	$query->orWhere('tsuuhankubun',5);
																}
															// 条件（通販区分がYオークション）
																if($out3_e == "ON"){
																	$query->orWhere('tsuuhankubun',4);
																}
															// 条件（通販区分が修理品返送）
																if($out3_f == "ON"){
																	$query->orWhere('tsuuhankubun',9);
																}
                                                    
                                                    })
                                                // 条件（免税）
                                                    ->where("menzei","like","%対象外%")
                                                                    
                                                // 条件（扱い部門）
                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                            $query->orWhere('bumonmei','');

															// 条件（扱い部門がジャック）
																if($out5_a == "ON"){
																	$query->orWhere('bumonmei','Jackroad');
																}
															// 条件（扱い部門がベティー）
																if($out5_b == "ON"){
																	$query->orWhere('bumonmei','BettyRoad');
																}
															// 条件（扱い部門がジュエリー）
																if($out5_c == "ON"){
																	$query->orWhere('bumonmei','Jewelry');
																}
                                                  
                                                    })
                                                // ソート順指定
                                                    ->orderBy('uriage', 'asc')
                                                    ->get();

                                            // クエリビルダスタート
                                                $past_i = 0;
                                                // 変数リセット
                                                    $past_web_sum_uriage = "";
                                                    $past_web_sum_number = "";
                                                    $past_web_sum_arari= "";
                                                    foreach ($past_web_buys as $past_web_buy) {
                                                        // 各月名
                                                            $past_web_month[$past_i]= $past_web_buy->web_month;
                                                        // 各月通販売上
                                                            $past_web_uriage[$past_i]= $past_web_buy->web_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($past_temp1_web_manthly_data, $past_web_month[$past_i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $past_temp1_web_manthly_data = str_replace($past_web_month[$past_i], $past_web_uriage[$past_i], $past_temp1_web_manthly_data);
                                                                }

                                                        // 全期間通販売上合計
                                                            $past_web_sum_uriage = (int)$past_web_sum_uriage + (int)$past_web_uriage[$past_i];

                                                        // 各月通販点数
                                                            $past_web_number[$past_i]= $past_web_buy->web_number;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($past_temp1_web_manthly_data2, $past_web_month[$past_i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $past_temp1_web_manthly_data2 = str_replace($past_web_month[$past_i], $past_web_number[$past_i], $past_temp1_web_manthly_data2);
                                                                }

                                                        // 全期間通販点数合計
                                                            $past_web_sum_number = (int)$past_web_sum_number + (int)$past_web_number[$past_i];



                                                        // 各月通販粗利
                                                            $past_web_arari[$past_i]= $past_web_buy->web_arari;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($past_temp1_web_manthly_data3, $past_web_month[$past_i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $past_temp1_web_manthly_data3 = str_replace($past_web_month[$past_i], $past_web_arari[$past_i], $past_temp1_web_manthly_data3);
                                                                }

                                                        // 全期間通販粗利合計
                                                            $past_web_sum_arari = (int)$past_web_sum_arari + (int)$past_web_arari[$past_i];
                                                            
                                                        $past_i++;
                                                    }
                                                // 全期間通販売上合計とその平均値のHTML作成
                                                    $past_temp1_web_sum = "";
                                                    if($past_web_sum_uriage <> 0 && $past_web_sum_uriage <> ""){
                                                        $past_web_sum_uriage_c = number_format((int)$past_web_sum_uriage); 
                                                        $past_web_sum_uriage_ave = number_format(floor((int)$past_web_sum_uriage / $past_i));
                                                        $past_web_sum_uriage_ave2 = floor((int)$past_web_sum_uriage / $past_i);
                                                    } else {
                                                        $past_web_sum_uriage_c = $past_web_sum_uriage; 
                                                        $past_web_sum_uriage_ave = 0;
                                                        $past_web_sum_uriage_ave2 = 0;
                                                    }
                                                    //$past_temp1_web_sum = "<div class='title4 ta_r'>" . number_format((int)$past_web_sum_uriage) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$past_web_sum_uriage / $past_i)) . "</div></div>";
                                                    $past_temp1_web_sum = "<div class='title4 ta_r'>" . $past_web_sum_uriage_c . "</div><div class='title4 ta_r'>" . $past_web_sum_uriage_ave . "</div></div>";
                                                // 全期間通販売上点数合計とその平均値のHTML作成
                                                    $past_temp1_web_sum2 = "";
                                                    if($past_web_sum_number <> 0 && $past_web_sum_number <> ""){
                                                        $past_web_sum_number_c = number_format((int)$past_web_sum_number); 
                                                        $past_web_sum_number_ave = number_format(floor((int)$past_web_sum_number / $past_i));
                                                        $past_web_sum_number_ave2 = floor((int)$past_web_sum_number / $past_i);
                                                    } else {
                                                        $past_web_sum_number_c = $past_web_sum_number; 
                                                        $past_web_sum_number_ave = 0;
                                                        $past_web_sum_number_ave2 = 0;
                                                    }
                                                    //$past_temp1_web_sum2 = "<div class='title4 ta_r'>" . number_format((int)$past_web_sum_number) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$past_web_sum_number/ $past_i)) . "</div></div>";
                                                    $past_temp1_web_sum2 = "<div class='title4 ta_r'>" . $past_web_sum_number_c . "</div><div class='title4 ta_r'>" . $past_web_sum_number_ave . "</div></div>";
                                                // 全期間通販粗利合計とその平均値のHTML作成
                                                    $past_temp1_web_sum3 = "";
                                                    if($past_web_sum_arari <> 0 && $past_web_sum_arari <> ""){
                                                        $past_web_sum_arari_c = number_format((int)$past_web_sum_arari); 
                                                        $past_web_sum_arari_ave = number_format(floor((int)$past_web_sum_arari / $past_i));
                                                        $past_web_sum_arari_ave2 = floor((int)$past_web_sum_arari / $past_i);
                                                    } else {
                                                        $past_web_sum_arari_c = $past_web_sum_arari; 
                                                        $past_web_sum_arari_ave = 0;
                                                        $past_web_sum_arari_ave2 = 0;
                                                    }
                                                    //$past_temp1_web_sum3 = "<div class='title4 ta_r'>" . number_format((int)$past_web_sum_arari) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$past_web_sum_arari/ $past_i)) . "</div></div>";
                                                    $past_temp1_web_sum3 = "<div class='title4 ta_r'>" . $past_web_sum_arari_c . "</div><div class='title4 ta_r'>" . $past_web_sum_arari_ave . "</div></div>";
                                    }
        

                            /************************************************************************************************************************************************************************************************************* */
                                // 店舗(免税外)用（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */
                                    if($out1_a == "ON"){
                                            // DB検索（店舗(免税外)値）スタート
                                                $past_shop_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS shop_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS shop_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS shop_number"),
                                                        \DB::raw("SUM(ararikingaku) AS shop_arari"),
                                                    ])
                                                    ->groupBy('shop_month')
                                                // 条件（売上部門が店舗）
                                                    ->where('baikyakukubun',1)
                                                // 条件（期間の指定）
                                                    ->whereBetween($table_name . '.uriage', [$past_between_start, $past_between_end])
                                                // 条件（分類名）
                                                    ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
															// 条件（商品区分分類名が新品）
																if($out2_a == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%新品%");
																}
															// 条件（商品区分分類名が中古）
																if($out2_b == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%中古%");
																}
															// 条件（商品区分分類名がアンティーク）
																if($out2_c == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
																}
															// 条件（商品区分分類名がその他）
																if($out2_d == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%その他%");
																}
															// 条件（商品区分分類名が修理）
																if($out2_e == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%修理%");
																}
                                                    
                                                    })
                                                // 条件（通販区分）
                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                            $query->orWhere('tsuuhankubun','');

															// 条件（通販区分が自社）
																if($out3_a == "ON"){
																	$query->orWhere('tsuuhankubun',1);
																}
															// 条件（通販区分が楽天）
																if($out3_b == "ON"){
																	$query->orWhere('tsuuhankubun',2);
																}
															// 条件（通販区分がヤフー）
																if($out3_c == "ON"){
																	$query->orWhere('tsuuhankubun',3);
																}
															// 条件（通販区分が電話・雑誌）
																if($out3_d == "ON"){
																	$query->orWhere('tsuuhankubun',5);
																}
															// 条件（通販区分がYオークション）
																if($out3_e == "ON"){
																	$query->orWhere('tsuuhankubun',4);
																}
															// 条件（通販区分が修理品返送）
																if($out3_f == "ON"){
																	$query->orWhere('tsuuhankubun',9);
																}
                                                    
                                                    })
                                                // 条件（免税）
                                                    ->where("menzei","like","%対象外%")
                                                                    
                                                // 条件（扱い部門）
                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                            $query->orWhere('bumonmei','');

															// 条件（扱い部門がジャック）
																if($out5_a == "ON"){
																	$query->orWhere('bumonmei','Jackroad');
																}
															// 条件（扱い部門がベティー）
																if($out5_b == "ON"){
																	$query->orWhere('bumonmei','BettyRoad');
																}
															// 条件（扱い部門がジュエリー）
																if($out5_c == "ON"){
																	$query->orWhere('bumonmei','Jewelry');
																}
                                                  
                                                    })
                                                // ソート順指定
                                                    ->orderBy('uriage', 'asc')
                                                    ->get();

                                            // クエリビルダスタート
                                                $past_i = 0;
                                                // 変数リセット
                                                    $past_shop_sum_uriage = "";
                                                    $past_shop_sum_number = "";
                                                    $past_shop_sum_arari = "";
                                                    foreach ($past_shop_buys as $past_shop_buy) {
                                                        // 各月名
                                                            $past_shop_month[$past_i]= $past_shop_buy->shop_month;
                                                        // 各月店舗(免税外)売上
                                                            $past_shop_uriage[$past_i]= $past_shop_buy->shop_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($past_temp1_shop_manthly_data, $past_shop_month[$past_i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $past_temp1_shop_manthly_data = str_replace($past_shop_month[$past_i], $past_shop_uriage[$past_i], $past_temp1_shop_manthly_data);
                                                                }
                                                        // 全期間店舗(免税外)売上合計
                                                            $past_shop_sum_uriage = (int)$past_shop_sum_uriage + (int)$past_shop_uriage[$past_i];
                                                        
                                                        // 各月店舗(免税外)点数
                                                            $past_shop_number[$past_i]= $past_shop_buy->shop_number;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($past_temp1_shop_manthly_data2, $past_shop_month[$past_i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $past_temp1_shop_manthly_data2 = str_replace($past_shop_month[$past_i], $past_shop_number[$past_i], $past_temp1_shop_manthly_data2);
                                                                }
                                                        // 全期間店舗(免税外)点数合計
                                                            $past_shop_sum_number = (int)$past_shop_sum_number + (int)$past_shop_number[$past_i];
                                                          
                                                            
                                                        // 各月店舗(免税外)粗利
                                                            $past_shop_arari[$past_i]= $past_shop_buy->shop_arari;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($past_temp1_shop_manthly_data3,$past_shop_month[$past_i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $past_temp1_shop_manthly_data3 = str_replace($past_shop_month[$past_i], $past_shop_arari[$past_i], $past_temp1_shop_manthly_data3);
                                                                }
                                                        // 全期間店舗(免税外)粗利合計
                                                            $past_shop_sum_arari = (int)$past_shop_sum_arari + (int)$past_shop_arari[$past_i];
                                                            
                                                        $past_i++;
                                                    }
                                                // 全期間店舗売上合計とその平均値のHTML作成
                                                    $past_temp1_shop_sum = "";
                                                    if($past_shop_sum_uriage <> 0 && $past_shop_sum_uriage <> ""){
                                                        $past_shop_sum_uriage_c = number_format((int)$past_shop_sum_uriage); 
                                                        $past_shop_sum_uriage_ave = number_format(floor((int)$past_shop_sum_uriage / $past_i));
                                                        $past_shop_sum_uriage_ave2 = floor((int)$past_shop_sum_uriage / $past_i);
                                                    } else {
                                                        $past_shop_sum_uriage_c = $past_shop_sum_uriage; 
                                                        $past_shop_sum_uriage_ave = 0;
                                                        $past_shop_sum_uriage_ave2 = 0;
                                                    }
                                                    //$past_temp1_shop_sum = "<div class='title4 ta_r'>" . number_format((int)$past_shop_sum_uriage) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$past_shop_sum_uriage / $past_i)) . "</div></div>";
                                                    $past_temp1_shop_sum = "<div class='title4 ta_r'>" . $past_shop_sum_uriage_c . "</div><div class='title4 ta_r'>" . $past_shop_sum_uriage_ave . "</div></div>";
                                                // 全期間店舗(免税外)売上点数合計とその平均値のHTML作成
                                                    $past_temp1_shop_sum2 = "";
                                                    if($past_shop_sum_number <> 0 && $past_shop_sum_number <> ""){
                                                        $past_shop_sum_number_c = number_format((int)$past_shop_sum_number); 
                                                        $past_shop_sum_number_ave = number_format(floor((int)$past_shop_sum_number / $past_i));
                                                        $past_shop_sum_number_ave2 = floor((int)$past_shop_sum_number / $past_i);
                                                    } else {
                                                        $past_shop_sum_number_c = $past_shop_sum_number; 
                                                        $past_shop_sum_number_ave = 0;
                                                        $past_shop_sum_number_ave2 = 0;
                                                    }
                                                    //$past_temp1_shop_sum2 = "<div class='title4 ta_r'>" . number_format((int)$past_shop_sum_number) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$past_shop_sum_number / $past_i)) . "</div></div>";
                                                    $past_temp1_shop_sum2 = "<div class='title4 ta_r'>" . $past_shop_sum_number_c . "</div><div class='title4 ta_r'>" . $past_shop_sum_number_ave . "</div></div>";
                                                // 全期間店舗(免税外)粗利合計とその平均値のHTML作成
                                                    $past_temp1_shop_sum3 = "";
                                                    if($past_shop_sum_arari <> 0 && $past_shop_sum_arari <> ""){
                                                        $past_shop_sum_arari_c = number_format((int)$past_shop_sum_arari); 
                                                        $past_shop_sum_arari_ave = number_format(floor((int)$past_shop_sum_arari / $past_i));
                                                        $past_shop_sum_arari_ave2 = floor((int)$past_shop_sum_arari / $past_i);
                                                    } else {
                                                        $past_shop_sum_arari_c = $past_shop_sum_arari; 
                                                        $past_shop_sum_arari_ave = 0;
                                                        $past_shop_sum_arari_ave2 = 0;
                                                    }
                                                    //$past_temp1_shop_sum3 = "<div class='title4 ta_r'>" . number_format((int)$past_shop_sum_arari) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$past_shop_sum_arari / $past_i)) . "</div></div>";
                                                    $past_temp1_shop_sum3 = "<div class='title4 ta_r'>" . $past_shop_sum_arari_c . "</div><div class='title4 ta_r'>" . $past_shop_sum_arari_ave . "</div></div>";
                                    }

     

                            /************************************************************************************************************************************************************************************************************* */
                                // 店舗・通販(免税)（過去の期間）
                            /************************************************************************************************************************************************************************************************************* */
                                                if($out1_c == "ON"){
                                                        // DB検索（店舗・通販(免税)）スタート
                                                            $past_oroshi_buys = DB::table($table_name) 
                                                            // 月毎にグループ化して値を分けるための処理
                                                                ->select([
                                                                    \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS oroshi_month'),
                                                                    \DB::raw("SUM(uriagekingaku) AS oroshi_uriage"),
                                                                    \DB::raw("SUM(uriagesuu) AS oroshi_number"),
                                                                    \DB::raw("SUM(ararikingaku) AS oroshi_arari"),
                                                                ])
                                                                ->groupBy('oroshi_month')
                                                            // 条件（売上部門が店舗・通販(免税)）
                                                                //->where('baikyakukubun',3)
                                                                    // 店舗と通販を取得
                                                                    // 「baikyakukubun」が「1」or「2」の場合
                                                                    ->where(function ($query){
                                                                        $query->orwhere('baikyakukubun', 1)->orwhere('baikyakukubun', 2);
                                                                    })
                                                                
                                                            // 条件（期間の指定）
                                                                ->whereBetween($table_name . '.uriage', [$past_between_start, $past_between_end])
                                                            // 条件（分類名）
                                                                ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                						// 条件（商品区分分類名が新品）
                                                							if($out2_a == "ON"){
                                                								$query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                							}
                                                						// 条件（商品区分分類名が中古）
                                                							if($out2_b == "ON"){
                                                								$query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                							}
                                                						// 条件（商品区分分類名がアンティーク）
                                                							if($out2_c == "ON"){
                                                								$query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                							}
                                                						// 条件（商品区分分類名がその他）
                                                							if($out2_d == "ON"){
                                                								$query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                							}
                                                						// 条件（商品区分分類名が修理）
                                                							if($out2_e == "ON"){
                                                								$query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                							}
                                                                
                                                                })
                                                            // 条件（通販区分）
                                                                ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                
                                                                        $query->orWhere('tsuuhankubun','');
                                                
                                                						// 条件（通販区分が自社）
                                                							if($out3_a == "ON"){
                                                								$query->orWhere('tsuuhankubun',1);
                                                							}
                                                						// 条件（通販区分が楽天）
                                                							if($out3_b == "ON"){
                                                								$query->orWhere('tsuuhankubun',2);
                                                							}
                                                						// 条件（通販区分がヤフー）
                                                							if($out3_c == "ON"){
                                                								$query->orWhere('tsuuhankubun',3);
                                                							}
                                                						// 条件（通販区分が電話・雑誌）
                                                							if($out3_d == "ON"){
                                                								$query->orWhere('tsuuhankubun',5);
                                                							}
                                                						// 条件（通販区分がYオークション）
                                                							if($out3_e == "ON"){
                                                								$query->orWhere('tsuuhankubun',4);
                                                							}
                                                						// 条件（通販区分が修理品返送）
                                                							if($out3_f == "ON"){
                                                								$query->orWhere('tsuuhankubun',9);
                                                							}
                                                                
                                                                })
                                                            // 条件（免税）
                                                                ->where("menzei","like","%免税%")
                                                                                
                                                            // 条件（扱い部門）
                                                                ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {
                                                
                                                                        $query->orWhere('bumonmei','');
                                                
                                                						// 条件（扱い部門がジャック）
                                                							if($out5_a == "ON"){
                                                								$query->orWhere('bumonmei','Jackroad');
                                                							}
                                                						// 条件（扱い部門がベティー）
                                                							if($out5_b == "ON"){
                                                								$query->orWhere('bumonmei','BettyRoad');
                                                							}
                                                						// 条件（扱い部門がジュエリー）
                                                							if($out5_c == "ON"){
                                                								$query->orWhere('bumonmei','Jewelry');
                                                							}
                                                              
                                                                })
                                                            // ソート順指定
                                                                ->orderBy('uriage', 'asc')
                                                                ->get();
                                                
                                                        // クエリビルダスタート
                                                            // 以下の変数は月数フラグとして後のロジックで使用するが、フォームにて「免税のみ」を選択した場合「店舗・通販(免税)」は全月一つも無いので、上でロジックが止まってしまい月数カウントの変数も0のままとなる。「店舗・通販(免税)」のみ独立した変数名として、カウント用は店舗用で対応
                                                            $past_i2 = 0;
                                                            // 変数リセット
                                                                $past_oroshi_sum_uriage = 0;
                                                                $past_oroshi_sum_number = 0;
                                                                $past_oroshi_sum_arari= 0;
                                                                foreach ($past_oroshi_buys as $past_oroshi_buy) {
                                                                    // 各月名
                                                                        $past_oroshi_month[$past_i2]= $past_oroshi_buy->oroshi_month;
                                                                    // 各月店舗・通販(免税)売上
                                                                        $past_oroshi_uriage[$past_i2]= $past_oroshi_buy->oroshi_uriage;
                                                                        // 全過去期間に現在の期間が含まれている場合
                                                                            if(strpos($past_temp1_oroshi_manthly_data, $past_oroshi_month[$past_i2] ) !== false){
                                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                                    $past_temp1_oroshi_manthly_data = str_replace($past_oroshi_month[$past_i2], $past_oroshi_uriage[$past_i2], $past_temp1_oroshi_manthly_data);
                                                                            }
                                                                    // 全期間店舗・通販(免税)売上合計
                                                                        $past_oroshi_sum_uriage = (int)$past_oroshi_sum_uriage + (int)$past_oroshi_uriage[$past_i2];
                                                                    // 各月店舗・通販(免税)点数
                                                                        $past_oroshi_number[$past_i2]= $past_oroshi_buy->oroshi_number;
                                                                        // 全過去期間に現在の期間が含まれている場合
                                                                            if(strpos($past_temp1_oroshi_manthly_data2, $past_oroshi_month[$past_i2] ) !== false){
                                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                                    $past_temp1_oroshi_manthly_data2 = str_replace($past_oroshi_month[$past_i2], $past_oroshi_number[$past_i2], $past_temp1_oroshi_manthly_data2);
                                                                            }
                                                                    // 全期間店舗・通販(免税)点数合計
                                                                        $past_oroshi_sum_number = (int)$past_oroshi_sum_number + (int)$past_oroshi_number[$past_i2];
                                                                    
                                                                    // 各月店舗・通販(免税)粗利
                                                                        $past_oroshi_arari[$past_i2]= $past_oroshi_buy->oroshi_arari;
                                                                        // 全過去期間に現在の期間が含まれている場合
                                                                            if(strpos($past_temp1_oroshi_manthly_data3, $past_oroshi_month[$past_i2] ) !== false){
                                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                                    $past_temp1_oroshi_manthly_data3 = str_replace($past_oroshi_month[$past_i2], $past_oroshi_arari[$past_i2], $past_temp1_oroshi_manthly_data3);
                                                                            }
                                                                    // 全期間店舗・通販(免税)粗利合計
                                                                        $past_oroshi_sum_arari = (int)$past_oroshi_sum_arari + (int)$past_oroshi_arari[$past_i2];
                                                                        
                                                                        $past_i2++;
                                                                }
                                                            // 全期間店舗・通販(免税)売上合計とその平均値のHTML作成
                                                                $past_temp1_oroshi_sum = "";
                                                                if($past_oroshi_sum_uriage <> 0 && $past_oroshi_sum_uriage <> ""){
                                                                    $past_oroshi_sum_uriage_c = number_format((int)$past_oroshi_sum_uriage); 
                                                                    $past_oroshi_sum_uriage_ave = number_format(floor((int)$past_oroshi_sum_uriage / $past_i2));
                                                                    $past_oroshi_sum_uriage_ave2 = floor((int)$past_oroshi_sum_uriage / $past_i);
                                                                } else {
                                                                    $past_oroshi_sum_uriage_c = $past_oroshi_sum_uriage; 
                                                                    $past_oroshi_sum_uriage_ave = 0;
                                                                    $past_oroshi_sum_uriage_ave2 = 0;
                                                                }
                                                                //$past_temp1_oroshi_sum .= "<div class='title4 ta_r'>" . number_format((int)$past_oroshi_sum_uriage) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$past_oroshi_sum_uriage / $past_i2)) . "</div></div>";
                                                                $past_temp1_oroshi_sum .= "<div class='title4 ta_r'>" . $past_oroshi_sum_uriage_c . "</div><div class='title4 ta_r'>" . $past_oroshi_sum_uriage_ave . "</div></div>";
                                                            // 全期間店舗・通販(免税)売上点数合計とその平均値のHTML作成
                                                                $past_temp1_oroshi_sum2 = "";
                                                                if($past_oroshi_sum_number <> 0 && $past_oroshi_sum_number <> ""){
                                                                    $past_oroshi_sum_number_c = number_format((int)$past_oroshi_sum_number); 
                                                                    $past_oroshi_sum_number_ave = number_format(floor((int)$past_oroshi_sum_number / $past_i2));
                                                                    $past_oroshi_sum_number_ave2 = floor((int)$past_oroshi_sum_number / $past_i);
                                                                } else {
                                                                    $past_oroshi_sum_number_c = $past_oroshi_sum_number; 
                                                                    $past_oroshi_sum_number_ave = 0;
                                                                    $past_oroshi_sum_number_ave2 = 0;
                                                                }
                                                                //$past_temp1_oroshi_sum2 = "<div class='title4 ta_r'>" . number_format((int)$past_oroshi_sum_number) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$past_oroshi_sum_number / $past_i2)) . "</div></div>";
                                                                $past_temp1_oroshi_sum2 = "<div class='title4 ta_r'>" . $past_oroshi_sum_number_c . "</div><div class='title4 ta_r'>" . $past_oroshi_sum_number_ave . "</div></div>";
                                                            // 全期間店舗・通販(免税)粗利合計とその平均値のHTML作成
                                                                $past_temp1_oroshi_sum3 = "";
                                                                if($past_oroshi_sum_arari <> 0 && $past_oroshi_sum_arari <> ""){
                                                                    $past_oroshi_sum_arari_c = number_format((int)$past_oroshi_sum_arari); 
                                                                    $past_oroshi_sum_arari_ave = number_format(floor((int)$past_oroshi_sum_arari / $past_i2));
                                                                    $past_oroshi_sum_arari_ave2 = floor((int)$past_oroshi_sum_arari / $past_i);
                                                                } else {
                                                                    $past_oroshi_sum_arari_c = $past_oroshi_sum_arari; 
                                                                    $past_oroshi_sum_arari_ave = 0;
                                                                    $past_oroshi_sum_arari_ave2 = 0;
                                                                }
                                                                //$past_temp1_oroshi_sum3 = "<div class='title4 ta_r'>" . number_format((int)$past_oroshi_sum_arari) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$past_oroshi_sum_arari / $past_i2)) . "</div></div>";
                                                                $past_temp1_oroshi_sum3 = "<div class='title4 ta_r'>" . $past_oroshi_sum_arari_c . "</div><div class='title4 ta_r'>" . $past_oroshi_sum_arari_ave . "</div></div>";
                                                }

                                            
                            /************************************************************************************************************************************************************************************************************* */
                                // 全件用
                            /************************************************************************************************************************************************************************************************************* */

                                        // 各月の全部門売上合計の先頭（1列目）部分のタイトルHTML
                                            //$past_all_sum_uriage = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $past_all_sum_number = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                        // 各月のタイトル表示用HTMLを作成
                                            $js_month = "";
                                            foreach($manth_now_array as $val){
                                                // JSグラフ用
                                                    $js_month .= "'" . $val . "(" . date("Y-m", strtotime($val. " -" . ($diff_month + 1) . " month")) . ")'" . ",";
                                            }
                                            $past_temp1_title2 = "";
                                            $past_temp1_title3 = "";
                                            $past_temp1_title4 = "";
                                            $past_temp1_title5 = "";
                                            foreach($manth_past_array as $val){
                                                // 表示用
                                                    $val = mb_substr($val,0,-3);
                                                    $past_temp1_title2 .= "<div class='title2 ta_c'>" . $val . "</div>";
                                                    $past_temp1_title3 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                                    $past_temp1_title4 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                                    $past_temp1_title5 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                            }
                                
                                            $past_temp1_title = "<div class='wid100 ul2'><div class='title5 ta_c'>" . $past_between_start_view. "～<br>" .$past_between_end_view . "</div>" .$past_temp1_title2 ."<div class='title6 ta_c'>累計</div><div class='title6 ta_c'>平均</div></div>";
                                            $past_temp1_title3 = "<div class='wid100 ul2'><div class='title7 ta_c'>" . $past_between_start_view. "～<br>" .$past_between_end_view . "</div>" .$past_temp1_title3 ."<div class='title7 ta_c'>平均</div></div>";
                                            $past_temp1_title4 = "<div class='wid100 ul2 bg_green'><div class='title7 ta_c'>" . $past_between_start_view. "～<br>" .$past_between_end_view . "</div>" .$past_temp1_title4 ."<div class='title7 ta_c'>平均</div></div>";
                                            $past_temp1_title5 = "<div class='wid100 ul2 bg_yellow'><div class='title7 ta_c'>" . $past_between_start_view. "～<br>" .$past_between_end_view . "</div>" .$past_temp1_title5 ."<div class='title7 ta_c'>平均</div></div>";
                                        
                                     
                                        
                                        // 全期間の全部門売上合計用変数リセット
                                            $past_all_sum_uriage_all = 0;
                                            $past_all_sum_number_all = 0;
                                            $past_all_sum_arari_all = 0;
                                            for($past_all_i = 0; $past_all_i < $past_i; $past_all_i++){
                                                // 各月の全部門売上合計用変数リセット
                                                    $past_all_month_uriage = 0;
                                                    $past_all_month_number= 0;
                                                    $past_all_month_arari= 0;
                                                // 各月の全部門売上合計をHTMLへ
                                                    if($out1_b == "ON"){ 
                                                        if(isset($past_web_uriage[$past_all_i])){$past_all_month_uriage = $past_all_month_uriage + (int)$past_web_uriage[$past_all_i];}
                                                        if(isset($past_web_number[$past_all_i])){$past_all_month_number = $past_all_month_number + (int)$past_web_number[$past_all_i]; }
                                                        if(isset($past_web_arari[$past_all_i])){$past_all_month_arari = $past_all_month_arari + (int)$past_web_arari[$past_all_i]; }
                                                    }
                                                    if($out1_a == "ON"){ 
                                                        if(isset($past_shop_uriage[$past_all_i])){$past_all_month_uriage = $past_all_month_uriage + (int)$past_shop_uriage[$past_all_i]; }
                                                        if(isset($past_shop_number[$past_all_i])){$past_all_month_number = $past_all_month_number + (int)$past_shop_number[$past_all_i];} 
                                                        if(isset($past_shop_arari[$past_all_i])){$past_all_month_arari = $past_all_month_arari + (int)$past_shop_arari[$past_all_i]; }
                                                    }
                                                    
                                                    
                                                    
                                                if($out1_c == "ON"){ 
                                                    // フォーム上の選択が「免税」のみだと「店舗・通販(免税)」は全月0なので「店舗・通販(免税)」を含む足し算だとエラーとなるため、条件分岐で回避
                                                        if($out4_a == "OFF" && $out4_b == "ON"){
                                                            $past_all_month_uriage = $past_all_month_uriage; 
                                                            $past_all_month_number = $past_all_month_number; 
                                                            $past_all_month_arari = $past_all_month_arari; 
                                                        } else {
                                                            if(isset($past_oroshi_uriage[$past_all_i])){ $past_all_month_uriage = $past_all_month_uriage + (int)$past_oroshi_uriage[$past_all_i]; }
                                                            if(isset($past_oroshi_number[$past_all_i])){ $past_all_month_number = $past_all_month_number + (int)$past_oroshi_number[$past_all_i]; }
                                                            if(isset($past_oroshi_arari[$past_all_i])){ $past_all_month_arari = $past_all_month_arari + (int)$past_oroshi_arari[$past_all_i]; }
                                                        }
}

                                                // 全期間の全部門売上合計
                                                    $past_all_sum_uriage_all = (int)$past_all_sum_uriage_all + (int)$past_all_month_uriage;
                                                    $past_all_sum_number_all = (int)$past_all_sum_number_all + (int)$past_all_month_number;
                                                    $past_all_sum_arari_all = (int)$past_all_sum_arari_all + (int)$past_all_month_arari;
                                                
                                            }



                            /************************************************************************************************************************************************************************************************************* */
                                // 最終ソース出力
                            /************************************************************************************************************************************************************************************************************* */
                                        


                                        // 通販(免税外)（過去）用HTMLの作成
                                                $past_js_web_uriage  = "";
                                                $past_js_web_number  = "";
                                                $past_js_web_arari  = "";
                                                $past_temp1_web_manthly_html = "";
                                                $past_temp1_web_manthly_html2 = "";
                                                $past_temp1_web_manthly_html3 = "";
                                                if($out1_b == "ON"){     
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_past_array as $val){
                                                                $val = mb_substr($val,0,-3);
                                                                if(strpos($past_temp1_web_manthly_data, $val ) !== false){
                                                                    $past_temp1_web_manthly_data = str_replace($val, 0, $past_temp1_web_manthly_data);
                                                                }
                                                                if(strpos($past_temp1_web_manthly_data2, $val ) !== false){
                                                                    $past_temp1_web_manthly_data2 = str_replace($val, 0, $past_temp1_web_manthly_data2);
                                                                }
                                                                if(strpos($past_temp1_web_manthly_data3, $val ) !== false){
                                                                    $past_temp1_web_manthly_data3 = str_replace($val, 0, $past_temp1_web_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $past_temp1_web_manthly_array = explode(',',$past_temp1_web_manthly_data);
                                                        $past_temp1_web_manthly_array2 = explode(',',$past_temp1_web_manthly_data2);
                                                        $past_temp1_web_manthly_array3 = explode(',',$past_temp1_web_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        $past_web_last_uriage = "";

                                                        foreach($past_temp1_web_manthly_array as $val){
                                                            // 【進捗率の取得】最終月の「過去・通販・売上」を取得
                                                                //$past_web_last_uriage = $val;
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $past_js_web_uriage  .= "0, ";
                                                                // 表示用
                                                                    $past_temp1_web_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $past_js_web_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $past_temp1_web_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }

                                                        }
                                                        foreach($past_temp1_web_manthly_array2 as $val){
                                                            // 【進捗率の取得】最終月の「過去・通販・点数」を取得
                                                                //$past_web_last_number = $val;
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $past_js_web_number  .= "0, ";
                                                                // 表示用
                                                                    $past_temp1_web_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $past_js_web_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $past_temp1_web_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }

                                                        }
                                                        foreach($past_temp1_web_manthly_array3 as $val){
                                                            // 【進捗率の取得】最終月の「過去・通販・粗利」を取得
                                                                //$past_web_last_arari = $val;
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $past_js_web_arari  .= "0, ";
                                                                // 表示用
                                                                    $past_temp1_web_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $past_js_web_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $past_temp1_web_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }

                                                        }
                                                    // 全体HTMLの作成
                                                        if(isset($past_temp1_web_manthly_html) && isset($past_temp1_web_sum)){
                                                            $past_temp1_web_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>通販(免税外)</div>" . $past_temp1_web_manthly_html . $past_temp1_web_sum;
                                                        }
                                                        if(isset($past_temp1_web_manthly_html2) && isset($past_temp1_web_sum2)){
                                                            $past_temp1_web_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>通販(免税外)</div>" . $past_temp1_web_manthly_html2 . $past_temp1_web_sum2;
                                                        }
                                                        if(isset($past_temp1_web_manthly_html3) && isset($past_temp1_web_sum3)){
                                                            $past_temp1_web_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>通販(免税外)</div>" . $past_temp1_web_manthly_html3 . $past_temp1_web_sum3;
                                                        }
                                                }
                                
                            
                                        // 店舗(免税外)（過去）用HTMLの作成
                                                $past_js_shop_uriage  = "";
                                                $past_js_shop_number  = "";
                                                $past_js_shop_arari = "";
                                                $past_temp1_shop_manthly_html = "";
                                                $past_temp1_shop_manthly_html2 = "";
                                                $past_temp1_shop_manthly_html3 = "";
                                                if($out1_a == "ON"){     
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_past_array as $val){
                                                                $val = mb_substr($val,0,-3);
                                                                if(strpos($past_temp1_shop_manthly_data, $val ) !== false){
                                                                    $past_temp1_shop_manthly_data = str_replace($val, 0, $past_temp1_shop_manthly_data);
                                                                }
                                                                if(strpos($past_temp1_shop_manthly_data2, $val ) !== false){
                                                                    $past_temp1_shop_manthly_data2 = str_replace($val, 0, $past_temp1_shop_manthly_data2);
                                                                }
                                                                if(strpos($past_temp1_shop_manthly_data3, $val ) !== false){
                                                                    $past_temp1_shop_manthly_data3 = str_replace($val, 0, $past_temp1_shop_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $past_temp1_shop_manthly_array = explode(',',$past_temp1_shop_manthly_data);
                                                        $past_temp1_shop_manthly_array2 = explode(',',$past_temp1_shop_manthly_data2);
                                                        $past_temp1_shop_manthly_array3 = explode(',',$past_temp1_shop_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        foreach($past_temp1_shop_manthly_array as $val){
                                                            // 【進捗率の取得】最終月の「過去・店舗・売上」を取得
                                                                //$past_shop_last_uriage = $val;

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $past_js_shop_uriage  .= "0, ";
                                                                // 表示用
                                                                    $past_temp1_shop_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $past_js_shop_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $past_temp1_shop_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }

                                                        }
                                                        foreach($past_temp1_shop_manthly_array2 as $val){
                                                            // 【進捗率の取得】最終月の「過去・店舗・点数」を取得
                                                                //$past_shop_last_number = $val;
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $past_js_shop_number  .= "0, ";
                                                                // 表示用
                                                                    $past_temp1_shop_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $past_js_shop_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $past_temp1_shop_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }

                                                        }
                                                        foreach($past_temp1_shop_manthly_array3 as $val){
                                                            // 【進捗率の取得】最終月の「過去・店舗・粗利」を取得
                                                                //$past_shop_last_arari = $val;
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $past_js_shop_arari  .= "0, ";
                                                                // 表示用
                                                                    $past_temp1_shop_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $past_js_shop_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $past_temp1_shop_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }

                                                        }
                                                    // 全体HTMLの作成
                                                        if(isset($past_temp1_shop_manthly_html) && isset($past_temp1_shop_sum)){
                                                            $past_temp1_shop_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>店舗(免税外)</div>" . $past_temp1_shop_manthly_html . $past_temp1_shop_sum;
                                                        }
                                                        if(isset($past_temp1_shop_manthly_html2) && isset($past_temp1_shop_sum2)){
                                                            $past_temp1_shop_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>店舗(免税外)</div>" . $past_temp1_shop_manthly_html2 . $past_temp1_shop_sum2;
                                                        }
                                                        if(isset($past_temp1_shop_manthly_html3) && isset($past_temp1_shop_sum3)){
                                                            $past_temp1_shop_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>店舗(免税外)</div>" . $past_temp1_shop_manthly_html3 . $past_temp1_shop_sum3;
                                                        }
                                                }


                                                // 店舗・通販(免税)（過去）用HTMLの作成
                                                    $past_js_oroshi_uriage  = "";
                                                    $past_js_oroshi_number  = "";
                                                    $past_js_oroshi_arari  = "";
                                                    $past_temp1_oroshi_manthly_html = "";
                                                    $past_temp1_oroshi_manthly_html2 = "";
                                                    $past_temp1_oroshi_manthly_html3 = "";
                                                    if($out1_c == "ON"){     
                                                        // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                            foreach($manth_past_array as $val){
                                                                    $val = mb_substr($val,0,-3);
                                                                    if(strpos($past_temp1_oroshi_manthly_data, $val ) !== false){
                                                                        $past_temp1_oroshi_manthly_data = str_replace($val, 0, $past_temp1_oroshi_manthly_data);
                                                                    }
                                                                    if(strpos($past_temp1_oroshi_manthly_data2, $val ) !== false){
                                                                        $past_temp1_oroshi_manthly_data2 = str_replace($val, 0, $past_temp1_oroshi_manthly_data2);
                                                                    }
                                                                    if(strpos($past_temp1_oroshi_manthly_data3, $val ) !== false){
                                                                        $past_temp1_oroshi_manthly_data3 = str_replace($val, 0, $past_temp1_oroshi_manthly_data3);
                                                                    }
                                                            }
                                                        // 各月売上が記載された文字列を配列へ変換
                                                            $past_temp1_oroshi_manthly_array = explode(',',$past_temp1_oroshi_manthly_data);
                                                            $past_temp1_oroshi_manthly_array2 = explode(',',$past_temp1_oroshi_manthly_data2);
                                                            $past_temp1_oroshi_manthly_array3 = explode(',',$past_temp1_oroshi_manthly_data3);
                                                        // 各月のHTMLを作成
                                                            foreach($past_temp1_oroshi_manthly_array as $val){
                                                                // 【進捗率の取得】最終月の「過去・店舗・通販(免税)・売上」を取得
                                                                    //$past_oroshi_last_uriage = $val;
                                                                
                                                                if($val == ""){
                                                                    // 表示用
                                                                        $past_temp1_oroshi_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                                    // JSグラフ用
                                                                        $past_js_oroshi_uriage  .= "0, ";
                                                                } else {
                                                                    // 表示用
                                                                        if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                        $past_temp1_oroshi_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                                    // JSグラフ用
                                                                        $past_js_oroshi_uriage  .= $val . ", ";
                                                                }
                                                    
                                                            }
                                                            foreach($past_temp1_oroshi_manthly_array2 as $val){
                                                                // 【進捗率の取得】最終月の「過去・店舗・通販(免税)・点数」を取得
                                                                    //$past_oroshi_last_number = $val;
                                                    
                                                                if($val == ""){
                                                                    // 表示用
                                                                        $past_temp1_oroshi_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                                    // JSグラフ用
                                                                        $past_js_oroshi_number  .= "0, ";
                                                                } else {
                                                                    // 表示用
                                                                        if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                        $past_temp1_oroshi_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                                    // JSグラフ用
                                                                        $past_js_oroshi_number  .= $val . ", ";
                                                                }
                                                    
                                                            }
                                                            foreach($past_temp1_oroshi_manthly_array3 as $val){
                                                                // 【進捗率の取得】最終月の「過去・店舗・通販(免税)・粗利」を取得
                                                                    //$past_oroshi_last_arari = $val;
                                                                
                                                                if($val == ""){
                                                                    // 表示用
                                                                        $past_temp1_oroshi_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                                    // JSグラフ用
                                                                        $past_js_oroshi_arari  .= "0, ";
                                                                } else {
                                                                    // 表示用
                                                                        if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                        $past_temp1_oroshi_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                                    // JSグラフ用
                                                                        $past_js_oroshi_arari  .= $val . ", ";
                                                                }
                                                    
                                                            }
                                                        // 全体HTMLの作成
                                                            if(isset($past_temp1_oroshi_manthly_html) && isset($past_temp1_oroshi_sum)){
                                                                $past_temp1_oroshi_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>店舗・通販(免税)</div>" . $past_temp1_oroshi_manthly_html . $past_temp1_oroshi_sum;
                                                            }
                                                            if(isset($past_temp1_oroshi_manthly_html2) && isset($past_temp1_oroshi_sum2)){
                                                                $past_temp1_oroshi_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>店舗・通販(免税)</div>" . $past_temp1_oroshi_manthly_html2 . $past_temp1_oroshi_sum2;
                                                            }
                                                            if(isset($past_temp1_oroshi_manthly_html3) && isset($past_temp1_oroshi_sum3)){
                                                                $past_temp1_oroshi_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>店舗・通販(免税)</div>" . $past_temp1_oroshi_manthly_html3 . $past_temp1_oroshi_sum3;
                                                            }
                                                    }
                                                    
                                                    

                                        // 各月の全部門売上合計のJS表示用
                                                $js_past_all_month_uriage = "";
                                                $js_past_all_month_number = "";
                                                $js_past_all_month_arari = "";
                                                $i = 0;
                                                foreach($manth_past_array as $val){
                                                    $all_js = 0;
                                                    $all_js2 = 0;
                                                    $all_js3 = 0;
                                                    if($out1_a == "ON"){ $all_js = (int)$all_js + (int)$past_temp1_shop_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$past_temp1_shop_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$past_temp1_shop_manthly_array3[$i];}
                                                    if($out1_b == "ON"){ $all_js = (int)$all_js + (int)$past_temp1_web_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$past_temp1_web_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$past_temp1_web_manthly_array3[$i];}
                                                    if($out1_c == "ON"){ $all_js = (int)$all_js + (int)$past_temp1_oroshi_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$past_temp1_oroshi_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$past_temp1_oroshi_manthly_array3[$i];}

                                                    $js_past_all_month_uriage .= $all_js . ", ";
                                                    $js_past_all_month_number .= $all_js2 . ", ";
                                                    $js_past_all_month_arari .= $all_js3 . ", ";
                                                    
                                                    $i++;
                                                }
        



                                                // 過去・通(免税外)販・粗利率
                                                
                                                    $i = 0;
                                                    $past_web_ratio = "";
                                                    $past_web_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>通販粗利率(免税外)</div>";
                                                    $past_web_total = "";
                                                    $past_web_total_js = "";
                                                    $all_total = "";
                                                    $past_web_total_ratio = "";
                                                    foreach($past_temp1_web_manthly_array3 as $var){
                                                        if($var == 0){
                                                            $past_web_ratio = "---";
                                                            $past_web_total = $past_web_total;
                                                            if($past_temp1_web_manthly_array[$i] == 0){
                                                                $all_total = $all_total;
                                                            } else {
                                                                $all_total = (int)$all_total + (int)$past_temp1_web_manthly_array[$i];
                                                            }
                                                        } else {
                                                            if($past_temp1_web_manthly_array[$i] <> 0 && $var <> 0 && $past_temp1_web_manthly_array[$i] <> "" && $var <> ""){
                                                                $past_web_ratio = (floor(((float)$var / (float)$past_temp1_web_manthly_array[$i]) * 100 * 10)) / 10;
                                                            } else {
                                                                $past_web_ratio = "---";
                                                            }
                                                            $past_web_total = (int)$past_web_total + (int)$var;
                                                            if($past_temp1_web_manthly_array[$i] == 0){
                                                                $all_total = $all_total;
                                                            } else {
                                                                $all_total = (int)$all_total + (int)$past_temp1_web_manthly_array[$i];
                                                            }
                                                        }
                                                        ${"past_web_ratio_" .$i} = "";
                                                        ${"past_web_ratio_" .$i} = $past_web_ratio;
                                                
                                                        $past_web_total_js  .= (float)$past_web_ratio . ", ";
                                                        if($past_web_ratio <> "" && $past_web_ratio <> 0){$past_web_ratio = number_format((float)$past_web_ratio ,1);}
                                                        $past_web_sum_arari_per .= "<div class='title6 ta_r'>" . $past_web_ratio . "%</div>";
                                                
                                                        $i++;
                                                    }
                                                    // 通販用粗利率を取得
                                                        if($past_web_total <> 0 && $all_total <> 0 && $past_web_total <> "" && $all_total <> ""){
                                                            $past_web_total_ratio = number_format((floor(((int)$past_web_total / (int)$all_total) * 100 * 10)) / 10 ,1);
                                                        } else {
                                                            $past_web_total_ratio = "---";
                                                        }
                                                
                                                        $past_web_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_web_total_ratio . "%</div></div>";
                                                
                                                // 過去・店舗(免税外)・粗利率
                                                
                                                    $i = 0;
                                                    $past_shop_ratio = "";
                                                    $past_shop_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>店舗粗利率(免税外)</div>";
                                                    $past_shop_total = "";
                                                    $past_shop_total_js = "";
                                                    $past_all_total = "";
                                                    $past_shop_total_ratio = "";
                                                    foreach($past_temp1_shop_manthly_array3 as $var){
                                                        if($var == 0){
                                                            $past_shop_ratio = "---";
                                                            $past_shop_total = $past_shop_total;
                                                            if($past_temp1_shop_manthly_array[$i] == 0){
                                                                $past_all_total = $past_all_total;
                                                            } else {
                                                                $past_all_total = (int)$past_all_total + (int)$past_temp1_shop_manthly_array[$i];
                                                            }
                                                        } else {
                                                            if($var <> 0 && $past_temp1_shop_manthly_array[$i] <> 0 && $var <> "" && $past_temp1_shop_manthly_array[$i] <> ""){
                                                                $past_shop_ratio = (floor(((float)$var / (float)$past_temp1_shop_manthly_array[$i]) * 100 * 10)) / 10;
                                                            } else {
                                                                $past_shop_ratio = "---";
                                                            }
                                                            $past_shop_total = (int)$past_shop_total + (int)$var;
                                                            if($past_temp1_shop_manthly_array[$i] == 0){
                                                                $past_all_total = $past_all_total;
                                                            } else {
                                                                $past_all_total = (int)$past_all_total + (int)$past_temp1_shop_manthly_array[$i];
                                                            }
                                                        }
                                                        ${"past_shop_ratio_" .$i} = "";
                                                        ${"past_shop_ratio_" .$i} = $past_shop_ratio;
                                                        
                                                        $past_shop_total_js  .= (float)$past_shop_ratio . ", ";
                                                        $past_shop_sum_arari_per .= "<div class='title6 ta_r'>" . $past_shop_ratio . "%</div>";
                                                
                                                        $i++;
                                                    }
                                                    // 過去・店舗用粗利率を取得
                                                        if($past_shop_total <> 0 && $past_all_total <> 0 && $past_shop_total <> "" && $past_all_total <> ""){
                                                            $past_shop_total_ratio = number_format((floor(((float)$past_shop_total / (float)$past_all_total) * 100 * 10)) / 10 ,1);
                                                        } else {
                                                            $past_shop_total_ratio = "---";
                                                        }
                                                
                                                        $past_shop_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_shop_total_ratio . "%</div></div>";
                                                
                                                
                                                // 過去・店舗・通販(免税)・粗利率
                                                    $past_oroshi_total_js = "";
                                                
                                                    if($out1_c == "ON"){
                                                
                                                		    $i = 0;
                                                		    $past_oroshi_ratio = "";
                                                		    $past_oroshi_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>店舗・通販粗利率(免税)</div>";
                                                		    $past_oroshi_total = "";
                                                		    $past_all_total = "";
                                                		    $past_oroshi_total_ratio = "";
                                                		    foreach($past_temp1_oroshi_manthly_array3 as $var){
                                                		        if($var == 0){
                                                		            $past_oroshi_ratio = "---";
                                                		            $past_oroshi_total = $past_oroshi_total;
                                                		            if($past_temp1_oroshi_manthly_array[$i] == 0){
                                                		                $past_all_total = $past_all_total;
                                                		            } else {
                                                		                $past_all_total = (int)$past_all_total + (int)$past_temp1_oroshi_manthly_array[$i];
                                                		            }
                                                		        } else {
                                                                    if($var <> 0 && $past_temp1_oroshi_manthly_array[$i] <> 0 && $var <> "" && $past_temp1_oroshi_manthly_array[$i] <> ""){
                                                		                $past_oroshi_ratio = number_format((floor(((float)$var / (float)$past_temp1_oroshi_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                                    } else {
                                                		                $past_oroshi_ratio = "---";
                                                                    }
                                                		            $past_oroshi_total = (int)$past_oroshi_total + (int)$var;
                                                		            if($past_temp1_oroshi_manthly_array[$i] == 0){
                                                		                $past_all_total = $past_all_total;
                                                		            } else {
                                                		                $past_all_total = (int)$past_all_total + (int)$past_temp1_oroshi_manthly_array[$i];
                                                		            }
                                                		        }
                                                                ${"past_oroshi_ratio_" .$i} = "";
                                                                ${"past_oroshi_ratio_" .$i} = $past_oroshi_ratio;
                                                                        
                                                                $past_oroshi_total_js  .= (float)$past_oroshi_ratio . ", ";
                                                		        $past_oroshi_sum_arari_per .= "<div class='title6 ta_r'>" . $past_oroshi_ratio . "%</div>";
                                                
                                                		        $i++;
                                                		    }
                                                		    // 過去・店舗用粗利率を取得
                                                                if($past_oroshi_total == 0 || $past_oroshi_total == "" || $past_all_total == 0 || $past_all_total == ""){
                                                		            $past_oroshi_total_ratio = "---";
                                                                } else {
                                                		            $past_oroshi_total_ratio = number_format((floor(((int)$past_oroshi_total / (int)$past_all_total) * 100 * 10)) / 10 ,1);
                                                                }
                                                
                                                		        $past_oroshi_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_oroshi_total_ratio . "%</div></div>";
                                                    }







                                        // 各月の全部門売上合計の先頭（1列目）部分のタイトルHTML
                                            $past_all_sum_uriage = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $past_all_sum_number = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $past_all_sum_arari = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $past_all_sum_arari_per = "<div class='wid100 ul3'><div class='title5 ta_c'>粗利率(平均)</div>";

                                        // 各月の全部門売上合計を配列に代入
                                            $past_temp1_all_m_sum_uriage_array = array();
                                            $past_temp1_all_m_sum_number_array = array();
                                            $past_temp1_all_m_sum_arari_array = array();
                                            $i = 0;
                                            foreach($manth_past_array as $val){
                                                $all = "";
                                                $all2 = "";
                                                $all3 = "";
                                                if($out1_a == "ON"){ $all = (int)$all + (int)$past_temp1_shop_manthly_array[$i]; $all2 = (int)$all2 + (int)$past_temp1_shop_manthly_array2[$i]; $all3 = (int)$all3 + (int)$past_temp1_shop_manthly_array3[$i];}
                                                if($out1_b == "ON"){ $all = (int)$all + (int)$past_temp1_web_manthly_array[$i]; $all2 = (int)$all2 + (int)$past_temp1_web_manthly_array2[$i]; $all3 = (int)$all3 + (int)$past_temp1_web_manthly_array3[$i];}
                                                if($out1_c == "ON"){ $all = (int)$all + (int)$past_temp1_oroshi_manthly_array[$i]; $all2 = (int)$all2 + (int)$past_temp1_oroshi_manthly_array2[$i]; $all3 = (int)$all3 + (int)$past_temp1_oroshi_manthly_array3[$i];}
                                                array_push($past_temp1_all_m_sum_uriage_array,$all);
                                                array_push($past_temp1_all_m_sum_number_array,$all2);
                                                array_push($past_temp1_all_m_sum_arari_array,$all3);

                                                $i++;
                                            }
                                        // 各月の全部門売上合計部分のHTML作成
                                            foreach($past_temp1_all_m_sum_uriage_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $past_all_sum_uriage .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $past_all_sum_uriage .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                            }
                                        // 各月の全部門売上点数合計部分のHTML作成
                                            foreach($past_temp1_all_m_sum_number_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $past_all_sum_number .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $past_all_sum_number .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                            }
                                        // 各月の全部門粗利合計部分のHTML作成
                                            $i = 0;
                                            $past_arari_ratio = "";
                                            $past_all_arari_total = "";
                                            foreach($past_temp1_all_m_sum_arari_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $past_all_sum_arari .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $past_all_sum_arari .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                                // 各月の粗利率を取得
                                                    if($past_temp1_all_m_sum_uriage_array[$i] == 0){
                                                        $past_arari_ratio = "---";
                                                    } else {
                                                        $past_arari_ratio = number_format((floor(((int)$var / (int)$past_temp1_all_m_sum_uriage_array[$i]) * 100 * 10)) / 10 ,1);
                                                    }
                                                    // 過去・粗利・縦軸合計
                                                        $past_all_sum_arari_per .= "<div class='title6 ta_r'>" . $past_arari_ratio . "%</div>";
                                                    // 過去・通販・店舗・店舗・通販(免税)・合計粗利率（JSグラフ用） 
                                                        $past_all_arari_total .= (float)$past_arari_ratio . ", ";
                                                    // 過去・現在の粗利率合計差の計算に使用
                                                        ${"past_arari_ratio_" . $i} = $past_arari_ratio;
                                                        
                                                $i++;
                                            }



                                                  
                                        // 全期間全部門売上合計とその平均値のHTML作成
                                            if($past_all_sum_uriage_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更
                                                    //$past_all_average = floor((int)$past_all_sum_uriage_all / $past_i);
                                                    if($out1_c == "ON"){
                                                        $past_all_average = (int)$past_web_sum_uriage_ave2 + (int)$past_shop_sum_uriage_ave2 + (int)$past_oroshi_sum_uriage_ave2;
                                                    } else {
                                                        $past_all_average = (int)$past_web_sum_uriage_ave2 + (int)$past_shop_sum_uriage_ave2;
                                                    }
                                            } else {
                                                $past_all_average = 0;
                                            }
                                            $past_all_sum_uriage .= "<div class='title6 ta_r'>" . number_format((int)$past_all_sum_uriage_all) . "</div><div class='title6 ta_r'>" . number_format((int)$past_all_average) . "</div></div>";
                                        // 全HTMLを合体（検索対象外は除く）
                                            $view = "";
                                            if($out1_a == "ON"){ $view .= $past_temp1_shop_manthly_html;}
                                            if($out1_b == "ON"){ $view .= $past_temp1_web_manthly_html;}
                                            if($out1_c == "ON"){ $view .= $past_temp1_oroshi_manthly_html;}
                                            //$view_title1 = "（免税以外）";
                                            $view_title1 = "";
                                            $past_temp1_all_sorce = "<p class='title_a'>金額（過去）" . $view_title1 . "</p><div class='box1'>" . $past_temp1_title . $view . $past_all_sum_uriage . "</div>";

                                        // 全期間全部門売上点数合計とその平均値のHTML作成
                                            if($past_all_sum_number_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更
                                                    //$past_all_average2 = floor((int)$past_all_sum_number_all / $past_i);
                                                    if($out1_c == "ON"){
                                                        $past_all_average2 = (int)$past_web_sum_number_ave2 + (int)$past_shop_sum_number_ave2 + (int)$past_oroshi_sum_number_ave2;
                                                    } else {
                                                        $past_all_average2 = (int)$past_web_sum_number_ave2 + (int)$past_shop_sum_number_ave2;
                                                    }
                                            } else {
                                                $past_all_average2 = 0;
                                            }
                                            $past_all_sum_number .= "<div class='title6 ta_r'>" . number_format((int)$past_all_sum_number_all) . "</div><div class='title6 ta_r'>" . number_format((int)$past_all_average2) . "</div></div>";
                                        // 全HTMLを合体（検索対象外は除く）
                                            $view2 = "";
                                            if($out1_a == "ON"){ $view2 .= $past_temp1_shop_manthly_html2;}
                                            if($out1_b == "ON"){ $view2 .= $past_temp1_web_manthly_html2;}
                                            if($out1_c == "ON"){ $view2 .= $past_temp1_oroshi_manthly_html2;}
                                            $past_temp1_all_sorce2 = "<p class='title_a'>点数（過去）" . $view_title1 . "</p><div class='box1'>" . $past_temp1_title . $view2 . $past_all_sum_number . "</div>";

                                        // 全期間全部門粗利合計とその平均値のHTML作成
                                            if($past_all_sum_arari_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更
                                                    //$past_all_average3 = floor((int)$past_all_sum_arari_all / $past_i);
                                                    if($out1_c == "ON"){
                                                        $past_all_average3 = (int)$past_web_sum_arari_ave2 + (int)$past_shop_sum_arari_ave2 + (int)$past_oroshi_sum_arari_ave2;
                                                    } else {
                                                        $past_all_average3 = (int)$past_web_sum_arari_ave2 + (int)$past_shop_sum_arari_ave2;
                                                    }
                                            } else {
                                                $past_all_average3 = 0;
                                            }
                                            $past_all_sum_arari .= "<div class='title6 ta_r'>" . number_format((int)$past_all_sum_arari_all) . "</div><div class='title6 ta_r'>" . number_format((int)$past_all_average3) . "</div></div>";
                                            // 粗利率の平均
                                                if($past_all_sum_arari_all <> 0){ $past_all_average4 = number_format(floor(((int)$past_all_sum_arari_all / (int)$past_all_sum_uriage_all) * 100 * 10) / 10 ,1);} else {$past_all_average4 = 0;}
                                                $past_all_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $past_all_average4 . "%</div></div>";
                                        
                                        // 全HTMLを合体（検索対象外は除く）
                                            $view3 = "";
                                            if($out1_a == "ON"){ $view3 .= $past_temp1_shop_manthly_html3;}
                                            if($out1_b == "ON"){ $view3 .= $past_temp1_web_manthly_html3;}
                                            if($out1_c == "ON"){ $view3 .= $past_temp1_oroshi_manthly_html3;}
                                            $past_temp1_all_sorce3 = "<p class='title_a'>粗利（過去）" . $view_title1 . "</p><div class='box1'>" . $past_temp1_title . $view3 . $past_all_sum_arari . $past_shop_sum_arari_per . $past_web_sum_arari_per;
                                            if($out1_c == "ON"){$past_temp1_all_sorce3 .= $past_oroshi_sum_arari_per;}
                                            $past_temp1_all_sorce3 .= $past_all_sum_arari_per  . "</div>";
                    
                    
                    /************************************************************************************************************************************************************************************************************* */
                        // DB情報の受け取り（過去の期間）end
                    /************************************************************************************************************************************************************************************************************* */





                    /************************************************************************************************************************************************************************************************************* */
                        // DB情報の受け取り（検索期間）start
                    /************************************************************************************************************************************************************************************************************* */
                            $temp1_title2 = "";
                            $i = 0;

                            /************************************************************************************************************************************************************************************************************* */
                                // 通販用
                            /************************************************************************************************************************************************************************************************************* */
                                    if($out1_b == "ON"){
                                            // DB検索（通販値）スタート
                                                $web_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS web_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS web_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS web_number"),
                                                        \DB::raw("SUM(ararikingaku) AS web_arari"),
                                                    ])
                                                    ->groupBy('web_month')
                                                // 条件（売上部門が通販）
                                                    ->where('baikyakukubun',2)
                                                // 条件（期間の指定）
                                                    ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                // 条件（分類名）
                                                    ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
															// 条件（商品区分分類名が新品）
																if($out2_a == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%新品%");
																}
															// 条件（商品区分分類名が中古）
																if($out2_b == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%中古%");
																}
															// 条件（商品区分分類名がアンティーク）
																if($out2_c == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
																}
															// 条件（商品区分分類名がその他）
																if($out2_d == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%その他%");
																}
															// 条件（商品区分分類名が修理）
																if($out2_e == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%修理%");
																}
                                                    
                                                    })
                                                // 条件（通販区分）
                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                            $query->orWhere('tsuuhankubun','');

															// 条件（通販区分が自社）
																if($out3_a == "ON"){
																	$query->orWhere('tsuuhankubun',1);
																}
															// 条件（通販区分が楽天）
																if($out3_b == "ON"){
																	$query->orWhere('tsuuhankubun',2);
																}
															// 条件（通販区分がヤフー）
																if($out3_c == "ON"){
																	$query->orWhere('tsuuhankubun',3);
																}
															// 条件（通販区分が電話・雑誌）
																if($out3_d == "ON"){
																	$query->orWhere('tsuuhankubun',5);
																}
															// 条件（通販区分がYオークション）
																if($out3_e == "ON"){
																	$query->orWhere('tsuuhankubun',4);
																}
															// 条件（通販区分が修理品返送）
																if($out3_f == "ON"){
																	$query->orWhere('tsuuhankubun',9);
																}
                                                    
                                                    })
                                                
                                                // 条件（免税）
                                                    ->where("menzei","like","%対象外%")
                                                                    
                                                // 条件（扱い部門）
                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                            $query->orWhere('bumonmei','');

															// 条件（扱い部門がジャック）
																if($out5_a == "ON"){
																	$query->orWhere('bumonmei','Jackroad');
																}
															// 条件（扱い部門がベティー）
																if($out5_b == "ON"){
																	$query->orWhere('bumonmei','BettyRoad');
																}
															// 条件（扱い部門がジュエリー）
																if($out5_c == "ON"){
																	$query->orWhere('bumonmei','Jewelry');
																}
                                                  
                                                    })
                                                    
                                                // 条件（期間の指定）
                                                    ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                // ソート順指定
                                                    ->orderBy('uriage', 'asc')
                                                    ->get();

                                            // クエリビルダスタート
                                                $i = 0;
                                                // 変数リセット
                                                    $web_sum_uriage = "";
                                                    $web_sum_number = "";
                                                    $web_sum_arari = "";
                                                foreach ($web_buys as $web_buy) {
                                                    // 各月名
                                                        $web_month[$i]= $web_buy->web_month;
                                                    // 各月通販売上
                                                        $web_uriage[$i]= $web_buy->web_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp1_web_manthly_data, $web_month[$i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp1_web_manthly_data = str_replace($web_month[$i], $web_uriage[$i], $temp1_web_manthly_data);
                                                                }
                                                    // 全期間通販売上合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $web_sum_uriage_average = (int)$web_sum_uriage;
                                                            } else {
                                                                $web_sum_uriage_average = (int)$web_sum_uriage + (int)$web_uriage[$i];
                                                            }

                                                        $web_sum_uriage = (int)$web_sum_uriage + (int)$web_uriage[$i];
                                                    // 各月通販点数
                                                        $web_number[$i]= $web_buy->web_number;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp1_web_manthly_data2, $web_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp1_web_manthly_data2 = str_replace($web_month[$i], $web_number[$i], $temp1_web_manthly_data2);
                                                            }

                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $web_sum_number_average = (int)$web_sum_number;
                                                            } else {
                                                                $web_sum_number_average = (int)$web_sum_number + (int)$web_number[$i];
                                                            }
                                                        $web_sum_number = (int)$web_sum_number + (int)$web_number[$i];

                                                    // 各月通販粗利
                                                        $web_arari[$i]= $web_buy->web_arari;
                                                        // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp1_web_manthly_data3, $web_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp1_web_manthly_data3 = str_replace($web_month[$i], $web_arari[$i], $temp1_web_manthly_data3);
                                                            }
                                                    // 全期間通販点数合計
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                            if($last_nodata_flag == "ON"){
                                                                $web_sum_arari_average = (int)$web_sum_arari;
                                                            } else {
                                                                $web_sum_arari_average = (int)$web_sum_arari + (int)$web_arari[$i];
                                                            }
                                                        $web_sum_arari = (int)$web_sum_arari + (int)$web_arari[$i];

                                                    $i++;
                                                }

                                                // 全期間通販売上合計とその平均値のHTML作成
                                                    $temp1_web_sum = "";
                                                    if($web_sum_uriage <> 0 && $web_sum_uriage <> ""){
                                                        $web_sum_uriage_c = number_format((int)$web_sum_uriage);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象                                                        
                                                        //$web_sum_uriage_ave = number_format(floor((int)$web_sum_uriage/ $i));
                                                        //$web_sum_uriage_ave2 = floor((int)$web_sum_uriage/ $i);
                                                        if($last_nodata_flag == "ON"){
                                                            if($web_sum_uriage_average <> "" && $web_sum_uriage_average <> 0){$web_sum_uriage_ave = number_format(floor((int)$web_sum_uriage_average / ((int)$i -1)));} else {$web_sum_uriage_ave = "---";}
                                                            if($web_sum_uriage_average <> "" && $web_sum_uriage_average <> 0){$web_sum_uriage_ave2 = floor((int)$web_sum_uriage_average / ((int)$i -1));} else {$web_sum_uriage_ave2 = "---";}
                                                        } else {
                                                            $web_sum_uriage_ave = number_format(floor((int)$web_sum_uriage / $i));
                                                            $web_sum_uriage_ave2 = floor((int)$web_sum_uriage / $i);
                                                        }
                                                    } else {
                                                        $web_sum_uriage_c = $web_sum_uriage;
                                                        $web_sum_uriage_ave = 0;
                                                        $web_sum_uriage_ave2 = 0;
                                                    }
                                                    //$temp1_web_sum = "<div class='title4 ta_r'>" . $web_sum_uriage_c . "</div><div class='title4 ta_c'>" . $yoy_uriage . "</div><div class='title4 ta_r'>" . $web_sum_uriage_ave . "</div></div>";
                                                    $temp1_web_sum = "<div class='title4 ta_r'>" . $web_sum_uriage_c . "</div><div class='title4 ta_r'>" . $web_sum_uriage_ave . "</div></div>";
                                                // 全期間通販売上点数合計とその平均値のHTML作成
                                                    $temp1_web_sum2 = "";
                                                    if($web_sum_number <> 0 && $web_sum_number <> ""){
                                                        $web_sum_number_c = number_format((int)$web_sum_number);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        //$web_sum_number_ave = number_format(floor((int)$web_sum_number/ $i));
                                                        //$web_sum_number_ave2 = floor((int)$web_sum_number/ $i);
                                                        if($last_nodata_flag == "ON"){
                                                            if($web_sum_number_average <> "" && $web_sum_number_average <> 0){$web_sum_number_ave = number_format(floor((int)$web_sum_number_average / ((int)$i -1)));} else {$web_sum_number_ave = "---";}
                                                            if($web_sum_number_average <> "" && $web_sum_number_average <> 0){$web_sum_number_ave2 = floor((int)$web_sum_number_average / ((int)$i -1));} else {$web_sum_number_ave2 = "---";}
                                                        } else {
                                                            $web_sum_number_ave = number_format(floor((int)$web_sum_number / $i));
                                                            $web_sum_number_ave2 = floor((int)$web_sum_number / $i);
                                                        }
                                                    } else {
                                                        $web_sum_number_c = $web_sum_number;
                                                        $web_sum_number_ave = 0;
                                                        $web_sum_number_ave2 = 0;
                                                    }
                                                    //$temp1_web_sum2 = "<div class='title4 ta_r'>" . $web_sum_number_c . "</div><div class='title4 ta_c'>" . $yoy_number . "</div><div class='title4 ta_r'>" . $web_sum_number_ave . "</div></div>";
                                                    $temp1_web_sum2 = "<div class='title4 ta_r'>" . $web_sum_number_c . "</div><div class='title4 ta_r'>" . $web_sum_number_ave . "</div></div>";
                                                // 全期間通販粗利合計とその平均値のHTML作成
                                                    $temp1_web_sum3 = "";
                                                    if($web_sum_arari <> 0 && $web_sum_arari <> ""){
                                                        $web_sum_arari_c = number_format((int)$web_sum_arari);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        //$web_sum_arari_ave = number_format(floor((int)$web_sum_arari/ $i));
                                                        //$web_sum_arari_ave2 = floor((int)$web_sum_arari/ $i);
                                                        if($last_nodata_flag == "ON"){
                                                            if($web_sum_arari_average <> "" && $web_sum_arari_average <> 0){$web_sum_arari_ave = number_format(floor((int)$web_sum_arari_average / ((int)$i -1)));} else {$web_sum_arari_ave = "---";}
                                                            if($web_sum_arari_average <> "" && $web_sum_arari_average <> 0){$web_sum_arari_ave2 = floor((int)$web_sum_arari_average / ((int)$i -1));} else {$web_sum_arari_ave2 = "---";}
                                                        } else {
                                                            $web_sum_arari_ave = number_format(floor((int)$web_sum_arari / $i));
                                                            $web_sum_arari_ave2 = floor((int)$web_sum_arari / $i);
                                                        }
                                                    } else {
                                                        $web_sum_arari_c = $web_sum_arari;
                                                        $web_sum_arari_ave = 0;
                                                        $web_sum_arari_ave2 = 0;
                                                    }
                                                    //$temp1_web_sum3 = "<div class='title4 ta_r'>" . $web_sum_arari_c . "</div><div class='title4 ta_c'>" . $yoy_arari . "</div><div class='title4 ta_r'>" . $web_sum_arari_ave . "</div></div>";
                                                    $temp1_web_sum3 = "<div class='title4 ta_r'>" . $web_sum_arari_c . "</div><div class='title4 ta_r'>" . $web_sum_arari_ave . "</div></div>";
                                        }



                            /************************************************************************************************************************************************************************************************************* */
                                // 店舗用
                            /************************************************************************************************************************************************************************************************************* */
                                    if($out1_a == "ON"){
                                            // DB検索（店舗値）スタート
                                                $shop_buys = DB::table($table_name) 
                                                // 月毎にグループ化して値を分けるための処理
                                                    ->select([
                                                        \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS shop_month'),
                                                        \DB::raw("SUM(uriagekingaku) AS shop_uriage"),
                                                        \DB::raw("SUM(uriagesuu) AS shop_number"),
                                                        \DB::raw("SUM(ararikingaku) AS shop_arari"),
                                                    ])
                                                    ->groupBy('shop_month')
                                                // 条件（売上部門が店舗）
                                                    ->where('baikyakukubun',1)
                                                // 条件（期間の指定）
                                                    ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                // 条件（分類名）
                                                    ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
															// 条件（商品区分分類名が新品）
																if($out2_a == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%新品%");
																}
															// 条件（商品区分分類名が中古）
																if($out2_b == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%中古%");
																}
															// 条件（商品区分分類名がアンティーク）
																if($out2_c == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
																}
															// 条件（商品区分分類名がその他）
																if($out2_d == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%その他%");
																}
															// 条件（商品区分分類名が修理）
																if($out2_e == "ON"){
																	$query->orwhere("shouhinkubunbunruimei","like","%修理%");
																}
                                                    
                                                    })
                                                // 条件（通販区分）
                                                    ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {

                                                            $query->orWhere('tsuuhankubun','');

															// 条件（通販区分が自社）
																if($out3_a == "ON"){
																	$query->orWhere('tsuuhankubun',1);
																}
															// 条件（通販区分が楽天）
																if($out3_b == "ON"){
																	$query->orWhere('tsuuhankubun',2);
																}
															// 条件（通販区分がヤフー）
																if($out3_c == "ON"){
																	$query->orWhere('tsuuhankubun',3);
																}
															// 条件（通販区分が電話・雑誌）
																if($out3_d == "ON"){
																	$query->orWhere('tsuuhankubun',5);
																}
															// 条件（通販区分がYオークション）
																if($out3_e == "ON"){
																	$query->orWhere('tsuuhankubun',4);
																}
															// 条件（通販区分が修理品返送）
																if($out3_f == "ON"){
																	$query->orWhere('tsuuhankubun',9);
																}
                                                    
                                                    })
                                                
                                                // 条件（免税）
                                                    ->where("menzei","like","%対象外%")
                                                                    
                                                // 条件（扱い部門）
                                                    ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {

                                                            $query->orWhere('bumonmei','');

															// 条件（扱い部門がジャック）
																if($out5_a == "ON"){
																	$query->orWhere('bumonmei','Jackroad');
																}
															// 条件（扱い部門がベティー）
																if($out5_b == "ON"){
																	$query->orWhere('bumonmei','BettyRoad');
																}
															// 条件（扱い部門がジュエリー）
																if($out5_c == "ON"){
																	$query->orWhere('bumonmei','Jewelry');
																}
                                                  
                                                    })
                                                    
                                                // ソート順指定
                                                    ->orderBy('uriage', 'asc')
                                                    ->get();

                                            // クエリビルダスタート
                                                $i = 0;
                                                // 変数リセット
                                                    $shop_sum_uriage = "";
                                                    $shop_sum_number = "";
                                                    $shop_sum_arari = "";
                                                    foreach ($shop_buys as $shop_buy) {
                                                        // 各月名
                                                            $shop_month[$i]= $shop_buy->shop_month;
                                                        // 各月店舗売上
                                                            $shop_uriage[$i]= $shop_buy->shop_uriage;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                            if(strpos($temp1_shop_manthly_data, $shop_month[$i] ) !== false){
                                                                // 文字列の同期間名を現在月の売上に書き換え
                                                                    $temp1_shop_manthly_data = str_replace($shop_month[$i], $shop_uriage[$i], $temp1_shop_manthly_data);
                                                            }
                                                        // 全期間店舗売上合計
                                                            // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                                if($last_nodata_flag == "ON"){
                                                                    $shop_sum_uriage_average = (int)$shop_sum_uriage;
                                                                } else {
                                                                    $shop_sum_uriage_average = (int)$shop_sum_uriage + (int)$shop_uriage[$i];
                                                                }
                                                            $shop_sum_uriage = (int)$shop_sum_uriage + (int)$shop_uriage[$i];
                                                        // 各月店舗点数
                                                            $shop_number[$i]= $shop_buy->shop_number;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp1_shop_manthly_data2, $shop_month[$i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp1_shop_manthly_data2 = str_replace($shop_month[$i], $shop_number[$i], $temp1_shop_manthly_data2);
                                                                }
                                                        // 全期間店舗点数合計
                                                            // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                                if($last_nodata_flag == "ON"){
                                                                    $shop_sum_number_average = (int)$shop_sum_number;
                                                                } else {
                                                                    $shop_sum_number_average = (int)$shop_sum_number + (int)$shop_number[$i];
                                                                }
                                                            $shop_sum_number = (int)$shop_sum_number + (int)$shop_number[$i];
                                                            
                                                        // 各月店舗粗利
                                                            $shop_arari[$i]= $shop_buy->shop_arari;
                                                            // 全過去期間に現在の期間が含まれている場合
                                                                if(strpos($temp1_shop_manthly_data3, $shop_month[$i] ) !== false){
                                                                    // 文字列の同期間名を現在月の売上に書き換え
                                                                        $temp1_shop_manthly_data3 = str_replace($shop_month[$i], $shop_arari[$i], $temp1_shop_manthly_data3);
                                                                }
                                                        // 全期間店舗点数合計
                                                            // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                                if($last_nodata_flag == "ON"){
                                                                    $shop_sum_arari_average = (int)$shop_sum_arari;
                                                                } else {
                                                                    $shop_sum_arari_average = (int)$shop_sum_arari + (int)$shop_arari[$i];
                                                                }
                                                            $shop_sum_arari = (int)$shop_sum_arari + (int)$shop_arari[$i];
                                                            
                                                        $i++;
                                                    }


                                                // 全期間店舗売上合計とその平均値のHTML作成
                                                    $temp1_shop_sum = "";
                                                    if($shop_sum_uriage <> 0 && $shop_sum_uriage <> ""){
                                                        $shop_sum_uriage_c = number_format((int)$shop_sum_uriage);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        //$shop_sum_uriage_ave = number_format(floor((int)$shop_sum_uriage/ $i));
                                                        //$shop_sum_uriage_ave2 = floor((int)$shop_sum_uriage/ $i);
                                                        if($last_nodata_flag == "ON"){
                                                            if($shop_sum_uriage_average <> "" && $shop_sum_uriage_average <> 0){$shop_sum_uriage_ave = number_format(floor((int)$shop_sum_uriage_average / ((int)$i -1)));} else {$shop_sum_uriage_ave = "---";}
                                                            if($shop_sum_uriage_average <> "" && $shop_sum_uriage_average <> 0){$shop_sum_uriage_ave2 = floor((int)$shop_sum_uriage_average / ((int)$i -1));} else {$shop_sum_uriage_ave2 = "---";}
                                                        } else {
                                                            $shop_sum_uriage_ave = number_format(floor((int)$shop_sum_uriage / $i));
                                                            $shop_sum_uriage_ave2 = floor((int)$shop_sum_uriage / $i);
                                                        }
                                                    } else {
                                                        $shop_sum_uriage_c = $shop_sum_uriage;
                                                        $shop_sum_uriage_ave = 0;
                                                        $shop_sum_uriage_ave2 = 0;
                                                    }
                                                    //$temp1_shop_sum = "<div class='title4 ta_r'>" . $shop_sum_uriage_c . "</div><div class='title4 ta_c'>" . $yoy_uriage2 . "</div><div class='title4 ta_r'>" . $shop_sum_uriage_ave . "</div></div>";
                                                    $temp1_shop_sum = "<div class='title4 ta_r'>" . $shop_sum_uriage_c . "</div><div class='title4 ta_r'>" . $shop_sum_uriage_ave . "</div></div>";
                                                // 全期間店舗売上点数合計とその平均値のHTML作成
                                                    $temp1_shop_sum2 = "";
                                                    if($shop_sum_number <> 0 && $shop_sum_number <> ""){
                                                        $shop_sum_number_c = number_format((int)$shop_sum_number);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        //$shop_sum_number_ave = number_format(floor((int)$shop_sum_number/ $i));
                                                        //$shop_sum_number_ave2 = floor((int)$shop_sum_number/ $i);
                                                        if($last_nodata_flag == "ON"){
                                                            if($shop_sum_number_average <> "" && $shop_sum_number_average <> 0){$shop_sum_number_ave = number_format(floor((int)$shop_sum_number_average / ((int)$i -1)));} else {$shop_sum_number_ave = "---";}
                                                            if($shop_sum_number_average <> "" && $shop_sum_number_average <> 0){$shop_sum_number_ave2 = floor((int)$shop_sum_number_average / ((int)$i -1));} else {$shop_sum_number_ave2 = "---";}
                                                        } else {
                                                            $shop_sum_number_ave = number_format(floor((int)$shop_sum_number / $i));
                                                            $shop_sum_number_ave2 = floor((int)$shop_sum_number / $i);
                                                        }
                                                    } else {
                                                        $shop_sum_number_c = $shop_sum_number;
                                                        $shop_sum_number_ave = 0;
                                                        $shop_sum_number_ave2 = 0;
                                                    }
                                                    //$temp1_shop_sum2 = "<div class='title4 ta_r'>" . $shop_sum_number_c . "</div><div class='title4 ta_c'>" . $yoy_number2 . "</div><div class='title4 ta_r'>" . $shop_sum_number_ave . "</div></div>";
                                                    $temp1_shop_sum2 = "<div class='title4 ta_r'>" . $shop_sum_number_c . "</div><div class='title4 ta_r'>" . $shop_sum_number_ave . "</div></div>";
                                                // 全期間店舗粗利合計とその平均値のHTML作成
                                                    $temp1_shop_sum3 = "";
                                                    if($shop_sum_arari <> 0 && $shop_sum_arari <> ""){
                                                        $shop_sum_arari_c = number_format((int)$shop_sum_arari);
                                                        // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                        //$shop_sum_arari_ave = number_format(floor((int)$shop_sum_arari/ $i));
                                                        //$shop_sum_arari_ave2 = floor((int)$shop_sum_arari/ $i);
                                                        if($last_nodata_flag == "ON"){
                                                            if($shop_sum_arari_average <> "" && $shop_sum_arari_average <> 0){$shop_sum_arari_ave = number_format(floor((int)$shop_sum_arari_average / ((int)$i -1)));} else {$shop_sum_arari_ave = "---";}
                                                            if($shop_sum_arari_average <> "" && $shop_sum_arari_average <> 0){$shop_sum_arari_ave2 = floor((int)$shop_sum_arari_average / ((int)$i -1));} else {$shop_sum_arari_ave2 = "---";}
                                                        } else {
                                                            $shop_sum_arari_ave = number_format(floor((int)$shop_sum_arari / $i));
                                                            $shop_sum_arari_ave2 = floor((int)$shop_sum_arari / $i);
                                                        }
                                                    } else {
                                                        $shop_sum_arari_c = $shop_sum_arari;
                                                        $shop_sum_arari_ave = 0;
                                                        $shop_sum_arari_ave2 = 0;
                                                    }
                                                    //$temp1_shop_sum3 = "<div class='title4 ta_r'>" . $shop_sum_arari_c . "</div><div class='title4 ta_c'>" . $yoy_arari2 . "</div><div class='title4 ta_r'>" . $shop_sum_arari_ave . "</div></div>";
                                                    $temp1_shop_sum3 = "<div class='title4 ta_r'>" . $shop_sum_arari_c . "</div><div class='title4 ta_r'>" . $shop_sum_arari_ave . "</div></div>";
                                    }
                                                /************************************************************************************************************************************************************************************************************* */
                                                    // 店舗・通販(免税)用
                                                /************************************************************************************************************************************************************************************************************* */
                                                        if($out1_c == "ON"){
                                                                // DB検索（店舗・通販(免税)）スタート
                                                                    $oroshi_buys = DB::table($table_name) 
                                                                    // 月毎にグループ化して値を分けるための処理
                                                                        ->select([
                                                                            \DB::raw('DATE_FORMAT(uriage, "%Y-%m") AS oroshi_month'),
                                                                            \DB::raw("SUM(uriagekingaku) AS oroshi_uriage"),
                                                                            \DB::raw("SUM(uriagesuu) AS oroshi_number"),
                                                                            \DB::raw("SUM(ararikingaku) AS oroshi_arari"),
                                                                        ])
                                                                        ->groupBy('oroshi_month')
                                                                    // 条件（売上部門が店舗）
                                                                        //->where('baikyakukubun',3)
                                                                        /*->where(function ($query) use ($out1_d) {
                                                								if($out1_d == "ON"){
                                                                                    // 「店舗・通販(免税)」と空白（おそらく入力間違い分）を含む場合を取得（条件：「店舗」「通販」以外）
                                                                                        $query->Where([['baikyakukubun', '<>', 1], ['baikyakukubun', '<>', 2]]);
                                                                                } else {
                                                                                    // 「店舗・通販(免税)」のみを取得
                                                                                        $query->where('baikyakukubun',3);
                                                                                }
                                                                        })*/
                                                                    // 店舗と通販を取得
                                                                    // 「baikyakukubun」が「1」or「2」の場合
                                                                    ->where(function ($query){
                                                                        $query->orwhere('baikyakukubun', 1)->orwhere('baikyakukubun', 2);
                                                                    })
                                                                        
                                                                    // 条件（期間の指定）
                                                                        ->whereBetween($table_name . '.uriage', [$between_start, $between_end])
                                                                    // 条件（分類名）
                                                                        ->where(function ($query) use ($out2_a,$out2_b,$out2_c,$out2_d,$out2_e) {
                                                								// 条件（商品区分分類名が新品）
                                                									if($out2_a == "ON"){
                                                										$query->orwhere("shouhinkubunbunruimei","like","%新品%");
                                                									}
                                                								// 条件（商品区分分類名が中古）
                                                									if($out2_b == "ON"){
                                                										$query->orwhere("shouhinkubunbunruimei","like","%中古%");
                                                									}
                                                								// 条件（商品区分分類名がアンティーク）
                                                									if($out2_c == "ON"){
                                                										$query->orwhere("shouhinkubunbunruimei","like","%アンティーク%");
                                                									}
                                                								// 条件（商品区分分類名がその他）
                                                									if($out2_d == "ON"){
                                                										$query->orwhere("shouhinkubunbunruimei","like","%その他%");
                                                									}
                                                								// 条件（商品区分分類名が修理）
                                                									if($out2_e == "ON"){
                                                										$query->orwhere("shouhinkubunbunruimei","like","%修理%");
                                                									}
                                                                        
                                                                        })
                                                                    // 条件（通販区分）
                                                                        ->where(function ($query) use ($out3_a,$out3_b,$out3_c,$out3_d,$out3_e,$out3_f) {
                                                
                                                                                $query->orWhere('tsuuhankubun','');
                                                
                                                								// 条件（通販区分が自社）
                                                									if($out3_a == "ON"){
                                                										$query->orWhere('tsuuhankubun',1);
                                                									}
                                                								// 条件（通販区分が楽天）
                                                									if($out3_b == "ON"){
                                                										$query->orWhere('tsuuhankubun',2);
                                                									}
                                                								// 条件（通販区分がヤフー）
                                                									if($out3_c == "ON"){
                                                										$query->orWhere('tsuuhankubun',3);
                                                									}
                                                								// 条件（通販区分が電話・雑誌）
                                                									if($out3_d == "ON"){
                                                										$query->orWhere('tsuuhankubun',5);
                                                									}
                                                								// 条件（通販区分がYオークション）
                                                									if($out3_e == "ON"){
                                                										$query->orWhere('tsuuhankubun',4);
                                                									}
                                                								// 条件（通販区分が修理品返送）
                                                									if($out3_f == "ON"){
                                                										$query->orWhere('tsuuhankubun',9);
                                                									}
                                                                        
                                                                        })
                                                                    
                                                                    // 条件（免税）
                                                                        ->where("menzei","like","%免税%")
                                                                                        
                                                                    // 条件（扱い部門）
                                                                        ->where(function ($query) use ($out5_a,$out5_b,$out5_c) {
                                                
                                                                                $query->orWhere('bumonmei','');
                                                
                                                								// 条件（扱い部門がジャック）
                                                									if($out5_a == "ON"){
                                                										$query->orWhere('bumonmei','Jackroad');
                                                									}
                                                								// 条件（扱い部門がベティー）
                                                									if($out5_b == "ON"){
                                                										$query->orWhere('bumonmei','BettyRoad');
                                                									}
                                                								// 条件（扱い部門がジュエリー）
                                                									if($out5_c == "ON"){
                                                										$query->orWhere('bumonmei','Jewelry');
                                                									}
                                                                      
                                                                        })
                                                                        
                                                                    // ソート順指定
                                                                        ->orderBy('uriage', 'asc')
                                                                        ->get();
                                                
                                                                // クエリビルダスタート
                                                                    // 以下の変数は月数フラグとして後のロジックで使用するが、フォームにて「免税のみ」を選択した場合「店舗・通販(免税)」は全月一つも無いので、上でロジックが止まってしまい月数カウントの変数も0のままとなる。「店舗・通販(免税)」のみ独立した変数名として、カウント用は店舗用で対応
                                                                    $i2 = 0;
                                                                    // 変数リセット
                                                                        $oroshi_sum_uriage = "";
                                                                        $oroshi_sum_number = "";
                                                                        $oroshi_sum_arari = "";
                                                                        foreach ($oroshi_buys as $oroshi_buy) {
                                                                            // 各月名
                                                                                $oroshi_month[$i2]= $oroshi_buy->oroshi_month;
                                                                            // 各月店舗・通販(免税)売上
                                                                                $oroshi_uriage[$i2]= $oroshi_buy->oroshi_uriage;
                                                                                // 全過去期間に現在の期間が含まれている場合
                                                                                    if(strpos($temp1_oroshi_manthly_data, $oroshi_month[$i2] ) !== false){
                                                                                        // 文字列の同期間名を現在月の売上に書き換え
                                                                                            $temp1_oroshi_manthly_data = str_replace($oroshi_month[$i2], $oroshi_uriage[$i2], $temp1_oroshi_manthly_data);
                                                                                    }
                                                                            // 全期間店舗・通販(免税)売上合計
                                                                                // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                                                    if($last_nodata_flag == "ON"){
                                                                                        $oroshi_sum_uriage_average = (int)$oroshi_sum_uriage;
                                                                                    } else {
                                                                                        $oroshi_sum_uriage_average = (int)$oroshi_sum_uriage + (int)$oroshi_uriage[$i2];
                                                                                    }
                                                                                $oroshi_sum_uriage = (int)$oroshi_sum_uriage + (int)$oroshi_uriage[$i2];
                                                                            // 各月店舗・通販(免税)点数
                                                                                $oroshi_number[$i2]= $oroshi_buy->oroshi_number;
                                                                                // 全過去期間に現在の期間が含まれている場合
                                                                                    if(strpos($temp1_oroshi_manthly_data2, $oroshi_month[$i2] ) !== false){
                                                                                        // 文字列の同期間名を現在月の売上に書き換え
                                                                                            $temp1_oroshi_manthly_data2 = str_replace($oroshi_month[$i2], $oroshi_number[$i2], $temp1_oroshi_manthly_data2);
                                                                                    }
                                                                            // 全期間店舗・通販(免税)点数合計
                                                                                // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                                                    if($last_nodata_flag == "ON"){
                                                                                        $oroshi_sum_number_average = (int)$oroshi_sum_number;
                                                                                    } else {
                                                                                        $oroshi_sum_number_average = (int)$oroshi_sum_number + (int)$oroshi_number[$i2];
                                                                                    }
                                                                                $oroshi_sum_number = (int)$oroshi_sum_number + (int)$oroshi_number[$i2];
                                                
                                                                            // 各月店舗・通販(免税)粗利
                                                                                $oroshi_arari[$i2]= $oroshi_buy->oroshi_arari;
                                                                                // 全過去期間に現在の期間が含まれている場合
                                                                                    if(strpos($temp1_oroshi_manthly_data3, $oroshi_month[$i2] ) !== false){
                                                                                        // 文字列の同期間名を現在月の売上に書き換え
                                                                                            $temp1_oroshi_manthly_data3 = str_replace($oroshi_month[$i2], $oroshi_arari[$i2], $temp1_oroshi_manthly_data3);
                                                                                    }
                                                                            // 全期間店舗・通販(免税)点数合計
                                                                                // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                                                    if($last_nodata_flag == "ON"){
                                                                                        $oroshi_sum_arari_average = (int)$oroshi_sum_arari;
                                                                                    } else {
                                                                                        $oroshi_sum_arari_average = (int)$oroshi_sum_arari + (int)$oroshi_arari[$i2];
                                                                                    }
                                                                                $oroshi_sum_arari = (int)$oroshi_sum_arari + (int)$oroshi_arari[$i2];
                                                
                                                
                                                
                                                                            $i2++;
                                                                        }
                                                
                                                
                                                                    // 全期間店舗・通販(免税)売上合計とその平均値のHTML作成
                                                                        $temp1_oroshi_sum = "";
                                                                        //$temp1_oroshi_sum = "<div class='title4 ta_r'>" . number_format((int)$oroshi_sum_uriage) . "</div><div class='title4 ta_c'>" . $yoy_uriage3 . "</div><div class='title4 ta_r'>" . number_format(floor((int)$oroshi_sum_uriage / $i)) . "</div></div>";
                                                                        if($oroshi_sum_uriage == 0 || $oroshi_sum_uriage == ""){
                                                                            $temp1_oroshi_sum = "<div class='title4 ta_r'>0</div><div class='title4 ta_r'>0</div></div>";
                                                                            $oroshi_sum_uriage_ave = 0;
                                                                            $oroshi_sum_uriage_ave2 = 0;
                                                                        } else {
                                                                            // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                                            //$temp1_oroshi_sum = "<div class='title4 ta_r'>" . number_format((int)$oroshi_sum_uriage) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$oroshi_sum_uriage / $i)) . "</div></div>";
                                                                            //$oroshi_sum_uriage_ave = number_format(floor((int)$oroshi_sum_uriage/ $i));                                                    
                                                                            //$oroshi_sum_uriage_ave2 = floor((int)$oroshi_sum_uriage/ $i);  
                                                                            if($last_nodata_flag == "ON"){
                                                                                if($oroshi_sum_uriage_average <> "" && $oroshi_sum_uriage_average <> 0){$oroshi_sum_uriage_ave = number_format(floor((int)$oroshi_sum_uriage_average / ((int)$i -1)));} else {$oroshi_sum_uriage_ave = "---";}
                                                                                if($oroshi_sum_uriage_average <> "" && $oroshi_sum_uriage_average <> 0){$oroshi_sum_uriage_ave2 = floor((int)$oroshi_sum_uriage_average / ((int)$i -1));} else {$oroshi_sum_uriage_ave2 = "---";}
                                                                            } else {
                                                                                $oroshi_sum_uriage_ave = number_format(floor((int)$oroshi_sum_uriage / $i));
                                                                                $oroshi_sum_uriage_ave2 = floor((int)$oroshi_sum_uriage / $i);
                                                                            }
                                                                            $temp1_oroshi_sum = "<div class='title4 ta_r'>" . number_format((int)$oroshi_sum_uriage) . "</div><div class='title4 ta_r'>" . $oroshi_sum_uriage_ave . "</div></div>";
                                                                        }
                                                                    // 全期間店舗・通販(免税)売上点数合計とその平均値のHTML作成
                                                                        $temp1_oroshi_sum2 = "";
                                                                        //$temp1_oroshi_sum2 = "<div class='title4 ta_r'>" . number_format((int)$oroshi_sum_number) . "</div><div class='title4 ta_c'>" . $yoy_number3 . "</div><div class='title4 ta_r'>" . number_format(floor((int)$oroshi_sum_number / $i)) . "</div></div>";
                                                                        if($oroshi_sum_number == 0 || $oroshi_sum_number == ""){
                                                                            $temp1_oroshi_sum2 = "<div class='title4 ta_r'>0</div><div class='title4 ta_r'>0</div></div>";
                                                                            $oroshi_sum_number_ave = 0;
                                                                            $oroshi_sum_number_ave2 = 0;
                                                                        } else {
                                                                            // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                                            //$temp1_oroshi_sum2 = "<div class='title4 ta_r'>" . number_format((int)$oroshi_sum_number) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$oroshi_sum_number / $i)) . "</div></div>";
                                                                            //$oroshi_sum_number_ave = number_format(floor((int)$oroshi_sum_number/ $i));                                                   
                                                                            //$oroshi_sum_number_ave2 = floor((int)$oroshi_sum_number/ $i); 
                                                                            if($last_nodata_flag == "ON"){
                                                                                if($oroshi_sum_number_average <> "" && $oroshi_sum_number_average <> 0){$oroshi_sum_number_ave = number_format(floor((int)$oroshi_sum_number_average / ((int)$i -1)));} else {$oroshi_sum_number_ave = "---";}
                                                                                if($oroshi_sum_number_average <> "" && $oroshi_sum_number_average <> 0){$oroshi_sum_number_ave2 = floor((int)$oroshi_sum_number_average / ((int)$i -1));} else {$oroshi_sum_number_ave2 = "---";}
                                                                            } else {
                                                                                $oroshi_sum_number_ave = number_format(floor((int)$oroshi_sum_number / $i));
                                                                                $oroshi_sum_number_ave2 = floor((int)$oroshi_sum_number / $i);
                                                                            }
                                                                            $temp1_oroshi_sum2 = "<div class='title4 ta_r'>" . number_format((int)$oroshi_sum_number) . "</div><div class='title4 ta_r'>" . $oroshi_sum_number_ave . "</div></div>";
                                                                        }
                                                
                                                                    // 全期間店舗・通販(免税)粗利合計とその平均値のHTML作成
                                                                        $temp1_oroshi_sum3 = "";
                                                                        //$temp1_oroshi_sum3 = "<div class='title4 ta_r'>" . number_format((int)$oroshi_sum_arari) . "</div><div class='title4 ta_c'>" . $yoy_arari3 . "</div><div class='title4 ta_r'>" . number_format(floor((int)$oroshi_sum_arari / $i)) . "</div></div>";
                                                                        if($oroshi_sum_arari == 0 || $oroshi_sum_arari == ""){
                                                                            $temp1_oroshi_sum3 = "<div class='title4 ta_r'>0</div><div class='title4 ta_r'>0</div></div>";
                                                                            $oroshi_sum_arari_ave = 0;
                                                                            $oroshi_sum_arari_ave2 = 0;
                                                                        } else {
                                                                            // 【データ格納最終日がその月の最終日でなければ平均計算に含めない】現在の「金額」「点数」「粗利」のみが対象
                                                                            //$temp1_oroshi_sum3 = "<div class='title4 ta_r'>" . number_format((int)$oroshi_sum_arari) . "</div><div class='title4 ta_r'>" . number_format(floor((int)$oroshi_sum_arari / $i)) . "</div></div>";
                                                                            //$oroshi_sum_arari_ave = number_format(floor((int)$oroshi_sum_arari/ $i));
                                                                            //$oroshi_sum_arari_ave2 = floor((int)$oroshi_sum_arari/ $i);  
                                                                            if($last_nodata_flag == "ON"){
                                                                                if($oroshi_sum_arari_average <> "" && $oroshi_sum_arari_average <> 0){$oroshi_sum_arari_ave = number_format(floor((int)$oroshi_sum_arari_average / ((int)$i -1)));} else {$oroshi_sum_arari_ave = "---";}
                                                                                if($oroshi_sum_arari_average <> "" && $oroshi_sum_arari_average <> 0){$oroshi_sum_arari_ave2 = floor((int)$oroshi_sum_arari_average / ((int)$i -1));} else {$oroshi_sum_arari_ave2 = "---";}
                                                                            } else {
                                                                                $oroshi_sum_arari_ave = number_format(floor((int)$oroshi_sum_arari / $i));
                                                                                $oroshi_sum_arari_ave2 = floor((int)$oroshi_sum_arari / $i);
                                                                            }
                                                                            $temp1_oroshi_sum3 = "<div class='title4 ta_r'>" . number_format((int)$oroshi_sum_arari) . "</div><div class='title4 ta_r'>" . $oroshi_sum_arari_ave . "</div></div>";
                                                                        }
                                                                        
                                                        }
                                                                            /************************************************************************************************************************************************************************************************************* */
                                                                                // 全件用
                                                                            /************************************************************************************************************************************************************************************************************* */
                                                
                                                
                                                                                    // 各月のタイトル表示用HTMLを作成
                                                                                        $temp1_title2 = "";
                                                                                        $temp1_title3 = "";
                                                                                        $temp1_title4 = "";
                                                                                        $temp1_title5 = "";
                                                                                        foreach($manth_now_array as $val){
                                                                                                // 表示用
                                                                                                $temp1_title2 .= "<div class='title2 ta_c'>" . $val . "</div>";
                                                                                                // 20230803
                                                                                                $temp1_title3 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                                                                                $temp1_title4 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                                                                                $temp1_title5 .= "<div class='title7 ta_c'>" . $val . "</div>";
                                                                                            }
                                                                                
                                                                                            $temp1_title = "<div class='wid100 ul2'><div class='title5 ta_c'>" . $between_start_view. "～<br>" .$between_end_view . "</div>" .$temp1_title2 ."<div class='title6 ta_c'>累計</div><!--<div class='title6 ta_c'>過去比</div>--><div class='title6 ta_c'>平均</div></div>";
                                                                                            $temp1_title3 = "<div class='wid100 ul2'><div class='title7 ta_c'>" . $between_start_view. "～<br>" .$between_end_view . "</div>" .$temp1_title3 ."<div class='title7 ta_c'>平均</div></div>";
                                                                                            $temp1_title4 = "<div class='wid100 ul2 bg_green'><div class='title7 ta_c'>" . $between_start_view. "～<br>" .$between_end_view . "</div>" .$temp1_title4 ."<div class='title7 ta_c'>平均</div></div>";
                                                                                            $temp1_title5 = "<div class='wid100 ul2 bg_yellow'><div class='title7 ta_c'>" . $between_start_view. "～<br>" .$between_end_view . "</div>" .$temp1_title5 ."<div class='title7 ta_c'>平均</div></div>";
                                                                                        
                                                                                        
                                                                                        // 全期間の全部門売上合計用変数リセット
                                                                                            $all_sum_uriage_all = 0;
                                                                                            $all_sum_number_all = 0;
                                                                                            $all_sum_arari_all = 0;
                                                                                            for($all_i = 0; $all_i < $i; $all_i++){
                                                                                                // 各月の全部門売上合計用変数リセット
                                                                                                    $all_month_uriage = 0;
                                                                                                    $all_month_number= 0;
                                                                                                    $all_month_arari= 0;
                                                                                                // 各月の全部門売上合計をHTMLへ
                                                                                                    if($out1_b == "ON"){ 
                                                                                                        if(isset($web_uriage[$all_i])){$all_month_uriage = $all_month_uriage + (int)$web_uriage[$all_i]; }
                                                                                                        if(isset($web_number[$all_i])){$all_month_number = $all_month_number + (int)$web_number[$all_i]; }
                                                                                                        if(isset($web_arari[$all_i])){$all_month_arari = $all_month_arari+ (int)$web_arari[$all_i]; }
                                                                                                    }
                                                                                                    if($out1_a == "ON"){ 
                                                                                                        if(isset($shop_uriage[$all_i])){$all_month_uriage = $all_month_uriage + (int)$shop_uriage[$all_i]; }
                                                                                                        if(isset($shop_number[$all_i])){$all_month_number = $all_month_number + (int)$shop_number[$all_i]; }
                                                                                                        if(isset($shop_arari[$all_i])){$all_month_arari = $all_month_arari + (int)$shop_arari[$all_i]; }
                                                                                                    }
                                                                                                    if($out1_c == "ON"){ 
                                                                                                        // フォーム上の選択が「免税」のみだと「店舗・通販(免税)」は全月0なので「店舗・通販(免税)」を含む足し算だとエラーとなるため、条件分岐で回避
                                                                                                            /*if($out4_a == "OFF" && $out4_b == "ON"){
                                                                                                                $all_month_uriage = $all_month_uriage; 
                                                                                                                $all_month_number = $all_month_number; 
                                                                                                                $all_month_arari = $all_month_arari; 
                                                                                                            } else {*/
                                                                                                                if(isset($oroshi_uriage[$all_i])){ $all_month_uriage = $all_month_uriage + (int)$oroshi_uriage[$all_i]; }
                                                                                                                if(isset($oroshi_number[$all_i])){ $all_month_number = $all_month_number + (int)$oroshi_number[$all_i]; }
                                                                                                                if(isset($oroshi_arari[$all_i])){ $all_month_arari = $all_month_arari + (int)$oroshi_arari[$all_i]; }
                                                                                                            //}
                                                
                                                                                                    }
                                                                                                // 全期間の全部門売上合計
                                                                                                    $all_sum_uriage_all = (int)$all_sum_uriage_all + (int)$all_month_uriage;
                                                                                                    $all_sum_number_all = (int)$all_sum_number_all + (int)$all_month_number;
                                                                                                    $all_sum_arari_all = (int)$all_sum_arari_all + (int)$all_month_arari;
                                                                                                
                                                                                            }
                                                
                                                
                                                
                                                
                                                
                                                
                                                
                                                // 【進捗率の取得】
                                                                                        
                                                
                                                // 検索スタート日からデータが格納されている最終日までの日数
                                                    $search_start = strtotime($start_now);
                                                    $data_end = strtotime($last_day);
                                                    $data_in_days = ($data_end - $search_start) / (60 * 60 * 24);
                                                
                                                // 検索期間
                                                    $search_start = strtotime($start_now);
                                                    $search_end = strtotime($end_now);
                                                    $search_days = ($search_end - $search_start) / (60 * 60 * 24);
                                                
                                                // 検索期間・着地予測（期間合計 / データ格納期間 * 検索期間）
                                                    ($shop_sum_uriage <> 0 && $shop_sum_uriage <> "") ? $shop_term_progress = $shop_sum_uriage / $data_in_days * $search_days : $shop_term_progress = "---";
                                                    ($web_sum_uriage <> 0 && $web_sum_uriage <> "") ? $web_term_progress = $web_sum_uriage / $data_in_days * $search_days : $web_term_progress = "---";
                                                    ($shop_sum_number <> 0 && $shop_sum_number <> "") ? $shop_term_progress_n = $shop_sum_number / $data_in_days * $search_days : $shop_term_progress_n = "---";
                                                    ($web_sum_number <> 0 && $web_sum_number <> "") ? $web_term_progress_n = $web_sum_number / $data_in_days * $search_days : $web_term_progress_n = "---";
                                                    ($shop_sum_arari <> 0 && $shop_sum_arari <> "") ? $shop_term_progress_a = $shop_sum_arari / $data_in_days * $search_days : $shop_term_progress_a = "---";
                                                    ($web_sum_arari <> 0 && $web_sum_arari <> "") ? $web_term_progress_a = $web_sum_arari / $data_in_days * $search_days : $web_term_progress_a = "---";
                                                    
                                                    $oroshi_term_progress = 0;
                                                    $oroshi_term_progress_n = 0;
                                                    $oroshi_term_progress_a = 0;
                                                    if($out1_c == "ON"){($oroshi_sum_uriage <> 0 && $oroshi_sum_uriage <> "") ? $oroshi_term_progress = $oroshi_sum_uriage / $data_in_days * $search_days : $oroshi_term_progress = "---";}
                                                    if($out1_c == "ON"){($oroshi_sum_number <> 0 && $oroshi_sum_number <> "") ? $oroshi_term_progress_n = $oroshi_sum_number / $data_in_days * $search_days : $oroshi_term_progress_n = "---";}
                                                    if($out1_c == "ON"){($oroshi_sum_arari <> 0 && $oroshi_sum_arari <> "") ? $oroshi_term_progress_a = $oroshi_sum_arari / $data_in_days * $search_days : $oroshi_term_progress_a = "---";}
                                                    
                                                    // 合計
                                                        $all_term_progress = (int)$shop_term_progress + (int)$web_term_progress + (int)$oroshi_term_progress;
                                                        $all_term_progress_n = (int)$shop_term_progress_n + (int)$web_term_progress_n + (int)$oroshi_term_progress_n;
                                                        $all_term_progress_a = (int)$shop_term_progress_a + (int)$web_term_progress_a + (int)$oroshi_term_progress_a;
                                                // 検索期間・過去との着地予測比（検索期間・着地予測 / 過去合計）
                                                    ($shop_term_progress <> 0 && $shop_term_progress <> "" && $past_shop_sum_uriage <> 0 && $past_shop_sum_uriage <> "") ? $shop_term_progress2 = number_format((floor(((int)$shop_term_progress / (int)$past_shop_sum_uriage) * 100 * 10)) / 10,1) : $shop_term_progress2 = 0;
                                                    ($web_term_progress <> 0 && $web_term_progress <> "" && $past_web_sum_uriage <> 0 && $past_web_sum_uriage <> "") ? $web_term_progress2 = number_format((floor(((int)$web_term_progress / (int)$past_web_sum_uriage) * 100 * 10)) / 10,1) : $web_term_progress2 = 0;
                                                    ($shop_term_progress_n <> 0 && $shop_term_progress_n <> "" && $past_shop_sum_number <> 0 && $past_shop_sum_number <> "") ? $shop_term_progress2_n = number_format((floor(((int)$shop_term_progress_n / (int)$past_shop_sum_number) * 100 * 10)) / 10,1) : $shop_term_progress2_n = 0;
                                                    ($web_term_progress_n <> 0 && $web_term_progress_n <> "" && $past_web_sum_number <> 0 && $past_web_sum_number <> "") ? $web_term_progress2_n = number_format((floor(((int)$web_term_progress_n / (int)$past_web_sum_number) * 100 * 10)) / 10,1) : $web_term_progress2_n = 0;
                                                    ($shop_term_progress_a <> 0 && $shop_term_progress_a <> "" && $past_shop_sum_arari <> 0 && $past_shop_sum_arari <> "") ? $shop_term_progress2_a = number_format((floor(((int)$shop_term_progress_a / (int)$past_shop_sum_arari) * 100 * 10)) / 10,1) : $shop_term_progress2_a = 0;
                                                    ($web_term_progress_a <> 0 && $web_term_progress_a <> "" && $past_web_sum_arari <> 0 && $past_web_sum_arari <> "") ? $web_term_progress2_a = number_format((floor(((int)$web_term_progress_a / (int)$past_web_sum_arari) * 100 * 10)) / 10,1) : $web_term_progress2_a = 0;
                                                    
                                                    if($out1_c == "ON"){
                                                        if($oroshi_term_progress <> "" && $oroshi_term_progress <> 0 && $past_oroshi_sum_uriage <> "" && $past_oroshi_sum_uriage <> 0){
                                                            $oroshi_term_progress2 = number_format((floor(((int)$oroshi_term_progress / (int)$past_oroshi_sum_uriage) * 100 * 10)) / 10,1);
                                                        } else {
                                                            $oroshi_term_progress2 = "---";
                                                        }
                                                        if($oroshi_term_progress_n <> "" && $oroshi_term_progress_n <> 0 && $past_oroshi_sum_number <> "" && $past_oroshi_sum_number <> 0){
                                                            $oroshi_term_progress2_n = number_format((floor(((int)$oroshi_term_progress_n / (int)$past_oroshi_sum_number) * 100 * 10)) / 10,1);
                                                        } else {
                                                            $oroshi_term_progress2_n = "---"; 
                                                        }
                                                        if($oroshi_term_progress_a <> "" && $oroshi_term_progress_a <> 0 && $past_oroshi_sum_arari <> "" && $past_oroshi_sum_arari <> 0){
                                                            $oroshi_term_progress2_a = number_format((floor(((int)$oroshi_term_progress_a / (int)$past_oroshi_sum_arari) * 100 * 10)) / 10,1);
                                                        } else {
                                                            $oroshi_term_progress2_a = "---"; 
                                                        }
                                                    }
                                                    
                                                    // 合計
                                                    ($all_term_progress <> 0 && $all_term_progress <> "" && $past_all_sum_uriage_all <> 0 && $past_all_sum_uriage_all <> "") ? $all_term_progress2 = number_format((floor(((int)$all_term_progress / (int)$past_all_sum_uriage_all) * 100 * 10)) / 10,1) : $all_term_progress2 = "---";
                                                    ($all_term_progress_n <> 0 && $all_term_progress_n <> "" && $past_all_sum_number_all <> 0 && $past_all_sum_number_all <> "") ? $all_term_progress2_n = number_format((floor(((int)$all_term_progress_n / (int)$past_all_sum_number_all) * 100 * 10)) / 10,1) : $all_term_progress2_n = "---";
                                                    ($all_term_progress_a <> 0 && $all_term_progress_a <> "" && $past_all_sum_arari_all <> 0 && $past_all_sum_arari_all <> "") ? $all_term_progress2_a = number_format((floor(((int)$all_term_progress_a / (int)$past_all_sum_arari_all) * 100 * 10)) / 10,1) : $all_term_progress2_a = "---";
                                                
                                                // HTML追記
                                                    ($shop_term_progress <> 0 && $shop_term_progress <> "") ? $shop_term_progress_view = "<div class='sinchoku'>" . number_format((int)$shop_term_progress) . "</div>" : $shop_term_progress_view = "<div class='sinchoku'>---</div>";
                                                    ($shop_sum_uriage <> 0 && $shop_sum_uriage <> "") ? $shop_sum_uriage_view = "<div class='sinchoku'>" . number_format($shop_sum_uriage) . "</div>" : $shop_sum_uriage_view = "<div class='sinchoku'>---</div>";
                                                    ($shop_term_progress2 < 100) ? $shop_term_progress2_view = "<div class='sinchoku fc_blue'>" . $shop_term_progress2 . "%</div>" : $shop_term_progress2_view = "<div class='sinchoku fc_red'>" . $shop_term_progress2 . "%</div>";
                                                    ($web_term_progress <> 0 && $web_term_progress <> "") ? $web_term_progress_view = "<div class='sinchoku'>" . number_format((int)$web_term_progress) . "</div>" : $web_term_progress_view = "<div class='sinchoku'>---</div>";
                                                    ($web_sum_uriage <> 0 && $web_sum_uriage <> "") ? $web_sum_uriage_view = "<div class='sinchoku'>" . number_format((int)$web_sum_uriage) . "</div>" : $web_sum_uriage_view = "<div class='sinchoku'>---</div>";
                                                    ($web_term_progress2 < 100) ? $web_term_progress2_view = "<div class='sinchoku fc_blue'>" . $web_term_progress2 . "%</div>" : $web_term_progress2_view = "<div class='sinchoku fc_red'>" . $web_term_progress2 . "%</div>";
                                                    
                                                    ($shop_term_progress_n <> 0 && $shop_term_progress_n <> "") ? $shop_term_progress_n_view = "<div class='sinchoku'>" . number_format((int)$shop_term_progress_n) . "</div>" : $shop_term_progress_n_view = "<div class='sinchoku'>---</div>";
                                                    ($shop_sum_number <> 0 && $shop_sum_number <> "") ? $shop_sum_number_view = "<div class='sinchoku'>" . number_format($shop_sum_number) . "</div>" : $shop_sum_number_view = "<div class='sinchoku'>---</div>";
                                                    ($shop_term_progress2_n < 100) ? $shop_term_progress2_n_view = "<div class='sinchoku fc_blue'>" . $shop_term_progress2_n . "%</div>" : $shop_term_progress2_n_view = "<div class='sinchoku fc_red'>" . $shop_term_progress2_n . "%</div>";
                                                    ($web_term_progress_n <> 0 && $web_term_progress_n <> "") ? $web_term_progress_n_view = "<div class='sinchoku'>" . number_format((int)$web_term_progress_n) . "</div>" : $web_term_progress_n_view = "<div class='sinchoku'>---</div>";
                                                    ($web_sum_number <> 0 && $web_sum_number <> "") ? $web_sum_number_view = "<div class='sinchoku'>" . number_format((int)$web_sum_number) . "</div>" : $web_sum_number_view = "<div class='sinchoku'>---</div>";
                                                    ($web_term_progress2_n < 100) ? $web_term_progress2_n_view = "<div class='sinchoku fc_blue'>" . $web_term_progress2_n . "%</div>" : $web_term_progress2_n_view = "<div class='sinchoku fc_red'>" . $web_term_progress2_n . "%</div>";
                                                  
                                                    ($shop_term_progress_a <> 0 && $shop_term_progress_a <> "") ? $shop_term_progress_a_view = "<div class='sinchoku'>" . number_format((int)$shop_term_progress_a) . "</div>" : $shop_term_progress_a_view = "<div class='sinchoku'>---</div>";
                                                    ($shop_sum_arari <> 0 && $shop_sum_arari <> "") ? $shop_sum_arari_view = "<div class='sinchoku'>" . number_format($shop_sum_arari) . "</div>" : $shop_sum_arari_view = "<div class='sinchoku'>---</div>";
                                                    ($shop_term_progress2_a < 100) ? $shop_term_progress2_a_view = "<div class='sinchoku fc_blue'>" . $shop_term_progress2_a . "%</div>" : $shop_term_progress2_a_view = "<div class='sinchoku fc_red'>" . $shop_term_progress2_a . "%</div>";
                                                    ($web_term_progress_a <> 0 && $web_term_progress_a <> "") ? $web_term_progress_a_view = "<div class='sinchoku'>" . number_format((int)$web_term_progress_a) . "</div>" : $web_term_progress_a_view = "<div class='sinchoku'>---</div>";
                                                    ($web_sum_arari <> 0 && $web_sum_arari <> "") ? $web_sum_arari_view = "<div class='sinchoku'>" . number_format((int)$web_sum_arari) . "</div>" : $web_sum_arari_view = "<div class='sinchoku'>---</div>";
                                                    ($web_term_progress2_a < 100) ? $web_term_progress2_a_view = "<div class='sinchoku fc_blue'>" . $web_term_progress2_a . "%</div>" : $web_term_progress2_a_view = "<div class='sinchoku fc_red'>" . $web_term_progress2_a . "%</div>";
                                                    
                                                    if($out1_c == "ON"){ 
                                                        ($oroshi_term_progress <> 0 && $oroshi_term_progress <> "") ? $oroshi_term_progress_view = "<div class='sinchoku'>" . number_format((int)$oroshi_term_progress) . "</div>" : $oroshi_term_progress_view = "<div class='sinchoku'>---</div>";
                                                        ($oroshi_sum_uriage <> 0 && $oroshi_sum_uriage <> "") ? $oroshi_sum_uriage_view = "<div class='sinchoku'>" . number_format((int)$oroshi_sum_uriage) . "</div>" : $oroshi_sum_uriage_view = "<div class='sinchoku'>---</div>";
                                                        ($oroshi_term_progress2 < 100) ? $oroshi_term_progress2_view = "<div class='sinchoku fc_blue'>" . $oroshi_term_progress2 . "%</div>" : $oroshi_term_progress2_view = "<div class='sinchoku fc_red'>" . $oroshi_term_progress2 . "%</div>";
                                                        ($oroshi_term_progress_n <> 0 && $oroshi_term_progress_n <> "") ? $oroshi_term_progress_n_view = "<div class='sinchoku'>" . number_format((int)$oroshi_term_progress_n) . "</div>" : $oroshi_term_progress_n_view = "<div class='sinchoku'>---</div>";
                                                        ($oroshi_sum_number <> 0 && $oroshi_sum_number <> "") ? $oroshi_sum_number_view = "<div class='sinchoku'>" . number_format((int)$oroshi_sum_number) . "</div>" : $oroshi_sum_number_view = "<div class='sinchoku'>---</div>";
                                                        ($oroshi_term_progress2_n < 100) ? $oroshi_term_progress2_n_view = "<div class='sinchoku fc_blue'>" . $oroshi_term_progress2_n . "%</div>" : $oroshi_term_progress2_n_view = "<div class='sinchoku fc_red'>" . $oroshi_term_progress2_n . "%</div>";
                                                            ($oroshi_term_progress_a <> 0 && $oroshi_term_progress_a <> "") ? $oroshi_term_progress_a_view = "<div class='sinchoku'>" . number_format((int)$oroshi_term_progress_a) . "</div>" : $oroshi_term_progress_a_view = "<div class='sinchoku'>---</div>";
                                                        ($oroshi_sum_arari <> 0 && $oroshi_sum_arari <> "") ? $oroshi_sum_arari_view = "<div class='sinchoku'>" . number_format((int)$oroshi_sum_arari) . "</div>" : $oroshi_sum_arari_view = "<div class='sinchoku'>---</div>";
                                                        ($oroshi_term_progress2_a < 100) ? $oroshi_term_progress2_a_view = "<div class='sinchoku fc_blue'>" . $oroshi_term_progress2_a . "%</div>" : $oroshi_term_progress2_a_view = "<div class='sinchoku fc_red'>" . $oroshi_term_progress2_a . "%</div>";
                                                    }
                                                    ($all_term_progress <> 0 && $all_term_progress <> "") ? $all_term_progress_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_term_progress) . "</div>" : $all_term_progress_view = "<div class='sinchoku bg_grey'>---</div>";
                                                    ($all_sum_uriage_all <> 0 && $all_sum_uriage_all <> "") ? $all_sum_uriage_all_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_sum_uriage_all) . "</div>" : $all_sum_uriage_all_view = "<div class='sinchoku bg_grey'>---</div>";
                                                    ($all_term_progress2 < 100) ? $all_term_progress2_view = "<div class='sinchoku fc_blue bg_grey'>" . $all_term_progress2 . "%</div>" : $all_term_progress2_view = "<div class='sinchoku fc_red bg_grey'>" . $all_term_progress2 . "%</div>";
                                                    ($all_term_progress_n <> 0 && $all_term_progress_n <> "") ? $all_term_progress_n_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_term_progress_n) . "</div>" : $all_term_progress_n_view = "<div class='sinchoku bg_grey'>---</div>";
                                                    ($all_sum_number_all <> 0 && $all_sum_number_all <> "") ? $all_sum_number_all_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_sum_number_all) . "</div>" : $all_sum_number_all_view = "<div class='sinchoku bg_grey'>---</div>";
                                                    ($all_term_progress2_n < 100) ? $all_term_progress2_n_view = "<div class='sinchoku fc_blue bg_grey'>" . $all_term_progress2_n . "%</div>" : $all_term_progress2_n_view = "<div class='sinchoku fc_red bg_grey'>" . $all_term_progress2_n . "%</div>";
                                                    ($all_term_progress_a <> 0 && $all_term_progress_a <> "") ? $all_term_progress_a_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_term_progress_a) . "</div>" : $all_term_progress_a_view = "<div class='sinchoku bg_grey'>---</div>";
                                                    ($all_sum_arari_all <> 0 && $all_sum_arari_all <> "") ? $all_sum_arari_all_view = "<div class='sinchoku bg_grey'>" . number_format((int)$all_sum_arari_all) . "</div>" : $all_sum_arari_all_view = "<div class='sinchoku bg_grey'>---</div>";
                                                    ($all_term_progress2_a < 100) ? $all_term_progress2_a_view = "<div class='sinchoku fc_blue bg_grey'>" . $all_term_progress2_a . "%</div>" : $all_term_progress2_a_view = "<div class='sinchoku fc_red bg_grey'>" . $all_term_progress2_a . "%</div>";
    
    
    // 売上額進捗
                                                                    $uriage_progress_html = 
                                                                    "<div class='btn_bulldown_  pt2'><span class='view'>＋</span> 予測数値について</div>
                                                                    <div class='down'>
                                                                        <p class='text'>▼月間着地予測：データを有する最終月の数値 / 月初からデータを有する最終日までの日数 x 該当月の最終日の数字</p>
                                                                        <p class='text'>▼月間着地予測比（対過去・同月）：データを有する最終月を検索期間遡った過去月との対比（1～12月までの検索で、8月までのデータが存在するのなら、昨年の8月との対比）</p>
                                                                        <p class='text'>▼全期間着地予測：検索期間の累計 / 検索スタート日からデータを有する最終日までの日数 x 検索期間の総日数</p>
                                                                    </div>
                                                                    <div class='ul_p mt1'>
                                                                        <div class='sinchoku_t'>" . $last_year_last . "年" . $last_month_last. "月</div>
                                                                        <div class='sinchoku_t'>月間売上進捗</div>
                                                                        <div class='sinchoku_t'>月間着地予測</div>
                                                                        <div class='sinchoku_t'>月間着地予測比（対前月）</div>
                                                                        <div class='sinchoku_t'>月間着地予測比（対過去・同月）</div>
                                                                        <div class='sinchoku_t'>全期間売上進捗</div>
                                                                        <div class='sinchoku_t'>全期間着地予測</div>
                                                                        <div class='sinchoku_t'>全期間着地予測比（対過去・全期間）</div>
                                                                    </div>
                                                                    <div class='ul_p'>
                                                                        <div class='sinchoku ta_c'>店舗(免税外)</div>
                                                                        <div class='sinchoku'>" . $shop_uriage_view1. "</div>
                                                                        <div class='sinchoku'>" . $shop_uriage_view2. "</div>
                                                                        " . $shop_uriage_view3 . "
                                                                        " . $shop_uriage_view4 . "
                                                                        " . $shop_sum_uriage_view . "
                                                                        " . $shop_term_progress_view. "
                                                                        " . $shop_term_progress2_view. "
                                                                    </div>
                                                                    <div class='ul_p'>
                                                                        <div class='sinchoku ta_c'>通販(免税外)</div>
                                                                        <div class='sinchoku'>" . $web_uriage_view1 . "</div>
                                                                        <div class='sinchoku'>" . $web_uriage_view2. "</div>
                                                                        " . $web_uriage_view3 . "
                                                                        " . $web_uriage_view4 . "
                                                                        " . $web_sum_uriage_view . "
                                                                        " . $web_term_progress_view. "
                                                                        " . $web_term_progress2_view. "
                                                                    </div>";
                                                                    if($out1_c == "ON"){ 
                                                                    $uriage_progress_html .= 
                                                                    "<div class='ul_p'>
                                                                        <div class='sinchoku ta_c'>店舗・通販(免税)</div>
                                                                        <div class='sinchoku'>" . $oroshi_uriage_view1 . "</div>
                                                                        <div class='sinchoku'>" . $oroshi_uriage_view2. "</div>
                                                                        " . $oroshi_uriage_view3 . "
                                                                        " . $oroshi_uriage_view4 . "
                                                                        " . $oroshi_sum_uriage_view . "
                                                                        " . $oroshi_term_progress_view. "
                                                                        " . $oroshi_term_progress2_view. "
                                                                    </div>";
                                                                    }
                                                                    $uriage_progress_html .= 
                                                                    "<div class='ul_p'>
                                                                        <div class='sinchoku bg_grey ta_c'>合計</div>
                                                                        <div class='sinchoku bg_grey'>" . $all_uriage_view1 . "</div>
                                                                        <div class='sinchoku bg_grey'>" . $all_uriage_view2 . "</div>
                                                                        " . $all_uriage_view3 . "
                                                                        " . $all_uriage_view4 . "
                                                                        " . $all_sum_uriage_all_view . "
                                                                        " . $all_term_progress_view. "
                                                                        " . $all_term_progress2_view. "
                                                                    </div>";
                                                            // 売上点数進捗
                                                                    $number_progress_html = 
                                                                    "<div class='btn_bulldown_  pt2'><span class='view2'>＋</span> 予測数値について</div>
                                                                    <div class='down'>
                                                                    <p class='text'>▼月間着地予測：データを有する最終月の数値 / 月初からデータを有する最終日までの日数 x 該当月の最終日の数字</p>
                                                                    <p class='text'>▼月間着地予測比（対過去・同月）：データを有する最終月を検索期間遡った過去月との対比（1～12月までの検索で、8月までのデータが存在するのなら、昨年の8月との対比）</p>
                                                                    <p class='text'>▼全期間着地予測：検索期間の累計 / 検索スタート日からデータを有する最終日までの日数 x 検索期間の総日数</p>
                                                                    </div>
                                                                    <div class='ul_p mt1'>
                                                                        <div class='sinchoku_t'>" . $last_year_last . "年" . $last_month_last. "月</div>
                                                                        <div class='sinchoku_t'>月間売上進捗</div>
                                                                        <div class='sinchoku_t'>月間着地予測</div>
                                                                        <div class='sinchoku_t'>月間着地予測比（対前月）</div>
                                                                        <div class='sinchoku_t'>月間着地予測比（対過去・同月）</div>
                                                                        <div class='sinchoku_t'>全期間売上進捗</div>
                                                                        <div class='sinchoku_t'>全期間着地予測</div>
                                                                        <div class='sinchoku_t'>全期間着地予測比（対過去・全期間）</div>
                                                                    </div>
                                                                    <div class='ul_p'>
                                                                        <div class='sinchoku ta_c'>店舗(免税外)</div>
                                                                        <div class='sinchoku'>" . $shop_number_view1. "</div>
                                                                        <div class='sinchoku'>" . $shop_number_view2. "</div>
                                                                        " . $shop_number_view3 . "
                                                                        " . $shop_number_view4 . "
                                                                        " . $shop_sum_number_view . "
                                                                        " . $shop_term_progress_n_view. "
                                                                        " . $shop_term_progress2_n_view. "
                                                                    </div>
                                                                    <div class='ul_p'>
                                                                        <div class='sinchoku ta_c'>通販(免税外)</div>
                                                                        <div class='sinchoku'>" . $web_number_view1 . "</div>
                                                                        <div class='sinchoku'>" . $web_number_view2. "</div>
                                                                        " . $web_number_view3 . "
                                                                        " . $web_number_view4 . "
                                                                        " . $web_sum_number_view . "
                                                                        " . $web_term_progress_n_view. "
                                                                        " . $web_term_progress2_n_view. "
                                                                    </div>";
                                                                    if($out1_c == "ON"){ 
                                                                    $number_progress_html .= 
                                                                    "<div class='ul_p'>
                                                                        <div class='sinchoku ta_c'>店舗・通販(免税)</div>
                                                                        <div class='sinchoku'>" . $oroshi_number_view1 . "</div>
                                                                        <div class='sinchoku'>" . $oroshi_number_view2. "</div>
                                                                        " . $oroshi_number_view3 . "
                                                                        " . $oroshi_number_view4 . "
                                                                        " . $oroshi_sum_number_view . "
                                                                        " . $oroshi_term_progress_n_view. "
                                                                        " . $oroshi_term_progress2_n_view. "
                                                                    </div>";
                                                                    }
                                                                    $number_progress_html .= 
                                                                    "<div class='ul_p'>
                                                                        <div class='sinchoku bg_grey ta_c'>合計</div>
                                                                        <div class='sinchoku bg_grey'>" . $all_number_view1 . "</div>
                                                                        <div class='sinchoku bg_grey'>" . $all_number_view2 . "</div>
                                                                        " . $all_number_view3 . "
                                                                        " . $all_number_view4 . "
                                                                        " . $all_sum_number_all_view . "
                                                                        " . $all_term_progress_n_view. "
                                                                        " . $all_term_progress2_n_view. "
                                                                    </div>";
                                                            // 売上粗利進捗
                                                                    $arari_progress_html = 
                                                                    "<div class='btn_bulldown_  pt2'><span class='view3'>＋</span> 予測数値について</div>
                                                                    <div class='down'>
                                                                    <p class='text'>▼月間着地予測：データを有する最終月の数値 / 月初からデータを有する最終日までの日数 x 該当月の最終日の数字</p>
                                                                    <p class='text'>▼月間着地予測比（対過去・同月）：データを有する最終月を検索期間遡った過去月との対比（1～12月までの検索で、8月までのデータが存在するのなら、昨年の8月との対比）</p>
                                                                    <p class='text'>▼全期間着地予測：検索期間の累計 / 検索スタート日からデータを有する最終日までの日数 x 検索期間の総日数</p>
                                                                    </div>
                                                                    <div class='ul_p mt1'>
                                                                        <div class='sinchoku_t'>" . $last_year_last . "年" . $last_month_last. "月</div>
                                                                        <div class='sinchoku_t'>月間売上進捗</div>
                                                                        <div class='sinchoku_t'>月間着地予測</div>
                                                                        <div class='sinchoku_t'>月間着地予測比（対前月）</div>
                                                                        <div class='sinchoku_t'>月間着地予測比（対過去・同月）</div>
                                                                        <div class='sinchoku_t'>全期間売上進捗</div>
                                                                        <div class='sinchoku_t'>全期間着地予測</div>
                                                                        <div class='sinchoku_t'>全期間着地予測比（対過去・全期間）</div>
                                                                    </div>
                                                                    <div class='ul_p'>
                                                                        <div class='sinchoku ta_c'>店舗(免税外)</div>
                                                                        <div class='sinchoku'>" . $shop_arari_view1. "</div>
                                                                        <div class='sinchoku'>" . $shop_arari_view2. "</div>
                                                                        " . $shop_arari_view3 . "
                                                                        " . $shop_arari_view4 . "
                                                                        " . $shop_sum_arari_view . "
                                                                        " . $shop_term_progress_a_view. "
                                                                        " . $shop_term_progress2_a_view. "
                                                                    </div>
                                                                    <div class='ul_p'>
                                                                        <div class='sinchoku ta_c'>通販(免税外)</div>
                                                                        <div class='sinchoku'>" . $web_arari_view1 . "</div>
                                                                        <div class='sinchoku'>" . $web_arari_view2. "</div>
                                                                        " . $web_arari_view3 . "
                                                                        " . $web_arari_view4 . "
                                                                        " . $web_sum_arari_view . "
                                                                        " . $web_term_progress_a_view. "
                                                                        " . $web_term_progress2_a_view. "
                                                                    </div>";
                                                                    if($out1_c == "ON"){ 
                                                                    $arari_progress_html .= 
                                                                    "<div class='ul_p'>
                                                                        <div class='sinchoku ta_c'>店舗・通販(免税)</div>
                                                                        <div class='sinchoku'>" . $oroshi_arari_view1 . "</div>
                                                                        <div class='sinchoku'>" . $oroshi_arari_view2. "</div>
                                                                        " . $oroshi_arari_view3 . "
                                                                        " . $oroshi_arari_view4 . "
                                                                        " . $oroshi_sum_arari_view . "
                                                                        " . $oroshi_term_progress_a_view. "
                                                                        " . $oroshi_term_progress2_a_view. "
                                                                    </div>";
                                                                    }
                                                                    $arari_progress_html .= 
                                                                    "<div class='ul_p'>
                                                                        <div class='sinchoku bg_grey ta_c'>合計</div>
                                                                        <div class='sinchoku bg_grey'>" . $all_arari_view1 . "</div>
                                                                        <div class='sinchoku bg_grey'>" . $all_arari_view2 . "</div>
                                                                        " . $all_arari_view3 . "
                                                                        " . $all_arari_view4 . "
                                                                        " . $all_sum_arari_all_view . "
                                                                        " . $all_term_progress_a_view. "
                                                                        " . $all_term_progress2_a_view. "
                                                                    </div>";

                                                                    if($out6 <> "ON"){
                                                                        $uriage_progress_html = "";
                                                                        $number_progress_html = "";
                                                                        $arari_progress_html = "";
                                                                    }




                            /************************************************************************************************************************************************************************************************************* */
                                // 最終ソース出力
                            /************************************************************************************************************************************************************************************************************* */
                                        
                                            // 【進捗率の取得】検索最終月の日数を取得
                                                //$get_days = $end_year . "-" . $end_month;
                                                //$get_days2 = date('t', strtotime($get_days));
                            
                            
                                        // 店舗用HTMLの作成
                                                $js_shop_uriage  = "";
                                                $js_shop_number  = "";
                                                $js_shop_arari  = "";
                                                $temp1_shop_manthly_html = "";
                                                $temp1_shop_manthly_html2 = "";
                                                $temp1_shop_manthly_html3 = "";
                                                $progress_uriage_html = "";
                                                $progress_number_html = "";
                                                $progress_arari_html = "";
                                                if($out1_a == "ON"){     
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_now_array as $val){
                                                                //$val = mb_substr($val,0,-3);
                                                                if(strpos($temp1_shop_manthly_data, $val ) !== false){
                                                                    $temp1_shop_manthly_data = str_replace($val, 0, $temp1_shop_manthly_data);
                                                                }
                                                                if(strpos($temp1_shop_manthly_data2, $val ) !== false){
                                                                    $temp1_shop_manthly_data2 = str_replace($val, 0, $temp1_shop_manthly_data2);
                                                                }
                                                                if(strpos($temp1_shop_manthly_data3, $val ) !== false){
                                                                    $temp1_shop_manthly_data3 = str_replace($val, 0, $temp1_shop_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $temp1_shop_manthly_array = explode(',',$temp1_shop_manthly_data);
                                                        $temp1_shop_manthly_array2 = explode(',',$temp1_shop_manthly_data2);
                                                        $temp1_shop_manthly_array3 = explode(',',$temp1_shop_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        $shop_last_uriage = "";
                                                        $i = 0;
                                                        foreach($temp1_shop_manthly_array as $val){
                                                            // 【進捗率の取得】最終月の「現在・店舗・売上」を取得
                                                                //$shop_last_uriage = $val;

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_shop_uriage  .= "0, ";
                                                                // 表示用
                                                                    $temp1_shop_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_shop_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp1_shop_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }

                                                        $i = 0;
                                                        foreach($temp1_shop_manthly_array2 as $val){
                                                            // 【進捗率の取得】最終月の「現在・店舗・点数」を取得
                                                                //$shop_last_number = $val;
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_shop_number  .= "0, ";
                                                                // 表示用
                                                                    $temp1_shop_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_shop_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp1_shop_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp1_shop_manthly_array3 as $val){
                                                            // 【進捗率の取得】最終月の「現在・通販・粗利」を取得
                                                                //$shop_last_arari = $val;
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_shop_arari  .= "0, ";
                                                                // 表示用
                                                                    $temp1_shop_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_shop_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp1_shop_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                            
                                                        // 全体HTMLの作成
                                                            if(isset($temp1_shop_manthly_html) && isset($temp1_shop_sum)){
                                                                $temp1_shop_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>店舗(免税外)</div>" . $temp1_shop_manthly_html . $temp1_shop_sum;
                                                            }
                                                            if(isset($temp1_shop_manthly_html2) && isset($temp1_shop_sum2)){
                                                                $temp1_shop_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>店舗(免税外)</div>" . $temp1_shop_manthly_html2 . $temp1_shop_sum2;
                                                            }
                                                            if(isset($temp1_shop_manthly_html3) && isset($temp1_shop_sum3)){
                                                                $temp1_shop_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>店舗(免税外)</div>" . $temp1_shop_manthly_html3 . $temp1_shop_sum3;
                                                            }
                                                    }

                                            // 通販用HTMLの作成
                                                $js_web_uriage  = "";
                                                $js_web_number  = "";
                                                $js_web_arari  = "";
                                                $temp1_web_manthly_html = "";
                                                $temp1_web_manthly_html2 = "";
                                                $temp1_web_manthly_html3 = "";
                                                if($out1_b == "ON"){     
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_now_array as $val){
                                                                //$val = mb_substr($val,0,-3);
                                                                if(strpos($temp1_web_manthly_data, $val ) !== false){
                                                                    $temp1_web_manthly_data = str_replace($val, 0, $temp1_web_manthly_data);
                                                                }
                                                                if(strpos($temp1_web_manthly_data2, $val ) !== false){
                                                                    $temp1_web_manthly_data2 = str_replace($val, 0, $temp1_web_manthly_data2);
                                                                }
                                                                if(strpos($temp1_web_manthly_data3, $val ) !== false){
                                                                    $temp1_web_manthly_data3 = str_replace($val, 0, $temp1_web_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $temp1_web_manthly_array = explode(',',$temp1_web_manthly_data);
                                                        $temp1_web_manthly_array2 = explode(',',$temp1_web_manthly_data2);
                                                        $temp1_web_manthly_array3 = explode(',',$temp1_web_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        //$web_last_uriage = "";

                                                        $i = 0;
                                                        foreach($temp1_web_manthly_array as $val){
                                                            // 【進捗率の取得】最終月の「現在・通販・売上」を取得
                                                                //$web_last_uriage = $val;

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_web_uriage  .= "0, ";
                                                                // 表示用
                                                                    $temp1_web_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_web_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp1_web_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp1_web_manthly_array2 as $val){
                                                            // 【進捗率の取得】最終月の「現在・通販・点数」を取得
                                                                //$web_last_number = $val;

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_web_number  .= "0, ";
                                                                // 表示用
                                                                    $temp1_web_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_web_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp1_web_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp1_web_manthly_array3 as $val){
                                                            // 【進捗率の取得】最終月の「現在・通販・粗利」を取得
                                                                //$web_last_arari = $val;
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_web_arari  .= "0, ";
                                                                // 表示用
                                                                    $temp1_web_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_web_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp1_web_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                    // 全体HTMLの作成
                                                            if(isset($temp1_web_manthly_html) && isset($temp1_web_sum)){
                                                                $temp1_web_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>通販(免税外)</div>" . $temp1_web_manthly_html . $temp1_web_sum;
                                                            }
                                                            if(isset($temp1_web_manthly_html2) && isset($temp1_web_sum2)){
                                                                $temp1_web_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>通販(免税外)</div>" . $temp1_web_manthly_html2 . $temp1_web_sum2;
                                                            }
                                                            if(isset($temp1_web_manthly_html3) && isset($temp1_web_sum3)){
                                                                $temp1_web_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>通販(免税外)</div>" . $temp1_web_manthly_html3 . $temp1_web_sum3;
                                                            }
                                                }



                                        // 店舗・通販(免税)用HTMLの作成
                                                $js_oroshi_uriage  = "";
                                                $js_oroshi_number  = "";
                                                $js_oroshi_arari  = "";
                                                $temp1_oroshi_manthly_html = "";
                                                $temp1_oroshi_manthly_html2 = "";
                                                $temp1_oroshi_manthly_html3 = "";
                                                if($out1_c == "ON"){     
                                                    // 過去全期間名の文字列で、年月名がそのまま記載されているものは「0」に変換（売上データが存在するは年月名を売上の数字に置き換え済なので、年月名がそのまま残っているものはデータ無なので）
                                                        foreach($manth_now_array as $val){
                                                                //$val = mb_substr($val,0,-3);
                                                                if(strpos($temp1_oroshi_manthly_data, $val ) !== false){
                                                                    $temp1_oroshi_manthly_data = str_replace($val, 0, $temp1_oroshi_manthly_data);
                                                                }
                                                                if(strpos($temp1_oroshi_manthly_data2, $val ) !== false){
                                                                    $temp1_oroshi_manthly_data2 = str_replace($val, 0, $temp1_oroshi_manthly_data2);
                                                                }
                                                                if(strpos($temp1_oroshi_manthly_data3, $val ) !== false){
                                                                    $temp1_oroshi_manthly_data3 = str_replace($val, 0, $temp1_oroshi_manthly_data3);
                                                                }
                                                        }
                                                    // 各月売上が記載された文字列を配列へ変換
                                                        $temp1_oroshi_manthly_array = explode(',',$temp1_oroshi_manthly_data);
                                                        $temp1_oroshi_manthly_array2 = explode(',',$temp1_oroshi_manthly_data2);
                                                        $temp1_oroshi_manthly_array3 = explode(',',$temp1_oroshi_manthly_data3);
                                                    // 各月のHTMLを作成
                                                        //$oroshi_last_uriage = "";
                                                        $i = 0;
                                                        foreach($temp1_oroshi_manthly_array as $val){
                                                            // 【進捗率の取得】最終月の「現在・店舗・通販(免税)・売上」を取得
                                                                //$oroshi_last_uriage = $val;

                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_oroshi_uriage  .= "0, ";
                                                                // 表示用
                                                                    $temp1_oroshi_manthly_html .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_oroshi_uriage  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp1_oroshi_manthly_html .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp1_oroshi_manthly_array2 as $val){
                                                            // 【進捗率の取得】最終月の「現在・店舗・通販(免税)・点数」を取得
                                                                //$oroshi_last_number = $val;
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_oroshi_number  .= "0, ";
                                                                // 表示用
                                                                    $temp1_oroshi_manthly_html2 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_oroshi_number  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp1_oroshi_manthly_html2 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }
                                                        $i = 0;
                                                        foreach($temp1_oroshi_manthly_array3 as $val){
                                                            // 【進捗率の取得】最終月の「現在・店舗・通販(免税)・粗利」を取得
                                                                //$oroshi_last_arari = $val;
                                                            
                                                            if($val == ""){
                                                                // JSグラフ用
                                                                    $js_oroshi_arari  .= "0, ";
                                                                // 表示用
                                                                    $temp1_oroshi_manthly_html3 .= "<div class='title3 ta_r'>0</div>";
                                                            } else {
                                                                // JSグラフ用
                                                                    $js_oroshi_arari  .= $val . ", ";
                                                                // 表示用
                                                                    if($val <> 0 && $val <> ""){$val = number_format((int)$val);}
                                                                    $temp1_oroshi_manthly_html3 .= "<div class='title3 ta_r'>" . $val . "</div>";
                                                            }
                                                            $i++;
                                                        }

                                                    // 全体HTMLの作成
                                                        if(isset($temp1_oroshi_manthly_html) && isset($temp1_oroshi_sum)){
                                                            $temp1_oroshi_manthly_html = "<div class='wid100 ul1'><div class='title1 ta_c'>店舗・通販(免税)</div>" . $temp1_oroshi_manthly_html . $temp1_oroshi_sum;
                                                        }
                                                        if(isset($temp1_oroshi_manthly_html2) && isset($temp1_oroshi_sum2)){
                                                            $temp1_oroshi_manthly_html2 = "<div class='wid100 ul1'><div class='title1 ta_c'>店舗・通販(免税)</div>" . $temp1_oroshi_manthly_html2 . $temp1_oroshi_sum2;
                                                        }
                                                        if(isset($temp1_oroshi_manthly_html3) && isset($temp1_oroshi_sum3)){
                                                            $temp1_oroshi_manthly_html3 = "<div class='wid100 ul1'><div class='title1 ta_c'>店舗・通販(免税)</div>" . $temp1_oroshi_manthly_html3 . $temp1_oroshi_sum3;
                                                        }
                                                }

                                        // 各月の全部門売上合計のJS表示用
                                                $js_all_month_uriage = "";
                                                $js_all_month_number = "";
                                                $js_all_month_arari = "";
                                                $i = 0;
                                                foreach($manth_now_array as $val){
                                                    $all_js = 0;
                                                    $all_js2 = 0;
                                                    $all_js3 = 0;
                                                    if($out1_a == "ON"){ $all_js = (int)$all_js + (int)$temp1_shop_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$temp1_shop_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$temp1_shop_manthly_array3[$i];}
                                                    if($out1_b == "ON"){ $all_js = (int)$all_js + (int)$temp1_web_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$temp1_web_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$temp1_web_manthly_array3[$i];}
                                                    if($out1_c == "ON"){ $all_js = (int)$all_js + (int)$temp1_oroshi_manthly_array[$i]; $all_js2 = (int)$all_js2 + (int)$temp1_oroshi_manthly_array2[$i]; $all_js3 = (int)$all_js3 + (int)$temp1_oroshi_manthly_array3[$i];}

                                                    $js_all_month_uriage .= $all_js . ", ";
                                                    $js_all_month_number .= $all_js2 . ", ";
                                                    $js_all_month_arari .= $all_js3 . ", ";
                                                    
                                                    $i++;
                                                }



                                        // 現在・通販・粗利率
                                        
                                            $i = 0;
                                            $web_ratio = "";
                                            $web_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>通販粗利率(免税外)</div>";
                                            $web_total = "";
                                            $web_total_js = "";
                                            $all_total = "";
                                            $web_total_ratio = "";
                                            $web_ratio_cutting = "";
                                            $web_ratio_cutting_ave = "";
                                            $web_ratio_cutting_html = "";
                                            foreach($temp1_web_manthly_array3 as $var){
                                                if($var == 0){
                                                    $web_ratio = "---";
                                                    $web_total = $web_total;
                                                    if($temp1_web_manthly_array[$i] == 0){
                                                        $all_total = $all_total;
                                                    } else {
                                                        $all_total = (int)$all_total + (int)$temp1_web_manthly_array[$i];
                                                    }
                                                } else {
                                                    $web_ratio = number_format((floor(($var / $temp1_web_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                    $web_total = (int)$web_total + (int)$var;
                                                    if($temp1_web_manthly_array[$i] == 0){
                                                        $all_total = $all_total;
                                                    } else {
                                                        $all_total = (int)$all_total + (int)$temp1_web_manthly_array[$i];
                                                    }
                                                }
                                                $web_total_js  .= (float)$web_ratio . ", ";
                                                $web_sum_arari_per .= "<div class='title6 ta_r'>" . $web_ratio . "%</div>";
                                        
                                                // 粗利率の過去比
                                                    if($web_ratio <> "" && $web_ratio <> "---" && ${"past_web_ratio_" .$i} <> "" && ${"past_web_ratio_" .$i} <> "---"){
                                                        $web_ratio_cutting = (float)$web_ratio - (float)${"past_web_ratio_" .$i};
                                                        $web_ratio_cutting = number_format($web_ratio_cutting, 1);
                                                        // 通販・全期間合計
                                                            $web_ratio_cutting_ave = (float)$web_ratio_cutting_ave + (float)$web_ratio_cutting;
                                                    }
                                                    //$web_ratio_cutting_html .= "<div class='title7 ta_r'>" . $web_ratio_cutting . "</div>";
                                                    if($web_ratio_cutting < 0){
                                                        $web_ratio_cutting_html .= "<div class='title7 ta_r fc_blue'>" . $web_ratio_cutting . "</div>";
                                                    } else {
                                                        $web_ratio_cutting_html .= "<div class='title7 ta_r fc_red'>" . $web_ratio_cutting . "</div>";
                                                    }
                                            
                                                $i++;
                                            }
                                            // 通販・全期間合計の平均
                                                $web_ratio_cutting_ave = number_format((float)$web_ratio_cutting_ave / $i, 2);
                                            
                                            // 粗利率の過去比(トータル値追加)
                                                //$web_ratio_cutting_ave_html = "<div class='title7 ta_r'>" . (float)$web_ratio_cutting_ave . "</div>";
                                                if($web_ratio_cutting_ave < 0){
                                                    $web_ratio_cutting_ave_html = "<div class='title7 ta_r fc_blue'>" . $web_ratio_cutting_ave . "</div>";
                                                } else {
                                                    $web_ratio_cutting_ave_html = "<div class='title7 ta_r fc_red'>" . $web_ratio_cutting_ave . "</div>";
                                                }
                                            
                                                $web_ratio_cutting_html = $web_ratio_cutting_html . $web_ratio_cutting_ave_html;
                                        
                                        
                                            // 通販用粗利率を取得
                                                if($web_total <> 0 && $all_total <> 0 && $web_total <> "" && $all_total <> ""){
                                                    $web_total_ratio = number_format((floor(((float)$web_total / (float)$all_total) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $web_total_ratio = "---";
                                                }
                                        
                                        
                                                
                                        
                                                $web_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $web_total_ratio . "%</div></div>";
                                        
                                        // 現在・店舗・粗利率
                                        
                                            $i = 0;
                                            $shop_ratio = "";
                                            $shop_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>店舗粗利率(免税外)</div>";
                                            $shop_total = "";
                                            $shop_total_js = "";
                                            $all_total = "";
                                            $shop_total_ratio = "";
                                            $shop_ratio_cutting = "";
                                            $shop_ratio_cutting_ave = "";
                                            $shop_ratio_cutting_html = "";
                                            foreach($temp1_shop_manthly_array3 as $var){
                                                if($var == 0){
                                                    $shop_ratio = "---";
                                                    $shop_total = $shop_total;
                                                    if($temp1_shop_manthly_array[$i] == 0){
                                                        $all_total = $all_total;
                                                    } else {
                                                        $all_total = (int)$all_total + (int)$temp1_shop_manthly_array[$i];
                                                    }
                                                } else {
                                                    $shop_ratio = number_format((floor(($var / $temp1_shop_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                    $shop_total = (int)$shop_total + (int)$var;
                                                    if($temp1_shop_manthly_array[$i] == 0){
                                                        $all_total = $all_total;
                                                    } else {
                                                        $all_total = (int)$all_total + (int)$temp1_shop_manthly_array[$i];
                                                    }
                                                }
                                                $shop_total_js  .= (float)$shop_ratio . ", ";
                                                $shop_sum_arari_per .= "<div class='title6 ta_r'>" . $shop_ratio . "%</div>";
                                        
                                                // 粗利率の過去比
                                                    if($shop_ratio <> "" && $shop_ratio <> "---" && ${"past_shop_ratio_" .$i} <> "" && ${"past_shop_ratio_" .$i} <> "---"){
                                                        $shop_ratio_cutting = (float)$shop_ratio - (float)${"past_shop_ratio_" .$i};
                                                        $shop_ratio_cutting = number_format($shop_ratio_cutting, 1);
                                                        // 店舗・全期間合計
                                                            $shop_ratio_cutting_ave = (float)$shop_ratio_cutting_ave + (float)$shop_ratio_cutting;
                                                        
                                                    }
                                                    //$shop_ratio_cutting_html .= "<div class='title7 ta_r'>" . $shop_ratio_cutting . "</div>";
                                                    if($shop_ratio_cutting < 0){
                                                        $shop_ratio_cutting_html .= "<div class='title7 ta_r fc_blue'>" . $shop_ratio_cutting . "</div>";
                                                    } else {
                                                        $shop_ratio_cutting_html .= "<div class='title7 ta_r fc_red'>" . $shop_ratio_cutting . "</div>";
                                                    }
                                            
                                                $i++;
                                            }
                                            // 店舗・全期間合計の平均
                                                $shop_ratio_cutting_ave = number_format((float)$shop_ratio_cutting_ave / $i, 2);
                                            // 粗利率の過去比(トータル値追加)
                                                //$shop_ratio_cutting_ave_html = "<div class='title7 ta_r'>" . (float)$shop_ratio_cutting_ave . "</div>";
                                                if($shop_ratio_cutting_ave < 0){
                                                    $shop_ratio_cutting_ave_html = "<div class='title7 ta_r fc_blue'>" . $shop_ratio_cutting_ave . "</div>";
                                                } else {
                                                    $shop_ratio_cutting_ave_html = "<div class='title7 ta_r fc_red'>" . $shop_ratio_cutting_ave . "</div>";
                                                }
                                                $shop_ratio_cutting_html = $shop_ratio_cutting_html . $shop_ratio_cutting_ave_html;
                                                
                                            // 現在・店舗用粗利率を取得
                                                if($shop_total <> 0 && $all_total <> 0 && $shop_total <> "" && $all_total <> ""){
                                                    $shop_total_ratio = number_format((floor(((float)$shop_total / (float)$all_total) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $shop_total_ratio = "---";
                                                }
                                        
                                                $shop_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $shop_total_ratio . "%</div></div>";
                                        
                                        
                                        // 現在・店舗・通販(免税)・粗利率
                                            $oroshi_total_js = "";
                                            $oroshi_ratio_cutting = "";
                                            $oroshi_ratio_cutting_ave = "";
                                            $oroshi_ratio_cutting_html = "";
                                            if($out1_c == "ON"){
                                        
                                        		    $i = 0;
                                        		    $oroshi_ratio = "";
                                        		    $oroshi_sum_arari_per = "<div class='wid100 ul1'><div class='title5 ta_c'>店舗・通販粗利率(免税)</div>";
                                        		    $oroshi_total = "";
                                        		    $all_total = "";
                                        		    $oroshi_total_ratio = "";
                                        		    foreach($temp1_oroshi_manthly_array3 as $var){
                                        		        if($var == 0){
                                        		            $oroshi_ratio = "---";
                                        		            $oroshi_total = $oroshi_total;
                                        		            if($temp1_oroshi_manthly_array[$i] == 0){
                                        		                $all_total = $all_total;
                                        		            } else {
                                        		                $all_total = (int)$all_total + (int)$temp1_oroshi_manthly_array[$i];
                                        		            }
                                        		        } else {
                                        		            $oroshi_ratio = number_format((floor(($var / $temp1_oroshi_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                        		            $oroshi_total = (int)$oroshi_total + (int)$var;
                                        		            if($temp1_oroshi_manthly_array[$i] == 0){
                                        		                $all_total = $all_total;
                                        		            } else {
                                        		                $all_total = (int)$all_total + (int)$temp1_oroshi_manthly_array[$i];
                                        		            }
                                        		        }
                                                        $oroshi_total_js  .= (float)$oroshi_ratio . ", ";
                                        		        $oroshi_sum_arari_per .= "<div class='title6 ta_r'>" . $oroshi_ratio . "%</div>";
                                        
                                                        // 粗利率の過去比
                                                            if($oroshi_ratio <> "" && $oroshi_ratio <> "---" && ${"past_oroshi_ratio_" .$i} <> "" && ${"past_oroshi_ratio_" .$i} <> "---"){
                                                                $oroshi_ratio_cutting = (float)$oroshi_ratio - (float)${"past_oroshi_ratio_" .$i};
                                                                $oroshi_ratio_cutting = number_format($oroshi_ratio_cutting, 1);
                                                                // 店舗・通販(免税)・全期間合計
                                                                    $oroshi_ratio_cutting_ave = (float)$oroshi_ratio_cutting_ave + (float)$oroshi_ratio_cutting;
                                                            }
                                                            //$oroshi_ratio_cutting_html .= "<div class='title7 ta_r'>" . $oroshi_ratio_cutting . "</div>";
                                                            if($oroshi_ratio_cutting < 0){
                                                                $oroshi_ratio_cutting_html .= "<div class='title7 ta_r fc_blue'>" . $oroshi_ratio_cutting . "</div>";
                                                            } else {
                                                                $oroshi_ratio_cutting_html .= "<div class='title7 ta_r fc_red'>" . $oroshi_ratio_cutting . "</div>";
                                                            }
                                                    
                                                        $i++;
                                                    }
                                                    // 店舗・通販(免税)・全期間合計の平均
                                                        $oroshi_ratio_cutting_ave = number_format((float)$oroshi_ratio_cutting_ave / $i, 2);
                                                    // 粗利率の過去比(トータル値追加)
                                                        //$oroshi_ratio_cutting_ave_html = "<div class='title7 ta_r'>" . (float)$oroshi_ratio_cutting_ave . "</div>";
                                                        if($oroshi_ratio_cutting_ave < 0){
                                                            $oroshi_ratio_cutting_ave_html = "<div class='title7 ta_r fc_blue'>" . $oroshi_ratio_cutting_ave . "</div>";
                                                        } else {
                                                            $oroshi_ratio_cutting_ave_html = "<div class='title7 ta_r fc_red'>" . $oroshi_ratio_cutting_ave . "</div>";
                                                        }
                                        
                                                        $oroshi_ratio_cutting_html = $oroshi_ratio_cutting_html . $oroshi_ratio_cutting_ave_html;
                                        		    // 現在・店舗・通販(免税)用粗利率を取得
                                                        if($oroshi_total == 0 || $oroshi_total == "" || $all_total == 0 || $all_total == ""){
                                                            $oroshi_total_ratio = "---";
                                                        } else {
                                        		            $oroshi_total_ratio = number_format((floor(((float)$oroshi_total / (float)$all_total) * 100 * 10)) / 10 ,1);
                                                        }
                                        
                                        		        $oroshi_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $oroshi_total_ratio . "%</div></div>";
                                            }
                                        
                                        
                                        
                                        // 現在・金額構成比
                                        
                                            $i = 0;
                                            $total = "";
                                            $total2 = 0;
                                            $web_per = "";
                                            $shop_per = "";
                                            $oroshi_per = "";
                                            $web_total = "";
                                            $shop_total = "";
                                            $oroshi_total = "";
                                            $web_per_html = "";
                                            $shop_per_html = "";
                                            $oroshi_per_html = "";
                                            $web_total_js2 = "";
                                            $shop_total_js2 = "";
                                            $oroshi_total_js2 = "";
                                            foreach($temp1_web_manthly_array as $var){
                                                //echo $temp1_shop_manthly_array[$i] . "<br>";
                                                if($out1_c == "ON"){
                                                    $total = (int)$var + (int)$temp1_shop_manthly_array[$i] + (int)$temp1_oroshi_manthly_array[$i];
                                                } else {
                                                    $total = (int)$var + (int)$temp1_shop_manthly_array[$i];
                                                }
                                                $total2 = (int)$total2 + (int)$total;
                                                $web_total = (int)$web_total + (int)$var;
                                                $shop_total = (int)$shop_total + (int)$temp1_shop_manthly_array[$i];
                                                if($out1_c == "ON"){ $oroshi_total = (int)$oroshi_total + (int)$temp1_oroshi_manthly_array[$i]; }
                                                if($var == 0){
                                                    $web_per = "---";
                                                    if($temp1_shop_manthly_array[$i] == 0){
                                                        $shop_per = "---";
                                                    } else {
                                                        if($out1_c == "ON"){ 
                                                            if($temp1_shop_manthly_array[$i] <> 0 && $total <> 0 && $temp1_shop_manthly_array[$i] <> "" && $total <> ""){
                                                                $shop_per = number_format((floor(($temp1_shop_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
                                                            } else {
                                                                $shop_per = "---"; 
                                                            }
                                                        } else {
                                                            //$shop_per = 100 - $web_per;
                                                            $shop_per = number_format(bcsub('100', ((float)$web_per), 1) ,1);
                                                        }
                                                    }
                                                    if($out1_c == "ON"){
                                                        if($temp1_oroshi_manthly_array[$i] == 0){
                                                            $oroshi_per = "---";
                                                        } else {
                                                            //$oroshi_per = 100 - $web_per - $shop_per;
                                                            //20240823$oroshi_per = number_format(bcsub('100', ($web_per + $shop_per), 1) ,1);
                                                            $oroshi_per = number_format(bcsub('100', ((int)$web_per + (int)$shop_per), 1) ,1);
                                                        }
                                                    }
                                                } else {
                                                    $web_per = number_format((floor(($var / $total) * 100 * 10)) / 10 ,1);
                                                    if($temp1_shop_manthly_array[$i] == 0){
                                                        $shop_per = "---";
                                                    } else {
                                                        if($out1_c == "ON"){ $shop_per = number_format((floor(($temp1_shop_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); } else {$shop_per = 100 - $web_per;}
                                                    }
                                                    if($out1_c == "ON"){
                                                        if($temp1_oroshi_manthly_array[$i] == 0){
                                                            $oroshi_per = "---";
                                                        } else {
                                                            //$oroshi_per = 100 - $web_per - $shop_per;
                                                            $oroshi_per = number_format(bcsub('100', ($web_per + $shop_per), 1) ,1);
                                                        }
                                                    }
                                                }
                                                $web_per_html .= "<div class='title7 ta_r'>" . $web_per . "%</div>";
                                                $shop_per_html .= "<div class='title7 ta_r'>" . $shop_per . "%</div>";
                                                $web_total_js2  .= (float)$web_per . ", ";
                                                $shop_total_js2  .= (float)$shop_per . ", ";
                                                if($out1_c == "ON"){
                                                    $oroshi_per_html .= "<div class='title7 ta_r'>" . $oroshi_per . "%</div>";
                                                    $oroshi_total_js2  .= (float)$oroshi_per . ", ";
                                                }
                                                //echo $web_per . "(" . $shop_per . ")<br>";
                                        
                                                $i++;
                                            }
                                            // 期間中の売上合計に対するパーセンテージを取得
                                               // $web_total_per = $web_total / $i;
                                                if($web_total <> 0 && $total2 <> 0 && $web_total <> "" && $total2 <> ""){
                                                    $web_total_per = number_format((floor(((float)$web_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $web_total_per = "---";
                                                }
                                                if($shop_total <> 0 && $total2 <> 0 && $shop_total <> "" && $total2 <> ""){
                                                    $shop_total_per = number_format((floor(((float)$shop_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $shop_total_per = "---";
                                                }
                                                //if($out1_c == "ON"){ $oroshi_total_per = 100 - ((float)$web_total_per + (float)$shop_total_per); }
                                                if($out1_c == "ON"){ $oroshi_total_per = number_format(bcsub('100', ((float)$web_total_per + (float)$shop_total_per), 1), 1);}
                                        
                                                $web_per_html .= "<div class='title7 ta_r'>" . $web_total_per . "%</div>";
                                                $shop_per_html .= "<div class='title7 ta_r'>" . $shop_total_per . "%</div>";
                                                if($out1_c == "ON"){ $oroshi_per_html .= "<div class='title7 ta_r'>" . $oroshi_total_per. "%</div>";}
                                        
                                        
                                            $temp1_all_sorce4 = "<p class='title_a'>金額・構成比</p><div class='box1'>" . $temp1_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>店舗(免税外)    </div>" . $shop_per_html . "</div>";
                                            $temp1_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>通販(免税外)</div>" . $web_per_html . "</div>";
                                            if($out1_c == "ON"){$temp1_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>店舗・通販(免税)</div>" . $oroshi_per_html . "</div>";}
                                            $temp1_all_sorce4 .= "</div>";
                                        
                                        
                                        
                                        
                                            // 現在・点数構成比
                                        
                                            $i = 0;
                                            $total = "";
                                            $total2 = 0;
                                            $web_per = "";
                                            $shop_per = "";
                                            $oroshi_per = "";
                                            $web_total = "";
                                            $shop_total = "";
                                            $oroshi_total = "";
                                            $web_per_html = "";
                                            $shop_per_html = "";
                                            $oroshi_per_html = "";
                                            $web_total_js3 = "";
                                            $shop_total_js3 = "";
                                            $oroshi_total_js3 = "";
                                            foreach($temp1_web_manthly_array2 as $var){
                                                //echo $temp1_shop_manthly_array2[$i] . "<br>";
                                                if($out1_c == "ON"){
                                                    $total = (int)$var + (int)$temp1_shop_manthly_array2[$i] + (int)$temp1_oroshi_manthly_array2[$i];
                                                } else {
                                                    $total = (int)$var + (int)$temp1_shop_manthly_array2[$i];
                                                }
                                                $total2 = (int)$total2 + (int)$total;
                                                $web_total = (int)$web_total + (int)$var;
                                                $shop_total = (int)$shop_total + (int)$temp1_shop_manthly_array2[$i];
                                                if($out1_c == "ON"){ $oroshi_total = (int)$oroshi_total + (int)$temp1_oroshi_manthly_array2[$i]; }
                                                if($var == 0){
                                                    $web_per = "---";
                                                    if($temp1_shop_manthly_array2[$i] == 0){
                                                        $shop_per = "---";
                                                    } else {
                                                        if($out1_c == "ON"){ 
                                                            if($temp1_shop_manthly_array2[$i] <> 0 && $total <> 0 && $temp1_shop_manthly_array2[$i] <> "" && $total <> ""){
                                                                $shop_per = number_format((floor(($temp1_shop_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
                                                            } else {
                                                                $shop_per = "---"; 
                                                            }
                                                        } else {
                                                            //$shop_per = 100 - $web_per;
                                                            $shop_per = number_format(bcsub('100', ((float)$web_per), 1) ,1);
                                                    }
                                                    }
                                                    if($out1_c == "ON"){
                                                        if($temp1_oroshi_manthly_array2[$i] == 0){
                                                            $oroshi_per = "---";
                                                        } else {
                                                            //$oroshi_per = 100 - $web_per - $shop_per;
                                                            //20240823$oroshi_per = number_format(bcsub('100', ($web_per + $shop_per), 1) ,1);
                                                            $oroshi_per = number_format(bcsub('100', ((int)$web_per + (int)$shop_per), 1) ,1);
                                                        }
                                                    }
                                                } else {
                                                    $web_per = number_format((floor(($var / $total) * 100 * 10)) / 10 ,1);
                                                    if($temp1_shop_manthly_array2[$i] == 0){
                                                        $shop_per = "---";
                                                    } else {
                                                        if($out1_c == "ON"){ $shop_per = number_format((floor(($temp1_shop_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); } else {$shop_per = number_format(100 - $web_per ,1);}
                                                    }
                                                    if($out1_c == "ON"){
                                                        if($temp1_oroshi_manthly_array2[$i] == 0){
                                                            $oroshi_per = "---";
                                                        } else {
                                                            //$oroshi_per = 100 - $web_per - $shop_per;
                                                            $oroshi_per = number_format(bcsub('100', ($web_per + $shop_per), 1) ,1);
                                                        }
                                                    }
                                                }
                                                $web_per_html .= "<div class='title7 ta_r'>" . $web_per . "%</div>";
                                                $shop_per_html .= "<div class='title7 ta_r'>" . $shop_per . "%</div>";
                                                $web_total_js3  .= (float)$web_per . ", ";
                                                $shop_total_js3  .= (float)$shop_per . ", ";
                                                if($out1_c == "ON"){
                                                    $oroshi_per_html .= "<div class='title7 ta_r'>" . $oroshi_per . "%</div>";
                                                    $oroshi_total_js3  .= (float)$oroshi_per . ", ";
                                                }
                                                //echo $web_per . "(" . $shop_per . ")<br>";
                                        
                                                $i++;
                                            }
                                            // 期間中の売上合計点数に対するパーセンテージを取得
                                               // $web_total_per = $web_total / $i;
                                                if($web_total <> 0 && $total2 <> 0 && $web_total <> "" && $total2 <> ""){
                                                    $web_total_per = number_format((floor(((float)$web_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $web_total_per = "---";
                                                }
                                                if($shop_total <> 0 && $total2 <> 0 && $shop_total <> "" && $total2 <> ""){
                                                    $shop_total_per = number_format((floor(((float)$shop_total / (float)$total2) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $shop_total_per = "---";
                                                }
                                                //if($out1_c == "ON"){ $oroshi_total_per = 100 - $web_total_per - $shop_total_per; }
                                                if($out1_c == "ON"){ $oroshi_total_per = number_format(bcsub('100', ((float)$web_total_per + (float)$shop_total_per), 1) ,1);}
                                        
                                        
                                                $web_per_html .= "<div class='title7 ta_r'>" . $web_total_per . "%</div>";
                                                $shop_per_html .= "<div class='title7 ta_r'>" . $shop_total_per . "%</div>";
                                                if($out1_c == "ON"){ $oroshi_per_html .= "<div class='title7 ta_r'>" . $oroshi_total_per . "%</div>";}
                                        
                                        
                                            $temp1_all_sorce5 = "<p class='title_a'>点数・構成比</p><div class='box1'>" . $temp1_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>店舗(免税外)</div>" . $shop_per_html . "</div>";
                                            $temp1_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>通販(免税外)</div>" . $web_per_html . "</div>";
                                            if($out1_c == "ON"){$temp1_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>店舗・通販(免税)</div>" . $oroshi_per_html . "</div>";}
                                            $temp1_all_sorce5 .= "</div>";
                                        
                                        
                                        
                                        // 現在・平均単価
                                        
                                            $i = 0;
                                            $web_average = "";
                                            $web_ave_html = "";
                                            $web_total = "";
                                            $web_total2 = "";
                                            $web_total_ave = "";
                                            foreach($temp1_web_manthly_array as $var){
                                        
                                                if($var == 0){
                                                    $web_average = 0;
                                                    $web_total = (int)$web_total + (int)$var;
                                                    if($temp1_web_manthly_array2[$i] == 0){
                                                        $web_total2 = $web_total2;
                                                    } else {
                                                        $web_total2 = (int)$web_total2 + (int)$temp1_web_manthly_array2[$i];
                                                    }
                                                } else {
                                                    $web_average = (floor(((int)$var / (int)$temp1_web_manthly_array2[$i])) * 10) / 10;
                                                    $web_total = (int)$web_total + (int)$var;
                                                    if($temp1_web_manthly_array2[$i] == 0){
                                                        $web_total2 = $web_total2;
                                                    } else {
                                                        $web_total2 = (int)$web_total2 + (int)$temp1_web_manthly_array2[$i];
                                                    }
                                                }
                                                if($web_average <> 0 && $web_average <> ""){$web_average = number_format((int)$web_average);}
                                                $web_ave_html .= "<div class='title7 ta_r'>" . $web_average . "</div>";
                                        
                                                $i++;
                                            }
                                            // 期間中の売上合計に対する平均単価を取得
                                                if($web_total <> 0 && $web_total2 <> 0 && $web_total <> "" && $web_total2 <> ""){
                                                    $web_total_ave = (floor(((int)$web_total / (int)$web_total2) * 10)) / 10;
                                                } else {
                                                    $web_total_ave = "---";
                                                }
                                                if($web_total_ave <> 0 && $web_total_ave <> ""){$web_total_ave = number_format((int)$web_total_ave);}
                                                $web_ave_html .= "<div class='title7 ta_r'>" . $web_total_ave . "</div>";
                                        
                                            $i = 0;
                                            $shop_average = "";
                                            $shop_ave_html = "";
                                            $shop_total = "";
                                            $shop_total2 = "";
                                            $shop_total_ave = "";
                                            foreach($temp1_shop_manthly_array as $var){
                                        
                                                if($var == 0){
                                                    $shop_average = 0;
                                                    $shop_total = (int)$shop_total + (int)$var;
                                                    if($temp1_shop_manthly_array2[$i] == 0){
                                                        $shop_total2 = $shop_total2;
                                                    } else {
                                                        $shop_total2 = (int)$shop_total2 + (int)$temp1_shop_manthly_array2[$i];
                                                    }
                                                } else {
                                                    $shop_average = (floor(((int)$var / (int)$temp1_shop_manthly_array2[$i])) * 10) / 10;
                                                    $shop_total = (int)$shop_total + (int)$var;
                                                    if($temp1_shop_manthly_array2[$i] == 0){
                                                        $shop_total2 = $shop_total2;
                                                    } else {
                                                        $shop_total2 = (int)$shop_total2 + (int)$temp1_shop_manthly_array2[$i];
                                                    }
                                                }
                                                if($shop_average <> 0 && $shop_average <> ""){$shop_average = number_format((int)$shop_average);}
                                                $shop_ave_html .= "<div class='title7 ta_r'>" . $shop_average . "</div>";
                                        
                                                $i++;
                                            }
                                            // 期間中の売上合計に対する平均単価を取得
                                                if($shop_total <> 0 && $shop_total2 <> 0 && $shop_total <> "" && $shop_total2 <> ""){
                                                    $shop_total_ave = (floor(((int)$shop_total / (int)$shop_total2) * 10)) / 10;
                                                } else {
                                                    "---";
                                                }
                                                if($shop_total_ave <> 0 && $shop_total_ave <> ""){$shop_total_ave = number_format((int)$shop_total_ave);}
                                                $shop_ave_html .= "<div class='title7 ta_r'>" . $shop_total_ave . "</div>";
                                        
                                        
                                                if($out1_c == "ON"){    
                                                    $i = 0;
                                                    $oroshi_average = "";
                                                    $oroshi_ave_html = "";
                                                    $oroshi_total = "";
                                                    $oroshi_total2 = "";
                                                    $oroshi_total_ave = "";
                                                    foreach($temp1_oroshi_manthly_array as $var){
                                        
                                                        if($var == 0){
                                                            $oroshi_average = 0;
                                                            $oroshi_total = (int)$oroshi_total + (int)$var;
                                                            if($temp1_oroshi_manthly_array2[$i] == 0){
                                                                $oroshi_total2 = $oroshi_total2;
                                                            } else {
                                                                $oroshi_total2 = (int)$oroshi_total2 + (int)$temp1_oroshi_manthly_array2[$i];
                                                            }
                                                        } else {
                                                            $oroshi_average = (floor(((int)$var / (int)$temp1_oroshi_manthly_array2[$i])) * 10) / 10;
                                                            $oroshi_total = (int)$oroshi_total + (int)$var;
                                                            if($temp1_oroshi_manthly_array2[$i] == 0){
                                                                $oroshi_total2 = $oroshi_total2;
                                                            } else {
                                                                $oroshi_total2 = (int)$oroshi_total2 + (int)$temp1_oroshi_manthly_array2[$i];
                                                            }
                                                        }
                                                        if($oroshi_average <> 0 && $oroshi_average <> ""){$oroshi_average = number_format((int)$oroshi_average);}
                                                        $oroshi_ave_html .= "<div class='title7 ta_r'>" . $oroshi_average . "</div>";
                                        
                                                        $i++;
                                                    }
                                                    // 期間中の売上合計に対する平均単価を取得
                                                        if($oroshi_total == 0 || $oroshi_total2 == 0 || $oroshi_total == "" || $oroshi_total2 == ""){
                                                            $oroshi_total_ave = "---";
                                                        } else {
                                                            $oroshi_total_ave = (floor(((int)$oroshi_total / (int)$oroshi_total2) * 10)) / 10;
                                                        }
                                                        if($oroshi_total_ave <> 0 && $oroshi_total_ave <> ""){$oroshi_total_ave = number_format((int)$oroshi_total_ave);}
                                                        $oroshi_ave_html .= "<div class='title7 ta_r'>" . $oroshi_total_ave . "</div>";
                                                }
                                        
                                        
                                            $temp1_all_sorce6 = "<p class='title_a'>平均単価</p><div class='box1'>" . $temp1_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>店舗(免税外)</div>" . $shop_ave_html . "</div>";
                                            $temp1_all_sorce6 .= "<div class='wid100 ul4'><div class='title7 ta_c'>通販(免税外)</div>" . $web_ave_html . "</div>";
                                            if($out1_c == "ON"){$temp1_all_sorce6 .= "<div class='wid100 ul4'><div class='title7 ta_c'>店舗・通販(免税)</div>" . $oroshi_ave_html . "</div>";}
                                            $temp1_all_sorce6 .= "</div>";
                                        
                                        
                                        // 通販・金額・過去比
                                        
                                            $i = 0;
                                            $web_ratio = "";
                                            $web_ratio_html = "";
                                            $web_total = "";
                                            $web_total_past = "";
                                            $web_total_ratio = "";
                                            foreach($temp1_web_manthly_array as $var){
                                                if($var == 0){
                                                    $web_ratio = "---";
                                                    $web_total = $web_total;
                                                    if($past_temp1_web_manthly_array[$i] == 0){
                                                        $web_total_past = $web_total_past;
                                                    } else {
                                                        $web_total_past = (int)$web_total_past + (int)$past_temp1_web_manthly_array[$i];
                                                    }
                                                } else {
                                                    if($var == 0 || $past_temp1_web_manthly_array[$i] == 0 || $var == "" || $past_temp1_web_manthly_array[$i] == ""){
                                                        $web_ratio = "---";
                                                    } else { 
                                                        $web_ratio = number_format((floor(($var / $past_temp1_web_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                    }
                                                    $web_total = (int)$web_total + (int)$var;
                                                    if($past_temp1_web_manthly_array[$i] == 0){
                                                        $web_total_past = $web_total_past;
                                                    } else {
                                                        $web_total_past = (int)$web_total_past + (int)$past_temp1_web_manthly_array[$i];
                                                    }
                                                }
                                                if($web_ratio < 100){
                                                    $web_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $web_ratio . "%</div>";
                                                } else {
                                                    $web_ratio_html .= "<div class='title7 ta_r fc_red'>" . $web_ratio . "%</div>";
                                                }
                                        
                                                $i++;
                                            }
                                            // 過去の同期間売上金額に対する比率を取得
                                                if($web_total <> 0 && $web_total_past <> 0 && $web_total <> "" && $web_total_past <> ""){
                                                    $web_total_ratio = number_format((floor(((float)$web_total / (float)$web_total_past) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $web_total_ratio = "---";
                                                }
                                        
                                                if($web_total_ratio < 100){
                                                    $web_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $web_total_ratio . "%</div>";
                                                } else {
                                                    $web_ratio_html .= "<div class='title7 ta_r fc_red'>" . $web_total_ratio . "%</div>";
                                                }
                                        
                                        
                                        // 店舗・金額・過去比
                                        
                                            $i = 0;
                                            $shop_ratio = "";
                                            $shop_ratio_html = "";
                                            $shop_total = "";
                                            $shop_total_past = "";
                                            $shop_total_ratio = "";
                                            foreach($temp1_shop_manthly_array as $var){
                                                if($var == 0){
                                                    $shop_ratio = "---";
                                                    $shop_total = $shop_total;
                                                    if($past_temp1_shop_manthly_array[$i] == 0){
                                                        $shop_total_past = $shop_total_past;
                                                    } else {
                                                        $shop_total_past = (int)$shop_total_past + (int)$past_temp1_shop_manthly_array[$i];
                                                    }
                                                } else {
                                                    if($var == 0 || $past_temp1_shop_manthly_array[$i] == 0 || $var == "" || $past_temp1_shop_manthly_array[$i] == ""){
                                                        $shop_ratio = "---";
                                                    } else {
                                                        $shop_ratio = number_format((floor(($var / $past_temp1_shop_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                    }
                                                    $shop_total = (int)$shop_total + (int)$var;
                                                    if($past_temp1_shop_manthly_array[$i] == 0){
                                                        $shop_total_past = $shop_total_past;
                                                    } else {
                                                        $shop_total_past = (int)$shop_total_past + (int)$past_temp1_shop_manthly_array[$i];
                                                    }
                                                }
                                                if($shop_ratio < 100){
                                                    $shop_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $shop_ratio . "%</div>";
                                                } else {
                                                    $shop_ratio_html .= "<div class='title7 ta_r fc_red'>" . $shop_ratio . "%</div>";
                                                }
                                                
                                        
                                                $i++;
                                            }
                                            // 過去の同期間売上金額に対する比率を取得
                                                if($web_total <> 0 && $web_total_past <> 0 && $web_total <> "" && $web_total_past <> ""){
                                                    $shop_total_ratio = number_format((floor(((float)$shop_total / (float)$shop_total_past) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $shop_total_ratio = "---";
                                                }
                                        
                                                if($shop_total_ratio < 100){
                                                    $shop_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $shop_total_ratio . "%</div>";
                                                } else {
                                                    $shop_ratio_html .= "<div class='title7 ta_r fc_red'>" . $shop_total_ratio . "%</div>";
                                                }
                                                
                                            if($out1_c == "ON"){
                                                // 店舗・通販(免税)・金額・過去比
                                                    $i = 0;
                                                    $oroshi_ratio = "";
                                                    $oroshi_ratio_html = "";
                                                    $oroshi_total = "";
                                                    $oroshi_total_past = "";
                                                    $oroshi_total_ratio = "";
                                                    foreach($temp1_oroshi_manthly_array as $var){
                                                        if($var == 0){
                                                            $oroshi_ratio = "---";
                                                            $oroshi_total = $oroshi_total;
                                                            if($past_temp1_oroshi_manthly_array[$i] == 0){
                                                                $oroshi_total_past = $oroshi_total_past;
                                                            } else {
                                                                $oroshi_total_past = (int)$oroshi_total_past + (int)$past_temp1_oroshi_manthly_array[$i];
                                                            }
                                                        } else {
                                                            if($var == 0 || $past_temp1_oroshi_manthly_array[$i] == 0 || $var == "" || $past_temp1_oroshi_manthly_array[$i] == ""){
                                                                $oroshi_ratio = "---";
                                                            } else {
                                                                $oroshi_ratio = number_format((floor(($var / $past_temp1_oroshi_manthly_array[$i]) * 100 * 10)) / 10 ,1);
                                                            }
                                                            $oroshi_total = (int)$oroshi_total + (int)$var;
                                                            if($past_temp1_oroshi_manthly_array[$i] == 0){
                                                                $oroshi_total_past = $oroshi_total_past;
                                                            } else {
                                                                $oroshi_total_past = (int)$oroshi_total_past + (int)$past_temp1_oroshi_manthly_array[$i];
                                                            }
                                                        }
                                        
                                                        if($oroshi_ratio < 100){
                                                            $oroshi_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $oroshi_ratio . "%</div>";
                                                        } else {
                                                            $oroshi_ratio_html .= "<div class='title7 ta_r fc_red'>" . $oroshi_ratio . "%</div>";
                                                        }
                                                
                                                        $i++;
                                                    }
                                                    // 過去の同期間売上金額に対する比率を取得
                                                        if($oroshi_total == 0 || $oroshi_total_past == 0 || $oroshi_total == "" || $oroshi_total_past == ""){
                                                            $oroshi_total_ratio = "---";
                                                        } else {
                                                            $oroshi_total_ratio = number_format((floor(((int)$oroshi_total / (int)$oroshi_total_past) * 100 * 10)) / 10 ,1);
                                                        }
                                        
                                                        if($oroshi_total_ratio < 100){
                                                            $oroshi_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $oroshi_total_ratio . "%</div>";
                                                        } else {
                                                            $oroshi_ratio_html .= "<div class='title7 ta_r fc_red'>" . $oroshi_total_ratio . "%</div>";
                                                        }
                                                        
                                            }
                                        
                                        
                                        // 通販・店舗・店舗・通販(免税)合計・金額・過去比
                                        
                                            $i = 0;
                                            $ratio = "";
                                            $ratio_html = "";
                                            $total = "";
                                            $total_past = "";
                                            $total_ratio = "";
                                            foreach($temp1_web_manthly_array as $var){
                                                if($var == 0 && $temp1_shop_manthly_array[$i] == 0/* && $temp1_oroshi_manthly_array[$i] == 0*/){
                                                    $ratio = 0;
                                                    $total = $total;
                                                    if($past_temp1_web_manthly_array[$i] == 0 && $past_temp1_shop_manthly_array[$i] == 0/* && $past_temp1_oroshi_manthly_array[$i] == 0*/){
                                                        $total_past = $total_past;
                                                    } else {
                                                        if($out1_c == "ON"){
                                                            $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array[$i] + (int)$past_temp1_shop_manthly_array[$i] + (int)$past_temp1_oroshi_manthly_array[$i];
                                                        } else {
                                                            $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array[$i] + (int)$past_temp1_shop_manthly_array[$i];
                                                        }
                                                    }
                                                } else {
                                                    if($out1_c == "ON"){
                                                        if((int)$var + (int)$temp1_shop_manthly_array[$i] + (int)$temp1_oroshi_manthly_array[$i] == 0 || (int)$past_temp1_web_manthly_array[$i] + (int)$past_temp1_shop_manthly_array[$i] + (int)$past_temp1_oroshi_manthly_array[$i] == 0){
                                                            $ratio = "---";
                                                        } else {
                                                            $ratio = number_format((floor((((int)$var + (int)$temp1_shop_manthly_array[$i] + (int)$temp1_oroshi_manthly_array[$i]) / ((int)$past_temp1_web_manthly_array[$i] + (int)$past_temp1_shop_manthly_array[$i] + (int)$past_temp1_oroshi_manthly_array[$i])) * 100 * 10)) / 10 ,1);
                                                        }
                                                        $total = (int)$total + (int)$var + (int)$temp1_shop_manthly_array[$i] + (int)$temp1_oroshi_manthly_array[$i];
                                                    } else {
                                                        if((int)$var + (int)$temp1_shop_manthly_array[$i] == 0 || (int)$past_temp1_web_manthly_array[$i] + (int)$past_temp1_shop_manthly_array[$i] == 0){
                                                            $ratio = "---";
                                                        } else {
                                                            $ratio = number_format((floor((((int)$var + (int)$temp1_shop_manthly_array[$i]) / ((int)$past_temp1_web_manthly_array[$i] + (int)$past_temp1_shop_manthly_array[$i])) * 100 * 10)) / 10 ,1);
                                                        }
                                                        $total = (int)$total + (int)$var + (int)$temp1_shop_manthly_array[$i];
                                                    }
                                                    if($out1_c == "ON"){
                                                        if($past_temp1_web_manthly_array[$i] == 0 && $past_temp1_shop_manthly_array[$i] == 0 && $past_temp1_oroshi_manthly_array[$i] == 0){
                                                            $total_past = $total_past;
                                                        } else {
                                                            $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array[$i] + (int)$past_temp1_shop_manthly_array[$i] + (int)$past_temp1_oroshi_manthly_array[$i];
                                                        }
                                                    } else {
                                                        if($past_temp1_web_manthly_array[$i] == 0 && $past_temp1_shop_manthly_array[$i] == 0){
                                                            $total_past = $total_past;
                                                        } else {
                                                            $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array[$i] + (int)$past_temp1_shop_manthly_array[$i];
                                                        }
                                                    }
                                                }
                                                //$ratio_html .= "<div class='title7 ta_r'>" . $ratio . "%</div>";
                                        
                                                if($ratio < 100){
                                                    $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ratio . "%</div>";
                                                } else {
                                                    $ratio_html .= "<div class='title7 ta_r fc_red'>" . $ratio . "%</div>";
                                                }
                                        
                                                $i++;
                                            }
                                            // 過去の同期間売上金額に対する比率を取得
                                                if($total <> 0 && $total_past <> 0 && $total <> "" && $total_past <> ""){
                                                    $total_ratio = number_format((floor(((float)$total / (float)$total_past) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $total_ratio = "---";
                                                }
                                        
                                                //$ratio_html .= "<div class='title7 ta_r bg_grey'>" . $total_ratio . "%</div>";
                                        
                                                if($total_ratio < 100){
                                                    $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $total_ratio . "%</div>";
                                                } else {
                                                    $ratio_html .= "<div class='title7 ta_r fc_red'>" . $total_ratio . "%</div>";
                                                }
                                        
                                        
                                            $temp1_all_sorce7 = "<p class='title_a'>金額・過去比</p><div class='box1'>" . $temp1_title5 . "<div class='wid100 ul4'><div class='title7 ta_c'>店舗(免税外)</div>" . $shop_ratio_html . "</div>";
                                            $temp1_all_sorce7 .= "<div class='wid100 ul4'><div class='title7 ta_c'>通販(免税外)</div>" . $web_ratio_html . "</div>";
                                            if($out1_c == "ON"){$temp1_all_sorce7 .= "<div class='wid100 ul4'><div class='title7 ta_c'>店舗・通販(免税)</div>" . $oroshi_ratio_html . "</div>";}
                                            $temp1_all_sorce7 .= "<div class='wid100 ul4 bg_grey'><div class='title7 ta_c'>合計</div>" . $ratio_html . "</div></div>";
                                        
                                        
                                        // 通販・点数・過去比
                                        
                                            $i = 0;
                                            $web_ratio = "";
                                            $web_ratio_html = "";
                                            $web_total = "";
                                            $web_total_past = "";
                                            $web_total_ratio = "";
                                            foreach($temp1_web_manthly_array2 as $var){
                                                if($var == 0){
                                                    $web_ratio = "---";
                                                    $web_total = $web_total;
                                                    if($past_temp1_web_manthly_array2[$i] == 0){
                                                        $web_total_past = $web_total_past;
                                                    } else {
                                                        $web_total_past = (int)$web_total_past + (int)$past_temp1_web_manthly_array2[$i];
                                                    }
                                                } else {
                                                    if($var == 0 || $past_temp1_web_manthly_array2[$i] == 0 || $var == "" || $past_temp1_web_manthly_array2[$i] == ""){
                                                        $web_ratio = "---";
                                                    } else {
                                                        $web_ratio = number_format((floor(($var / $past_temp1_web_manthly_array2[$i]) * 100 * 10)) / 10 ,1);
                                                    }
                                                    $web_total = (int)$web_total + (int)$var;
                                                    if($past_temp1_web_manthly_array2[$i] == 0){
                                                        $web_total_past = $web_total_past;
                                                    } else {
                                                        $web_total_past = (int)$web_total_past + (int)$past_temp1_web_manthly_array2[$i];
                                                    }
                                                }
                                                //$web_ratio_html .= "<div class='title7 ta_r'>" . $web_ratio . "%</div>";
                                        
                                                if($web_ratio < 100){
                                                    $web_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $web_ratio . "%</div>";
                                                } else {
                                                    $web_ratio_html .= "<div class='title7 ta_r fc_red'>" . $web_ratio . "%</div>";
                                                }
                                        
                                                $i++;
                                            }
                                            // 過去の同期間売上点数に対する比率を取得
                                                if($web_total <> 0 && $web_total_past <> 0 && $web_total <> "" && $web_total_past <> ""){
                                                    $web_total_ratio = number_format((floor(((float)$web_total / (float)$web_total_past) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $web_total_ratio = "---";
                                                }
                                        
                                                //$web_ratio_html .= "<div class='title7 ta_r'>" . $web_total_ratio . "%</div>";
                                        
                                                if($web_total_ratio < 100){
                                                    $web_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $web_total_ratio . "%</div>";
                                                } else {
                                                    $web_ratio_html .= "<div class='title7 ta_r fc_red'>" . $web_total_ratio . "%</div>";
                                                }
                                        
                                        
                                        // 店舗・点数・過去比
                                        
                                            $i = 0;
                                            $shop_ratio = "";
                                            $shop_ratio_html = "";
                                            $shop_total = "";
                                            $shop_total_past = "";
                                            $shop_total_ratio = "";
                                            foreach($temp1_shop_manthly_array2 as $var){
                                                if($var == 0){
                                                    $shop_ratio = "---";
                                                    $shop_total = $shop_total;
                                                    if($past_temp1_shop_manthly_array2[$i] == 0){
                                                        $shop_total_past = $shop_total_past;
                                                    } else {
                                                        $shop_total_past = (int)$shop_total_past + (int)$past_temp1_shop_manthly_array2[$i];
                                                    }
                                                } else {
                                                    if($var == 0 || $past_temp1_shop_manthly_array2[$i] == 0 || $var == "" || $past_temp1_shop_manthly_array2[$i] == ""){
                                                        $shop_ratio = "---";
                                                    } else {
                                                        $shop_ratio = number_format((floor(($var / $past_temp1_shop_manthly_array2[$i]) * 100 * 10)) / 10 ,1);
                                                    }
                                                    $shop_total = (int)$shop_total + (int)$var;
                                                    if($past_temp1_shop_manthly_array2[$i] == 0){
                                                        $shop_total_past = $shop_total_past;
                                                    } else {
                                                        $shop_total_past = (int)$shop_total_past + (int)$past_temp1_shop_manthly_array2[$i];
                                                    }
                                                }
                                                //$shop_ratio_html .= "<div class='title7 ta_r'>" . $shop_ratio . "%</div>";
                                                if($shop_ratio < 100){
                                                    $shop_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $shop_ratio . "%</div>";
                                                } else {
                                                    $shop_ratio_html .= "<div class='title7 ta_r fc_red'>" . $shop_ratio . "%</div>";
                                                }
                                        
                                                $i++;
                                            }
                                            // 過去の同期間売上点数に対する比率を取得
                                                if($shop_total <> 0 && $shop_total_past <> 0 && $shop_total <> "" && $shop_total_past <> ""){
                                                    $shop_total_ratio = number_format((floor(((float)$shop_total / (float)$shop_total_past) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $shop_total_ratio = "---";
                                                }
                                        
                                                //$shop_ratio_html .= "<div class='title7 ta_r'>" . $shop_total_ratio . "%</div>";
                                                if($shop_total_ratio < 100){
                                                    $shop_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $shop_total_ratio . "%</div>";
                                                } else {
                                                    $shop_ratio_html .= "<div class='title7 ta_r fc_red'>" . $shop_total_ratio . "%</div>";
                                                }
                                        
                                        
                                            if($out1_c == "ON"){
                                                // 店舗・通販(免税)・金額・過去比
                                                    $i = 0;
                                                    $oroshi_ratio = "";
                                                    $oroshi_ratio_html = "";
                                                    $oroshi_total = "";
                                                    $oroshi_total_past = "";
                                                    $oroshi_total_ratio = "";
                                                    foreach($temp1_oroshi_manthly_array2 as $var){
                                                        if($var == 0){
                                                            $oroshi_ratio = "---";
                                                            $oroshi_total = $oroshi_total;
                                                            if($past_temp1_oroshi_manthly_array2[$i] == 0){
                                                                $oroshi_total_past = $oroshi_total_past;
                                                            } else {
                                                                $oroshi_total_past = (int)$oroshi_total_past + (int)$past_temp1_oroshi_manthly_array2[$i];
                                                            }
                                                        } else {
                                                            if($var == 0 || $past_temp1_oroshi_manthly_array2[$i] == 0 || $var == "" || $past_temp1_oroshi_manthly_array2[$i] == ""){
                                                                $oroshi_ratio = "---";
                                                            } else {
                                                                $oroshi_ratio = number_format((floor(($var / $past_temp1_oroshi_manthly_array2[$i]) * 100 * 10)) / 10 ,1);
                                                            }
                                                            $oroshi_total = (int)$oroshi_total + (int)$var;
                                                            if($past_temp1_oroshi_manthly_array2[$i] == 0){
                                                                $oroshi_total_past = $oroshi_total_past;
                                                            } else {
                                                                $oroshi_total_past = (int)$oroshi_total_past + (int)$past_temp1_oroshi_manthly_array2[$i];
                                                            }
                                                        }
                                                        //$oroshi_ratio_html .= "<div class='title7 ta_r'>" . $oroshi_ratio . "%</div>";
                                                        if($oroshi_ratio < 100){
                                                            $oroshi_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $oroshi_ratio . "%</div>";
                                                        } else {
                                                            $oroshi_ratio_html .= "<div class='title7 ta_r fc_red'>" . $oroshi_ratio . "%</div>";
                                                        }
                                                
                                                        $i++;
                                                    }
                                                    // 過去の同期間売上金額に対する比率を取得
                                                        if($oroshi_total == 0 || $oroshi_total_past == 0 || $oroshi_total == "" || $oroshi_total_past == ""){
                                                            $oroshi_total_ratio = "---";
                                                        } else {
                                                            $oroshi_total_ratio = number_format((floor(((int)$oroshi_total / (int)$oroshi_total_past) * 100 * 10)) / 10 ,1);
                                                        }
                                        
                                                        //$oroshi_ratio_html .= "<div class='title7 ta_r'>" . $oroshi_total_ratio . "%</div>";
                                                        if($oroshi_total_ratio < 100){
                                                            $oroshi_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $oroshi_total_ratio . "%</div>";
                                                        } else {
                                                            $oroshi_ratio_html .= "<div class='title7 ta_r fc_red'>" . $oroshi_total_ratio . "%</div>";
                                                        }
                                            }
                                        
                                        
                                        // 通販・店舗・店舗・通販(免税)合計・点数・過去比
                                        
                                            $i = 0;
                                            $ratio = "";
                                            $ratio_html = "";
                                            $total = "";
                                            $total_past = "";
                                            $total_ratio = "";
                                            foreach($temp1_web_manthly_array2 as $var){
                                                if($var == 0 && $temp1_shop_manthly_array2[$i] == 0/* && $temp1_oroshi_manthly_array2[$i] == 0*/){
                                                    $ratio = 0;
                                                    $total = $total;
                                                    if($past_temp1_web_manthly_array2[$i] == 0 && $past_temp1_shop_manthly_array2[$i] == 0/* && $past_temp1_oroshi_manthly_array2[$i] == 0*/){
                                                        $total_past = $total_past;
                                                    } else {
                                                        if($out1_c == "ON"){
                                                            $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array2[$i] + (int)$past_temp1_shop_manthly_array2[$i] + (int)$past_temp1_oroshi_manthly_array2[$i];
                                                        } else {
                                                            $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array2[$i] + (int)$past_temp1_shop_manthly_array2[$i];
                                                        }
                                                    }
                                                } else {
                                                    if($out1_c == "ON"){
                                                        if((int)$var + (int)$temp1_shop_manthly_array2[$i] + (int)$temp1_oroshi_manthly_array2[$i] == 0 || (int)$past_temp1_web_manthly_array2[$i] + (int)$past_temp1_shop_manthly_array2[$i] + (int)$past_temp1_oroshi_manthly_array2[$i] == 0){
                                                            $ratio = "---";
                                                        } else {
                                                            $ratio = number_format((floor((((int)$var + (int)$temp1_shop_manthly_array2[$i] + (int)$temp1_oroshi_manthly_array2[$i]) / ((int)$past_temp1_web_manthly_array2[$i] + (int)$past_temp1_shop_manthly_array2[$i] + (int)$past_temp1_oroshi_manthly_array2[$i])) * 100 * 10)) / 10 ,1);
                                                        }
                                                        $total = (int)$total + (int)$var + (int)$temp1_shop_manthly_array2[$i] + (int)$temp1_oroshi_manthly_array2[$i];
                                                    } else {
                                                        if((int)$var + (int)$temp1_shop_manthly_array2[$i] == 0 || (int)$past_temp1_web_manthly_array2[$i] + (int)$past_temp1_shop_manthly_array2[$i] == 0){
                                                            $ratio = "---";
                                                        } else {
                                                            $ratio = number_format((floor((((int)$var + (int)$temp1_shop_manthly_array2[$i]) / ((int)$past_temp1_web_manthly_array2[$i] + (int)$past_temp1_shop_manthly_array2[$i])) * 100 * 10)) / 10 ,1);
                                                        }
                                                        $total = (int)$total + (int)$var + (int)$temp1_shop_manthly_array2[$i];
                                                    }
                                                    if($out1_c == "ON"){
                                                        if($past_temp1_web_manthly_array2[$i] == 0 && $past_temp1_shop_manthly_array2[$i] == 0 && $past_temp1_oroshi_manthly_array2[$i] == 0){
                                                            $total_past = $total_past;
                                                        } else {
                                                            $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array2[$i] + (int)$past_temp1_shop_manthly_array2[$i] + (int)$past_temp1_oroshi_manthly_array2[$i];
                                                        }
                                                    } else {
                                                        if($past_temp1_web_manthly_array2[$i] == 0 && $past_temp1_shop_manthly_array2[$i] == 0){
                                                            $total_past = $total_past;
                                                        } else {
                                                            $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array2[$i] + (int)$past_temp1_shop_manthly_array2[$i];
                                                        }
                                                    }
                                                }
                                                //$ratio_html .= "<div class='title7 ta_r'>" . $ratio . "%</div>";
                                                if($ratio < 100){
                                                    $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ratio . "%</div>";
                                                } else {
                                                    $ratio_html .= "<div class='title7 ta_r fc_red'>" . $ratio . "%</div>";
                                                }
                                        
                                                $i++;
                                            }
                                            // 過去の同期間売上金額に対する比率を取得
                                                if($total <> 0 && $total_past <> 0 && $total <> "" && $total_past <> ""){
                                                    $total_ratio = number_format((floor(((float)$total / (float)$total_past) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $total_ratio = "---";
                                                }
                                        
                                                //$ratio_html .= "<div class='title7 ta_r bg_grey'>" . $total_ratio . "%</div>";
                                                if($total_ratio < 100){
                                                    $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $total_ratio . "%</div>";
                                                } else {
                                                    $ratio_html .= "<div class='title7 ta_r fc_red'>" . $total_ratio . "%</div>";
                                                }
                                        
                                            $temp1_all_sorce8 = "<p class='title_a'>点数・過去比</p><div class='box1'>" . $temp1_title5 . "<div class='wid100 ul4'><div class='title7 ta_c'>店舗(免税外)</div>" . $shop_ratio_html . "</div>";
                                            $temp1_all_sorce8 .= "<div class='wid100 ul4'><div class='title7 ta_c'>通販(免税外)</div>" . $web_ratio_html . "</div>";
                                            if($out1_c == "ON"){$temp1_all_sorce8 .= "<div class='wid100 ul4'><div class='title7 ta_c'>店舗・通販(免税)</div>" . $oroshi_ratio_html . "</div>";}
                                            $temp1_all_sorce8 .= "<div class='wid100 ul4 bg_grey'><div class='title7 ta_c'>合計</div>" . $ratio_html . "</div></div>";
                                            
                                                
                                        // 通販・粗利・過去比
                                        
                                            $i = 0;
                                            $web_ratio = "";
                                            $web_ratio_html = "";
                                            $web_total = "";
                                            $web_total_past = "";
                                            $web_total_ratio = "";
                                            foreach($temp1_web_manthly_array3 as $var){
                                                if($var == 0){
                                                    $web_ratio = "---";
                                                    $web_total = $web_total;
                                                    if($past_temp1_web_manthly_array3[$i] == 0){
                                                        $web_total_past = $web_total_past;
                                                    } else {
                                                        $web_total_past = (int)$web_total_past + (int)$past_temp1_web_manthly_array3[$i];
                                                    }
                                                } else {
                                                    if($var == 0 || $past_temp1_web_manthly_array3[$i] == 0 || $var == "" || $past_temp1_web_manthly_array3[$i] == ""){
                                                        $web_ratio = "---";
                                                    } else {
                                                        $web_ratio = number_format((floor(($var / $past_temp1_web_manthly_array3[$i]) * 100 * 10)) / 10 ,1);
                                                    }
                                                    $web_total = (int)$web_total + (int)$var;
                                                    if($past_temp1_web_manthly_array3[$i] == 0){
                                                        $web_total_past = $web_total_past;
                                                    } else {
                                                        $web_total_past = (int)$web_total_past + (int)$past_temp1_web_manthly_array3[$i];
                                                    }
                                                }
                                                //$web_ratio_html .= "<div class='title7 ta_r'>" . $web_ratio . "%</div>";
                                                if($web_ratio < 100){
                                                    $web_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $web_ratio . "%</div>";
                                                } else {
                                                    $web_ratio_html .= "<div class='title7 ta_r fc_red'>" . $web_ratio . "%</div>";
                                                }
                                        
                                                $i++;
                                            }
                                            // 過去の同期間売上粗利に対する比率を取得
                                                if($web_total <> 0 && $web_total_past <> 0 && $web_total <> "" && $web_total_past <> ""){
                                                    $web_total_ratio = number_format((floor(((float)$web_total / (float)$web_total_past) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $web_total_ratio = "---";
                                                }
                                        
                                                //$web_ratio_html .= "<div class='title7 ta_r'>" . $web_total_ratio . "%</div>";
                                                if($web_total_ratio < 100){
                                                    $web_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $web_total_ratio . "%</div>";
                                                } else {
                                                    $web_ratio_html .= "<div class='title7 ta_r fc_red'>" . $web_total_ratio . "%</div>";
                                                }
                                        
                                        
                                        // 店舗・粗利・過去比
                                        
                                            $i = 0;
                                            $shop_ratio = "";
                                            $shop_ratio_html = "";
                                            $shop_total = "";
                                            $shop_total_past = "";
                                            $shop_total_ratio = "";
                                            foreach($temp1_shop_manthly_array3 as $var){
                                                if($var == 0){
                                                    $shop_ratio = "---";
                                                    $shop_total = $shop_total;
                                                    if($past_temp1_shop_manthly_array3[$i] == 0){
                                                        $shop_total_past = $shop_total_past;
                                                    } else {
                                                        $shop_total_past = (int)$shop_total_past + (int)$past_temp1_shop_manthly_array3[$i];
                                                    }
                                                } else {
                                                    if($var == 0 || $past_temp1_shop_manthly_array3[$i] == 0 || $var == "" || $past_temp1_shop_manthly_array3[$i] == ""){
                                                        $shop_ratio = "---";
                                                    } else {
                                                        $shop_ratio = number_format((floor(($var / $past_temp1_shop_manthly_array3[$i]) * 100 * 10)) / 10 ,1);
                                                    }
                                                    $shop_total = (int)$shop_total + (int)$var;
                                                    if($past_temp1_shop_manthly_array3[$i] == 0){
                                                        $shop_total_past = $shop_total_past;
                                                    } else {
                                                        $shop_total_past = (int)$shop_total_past + (int)$past_temp1_shop_manthly_array3[$i];
                                                    }
                                                }
                                                //$shop_ratio_html .= "<div class='title7 ta_r'>" . $shop_ratio . "%</div>";
                                                if($shop_ratio < 100){
                                                    $shop_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $shop_ratio . "%</div>";
                                                } else {
                                                    $shop_ratio_html .= "<div class='title7 ta_r fc_red'>" . $shop_ratio . "%</div>";
                                                }
                                        
                                                $i++;
                                            }
                                            // 過去の同期間売上粗利に対する比率を取得
                                                if($shop_total <> 0 && $shop_total_past <> 0 && $shop_total <> "" && $shop_total_past <> ""){
                                                    $shop_total_ratio = number_format((floor(((float)$shop_total / (float)$shop_total_past) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $shop_total_ratio = "---";
                                                }
                                        
                                                //$shop_ratio_html .= "<div class='title7 ta_r'>" . $shop_total_ratio . "%</div>";
                                                if($shop_total_ratio < 100){
                                                    $shop_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $shop_total_ratio . "%</div>";
                                                } else {
                                                    $shop_ratio_html .= "<div class='title7 ta_r fc_red'>" . $shop_total_ratio . "%</div>";
                                                }
                                        
                                            if($out1_c == "ON"){
                                                // 店舗・通販(免税)・粗利・過去比
                                                    $i = 0;
                                                    $oroshi_ratio = "";
                                                    $oroshi_ratio_html = "";
                                                    $oroshi_total = "";
                                                    $oroshi_total_past = "";
                                                    $oroshi_total_ratio = "";
                                                    foreach($temp1_oroshi_manthly_array3 as $var){
                                                        if($var == 0){
                                                            $oroshi_ratio = "---";
                                                            $oroshi_total = $oroshi_total;
                                                            if($past_temp1_oroshi_manthly_array3[$i] == 0){
                                                                $oroshi_total_past = $oroshi_total_past;
                                                            } else {
                                                                $oroshi_total_past = (int)$oroshi_total_past + (int)$past_temp1_oroshi_manthly_array3[$i];
                                                            }
                                                        } else {
                                                            if($var == 0 || $past_temp1_oroshi_manthly_array3[$i] == 0 || $var == "" || $past_temp1_oroshi_manthly_array3[$i] == ""){
                                                                $oroshi_ratio = "---";
                                                            } else {
                                                                $oroshi_ratio = number_format((floor(($var / $past_temp1_oroshi_manthly_array3[$i]) * 100 * 10)) / 10 ,1);
                                                            }
                                                            $oroshi_total = (int)$oroshi_total + (int)$var;
                                                            if($past_temp1_oroshi_manthly_array3[$i] == 0){
                                                                $oroshi_total_past = $oroshi_total_past;
                                                            } else {
                                                                $oroshi_total_past = (int)$oroshi_total_past + (int)$past_temp1_oroshi_manthly_array3[$i];
                                                            }
                                                        }
                                                        //$oroshi_ratio_html .= "<div class='title7 ta_r'>" . $oroshi_ratio . "%</div>";
                                                        if($oroshi_ratio < 100){
                                                            $oroshi_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $oroshi_ratio . "%</div>";
                                                        } else {
                                                            $oroshi_ratio_html .= "<div class='title7 ta_r fc_red'>" . $oroshi_ratio . "%</div>";
                                                        }
                                                
                                                        $i++;
                                                    }
                                                    // 過去の同期間売上金額に対する比率を取得
                                                        if($oroshi_total == 0 || $oroshi_total_past == 0 || $oroshi_total == "" || $oroshi_total_past == ""){
                                                            $oroshi_total_ratio = "---";
                                                        } else {
                                                            $oroshi_total_ratio = number_format((floor(((int)$oroshi_total / (int)$oroshi_total_past) * 100 * 10)) / 10 ,1);
                                                        }
                                        
                                        
                                                        //$oroshi_ratio_html .= "<div class='title7 ta_r'>" . $oroshi_total_ratio . "%</div>";
                                                        if($oroshi_total_ratio < 100){
                                                            $oroshi_ratio_html .= "<div class='title7 ta_r fc_blue'>" . $oroshi_total_ratio . "%</div>";
                                                        } else {
                                                            $oroshi_ratio_html .= "<div class='title7 ta_r fc_red'>" . $oroshi_total_ratio . "%</div>";
                                                        }
                                            }
                                        
                                        
                                        // 通販・店舗・店舗・通販(免税)合計・粗利・過去比
                                        
                                            $i = 0;
                                            $ratio = "";
                                            $ratio_html = "";
                                            $total = "";
                                            $total_past = "";
                                            $total_ratio = "";
                                            foreach($temp1_web_manthly_array3 as $var){
                                                if($var == 0 && $temp1_shop_manthly_array3[$i] == 0/* && $temp1_oroshi_manthly_array3[$i] == 0*/){
                                                    $ratio = 0;
                                                    $total = $total;
                                                    if($past_temp1_web_manthly_array3[$i] == 0 && $past_temp1_shop_manthly_array3[$i] == 0/* && $past_temp1_oroshi_manthly_array3[$i] == 0*/){
                                                        $total_past = $total_past;
                                                    } else {
                                                        if($out1_c == "ON"){
                                                            $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array3[$i] + (int)$past_temp1_shop_manthly_array3[$i] + (int)$past_temp1_oroshi_manthly_array3[$i];
                                                        } else {
                                                            $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array3[$i] + (int)$past_temp1_shop_manthly_array3[$i];
                                                        }
                                                    }
                                                } else {
                                                    if($out1_c == "ON"){
                                                        if((int)$var + (int)$temp1_shop_manthly_array3[$i] + (int)$temp1_oroshi_manthly_array3[$i] == 0 || (int)$past_temp1_web_manthly_array3[$i] + (int)$past_temp1_shop_manthly_array3[$i] + (int)$past_temp1_oroshi_manthly_array3[$i] == 0){
                                                            $ratio = "---";
                                                        } else {
                                                            $ratio = number_format((floor((((int)$var + (int)$temp1_shop_manthly_array3[$i] + (int)$temp1_oroshi_manthly_array3[$i]) / ((int)$past_temp1_web_manthly_array3[$i] + (int)$past_temp1_shop_manthly_array3[$i] + (int)$past_temp1_oroshi_manthly_array3[$i])) * 100 * 10)) / 10 ,1);
                                                        }
                                                        $total = (int)$total + (int)$var + (int)$temp1_shop_manthly_array3[$i] + (int)$temp1_oroshi_manthly_array3[$i];
                                                    } else {
                                                        if((int)$var + (int)$temp1_shop_manthly_array3[$i] == 0 || (int)$past_temp1_web_manthly_array3[$i] + (int)$past_temp1_shop_manthly_array3[$i] == 0){
                                                            $ratio = "---";
                                                        } else {
                                                            $ratio = number_format((floor((((int)$var + (int)$temp1_shop_manthly_array3[$i]) / ((int)$past_temp1_web_manthly_array3[$i] + (int)$past_temp1_shop_manthly_array3[$i])) * 100 * 10)) / 10 ,1);
                                                        }
                                                        $total = (int)$total + (int)$var + (int)$temp1_shop_manthly_array3[$i];
                                                    }
                                                    if($out1_c == "ON"){
                                                        if($past_temp1_web_manthly_array3[$i] == 0 && $past_temp1_shop_manthly_array3[$i] == 0 && $past_temp1_oroshi_manthly_array3[$i] == 0){
                                                            $total_past = $total_past;
                                                        } else {
                                                            $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array3[$i] + (int)$past_temp1_shop_manthly_array3[$i] + (int)$past_temp1_oroshi_manthly_array3[$i];
                                                        }
                                                    } else {
                                                        if($past_temp1_web_manthly_array3[$i] == 0 && $past_temp1_shop_manthly_array3[$i] == 0){
                                                            $total_past = $total_past;
                                                        } else {
                                                            $total_past = (int)$total_past + (int)$past_temp1_web_manthly_array3[$i] + (int)$past_temp1_shop_manthly_array3[$i];
                                                        }
                                                    }
                                                }
                                                //$ratio_html .= "<div class='title7 ta_r'>" . $ratio . "%</div>";
                                                if($ratio < 100){
                                                    $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $ratio . "%</div>";
                                                } else {
                                                    $ratio_html .= "<div class='title7 ta_r fc_red'>" . $ratio . "%</div>";
                                                }
                                        
                                                $i++;
                                            }
                                            // 過去の同期間売上金額に対する比率を取得
                                                if($total <> 0 && $total_past <> 0 && $total <> "" && $total_past <> ""){
                                                    $total_ratio = number_format((floor(((float)$total / (float)$total_past) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $total_ratio = "---";
                                                }
                                        
                                                //$ratio_html .= "<div class='title7 ta_r  bg_grey'>" . $total_ratio . "%</div>";
                                                if($total_ratio < 100){
                                                    $ratio_html .= "<div class='title7 ta_r fc_blue'>" . $total_ratio . "%</div>";
                                                } else {
                                                    $ratio_html .= "<div class='title7 ta_r fc_red'>" . $total_ratio . "%</div>";
                                                }
                                        
                                        
                                            $temp1_all_sorce9 = "<p class='title_a'>粗利・過去比</p><div class='box1'>" . $temp1_title5 . "<div class='wid100 ul4'><div class='title7 ta_c'>店舗(免税外)</div>" . $shop_ratio_html . "</div>";
                                            $temp1_all_sorce9 .= "<div class='wid100 ul4'><div class='title7 ta_c'>通販(免税外)</div>" . $web_ratio_html . "</div>";
                                            if($out1_c == "ON"){$temp1_all_sorce9 .= "<div class='wid100 ul4'><div class='title7 ta_c'>店舗・通販(免税)</div>" . $oroshi_ratio_html . "</div>";}
                                            $temp1_all_sorce9 .= "<div class='wid100 ul4 bg_grey'><div class='title7 ta_c'>合計</div>" . $ratio_html . "</div></div>";
                                        
                                        
                                        // 過去・金額構成比
                                        
                                            $i = 0;
                                            $total = "";
                                            $total2 = 0;
                                            $web_per = "";
                                            $shop_per = "";
                                            $oroshi_per = "";
                                            $web_total = "";
                                            $shop_total = "";
                                            $oroshi_total = "";
                                            $web_per_html = "";
                                            $shop_per_html = "";
                                            $oroshi_per_html = "";
                                            $past_web_total_js2 = "";
                                            $past_shop_total_js2 = "";
                                            $past_oroshi_total_js2 = "";
                                            foreach($past_temp1_web_manthly_array as $var){
                                                //echo $past_temp1_shop_manthly_array[$i] . "<br>";
                                                if($out1_c == "ON"){
                                                    $total = (int)$var + (int)$past_temp1_shop_manthly_array[$i] + (int)$past_temp1_oroshi_manthly_array[$i];
                                                } else {
                                                    $total = (int)$var + (int)$past_temp1_shop_manthly_array[$i];
                                                }
                                                $total2 = (int)$total2 + (int)$total;
                                                $web_total = (int)$web_total + (int)$var;
                                                $shop_total = (int)$shop_total + (int)$past_temp1_shop_manthly_array[$i];
                                                if($out1_c == "ON"){ $oroshi_total = (int)$oroshi_total + (int)$past_temp1_oroshi_manthly_array[$i]; }
                                                if($var == 0){
                                                    $web_per = "---";
                                                    if($past_temp1_shop_manthly_array[$i] == 0){
                                                        $shop_per = "---";
                                                    } else {
                                                        if($out1_c == "ON"){ 
                                                            if($past_temp1_shop_manthly_array[$i] <> 0 && $total <> 0 && $past_temp1_shop_manthly_array[$i] <> "" && $total <> ""){
                                                                $shop_per = number_format((floor(($past_temp1_shop_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
                                                            } else {
                                                                $shop_per = "---"; 
                                                            }
                                                        } else {
                                                            //$shop_per = 100 - $web_per;
                                                            $shop_per = number_format(bcsub('100', ((float)$web_per), 1) ,1);
                                        
                                                        }
                                                    }
                                                    if($out1_c == "ON"){
                                                        if($past_temp1_oroshi_manthly_array[$i] == 0){
                                                            $oroshi_per = "---";
                                                        } else {
                                                            //$oroshi_per = 100 - $web_per - $shop_per;
                                                            $oroshi_per = number_format(bcsub('100', ($web_per + $shop_per), 1) ,1);
                                                        }
                                                    }
                                                } else {
                                                    if($var <> 0 && $total <> 0 && $var <> "" && $total <> ""){
                                                        $web_per = number_format((floor(($var / $total) * 100 * 10)) / 10 ,1);
                                                    } else {
                                                        $web_per = "---";
                                                    }
                                                    if($past_temp1_shop_manthly_array[$i] == 0){
                                                        $shop_per = "---";
                                                    } else {
                                                        if($out1_c == "ON"){ 
                                                            if($past_temp1_shop_manthly_array[$i] <> 0 && $total <> 0 && $past_temp1_shop_manthly_array[$i] <> "" && $total <> ""){
                                                                $shop_per = number_format((floor(($past_temp1_shop_manthly_array[$i] / $total) * 100 * 10)) / 10 ,1); 
                                                            } else {
                                                                $shop_per = "---";
                                                            }
                                                        } else {
                                                            //$shop_per = 100 - $web_per;
                                                            $shop_per = number_format(bcsub('100', ((float)$web_per), 1) ,1);
                                        
                                                        }
                                                    }
                                                    if($out1_c == "ON"){
                                                        if($past_temp1_oroshi_manthly_array[$i] == 0){
                                                            $oroshi_per = "---";
                                                        } else {
                                                            //$oroshi_per = 100 - $web_per - $shop_per;
                                                            $oroshi_per = number_format(bcsub('100', ((float)$web_per + (float)$shop_per), 1) ,1);
                                                        }
                                                    }
                                                }
                                                $web_per_html .= "<div class='title7 ta_r'>" . $web_per . "%</div>";
                                                $shop_per_html .= "<div class='title7 ta_r'>" . $shop_per . "%</div>";
                                                $past_web_total_js2  .= (float)$web_per . ", ";
                                                $past_shop_total_js2  .= (float)$shop_per . ", ";
                                        
                                                if($out1_c == "ON"){
                                                    $oroshi_per_html .= "<div class='title7 ta_r'>" . $oroshi_per . "%</div>";
                                                    $past_oroshi_total_js2  .= (float)$oroshi_per . ", ";
                                                }
                                        
                                                $i++;
                                            }
                                            // 期間中の売上合計に対するパーセンテージを取得
                                               // $web_total_per = $web_total / $i;
                                                if($web_total <> 0 && $total2 <> 0 && $web_total <> "" && $total2 <> ""){
                                                    $web_total_per = number_format((floor(($web_total / $total2) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $web_total_per = "---";
                                                }
                                                if($shop_total <> 0 && $total2 <> 0 && $shop_total <> "" && $total2 <> ""){
                                                    $shop_total_per = number_format((floor(($shop_total / $total2) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $shop_total_per = "---";
                                                }
                                                //if($out1_c == "ON"){ $oroshi_total_per = 100 - $web_total_per - $shop_total_per; }
                                                if($out1_c == "ON"){ $oroshi_total_per = number_format(bcsub('100', ((float)$web_total_per + (float)$shop_total_per), 1) ,1);}
                                                $web_per_html .= "<div class='title7 ta_r'>" . $web_total_per . "%</div>";
                                                $shop_per_html .= "<div class='title7 ta_r'>" . $shop_total_per . "%</div>";
                                                if($out1_c == "ON"){ $oroshi_per_html .= "<div class='title7 ta_r'>" . $oroshi_total_per . "%</div>";}
                                        
                                            $past_temp1_all_sorce4 = "<p class='title_a'>金額・構成比（過去）</p><div class='box1'>" . $past_temp1_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>店舗(免税外)</div>" . $shop_per_html . "</div>";
                                            $past_temp1_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>通販(免税外)</div>" . $web_per_html . "</div>";
                                            if($out1_c == "ON"){$past_temp1_all_sorce4 .= "<div class='wid100 ul4'><div class='title7 ta_c'>店舗・通販(免税)</div>" . $oroshi_per_html . "</div>";}
                                            $past_temp1_all_sorce4 .= "</div>";
                                        
                                        // 過去・点数構成比
                                        
                                            $i = 0;
                                            $total = "";
                                            $total2 = 0;
                                            $web_per = "";
                                            $shop_per = "";
                                            $oroshi_per = "";
                                            $web_total = "";
                                            $shop_total = "";
                                            $oroshi_total = "";
                                            $web_per_html = "";
                                            $shop_per_html = "";
                                            $oroshi_per_html = "";
                                            $past_web_total_js3 = "";
                                            $past_shop_total_js3 = "";
                                            $past_oroshi_total_js3 = "";
                                            foreach($past_temp1_web_manthly_array2 as $var){
                                                //echo $past_temp1_shop_manthly_array2[$i] . "<br>";
                                                if($out1_c == "ON"){
                                                    $total = (int)$var + (int)$past_temp1_shop_manthly_array2[$i] + (int)$past_temp1_oroshi_manthly_array2[$i];
                                                } else {
                                                    $total = (int)$var + (int)$past_temp1_shop_manthly_array2[$i];
                                                }
                                                $total2 = (int)$total2 + (int)$total;
                                                $web_total = (int)$web_total + (int)$var;
                                                $shop_total = (int)$shop_total + (int)$past_temp1_shop_manthly_array2[$i];
                                                if($out1_c == "ON"){ $oroshi_total = (int)$oroshi_total + (int)$past_temp1_oroshi_manthly_array2[$i]; }
                                                if($var == 0){
                                                    $web_per = "---";
                                                    if($past_temp1_shop_manthly_array2[$i] == 0){
                                                        $shop_per = "---";
                                                    } else {
                                                        if($out1_c == "ON"){ 
                                                            if($past_temp1_shop_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp1_shop_manthly_array2[$i] <> "" && $total <> ""){
                                                                $shop_per = number_format((floor(($past_temp1_shop_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
                                                            } else {
                                                                $shop_per = "---"; 
                                                            }
                                                        } else {
                                                            //$shop_per = 100 - $web_per;
                                                            $shop_per = number_format(bcsub('100', ((float)$shop_per), 1) ,1);
                                        
                                                        }
                                                    }
                                                    if($out1_c == "ON"){
                                                        if($past_temp1_oroshi_manthly_array2[$i] == 0){
                                                            $oroshi_per = "---";
                                                        } else {
                                                            //$oroshi_per = 100 - $web_per - $shop_per;
                                                            $oroshi_per = number_format(bcsub('100', ($web_per + $shop_per), 1) ,1);
                                                        }
                                                    }
                                                } else {
                                                    if($var <> 0 && $total <> 0 && $var <> "" && $total <> ""){
                                                        $web_per = number_format((floor(($var / $total) * 100 * 10)) / 10 ,1);
                                                    } else {
                                                        $web_per = "---";
                                                    }
                                                    if($past_temp1_shop_manthly_array2[$i] == 0){
                                                        $shop_per = "---";
                                                    } else {
                                                        if($out1_c == "ON"){ 
                                                            if($past_temp1_shop_manthly_array2[$i] <> 0 && $total <> 0 && $past_temp1_shop_manthly_array2[$i] <> "" && $total <> ""){
                                                                $shop_per = number_format((floor(($past_temp1_shop_manthly_array2[$i] / $total) * 100 * 10)) / 10 ,1); 
                                                            } else {
                                                                $shop_per = "---"; 
                                                            }
                                                        } else {
                                                            //$shop_per = 100 - $web_per;
                                                            $shop_per = number_format(bcsub('100', ((float)$web_per), 1) ,1);
                                        
                                                        }
                                                    }
                                                    if($out1_c == "ON"){
                                                        if($past_temp1_oroshi_manthly_array2[$i] == 0){
                                                            $oroshi_per = "---";
                                                        } else {
                                                            //$oroshi_per = 100 - $web_per - $shop_per;
                                                            $oroshi_per = number_format(bcsub('100', ($web_per + $shop_per), 1) ,1);
                                                        }
                                                    }
                                                }
                                                $web_per_html .= "<div class='title7 ta_r'>" . $web_per . "%</div>";
                                                $shop_per_html .= "<div class='title7 ta_r'>" . $shop_per . "%</div>";
                                                $past_web_total_js3  .= (float)$web_per . ", ";
                                                $past_shop_total_js3  .= (float)$shop_per . ", ";
                                                if($out1_c == "ON"){
                                                    $oroshi_per_html .= "<div class='title7 ta_r'>" . $oroshi_per . "%</div>";
                                                    $past_oroshi_total_js3  .= (float)$oroshi_per . ", ";
                                                }
                                        
                                                $i++;
                                            }
                                            // 期間中の売上合計点数に対するパーセンテージを取得
                                               // $web_total_per = $web_total / $i;
                                                if($web_total <> 0 && $total2 <> 0 && $web_total <> "" && $total2 <> ""){
                                                   $web_total_per = number_format((floor(($web_total / $total2) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $web_total_per = "---";
                                                }
                                                if($shop_total <> 0 && $total2 <> 0 && $shop_total <> "" && $total2 <> ""){
                                                    $shop_total_per = number_format((floor(($shop_total / $total2) * 100 * 10)) / 10 ,1);
                                                } else {
                                                    $shop_total_per = "---";
                                                }
                                               //if($out1_c == "ON"){ $oroshi_total_per = 100 - $web_total_per - $shop_total_per; }
                                               if($out1_c == "ON"){ $oroshi_total_per = number_format(bcsub('100', ((float)$web_total_per + (float)$shop_total_per), 1) ,1);}
                                               $web_per_html .= "<div class='title7 ta_r'>" . $web_total_per . "%</div>";
                                               $shop_per_html .= "<div class='title7 ta_r'>" . $shop_total_per . "%</div>";
                                               if($out1_c == "ON"){ $oroshi_per_html .= "<div class='title7 ta_r'>" . $oroshi_total_per . "%</div>";}
                                        
                                        
                                            $past_temp1_all_sorce5 = "<p class='title_a'>点数・構成比（過去）</p><div class='box1'>" . $past_temp1_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>店舗(免税外)</div>" . $shop_per_html . "</div>";
                                            $past_temp1_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>通販(免税外)</div>" . $web_per_html . "</div>";
                                            if($out1_c == "ON"){$past_temp1_all_sorce5 .= "<div class='wid100 ul4'><div class='title7 ta_c'>店舗・通販(免税)</div>" . $oroshi_per_html . "</div>";}
                                            $past_temp1_all_sorce5 .= "</div>";
                                        
                                        // 過去・平均単価
                                        
                                            $i = 0;
                                            $web_average = "";
                                            $web_ave_html = "";
                                            $web_total = "";
                                            $web_total2 = "";
                                            $web_total_ave = "";
                                            foreach($past_temp1_web_manthly_array as $var){
                                        
                                                if($var == 0){
                                                    $web_average = 0;
                                                    $web_total = (int)$web_total + (int)$var;
                                                    if($past_temp1_web_manthly_array2[$i] == 0){
                                                        $web_total2 = $web_total2;
                                                    } else {
                                                        $web_total2 = (int)$web_total2 + (int)$past_temp1_web_manthly_array2[$i];
                                                    }
                                                } else {
                                                    if($var <> 0 && $past_temp1_web_manthly_array2[$i] <> 0 && $var <> "" && $past_temp1_web_manthly_array2[$i] <> ""){
                                                        $web_average = (floor(((int)$var / (int)$past_temp1_web_manthly_array2[$i])) * 10) / 10;
                                                    } else {
                                                        $web_average = "---";
                                                    }
                                                    $web_total = (int)$web_total + (int)$var;
                                                    if($past_temp1_web_manthly_array2[$i] == 0){
                                                        $web_total2 = $web_total2;
                                                    } else {
                                                        $web_total2 = (int)$web_total2 + (int)$past_temp1_web_manthly_array2[$i];
                                                    }
                                                }
                                                if($web_average <> 0 && $web_average <> ""){$web_average = number_format((int)$web_average);}
                                                $web_ave_html .= "<div class='title7 ta_r'>" . $web_average . "</div>";
                                        
                                                $i++;
                                            }
                                            // 期間中の売上合計に対する平均単価を取得
                                                if($web_total <> 0 && $web_total2 <> 0 && $web_total <> "" && $web_total2 <> ""){
                                                    $web_total_ave = (floor(($web_total / $web_total2) * 10)) / 10;
                                                } else {
                                                    $web_total_ave = "---";
                                                }
                                                if($web_total_ave <> 0 && $web_total_ave <> ""){$web_total_ave = number_format((int)$web_total_ave);}
                                                $web_ave_html .= "<div class='title7 ta_r'>" . $web_total_ave . "</div>";
                                        
                                            $i = 0;
                                            $shop_average = "";
                                            $shop_ave_html = "";
                                            $shop_total = "";
                                            $shop_total2 = "";
                                            $shop_total_ave = "";
                                            foreach($past_temp1_shop_manthly_array as $var){
                                        
                                                if($var == 0){
                                                    $shop_average = 0;
                                                    $shop_total = (int)$shop_total + (int)$var;
                                                    if($past_temp1_shop_manthly_array2[$i] == 0){
                                                        $shop_total2 = $shop_total2;
                                                    } else {
                                                        $shop_total2 = (int)$shop_total2 + (int)$past_temp1_shop_manthly_array2[$i];
                                                    }
                                                } else {
                                                    if($var <> 0 && $past_temp1_shop_manthly_array2[$i] <> 0 && $var <> "" && $past_temp1_shop_manthly_array2[$i] <> ""){
                                                        $shop_average = (floor(((int)$var / (int)$past_temp1_shop_manthly_array2[$i])));
                                                    } else {
                                                        $shop_average = "---";
                                                    }
                                                    $shop_total = (int)$shop_total + (int)$var;
                                                    if($past_temp1_shop_manthly_array2[$i] == 0){
                                                        $shop_total2 = $shop_total2;
                                                    } else {
                                                        $shop_total2 = (int)$shop_total2 + (int)$past_temp1_shop_manthly_array2[$i];
                                                    }
                                                }
                                                if($shop_average <> 0 && $shop_average <> ""){$shop_average = number_format((int)$shop_average);}
                                                $shop_ave_html .= "<div class='title7 ta_r'>" . $shop_average . "</div>";
                                        
                                                $i++;
                                            }
                                            // 期間中の売上合計に対する平均単価を取得
                                                if($shop_total <> 0 && $shop_total2 <> 0 && $shop_total <> "" && $shop_total2 <> ""){
                                                    $shop_total_ave = (floor(((float)$shop_total / (float)$shop_total2)));
                                                } else {
                                                    $shop_total_ave = "---";
                                                }
                                                if($shop_total_ave <> 0 && $shop_total_ave <> ""){$shop_total_ave = number_format((int)$shop_total_ave);}
                                                $shop_ave_html .= "<div class='title7 ta_r'>" . $shop_total_ave . "</div>";
                                        
                                                if($out1_c == "ON"){    
                                                    $i = 0;
                                                    $oroshi_average = "";
                                                    $oroshi_ave_html = "";
                                                    $oroshi_total = "";
                                                    $oroshi_total2 = "";
                                                    $oroshi_total_ave = "";
                                                    foreach($past_temp1_oroshi_manthly_array as $var){
                                        
                                                        if($var == 0){
                                                            $oroshi_average = 0;
                                                            $oroshi_total = (int)$oroshi_total + (int)$var;
                                                            if($past_temp1_oroshi_manthly_array2[$i] == 0){
                                                                $oroshi_total2 = $oroshi_total2;
                                                            } else {
                                                                $oroshi_total2 = (int)$oroshi_total2 + (int)$past_temp1_oroshi_manthly_array2[$i];
                                                            }
                                                        } else {
                                                            if($var <> 0 && $past_temp1_oroshi_manthly_array2[$i] <> 0 && $var <> "" && $past_temp1_oroshi_manthly_array2[$i] <> ""){
                                                                $oroshi_average = (floor(((int)$var / (int)$past_temp1_oroshi_manthly_array2[$i])) * 10) / 10;
                                                            } else {
                                                                $oroshi_average = "---";
                                                            }
                                                            $oroshi_total = (int)$oroshi_total + (int)$var;
                                                            if($past_temp1_oroshi_manthly_array2[$i] == 0){
                                                                $oroshi_total2 = $oroshi_total2;
                                                            } else {
                                                                $oroshi_total2 = (int)$oroshi_total2 + (int)$past_temp1_oroshi_manthly_array2[$i];
                                                            }
                                                        }
                                                        if($oroshi_average <> 0 && $oroshi_average <> ""){$oroshi_average = number_format((int)$oroshi_average);}
                                                        $oroshi_ave_html .= "<div class='title7 ta_r'>" . $oroshi_average . "</div>";
                                        
                                                        $i++;
                                                    }
                                                    // 期間中の売上合計に対する平均単価を取得
                                                        if($oroshi_total == 0 || $oroshi_total2 == 0 || $oroshi_total == "" || $oroshi_total2 == ""){
                                                            $oroshi_total_ave = "---";
                                                        } else {
                                                            $oroshi_total_ave = (floor(((int)$oroshi_total / (int)$oroshi_total2) * 10)) / 10;
                                                        }
                                        
                                                        if($oroshi_total_ave <> 0 && $oroshi_total_ave <> ""){$oroshi_total_ave = number_format((int)$oroshi_total_ave);}
                                                        $oroshi_ave_html .= "<div class='title7 ta_r'>" . $oroshi_total_ave . "</div>";
                                                }
                                        
                                        
                                        
                                        
                                                $past_temp1_all_sorce6 = "<p class='title_a'>平均単価（過去）</p><div class='box1'>" . $past_temp1_title4 . "<div class='wid100 ul4'><div class='title7 ta_c'>店舗(免税外)</div>" . $shop_ave_html . "</div>";
                                                $past_temp1_all_sorce6 .= "<div class='wid100 ul4'><div class='title7 ta_c'>通販(免税外)</div>" . $web_ave_html . "</div>";
                                                if($out1_c == "ON"){$past_temp1_all_sorce6 .= "<div class='wid100 ul4'><div class='title7 ta_c'>店舗・通販(免税)</div>" . $oroshi_ave_html . "</div>";}
                                                $past_temp1_all_sorce6 .= "</div>";
    



                                        // 各月の全部門売上合計の先頭（1列目）部分のタイトルHTML
                                            $all_sum_uriage = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $all_sum_number = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $all_sum_arari = "<div class='wid100 ul3'><div class='title5 ta_c'>合計</div>";
                                            $all_sum_arari_per = "<div class='wid100 ul3'><div class='title5 ta_c'>粗利率(平均)</div>";

                                        // 各月の全部門売上合計を配列に代入
                                            $temp1_all_m_sum_uriage_array = array();
                                            $temp1_all_m_sum_number_array = array();
                                            $temp1_all_m_sum_arari_array = array();
                                            $i = 0;
                                            foreach($manth_now_array as $val){
                                                $all = "";
                                                $all2 = "";
                                                $all3 = "";
                                                if($out1_a == "ON"){ $all = (int)$all + (int)$temp1_shop_manthly_array[$i]; $all2 = (int)$all2 + (int)$temp1_shop_manthly_array2[$i]; $all3 = (int)$all3 + (int)$temp1_shop_manthly_array3[$i];}
                                                if($out1_b == "ON"){ $all = (int)$all + (int)$temp1_web_manthly_array[$i]; $all2 = (int)$all2 + (int)$temp1_web_manthly_array2[$i]; $all3 = (int)$all3 + (int)$temp1_web_manthly_array3[$i];}
                                                if($out1_c == "ON"){ $all = (int)$all + (int)$temp1_oroshi_manthly_array[$i]; $all2 = (int)$all2 + (int)$temp1_oroshi_manthly_array2[$i]; $all3 = (int)$all3 + (int)$temp1_oroshi_manthly_array3[$i];}

                                                array_push($temp1_all_m_sum_uriage_array,$all);
                                                array_push($temp1_all_m_sum_number_array,$all2);
                                                array_push($temp1_all_m_sum_arari_array,$all3);

                                                $i++;
                                            }
                                        // 各月の全部門売上合計部分のHTML作成
                                            foreach($temp1_all_m_sum_uriage_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $all_sum_uriage .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $all_sum_uriage .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                            }
                                            
                                        // 各月の全部門売上点数合計部分のHTML作成
                                            foreach($temp1_all_m_sum_number_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $all_sum_number .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $all_sum_number .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                            }
                                            
                                        // 各月の全部門粗利合計部分のHTML作成
                                            $i = 0;
                                            $arari_ratio = "";
                                            $all_arari_total = "";
                                            foreach($temp1_all_m_sum_arari_array as $var){
                                                if($var <> 0 && $var <> ""){
                                                    $all_sum_arari .= "<div class='title6 ta_r'>" . number_format((int)$var) . "</div>";
                                                } else {
                                                    $all_sum_arari .= "<div class='title6 ta_r'>" . (int)$var . "</div>";
                                                }
                                                // 各月の粗利率を取得
                                                    if($temp1_all_m_sum_uriage_array[$i] == 0){
                                                        $arari_ratio = "---";
                                                    } else {
                                                        $arari_ratio = number_format((floor(((int)$var / (int)$temp1_all_m_sum_uriage_array[$i]) * 100 * 10)) / 10 ,1);
                                                    }
                                                    // 現在・粗利・縦軸合計
                                                        $all_sum_arari_per .= "<div class='title6 ta_r'>" . $arari_ratio . "%</div>";
                                                    // 現在・通販・店舗・店舗・通販(免税)・合計粗利率（JSグラフ用） 
                                                        $all_arari_total .= (float)$arari_ratio . ", ";

                                                    // 過去・現在の粗利率合計差の計算に使用
                                                        ${"arari_ratio_" . $i} = $arari_ratio;


                                                $i++;
                                            }


                                        // 通販・店舗・店舗・通販(免税)の各月・粗利率合計を取得
                                            $arati_cutting_total_html = "";
                                            $arari_ratio_cutting = "";
                                            for($a = 0; $a < $i; $a++){
                                                $arati_cutting_total = "";
                                                $arari_ratio_cutting = (float)${"arari_ratio_" . $a} - (float)${"past_arari_ratio_" . $a};
                                                //$arati_cutting_total_html .= "<div class='title7 ta_r'>" . $arari_ratio_cutting . "</div>";
                                                if($arari_ratio_cutting < 0){
                                                    $arati_cutting_total_html .= "<div class='title7 ta_r fc_blue'>" . $arari_ratio_cutting . "%</div>";
                                                } else {
                                                    $arati_cutting_total_html .= "<div class='title7 ta_r fc_red'>" . $arari_ratio_cutting . "%</div>";
                                                }
                                            }
                                        // 通販・店舗・店舗・通販(免税)の各月合計・粗利率合計を取得

                                            if($out1_c == "ON"){
                                                $all_ratio_cutting_ave = (float)$web_ratio_cutting_ave + (float)$shop_ratio_cutting_ave + (float)$oroshi_ratio_cutting_ave;
                                                //$arati_cutting_total_html .= "<div class='title7 ta_r bg_grey'>" . $all_ratio_cutting_ave . "</div>";
                                                if($all_ratio_cutting_ave < 0){
                                                    $arati_cutting_total_html .= "<div class='title7 ta_r bg_grey fc_blue'>" . $all_ratio_cutting_ave . "%</div>";
                                                } else {
                                                    $arati_cutting_total_html .= "<div class='title7 ta_r bg_grey fc_red'>" . $all_ratio_cutting_ave . "%</div>";
                                                }
                                            } else {
                                                $all_ratio_cutting_ave = (float)$web_ratio_cutting_ave + (float)$shop_ratio_cutting_ave;
                                                //$arati_cutting_total_html .= "<div class='title7 ta_r bg_grey'>" . $all_ratio_cutting_ave . "</div>";
                                                if($all_ratio_cutting_ave < 0){
                                                    $arati_cutting_total_html .= "<div class='title7 ta_r bg_grey fc_blue'>" . $all_ratio_cutting_ave . "%</div>";
                                                } else {
                                                    $arati_cutting_total_html .= "<div class='title7 ta_r bg_grey fc_red'>" . $all_ratio_cutting_ave . "%</div>";
                                                }
                                            }


                                        $temp1_all_sorce10 = "<p class='title_a'>粗利率・過去比</p><div class='box1'>" . $temp1_title5 . "<div class='wid100 ul4'><div class='title7 ta_c'>店舗(免税外)</div>" . $shop_ratio_cutting_html . "</div>";
                                        $temp1_all_sorce10 .= "<div class='wid100 ul4'><div class='title7 ta_c'>通販(免税外)</div>" . $web_ratio_cutting_html . "</div>";
                                        if($out1_c == "ON"){$temp1_all_sorce10 .= "<div class='wid100 ul4'><div class='title7 ta_c'>店舗・通販(免税)</div>" . $oroshi_ratio_cutting_html . "</div>";}
                                        $temp1_all_sorce10 .= "<div class='wid100 ul4 bg_grey'><div class='title7 ta_c'>合計</div>" . $arati_cutting_total_html . "</div></div>";

                            
                                        // 全期間全部門売上合計とその平均値のHTML作成
                                            if($all_sum_uriage_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更
                                                    //$all_average = floor((int)$all_sum_uriage_all / $i);
                                                        if($out1_c == "ON"){
                                                            $all_average = (int)$web_sum_uriage_ave2 + (int)$shop_sum_uriage_ave2 + (int)$oroshi_sum_uriage_ave2;
                                                        } else {
                                                            $all_average = (int)$web_sum_uriage_ave2 + (int)$shop_sum_uriage_ave2;
                                                        }
                                            } else {
                                                $all_average = 0;            
                                            }
                                            //$all_sum_uriage .= "<div class='title6 ta_r'>" . number_format((int)$all_sum_uriage_all) . "</div><div class='title6 ta_r'>" . $yoy_uriage_sum . "</div><div class='title6 ta_r'>" . number_format((int)$all_average) . "</div></div>";
                                            $all_sum_uriage .= "<div class='title6 ta_r'>" . number_format((int)$all_sum_uriage_all) . "</div><div class='title6 ta_r'>" . number_format((int)$all_average) . "</div></div>";
                                        // 全HTMLを合体（検索対象外は除く）
                                            // 【進捗率の取得】
                                                /*if($out6 == "ON"){
                                                    $uriage_progress = "<div class='ul_p mt1'><div class='sinchoku_t'>" . $end_year . "年" . $end_month . "月</div><div class='sinchoku_t'>売上進捗</div><div class='sinchoku_t'>着地予測</div><div class='sinchoku_t'>着地予測比（対前月）</div><div class='sinchoku_t'>着地予測比（対過去・最終月）</div></div>" . $progress_uriage_html;
                                                } else {
                                                    $uriage_progress = "";
                                                }*/

                                            $view = "";
                                            if($out1_a == "ON"){ $view .= $temp1_shop_manthly_html;}
                                            if($out1_b == "ON"){ $view .= $temp1_web_manthly_html;}
                                            if($out1_c == "ON"){ $view .= $temp1_oroshi_manthly_html;}
                                            //$view_title1 = "（免税以外）";
                                            $view_title1 = "";
                                            $temp1_all_sorce = "<p class='title_a'>金額" . $view_title1 . "</p><div class='box1'>" . $temp1_title . $view . $all_sum_uriage . "</div>"/* . $uriage_progress*/;

                                        // 全期間全部門売上点数合計とその平均値のHTML作成
                                            if($all_sum_number_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更
                                                    //$all_average2 = floor((int)$all_sum_number_all / $i);
                                                        if($out1_c == "ON"){
                                                            $all_average2 = (int)$web_sum_number_ave2 + (int)$shop_sum_number_ave2 + (int)$oroshi_sum_number_ave2;
                                                        } else {
                                                            $all_average2 = (int)$web_sum_number_ave2 + (int)$shop_sum_number_ave2;
                                                        }
                                            } else {
                                                $all_average2 = 0;
                                            }
                                            //$all_sum_number .= "<div class='title6 ta_r'>" . number_format((int)$all_sum_number_all) . "</div><div class='title6 ta_r'>" . $yoy_number_sum . "</div><div class='title6 ta_r'>" . number_format((int)$all_average2) . "</div></div>";
                                            $all_sum_number .= "<div class='title6 ta_r'>" . number_format((int)$all_sum_number_all) . "</div><div class='title6 ta_r'>" . number_format((int)$all_average2) . "</div></div>";
                                        // 全HTMLを合体（検索対象外は除く）
                                        
                                            $view2 = "";
                                            if($out1_a == "ON"){ $view2 .= $temp1_shop_manthly_html2;}
                                            if($out1_b == "ON"){ $view2 .= $temp1_web_manthly_html2;}
                                            if($out1_c == "ON"){ $view2 .= $temp1_oroshi_manthly_html2;}
                                            $temp1_all_sorce2 = "<p class='title_a'>点数" . $view_title1 . "</p><div class='box1'>" . $temp1_title . $view2 . $all_sum_number . "</div>"/* . $number_progress*/;
                                        // 全期間全部門粗利合計とその平均値のHTML作成
                                            if($all_sum_arari_all <> 0){ 
                                                // 金額・全部門・全期間の平均を横軸合計から縦軸合計に変更
                                                    //$all_average3 = floor((int)$all_sum_arari_all / $i);
                                                        if($out1_c == "ON"){
                                                            $all_average3 = (int)$web_sum_arari_ave2 + (int)$shop_sum_arari_ave2 + (int)$oroshi_sum_arari_ave2;
                                                        } else {
                                                            $all_average3 = (int)$web_sum_arari_ave2 + (int)$shop_sum_arari_ave2;
                                                        }
                                            } else {
                                                $all_average3 = 0;
                                            }
                                            //$all_sum_arari .= "<div class='title6 ta_r'>" . number_format((int)$all_sum_arari_all) . "</div><div class='title6 ta_r'>" . $yoy_arari_sum . "</div><div class='title6 ta_r'>" . number_format((int)$all_average3) . "</div></div>";
                                            $all_sum_arari .= "<div class='title6 ta_r'>" . number_format((int)$all_sum_arari_all) . "</div><div class='title6 ta_r'>" . number_format((int)$all_average3) . "</div></div>";
                                            // 粗利率の平均
                                                if($all_sum_arari_all <> 0){ $all_average4 = number_format(floor(((int)$all_sum_arari_all / (int)$all_sum_uriage_all) * 100 * 10) / 10 ,1);} else {$all_average4 = 0;}
                                                $all_sum_arari_per .= "<div class='title6 ta_c'>---</div><div class='title6 ta_r'>" . $all_average4 . "%</div></div>";
                                        // 全HTMLを合体（検索対象外は除く）
                                        
                                            $view3 = "";
                                            if($out1_a == "ON"){ $view3 .= $temp1_shop_manthly_html3;}
                                            if($out1_b == "ON"){ $view3 .= $temp1_web_manthly_html3;}
                                            if($out1_c == "ON"){ $view3 .= $temp1_oroshi_manthly_html3;}
                                            $temp1_all_sorce3 = "<p class='title_a'>粗利" . $view_title1 . "</p><div class='box1'>" . $temp1_title . $view3 . $all_sum_arari . $shop_sum_arari_per . $web_sum_arari_per;
                                            if($out1_c == "ON"){$temp1_all_sorce3 .= $oroshi_sum_arari_per;}
                                            $temp1_all_sorce3 .= $all_sum_arari_per  . "</div>"/* . $arari_progress*/;


                    /************************************************************************************************************************************************************************************************************* */
                        // DB情報の受け取り（検索期間） end
                    /************************************************************************************************************************************************************************************************************* */

                        // JSで表示させるための、期間売上などのデータを作成                    
                            if($out1_a == "ON"){$js_shop_uriage = substr($js_shop_uriage, 0, -2);} else {$js_shop_uriage = "";}
                            if($out1_b == "ON"){$js_web_uriage = substr($js_web_uriage, 0, -2);} else {$js_web_uriage = "";}
                            if($out1_c == "ON"){$js_oroshi_uriage = substr($js_oroshi_uriage, 0, -2);} else {$js_oroshi_uriage = "";}
                            //if($js_month <> ""){$js_month = substr($js_month, 0, -1);} else {$js_month = "";}
                        // 列の横幅を列数によって可変させる
                            $line_width = 100 / ($diff_month + 4);
                            // 20230803
                            $line_width2 = 100 / ($diff_month + 1);

                            
                            if (PostRequest::has('brand_bumon_select')){ $brand_bumon_select = PostRequest::input('brand_bumon_select');} else {$brand_bumon_select = "";}
                            if (PostRequest::has('view_select')){ $view_select = PostRequest::input('view_select');} else {$view_select = "";}
                            return view($bladename,['view_select' => $view_select,'brand_bumon_select' => $brand_bumon_select,'first_day' => $first_day,'last_day' => $last_day,'next_year' => $next_year,'this_year' => $this_year,'last_year' => $last_year,'two_years_ago' => $two_years_ago,'three_years_ago' => $three_years_ago,'start_year' => $start_year,'start_month' => $start_month,'start_day' => $start_day,'end_year' => $end_year,'end_month' => $end_month,'end_day' => $end_day,'output' => $output,'form_view' => $form_view,'out1' => $out1,'out1_a' => $out1_a,'out1_b' => $out1_b,'out1_c' => $out1_c,'out1_d' => $out1_d,'out2_a' => $out2_a,'out2_b' => $out2_b,'out2_c' => $out2_c,'out2_d' => $out2_d,'out2_e' => $out2_e,'out3_a' => $out3_a,'out3_b' => $out3_b,'out3_c' => $out3_c,'out3_d' => $out3_d,'out3_e' => $out3_e,'out3_f' => $out3_f,'out4_a' => $out4_a,'out4_b' => $out4_b,'temp1_all_sorce' => $temp1_all_sorce,'temp1_all_sorce2' => $temp1_all_sorce2,'js_web_uriage' => $js_web_uriage,'js_shop_uriage' => $js_shop_uriage,'js_oroshi_uriage' => $js_oroshi_uriage,'js_month' => $js_month,'past_between_start' => $past_between_start,'past_between_end' => $past_between_end,'past_temp1_all_sorce' => $past_temp1_all_sorce,'past_temp1_all_sorce2' => $past_temp1_all_sorce2,'past_js_web_uriage' => $past_js_web_uriage,'past_js_shop_uriage' => $past_js_shop_uriage,'past_js_oroshi_uriage' => $past_js_oroshi_uriage,'past_js_web_number' => $past_js_web_number,'past_js_shop_number' => $past_js_shop_number,'past_js_oroshi_number' => $past_js_oroshi_number,'js_web_number' => $js_web_number,'js_shop_number' => $js_shop_number,'js_oroshi_number' => $js_oroshi_number,'js_all_month_uriage' => $js_all_month_uriage,'js_past_all_month_uriage' => $js_past_all_month_uriage,'js_all_month_number' => $js_all_month_number,'js_past_all_month_number' => $js_past_all_month_number,'js_web_arari' => $js_web_arari,'js_shop_arari' => $js_shop_arari,'js_oroshi_arari' => $js_oroshi_arari,'js_all_month_arari' => $js_all_month_arari,'past_js_web_arari' => $past_js_web_arari,'past_js_shop_arari' => $past_js_shop_arari,'past_js_oroshi_arari' => $past_js_oroshi_arari,'js_past_all_month_arari' => $js_past_all_month_arari,'temp1_all_sorce3' => $temp1_all_sorce3,'past_temp1_all_sorce3' => $past_temp1_all_sorce3,'search' => $search,'line_width' => $line_width,'line_width2' => $line_width2,'out5' => $out5,'out5_a' => $out5_a,'out5_b' => $out5_b,'out5_c' => $out5_c,'temp1_all_sorce4' => $temp1_all_sorce4,'temp1_all_sorce5' => $temp1_all_sorce5,'temp1_all_sorce6' => $temp1_all_sorce6,'temp1_all_sorce7' => $temp1_all_sorce7,'temp1_all_sorce8' => $temp1_all_sorce8,'temp1_all_sorce9' => $temp1_all_sorce9,'temp1_all_sorce10' => $temp1_all_sorce10,'past_temp1_all_sorce4' => $past_temp1_all_sorce4,'past_temp1_all_sorce5' => $past_temp1_all_sorce5,'past_temp1_all_sorce6' => $past_temp1_all_sorce6,'web_total_js' => $web_total_js,'shop_total_js' => $shop_total_js,'oroshi_total_js' => $oroshi_total_js,'all_arari_total' => $all_arari_total,'past_web_total_js' => $past_web_total_js,'past_shop_total_js' => $past_shop_total_js,'past_oroshi_total_js' => $past_oroshi_total_js,'past_all_arari_total' => $past_all_arari_total,'web_total_js2' => $web_total_js2,'shop_total_js2' => $shop_total_js2,'oroshi_total_js2' => $oroshi_total_js2,'past_web_total_js2' => $past_web_total_js2,'past_shop_total_js2' => $past_shop_total_js2,'past_oroshi_total_js2' => $past_oroshi_total_js2,'web_total_js3' => $web_total_js3,'shop_total_js3' => $shop_total_js3,'oroshi_total_js3' => $oroshi_total_js3,'past_web_total_js3' => $past_web_total_js3,'past_shop_total_js3' => $past_shop_total_js3,'past_oroshi_total_js3' => $past_oroshi_total_js3,'out6' => $out6,'out7' => $out7,'uriage_progress_html' => $uriage_progress_html,'number_progress_html' => $number_progress_html,'arari_progress_html' => $arari_progress_html]);
        
                }
























}



